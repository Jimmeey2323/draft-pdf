import{r as C,h as I,y as mt,p as ee,j as e,C as Y,f as Z,c as q,a as U,b as G,B as X,g as ht,w as $e,S as pt,m as me,u as xt,d as gt}from"./index-Bm67KBkU.js";import{u as ft}from"./useSalesData-Bl_2HqTc.js";import{T as Fe,a as Ie,b as W,c as H}from"./tabs-BTrhdLSC.js";import{f as k,b as $,a as B,B as z}from"./index-DkD_C-d1.js";import{A as yt}from"./arrow-down-right-D7rC7EMG.js";import{C as Me}from"./credit-card-yR0Iskrq.js";import{P as Je}from"./percent-BAS2Szsf.js";import{T as Qe}from"./target-BmxdxojS.js";import{U as et}from"./users-7Ku-1TDB.js";import{A as Oe}from"./activity-CeUP9h5f.js";import{S as vt,a as Ke,D as bt,E as fe}from"./SalesMotionHero-sGphstF2.js";import{D as tt,C as Be}from"./dollar-sign-CKqx8kbC.js";import{T as st,C as Ee}from"./googleAuth-BGo8ElRc.js";import{T as at}from"./trending-down-B5K1omnR.js";import{A as jt}from"./AutoCloseFilterSection-DJhjGBJF.js";import{S as _e,n as wt,f as Ce,c as oe,o as Dt,A as Nt,d as he,e as Pt,q as nt,E as At,h as ye,r as kt,i as Ct,s as Tt,j as te,g as St,u as Rt,G as Mt,C as ot,t as Ye,k as Ot,X as ve,Y as re,v as Bt,R as pe,a as Te,T as xe,L as qe,b as Se,B as Et}from"./BarChart-o5Oeg9Jb.js";import{L as Vt,a as Lt}from"./LineChart-BWKGpJsm.js";import{P as $t,a as Ft}from"./PieChart-slnvMcDg.js";import{P as ie}from"./package-C0br8ACw.js";import{U as Ue}from"./user-izuMblv0.js";import{C as It}from"./crown-Bf6tWe5C.js";import{A as zt}from"./arrow-up-down-DaenedAL.js";import{I as Kt,F as _t}from"./select-CM-Birqk.js";import{T as be,a as je,b as K,c as S,d as we,e as w,f as De}from"./table-DhXofKdS.js";import{P as Ne}from"./PersistentTableFooter-DyingoeQ.js";import{C as le}from"./CopyTableButton-Blm2CDq4.js";import{M as Yt,S as qt}from"./StudioLocationTabs-BSKYatd_.js";import{DiscountDrillDownModal as Ut}from"./DiscountDrillDownModal-CYZm5OsU.js";import{M as Wt}from"./ModernDataTable-Qj0casC7.js";import{D as Ht}from"./DashboardMotionHero-C2yuh4RF.js";import{F as Gt}from"./footer-BTvMjyAb.js";import{A as Xt}from"./AdvancedExportButton-kiFhlv4f.js";import"./useGoogleSheets-BPVLuLVa.js";import"./collapsible-bGJQ2Wb9.js";import"./chevron-right-CbIMR3DA.js";import"./index-BdQq_4o_.js";import"./dropdown-menu-B9zQ9u84.js";import"./file-text-DChZNHsM.js";import"./scroll-area-BKnEh-kP.js";import"./tableStyles-BJWvDwDQ.js";import"./label-fD3fdNwH.js";import"./checkbox-ByePFv7I.js";import"./BrandSpinner-CGFi2e0U.js";import"./useAdvancedExport-luHYyrc4.js";function se(s){"@babel/helpers - typeof";return se=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},se(s)}function Zt(s,t){if(!(s instanceof t))throw new TypeError("Cannot call a class as a function")}function Jt(s,t){for(var c=0;c<t.length;c++){var o=t[c];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(s,lt(o.key),o)}}function Qt(s,t,c){return t&&Jt(s.prototype,t),Object.defineProperty(s,"prototype",{writable:!1}),s}function es(s,t,c){return t=Pe(t),ts(s,rt()?Reflect.construct(t,c||[],Pe(s).constructor):t.apply(s,c))}function ts(s,t){if(t&&(se(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ss(s)}function ss(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function rt(){try{var s=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(rt=function(){return!!s})()}function Pe(s){return Pe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(c){return c.__proto__||Object.getPrototypeOf(c)},Pe(s)}function as(s,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(t&&t.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),t&&Ve(s,t)}function Ve(s,t){return Ve=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,p){return o.__proto__=p,o},Ve(s,t)}function it(s,t,c){return t=lt(t),t in s?Object.defineProperty(s,t,{value:c,enumerable:!0,configurable:!0,writable:!0}):s[t]=c,s}function lt(s){var t=ns(s,"string");return se(t)=="symbol"?t:t+""}function ns(s,t){if(se(s)!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var o=c.call(s,t);if(se(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}var ke=function(s){function t(){return Zt(this,t),es(this,t,arguments)}return as(t,s),Qt(t,[{key:"render",value:function(){return null}}])}(C.Component);it(ke,"displayName","ZAxis");it(ke,"defaultProps",{zAxisId:0,range:[64,64],scale:"auto",type:"number"});var os=["option","isActive"];function ce(){return ce=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var c=arguments[t];for(var o in c)Object.prototype.hasOwnProperty.call(c,o)&&(s[o]=c[o])}return s},ce.apply(this,arguments)}function rs(s,t){if(s==null)return{};var c=is(s,t),o,p;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(s);for(p=0;p<h.length;p++)o=h[p],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(s,o)&&(c[o]=s[o])}return c}function is(s,t){if(s==null)return{};var c={};for(var o in s)if(Object.prototype.hasOwnProperty.call(s,o)){if(t.indexOf(o)>=0)continue;c[o]=s[o]}return c}function ls(s){var t=s.option,c=s.isActive,o=rs(s,os);return typeof t=="string"?C.createElement(_e,ce({option:C.createElement(wt,ce({type:t},o)),isActive:c,shapeType:"symbols"},o)):C.createElement(_e,ce({option:t,isActive:c,shapeType:"symbols"},o))}function ae(s){"@babel/helpers - typeof";return ae=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ae(s)}function ue(){return ue=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var c=arguments[t];for(var o in c)Object.prototype.hasOwnProperty.call(c,o)&&(s[o]=c[o])}return s},ue.apply(this,arguments)}function We(s,t){var c=Object.keys(s);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(s);t&&(o=o.filter(function(p){return Object.getOwnPropertyDescriptor(s,p).enumerable})),c.push.apply(c,o)}return c}function _(s){for(var t=1;t<arguments.length;t++){var c=arguments[t]!=null?arguments[t]:{};t%2?We(Object(c),!0).forEach(function(o){J(s,o,c[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(c)):We(Object(c)).forEach(function(o){Object.defineProperty(s,o,Object.getOwnPropertyDescriptor(c,o))})}return s}function cs(s,t){if(!(s instanceof t))throw new TypeError("Cannot call a class as a function")}function He(s,t){for(var c=0;c<t.length;c++){var o=t[c];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(s,ut(o.key),o)}}function us(s,t,c){return t&&He(s.prototype,t),c&&He(s,c),Object.defineProperty(s,"prototype",{writable:!1}),s}function ds(s,t,c){return t=Ae(t),ms(s,ct()?Reflect.construct(t,c||[],Ae(s).constructor):t.apply(s,c))}function ms(s,t){if(t&&(ae(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return hs(s)}function hs(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function ct(){try{var s=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ct=function(){return!!s})()}function Ae(s){return Ae=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(c){return c.__proto__||Object.getPrototypeOf(c)},Ae(s)}function ps(s,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(t&&t.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),t&&Le(s,t)}function Le(s,t){return Le=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,p){return o.__proto__=p,o},Le(s,t)}function J(s,t,c){return t=ut(t),t in s?Object.defineProperty(s,t,{value:c,enumerable:!0,configurable:!0,writable:!0}):s[t]=c,s}function ut(s){var t=xs(s,"string");return ae(t)=="symbol"?t:t+""}function xs(s,t){if(ae(s)!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var o=c.call(s,t);if(ae(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}var de=function(s){function t(){var c;cs(this,t);for(var o=arguments.length,p=new Array(o),h=0;h<o;h++)p[h]=arguments[h];return c=ds(this,t,[].concat(p)),J(c,"state",{isAnimationFinished:!1}),J(c,"handleAnimationEnd",function(){c.setState({isAnimationFinished:!0})}),J(c,"handleAnimationStart",function(){c.setState({isAnimationFinished:!1})}),J(c,"id",Rt("recharts-scatter-")),c}return ps(t,s),us(t,[{key:"renderSymbolsStatically",value:function(o){var p=this,h=this.props,b=h.shape,f=h.activeShape,j=h.activeIndex,P=Ce(this.props,!1);return o.map(function(v,l){var n=j===l,a=n?f:b,i=_(_({},P),v);return I.createElement(oe,ue({className:"recharts-scatter-symbol",key:"symbol-".concat(v?.cx,"-").concat(v?.cy,"-").concat(v?.size,"-").concat(l)},Dt(p.props,v,l),{role:"img"}),I.createElement(ls,ue({option:a,isActive:n,key:"symbol-".concat(l)},i)))})}},{key:"renderSymbolsWithAnimation",value:function(){var o=this,p=this.props,h=p.points,b=p.isAnimationActive,f=p.animationBegin,j=p.animationDuration,P=p.animationEasing,v=p.animationId,l=this.state.prevPoints;return I.createElement(Nt,{begin:f,duration:j,isActive:b,easing:P,from:{t:0},to:{t:1},key:"pie-".concat(v),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(n){var a=n.t,i=h.map(function(u,m){var d=l&&l[m];if(d){var r=he(d.cx,u.cx),x=he(d.cy,u.cy),y=he(d.size,u.size);return _(_({},u),{},{cx:r(a),cy:x(a),size:y(a)})}var g=he(0,u.size);return _(_({},u),{},{size:g(a)})});return I.createElement(oe,null,o.renderSymbolsStatically(i))})}},{key:"renderSymbols",value:function(){var o=this.props,p=o.points,h=o.isAnimationActive,b=this.state.prevPoints;return h&&p&&p.length&&(!b||!Pt(b,p))?this.renderSymbolsWithAnimation():this.renderSymbolsStatically(p)}},{key:"renderErrorBar",value:function(){var o=this.props.isAnimationActive;if(o&&!this.state.isAnimationFinished)return null;var p=this.props,h=p.points,b=p.xAxis,f=p.yAxis,j=p.children,P=nt(j,At);return P?P.map(function(v,l){var n=v.props,a=n.direction,i=n.dataKey;return I.cloneElement(v,{key:"".concat(a,"-").concat(i,"-").concat(h[l]),data:h,xAxis:b,yAxis:f,layout:a==="x"?"vertical":"horizontal",dataPointFormatter:function(m,d){return{x:m.cx,y:m.cy,value:a==="x"?+m.node.x:+m.node.y,errorVal:ye(m,d)}}})}):null}},{key:"renderLine",value:function(){var o=this.props,p=o.points,h=o.line,b=o.lineType,f=o.lineJointType,j=Ce(this.props,!1),P=Ce(h,!1),v,l;if(b==="joint")v=p.map(function(x){return{x:x.cx,y:x.cy}});else if(b==="fitting"){var n=kt(p),a=n.xmin,i=n.xmax,u=n.a,m=n.b,d=function(y){return u*y+m};v=[{x:a,y:d(a)},{x:i,y:d(i)}]}var r=_(_(_({},j),{},{fill:"none",stroke:j&&j.fill},P),{},{points:v});return I.isValidElement(h)?l=I.cloneElement(h,r):Ct(h)?l=h(r):l=I.createElement(Tt,ue({},r,{type:f})),I.createElement(oe,{className:"recharts-scatter-line",key:"recharts-scatter-line"},l)}},{key:"render",value:function(){var o=this.props,p=o.hide,h=o.points,b=o.line,f=o.className,j=o.xAxis,P=o.yAxis,v=o.left,l=o.top,n=o.width,a=o.height,i=o.id,u=o.isAnimationActive;if(p||!h||!h.length)return null;var m=this.state.isAnimationFinished,d=mt("recharts-scatter",f),r=j&&j.allowDataOverflow,x=P&&P.allowDataOverflow,y=r||x,g=te(i)?this.id:i;return I.createElement(oe,{className:d,clipPath:y?"url(#clipPath-".concat(g,")"):null},r||x?I.createElement("defs",null,I.createElement("clipPath",{id:"clipPath-".concat(g)},I.createElement("rect",{x:r?v:v-n/2,y:x?l:l-a/2,width:r?n:n*2,height:x?a:a*2}))):null,b&&this.renderLine(),this.renderErrorBar(),I.createElement(oe,{key:"recharts-scatter-symbols"},this.renderSymbols()),(!u||m)&&St.renderCallByParent(this.props,h))}}],[{key:"getDerivedStateFromProps",value:function(o,p){return o.animationId!==p.prevAnimationId?{prevAnimationId:o.animationId,curPoints:o.points,prevPoints:p.curPoints}:o.points!==p.curPoints?{curPoints:o.points}:null}}])}(C.PureComponent);J(de,"displayName","Scatter");J(de,"defaultProps",{xAxisId:0,yAxisId:0,zAxisId:0,legendType:"circle",lineType:"joint",lineJointType:"linear",data:[],shape:"circle",hide:!1,isAnimationActive:!Mt.isSsr,animationBegin:0,animationDuration:400,animationEasing:"linear"});J(de,"getComposedData",function(s){var t=s.xAxis,c=s.yAxis,o=s.zAxis,p=s.item,h=s.displayedData,b=s.xAxisTicks,f=s.yAxisTicks,j=s.offset,P=p.props.tooltipType,v=nt(p.props.children,ot),l=te(t.dataKey)?p.props.dataKey:t.dataKey,n=te(c.dataKey)?p.props.dataKey:c.dataKey,a=o&&o.dataKey,i=o?o.range:ke.defaultProps.range,u=i&&i[0],m=t.scale.bandwidth?t.scale.bandwidth():0,d=c.scale.bandwidth?c.scale.bandwidth():0,r=h.map(function(x,y){var g=ye(x,l),A=ye(x,n),N=!te(a)&&ye(x,a)||"-",T=[{name:te(t.dataKey)?p.props.name:t.name||t.dataKey,unit:t.unit||"",value:g,payload:x,dataKey:l,type:P},{name:te(c.dataKey)?p.props.name:c.name||c.dataKey,unit:c.unit||"",value:A,payload:x,dataKey:n,type:P}];N!=="-"&&T.push({name:o.name||o.dataKey,unit:o.unit||"",value:N,payload:x,dataKey:a,type:P});var D=Ye({axis:t,ticks:b,bandSize:m,entry:x,index:y,dataKey:l}),R=Ye({axis:c,ticks:f,bandSize:d,entry:x,index:y,dataKey:n}),M=N!=="-"?o.scale(N):u,O=Math.sqrt(Math.max(M,0)/Math.PI);return _(_({},x),{},{cx:D,cy:R,x:D-O,y:R-O,xAxis:t,yAxis:c,zAxis:o,width:2*O,height:2*O,size:M,node:{x:g,y:A,z:N},tooltipPayload:T,tooltipPosition:{x:D,y:R},payload:x},v&&v[y]&&v[y].props)});return _({points:r},j)});var gs=Ot({chartName:"ScatterChart",GraphicalChild:de,defaultTooltipEventType:"item",validateTooltipEventTypes:["item"],axisComponents:[{axisType:"xAxis",AxisComp:ve},{axisType:"yAxis",AxisComp:re},{axisType:"zAxis",AxisComp:ke}],formatAxisMap:Bt});const ge=s=>{if(s==null)return 0;if(typeof s=="number")return s;if(typeof s=="string"){const t=parseFloat(s.replace(/[^0-9.-]/g,""));return isNaN(t)?0:t}return 0},L=(s,t)=>{if(t===0)return{rate:s>0?100:0,isSignificant:s>0,trend:s>0?"moderate":"weak"};const c=(s-t)/t*100,o=Math.abs(c);let p;return c>0?p=o>20?"strong":o>5?"moderate":"weak":p=o>20?"weak":o>5?"moderate":"weak",{rate:c,isSignificant:o>2,trend:p}};function fs(s=[],t,c){return C.useMemo(()=>{let o;c?.dateRange?.end?o=typeof c.dateRange.end=="string"?new Date(c.dateRange.end):c.dateRange.end:o=new Date;const p=y=>new Date(y.getFullYear(),y.getMonth(),1),h=y=>new Date(y.getFullYear(),y.getMonth()+1,0,23,59,59,999),b=p(o),f=new Date(b.getFullYear(),b.getMonth()-1,15),j=p(f),P=h(f),v=y=>y.toLocaleDateString(void 0,{month:"short",year:"numeric"}),l=`${v(b)} vs ${v(j)}`,n=(y,g,A)=>!!(y&&g&&A&&y>=g&&y<=A),a=s,u=(t&&t.length>0?t:[]).filter(y=>n(ee(y.paymentDate),j,P)),m=y=>{const g=y.reduce((V,Q)=>V+ge(Q.discountAmount),0),A=y.reduce((V,Q)=>V+ge(Q.paymentValue),0),N=y.length,T=y.filter(V=>ge(V.discountAmount)>0).length,D=new Set(y.map(V=>V.memberId||V.customerEmail).filter(Boolean)).size,R=new Set(y.filter(V=>ge(V.discountAmount)>0).map(V=>V.memberId||V.customerEmail).filter(Boolean)).size,M=A+g,O=M>0?g/M*100:0,E=N>0?T/N*100:0,F=D>0?R/D*100:0,ze=T>0?g/T:0,ne=R>0?g/R:0;return{totalDiscounts:g,totalRevenue:A,discountRate:O,discountedTransactions:T,customersWithDiscounts:R,avgDiscountPerTransaction:ze,avgDiscountPerCustomer:ne,discountPenetration:E,customerDiscountPenetration:F,totalTransactions:N}},d=m(a),r=m(u);return{metrics:[{title:"Total Discounts",value:k(d.totalDiscounts),rawValue:d.totalDiscounts,change:L(d.totalDiscounts,r.totalDiscounts).rate,changeDetails:L(d.totalDiscounts,r.totalDiscounts),previousValue:k(r.totalDiscounts),previousRawValue:r.totalDiscounts,periodLabel:l,icon:"DollarSign",description:"Total amount discounted this month"},{title:"Discount Rate",value:$(d.discountRate),rawValue:d.discountRate,change:L(d.discountRate,r.discountRate).rate,changeDetails:L(d.discountRate,r.discountRate),previousValue:$(r.discountRate),previousRawValue:r.discountRate,periodLabel:l,icon:"Percent",description:"Discounts as % of gross (pre-discount) revenue"},{title:"Transactions with Discounts",value:B(d.discountedTransactions),rawValue:d.discountedTransactions,change:L(d.discountedTransactions,r.discountedTransactions).rate,changeDetails:L(d.discountedTransactions,r.discountedTransactions),previousValue:B(r.discountedTransactions),previousRawValue:r.discountedTransactions,periodLabel:l,icon:"ShoppingCart",description:"Number of transactions where a discount was applied"},{title:"Customers with Discounts",value:B(d.customersWithDiscounts),rawValue:d.customersWithDiscounts,change:L(d.customersWithDiscounts,r.customersWithDiscounts).rate,changeDetails:L(d.customersWithDiscounts,r.customersWithDiscounts),previousValue:B(r.customersWithDiscounts),previousRawValue:r.customersWithDiscounts,periodLabel:l,icon:"Users",description:"Unique customers receiving discounts"},{title:"Avg Discount per Transaction",value:k(d.avgDiscountPerTransaction),rawValue:d.avgDiscountPerTransaction,change:L(d.avgDiscountPerTransaction,r.avgDiscountPerTransaction).rate,changeDetails:L(d.avgDiscountPerTransaction,r.avgDiscountPerTransaction),previousValue:k(r.avgDiscountPerTransaction),previousRawValue:r.avgDiscountPerTransaction,periodLabel:l,icon:"Target",description:"Average discount per discounted transaction"},{title:"Avg Discount per Customer",value:k(d.avgDiscountPerCustomer),rawValue:d.avgDiscountPerCustomer,change:L(d.avgDiscountPerCustomer,r.avgDiscountPerCustomer).rate,changeDetails:L(d.avgDiscountPerCustomer,r.avgDiscountPerCustomer),previousValue:k(r.avgDiscountPerCustomer),previousRawValue:r.avgDiscountPerCustomer,periodLabel:l,icon:"Activity",description:"Average discount per customer receiving discounts"},{title:"Discount Penetration",value:$(d.discountPenetration),rawValue:d.discountPenetration,change:L(d.discountPenetration,r.discountPenetration).rate,changeDetails:L(d.discountPenetration,r.discountPenetration),previousValue:$(r.discountPenetration),previousRawValue:r.discountPenetration,periodLabel:l,icon:"PieChart",description:"Percentage of transactions that received discounts"},{title:"Customer Discount Rate",value:$(d.customerDiscountPenetration),rawValue:d.customerDiscountPenetration,change:L(d.customerDiscountPenetration,r.customerDiscountPenetration||0).rate,changeDetails:L(d.customerDiscountPenetration,r.customerDiscountPenetration||0),previousValue:$(r.customerDiscountPenetration||0),previousRawValue:r.customerDiscountPenetration||0,periodLabel:l,icon:"UserCheck",description:"Percentage of unique customers who received discounts"}]}},[s,t,c?.dateRange?.start,c?.dateRange?.end])}const ys={DollarSign:tt,ShoppingCart:vt,Activity:Oe,Users:et,Target:Qe,Percent:Je,CreditCard:Me,ArrowDownRight:yt},vs=({data:s,historicalData:t,dateRange:c,onMetricClick:o})=>{const{metrics:p}=fs(s,t,{dateRange:c}),h=C.useMemo(()=>{const u=s.reduce((N,T)=>N+(T.discountAmount||0),0),m=s.reduce((N,T)=>N+(T.paymentValue||0),0),d=s.length,r=s.filter(N=>(N.discountAmount||0)>0).length,x=new Set(s.map(N=>N.memberId||N.customerEmail)).size,y=new Set(s.filter(N=>(N.discountAmount||0)>0).map(N=>N.memberId||N.customerEmail)).size,g=d>0?r/d*100:0,A=m+u>0?u/(m+u)*100:0;return{totalDiscounts:u,totalRevenue:m,totalTransactions:d,discountedTransactions:r,uniqueCustomers:x,customersWithDiscounts:y,discountPenetration:g,discountRate:A}},[s]),{totalRevenue:b,totalDiscounts:f,totalTransactions:j,discountedTransactions:P,uniqueCustomers:v,customersWithDiscounts:l,discountPenetration:n,discountRate:a}=h,i=u=>{if(o){const m={title:u.title,name:u.title,type:"metric",totalRevenue:b,totalDiscounts:f,transactions:j,discountedTransactions:P,uniqueCustomers:v,customersWithDiscounts:l,discountRate:a,discountPenetration:n,rawData:s,filteredTransactionData:s,isDynamic:!0,calculatedFromFiltered:!0};o(m)}};return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:p.map((u,m)=>{const d=ys[u.icon]||tt,r=u.change>0,x=u.change<0;return e.jsx(Y,{className:Z("group relative overflow-hidden cursor-pointer transition-all duration-700","bg-white hover:bg-gradient-to-br hover:from-gray-900 hover:via-slate-900 hover:to-slate-900",m%4===0&&"border-t-4 border-indigo-700 hover:border-indigo-700 shadow-lg",m%4===1&&"border-t-4 border-purple-700 hover:border-purple-700 shadow-lg",m%4===2&&"border-t-4 border-blue-700 hover:border-blue-700 shadow-lg",m%4===3&&"border-t-4 border-violet-700 hover:border-violet-700 shadow-lg","hover:shadow-2xl hover:shadow-slate-900/30","hover:-translate-y-2 hover:scale-[1.02]",o&&"hover:cursor-pointer"),onClick:()=>i(u),children:e.jsxs(q,{className:"p-6 relative",children:[e.jsx("div",{className:"absolute top-4 right-4 opacity-10 group-hover:opacity-20 transition-all duration-700",children:e.jsx(d,{className:Z("w-12 h-12 transition-all duration-700",m%4===0&&"text-indigo-700",m%4===1&&"text-purple-700",m%4===2&&"text-blue-700",m%4===3&&"text-violet-700","group-hover:text-white/40")})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:Z("p-4 rounded-2xl transition-all duration-700 border-1 shadow-md",m%4===0&&"bg-gradient-to-br from-indigo-700 to-indigo-600 border-indigo-900 text-white shadow-indigo-200",m%4===1&&"bg-gradient-to-br from-purple-700 to-purple-600 border-purple-900 text-white shadow-purple-200",m%4===2&&"bg-gradient-to-br from-blue-700 to-blue-600 border-blue-900 text-white shadow-blue-200",m%4===3&&"bg-gradient-to-br from-violet-700 to-violet-600 border-violet-900 text-white shadow-violet-200","group-hover:bg-white/20 group-hover:border-white/40 group-hover:text-white group-hover:shadow-white/20"),children:e.jsx(d,{className:"w-6 h-6 drop-shadow-sm"})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h3",{className:"font-semibold text-lg text-slate-900 group-hover:text-white/95 transition-colors duration-700",children:u.title})})]}),e.jsxs("div",{className:Z("flex items-center space-x-1 px-3 py-1 rounded-full text-xs font-semibold transition-all duration-700",r?"bg-green-50 text-green-700 group-hover:bg-green-400/30 group-hover:text-green-100":x?"bg-red-50 text-red-700 group-hover:bg-red-400/30 group-hover:text-red-100":"bg-blue-50 text-blue-700 group-hover:bg-blue-400/30 group-hover:text-blue-100"),children:[r&&e.jsx(st,{className:"w-3 h-3"}),x&&e.jsx(at,{className:"w-3 h-3"}),e.jsxs("span",{children:[u.change>0?"+":"",u.change.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:Z("text-4xl font-bold transition-all duration-700 text-slate-900 group-hover:text-white"),children:u.value}),e.jsx("p",{className:Z("text-xs text-slate-500 group-hover:text-slate-200 transition-colors"),children:u.periodLabel?e.jsxs(e.Fragment,{children:[u.periodLabel,": ",e.jsx("span",{className:"font-medium",children:u.previousValue})]}):e.jsxs(e.Fragment,{children:["vs previous month: ",e.jsx("span",{className:"font-medium",children:u.previousValue})]})})]})]}),e.jsx("div",{className:Z("mt-4 p-3 border-t border-l-4 transition-all duration-700","bg-slate-50 group-hover:bg-slate-800/50 border-t-slate-200 group-hover:border-t-white/10",m%4===0&&"border-l-indigo-700",m%4===1&&"border-l-purple-700",m%4===2&&"border-l-blue-700",m%4===3&&"border-l-violet-700"),children:e.jsx("p",{className:"text-xs text-slate-900 group-hover:text-white transition-colors duration-700",children:u.description})})]})},u.title)})})},Ge=["#8b5cf6","#06b6d4","#10b981","#f59e0b","#ef4444","#6366f1","#ec4899","#84cc16"],Xe=({data:s,filters:t})=>{const[c,o]=C.useState("trends"),p=C.useMemo(()=>{let h=s.filter(a=>(a.discountAmount||0)>0);t&&(h=h.filter(a=>{if(t.location&&a.calculatedLocation!==t.location||t.category&&a.cleanedCategory!==t.category||t.product&&a.cleanedProduct!==t.product||t.soldBy&&(a.soldBy==="-"?"Online/System":a.soldBy)!==t.soldBy||t.paymentMethod&&a.paymentMethod!==t.paymentMethod||t.minDiscountAmount&&(a.discountAmount||0)<t.minDiscountAmount||t.maxDiscountAmount&&(a.discountAmount||0)>t.maxDiscountAmount||t.minDiscountPercent&&(a.discountPercentage||0)<t.minDiscountPercent||t.maxDiscountPercent&&(a.discountPercentage||0)>t.maxDiscountPercent)return!1;if(t.dateRange?.from||t.dateRange?.to){const i=new Date(a.paymentDate);if(t.dateRange.from&&i<t.dateRange.from||t.dateRange.to&&i>t.dateRange.to)return!1}return!0}));const b=h.reduce((a,i)=>{const u=new Date(i.paymentDate),m=`${u.getFullYear()}-${(u.getMonth()+1).toString().padStart(2,"0")}`;return a[m]||(a[m]={month:m,transactions:0,totalDiscount:0,totalRevenue:0,avgDiscount:0}),a[m].transactions+=1,a[m].totalDiscount+=i.discountAmount||0,a[m].totalRevenue+=i.paymentValue||0,a},{}),f=Object.values(b).map(a=>({...a,avgDiscount:a.transactions>0?a.totalDiscount/a.transactions:0,discountRate:a.totalRevenue>0?a.totalDiscount/(a.totalRevenue+a.totalDiscount)*100:0})).sort((a,i)=>a.month.localeCompare(i.month)),j=h.reduce((a,i)=>{const u=i.cleanedCategory||"Unknown";return a[u]||(a[u]={name:u,value:0,transactions:0}),a[u].value+=i.discountAmount||0,a[u].transactions+=1,a},{}),P=Object.values(j).sort((a,i)=>i.value-a.value).slice(0,8),l=[{min:0,max:100,label:"₹0-100"},{min:100,max:500,label:"₹100-500"},{min:500,max:1e3,label:"₹500-1K"},{min:1e3,max:2500,label:"₹1K-2.5K"},{min:2500,max:5e3,label:"₹2.5K-5K"},{min:5e3,max:1/0,label:"₹5K+"}].map(a=>{const i=h.filter(u=>{const m=u.discountAmount||0;return m>=a.min&&m<a.max});return{range:a.label,transactions:i.length,totalDiscount:i.reduce((u,m)=>u+(m.discountAmount||0),0),avgDiscount:i.length>0?i.reduce((u,m)=>u+(m.discountAmount||0),0)/i.length:0,totalRevenue:i.reduce((u,m)=>u+(m.paymentValue||0),0)}}),n=h.slice(0,200).map(a=>({discountAmount:a.discountAmount||0,discountPercent:a.discountPercentage||0,revenue:a.paymentValue||0,category:a.cleanedCategory||"Unknown"}));return{monthlyTrends:f,categoryDistribution:P,rangeAnalysis:l,scatterData:n}},[s,t]);return e.jsx("div",{className:"space-y-6",children:e.jsxs(Fe,{value:c,onValueChange:o,className:"w-full",children:[e.jsxs(Ie,{className:"grid w-full grid-cols-4 bg-white border border-slate-200 p-1 rounded-xl shadow-sm h-auto",children:[e.jsxs(W,{value:"trends",className:"text-sm px-4 py-3 data-[state=active]:bg-blue-600 data-[state=active]:text-white",children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Trends"]}),e.jsxs(W,{value:"distribution",className:"text-sm px-4 py-3 data-[state=active]:bg-purple-600 data-[state=active]:text-white",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Distribution"]}),e.jsxs(W,{value:"ranges",className:"text-sm px-4 py-3 data-[state=active]:bg-green-600 data-[state=active]:text-white",children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Ranges"]}),e.jsxs(W,{value:"correlation",className:"text-sm px-4 py-3 data-[state=active]:bg-orange-600 data-[state=active]:text-white",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Correlation"]})]}),e.jsx(H,{value:"trends",className:"space-y-6",children:e.jsxs(Y,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-xl",children:[e.jsx(U,{children:e.jsxs(G,{className:"text-xl font-bold bg-gradient-to-r from-blue-700 to-indigo-700 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx(Ee,{className:"w-6 h-6 text-blue-600"}),"Monthly Discount Trends"]})}),e.jsx(q,{children:e.jsx(pe,{width:"100%",height:400,children:e.jsxs(Vt,{data:p.monthlyTrends,children:[e.jsx(Te,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"month"}),e.jsx(re,{yAxisId:"left",tickFormatter:h=>k(h)}),e.jsx(re,{yAxisId:"right",orientation:"right",tickFormatter:h=>`${h}%`}),e.jsx(xe,{formatter:(h,b)=>[b==="discountRate"?`${h.toFixed(1)}%`:k(h),b==="totalDiscount"?"Total Discount":b==="totalRevenue"?"Revenue":"Discount Rate"]}),e.jsx(qe,{}),e.jsx(Se,{yAxisId:"left",dataKey:"totalDiscount",fill:"#3b82f6",name:"Total Discount"}),e.jsx(Lt,{yAxisId:"right",type:"monotone",dataKey:"discountRate",stroke:"#ef4444",strokeWidth:3,name:"Discount Rate %"})]})})})]})}),e.jsx(H,{value:"distribution",className:"space-y-6",children:e.jsxs(Y,{className:"bg-gradient-to-br from-white via-purple-50/30 to-violet-50/20 border-0 shadow-xl",children:[e.jsx(U,{children:e.jsxs(G,{className:"text-xl font-bold bg-gradient-to-r from-purple-700 to-violet-700 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx(Ke,{className:"w-6 h-6 text-purple-600"}),"Discount Distribution by Category"]})}),e.jsx(q,{children:e.jsx(pe,{width:"100%",height:400,children:e.jsxs($t,{children:[e.jsx(Ft,{data:p.categoryDistribution,cx:"50%",cy:"50%",labelLine:!1,label:({name:h,value:b})=>`${h}: ${k(b)}`,outerRadius:120,fill:"#8884d8",dataKey:"value",children:p.categoryDistribution.map((h,b)=>e.jsx(ot,{fill:Ge[b%Ge.length]},`cell-${b}`))}),e.jsx(xe,{formatter:h=>k(h)})]})})})]})}),e.jsx(H,{value:"ranges",className:"space-y-6",children:e.jsxs(Y,{className:"bg-gradient-to-br from-white via-green-50/30 to-emerald-50/20 border-0 shadow-xl",children:[e.jsx(U,{children:e.jsxs(G,{className:"text-xl font-bold bg-gradient-to-r from-green-700 to-emerald-700 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx(Be,{className:"w-6 h-6 text-green-600"}),"Discount Range Analysis"]})}),e.jsx(q,{children:e.jsx(pe,{width:"100%",height:400,children:e.jsxs(Et,{data:p.rangeAnalysis,children:[e.jsx(Te,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"range"}),e.jsx(re,{tickFormatter:h=>k(h)}),e.jsx(xe,{formatter:(h,b)=>[k(h),b==="totalDiscount"?"Total Discount":"Average Discount"]}),e.jsx(qe,{}),e.jsx(Se,{dataKey:"totalDiscount",fill:"#10b981",name:"Total Discount"}),e.jsx(Se,{dataKey:"avgDiscount",fill:"#06b6d4",name:"Average Discount"})]})})})]})}),e.jsx(H,{value:"correlation",className:"space-y-6",children:e.jsxs(Y,{className:"bg-gradient-to-br from-white via-orange-50/30 to-amber-50/20 border-0 shadow-xl",children:[e.jsx(U,{children:e.jsxs(G,{className:"text-xl font-bold bg-gradient-to-r from-orange-700 to-amber-700 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx(Oe,{className:"w-6 h-6 text-orange-600"}),"Discount Amount vs Percentage Correlation"]})}),e.jsx(q,{children:e.jsx(pe,{width:"100%",height:400,children:e.jsxs(gs,{data:p.scatterData,children:[e.jsx(Te,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"discountPercent",name:"Discount %",tickFormatter:h=>`${h}%`}),e.jsx(re,{dataKey:"discountAmount",name:"Discount Amount",tickFormatter:h=>k(h)}),e.jsx(xe,{formatter:(h,b)=>[b==="discountPercent"?`${h}%`:k(h),b==="discountPercent"?"Discount %":"Discount Amount"]}),e.jsx(de,{dataKey:"discountAmount",fill:"#f59e0b"})]})})})]})})]})})},bs=({data:s,filters:t,onDrillDown:c})=>{const[o,p]=C.useState("desc"),h=C.useMemo(()=>{const f=s.reduce((n,a)=>{const i=a.cleanedCategory||"Unknown";return n[i]||(n[i]={totalDiscount:0,count:0,totalRevenue:0,avgPercent:0}),n[i].totalDiscount+=a.discountAmount||0,n[i].count+=1,n[i].totalRevenue+=a.paymentValue||0,n[i].avgPercent+=a.discountPercentage||0,n},{}),j=s.reduce((n,a)=>{const i=a.cleanedProduct||"Unknown";return n[i]||(n[i]={totalDiscount:0,count:0,totalRevenue:0,avgPercent:0}),n[i].totalDiscount+=a.discountAmount||0,n[i].count+=1,n[i].totalRevenue+=a.paymentValue||0,n[i].avgPercent+=a.discountPercentage||0,n},{}),P=s.reduce((n,a)=>{const i=a.soldBy==="-"?"Online/System":a.soldBy;return n[i]||(n[i]={totalDiscount:0,count:0,totalRevenue:0,avgPercent:0}),n[i].totalDiscount+=a.discountAmount||0,n[i].count+=1,n[i].totalRevenue+=a.paymentValue||0,n[i].avgPercent+=a.discountPercentage||0,n},{}),v=s.reduce((n,a)=>{const i=a.paymentMethod||"Unknown";return n[i]||(n[i]={totalDiscount:0,count:0,totalRevenue:0,avgPercent:0}),n[i].totalDiscount+=a.discountAmount||0,n[i].count+=1,n[i].totalRevenue+=a.paymentValue||0,n[i].avgPercent+=a.discountPercentage||0,n},{}),l=n=>Object.entries(n).map(([a,i])=>({name:a,totalDiscount:i.totalDiscount,count:i.count,totalRevenue:i.totalRevenue,avgPercent:i.count>0?i.avgPercent/i.count:0,avgDiscount:i.count>0?i.totalDiscount/i.count:0})).sort((a,i)=>o==="desc"?i.totalDiscount-a.totalDiscount:a.totalDiscount-i.totalDiscount);return{categories:l(f),products:l(j),soldBy:l(P),paymentMethods:l(v)}},[s,o]),b=(f,j,P,v)=>{const l=f.slice(0,5),n=f.slice(-5).reverse();return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(Y,{className:"bg-gradient-to-br from-white via-green-50/30 to-emerald-50/20 border-0 shadow-lg",children:[e.jsx(U,{className:"pb-3",children:e.jsxs(G,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(It,{className:"w-5 h-5 text-yellow-600"}),"Top ",P," by Discount",e.jsx(X,{variant:"ghost",size:"sm",onClick:()=>p(o==="desc"?"asc":"desc"),className:"ml-auto",children:e.jsx(zt,{className:"w-4 h-4"})})]})}),e.jsx(q,{className:"space-y-3",children:l.map((a,i)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/60 rounded-lg hover:bg-white/80 transition-all duration-300 cursor-pointer hover:scale-102 group",onClick:()=>c?.(`${a.name} - Discount Details`,s.filter(u=>(v==="category"?u.cleanedCategory:v==="product"?u.cleanedProduct:v==="soldBy"?u.soldBy==="-"?"Online/System":u.soldBy:u.paymentMethod)===a.name),v),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm ${i===0?"bg-gradient-to-r from-yellow-500 to-amber-500":i===1?"bg-gradient-to-r from-gray-400 to-gray-500":i===2?"bg-gradient-to-r from-orange-500 to-amber-600":"bg-gradient-to-r from-blue-500 to-purple-600"}`,children:["#",i+1]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-slate-800 truncate group-hover:text-slate-900",children:a.name}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-600",children:[e.jsxs("span",{children:[B(a.count)," transactions"]}),e.jsxs(z,{variant:"outline",className:"text-xs bg-green-50 text-green-700 border-green-200",children:[a.avgPercent.toFixed(1),"% avg"]})]})]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("div",{className:"font-bold text-red-600 text-sm",children:k(a.totalDiscount)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[k(a.avgDiscount),"/txn"]})]})]},a.name))})]}),e.jsxs(Y,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-lg",children:[e.jsx(U,{className:"pb-3",children:e.jsxs(G,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5 text-blue-600"}),"Lowest ",P," by Discount"]})}),e.jsx(q,{className:"space-y-3",children:n.map((a,i)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/60 rounded-lg hover:bg-white/80 transition-all duration-300 cursor-pointer hover:scale-102 group",onClick:()=>c?.(`${a.name} - Discount Details`,s.filter(u=>(v==="category"?u.cleanedCategory:v==="product"?u.cleanedProduct:v==="soldBy"?u.soldBy==="-"?"Online/System":u.soldBy:u.paymentMethod)===a.name),v),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 h-10 bg-gradient-to-r from-slate-500 to-gray-600 rounded-full flex items-center justify-center text-white font-bold text-sm",children:["#",n.length-i]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-slate-800 truncate group-hover:text-slate-900",children:a.name}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-600",children:[e.jsxs("span",{children:[B(a.count)," transactions"]}),e.jsxs(z,{variant:"outline",className:"text-xs bg-blue-50 text-blue-700 border-blue-200",children:[a.avgPercent.toFixed(1),"% avg"]})]})]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("div",{className:"font-bold text-blue-600 text-sm",children:k(a.totalDiscount)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[k(a.avgDiscount),"/txn"]})]})]},a.name))})]})]})};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Top & Bottom Performers"}),e.jsxs(z,{variant:"outline",className:"text-sm",children:[B(s.length)," total discounted transactions"]})]}),e.jsxs(Fe,{defaultValue:"categories",className:"w-full",children:[e.jsxs(Ie,{className:"grid w-full grid-cols-4 mb-6 bg-white shadow-sm",children:[e.jsxs(W,{value:"categories",className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Categories"]}),e.jsxs(W,{value:"products",className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Products"]}),e.jsxs(W,{value:"soldBy",className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4"}),"Sold By"]}),e.jsxs(W,{value:"payment",className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4"}),"Payment Method"]})]}),e.jsx(H,{value:"categories",children:b(h.categories,e.jsx(ie,{className:"w-5 h-5"}),"Categories","category")}),e.jsx(H,{value:"products",children:b(h.products,e.jsx(ie,{className:"w-5 h-5"}),"Products","product")}),e.jsx(H,{value:"soldBy",children:b(h.soldBy,e.jsx(Ue,{className:"w-5 h-5"}),"Staff","soldBy")}),e.jsx(H,{value:"payment",children:b(h.paymentMethods,e.jsx(Me,{className:"w-5 h-5"}),"Payment Methods","paymentMethod")})]})]})},js=({data:s,onRowClick:t})=>{const{filters:c}=ht(),o=`${c.dateRange.start}:${c.dateRange.end}`,[p,h]=C.useState(""),[b,f]=C.useState("paymentDate"),[j,P]=C.useState("desc"),[v,l]=C.useState(1),n=50,a=C.useMemo(()=>{let D=s.filter(R=>{const M=p.toLowerCase();return R.customerName?.toLowerCase().includes(M)||R.customerEmail?.toLowerCase().includes(M)||R.cleanedProduct?.toLowerCase().includes(M)||R.cleanedCategory?.toLowerCase().includes(M)||R.calculatedLocation?.toLowerCase().includes(M)||R.soldBy?.toLowerCase().includes(M)});return D.sort((R,M)=>{let O=R[b],E=M[b];return typeof O=="number"&&typeof E=="number"?j==="asc"?O-E:E-O:typeof O=="string"&&typeof E=="string"?j==="asc"?O.localeCompare(E):E.localeCompare(O):0}),D},[s,p,b,j]),i=Math.ceil(a.length/n),u=a.slice((v-1)*n,v*n),m=C.useMemo(()=>{const D=a.reduce((E,F)=>E+(F.discountAmount||0),0),R=a.reduce((E,F)=>E+(F.paymentValue||0),0),M=a.reduce((E,F)=>E+(F.mrpPostTax||0),0),O=a.length>0?a.reduce((E,F)=>E+(F.discountPercentage||0),0)/a.length:0;return{totalDiscount:D,totalRevenue:R,totalMrp:M,avgDiscountPercentage:O,totalTransactions:a.length}},[a]),d=D=>{b===D?P(j==="asc"?"desc":"asc"):(f(D),P("desc"))},r=D=>{t&&t(`Transaction Details - ${D.customerName}`,[D],"transaction-detail")},x=D=>b!==D?null:j==="asc"?e.jsx(st,{className:"w-4 h-4"}):e.jsx(at,{className:"w-4 h-4"}),y=D=>D>=25?"secondary":"outline",g=[{header:"Date",key:"paymentDate",type:"date"},{header:"Customer",key:"customerName",type:"text"},{header:"Product",key:"cleanedProduct",type:"text"},{header:"Category",key:"cleanedCategory",type:"text"},{header:"MRP (Post Tax)",key:"mrpPostTax",type:"currency"},{header:"Discount Amount",key:"discountAmount",type:"currency"},{header:"Discount %",key:"discountPercentage",type:"percentage"},{header:"Final Amount",key:"paymentValue",type:"currency"},{header:"Location",key:"calculatedLocation",type:"text"},{header:"Sold By",key:"soldBy",type:"text"}],A=C.useRef(null),N=$e(),T=`Detailed Discount Analysis (${o})`;return C.useEffect(()=>{if(!N)return;const D=A.current;if(!D)return;const R=()=>{const M=D.querySelector("table")||D;let O=`${T}
`;const E=M.querySelectorAll("thead th"),F=[];return E.forEach(ne=>{const V=ne.textContent?.trim();V&&F.push(V)}),F.length&&(O+=F.join("	")+`
`,O+=F.map(()=>"---").join("	")+`
`),M.querySelectorAll("tbody tr").forEach(ne=>{const V=ne.querySelectorAll("td"),Q=[];V.forEach(dt=>Q.push((dt.textContent||"").trim())),Q.length&&(O+=Q.join("	")+`
`)}),O.trim()};return N.register({id:T,getTextContent:R}),()=>N.unregister(T)},[N,T]),e.jsxs(Y,{ref:A,className:"shadow-xl border-0 bg-gradient-to-br from-white via-slate-50 to-blue-50/30",children:[e.jsx(U,{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur-sm",children:e.jsx(Je,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(G,{className:"text-2xl font-bold",children:"Detailed Discount Analysis"}),e.jsx("div",{className:"p-6 border-t"}),e.jsx("p",{className:"text-slate-200 mt-1",children:"Comprehensive transaction-level discount data with advanced filtering"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(pt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(Kt,{placeholder:"Search transactions...",value:p,onChange:D=>h(D.target.value),className:"pl-10 bg-white/10 border-white/20 text-white placeholder:text-slate-300"})]}),e.jsxs(X,{variant:"outline",size:"sm",className:"bg-white/10 border-white/20 text-white hover:bg-white/20",children:[e.jsx(bt,{className:"w-4 h-4 mr-2"}),"Export"]}),e.jsx(le,{tableRef:A,tableName:T,size:"sm",onCopyAllTabs:N?async()=>N.getAllTabsContent():void 0})]})]})}),e.jsxs(q,{className:"p-0",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4 p-6 bg-gradient-to-r from-slate-50 to-slate-100 border-b",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:B(m.totalTransactions)}),e.jsx("div",{className:"text-sm text-slate-600",children:"Total Transactions"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:k(m.totalDiscount)}),e.jsx("div",{className:"text-sm text-slate-600",children:"Total Discount"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:k(m.totalRevenue)}),e.jsx("div",{className:"text-sm text-slate-600",children:"Total Revenue"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:k(m.totalMrp)}),e.jsx("div",{className:"text-sm text-slate-600",children:"Total MRP"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:$(m.avgDiscountPercentage)}),e.jsx("div",{className:"text-sm text-slate-600",children:"Avg Discount %"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(be,{children:[e.jsx(je,{className:"bg-gradient-to-br from-indigo-800 to-blue-900 ",children:e.jsxs(K,{className:"bg-gradient-to-br from-gray-800 to-indigo-900",children:[e.jsx(S,{className:"cursor-pointer",onClick:()=>d("paymentDate"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Date ",x("paymentDate")]})}),e.jsx(S,{className:"cursor-pointer",onClick:()=>d("customerName"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Customer ",x("customerName")]})}),e.jsx(S,{onClick:()=>d("cleanedProduct"),className:"cursor-pointer bg-gradient-to-br from-gray-800 to-indigo-900 ",children:e.jsxs("div",{className:"flex items-center gap-2",children:["Product ",x("cleanedProduct")]})}),e.jsx(S,{className:"cursor-pointer text-right",onClick:()=>d("mrpPostTax"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["MRP ",x("mrpPostTax")]})}),e.jsx(S,{className:"cursor-pointer text-right",onClick:()=>d("discountAmount"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["Discount ",x("discountAmount")]})}),e.jsx(S,{className:"cursor-pointer text-right",onClick:()=>d("discountPercentage"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["Discount % ",x("discountPercentage")]})}),e.jsx(S,{className:"cursor-pointer text-right",onClick:()=>d("paymentValue"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["Final Amount ",x("paymentValue")]})}),e.jsx(S,{children:"Location"}),e.jsx(S,{children:"Sold By"}),e.jsx(S,{className:"text-center",children:"Actions"}),e.jsx(S,{className:"text-right",children:e.jsx(le,{tableRef:A,tableName:T,size:"sm",onCopyAllTabs:N?async()=>N.getAllTabsContent():void 0})})]})}),e.jsx(we,{children:u.map((D,R)=>e.jsxs(K,{className:"hover:cursor-pointer max-h-[35px]",children:[e.jsx(w,{className:"font-medium py-2 max-h-[35px]",children:e.jsx("span",{className:"truncate block",children:new Date(D.paymentDate).toLocaleDateString()})}),e.jsx(w,{className:"py-2 max-h-[35px]",children:e.jsxs("div",{className:"truncate",children:[e.jsx("div",{className:"font-medium text-sm text-slate-700 truncate",children:D.customerName}),e.jsx("div",{className:"text-xs text-slate-500 truncate",children:D.customerEmail})]})}),e.jsx(w,{className:"py-2 max-h-[35px]",children:e.jsxs("div",{className:"truncate",children:[e.jsx("div",{className:"font-medium text-sm text-slate-700 truncate",children:D.cleanedProduct}),e.jsx("div",{className:"text-xs text-slate-500 truncate",children:D.cleanedCategory})]})}),e.jsx(w,{className:"text-right font-medium py-2 max-h-[35px]",children:e.jsx("span",{className:"truncate block",children:k(D.mrpPostTax||0)})}),e.jsx(w,{className:"text-right py-2 max-h-[35px]",children:e.jsxs("span",{className:"font-medium text-sm text-slate-700 truncate block",children:["-",k(D.discountAmount||0)]})}),e.jsx(w,{className:"text-right py-2 max-h-[35px]",children:e.jsx(z,{variant:y(D.discountPercentage||0),className:"text-xs h-6 px-2 font-medium w-16 justify-center",children:$(D.discountPercentage||0)})}),e.jsx(w,{className:"text-right font-medium text-sm text-slate-700 py-2 max-h-[35px]",children:e.jsx("span",{className:"truncate block",children:k(D.paymentValue||0)})}),e.jsx(w,{className:"py-2 max-h-[35px]",children:e.jsx("span",{className:"text-sm text-slate-600 truncate block",children:D.calculatedLocation})}),e.jsx(w,{className:"py-2 max-h-[35px]",children:e.jsx("span",{className:"text-sm text-slate-600 truncate block",children:D.soldBy})}),e.jsx(w,{className:"text-center py-2 max-h-[35px]",children:e.jsx(X,{variant:"outline",size:"sm",onClick:()=>r(D),className:"hover:bg-blue-50 h-7",children:e.jsx(fe,{className:"w-3 h-3"})})})]},`${D.saleItemId}-${R}`))}),e.jsx(De,{children:e.jsxs(K,{children:[e.jsxs(w,{colSpan:3,className:"font-bold text-white",children:["Summary (",B(m.totalTransactions)," transactions)"]}),e.jsx(w,{className:"text-right font-bold text-white",children:k(m.totalMrp)}),e.jsxs(w,{className:"text-right font-bold text-white",children:["-",k(m.totalDiscount)]}),e.jsx(w,{className:"text-right font-bold text-white",children:$(m.avgDiscountPercentage)}),e.jsx(w,{className:"text-right font-bold text-white",children:k(m.totalRevenue)}),e.jsx(w,{colSpan:3})]})})]})}),i>1&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-t bg-slate-50",children:[e.jsxs("div",{className:"text-sm text-slate-600",children:["Showing ",(v-1)*n+1," to ",Math.min(v*n,a.length)," of ",a.length," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{variant:"outline",size:"sm",onClick:()=>l(Math.max(1,v-1)),disabled:v===1,children:"Previous"}),e.jsxs("span",{className:"text-sm text-slate-600",children:["Page ",v," of ",i]}),e.jsx(X,{variant:"outline",size:"sm",onClick:()=>l(Math.min(i,v+1)),disabled:v===i,children:"Next"})]})]})]}),e.jsx(Ne,{tableId:"discounts-detailed-table",tableName:"Detailed Discount Analysis",tableContext:"Transaction-level discounts and revenue performance",tableData:a,tableColumns:g,className:"rounded-b-lg"})]})},ws=({data:s,onDrillDown:t})=>{const c=C.useRef(null),o=C.useRef(null),p=C.useRef(null),h=$e();C.useEffect(()=>{if(!h)return;const l=(n,a)=>{const i=n.current;if(!i)return;const u=()=>{const m=i.querySelector("table")||i;let d=`${a}
`;const r=m.querySelectorAll("thead th"),x=[];return r.forEach(g=>{const A=g.textContent?.trim();A&&x.push(A)}),x.length&&(d+=x.join("	")+`
`,d+=x.map(()=>"---").join("	")+`
`),m.querySelectorAll("tbody tr").forEach(g=>{const A=g.querySelectorAll("td"),N=[];A.forEach(T=>N.push((T.textContent||"").trim())),N.length&&(d+=N.join("	")+`
`)}),d.trim()};h.register({id:a,getTextContent:u})};return l(c,"Product-wise Discount Breakdown"),l(o,"Location-wise Discount Breakdown"),l(p,"Staff-wise Discount Breakdown"),()=>{h.unregister("Product-wise Discount Breakdown"),h.unregister("Location-wise Discount Breakdown"),h.unregister("Staff-wise Discount Breakdown")}},[h]);const b=C.useMemo(()=>{const l=s.reduce((n,a)=>{const i=a.cleanedProduct||"Unknown Product";return n[i]||(n[i]={product:i,category:a.cleanedCategory||"Unknown",transactions:0,totalDiscount:0,totalRevenue:0,totalMrp:0,avgDiscountPercentage:0,data:[]}),n[i].transactions+=1,n[i].totalDiscount+=a.discountAmount||0,n[i].totalRevenue+=a.paymentValue||0,n[i].totalMrp+=a.mrpPostTax||0,n[i].data.push(a),n},{});return Object.values(l).map(n=>({...n,avgDiscountPercentage:n.totalMrp>0?n.totalDiscount/n.totalMrp*100:0,discountRate:n.transactions>0?n.totalDiscount/n.transactions:0})).sort((n,a)=>a.totalDiscount-n.totalDiscount)},[s]),f=C.useMemo(()=>{const l=s.reduce((n,a)=>{const i=a.calculatedLocation||"Unknown Location";return n[i]||(n[i]={location:i,transactions:0,totalDiscount:0,totalRevenue:0,totalMrp:0,uniqueCustomers:new Set,data:[]}),n[i].transactions+=1,n[i].totalDiscount+=a.discountAmount||0,n[i].totalRevenue+=a.paymentValue||0,n[i].totalMrp+=a.mrpPostTax||0,n[i].uniqueCustomers.add(a.customerEmail),n[i].data.push(a),n},{});return Object.values(l).map(n=>({...n,uniqueCustomers:n.uniqueCustomers.size,avgDiscountPercentage:n.totalMrp>0?n.totalDiscount/n.totalMrp*100:0,avgDiscountPerTransaction:n.transactions>0?n.totalDiscount/n.transactions:0})).sort((n,a)=>a.totalDiscount-n.totalDiscount)},[s]),j=C.useMemo(()=>{const l=s.reduce((n,a)=>{const i=a.soldBy||"Unknown";return n[i]||(n[i]={staff:i,transactions:0,totalDiscount:0,totalRevenue:0,totalMrp:0,data:[]}),n[i].transactions+=1,n[i].totalDiscount+=a.discountAmount||0,n[i].totalRevenue+=a.paymentValue||0,n[i].totalMrp+=a.mrpPostTax||0,n[i].data.push(a),n},{});return Object.values(l).map(n=>({...n,avgDiscountPercentage:n.totalMrp>0?n.totalDiscount/n.totalMrp*100:0,discountRate:n.transactions>0?n.totalDiscount/n.transactions:0})).sort((n,a)=>a.totalDiscount-n.totalDiscount)},[s]),P=(l,n,a)=>{t&&t(l,n,a)},v=l=>l>=20?{variant:"secondary",label:"High"}:{variant:"outline",label:"Low"};return e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(Y,{ref:c,className:"shadow-xl border-0 bg-white",children:[e.jsx(U,{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur-sm",children:e.jsx(ie,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(G,{className:"text-2xl font-bold",children:"Product-wise Discount Breakdown"}),e.jsx("p",{className:"text-slate-200 mt-1",children:"Discount performance analysis by product category"})]}),e.jsx(le,{tableRef:c,tableName:"Product-wise Discount Breakdown",size:"sm",onCopyAllTabs:h?async()=>h.getAllTabsContent():void 0})]})}),e.jsx(q,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(be,{children:[e.jsx(je,{children:e.jsxs(K,{children:[e.jsx(S,{children:"Product"}),e.jsx(S,{children:"Category"}),e.jsx(S,{className:"text-center",children:"Transactions"}),e.jsx(S,{className:"text-right",children:"Total Discount"}),e.jsx(S,{className:"text-right",children:"Avg Discount %"}),e.jsx(S,{className:"text-right",children:"Total Revenue"}),e.jsx(S,{className:"text-right",children:"Discount Impact"}),e.jsx(S,{className:"text-center",children:"Actions"})]})}),e.jsx(we,{children:b.slice(0,10).map((l,n)=>{const a=v(l.avgDiscountPercentage);return e.jsxs(K,{className:"max-h-[35px]",children:[e.jsx(w,{className:"font-medium py-2 max-h-[35px]",children:e.jsx("div",{className:"max-w-[200px] truncate text-sm",title:l.product,children:l.product})}),e.jsx(w,{className:"py-2 max-h-[35px]",children:e.jsx("span",{className:"text-sm text-slate-600 truncate block",children:l.category})}),e.jsx(w,{className:"text-center py-2 max-h-[35px]",children:e.jsx(z,{variant:"outline",className:"text-xs h-6 px-2 w-16 justify-center",children:B(l.transactions)})}),e.jsx(w,{className:"text-right font-medium text-sm text-slate-700 py-2 max-h-[35px]",children:e.jsx("span",{className:"truncate block",children:k(l.totalDiscount)})}),e.jsx(w,{className:"text-right py-2 max-h-[35px]",children:e.jsx(z,{variant:a.variant,className:"text-xs h-6 px-2 w-20 justify-center",children:$(l.avgDiscountPercentage)})}),e.jsx(w,{className:"text-right font-medium text-sm text-slate-700 py-2 max-h-[35px]",children:e.jsx("span",{className:"truncate block",children:k(l.totalRevenue)})}),e.jsx(w,{className:"text-right py-2 max-h-[35px]",children:e.jsxs("div",{className:"text-xs truncate",children:[e.jsx("div",{className:"font-medium truncate",children:k(l.discountRate)}),e.jsx("div",{className:"text-slate-500 truncate",children:"per transaction"})]})}),e.jsx(w,{className:"text-center py-2 max-h-[35px]",children:e.jsx(X,{variant:"outline",size:"sm",onClick:()=>P(`${l.product} - Discount Analysis`,l.data,"product-discount"),className:"hover:bg-slate-50 h-7",children:e.jsx(fe,{className:"w-3 h-3"})})})]},n)})}),e.jsx(De,{children:e.jsxs(K,{children:[e.jsx(w,{colSpan:2,className:"font-bold text-white",children:"Total (Top 10)"}),e.jsx(w,{className:"text-center font-bold text-white",children:B(b.slice(0,10).reduce((l,n)=>l+n.transactions,0))}),e.jsx(w,{className:"text-right font-bold text-white",children:k(b.slice(0,10).reduce((l,n)=>l+n.totalDiscount,0))}),e.jsx(w,{className:"text-right font-bold text-white",children:$(b.slice(0,10).reduce((l,n)=>l+n.avgDiscountPercentage,0)/Math.min(10,b.length))}),e.jsx(w,{className:"text-right font-bold text-white",children:k(b.slice(0,10).reduce((l,n)=>l+n.totalRevenue,0))}),e.jsx(w,{colSpan:2})]})})]})})})]}),e.jsx(Ne,{tableId:"discounts-product-breakdown",tableName:"Product-wise Discount Breakdown",tableContext:"Discounts grouped by product and category with impact metrics",tableData:b,tableColumns:[{header:"Product",key:"product",type:"text"},{header:"Category",key:"category",type:"text"},{header:"Transactions",key:"transactions",type:"number"},{header:"Total Discount",key:"totalDiscount",type:"currency"},{header:"Avg Discount %",key:"avgDiscountPercentage",type:"percentage"},{header:"Total Revenue",key:"totalRevenue",type:"currency"}]}),e.jsxs(Y,{ref:o,className:"shadow-xl border-0 bg-white",children:[e.jsx(U,{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur-sm",children:e.jsx(Yt,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(G,{className:"text-2xl font-bold",children:"Location-wise Discount Breakdown"}),e.jsx("p",{className:"text-slate-200 mt-1",children:"Geographic analysis of discount utilization patterns"})]}),e.jsx(le,{tableRef:o,tableName:"Location-wise Discount Breakdown",size:"sm",onCopyAllTabs:h?async()=>h.getAllTabsContent():void 0})]})}),e.jsx(q,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(be,{children:[e.jsx(je,{children:e.jsxs(K,{children:[e.jsx(S,{children:"Location"}),e.jsx(S,{className:"text-center",children:"Transactions"}),e.jsx(S,{className:"text-center",children:"Customers"}),e.jsx(S,{className:"text-right",children:"Total Discount"}),e.jsx(S,{className:"text-right",children:"Avg Discount %"}),e.jsx(S,{className:"text-right",children:"Avg per Transaction"}),e.jsx(S,{className:"text-right",children:"Total Revenue"}),e.jsx(S,{className:"text-center",children:"Actions"})]})}),e.jsx(we,{children:f.map((l,n)=>{const a=v(l.avgDiscountPercentage);return e.jsxs(K,{children:[e.jsx(w,{className:"font-medium",children:l.location}),e.jsx(w,{className:"text-center",children:e.jsx(z,{variant:"outline",className:"w-16 justify-center",children:B(l.transactions)})}),e.jsx(w,{className:"text-center",children:e.jsx(z,{variant:"secondary",className:"w-16 justify-center",children:B(l.uniqueCustomers)})}),e.jsx(w,{className:"text-right font-medium text-slate-700",children:k(l.totalDiscount)}),e.jsx(w,{className:"text-right",children:e.jsx(z,{variant:a.variant,className:"w-20 justify-center",children:$(l.avgDiscountPercentage)})}),e.jsx(w,{className:"text-right font-medium text-slate-700",children:k(l.avgDiscountPerTransaction)}),e.jsx(w,{className:"text-right font-medium text-slate-700",children:k(l.totalRevenue)}),e.jsx(w,{className:"text-center",children:e.jsx(X,{variant:"outline",size:"sm",onClick:()=>P(`${l.location} - Discount Analysis`,l.data,"location-discount"),className:"hover:bg-slate-50",children:e.jsx(fe,{className:"w-4 h-4"})})})]},n)})}),e.jsx(De,{children:e.jsxs(K,{children:[e.jsx(w,{className:"font-bold text-white",children:"Total"}),e.jsx(w,{className:"text-center font-bold text-white",children:B(f.reduce((l,n)=>l+n.transactions,0))}),e.jsx(w,{className:"text-center font-bold text-white",children:B(f.reduce((l,n)=>l+n.uniqueCustomers,0))}),e.jsx(w,{className:"text-right font-bold text-white",children:k(f.reduce((l,n)=>l+n.totalDiscount,0))}),e.jsx(w,{className:"text-right font-bold text-white",children:$(f.reduce((l,n)=>l+n.avgDiscountPercentage,0)/f.length)}),e.jsx(w,{className:"text-right font-bold text-white",children:k(f.reduce((l,n)=>l+n.avgDiscountPerTransaction,0)/f.length)}),e.jsx(w,{className:"text-right font-bold text-white",children:k(f.reduce((l,n)=>l+n.totalRevenue,0))}),e.jsx(w,{})]})})]})})})]}),e.jsx(Ne,{tableId:"discounts-location-breakdown",tableName:"Location-wise Discount Breakdown",tableContext:"Discounts grouped by studio location with customer counts and impact",tableData:f,tableColumns:[{header:"Location",key:"location",type:"text"},{header:"Transactions",key:"transactions",type:"number"},{header:"Customers",key:"uniqueCustomers",type:"number"},{header:"Total Discount",key:"totalDiscount",type:"currency"},{header:"Avg Discount %",key:"avgDiscountPercentage",type:"percentage"},{header:"Avg per Txn",key:"avgDiscountPerTransaction",type:"currency"},{header:"Revenue",key:"totalRevenue",type:"currency"}]}),e.jsxs(Y,{ref:p,className:"shadow-xl border-0 bg-gradient-to-br from-white via-purple-50/30 to-pink-50/20",children:[e.jsx(U,{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur-sm",children:e.jsx(et,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(G,{className:"text-2xl font-bold",children:"Staff-wise Discount Breakdown"}),e.jsx("p",{className:"text-slate-200 mt-1",children:"Analysis of discount authorization by sales staff"})]}),e.jsx(le,{tableRef:p,tableName:"Staff-wise Discount Breakdown",size:"sm",onCopyAllTabs:h?async()=>h.getAllTabsContent():void 0})]})}),e.jsx(q,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(be,{children:[e.jsx(je,{children:e.jsxs(K,{children:[e.jsx(S,{children:"Staff Member"}),e.jsx(S,{className:"text-center",children:"Transactions"}),e.jsx(S,{className:"text-right",children:"Total Discount"}),e.jsx(S,{className:"text-right",children:"Avg Discount %"}),e.jsx(S,{className:"text-right",children:"Discount per Sale"}),e.jsx(S,{className:"text-right",children:"Total Revenue"}),e.jsx(S,{className:"text-center",children:"Performance"}),e.jsx(S,{className:"text-center",children:"Actions"})]})}),e.jsx(we,{children:j.map((l,n)=>{const a=v(l.avgDiscountPercentage);return e.jsxs(K,{children:[e.jsx(w,{className:"font-medium",children:l.staff}),e.jsx(w,{className:"text-center",children:e.jsx(z,{variant:"outline",children:B(l.transactions)})}),e.jsx(w,{className:"text-right font-semibold text-red-600",children:k(l.totalDiscount)}),e.jsx(w,{className:"text-right",children:e.jsx(z,{variant:a.variant,children:$(l.avgDiscountPercentage)})}),e.jsx(w,{className:"text-right font-medium",children:k(l.discountRate)}),e.jsx(w,{className:"text-right font-semibold text-green-600",children:k(l.totalRevenue)}),e.jsx(w,{className:"text-center",children:e.jsx(z,{variant:a.variant,children:a.label})}),e.jsx(w,{className:"text-center",children:e.jsx(X,{variant:"outline",size:"sm",onClick:()=>P(`${l.staff} - Discount Analysis`,l.data,"staff-discount"),className:"hover:bg-purple-50",children:e.jsx(fe,{className:"w-4 h-4"})})})]},n)})}),e.jsx(De,{children:e.jsxs(K,{children:[e.jsx(w,{className:"font-bold text-white",children:"Total"}),e.jsx(w,{className:"text-center font-bold text-white",children:B(j.reduce((l,n)=>l+n.transactions,0))}),e.jsx(w,{className:"text-right font-bold text-white",children:k(j.reduce((l,n)=>l+n.totalDiscount,0))}),e.jsx(w,{className:"text-right font-bold text-white",children:$(j.reduce((l,n)=>l+n.avgDiscountPercentage,0)/j.length)}),e.jsx(w,{className:"text-right font-bold text-white",children:k(j.reduce((l,n)=>l+n.discountRate,0)/j.length)}),e.jsx(w,{className:"text-right font-bold text-white",children:k(j.reduce((l,n)=>l+n.totalRevenue,0))}),e.jsx(w,{colSpan:2})]})})]})})})]}),e.jsx(Ne,{tableId:"discounts-staff-breakdown",tableName:"Staff-wise Discount Breakdown",tableContext:"Discount authorization and revenue by staff member",tableData:j,tableColumns:[{header:"Staff",key:"staff",type:"text"},{header:"Transactions",key:"transactions",type:"number"},{header:"Total Discount",key:"totalDiscount",type:"currency"},{header:"Avg Discount %",key:"avgDiscountPercentage",type:"percentage"},{header:"Discount per Sale",key:"discountRate",type:"currency"},{header:"Revenue",key:"totalRevenue",type:"currency"}]})]})},Re=()=>({totalDiscounts:0,discountedTransactions:0,totalTransactions:0,totalValue:0,uniqueCustomers:0,customersWithDiscounts:0}),Ds=({data:s})=>{const[t,c]=C.useState("product"),[o,p]=C.useState("totalDiscounts"),[h,b]=C.useState("values"),f=$e(),j=C.useMemo(()=>{const r=new Date,x=[];for(let y=5;y>=0;y--){const g=new Date(r.getFullYear(),r.getMonth()-y,1);x.push(`${g.getFullYear()}-${String(g.getMonth()+1).padStart(2,"0")}`)}return x},[]),P=C.useMemo(()=>{const r=new Map,x=(g,A)=>{const N=A.discountAmount||0,T=A.paymentValue||0,D=N>0||(A.discountPercentage||0)>0;g.totalDiscounts+=N,g.totalTransactions+=1,g.totalValue+=T,D&&(g.discountedTransactions+=1),(A.memberId||A.customerEmail)&&(g.uniqueCustomers+=1,D&&(g.customersWithDiscounts+=1))};return s.forEach(g=>{if(!g.paymentDate)return;const A=new Date(g.paymentDate);if(isNaN(A.getTime()))return;const N=`${A.getFullYear()}-${String(A.getMonth()+1).padStart(2,"0")}`;let T="";switch(t){case"product":T=g.cleanedProduct||"Unknown Product";break;case"category":T=g.cleanedCategory||"Uncategorized";break;case"location":T=g.calculatedLocation||"Unknown Location";break;case"soldBy":T=g.soldBy==="-"?"Online/System":g.soldBy||"Unknown";break}r.has(T)||r.set(T,{group:T,months:new Map,totals:Re()});const D=r.get(T);D.months.has(N)||D.months.set(N,Re()),x(D.months.get(N),g),x(D.totals,g)}),Array.from(r.values()).map(g=>{let A=0;switch(o){case"totalDiscounts":A=g.totals.totalDiscounts;break;case"discountedTransactions":A=g.totals.discountedTransactions;break;case"avgDiscount":A=g.totals.discountedTransactions>0?g.totals.totalDiscounts/g.totals.discountedTransactions:0;break;case"discountRate":A=g.totals.totalValue+g.totals.totalDiscounts>0?g.totals.totalDiscounts/(g.totals.totalValue+g.totals.totalDiscounts)*100:0;break;case"uniqueCustomers":A=g.totals.customersWithDiscounts;break;case"totalValue":A=g.totals.totalValue;break}return{...g,totalValue:A}}).sort((g,A)=>A.totalValue-g.totalValue)},[s,t,o,j]),v=(r,x)=>{if(!r)return"0";switch(x){case"totalDiscounts":case"totalValue":return k(r.totalDiscounts);case"discountedTransactions":return B(r.discountedTransactions);case"avgDiscount":return r.discountedTransactions>0?k(r.totalDiscounts/r.discountedTransactions):"₹0";case"discountRate":return r.totalValue+r.totalDiscounts>0?$(r.totalDiscounts/(r.totalValue+r.totalDiscounts)*100):"0%";case"uniqueCustomers":return B(r.customersWithDiscounts);default:return"0"}},l=r=>{if(!r)return 0;switch(o){case"totalDiscounts":return r.totalDiscounts;case"discountedTransactions":return r.discountedTransactions;case"avgDiscount":return r.discountedTransactions>0?r.totalDiscounts/r.discountedTransactions:0;case"discountRate":return r.totalValue+r.totalDiscounts>0?r.totalDiscounts/(r.totalValue+r.totalDiscounts)*100:0;case"uniqueCustomers":return r.customersWithDiscounts;case"totalValue":return r.totalValue;default:return 0}},n=[{key:"group",header:t.charAt(0).toUpperCase()+t.slice(1),align:"left",className:"min-w-[200px] sticky left-0 bg-white",render:r=>e.jsx("div",{className:"font-semibold text-slate-800 truncate pr-4",children:t==="location"?r.replace("Kwality House, Kemps Corner","Kwality").replace("Supreme HQ, Bandra","Supreme").replace("Kenkere House","Kenkere"):r})},...j.map((r,x)=>({key:r,header:new Date(r+"-01").toLocaleDateString("en-US",{month:"short",year:"numeric"}),align:"center",className:"min-w-[100px]",render:(y,g)=>{const A=g.months.get(r);if(h==="values")return e.jsx("div",{className:"text-sm font-medium text-slate-800",children:v(A,o)});const N=j[x-1];if(!N)return e.jsx("span",{className:"text-slate-400 text-xs",children:"-"});const T=l(A),D=l(g.months.get(N));if(D===0&&T===0)return e.jsx("span",{className:"text-slate-400 text-xs",children:"0%"});const R=D>0?(T-D)/D*100:T>0?100:0;return e.jsx("div",{className:Z("text-xs font-semibold",R>0?"text-emerald-600":R<0?"text-red-600":"text-slate-500"),children:R===0?"0%":`${R>0?"+":""}${R.toFixed(1)}%`})}}))],a=()=>{const r=["Month-on-Month Discount Analysis"];r.push(`Group: ${t.charAt(0).toUpperCase()+t.slice(1)}, Metric: ${o}`),r.push(`View Mode: ${h}`),r.push("");const x=["Group",...j.map(y=>new Date(y+"-01").toLocaleDateString("en-US",{month:"short",year:"numeric"}))];return r.push(x.join("	")),P.forEach(y=>{const g=[y.group];j.forEach((A,N)=>{const T=y.months.get(A);if(h==="values")g.push(v(T,o));else{const D=j[N-1];if(!D)g.push("-");else{const R=l(T),M=l(y.months.get(D));if(M===0&&R===0)g.push("0%");else if(M===0)g.push("+100%");else{const O=((R-M)/M*100).toFixed(1);g.push(`${O}%`)}}}}),r.push(g.join("	"))}),r.join(`
`)};C.useEffect(()=>{if(f){const r="Month-on-Month Discount Analysis";return f.register({id:r,getTextContent:a}),()=>{f.unregister(r)}}},[f,P,t,o,h,j]);const i=new Map;P.forEach(r=>{j.forEach(x=>{const y=r.months.get(x);i.has(x)||i.set(x,Re());const g=i.get(x);y&&(g.totalDiscounts+=y.totalDiscounts,g.discountedTransactions+=y.discountedTransactions,g.totalTransactions+=y.totalTransactions,g.totalValue+=y.totalValue,g.uniqueCustomers+=y.uniqueCustomers,g.customersWithDiscounts+=y.customersWithDiscounts)})});const u={group:"TOTALS"};j.forEach((r,x)=>{const y=i.get(r);if(h==="values")u[r]=v(y,o);else{const g=j[x-1];if(!g)u[r]="-";else{const A=l(y),N=l(i.get(g));if(N===0&&A===0)u[r]="0%";else if(N===0)u[r]="+100%";else{const T=(A-N)/N*100;u[r]=`${T>0?"+":""}${T.toFixed(1)}%`}}}});const m={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6}}},d={hidden:{opacity:0,y:-10},visible:{opacity:1,y:0,transition:{duration:.4,delay:.2}}};return e.jsx(me.div,{variants:m,initial:"hidden",animate:"visible",className:"w-full",children:e.jsxs(Y,{className:"w-full bg-white/95 backdrop-blur-sm border-0 shadow-2xl overflow-hidden",children:[e.jsxs(U,{className:"pb-4",children:[e.jsxs(me.div,{variants:d,className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-slate-900 to-indigo-900 rounded-lg shadow-lg",children:e.jsx(Be,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Month-on-Month Discount Analysis"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Historical discount trends by group and metric"})]})]}),e.jsxs(z,{variant:"outline",className:"bg-gradient-to-r from-indigo-500/10 to-purple-500/10 text-indigo-700 border-indigo-300/50 backdrop-blur-sm",children:[e.jsx(Ee,{className:"w-3 h-3 mr-1"}),"Last 6 Months"]})]}),e.jsxs(me.div,{variants:d,className:"flex flex-wrap items-center gap-2 text-xs text-slate-600 mt-2",children:[e.jsx(_t,{className:"w-3 h-3"}),e.jsxs("span",{children:["Showing ",P.length," groups across ",j.length," months"]}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsxs("select",{className:"border rounded-md px-2 py-1 text-xs bg-white",value:t,onChange:r=>c(r.target.value),children:[e.jsx("option",{value:"product",children:"Group: Product"}),e.jsx("option",{value:"category",children:"Group: Category"}),e.jsx("option",{value:"location",children:"Group: Location"}),e.jsx("option",{value:"soldBy",children:"Group: Sales Rep"})]}),e.jsxs("select",{className:"border rounded-md px-2 py-1 text-xs bg-white",value:o,onChange:r=>p(r.target.value),children:[e.jsx("option",{value:"totalDiscounts",children:"Metric: Total Discounts"}),e.jsx("option",{value:"discountedTransactions",children:"Metric: Discounted Transactions"}),e.jsx("option",{value:"avgDiscount",children:"Metric: Avg Discount"}),e.jsx("option",{value:"discountRate",children:"Metric: Discount Rate"}),e.jsx("option",{value:"uniqueCustomers",children:"Metric: Customers w/ Discounts"}),e.jsx("option",{value:"totalValue",children:"Metric: Total Value"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx("span",{className:"font-medium",children:"View:"}),e.jsx(X,{size:"sm",variant:h==="values"?"default":"outline",onClick:()=>b("values"),className:"h-7 px-2",children:"Values"}),e.jsx(X,{size:"sm",variant:h==="growth"?"default":"outline",onClick:()=>b("growth"),className:"h-7 px-2",children:"Growth%"})]})]})]})]}),e.jsx(q,{className:"pt-0",children:e.jsx(me.div,{className:"overflow-x-auto",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:e.jsx(Wt,{data:P,columns:n,loading:!1,stickyHeader:!0,showFooter:!0,footerData:u,maxHeight:"500px",className:"rounded-lg",headerGradient:"from-slate-800 via-slate-900 to-slate-800",tableId:"month-on-month-discount-analysis"})})})]})})},Ze=()=>{const s=new Date,t=s.getFullYear(),c=s.getMonth(),o=new Date(t,c-1,1),p=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-01`,h=new Date(t,c,0),b=`${h.getFullYear()}-${String(h.getMonth()+1).padStart(2,"0")}-${String(h.getDate()).padStart(2,"0")}`;return{start:p,end:b}},Ns=({data:s})=>{const[t,c]=C.useState("kwality"),[o,p]=C.useState({dateRange:{start:null,end:null},category:[],product:[],soldBy:[],paymentMethod:[]}),[h,b]=C.useState({isOpen:!1,title:"",data:[],type:""});C.useEffect(()=>{if(s?.length>0){const u={};s.forEach(m=>{if(m.paymentDate){const d=ee(m.paymentDate);if(d){const r=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`;u[r]=(u[r]||0)+1}}}),Object.entries(u).sort((m,d)=>d[0].localeCompare(m[0]))}},[s]);const f=()=>{if(!s||s.length===0)return null;let u=null;if(s.forEach(r=>{if(r.paymentDate){const x=ee(r.paymentDate);x&&(!u||x>u)&&(u=x)}}),!u)return null;const m=new Date(u.getFullYear(),u.getMonth(),1),d=new Date(u.getFullYear(),u.getMonth()+1,0);return{start:`${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,"0")}-01`,end:`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`}};C.useEffect(()=>{if(s&&s.length>0){const u=Ze(),m=new Date(u.start),d=new Date(u.end);if(d.setHours(23,59,59,999),s.some(x=>{if(!x.paymentDate)return!1;const y=ee(x.paymentDate);return y&&y>=m&&y<=d}))p(x=>({...x,dateRange:{start:u.start,end:u.end}}));else{const x=f();x&&p(y=>({...y,dateRange:{start:x.start,end:x.end}}))}}},[s]);const j=(u,m=!1)=>{let d=u.slice();if(t!=="all"&&(d=d.filter(r=>{const x=(r.calculatedLocation||"").toString().toLowerCase();return t==="kwality"?x.includes("kwality")||x.includes("kemps"):t==="supreme"?x.includes("supreme")||x.includes("bandra"):t==="kenkere"?x.includes("kenkere")||x.includes("bengaluru"):t==="popup"?x.includes("pop")||x.includes("popup")||x.includes("pop-up"):!1})),!m&&(o.dateRange.start||o.dateRange.end)){const r=o.dateRange.start?new Date(o.dateRange.start):null,x=o.dateRange.end?(()=>{const y=new Date(o.dateRange.end);return y.setHours(23,59,59,999),y})():null;(r||x)&&(d=d.filter(y=>{if(!y.paymentDate)return!1;const g=ee(y.paymentDate);return!g||isNaN(g.getTime())?!1:(!r||g>=r)&&(!x||g<=x)}))}return o.category&&o.category.length>0&&(d=d.filter(r=>o.category.includes(r.cleanedCategory||"Uncategorized"))),o.product&&o.product.length>0&&(d=d.filter(r=>o.product.includes(r.cleanedProduct||r.paymentItem||"Unknown"))),o.soldBy&&o.soldBy.length>0&&(d=d.filter(r=>o.soldBy.includes(r.soldBy||"Unknown"))),o.paymentMethod&&o.paymentMethod.length>0&&(d=d.filter(r=>o.paymentMethod.includes(r.paymentMethod||"Unknown"))),d},P=C.useMemo(()=>j(s),[s,o,t]),v=C.useMemo(()=>j(s,!0),[s,t]),l=C.useMemo(()=>P,[P]);C.useMemo(()=>P.filter(m=>(m.discountAmount||0)>0),[P]);const n=u=>{b({isOpen:!0,title:`${u.title} Analysis`,data:u.rawData||P,type:"metric"})},a=(u,m,d)=>{b({isOpen:!0,title:u,data:m,type:d})},i=()=>{const u=Ze(),m=new Date(u.start),d=new Date(u.end);d.setHours(23,59,59,999);const r=s.some(y=>{if(!y.paymentDate)return!1;const g=ee(y.paymentDate);return g&&g>=m&&g<=d});let x={start:u.start,end:u.end};if(!r){const y=f();y&&(x=y)}p({dateRange:x,category:[],product:[],soldBy:[],paymentMethod:[]})};return C.useMemo(()=>{const u={all:0,kwality:0,supreme:0,kenkere:0};return l.forEach(m=>{u.all++;const d=(m.calculatedLocation||"").toString().toLowerCase();d.includes("kwality")?u.kwality++:d.includes("supreme")?u.supreme++:(d.includes("kenkere")||d.includes("bengaluru"))&&u.kenkere++}),u},[l]),e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"container mx-auto px-6"}),e.jsxs("div",{className:"container mx-auto px-6 space-y-6",children:[e.jsx(qt,{activeLocation:t,onLocationChange:c,showInfoPopover:!0,infoPopoverContext:"discounts-promotions-overview"}),e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"w-full",children:e.jsx(jt,{filters:o,onFiltersChange:p,onReset:i})}),e.jsx(vs,{data:l,historicalData:v,dateRange:o.dateRange,onMetricClick:n}),e.jsx(Xe,{data:v}),e.jsx(bs,{data:l,onDrillDown:a}),e.jsx(Ds,{data:v}),e.jsxs(Fe,{defaultValue:"detailed",className:"space-y-6",children:[e.jsxs(Ie,{className:"grid w-full grid-cols-3 bg-gradient-to-r from-slate-50 via-indigo-50 to-purple-50 p-1.5 rounded-xl shadow-md border border-slate-200",children:[e.jsx(W,{value:"detailed",className:"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-700 hover:text-slate-900 data-[state=active]:bg-gradient-to-r data-[state=active]:from-indigo-600 data-[state=active]:to-purple-600 data-[state=active]:text-white data-[state=active]:shadow-lg",children:"Data Tables"}),e.jsx(W,{value:"breakdown",className:"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-700 hover:text-slate-900 data-[state=active]:bg-gradient-to-r data-[state=active]:from-indigo-600 data-[state=active]:to-purple-600 data-[state=active]:text-white data-[state=active]:shadow-lg",children:"Breakdowns"}),e.jsx(W,{value:"analytics",className:"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-700 hover:text-slate-900 data-[state=active]:bg-gradient-to-r data-[state=active]:from-indigo-600 data-[state=active]:to-purple-600 data-[state=active]:text-white data-[state=active]:shadow-lg",children:"Analytics"})]}),e.jsx(H,{value:"analytics",className:"space-y-6",children:e.jsx(Xe,{data:l})}),e.jsx(H,{value:"detailed",className:"space-y-6",children:e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-xl p-6 border border-slate-200/50",children:e.jsx(js,{data:l,onRowClick:(u,m,d)=>a(u,m,d)})})}),e.jsx(H,{value:"breakdown",className:"space-y-6",children:e.jsx(ws,{data:l,onDrillDown:a})})]})]})]}),"      ",e.jsx(Ut,{isOpen:h.isOpen,onClose:()=>b({isOpen:!1,title:"",data:[],type:""}),title:h.title,data:h.data,type:h.type})]})},xa=()=>{xt();const{setLoading:s}=gt(),{data:t,loading:c,error:o}=ft(),p=C.useMemo(()=>t?t.map(f=>{const j=i=>{if(i==null||i==="")return 0;const u=i.toString().replace(/[₹,\s]/g,""),m=parseFloat(u);return isNaN(m)?0:m},P=j(f.discountAmount||f["Discount Amount -Mrp- Payment Value"]||0),v=j(f.discountPercentage||f["Discount Percentage - discount amount/mrp*100"]||0),l=j(f.paymentValue||f["Payment Value"]||0),n=j(f.mrpPreTax||f["Mrp - Pre Tax"]||0),a=j(f.mrpPostTax||f["Mrp - Post Tax"]||0);return{...f,memberId:f.memberId||f["Member ID"]?.toString()||"",customerName:f.customerName||f["Customer Name"]||"",customerEmail:f.customerEmail||f["Customer Email"]||"",paymentDate:f.paymentDate||f["Payment Date"]||"",paymentValue:l,paymentMethod:f.paymentMethod||f["Payment Method"]||"",calculatedLocation:f.calculatedLocation||f["Calculated Location"]||"",cleanedProduct:f.cleanedProduct||f["Cleaned Product"]||"",cleanedCategory:f.cleanedCategory||f["Cleaned Category"]||"",soldBy:f.soldBy==="-"?"Online/System":f.soldBy||f["Sold By"]||"Unknown",discountAmount:P,discountPercentage:v,mrpPreTax:n,mrpPostTax:a,hasDiscount:P>0||v>0}}):[],[t]),h=C.useMemo(()=>{if(!p||p.length===0)return[];const f=a=>{if(!a||a.trim()==="")return null;try{if(a.includes("/")){const u=a.split(" ")[0].trim().split("/");if(u.length===3){const m=parseInt(u[0]),d=parseInt(u[1]),r=parseInt(u[2]);if(!isNaN(r)&&!isNaN(d)&&!isNaN(m))return new Date(r,d-1,m)}}if(a.includes("-")){const i=new Date(a);if(!isNaN(i.getTime()))return i}return null}catch{return null}},j=new Date,P=new Date(j.getFullYear(),j.getMonth()-1,1),v=new Date(j.getFullYear(),j.getMonth(),0,23,59,59,999),l=p.filter(a=>{if(!a.paymentDate)return!1;const i=f(a.paymentDate);return i&&i>=P&&i<=v});return[{key:"Kwality House, Kemps Corner",name:"Kwality"},{key:"Supreme HQ, Bandra",name:"Supreme"},{key:"Kenkere House",name:"Kenkere"}].map(a=>{const u=l.filter(m=>a.key==="Kenkere House"?m.calculatedLocation?.includes("Kenkere")||m.calculatedLocation==="Kenkere House":m.calculatedLocation===a.key).reduce((m,d)=>m+(d.discountAmount||0),0);return{location:a.name,label:"Previous Month Discounts",value:k(u)}})},[p]);if(C.useEffect(()=>{s(c,"Loading discount and promotional analysis...")},[c,s]),o)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-indigo-50/30 to-purple-50/20",children:e.jsx("div",{className:"flex items-center justify-center min-h-screen p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Connection Error"}),e.jsx("p",{className:"text-gray-600 mb-4",children:o}),e.jsx("button",{onClick:()=>window.location.reload(),className:"bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700",children:"Retry Loading"})]})})});const b=e.jsx(Xt,{discountData:p,defaultFileName:"discounts-promotions-export",size:"sm",variant:"ghost",buttonClassName:"rounded-xl border border-white/30 text-white hover:border-white/50"});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-purple-50/30 to-indigo-50/20",children:[e.jsx(Ht,{title:"Discounts & Promotions",subtitle:"Comprehensive analysis of discount strategies, promotional effectiveness, and customer savings patterns",metrics:h,extra:b}),e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsx("main",{className:"space-y-8",children:e.jsx(Ns,{data:p})})}),e.jsx(Gt,{}),e.jsx("style",{children:`
        @keyframes fade-in-up {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes bounce-slow {
          0%, 20%, 50%, 80%, 100% {
            transform: translateY(0);
          }
          40% {
            transform: translateY(-15px);
          }
          60% {
            transform: translateY(-8px);
          }
        }
        
        @keyframes pulse-slow {
          0%, 100% {
            opacity: 0.3;
            transform: scale(1);
          }
          50% {
            opacity: 0.7;
            transform: scale(1.08);
          }
        }
        
        @keyframes spin-slow {
          from {
            transform: rotate(0deg);
          }
          to {
            transform: rotate(360deg);
          }
        }
        
        @keyframes float {
          0%, 100% {
            transform: translateY(0px) translateX(0px);
          }
          33% {
            transform: translateY(-12px) translateX(4px);
          }
          66% {
            transform: translateY(-6px) translateX(-4px);
          }
        }
        
        @keyframes twinkle {
          0%, 100% {
            opacity: 0.3;
            transform: scale(1) rotate(0deg);
          }
          25% {
            opacity: 0.9;
            transform: scale(1.3) rotate(90deg);
          }
          75% {
            opacity: 0.6;
            transform: scale(0.8) rotate(270deg);
          }
        }
        
        @keyframes drift-left {
          0%, 100% {
            transform: translateX(0px) translateY(0px);
          }
          50% {
            transform: translateX(-20px) translateY(-10px);
          }
        }
        
        @keyframes drift-right {
          0%, 100% {
            transform: translateX(0px) translateY(0px);
          }
          50% {
            transform: translateX(20px) translateY(-10px);
          }
        }
        
        @keyframes gentle-float {
          0%, 100% {
            transform: translateY(0px);
          }
          50% {
            transform: translateY(-8px);
          }
        }
        
        @keyframes gentle-bounce {
          0%, 100% {
            transform: translateY(0px);
          }
          50% {
            transform: translateY(-6px);
          }
        }
        
        @keyframes gentle-pulse {
          0%, 100% {
            opacity: 0.2;
            transform: scale(1);
          }
          50% {
            opacity: 0.5;
            transform: scale(1.1);
          }
        }
        
        @keyframes gentle-spin {
          from {
            transform: rotate(0deg);
          }
          to {
            transform: rotate(360deg);
          }
        }
        
        @keyframes gentle-drift {
          0%, 100% {
            transform: translateX(0px);
          }
          50% {
            transform: translateX(10px);
          }
        }
        
        @keyframes gentle-wave {
          0%, 100% {
            transform: translateY(0px) rotate(0deg);
          }
          50% {
            transform: translateY(-5px) rotate(180deg);
          }
        }
        
        @keyframes gentle-bob {
          0%, 100% {
            transform: translateY(0px) translateX(0px);
          }
          33% {
            transform: translateY(-4px) translateX(2px);
          }
          66% {
            transform: translateY(-2px) translateX(-2px);
          }
        }
        
        .animate-fade-in-up {
          animation: fade-in-up 0.6s ease-out forwards;
        }
        
        .animate-bounce-slow {
          animation: bounce-slow 4s ease-in-out infinite;
        }
        
        .animate-pulse-slow {
          animation: pulse-slow 5s ease-in-out infinite;
        }
        
        .animate-spin-slow {
          animation: spin-slow 12s linear infinite;
        }
        
        .animate-float {
          animation: float 4s ease-in-out infinite;
        }
        
        .animate-twinkle {
          animation: twinkle 3s ease-in-out infinite;
        }
        
        .animate-drift-left {
          animation: drift-left 6s ease-in-out infinite;
        }
        
        .animate-drift-right {
          animation: drift-right 6s ease-in-out infinite;
        }
        
        .animate-gentle-float {
          animation: gentle-float 3s ease-in-out infinite;
        }
        
        .animate-gentle-bounce {
          animation: gentle-bounce 2.5s ease-in-out infinite;
        }
        
        .animate-gentle-pulse {
          animation: gentle-pulse 4s ease-in-out infinite;
        }
        
        .animate-gentle-spin {
          animation: gentle-spin 20s linear infinite;
        }
        
        .animate-gentle-drift {
          animation: gentle-drift 5s ease-in-out infinite;
        }
        
        .animate-gentle-wave {
          animation: gentle-wave 4s ease-in-out infinite;
        }
        
        .animate-gentle-bob {
          animation: gentle-bob 3.5s ease-in-out infinite;
        }
        
        .animate-bounce-delayed {
          animation: bounce-slow 4s ease-in-out infinite;
          animation-delay: 0.8s;
        }
        
        .animate-pulse-delayed {
          animation: pulse-slow 5s ease-in-out infinite;
          animation-delay: 1.2s;
        }
        
        .animate-float-delayed {
          animation: float 4s ease-in-out infinite;
          animation-delay: 2s;
        }
        
        /* Enhanced Glow effects */
        .glow-purple {
          filter: drop-shadow(0 0 25px rgba(168, 85, 247, 0.6)) drop-shadow(0 0 50px rgba(168, 85, 247, 0.3));
        }
        
        .glow-blue {
          filter: drop-shadow(0 0 25px rgba(59, 130, 246, 0.6)) drop-shadow(0 0 50px rgba(59, 130, 246, 0.3));
        }
        
        .glow-pink {
          filter: drop-shadow(0 0 25px rgba(236, 72, 153, 0.6)) drop-shadow(0 0 50px rgba(236, 72, 153, 0.3));
        }
        
        .glow-green {
          filter: drop-shadow(0 0 25px rgba(34, 197, 94, 0.6)) drop-shadow(0 0 50px rgba(34, 197, 94, 0.3));
        }
        
        .glow-yellow {
          filter: drop-shadow(0 0 25px rgba(234, 179, 8, 0.6)) drop-shadow(0 0 50px rgba(234, 179, 8, 0.3));
        }
        
        .glow-indigo {
          filter: drop-shadow(0 0 25px rgba(99, 102, 241, 0.6)) drop-shadow(0 0 50px rgba(99, 102, 241, 0.3));
        }
        
        .glow-orange {
          filter: drop-shadow(0 0 25px rgba(249, 115, 22, 0.6)) drop-shadow(0 0 50px rgba(249, 115, 22, 0.3));
        }
        
        .glow-cyan {
          filter: drop-shadow(0 0 20px rgba(6, 182, 212, 0.5));
        }
        
        .glow-rose {
          filter: drop-shadow(0 0 20px rgba(244, 63, 94, 0.5));
        }
        
        .glow-emerald {
          filter: drop-shadow(0 0 20px rgba(16, 185, 129, 0.5));
        }
        
        .glow-violet {
          filter: drop-shadow(0 0 20px rgba(139, 69, 228, 0.5));
        }
        
        .glow-amber {
          filter: drop-shadow(0 0 20px rgba(245, 158, 11, 0.5));
        }
        
        .glow-teal {
          filter: drop-shadow(0 0 15px rgba(20, 184, 166, 0.4));
        }
        
        .glow-fuchsia {
          filter: drop-shadow(0 0 15px rgba(217, 70, 239, 0.4));
        }
        
        .glow-lime {
          filter: drop-shadow(0 0 15px rgba(132, 204, 22, 0.4));
        }
        
        .glow-sky {
          filter: drop-shadow(0 0 15px rgba(14, 165, 233, 0.4));
        }
        
        .glow-red {
          filter: drop-shadow(0 0 15px rgba(239, 68, 68, 0.4));
        }
        
        .glow-blue-light {
          filter: drop-shadow(0 0 12px rgba(147, 197, 253, 0.3));
        }
        
        .glow-purple-light {
          filter: drop-shadow(0 0 12px rgba(196, 181, 253, 0.3));
        }
        
        .delay-200 {
          animation-delay: 0.2s;
        }
        
        .delay-300 {
          animation-delay: 0.3s;
        }
        
        .delay-500 {
          animation-delay: 0.5s;
        }
      `})]})};export{xa as default};
//# sourceMappingURL=DiscountsPromotions-CzVp9_-P.js.map
