import{i as oe,r as E,p as Q,h as $,j as s,C as ae,f as P,c as ne,w as ie,a as le,b as ce,B as Z}from"./index-Bm67KBkU.js";import{a as V,b as O,f as U,B as he}from"./index-DkD_C-d1.js";import{p as ee}from"./useLeadsData-nt_JwR0P.js";import{D as de}from"./dollar-sign-CKqx8kbC.js";import{T as ue}from"./target-BmxdxojS.js";import{T as G,C as ge}from"./googleAuth-BGo8ElRc.js";import{U as ve}from"./user-check-CLHYCjic.js";import{A as pe}from"./award-D0x2LQSI.js";import{U as be}from"./user-plus-B5fZWJk_.js";import{U as me}from"./users-7Ku-1TDB.js";import{T as J}from"./trending-down-B5K1omnR.js";import{C as xe}from"./CopyTableButton-Blm2CDq4.js";import{A as te}from"./arrow-up-down-DaenedAL.js";const re=oe("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);const se=oe("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]),M=(m,j)=>{if(j===0)return{rate:m>0?100:0,isSignificant:m>0,trend:m>0?"moderate":"weak"};const C=(m-j)/j*100,g=Math.abs(C);let A;return C>0?A=g>20?"strong":g>5?"moderate":"weak":A=g>20?"weak":g>5?"moderate":"weak",{rate:C,isSignificant:g>2,trend:A}};function fe(m=[],j,C){return E.useMemo(()=>{const g=j&&j.length>0?j:m,A=C?.dateRange?.end?typeof C.dateRange.end=="string"?new Date(C.dateRange.end):C.dateRange.end:new Date,R=c=>new Date(c.getFullYear(),c.getMonth(),1),H=c=>new Date(c.getFullYear(),c.getMonth()+1,0,23,59,59,999),v=R(A),D=H(A),F=new Date(v.getFullYear(),v.getMonth()-1,15),B=R(F),z=H(F),I=c=>c.toLocaleDateString(void 0,{month:"short",year:"numeric"}),k=`${I(v)} vs ${I(B)}`,p=(c,N,X)=>!!(c&&N&&X&&c>=N&&c<=X),y=g.filter(c=>p(Q(c.firstVisitDate),v,D)),u=g.filter(c=>p(Q(c.firstVisitDate),B,z)),d=c=>String(c.isNew||"").toLowerCase().includes("new"),f=c=>c.conversionStatus==="Converted",b=c=>c.retentionStatus==="Retained",w=y.filter(d).length,S=y.filter(f).length,Y=y.filter(b).length,e=u.filter(d).length,t=u.filter(f).length,r=u.filter(b).length,a=w>0?S/w*100:0,o=e>0?t/e*100:0,n=w>0?Y/w*100:0,l=e>0?r/e*100:0,x=y.reduce((c,N)=>c+(N.ltv||0),0),T=u.reduce((c,N)=>c+(N.ltv||0),0),h=y.length>0?x/y.length:0,L=u.length>0?T/u.length:0,W=new Date(v.getFullYear()-1,v.getMonth(),15),_=R(W),K=H(W),i=g.filter(c=>p(Q(c.firstVisitDate),_,K));return{metrics:[{title:"New Members",value:V(w),rawValue:w,change:M(w,e).rate,changeDetails:M(w,e),previousValue:V(e),previousRawValue:e,yoyPreviousValue:V(i.filter(d).length),yoyPreviousRawValue:i.filter(d).length,yoyChange:M(w,i.filter(d).length).rate,comparison:{current:w,previous:i.filter(d).length,difference:w-i.filter(d).length},periodLabel:k,icon:"UserPlus",description:"Recently acquired clients"},{title:"Converted Members",value:V(S),rawValue:S,change:M(S,t).rate,changeDetails:M(S,t),previousValue:V(t),previousRawValue:t,yoyPreviousValue:V(i.filter(f).length),yoyPreviousRawValue:i.filter(f).length,yoyChange:M(S,i.filter(f).length).rate,comparison:{current:S,previous:i.filter(f).length,difference:S-i.filter(f).length},periodLabel:k,icon:"Award",description:"Trial to paid conversions"},{title:"Retained Members",value:V(Y),rawValue:Y,change:M(Y,r).rate,changeDetails:M(Y,r),previousValue:V(r),previousRawValue:r,yoyPreviousValue:V(i.filter(b).length),yoyPreviousRawValue:i.filter(b).length,yoyChange:M(Y,i.filter(b).length).rate,comparison:{current:Y,previous:i.filter(b).length,difference:Y-i.filter(b).length},periodLabel:k,icon:"UserCheck",description:"Active retained clients"},{title:"Conversion Rate",value:O(a),rawValue:a,change:M(a,o).rate,changeDetails:M(a,o),previousValue:O(o),previousRawValue:o,yoyPreviousValue:O(i.length>0?i.filter(f).length/i.filter(d).length*100:0),yoyPreviousRawValue:i.length>0?i.filter(f).length/i.filter(d).length*100:0,yoyChange:M(a,i.length>0?i.filter(f).length/i.filter(d).length*100:0).rate,comparison:{current:a,previous:i.length>0?i.filter(f).length/i.filter(d).length*100:0,difference:a-(i.length>0?i.filter(f).length/i.filter(d).length*100:0)},periodLabel:k,icon:"TrendingUp",description:"New to converted rate"},{title:"Retention Rate",value:O(n),rawValue:n,change:M(n,l).rate,changeDetails:M(n,l),previousValue:O(l),previousRawValue:l,yoyPreviousValue:O(i.length>0?i.filter(b).length/i.filter(d).length*100:0),yoyPreviousRawValue:i.length>0?i.filter(b).length/i.filter(d).length*100:0,yoyChange:M(n,i.length>0?i.filter(b).length/i.filter(d).length*100:0).rate,comparison:{current:n,previous:i.length>0?i.filter(b).length/i.filter(d).length*100:0,difference:n-(i.length>0?i.filter(b).length/i.filter(d).length*100:0)},periodLabel:k,icon:"Target",description:"Member retention rate"},{title:"Avg LTV",value:U(h),rawValue:h,change:M(h,L).rate,changeDetails:M(h,L),previousValue:U(L),previousRawValue:L,yoyPreviousValue:U(i.length>0?i.reduce((c,N)=>c+(N.ltv||0),0)/i.length:0),yoyPreviousRawValue:i.length>0?i.reduce((c,N)=>c+(N.ltv||0),0)/i.length:0,yoyChange:M(h,i.length>0?i.reduce((c,N)=>c+(N.ltv||0),0)/i.length:0).rate,comparison:{current:h,previous:i.length>0?i.reduce((c,N)=>c+(N.ltv||0),0)/i.length:0,difference:h-(i.length>0?i.reduce((c,N)=>c+(N.ltv||0),0)/i.length:0)},periodLabel:k,icon:"DollarSign",description:"Average lifetime value"}]}},[m,j,C?.dateRange?.start,C?.dateRange?.end])}const we=({data:m,historicalData:j,dateRange:C,onCardClick:g})=>{const{metrics:A}=fe(m,j,{dateRange:C});$.useEffect(()=>{},[A]);const[R,H]=$.useState(!1),v=$.useMemo(()=>{const e=m.filter(t=>t.conversionSpan&&t.conversionSpan>0);return e.length===0?0:e.reduce((t,r)=>t+(r.conversionSpan||0),0)/e.length},[m]),D=$.useMemo(()=>{const e=m.filter(t=>t.visitsPostTrial&&t.visitsPostTrial>0);return e.length===0?0:e.reduce((t,r)=>t+(r.visitsPostTrial||0),0)/e.length},[m]),F=(e,t)=>{const r=e.filter(o=>o[t]!==void 0&&o[t]!==null&&o[t]>=0);return r.length===0?0:r.reduce((o,n)=>o+(n[t]||0),0)/r.length},B=()=>{const e=C?.end?typeof C.end=="string"?new Date(C.end):C.end:new Date,t=L=>new Date(L.getFullYear(),L.getMonth(),1),r=L=>new Date(L.getFullYear(),L.getMonth()+1,0,23,59,59,999),a=t(e),o=new Date(a.getFullYear(),a.getMonth()-1,15),n=t(o),l=r(o),x=new Date(a.getFullYear()-1,a.getMonth(),15),T=t(x),h=r(x);return{prevStart:n,prevEnd:l,prevYearStart:T,prevYearEnd:h}},{prevStart:z,prevEnd:I,prevYearStart:k,prevYearEnd:p}=B(),y=$.useMemo(()=>j?j.filter(e=>{const t=ee(e.firstVisitDate);return t&&t>=z&&t<=I}):[],[j,z,I]),u=$.useMemo(()=>j?j.filter(e=>{const t=ee(e.firstVisitDate);return t&&t>=k&&t<=p}):[],[j,k,p]),d=$.useMemo(()=>F(y,"conversionSpan"),[y]),f=$.useMemo(()=>F(u,"conversionSpan"),[u]),b=$.useMemo(()=>F(y,"visitsPostTrial"),[y]),w=$.useMemo(()=>F(u,"visitsPostTrial"),[u]);$.useEffect(()=>{},[u,f,w,v,D]);const S={"New Members":be,"Converted Members":pe,"Retained Members":ve,"Conversion Rate":G,"Retention Rate":ue,"Avg LTV":de,"Avg Conversion Time":re,"Avg Visits Post-Trial":se},Y=[...A.map(e=>({title:e.title,value:e.value,icon:S[e.title]||me,gradient:"from-slate-700 to-slate-800",description:e.description,change:e.change,previousValue:e.previousValue,period:e.periodLabel||"vs previous month",metricType:e.title.toLowerCase().replace(/\s+/g,"_"),yoyPreviousValue:e.yoyPreviousValue,yoyPreviousRawValue:e.yoyPreviousRawValue,yoyChange:e.yoyChange,comparison:e.comparison,changeDetails:e.changeDetails,filterData:()=>{switch(e.title){case"New Members":return m.filter(t=>String(t.isNew||"").toLowerCase().includes("new"));case"Converted Members":return m.filter(t=>t.conversionStatus==="Converted");case"Retained Members":return m.filter(t=>t.retentionStatus==="Retained");default:return m}}})),{title:"Avg Conversion Time",value:`${Math.round(v)} days`,rawValue:v,icon:re,gradient:"from-slate-700 to-slate-800",description:"Average days to convert",change:d>0?Math.round((v-d)/(d||1)*100):0,previousValue:`${Math.round(d)} days`,period:"",metricType:"avg_conversion_time",yoyPreviousValue:u.length>0?`${Math.round(f)} days`:void 0,yoyPreviousRawValue:f,yoyChange:u.length>0?f===0?v>0?100:0:Math.round((v-f)/(f||1)*100):void 0,comparison:{current:v,previous:f||0,difference:v-(f||0)},changeDetails:{rate:d>0?Math.round((v-d)/(d||1)*100):0,isSignificant:Math.abs(v-d)>1,trend:v>d?"moderate":"weak"},filterData:()=>m.filter(e=>e.conversionSpan&&e.conversionSpan>0)},{title:"Avg Visits Post-Trial",value:D.toFixed(1),rawValue:D,icon:se,gradient:"from-slate-700 to-slate-800",description:"Average visits after trial",change:b>0?Math.round((D-b)/(b||1)*100):0,previousValue:b.toFixed(1),yoyPreviousValue:u.length>0?w.toFixed(1):void 0,yoyPreviousRawValue:w,yoyChange:u.length>0?w===0?D>0?100:0:Math.round((D-w)/(w||1)*100):void 0,comparison:{current:D,previous:w||0,difference:D-(w||0)},changeDetails:{rate:b>0?Math.round((D-b)/(b||1)*100):0,isSignificant:Math.abs(D-b)>.1,trend:D>b?"moderate":"weak"},filterData:()=>m.filter(e=>e.visitsPostTrial&&e.visitsPostTrial>0)}];return s.jsxs("div",{className:"container mx-auto px-6 py-8",children:[s.jsx("div",{className:"flex justify-end mb-3",children:s.jsxs("button",{onClick:()=>H(e=>!e),className:"text-xs text-slate-500 hover:text-slate-800",children:[R?"Hide":"Show"," metrics JSON"]})}),R&&s.jsx("pre",{className:"p-4 bg-slate-50 rounded mb-4 text-xs text-slate-700 overflow-auto max-h-80",children:JSON.stringify(A,null,2)}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:Y.map((e,t)=>{const r=e.icon;return typeof e.change=="number"&&e.change,s.jsx(ae,{className:P("group relative overflow-hidden cursor-pointer transition-all duration-500 h-full flex flex-col","bg-white hover:bg-gradient-to-br hover:from-slate-900 hover:via-slate-900 hover:to-slate-950","border border-slate-200 hover:border-slate-800 border-t-4","shadow-md hover:shadow-2xl hover:shadow-slate-950/60","hover:-translate-y-1 hover:scale-[1.01]",t%4===0&&"border-t-emerald-500",t%4===1&&"border-t-blue-500",t%4===2&&"border-t-purple-500",t%4===3&&"border-t-rose-500",g&&"hover:cursor-pointer"),onClick:()=>g?.(e.title,e.filterData(),e.metricType),children:s.jsxs(ne,{className:"p-5 relative flex-1 flex flex-col",children:[s.jsx("div",{className:P("absolute inset-0 opacity-[0.03] group-hover:opacity-[0.08] transition-all duration-500",t%4===0&&"bg-gradient-to-br from-emerald-500 to-teal-500",t%4===1&&"bg-gradient-to-br from-blue-500 to-cyan-500",t%4===2&&"bg-gradient-to-br from-purple-500 to-pink-500",t%4===3&&"bg-gradient-to-br from-rose-500 to-orange-500")}),s.jsx("div",{className:"absolute top-3 right-3 opacity-[0.08] group-hover:opacity-[0.15] transition-all duration-700 ease-out group-hover:scale-110 group-hover:rotate-6",children:s.jsx(r,{className:"w-20 h-20 text-slate-900 group-hover:text-white"})}),s.jsx("div",{className:"absolute inset-0 opacity-[0.02] group-hover:opacity-[0.04] transition-opacity duration-500",style:{backgroundImage:"radial-gradient(circle at 2px 2px, currentColor 1px, transparent 0)",backgroundSize:"24px 24px"}}),s.jsxs("div",{className:"relative z-10 space-y-2.5",children:[s.jsx("div",{className:"flex items-start justify-between",children:s.jsxs("div",{className:"flex items-center gap-2.5",children:[s.jsx("div",{className:P("p-2.5 rounded-xl shadow-sm transition-all duration-500 group-hover:scale-110 group-hover:shadow-md",t%4===0&&"bg-gradient-to-br from-emerald-500/15 to-emerald-600/10 text-emerald-700 group-hover:from-emerald-500/25 group-hover:to-emerald-600/20 group-hover:text-emerald-400 group-hover:shadow-emerald-500/20",t%4===1&&"bg-gradient-to-br from-blue-500/15 to-blue-600/10 text-blue-700 group-hover:from-blue-500/25 group-hover:to-blue-600/20 group-hover:text-blue-400 group-hover:shadow-blue-500/20",t%4===2&&"bg-gradient-to-br from-purple-500/15 to-purple-600/10 text-purple-700 group-hover:from-purple-500/25 group-hover:to-purple-600/20 group-hover:text-purple-400 group-hover:shadow-purple-500/20",t%4===3&&"bg-gradient-to-br from-rose-500/15 to-rose-600/10 text-rose-700 group-hover:from-rose-500/25 group-hover:to-rose-600/20 group-hover:text-rose-400 group-hover:shadow-rose-500/20"),children:s.jsx(r,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("h3",{className:P("font-bold text-sm text-slate-700 transition-all duration-500 leading-tight","group-hover:text-white group-hover:underline group-hover:underline-offset-4 group-hover:decoration-2",t%4===0&&"group-hover:decoration-emerald-400",t%4===1&&"group-hover:decoration-blue-400",t%4===2&&"group-hover:decoration-purple-400",t%4===3&&"group-hover:decoration-rose-400"),children:e.title}),s.jsx("p",{className:"text-[9px] text-slate-500 group-hover:text-slate-400 transition-colors duration-500 mt-0.5 uppercase tracking-wide font-semibold",children:"Current Period"})]})]})}),s.jsxs("div",{className:P("p-2.5 rounded-lg transition-all duration-500","bg-slate-50 group-hover:bg-slate-800/30","border border-slate-100 group-hover:border-slate-700/50"),children:[s.jsx("p",{className:"text-3xl font-bold text-slate-900 group-hover:text-white transition-colors duration-500 tracking-tight",children:e.value}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsx("div",{className:P("h-0.5 flex-1 rounded-full transition-all duration-500",e.change>0&&"bg-emerald-200 group-hover:bg-emerald-500/40",e.change<0&&"bg-rose-200 group-hover:bg-rose-500/40",e.change===0&&"bg-slate-200 group-hover:bg-slate-500/40")}),s.jsxs("div",{className:"flex items-center gap-1",children:[e.change>0&&s.jsx(G,{className:"w-3 h-3 text-emerald-600 group-hover:text-emerald-400"}),e.change<0&&s.jsx(J,{className:"w-3 h-3 text-rose-600 group-hover:text-rose-400"}),e.change===0&&s.jsx(J,{className:"w-3 h-3 text-slate-600 group-hover:text-slate-400"}),s.jsx("span",{className:P("text-[10px] font-bold transition-colors duration-500",e.change>0&&"text-emerald-600 group-hover:text-emerald-400",e.change<0&&"text-rose-600 group-hover:text-rose-400",e.change===0&&"text-slate-600 group-hover:text-slate-400"),children:e.changeDetails?.trend||(e.change>0?"up":e.change<0?"down":"stable")})]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-auto",children:[s.jsxs("div",{className:P("p-2.5 rounded-lg border transition-all duration-500 min-h-[100px] flex flex-col justify-between","bg-white/50 group-hover:bg-slate-800/20","border-slate-200 group-hover:border-slate-700/50"),children:[s.jsx("div",{className:"text-[9px] font-bold text-slate-500 group-hover:text-slate-400 uppercase tracking-wider mb-1 transition-colors duration-500",children:"Month over Month"}),s.jsxs("div",{className:"flex items-baseline gap-1.5 mb-1.5",children:[s.jsx("span",{className:"text-sm font-bold text-slate-700 group-hover:text-white transition-colors duration-500 tabular-nums",children:e.previousValue}),s.jsx("span",{className:"text-[8px] text-slate-400 group-hover:text-slate-500 transition-colors duration-500",children:"prev"})]}),s.jsxs("div",{className:P("inline-flex items-center justify-center gap-1 px-3 py-1.5 rounded-lg font-bold text-[11px] tabular-nums transition-all duration-500 min-w-[65px]",e.change>0&&"bg-emerald-900/90 text-white group-hover:bg-emerald-800 group-hover:shadow-lg group-hover:shadow-emerald-900/40",e.change<0&&"bg-rose-900/90 text-white group-hover:bg-rose-800 group-hover:shadow-lg group-hover:shadow-rose-900/40",e.change===0&&"bg-slate-700/90 text-white group-hover:bg-slate-600 group-hover:shadow-lg"),children:[e.change>0&&s.jsx(G,{className:"w-3.5 h-3.5 flex-shrink-0"}),e.change<0&&s.jsx(J,{className:"w-3.5 h-3.5 flex-shrink-0"}),s.jsxs("span",{children:[e.change>0?"+":"",Math.round(e.change||0),"%"]})]})]}),s.jsx("div",{className:P("p-2.5 rounded-lg border transition-all duration-500 min-h-[100px] flex flex-col justify-between",e.yoyChange!==void 0?"bg-white/50 group-hover:bg-slate-800/20 border-slate-200 group-hover:border-slate-700/50":"bg-slate-50/50 group-hover:bg-slate-800/10 border-slate-200 group-hover:border-slate-700/30"),children:e.yoyPreviousValue!==void 0||e.comparison?.previous!==void 0?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-[9px] font-bold text-slate-500 group-hover:text-slate-400 uppercase tracking-wider mb-1 transition-colors duration-500",children:"Year over Year"}),s.jsxs("div",{className:"flex items-baseline gap-1.5 mb-1.5",children:[s.jsx("span",{className:"text-sm font-bold text-slate-700 group-hover:text-white transition-colors duration-500 tabular-nums",children:e.yoyPreviousValue??(e.comparison?.previous!==void 0?e.title.toLowerCase().includes("rate")||e.title.toLowerCase().includes("conversion")?O(e.comparison.previous):e.title.toLowerCase().includes("ltv")||e.title.toLowerCase().includes("revenue")?U(e.comparison.previous):V(e.comparison.previous):"—")}),s.jsx("span",{className:"text-[8px] text-slate-400 group-hover:text-slate-500 transition-colors duration-500",children:"last year"})]}),s.jsxs("div",{className:P("inline-flex items-center justify-center gap-1 px-3 py-1.5 rounded-lg font-bold text-[11px] tabular-nums transition-all duration-500 min-w-[65px]",e.yoyChange>0&&"bg-emerald-900/90 text-white group-hover:bg-emerald-800 group-hover:shadow-lg group-hover:shadow-emerald-900/40",e.yoyChange<0&&"bg-rose-900/90 text-white group-hover:bg-rose-800 group-hover:shadow-lg group-hover:shadow-rose-900/40",e.yoyChange===0&&"bg-slate-700/90 text-white group-hover:bg-slate-600 group-hover:shadow-lg"),children:[e.yoyChange>0&&s.jsx(G,{className:"w-3.5 h-3.5 flex-shrink-0"}),e.yoyChange<0&&s.jsx(J,{className:"w-3.5 h-3.5 flex-shrink-0"}),s.jsxs("span",{children:[e.yoyChange>0?"+":"",Math.round(e.yoyChange||0),"%"]})]})]}):s.jsx("span",{className:"text-[9px] text-slate-400 group-hover:text-slate-500 transition-colors duration-500 font-semibold",children:"No YoY Data"})})]}),s.jsx("div",{className:P("relative pt-1.5 border-l-3 pl-3 transition-all duration-500","before:absolute before:left-0 before:top-0 before:w-1 before:h-full before:rounded-r-full before:transition-all before:duration-500",t%4===0&&"border-l-emerald-500/50 group-hover:border-l-emerald-400 before:bg-emerald-500/20 group-hover:before:bg-emerald-400/30",t%4===1&&"border-l-blue-500/50 group-hover:border-l-blue-400 before:bg-blue-500/20 group-hover:before:bg-blue-400/30",t%4===2&&"border-l-purple-500/50 group-hover:border-l-purple-400 before:bg-purple-500/20 group-hover:before:bg-purple-400/30",t%4===3&&"border-l-rose-500/50 group-hover:border-l-rose-400 before:bg-rose-500/20 group-hover:before:bg-rose-400/30"),children:s.jsx("p",{className:"text-xs text-slate-600 group-hover:text-slate-300 leading-snug transition-colors duration-500 line-clamp-2 font-medium",children:e.description})}),s.jsx("div",{className:P("pt-2 space-y-2 border-t transition-all duration-500 overflow-hidden","max-h-0 opacity-0 group-hover:max-h-40 group-hover:opacity-100",t%4===0&&"border-emerald-200 group-hover:border-emerald-500/30",t%4===1&&"border-blue-200 group-hover:border-blue-500/30",t%4===2&&"border-purple-200 group-hover:border-purple-500/30",t%4===3&&"border-rose-200 group-hover:border-rose-500/30"),children:s.jsxs("div",{className:"text-xs space-y-1",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-slate-400 font-medium",children:"Trend:"}),s.jsx("span",{className:"text-white font-semibold",children:e.changeDetails?.trend||""})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-slate-400 font-medium",children:"Difference:"}),s.jsx("span",{className:"text-white font-semibold",children:Math.abs(e.comparison?.difference||0)})]})]})})]})]})},t)})})]})},Ae=$.memo(we),q={trials:"Trials",newMembers:"New Members",converted:"Converted",retained:"Retained",retentionRate:"Retention %",conversionRate:"Conversion %",avgLTV:"Avg LTV",totalLTV:"Total LTV",avgConversionDays:"Avg Conv Days",avgVisits:"Avg Visits"},Ye=({data:m,visitsSummary:j,onRowClick:C})=>{const[g,A]=E.useState("trials"),[R,H]=E.useState("values"),[v,D]=E.useState(null),[F,B]=E.useState("desc"),z=E.useRef(null),I=ie(),k="Client Retention MoM by Type Pivot",p=E.useMemo(()=>{const e=[],t=new Date,r=t.getMonth(),o=(t.getFullYear()-2024)*12+r;for(let n=0;n<=o;n++){const l=new Date(2024,n,1),x=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}`,T=l.toLocaleDateString("en-US",{month:"short",year:"2-digit"});e.push({key:x,label:T,year:l.getFullYear(),month:l.getMonth()+1})}return e},[]),y=E.useMemo(()=>{const e=new Set;return m.forEach(t=>e.add(t.isNew||"Unknown")),Array.from(e).sort((t,r)=>{const a=t.toLowerCase(),o=r.toLowerCase();return a.includes("new")&&!o.includes("new")?-1:!a.includes("new")&&o.includes("new")?1:t.localeCompare(r)})},[m]),u=E.useMemo(()=>{const e={};return y.forEach(t=>{e[t]={},p.forEach((r,a)=>{const n=new Date(r.year,r.month-1,1).toLocaleDateString("en-US",{month:"short",year:"numeric"});e[t][r.key]={trials:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],visitsPostTrial:[],visits:j?.[n]||0,previous:a<p.length-1?null:void 0,clients:[]}})}),m.forEach(t=>{const r=Q(t.firstVisitDate||"");if(!r)return;const a=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`;if(!p.find(l=>l.key===a))return;const o=t.isNew||"Unknown",n=e[o]?.[a];n&&(n.trials+=1,(t.isNew||"").toLowerCase().includes("new")&&(n.newMembers+=1),t.conversionStatus==="Converted"&&(n.converted+=1),t.retentionStatus==="Retained"&&(n.retained+=1),n.totalLTV+=t.ltv||0,t.conversionSpan&&t.conversionSpan>0&&n.conversionIntervals.push(t.conversionSpan),t.visitsPostTrial&&t.visitsPostTrial>0&&n.visitsPostTrial.push(t.visitsPostTrial),n.clients.push(t))}),y.forEach(t=>{p.forEach((r,a)=>{const o=e[t][r.key],n=o.trials>0?o.totalLTV/o.trials:0,l=o.conversionIntervals.length>0?o.conversionIntervals.reduce((_,K)=>_+K,0)/o.conversionIntervals.length:0,x=o.visitsPostTrial.length>0?o.visitsPostTrial.reduce((_,K)=>_+K,0)/o.visitsPostTrial.length:0,T=o.newMembers>0?o.converted/o.newMembers*100:0,h=o.newMembers>0?o.retained/o.newMembers*100:0,L=p[a+1]?.key,W=L?e[t][L]:null;e[t][r.key]={...o,avgLTV:n,avgConversionDays:l,avgVisits:x,conversionRate:T,retentionRate:h,previous:W}})}),e},[m,y,p,j]),d=(e,t)=>{let r;switch(g){case"trials":r=V(e.trials||0);break;case"newMembers":r=V(e.newMembers||0);break;case"converted":r=V(e.converted||0);break;case"retained":r=V(e.retained||0);break;case"retentionRate":r=`${(e.retentionRate||0).toFixed(1)}%`;break;case"conversionRate":r=`${(e.conversionRate||0).toFixed(1)}%`;break;case"avgLTV":r=U(e.avgLTV||0);break;case"totalLTV":r=U(e.totalLTV||0);break;case"avgConversionDays":r=`${Math.round(e.avgConversionDays||0)}`;break;case"avgVisits":r=(e.avgVisits||0).toFixed(1);break;default:r="0"}if(R==="growth"&&t<p.length-1){const a=e.previous;if(!a)return s.jsx("span",{className:"text-slate-400 text-xs",children:"—"});let o=0,n=0;switch(g){case"trials":o=e.trials||0,n=a.trials||0;break;case"newMembers":o=e.newMembers||0,n=a.newMembers||0;break;case"converted":o=e.converted||0,n=a.converted||0;break;case"retained":o=e.retained||0,n=a.retained||0;break;case"retentionRate":o=e.retentionRate||0,n=a.retentionRate||0;break;case"conversionRate":o=e.conversionRate||0,n=a.conversionRate||0;break;case"avgLTV":o=e.avgLTV||0,n=a.avgLTV||0;break;case"totalLTV":o=e.totalLTV||0,n=a.totalLTV||0;break;case"avgConversionDays":o=e.avgConversionDays||0,n=a.avgConversionDays||0;break;case"avgVisits":o=e.avgVisits||0,n=a.avgVisits||0;break}const l=n!==0?(o-n)/n*100:0,x=l>=0;return s.jsxs("span",{className:`text-xs font-semibold ${x?"text-emerald-600":"text-rose-600"}`,children:[x?"▲":"▼"," ",Math.abs(l).toFixed(1),"%"]})}return s.jsx("span",{className:"text-sm font-medium text-slate-800",children:r})},f=(e,t)=>{let r;switch(g){case"trials":r=V(e.trials||0);break;case"newMembers":r=V(e.newMembers||0);break;case"converted":r=V(e.converted||0);break;case"retained":r=V(e.retained||0);break;case"retentionRate":r=`${(e.retentionRate||0).toFixed(1)}%`;break;case"conversionRate":r=`${(e.conversionRate||0).toFixed(1)}%`;break;case"avgLTV":r=U(e.avgLTV||0);break;case"totalLTV":r=U(e.totalLTV||0);break;case"avgConversionDays":r=`${Math.round(e.avgConversionDays||0)}`;break;case"avgVisits":r=(e.avgVisits||0).toFixed(1);break;default:r="0"}if(R==="growth"&&t<p.length-1){const a=e.previous;if(!a)return s.jsx("span",{className:"text-white/60 text-xs",children:"—"});let o=0,n=0;switch(g){case"trials":o=e.trials||0,n=a.trials||0;break;case"newMembers":o=e.newMembers||0,n=a.newMembers||0;break;case"converted":o=e.converted||0,n=a.converted||0;break;case"retained":o=e.retained||0,n=a.retained||0;break;case"retentionRate":o=e.retentionRate||0,n=a.retentionRate||0;break;case"conversionRate":o=e.conversionRate||0,n=a.conversionRate||0;break;case"avgLTV":o=e.avgLTV||0,n=a.avgLTV||0;break;case"totalLTV":o=e.totalLTV||0,n=a.totalLTV||0;break;case"avgConversionDays":o=e.avgConversionDays||0,n=a.avgConversionDays||0;break;case"avgVisits":o=e.avgVisits||0,n=a.avgVisits||0;break}const l=n!==0?(o-n)/n*100:0,x=l>=0;return s.jsxs("span",{className:"text-xs font-semibold text-white",children:[x?"▲":"▼"," ",Math.abs(l).toFixed(1),"%"]})}return s.jsx("span",{className:"text-sm font-medium text-white",children:r})},b=E.useMemo(()=>v?[...y].sort((t,r)=>{if(v==="type")return t.localeCompare(r);const a=u[t]?.[v],o=u[r]?.[v];if(!a||!o)return 0;let n=0,l=0;switch(g){case"trials":n=a.trials||0,l=o.trials||0;break;case"newMembers":n=a.newMembers||0,l=o.newMembers||0;break;case"converted":n=a.converted||0,l=o.converted||0;break;case"retained":n=a.retained||0,l=o.retained||0;break;case"retentionRate":n=a.retentionRate||0,l=o.retentionRate||0;break;case"conversionRate":n=a.conversionRate||0,l=o.conversionRate||0;break;case"avgLTV":n=a.avgLTV||0,l=o.avgLTV||0;break;case"totalLTV":n=a.totalLTV||0,l=o.totalLTV||0;break;case"avgConversionDays":n=a.avgConversionDays||0,l=o.avgConversionDays||0;break;case"avgVisits":n=a.avgVisits||0,l=o.avgVisits||0;break}return F==="desc"?l-n:n-l}):y,[y,v,F,u,g]),w=e=>{v===e?B(t=>t==="desc"?"asc":"desc"):(D(e),B("desc"))},S=E.useMemo(()=>{const e={};return p.forEach(t=>{const r={trials:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],visitsPostTrial:[],clients:[]};y.forEach(T=>{const h=u[T]?.[t.key];h&&(r.trials+=h.trials||0,r.newMembers+=h.newMembers||0,r.converted+=h.converted||0,r.retained+=h.retained||0,r.totalLTV+=h.totalLTV||0,r.conversionIntervals.push(...h.conversionIntervals||[]),r.visitsPostTrial.push(...h.visitsPostTrial||[]),r.clients.push(...h.clients||[]))});const a=r.trials>0?r.totalLTV/r.trials:0,o=r.conversionIntervals.length>0?r.conversionIntervals.reduce((T,h)=>T+h,0)/r.conversionIntervals.length:0,n=r.visitsPostTrial.length>0?r.visitsPostTrial.reduce((T,h)=>T+h,0)/r.visitsPostTrial.length:0,l=r.newMembers>0?r.converted/r.newMembers*100:0,x=r.newMembers>0?r.retained/r.newMembers*100:0;e[t.key]={...r,avgLTV:a,avgConversionDays:o,avgVisits:n,conversionRate:l,retentionRate:x}}),e},[u,y,p]),Y=E.useCallback(()=>{const e=[];e.push(`${k} - All Metrics Export`),e.push(`Exported on ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}`),e.push("");const t=Object.keys(q),r=(a,o)=>{switch(a){case"trials":return V(o?.trials||0);case"newMembers":return V(o?.newMembers||0);case"converted":return V(o?.converted||0);case"retained":return V(o?.retained||0);case"retentionRate":return`${(o?.retentionRate||0).toFixed(1)}%`;case"conversionRate":return`${(o?.conversionRate||0).toFixed(1)}%`;case"avgLTV":return U(o?.avgLTV||0);case"totalLTV":return U(o?.totalLTV||0);case"avgConversionDays":return`${Math.round(o?.avgConversionDays||0)}`;case"avgVisits":return`${(o?.avgVisits||0).toFixed(1)}`}};return t.forEach(a=>{e.push(`
${q[a].toUpperCase()}`);const o=["Client Type",...p.map(l=>l.label)];e.push(o.join("	")),e.push(o.map(()=>"---").join("	")),y.forEach(l=>{const x=[l];p.forEach(T=>{const h=u[l]?.[T.key];x.push(r(a,h))}),e.push(x.join("	"))});const n=["TOTALS"];p.forEach(l=>{const x=S[l.key];n.push(r(a,x))}),e.push(n.join("	"))}),e.join(`
`)},[y,p,u,S,k]);return E.useEffect(()=>{if(!I)return;const e=z.current;if(!e)return;const t=()=>{const r=e.querySelector("table");if(!r)return`${k} (No Data)`;let a=`${k}
Metric: ${q[g]} | Mode: ${R}
`;const o=r.querySelectorAll("thead th"),n=[];return o.forEach(x=>n.push((x.textContent||"").trim().replace(/Prev \| Curr/i,"").trim())),n.length&&(a+=n.join("	")+`
`,a+=n.map(()=>"---").join("	")+`
`),r.querySelectorAll("tbody tr").forEach(x=>{const T=x.querySelectorAll("td"),h=[];T.forEach(L=>h.push((L.textContent||"").trim())),h.length&&(a+=h.join("	")+`
`)}),a.trim()};return I.register({id:k,getTextContent:t}),()=>I.unregister(k)},[I,g,R,u,b]),s.jsxs(ae,{ref:z,className:"bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-shadow duration-300",children:[s.jsx("div",{className:"absolute inset-x-0 top-0 h-1.5 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"}),s.jsx(le,{className:"border-b border-gray-100 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white pt-4",children:s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs(ce,{className:"flex items-center gap-2",children:[s.jsx(ge,{className:"w-5 h-5"}),"Month-on-Month by Client Type",s.jsx(he,{variant:"secondary",className:"bg-white/20 text-white",children:"Last 22 months"}),s.jsx("div",{className:"ml-4",children:s.jsx(xe,{tableRef:z,tableName:k,size:"sm",onCopyAllTabs:async()=>Y()})})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Z,{size:"sm",variant:R==="values"?"default":"outline",onClick:()=>H("values"),className:R==="values"?"bg-gradient-to-r from-slate-700 to-slate-800 text-white hover:from-slate-600 hover:to-slate-700":"bg-white/10 text-white hover:bg-white/20 border-white/30",children:"Values"}),s.jsx(Z,{size:"sm",variant:R==="growth"?"default":"outline",onClick:()=>H("growth"),className:R==="growth"?"bg-gradient-to-r from-slate-700 to-slate-800 text-white hover:from-slate-600 hover:to-slate-700":"bg-white/10 text-white hover:bg-white/20 border-white/30",children:"Growth %"})]})]}),s.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:Object.keys(q).map(e=>s.jsx("button",{onClick:()=>A(e),className:`px-3 py-1.5 rounded-md text-xs font-semibold transition-all min-w-[90px] ${g===e?"bg-white text-indigo-700 shadow-md":"bg-white/10 text-white hover:bg-white/20"}`,title:q[e],children:q[e]},e))})]})}),s.jsx(ne,{className:"p-0",children:s.jsx("div",{className:"overflow-x-auto max-h-[900px] relative",children:s.jsxs("table",{className:"min-w-full relative",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-gradient-to-r from-purple-900 via-purple-950 to-purple-900 text-white sticky top-0 z-10",style:{maxHeight:"35px"},children:[s.jsx("th",{className:"px-4 py-3 text-left sticky left-0 z-30 font-bold text-xs uppercase tracking-wide cursor-pointer select-none border-r border-white/20 bg-purple-900",onClick:()=>w("type"),style:{width:"300px",minWidth:"300px",maxHeight:"35px"},children:s.jsxs("div",{className:"flex items-center gap-1",children:["Client Type",s.jsx(te,{className:"w-3 h-3"})]})}),p.map(e=>s.jsx("th",{className:"px-3 py-3 text-center font-bold text-xs uppercase tracking-wide border-l border-white/20 cursor-pointer hover:bg-purple-800/50 select-none sticky top-0",onClick:()=>w(e.key),style:{width:"100px",minWidth:"100px",maxHeight:"35px"},children:s.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-xs font-bold whitespace-nowrap",children:e.label.split(" ")[0]}),s.jsx(te,{className:"w-3 h-3"})]}),s.jsx("span",{className:"text-white/80 text-[10px]",children:e.label.split(" ")[1]})]})},e.key))]})}),s.jsxs("tbody",{children:[b.map(e=>s.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50 cursor-pointer transition-colors",style:{maxHeight:"35px"},onClick:()=>{const r=p.map(a=>u[e]?.[a.key]).filter(Boolean).flatMap(a=>a.clients||[]);C?.({type:e,data:u[e],metric:g,clients:r})},children:[s.jsx("td",{className:"px-4 py-2 text-sm font-semibold text-slate-800 sticky left-0 bg-white z-20 border-r",style:{maxHeight:"35px"},children:e}),p.map((t,r)=>{const a=u[e]?.[t.key]||{};return s.jsx("td",{className:"px-2 py-2 text-center border-l",style:{maxHeight:"35px"},onClick:o=>{o.stopPropagation(),C?.({type:e,month:t.label,data:a,metric:g,clients:a.clients||[]})},children:d(a,r)},t.key)})]},e)),s.jsxs("tr",{className:"bg-slate-800 font-bold border-t-4 border-slate-600",style:{maxHeight:"35px"},children:[s.jsx("td",{className:"px-4 py-2 text-sm text-white sticky left-0 bg-slate-800 z-20 border-r",style:{maxHeight:"35px"},children:"TOTALS"}),p.map((e,t)=>{const r=S[e.key]||{};return s.jsx("td",{style:{maxHeight:"35px"},className:"px-2 py-2 text-center border-l cursor-pointer hover:bg-slate-700",onClick:a=>{a.stopPropagation(),C?.({type:"TOTALS",month:e.label,data:r,metric:g,clients:r.clients||[]})},children:f(r,t)},e.key)})]})]})]})})})]})};export{Ae as C,Ye as a,fe as u};
//# sourceMappingURL=ClientRetentionMonthByTypePivot-BWm8vzsu.js.map
