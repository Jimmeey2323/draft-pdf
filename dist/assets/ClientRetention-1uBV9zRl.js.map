{"version":3,"file":"ClientRetention-1uBV9zRl.js","sources":["../../node_modules/lucide-react/dist/esm/icons/image.js","../../src/components/dashboard/EnhancedClientConversionFilterSection.tsx","../../src/components/dashboard/ClientConversionSimplifiedRanks.tsx","../../src/components/dashboard/ClientConversionEnhancedCharts.tsx","../../src/components/dashboard/ClientConversionDataTableSelector.tsx","../../src/components/dashboard/ClientConversionMonthOnMonthByTypeTable.tsx","../../src/components/dashboard/ClientRetentionYearOnYearPivotNew.tsx","../../src/components/dashboard/ClientConversionMembershipTable.tsx","../../src/components/dashboard/ClientHostedClassesTable.tsx","../../src/components/dashboard/TeacherPerformanceTable.tsx","../../src/components/dashboard/NewClientMembershipPurchaseTable.tsx","../../src/pages/ClientRetention.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Image = createLucideIcon(\"Image\", [\n  [\"rect\", { width: \"18\", height: \"18\", x: \"3\", y: \"3\", rx: \"2\", ry: \"2\", key: \"1m3agn\" }],\n  [\"circle\", { cx: \"9\", cy: \"9\", r: \"2\", key: \"af1f0g\" }],\n  [\"path\", { d: \"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21\", key: \"1xmnt7\" }]\n]);\n\nexport { Image as default };\n//# sourceMappingURL=image.js.map\n","\nimport React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { \n  Calendar, \n  Filter, \n  RotateCcw, \n  MapPin, \n  Users, \n  Target, \n  ChevronDown, \n  ChevronUp, \n  CreditCard, \n  Package,\n  Clock,\n  UserCheck,\n  Percent,\n  DollarSign,\n  Search\n} from 'lucide-react';\nimport { DatePickerWithRange } from '@/components/ui/date-picker';\nimport { NewClientFilterOptions } from '@/types/dashboard';\n\ninterface EnhancedClientConversionFilterSectionProps {\n  filters: NewClientFilterOptions;\n  onFiltersChange: (filters: NewClientFilterOptions) => void;\n  locations: string[];\n  trainers: string[];\n  membershipTypes: string[];\n}\n\nexport const EnhancedClientConversionFilterSection: React.FC<EnhancedClientConversionFilterSectionProps> = ({\n  filters,\n  onFiltersChange,\n  locations,\n  trainers,\n  membershipTypes\n}) => {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [searchTerm, setSearchTerm] = useState('');\n\n  const handleArrayFilterChange = (filterKey: keyof NewClientFilterOptions, value: string) => {\n    const currentValues = [...(filters[filterKey] as string[])];\n    const newValues = currentValues.includes(value)\n      ? currentValues.filter(v => v !== value)\n      : [...currentValues, value];\n    onFiltersChange({ ...filters, [filterKey]: newValues });\n  };\n\n  const handleDateRangeChange = (range: { from?: Date; to?: Date }) => {\n    // Helper function to format date without timezone offset\n    const formatDateForFilter = (date: Date): string => {\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const day = String(date.getDate()).padStart(2, '0');\n      return `${year}-${month}-${day}`;\n    };\n\n    onFiltersChange({\n      ...filters,\n      dateRange: {\n        start: range.from ? formatDateForFilter(range.from) : '',\n        end: range.to ? formatDateForFilter(range.to) : ''\n      }\n    });\n  };\n\n  const resetFilters = () => {\n    onFiltersChange({\n      dateRange: { start: '', end: '' },\n      location: [],\n      homeLocation: [],\n      trainer: [],\n      paymentMethod: [],\n      retentionStatus: [],\n      conversionStatus: [],\n      isNew: [],\n      minLTV: undefined,\n      maxLTV: undefined\n    });\n    setSearchTerm('');\n  };\n\n  const activeFiltersCount = filters.location.length + filters.trainer.length + \n    filters.retentionStatus.length + filters.conversionStatus.length + \n    filters.paymentMethod.length + filters.isNew.length +\n    (filters.dateRange.start || filters.dateRange.end ? 1 : 0) +\n    (filters.minLTV ? 1 : 0) + (filters.maxLTV ? 1 : 0);\n\n  // Use only 3 main locations as in sales tab\n  const mainLocations = ['Kwality House, Kemps Corner', 'Supreme HQ, Bandra', 'Kenkere House, Bengaluru'];\n  const availableLocations = locations.filter(loc => mainLocations.includes(loc));\n\n  const filterSections = [\n    {\n      title: 'Location & Geography',\n      icon: MapPin,\n      filters: [\n        {\n          key: 'location' as keyof NewClientFilterOptions,\n          label: 'Visit Locations',\n          options: availableLocations,\n          values: filters.location\n        }\n      ]\n    },\n    {\n      title: 'Trainer & Service',\n      icon: Users,\n      filters: [\n        {\n          key: 'trainer' as keyof NewClientFilterOptions,\n          label: 'Trainers',\n          options: trainers.slice(0, 12),\n          values: filters.trainer\n        }\n      ]\n    },\n    {\n      title: 'Conversion & Status',\n      icon: Target,\n      filters: [\n        {\n          key: 'conversionStatus' as keyof NewClientFilterOptions,\n          label: 'Conversion Status',\n          options: ['Converted', 'Not Converted', 'Pending'],\n          values: filters.conversionStatus\n        },\n        {\n          key: 'retentionStatus' as keyof NewClientFilterOptions,\n          label: 'Retention Status',\n          options: ['Retained', 'Not Retained', 'At Risk'],\n          values: filters.retentionStatus\n        },\n        {\n          key: 'isNew' as keyof NewClientFilterOptions,\n          label: 'Client Type',\n          options: ['New', 'Existing', 'Returning'],\n          values: filters.isNew\n        }\n      ]\n    },\n    {\n      title: 'Payment & Membership',\n      icon: CreditCard,\n      filters: [\n        {\n          key: 'paymentMethod' as keyof NewClientFilterOptions,\n          label: 'Payment Methods',\n          options: ['Online', 'Cash', 'Card', 'UPI', 'Bank Transfer'],\n          values: filters.paymentMethod\n        }\n      ]\n    }\n  ];\n\n  if (!isExpanded) {\n    return (\n      <Card className=\"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-xl\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg\">\n                <Filter className=\"w-5 h-5 text-white\" />\n              </div>\n              <div>\n                <h3 className=\"font-bold text-slate-800\">Advanced Filters</h3>\n                <p className=\"text-sm text-slate-600\">Refine your client analysis</p>\n              </div>\n              {activeFiltersCount > 0 && (\n                <Badge className=\"bg-gradient-to-r from-blue-600 to-indigo-600 text-white\">\n                  {activeFiltersCount} active\n                </Badge>\n              )}\n            </div>\n            <Button\n              variant=\"outline\"\n              onClick={() => setIsExpanded(true)}\n              className=\"gap-2 border-blue-200 text-blue-700 hover:bg-blue-50\"\n            >\n              <ChevronDown className=\"w-4 h-4\" />\n              Expand Filters\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-xl overflow-hidden\">\n      <CardHeader className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white\">\n        <CardTitle className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <Filter className=\"w-6 h-6\" />\n            <div>\n              <h3 className=\"text-xl font-bold\">Advanced Client Filters</h3>\n              <p className=\"text-blue-100 text-sm\">Customize your analysis view</p>\n            </div>\n            <Badge className=\"bg-white/20 text-white border-white/30\">\n              {activeFiltersCount} Active\n            </Badge>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={resetFilters}\n              disabled={activeFiltersCount === 0}\n              className=\"bg-white/10 border-white/30 text-white hover:bg-white/20\"\n            >\n              <RotateCcw className=\"w-4 h-4 mr-1\" />\n              Reset\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setIsExpanded(false)}\n              className=\"text-white hover:bg-white/20\"\n            >\n              <ChevronUp className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        </CardTitle>\n      </CardHeader>\n      \n      <CardContent className=\"p-8 space-y-8\">\n        {/* Date Range and Search */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          <div className=\"space-y-3\">\n            <label className=\"text-sm font-bold text-slate-700 flex items-center gap-2\">\n              <Calendar className=\"w-5 h-5 text-blue-600\" />\n              Date Range\n            </label>\n            <DatePickerWithRange\n              value={{\n                from: filters.dateRange.start ? new Date(filters.dateRange.start) : undefined,\n                to: filters.dateRange.end ? new Date(filters.dateRange.end) : undefined\n              }}\n              onChange={handleDateRangeChange}\n            />\n          </div>\n          \n          <div className=\"space-y-3\">\n            <label className=\"text-sm font-bold text-slate-700 flex items-center gap-2\">\n              <Search className=\"w-5 h-5 text-blue-600\" />\n              Quick Search\n            </label>\n            <Input\n              placeholder=\"Search trainers, locations...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"bg-white border-slate-200\"\n            />\n          </div>\n        </div>\n\n        {/* LTV Range */}\n        <div className=\"space-y-4\">\n          <label className=\"text-sm font-bold text-slate-700 flex items-center gap-2\">\n            <DollarSign className=\"w-5 h-5 text-blue-600\" />\n            Lifetime Value Range\n          </label>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <Input\n              type=\"number\"\n              placeholder=\"Min LTV (₹)\"\n              value={filters.minLTV || ''}\n              onChange={(e) => onFiltersChange({\n                ...filters,\n                minLTV: e.target.value ? parseFloat(e.target.value) : undefined\n              })}\n              className=\"bg-white border-slate-200\"\n            />\n            <Input\n              type=\"number\"\n              placeholder=\"Max LTV (₹)\"\n              value={filters.maxLTV || ''}\n              onChange={(e) => onFiltersChange({\n                ...filters,\n                maxLTV: e.target.value ? parseFloat(e.target.value) : undefined\n              })}\n              className=\"bg-white border-slate-200\"\n            />\n          </div>\n        </div>\n\n        {/* Filter Sections */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n          {filterSections.map((section) => (\n            <Card key={section.title} className=\"bg-white/70 border-slate-200 shadow-lg\">\n              <CardHeader className=\"pb-4\">\n                <CardTitle className=\"text-lg font-bold text-slate-800 flex items-center gap-2\">\n                  <section.icon className=\"w-5 h-5 text-blue-600\" />\n                  {section.title}\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {section.filters.map((filter) => (\n                  <div key={filter.key} className=\"space-y-3\">\n                    <label className=\"text-sm font-medium text-slate-700\">\n                      {filter.label}\n                      {filter.values.length > 0 && (\n                        <Badge variant=\"secondary\" className=\"ml-2 text-xs bg-blue-100 text-blue-700\">\n                          {filter.values.length} selected\n                        </Badge>\n                      )}\n                    </label>\n                    <div className=\"flex flex-wrap gap-2 max-h-32 overflow-y-auto\">\n                      {filter.options.filter(option => \n                        !searchTerm || option.toLowerCase().includes(searchTerm.toLowerCase())\n                      ).map(option => (\n                        <Button\n                          key={option}\n                          variant={filter.values.includes(option) ? \"default\" : \"outline\"}\n                          size=\"sm\"\n                          onClick={() => handleArrayFilterChange(filter.key, option)}\n                          className={`text-xs transition-all duration-200 ${\n                            filter.values.includes(option)\n                              ? 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-md'\n                              : 'hover:bg-blue-50 border-slate-200 hover:border-blue-300'\n                          }`}\n                        >\n                          {option}\n                        </Button>\n                      ))}\n                    </div>\n                  </div>\n                ))}\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n","import React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { \n  Trophy, \n  TrendingDown, \n  MapPin, \n  Users, \n  DollarSign, \n  Target, \n  Crown, \n  AlertTriangle,\n  Star,\n  Award,\n  TrendingUp,\n  Calendar,\n  Eye\n} from 'lucide-react';\nimport { formatCurrency, formatNumber } from '@/utils/formatters';\nimport { NewClientData, PayrollData } from '@/types/dashboard';\nimport { cn } from '@/lib/utils';\n\ninterface ClientConversionSimplifiedRanksProps {\n  data: NewClientData[];\n  payrollData: PayrollData[];\n  allPayrollData: PayrollData[];\n  allClientData: NewClientData[];\n  selectedLocation: string;\n  dateRange: { start: string; end: string };\n  selectedMetric?: string;\n  onDrillDown?: (type: string, item: any, metric: string) => void;\n}\n\nexport const ClientConversionSimplifiedRanks: React.FC<ClientConversionSimplifiedRanksProps> = ({ \n  data, \n  payrollData, \n  allPayrollData,\n  allClientData,\n  selectedLocation, \n  dateRange,\n  selectedMetric,\n  onDrillDown \n}) => {\n  const [selectedRanking, setSelectedRanking] = useState('trainer-conversion');\n\n  // Calculate comprehensive trainer stats using both client and payroll data\n  const trainerStats = React.useMemo(() => {\n    const stats = new Map();\n    \n    // Initialize stats from payroll data (classes taught, empty classes, etc.)\n    payrollData.forEach(payroll => {\n      const trainer = payroll.teacherName;\n      if (!trainer || trainer === 'Unknown') return;\n      \n      if (!stats.has(trainer)) {\n        stats.set(trainer, {\n          name: trainer,\n          totalSessions: 0,\n          totalEmptySessions: 0,\n          totalNonEmptySessions: 0,\n          totalCustomers: 0,\n          totalConverted: 0,\n          totalRetained: 0,\n          totalNew: 0,\n          totalLTV: 0,\n          clientCount: 0\n        });\n      }\n      \n      const trainerStat = stats.get(trainer);\n      trainerStat.totalSessions += payroll.totalSessions || 0;\n      trainerStat.totalEmptySessions += payroll.totalEmptySessions || 0;\n      trainerStat.totalNonEmptySessions += payroll.totalNonEmptySessions || 0;\n      trainerStat.totalCustomers += payroll.totalCustomers || 0;\n      trainerStat.totalConverted += payroll.converted || 0;\n      trainerStat.totalRetained += payroll.retained || 0;\n      trainerStat.totalNew += payroll.new || 0;\n    });\n\n    // Add client data for LTV and additional metrics\n    data.forEach(client => {\n      const trainer = client.trainerName;\n      if (!trainer || trainer === 'Unknown' || !stats.has(trainer)) return;\n      \n      const trainerStat = stats.get(trainer);\n      trainerStat.totalLTV += client.ltv || 0;\n      trainerStat.clientCount++;\n    });\n    \n    return Array.from(stats.values()).map(stat => {\n      const conversionRate = stat.totalNew > 0 ? (stat.totalConverted / stat.totalNew) * 100 : 0;\n      const retentionRate = stat.totalNew > 0 ? (stat.totalRetained / stat.totalNew) * 100 : 0;\n      const classAverage = stat.totalNonEmptySessions > 0 ? stat.totalCustomers / stat.totalNonEmptySessions : 0;\n      const avgLTV = stat.clientCount > 0 ? stat.totalLTV / stat.clientCount : 0;\n      const emptyClassRate = stat.totalSessions > 0 ? (stat.totalEmptySessions / stat.totalSessions) * 100 : 0;\n      \n      return {\n        ...stat,\n        conversionRate,\n        retentionRate,\n        classAverage,\n        avgLTV,\n        emptyClassRate,\n        totalClients: stat.clientCount // Add this for consistency\n      };\n    }).filter(stat => stat.totalSessions > 0); // Only include trainers who actually taught classes\n  }, [data, payrollData]);\n\n  // Calculate location stats using both data sources\n  const locationStats = React.useMemo(() => {\n    const stats = new Map();\n    \n    // Initialize stats from payroll data\n    payrollData.forEach(payroll => {\n      const location = payroll.location;\n      if (!location || location === 'Unknown') return;\n      \n      if (!stats.has(location)) {\n        stats.set(location, {\n          name: location,\n          totalSessions: 0,\n          totalEmptySessions: 0,\n          totalNonEmptySessions: 0,\n          totalCustomers: 0,\n          totalConverted: 0,\n          totalRetained: 0,\n          totalNew: 0,\n          totalLTV: 0,\n          clientCount: 0\n        });\n      }\n      \n      const locationStat = stats.get(location);\n      locationStat.totalSessions += payroll.totalSessions || 0;\n      locationStat.totalEmptySessions += payroll.totalEmptySessions || 0;\n      locationStat.totalNonEmptySessions += payroll.totalNonEmptySessions || 0;\n      locationStat.totalCustomers += payroll.totalCustomers || 0;\n      locationStat.totalConverted += payroll.converted || 0;\n      locationStat.totalRetained += payroll.retained || 0;\n      locationStat.totalNew += payroll.new || 0;\n    });\n\n    // Add client data for LTV\n    data.forEach(client => {\n      const location = client.firstVisitLocation || client.homeLocation;\n      if (!location || location === 'Unknown' || !stats.has(location)) return;\n      \n      const locationStat = stats.get(location);\n      locationStat.totalLTV += client.ltv || 0;\n      locationStat.clientCount++;\n    });\n    \n    return Array.from(stats.values()).map(stat => {\n      const conversionRate = stat.totalNew > 0 ? (stat.totalConverted / stat.totalNew) * 100 : 0;\n      const retentionRate = stat.totalNew > 0 ? (stat.totalRetained / stat.totalNew) * 100 : 0;\n      const classAverage = stat.totalNonEmptySessions > 0 ? stat.totalCustomers / stat.totalNonEmptySessions : 0;\n      const avgLTV = stat.clientCount > 0 ? stat.totalLTV / stat.clientCount : 0;\n      const emptyClassRate = stat.totalSessions > 0 ? (stat.totalEmptySessions / stat.totalSessions) * 100 : 0;\n      \n      return {\n        ...stat,\n        conversionRate,\n        retentionRate,\n        classAverage,\n        avgLTV,\n        emptyClassRate,\n        totalClients: stat.clientCount // Add this for consistency\n      };\n    }).filter(stat => stat.totalSessions > 0);\n  }, [data, payrollData]);\n\n  // Calculate membership stats (client-data only since payroll doesn't track memberships)\n  const membershipStats = React.useMemo(() => {\n    const stats = new Map();\n    \n    data.forEach(client => {\n      const membership = client.membershipUsed || 'Unknown Membership';\n      if (!stats.has(membership)) {\n        stats.set(membership, {\n          name: membership,\n          totalClients: 0,\n          newMembers: 0,\n          converted: 0,\n          retained: 0,\n          totalLTV: 0,\n          avgVisits: 0\n        });\n      }\n      \n      const membershipStat = stats.get(membership);\n      membershipStat.totalClients++;\n      membershipStat.totalLTV += client.ltv || 0;\n      membershipStat.avgVisits += client.visitsPostTrial || 0;\n      \n      // Standardized status detection\n      const isNewValue = (client.isNew || '').toLowerCase();\n      if (isNewValue.includes('new')) {\n        membershipStat.newMembers++;\n      }\n      \n      // Exact equality per business rule\n      if (client.conversionStatus === 'Converted') {\n        membershipStat.converted++;\n      }\n      \n      if (client.retentionStatus === 'Retained') {\n        membershipStat.retained++;\n      }\n    });\n    \n    return Array.from(stats.values()).map(stat => {\n      const conversionRate = stat.newMembers > 0 ? (stat.converted / stat.newMembers) * 100 : 0;\n      const retentionRate = stat.newMembers > 0 ? (stat.retained / stat.newMembers) * 100 : 0;\n      const avgLTV = stat.totalClients > 0 ? stat.totalLTV / stat.totalClients : 0;\n      const avgVisitsPerClient = stat.totalClients > 0 ? stat.avgVisits / stat.totalClients : 0;\n      \n      return {\n        ...stat,\n        conversionRate,\n        retentionRate,\n        avgLTV,\n        avgVisitsPerClient\n      };\n    }).filter(stat => stat.totalClients >= 5); // Only include memberships with meaningful sample size\n  }, [data]);\n\n  const rankingOptions = [\n    // Trainers - focus on key metrics\n    { id: 'trainer-conversion', label: 'Trainer Conversion Rate', icon: Trophy, type: 'trainer', metric: 'conversionRate' },\n    { id: 'trainer-classes', label: 'Classes Taught', icon: Calendar, type: 'trainer', metric: 'totalSessions' },\n    { id: 'trainer-average', label: 'Class Average', icon: Users, type: 'trainer', metric: 'classAverage' },\n    { id: 'trainer-empty', label: 'Empty Classes %', icon: AlertTriangle, type: 'trainer', metric: 'emptyClassRate' },\n    \n    // Locations\n    { id: 'location-conversion', label: 'Location Conversion', icon: MapPin, type: 'location', metric: 'conversionRate' },\n    { id: 'location-classes', label: 'Location Classes', icon: Calendar, type: 'location', metric: 'totalSessions' },\n    { id: 'location-average', label: 'Location Class Average', icon: Users, type: 'location', metric: 'classAverage' },\n    \n    // Memberships\n    { id: 'membership-conversion', label: 'Membership Conversion', icon: Crown, type: 'membership', metric: 'conversionRate' },\n    { id: 'membership-ltv', label: 'Membership LTV', icon: DollarSign, type: 'membership', metric: 'avgLTV' },\n  ];\n\n  const getCurrentData = () => {\n    const option = rankingOptions.find(r => r.id === selectedRanking);\n    if (!option) return { top: [], bottom: [] };\n\n    let sourceData;\n    switch (option.type) {\n      case 'trainer':\n        sourceData = trainerStats;\n        break;\n      case 'location':\n        sourceData = locationStats;\n        break;\n      case 'membership':\n        sourceData = membershipStats;\n        break;\n      default:\n        sourceData = trainerStats;\n    }\n\n    // Filter out items with insufficient data\n    const minThreshold = option.type === 'trainer' ? 3 : 1;\n    const filtered = sourceData.filter(item => {\n      if (option.metric === 'totalSessions' || option.metric === 'classAverage' || option.metric === 'emptyClassRate') {\n        return item.totalSessions >= 5; // Require at least 5 sessions for meaningful class metrics\n      }\n      if (option.metric === 'conversionRate' || option.metric === 'retentionRate') {\n        return item.totalNew >= minThreshold; // Require new members for conversion metrics\n      }\n      return item.totalClients >= 1 || item.clientCount >= 1;\n    });\n    \n    const sorted = [...filtered].sort((a, b) => {\n      const aValue = a[option.metric] || 0;\n      const bValue = b[option.metric] || 0;\n      return bValue - aValue;\n    });\n    \n    return {\n      top: sorted.slice(0, 5),\n      bottom: sorted.slice(-5).reverse()\n    };\n  };\n\n  const { top, bottom } = getCurrentData();\n  const currentOption = rankingOptions.find(r => r.id === selectedRanking);\n\n  const formatValue = (value: number, metric: string) => {\n    if (metric === 'avgLTV') return formatCurrency(value);\n    if (metric === 'totalSessions') return formatNumber(value);\n    if (metric === 'totalClients' || metric === 'clientCount') return formatNumber(value);\n    if (metric === 'classAverage') return value.toFixed(1);\n    if (metric === 'avgVisitsPerClient') return value.toFixed(1);\n    return `${value.toFixed(1)}%`;\n  };\n\n  const RankCard = ({ title, data: rankData, isTop = true }) => (\n    <Card className=\"bg-gradient-to-br from-white via-slate-50/50 to-white border-0 shadow-xl hover:shadow-2xl transition-all duration-500\">\n      <CardHeader className=\"pb-4\">\n        <CardTitle className=\"flex items-center gap-3 text-xl\">\n          {isTop ? (\n            <>\n              <div className=\"p-2 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500\">\n                <Crown className=\"w-5 h-5 text-white\" />\n              </div>\n              <div>\n                <span className=\"bg-gradient-to-r from-yellow-600 to-orange-600 bg-clip-text text-transparent\">\n                  {title}\n                </span>\n                <p className=\"text-sm text-slate-600 font-normal\">Top performers</p>\n              </div>\n            </>\n          ) : (\n            <>\n              <div className=\"p-2 rounded-full bg-gradient-to-r from-red-400 to-rose-500\">\n                <AlertTriangle className=\"w-5 h-5 text-white\" />\n              </div>\n              <div>\n                <span className=\"bg-gradient-to-r from-red-600 to-rose-600 bg-clip-text text-transparent\">\n                  {title}\n                </span>\n                <p className=\"text-sm text-slate-600 font-normal\">Areas for improvement</p>\n              </div>\n            </>\n          )}\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {rankData.map((item, index) => (\n          <div \n            key={item.name} \n            className=\"group flex items-center justify-between p-4 rounded-xl bg-white shadow-sm border hover:shadow-md transition-all duration-300 cursor-pointer\"\n            onClick={() => {\n              if (onDrillDown && currentOption) {\n                const drillDownType = currentOption.type === 'trainer' ? 'trainer' : \n                                    currentOption.type === 'location' ? 'location' : 'membership';\n                onDrillDown(drillDownType, item, currentOption.metric);\n              }\n            }}\n          >\n            <div className=\"flex items-center gap-4 flex-1\">\n              <div className={cn(\n                \"w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold shadow-sm\",\n                isTop \n                  ? 'bg-gradient-to-r from-green-400 to-emerald-600 text-white'\n                  : 'bg-gradient-to-r from-red-400 to-rose-600 text-white'\n              )}>\n                {index + 1}\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"font-semibold text-slate-900 whitespace-normal break-words group-hover:text-blue-600 transition-colors\">\n                  {item.name}\n                </p>\n                <div className=\"flex flex-wrap gap-2 mt-2\">\n                  <Badge variant=\"secondary\" className=\"text-xs bg-blue-50 text-blue-700 border-blue-200\">\n                    {formatNumber(item.totalClients || item.clientCount || 0)} clients\n                  </Badge>\n                  {currentOption?.type === 'trainer' && (\n                    <>\n                      <Badge variant=\"outline\" className=\"text-xs border-purple-200 text-purple-700\">\n                        {formatNumber(item.totalSessions || 0)} classes\n                      </Badge>\n                      <Badge variant=\"outline\" className=\"text-xs border-slate-200 text-slate-700\">\n                        Empty: {formatNumber(item.totalEmptySessions || 0)}\n                      </Badge>\n                      <Badge variant=\"outline\" className=\"text-xs border-green-200 text-green-700\">\n                        Avg: {(item.classAverage || 0).toFixed(1)}\n                      </Badge>\n                      <Badge variant=\"outline\" className=\"text-xs border-orange-200 text-orange-700\">\n                        Empty: {(item.emptyClassRate || 0).toFixed(1)}%\n                      </Badge>\n                      <Badge variant=\"outline\" className=\"text-xs border-emerald-200 text-emerald-700\">\n                        Converted: {formatNumber(item.totalConverted || 0)}\n                      </Badge>\n                      <Badge variant=\"outline\" className=\"text-xs border-violet-200 text-violet-700\">\n                        Retained: {formatNumber(item.totalRetained || 0)}\n                      </Badge>\n                      <Badge variant=\"outline\" className=\"text-xs border-blue-200 text-blue-700\">\n                        New: {formatNumber(item.totalNew || 0)}\n                      </Badge>\n                    </>\n                  )}\n                  {currentOption?.type === 'location' && (\n                    <>\n                      <Badge variant=\"outline\" className=\"text-xs border-purple-200 text-purple-700\">\n                        {formatNumber(item.totalSessions || 0)} classes\n                      </Badge>\n                      <Badge variant=\"outline\" className=\"text-xs border-green-200 text-green-700\">\n                        Avg: {(item.classAverage || 0).toFixed(1)}\n                      </Badge>\n                      <Badge variant=\"outline\" className=\"text-xs border-slate-200 text-slate-700\">\n                        Empty: {formatNumber(item.totalEmptySessions || 0)}\n                      </Badge>\n                      <Badge variant=\"outline\" className=\"text-xs border-emerald-200 text-emerald-700\">\n                        Converted: {formatNumber(item.totalConverted || 0)}\n                      </Badge>\n                      <Badge variant=\"outline\" className=\"text-xs border-violet-200 text-violet-700\">\n                        Retained: {formatNumber(item.totalRetained || 0)}\n                      </Badge>\n                      <Badge variant=\"outline\" className=\"text-xs border-blue-200 text-blue-700\">\n                        New: {formatNumber(item.totalNew || 0)}\n                      </Badge>\n                    </>\n                  )}\n                  {currentOption?.type === 'membership' && (\n                    <>\n                      <Badge variant=\"outline\" className=\"text-xs border-green-200 text-green-700\">\n                        Avg LTV: {formatCurrency(item.avgLTV || 0)}\n                      </Badge>\n                      <Badge variant=\"outline\" className=\"text-xs border-blue-200 text-blue-700\">\n                        Total: {formatCurrency(item.totalLTV || 0)}\n                      </Badge>\n                      <Badge variant=\"outline\" className=\"text-xs border-orange-200 text-orange-700\">\n                        Visits: {(item.avgVisitsPerClient || 0).toFixed(1)}\n                      </Badge>\n                    </>\n                  )}\n                </div>\n              </div>\n            </div>\n            <div className=\"text-right\">\n              <p className=\"font-bold text-xl text-slate-900 group-hover:text-blue-600 transition-colors\">\n                {formatValue(item[currentOption?.metric || 'conversionRate'], currentOption?.metric || 'conversionRate')}\n              </p>\n              <p className=\"text-sm text-slate-500\">\n                {currentOption?.metric === 'totalSessions' ? 'Total Classes' :\n                 currentOption?.metric === 'classAverage' ? 'Class Average' :\n                 currentOption?.metric === 'emptyClassRate' ? 'Empty Rate' :\n                 currentOption?.metric === 'avgLTV' ? 'Avg LTV' :\n                 'Conversion Rate'}\n              </p>\n              <p className=\"text-xs text-slate-400\">\n                {currentOption?.type === 'trainer' ? 'Trainer Performance' :\n                 currentOption?.type === 'location' ? 'Location Performance' :\n                 'Membership Performance'}\n              </p>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"mt-1 opacity-0 group-hover:opacity-100 transition-all duration-300 hover:bg-blue-50 hover:text-blue-600 hover:shadow-sm\"\n                onClick={e => {\n                  e.stopPropagation();\n                  if (onDrillDown && currentOption) {\n                    const drillDownType = currentOption.type === 'trainer' ? 'trainer' : \n                                        currentOption.type === 'location' ? 'location' : 'membership';\n                    onDrillDown(drillDownType, item, currentOption.metric);\n                  }\n                }}\n              >\n                <Eye className=\"w-3 h-3 mr-1\" />\n                View Analytics\n              </Button>\n            </div>\n          </div>\n        ))}\n      </CardContent>\n    </Card>\n  );\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Ranking Selection Buttons */}\n      <Card className=\"bg-white shadow-lg border-0\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-3 text-slate-800\">\n            <Trophy className=\"w-6 h-6 text-yellow-600\" />\n            Performance Rankings\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3\">\n            {rankingOptions.map((option) => (\n              <Button\n                key={option.id}\n                variant={selectedRanking === option.id ? 'default' : 'ghost'}\n                size=\"sm\"\n                onClick={() => setSelectedRanking(option.id)}\n                className={`flex flex-col items-center gap-2 h-auto py-3 px-2 transition-all duration-300 hover:scale-105 ${\n                  selectedRanking === option.id \n                    ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg' \n                    : 'hover:bg-slate-100'\n                }`}\n              >\n                <option.icon className=\"w-4 h-4\" />\n                <span className=\"text-xs font-medium text-center leading-tight\">\n                  {option.label}\n                </span>\n              </Button>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Top and Bottom Rankings */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <RankCard\n          title={`Top ${currentOption?.label || 'Performance'}`}\n          data={top}\n          isTop={true}\n        />\n        \n        <RankCard\n          title={`Bottom ${currentOption?.label || 'Performance'}`}\n          data={bottom}\n          isTop={false}\n        />\n      </div>\n    </div>\n  );\n};","import React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { \n  BarChart, \n  Bar, \n  XAxis, \n  YAxis, \n  CartesianGrid, \n  Tooltip, \n  ResponsiveContainer,\n  LineChart,\n  Line,\n  PieChart,\n  Pie,\n  Cell,\n  Area,\n  AreaChart\n} from 'recharts';\nimport { \n  TrendingUp, \n  Users, \n  Calendar, \n  MapPin, \n  Target, \n  DollarSign,\n  Activity,\n  Star,\n  BarChart3,\n  PieChart as PieChartIcon,\n  TrendingDown\n} from 'lucide-react';\nimport { formatCurrency, formatNumber } from '@/utils/formatters';\nimport { NewClientData } from '@/types/dashboard';\n\ninterface ClientConversionEnhancedChartsProps {\n  data: NewClientData[];\n}\n\nexport const ClientConversionEnhancedCharts: React.FC<ClientConversionEnhancedChartsProps> = ({ data }) => {\n  const [selectedChart, setSelectedChart] = useState('monthly-trends');\n\n  const chartOptions = [\n    { id: 'monthly-trends', label: 'Monthly Trends', icon: TrendingUp, type: 'line' },\n    { id: 'conversion-funnel', label: 'Conversion Funnel', icon: Target, type: 'bar' },\n    { id: 'location-performance', label: 'Location Performance', icon: MapPin, type: 'bar' },\n    { id: 'trainer-performance', label: 'Trainer Performance', icon: Users, type: 'bar' },\n    { id: 'retention-analysis', label: 'Retention Analysis', icon: Activity, type: 'area' },\n    { id: 'ltv-distribution', label: 'LTV Distribution', icon: DollarSign, type: 'pie' }\n  ];\n\n  // Monthly trends data\n  const monthlyData = React.useMemo(() => {\n    const monthMap = new Map();\n    \n    data.forEach(client => {\n      if (!client.firstVisitDate) return;\n      \n      let date: Date;\n      if (client.firstVisitDate.includes('/')) {\n        const [day, month, year] = client.firstVisitDate.split(' ')[0].split('/');\n        date = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n      } else {\n        date = new Date(client.firstVisitDate);\n      }\n      \n      if (isNaN(date.getTime())) return;\n      \n      const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;\n      \n      if (!monthMap.has(monthKey)) {\n        monthMap.set(monthKey, {\n          month: monthKey,\n          newMembers: 0,\n          converted: 0,\n          retained: 0,\n          revenue: 0\n        });\n      }\n      \n      const monthData = monthMap.get(monthKey);\n      \n      if (String(client.isNew || '').includes('New')) {\n        monthData.newMembers++;\n      }\n      if (client.conversionStatus === 'Converted') {\n        monthData.converted++;\n      }\n      if (client.retentionStatus === 'Retained') {\n        monthData.retained++;\n      }\n      monthData.revenue += client.ltv || 0;\n    });\n    \n    return Array.from(monthMap.values())\n      .sort((a, b) => a.month.localeCompare(b.month))\n      .map(item => ({\n        ...item,\n        conversionRate: item.newMembers > 0 ? (item.converted / item.newMembers) * 100 : 0,\n        retentionRate: item.converted > 0 ? (item.retained / item.converted) * 100 : 0\n      }));\n  }, [data]);\n\n  // Location performance data\n  const locationData = React.useMemo(() => {\n    const locationMap = new Map();\n    \n    data.forEach(client => {\n      const location = client.firstVisitLocation || client.homeLocation || 'Unknown';\n      \n      if (!locationMap.has(location)) {\n        locationMap.set(location, {\n          location,\n          newMembers: 0,\n          converted: 0,\n          retained: 0,\n          revenue: 0\n        });\n      }\n      \n      const locationStat = locationMap.get(location);\n      \n      if (String(client.isNew || '').includes('New')) {\n        locationStat.newMembers++;\n      }\n      if (client.conversionStatus === 'Converted') {\n        locationStat.converted++;\n      }\n      if (client.retentionStatus === 'Retained') {\n        locationStat.retained++;\n      }\n      locationStat.revenue += client.ltv || 0;\n    });\n    \n    return Array.from(locationMap.values())\n      .map(item => ({\n        ...item,\n        conversionRate: item.newMembers > 0 ? (item.converted / item.newMembers) * 100 : 0,\n        retentionRate: item.converted > 0 ? (item.retained / item.converted) * 100 : 0\n      }))\n      .sort((a, b) => b.revenue - a.revenue);\n  }, [data]);\n\n  // Trainer performance data\n  const trainerData = React.useMemo(() => {\n    const trainerMap = new Map();\n    \n    data.forEach(client => {\n      const trainer = client.trainerName || 'Unknown';\n      \n      if (!trainerMap.has(trainer)) {\n        trainerMap.set(trainer, {\n          trainer,\n          newMembers: 0,\n          converted: 0,\n          retained: 0,\n          revenue: 0\n        });\n      }\n      \n      const trainerStat = trainerMap.get(trainer);\n      \n      if (String(client.isNew || '').includes('New')) {\n        trainerStat.newMembers++;\n      }\n      if (client.conversionStatus === 'Converted') {\n        trainerStat.converted++;\n      }\n      if (client.retentionStatus === 'Retained') {\n        trainerStat.retained++;\n      }\n      trainerStat.revenue += client.ltv || 0;\n    });\n    \n    return Array.from(trainerMap.values())\n      .filter(item => item.newMembers >= 3)\n      .map(item => ({\n        ...item,\n        conversionRate: item.newMembers > 0 ? (item.converted / item.newMembers) * 100 : 0,\n        retentionRate: item.converted > 0 ? (item.retained / item.converted) * 100 : 0\n      }))\n      .sort((a, b) => b.conversionRate - a.conversionRate)\n      .slice(0, 10);\n  }, [data]);\n\n  // LTV distribution data\n  const ltvData = React.useMemo(() => {\n    const ranges = [\n      { name: '₹0-5K', min: 0, max: 5000, count: 0, color: '#ef4444' },\n      { name: '₹5K-15K', min: 5000, max: 15000, count: 0, color: '#f97316' },\n      { name: '₹15K-30K', min: 15000, max: 30000, count: 0, color: '#eab308' },\n      { name: '₹30K-50K', min: 30000, max: 50000, count: 0, color: '#22c55e' },\n      { name: '₹50K+', min: 50000, max: Infinity, count: 0, color: '#3b82f6' }\n    ];\n    \n    data.forEach(client => {\n      const ltv = client.ltv || 0;\n      const range = ranges.find(r => ltv >= r.min && ltv < r.max);\n      if (range) range.count++;\n    });\n    \n    return ranges.filter(r => r.count > 0);\n  }, [data]);\n\n  const COLORS = ['#3b82f6', '#ef4444', '#22c55e', '#f97316', '#8b5cf6', '#06b6d4'];\n\n  const renderChart = () => {\n    const currentOption = chartOptions.find(c => c.id === selectedChart);\n    \n    switch (selectedChart) {\n      case 'monthly-trends':\n        return (\n          <ResponsiveContainer width=\"100%\" height={400}>\n            <LineChart data={monthlyData} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e2e8f0\" />\n              <XAxis \n                dataKey=\"month\" \n                stroke=\"#64748b\"\n                fontSize={12}\n                tickFormatter={(value) => {\n                  const [year, month] = value.split('-');\n                  return `${month}/${year.slice(2)}`;\n                }}\n              />\n              <YAxis stroke=\"#64748b\" fontSize={12} />\n              <Tooltip \n                contentStyle={{ \n                  backgroundColor: 'white',\n                  border: '1px solid #e2e8f0',\n                  borderRadius: '8px',\n                  boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)'\n                }}\n                formatter={(value: number, name: string) => [\n                  name.includes('Rate') ? `${value.toFixed(1)}%` : formatNumber(value),\n                  name\n                ]}\n              />\n              <Line \n                type=\"monotone\" \n                dataKey=\"newMembers\" \n                stroke=\"#3b82f6\" \n                strokeWidth={3}\n                dot={{ fill: '#3b82f6', strokeWidth: 2, r: 6 }}\n                name=\"New Members\"\n              />\n              <Line \n                type=\"monotone\" \n                dataKey=\"conversionRate\" \n                stroke=\"#22c55e\" \n                strokeWidth={3}\n                dot={{ fill: '#22c55e', strokeWidth: 2, r: 6 }}\n                name=\"Conversion Rate\"\n              />\n            </LineChart>\n          </ResponsiveContainer>\n        );\n\n      case 'conversion-funnel':\n        const funnelData = [\n          { name: 'New Members', value: data.filter(c => String(c.isNew || '').includes('New')).length, color: '#3b82f6' },\n          { name: 'Trials Completed', value: data.filter(c => (c.visitsPostTrial || 0) > 0).length, color: '#8b5cf6' },\n          { name: 'Converted', value: data.filter(c => c.conversionStatus === 'Converted').length, color: '#22c55e' },\n          { name: 'Retained', value: data.filter(c => c.retentionStatus === 'Retained').length, color: '#f97316' }\n        ];\n        \n        return (\n          <ResponsiveContainer width=\"100%\" height={400}>\n            <BarChart data={funnelData} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e2e8f0\" />\n              <XAxis dataKey=\"name\" stroke=\"#64748b\" fontSize={12} />\n              <YAxis stroke=\"#64748b\" fontSize={12} />\n              <Tooltip \n                contentStyle={{ \n                  backgroundColor: 'white',\n                  border: '1px solid #e2e8f0',\n                  borderRadius: '8px',\n                  boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)'\n                }}\n                formatter={(value: number) => [formatNumber(value), 'Count']}\n              />\n              <Bar dataKey=\"value\" fill=\"#3b82f6\" radius={[4, 4, 0, 0]} />\n            </BarChart>\n          </ResponsiveContainer>\n        );\n\n      case 'location-performance':\n        return (\n          <ResponsiveContainer width=\"100%\" height={400}>\n            <BarChart data={locationData} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e2e8f0\" />\n              <XAxis \n                dataKey=\"location\" \n                stroke=\"#64748b\" \n                fontSize={12}\n                angle={-45}\n                textAnchor=\"end\"\n                height={80}\n                tickFormatter={(value) => value.length > 15 ? `${value.slice(0, 15)}...` : value}\n              />\n              <YAxis stroke=\"#64748b\" fontSize={12} />\n              <Tooltip \n                contentStyle={{ \n                  backgroundColor: 'white',\n                  border: '1px solid #e2e8f0',\n                  borderRadius: '8px',\n                  boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)'\n                }}\n                formatter={(value: number, name: string) => [\n                  name.includes('Rate') ? `${value.toFixed(1)}%` : formatNumber(value),\n                  name\n                ]}\n              />\n              <Bar dataKey=\"conversionRate\" fill=\"#22c55e\" radius={[4, 4, 0, 0]} name=\"Conversion Rate\" />\n            </BarChart>\n          </ResponsiveContainer>\n        );\n\n      case 'trainer-performance':\n        return (\n          <ResponsiveContainer width=\"100%\" height={400}>\n            <BarChart data={trainerData} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e2e8f0\" />\n              <XAxis \n                dataKey=\"trainer\" \n                stroke=\"#64748b\" \n                fontSize={12}\n                angle={-45}\n                textAnchor=\"end\"\n                height={80}\n                tickFormatter={(value) => value.length > 10 ? `${value.slice(0, 10)}...` : value}\n              />\n              <YAxis stroke=\"#64748b\" fontSize={12} />\n              <Tooltip \n                contentStyle={{ \n                  backgroundColor: 'white',\n                  border: '1px solid #e2e8f0',\n                  borderRadius: '8px',\n                  boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)'\n                }}\n                formatter={(value: number, name: string) => [\n                  name.includes('Rate') ? `${value.toFixed(1)}%` : formatNumber(value),\n                  name\n                ]}\n              />\n              <Bar dataKey=\"conversionRate\" fill=\"#8b5cf6\" radius={[4, 4, 0, 0]} name=\"Conversion Rate\" />\n              <Bar dataKey=\"retentionRate\" fill=\"#06b6d4\" radius={[4, 4, 0, 0]} name=\"Retention Rate\" />\n            </BarChart>\n          </ResponsiveContainer>\n        );\n\n      case 'retention-analysis':\n        return (\n          <ResponsiveContainer width=\"100%\" height={400}>\n            <AreaChart data={monthlyData} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e2e8f0\" />\n              <XAxis \n                dataKey=\"month\" \n                stroke=\"#64748b\"\n                fontSize={12}\n                tickFormatter={(value) => {\n                  const [year, month] = value.split('-');\n                  return `${month}/${year.slice(2)}`;\n                }}\n              />\n              <YAxis stroke=\"#64748b\" fontSize={12} />\n              <Tooltip \n                contentStyle={{ \n                  backgroundColor: 'white',\n                  border: '1px solid #e2e8f0',\n                  borderRadius: '8px',\n                  boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)'\n                }}\n                formatter={(value: number, name: string) => [\n                  name.includes('Rate') ? `${value.toFixed(1)}%` : formatNumber(value),\n                  name\n                ]}\n              />\n              <Area \n                type=\"monotone\" \n                dataKey=\"retentionRate\" \n                stackId=\"1\"\n                stroke=\"#f97316\" \n                fill=\"url(#retentionGradient)\"\n                name=\"Retention Rate\"\n              />\n              <defs>\n                <linearGradient id=\"retentionGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                  <stop offset=\"5%\" stopColor=\"#f97316\" stopOpacity={0.8}/>\n                  <stop offset=\"95%\" stopColor=\"#f97316\" stopOpacity={0.1}/>\n                </linearGradient>\n              </defs>\n            </AreaChart>\n          </ResponsiveContainer>\n        );\n\n      case 'ltv-distribution':\n        return (\n          <ResponsiveContainer width=\"100%\" height={400}>\n            <PieChart>\n              <Pie\n                data={ltvData}\n                cx=\"50%\"\n                cy=\"50%\"\n                outerRadius={150}\n                fill=\"#8884d8\"\n                dataKey=\"count\"\n                label={({ name, percent }) => `${name} (${(percent * 100).toFixed(1)}%)`}\n              >\n                {ltvData.map((entry, index) => (\n                  <Cell key={`cell-${index}`} fill={entry.color} />\n                ))}\n              </Pie>\n              <Tooltip \n                contentStyle={{ \n                  backgroundColor: 'white',\n                  border: '1px solid #e2e8f0',\n                  borderRadius: '8px',\n                  boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)'\n                }}\n                formatter={(value: number) => [formatNumber(value), 'Clients']}\n              />\n            </PieChart>\n          </ResponsiveContainer>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  const currentOption = chartOptions.find(c => c.id === selectedChart);\n\n  return (\n    <Card className=\"bg-white shadow-lg border-0 overflow-hidden\">\n      <CardHeader className=\"bg-gradient-to-r from-blue-500 to-purple-600 text-white\">\n        <CardTitle className=\"flex items-center gap-3\">\n          <BarChart3 className=\"w-6 h-6\" />\n          <div>\n            <h3 className=\"text-xl font-bold\">Analytics Dashboard</h3>\n            <p className=\"text-sm opacity-90\">Interactive charts and visualizations</p>\n          </div>\n        </CardTitle>\n      </CardHeader>\n      \n      <CardContent className=\"p-6\">\n        {/* Chart Selection */}\n        <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 mb-6\">\n          {chartOptions.map((option) => (\n            <Button\n              key={option.id}\n              variant={selectedChart === option.id ? 'default' : 'ghost'}\n              size=\"sm\"\n              onClick={() => setSelectedChart(option.id)}\n              className={`flex flex-col items-center gap-2 h-auto py-4 px-3 transition-all duration-300 hover:scale-105 ${\n                selectedChart === option.id \n                  ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg' \n                  : 'hover:bg-slate-100'\n              }`}\n            >\n              <option.icon className=\"w-5 h-5\" />\n              <span className=\"text-xs font-medium text-center leading-tight\">\n                {option.label}\n              </span>\n            </Button>\n          ))}\n        </div>\n\n        {/* Chart Display */}\n        <div className=\"bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <div className=\"flex items-center gap-3\">\n              {currentOption && <currentOption.icon className=\"w-5 h-5 text-slate-600\" />}\n              <h4 className=\"text-lg font-semibold text-slate-800\">\n                {currentOption?.label}\n              </h4>\n            </div>\n            <Badge className=\"bg-blue-100 text-blue-800\">\n              {data.length} records\n            </Badge>\n          </div>\n          \n          {renderChart()}\n        </div>\n      </CardContent>\n    </Card>\n  );\n};","import React from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Calendar, TrendingUp, Users, BarChart3, UserCheck } from 'lucide-react';\n\ninterface ClientConversionDataTableSelectorProps {\n  activeTable: string;\n  onTableChange: (table: string) => void;\n  dataLength: number;\n}\n\ntype TableOption = {\n  key: string;\n  label: string;\n  description: string;\n  icon: React.ElementType;\n  gradient: string;\n};\n\nexport const ClientConversionDataTableSelector: React.FC<ClientConversionDataTableSelectorProps> = ({\n  activeTable,\n  onTableChange,\n  dataLength\n}) => {\n  const tableOptions: TableOption[] = [\n    {\n      key: 'monthonmonthbytype',\n      label: 'By Client Type',\n      description: 'Monthly breakdown by client type',\n      icon: Users,\n      gradient: 'from-purple-500 to-pink-600'\n    },\n    {\n      key: 'monthonmonth',\n      label: 'Month on Month',\n      description: 'Monthly trends and comparisons',\n      icon: Calendar,\n      gradient: 'from-blue-500 to-indigo-600'\n    },\n    {\n      key: 'yearonyear',\n      label: 'Year on Year',\n      description: 'Annual performance comparison',\n      icon: TrendingUp,\n      gradient: 'from-green-500 to-emerald-600'\n    },\n    {\n      key: 'hostedclasses',\n      label: 'Hosted Classes',\n      description: 'Class performance metrics',\n      icon: Users,\n      gradient: 'from-purple-500 to-violet-600'\n    },\n    {\n      key: 'memberships',\n      label: 'Membership Analysis',\n      description: 'Membership type breakdown',\n      icon: BarChart3,\n      gradient: 'from-orange-500 to-red-600'\n    },\n    {\n      key: 'teacherperformance',\n      label: 'Teacher Performance',\n      description: 'Trainer metrics and performance analysis',\n      icon: UserCheck,\n      gradient: 'from-teal-500 to-cyan-600'\n    },\n    {\n      key: 'newclientpurchases',\n      label: 'New Client Purchases',\n      description: 'Membership purchases by new clients with conversion metrics',\n      icon: Users,\n      gradient: 'from-indigo-500 to-purple-600'\n    }\n  ];\n\n  return (\n    <div className=\"bg-gradient-to-r from-slate-50 to-gray-100 p-6 rounded-xl border border-gray-200 shadow-sm\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <div>\n          <h3 className=\"text-lg font-bold text-gray-900\">Data Analysis Tables</h3>\n          <p className=\"text-sm text-gray-600\">Select a table to view detailed metrics</p>\n        </div>\n        <Badge className=\"bg-blue-100 text-blue-800 border-blue-200\">\n          {dataLength} Records\n        </Badge>\n      </div>\n      \n      <div className=\"grid grid-cols-7 gap-2\">\n        {tableOptions.map((option) => (\n          <Button\n            key={option.key}\n            variant={activeTable === option.key ? \"default\" : \"outline\"}\n            className={`h-16 px-3 py-2 flex items-center justify-center gap-2 transition-all duration-300 ${\n              activeTable === option.key\n                ? `bg-gradient-to-r ${option.gradient} text-white shadow-lg hover:shadow-xl`\n                : 'bg-white hover:bg-gray-50 border-gray-200 hover:border-gray-300'\n            }`}\n            onClick={() => onTableChange(option.key)}\n          >\n            <option.icon className={`w-4 h-4 flex-shrink-0 ${\n              activeTable === option.key ? 'text-white' : 'text-gray-600'\n            }`} />\n            <span className={`font-semibold text-xs text-center leading-tight ${\n              activeTable === option.key ? 'text-white' : 'text-gray-900'\n            }`}>\n              {option.label}\n            </span>\n          </Button>\n        ))}\n      </div>\n    </div>\n  );\n};"," \nimport React, { useMemo, useRef, useEffect, useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Calendar } from 'lucide-react';\nimport { formatCurrency, formatNumber } from '@/utils/formatters';\nimport { NewClientData } from '@/types/dashboard';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { getTableHeaderClasses } from '@/utils/colorThemes';\nimport { parseDate } from '@/utils/dateUtils';\nimport CopyTableButton from '@/components/ui/CopyTableButton';\nimport { useMetricsTablesRegistry } from '@/contexts/MetricsTablesRegistryContext';\n\ninterface CheckinData {\n  memberId: string;\n  sessionName: string;\n  location: string;\n  date: string;\n  isNew: string;\n  month: string;\n  year: string;\n}\n\ninterface ClientConversionMonthOnMonthByTypeTableProps {\n  data: NewClientData[];\n  checkins?: CheckinData[];\n  visitsSummary?: Record<string, number>; // e.g., \"Jan 2024\" -> 450\n  onRowClick?: (row: any) => void;\n}\n\ninterface MonthlyStats {\n  month: string;\n  sortKey: string;\n  type: string;\n  visits: number;\n  totalTrials: number;\n  newMembers: number;\n  converted: number;\n  retained: number;\n  totalLTV: number;\n  conversionIntervals: number[];\n  visitsPostTrial: number[];\n  clients: NewClientData[];\n}\n\nexport const ClientConversionMonthOnMonthByTypeTable: React.FC<ClientConversionMonthOnMonthByTypeTableProps> = ({\n  data,\n  checkins,\n  visitsSummary,\n  onRowClick\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const registry = useMetricsTablesRegistry();\n  const tableId = 'By Client Type';\n\n  const [sortField, setSortField] = useState<string | undefined>(undefined);\n  const [sortDirection, setSortDirection] = useState<'asc' | 'desc'>('desc');\n  const [rowType, setRowType] = useState<'clientType' | 'membership' | 'teacher'>('clientType');\n\n  const monthlyDataByType = useMemo(() => {\n    if (!data || data.length === 0) return [] as MonthlyStats[];\n\n    const monthlyStats: Record<string, MonthlyStats> = {};\n    data.forEach(client => {\n      const date = parseDate(client.firstVisitDate || '');\n      if (!date) return;\n      const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;\n      const monthName = date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });\n      \n      let groupBy: string;\n      if (rowType === 'clientType') {\n        groupBy = client.isNew || 'Unknown';\n      } else if (rowType === 'membership') {\n        groupBy = client.membershipUsed || 'Unknown';\n      } else {\n        groupBy = client.trainerName || 'Unknown';\n      }\n\n      const key = `${monthKey}-${groupBy}`;\n      if (!monthlyStats[key]) {\n        const [y, m] = monthKey.split('-');\n        const monthNames = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n        const summaryKey = `${monthNames[parseInt(m)-1]} ${y}`;\n        const visits = visitsSummary?.[summaryKey] || 0;\n        monthlyStats[key] = {\n          month: monthName,\n          sortKey: monthKey,\n          type: groupBy,\n          visits,\n          totalTrials: 0,\n          newMembers: 0,\n          converted: 0,\n          retained: 0,\n          totalLTV: 0,\n          conversionIntervals: [],\n          visitsPostTrial: [],\n          clients: []\n        };\n      }\n      const stat = monthlyStats[key];\n      stat.totalTrials++;\n      stat.clients.push(client);\n\n      const isNewValue = (client.isNew || '').toLowerCase();\n      if (isNewValue.includes('new')) {\n        stat.newMembers++;\n      }\n      if (client.conversionStatus === 'Converted') {\n        stat.converted++;\n      }\n      if (client.retentionStatus === 'Retained') {\n        stat.retained++;\n      }\n      stat.totalLTV += client.ltv || 0;\n      if (client.conversionSpan && client.conversionSpan > 0) {\n        stat.conversionIntervals.push(client.conversionSpan);\n      }\n      if (client.visitsPostTrial && client.visitsPostTrial > 0) {\n        stat.visitsPostTrial.push(client.visitsPostTrial);\n      }\n    });\n\n    return Object.values(monthlyStats).sort((a, b) => {\n      const monthCompare = a.sortKey.localeCompare(b.sortKey);\n      if (monthCompare !== 0) return monthCompare;\n      if (rowType === 'clientType') {\n        if (a.type.toLowerCase().includes('new') && !b.type.toLowerCase().includes('new')) return -1;\n        if (!a.type.toLowerCase().includes('new') && b.type.toLowerCase().includes('new')) return 1;\n      }\n      return a.type.localeCompare(b.type);\n    });\n  }, [data, checkins, visitsSummary, rowType]);\n\n  const tableData = useMemo(() => {\n    return monthlyDataByType.map(stat => {\n      const conversionRate = stat.newMembers > 0 ? (stat.converted / stat.newMembers) * 100 : 0;\n      const retentionRate = stat.newMembers > 0 ? (stat.retained / stat.newMembers) * 100 : 0;\n      const avgLTV = stat.totalTrials > 0 ? stat.totalLTV / stat.totalTrials : 0;\n      const avgConversionDays = stat.conversionIntervals.length > 0 ? stat.conversionIntervals.reduce((sum, interval) => sum + interval, 0) / stat.conversionIntervals.length : 0;\n      const avgVisits = stat.visitsPostTrial.length > 0 ? stat.visitsPostTrial.reduce((sum, visits) => sum + visits, 0) / stat.visitsPostTrial.length : 0;\n      return { ...stat, conversionRate, retentionRate, avgLTV, avgConversionDays, avgVisits };\n    });\n  }, [monthlyDataByType]);\n\n  const displayedData = useMemo(() => {\n    if (!sortField) return tableData;\n    const arr = [...tableData];\n    return arr.sort((a: any, b: any) => {\n      const av = a[sortField as any];\n      const bv = b[sortField as any];\n      const dir = sortDirection === 'asc' ? 1 : -1;\n      if (typeof av === 'number' && typeof bv === 'number') return (av - bv) * dir;\n      return String(av ?? '').localeCompare(String(bv ?? '')) * dir;\n    });\n  }, [tableData, sortField, sortDirection]);\n\n  const handleSort = (field: string) => {\n    if (sortField === field) setSortDirection(prev => (prev === 'asc' ? 'desc' : 'asc'));\n    else { setSortField(field); setSortDirection('desc'); }\n  };\n\n  const totals = useMemo(() => {\n    return tableData.reduce((acc, row) => ({\n      visits: acc.visits + (row.visits || 0),\n      totalTrials: acc.totalTrials + row.totalTrials,\n      newMembers: acc.newMembers + row.newMembers,\n      converted: acc.converted + row.converted,\n      retained: acc.retained + row.retained,\n      totalLTV: acc.totalLTV + row.totalLTV,\n      conversionIntervals: [...acc.conversionIntervals, ...row.conversionIntervals],\n      visitsPostTrial: [...acc.visitsPostTrial, ...row.visitsPostTrial]\n    }), {\n      visits: 0,\n      totalTrials: 0,\n      newMembers: 0,\n      converted: 0,\n      retained: 0,\n      totalLTV: 0,\n      conversionIntervals: [] as number[],\n      visitsPostTrial: [] as number[]\n    });\n  }, [tableData]);\n\n  const totalsRow = useMemo(() => {\n    const conversionRate = totals.newMembers > 0 ? (totals.converted / totals.newMembers) * 100 : 0;\n    const retentionRate = totals.newMembers > 0 ? (totals.retained / totals.newMembers) * 100 : 0;\n    const avgLTV = totals.totalTrials > 0 ? totals.totalLTV / totals.totalTrials : 0;\n    const avgConversionDays = totals.conversionIntervals.length > 0 ? totals.conversionIntervals.reduce((sum, interval) => sum + interval, 0) / totals.conversionIntervals.length : 0;\n    const avgVisits = totals.visitsPostTrial.length > 0 ? totals.visitsPostTrial.reduce((sum, visits) => sum + visits, 0) / totals.visitsPostTrial.length : 0;\n    return {\n      month: 'TOTALS',\n      type: 'All Types',\n      visits: totals.visits,\n      totalTrials: totals.totalTrials,\n      newMembers: totals.newMembers,\n      converted: totals.converted,\n      retained: totals.retained,\n      conversionRate,\n      retentionRate,\n      avgLTV,\n      totalLTV: totals.totalLTV,\n      avgConversionDays,\n      avgVisits\n    };\n  }, [totals]);\n\n  // Registry integration for copy-all-tabs\n  useEffect(() => {\n    if (!registry) return;\n    const el = containerRef.current;\n    if (!el) return;\n    const getTextContent = () => {\n      const table = el.querySelector('table');\n      if (!table) return `${tableId} (No Data)`;\n      let text = `${tableId}\\n`;\n      const headerCells = table.querySelectorAll('thead th');\n      const headers: string[] = [];\n      headerCells.forEach(cell => headers.push((cell.textContent || '').trim()));\n      if (headers.length) {\n        text += headers.join('\\t') + '\\n';\n        text += headers.map(() => '---').join('\\t') + '\\n';\n      }\n      const rows = table.querySelectorAll('tbody tr');\n      rows.forEach(row => {\n        const cells = row.querySelectorAll('td');\n        const rowData: string[] = [];\n        cells.forEach(c => rowData.push((c.textContent || '').trim()));\n        if (rowData.length) text += rowData.join('\\t') + '\\n';\n      });\n      return text.trim();\n    };\n    registry.register({ id: tableId, getTextContent });\n    return () => registry.unregister(tableId);\n  }, [registry, tableData]);\n\n  return (\n    <Card ref={containerRef} className=\"bg-white shadow-lg border border-gray-200 rounded-lg overflow-hidden\">\n      <CardHeader className=\"bg-gradient-to-r from-purple-900 via-purple-950 to-purple-900 text-white pb-4\">\n        <div className=\"flex items-center justify-between w-full\">\n          <CardTitle className=\"text-lg font-bold flex items-center gap-2\">\n            <Calendar className=\"w-5 h-5\" />\n            {tableId}\n            <Badge variant=\"secondary\" className=\"ml-2 bg-white/20 text-white border-white/30\">\n              {monthlyDataByType.length} Entries\n            </Badge>\n          </CardTitle>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"flex items-center gap-2 bg-white/10 rounded-lg p-1\">\n              <Button\n                size=\"sm\"\n                variant=\"ghost\"\n                onClick={() => setRowType('clientType')}\n                className={`min-w-[100px] ${rowType === 'clientType' ? 'bg-gradient-to-r from-slate-700 to-slate-800 text-white' : 'text-white hover:bg-white/20'}`}\n              >\n                Client Type\n              </Button>\n              <Button\n                size=\"sm\"\n                variant=\"ghost\"\n                onClick={() => setRowType('membership')}\n                className={`min-w-[100px] ${rowType === 'membership' ? 'bg-gradient-to-r from-slate-700 to-slate-800 text-white' : 'text-white hover:bg-white/20'}`}\n              >\n                Membership\n              </Button>\n              <Button\n                size=\"sm\"\n                variant=\"ghost\"\n                onClick={() => setRowType('teacher')}\n                className={`min-w-[100px] ${rowType === 'teacher' ? 'bg-gradient-to-r from-slate-700 to-slate-800 text-white' : 'text-white hover:bg-white/20'}`}\n              >\n                Teacher\n              </Button>\n            </div>\n            <CopyTableButton\n              tableRef={containerRef as any}\n              tableName={tableId}\n              size=\"sm\"\n              onCopyAllTabs={registry ? async () => registry.getAllTabsContent() : undefined}\n            />\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent className=\"p-0 overflow-hidden\">\n        <div className=\"overflow-x-auto max-h-[600px]\">\n          <Table className=\"w-full\">\n            <TableHeader className=\"sticky top-0 z-20\">\n              <TableRow className=\"bg-gradient-to-r from-purple-900 via-purple-950 to-purple-900 border-b\" style={{ maxHeight: '35px' }}>\n                <TableHead onClick={() => handleSort('month')} className=\"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-4 sticky left-0 z-10 bg-purple-950\" style={{ width: '300px', minWidth: '300px', maxHeight: '35px' }}>Month</TableHead>\n                <TableHead onClick={() => handleSort('type')} className=\"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[200px]\" style={{ maxHeight: '35px' }}>{rowType === 'clientType' ? 'Type' : rowType === 'membership' ? 'Membership' : 'Teacher'}</TableHead>\n                <TableHead onClick={() => handleSort('totalTrials')} className=\"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[80px]\">Trials</TableHead>\n                <TableHead onClick={() => handleSort('newMembers')} className=\"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[90px]\">New Members</TableHead>\n                <TableHead onClick={() => handleSort('retained')} className=\"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[80px]\">Retained</TableHead>\n                <TableHead onClick={() => handleSort('retentionRate')} className=\"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[80px]\">Retention %</TableHead>\n                <TableHead onClick={() => handleSort('converted')} className=\"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[80px]\">Converted</TableHead>\n                <TableHead onClick={() => handleSort('conversionRate')} className=\"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[80px]\">Conversion %</TableHead>\n                <TableHead onClick={() => handleSort('avgLTV')} className=\"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[80px]\">Avg LTV</TableHead>\n                <TableHead onClick={() => handleSort('totalLTV')} className=\"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[80px]\">Total LTV</TableHead>\n                <TableHead onClick={() => handleSort('avgConversionDays')} className=\"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[80px]\">Avg Conv Days</TableHead>\n                <TableHead onClick={() => handleSort('avgVisits')} className=\"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[80px]\">Avg Visits</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {displayedData.map((row) => (\n                <TableRow\n                  key={`${row.month}-${row.type}`}\n                  className=\"hover:bg-gray-50 transition-colors cursor-pointer border-b border-gray-100\"\n                  style={{ maxHeight: '35px' }}\n                  onClick={() => onRowClick?.(row)}\n                >\n                  <TableCell className=\"text-xs px-4 sticky left-0 bg-white z-10 border-r\" style={{ width: '300px', minWidth: '300px', maxHeight: '35px' }}>\n                    <span className=\"text-sm font-medium text-slate-900\">{row.month}</span>\n                  </TableCell>\n                  <TableCell className=\"text-xs px-3 text-left\">\n                    <span className=\"text-sm font-medium text-slate-900\">{row.type}</span>\n                  </TableCell>\n                  <TableCell className=\"text-xs px-3 text-center font-medium text-slate-900\">{formatNumber(row.totalTrials)}</TableCell>\n                  <TableCell className=\"text-xs px-3 text-center font-medium text-slate-900\">{formatNumber(row.newMembers)}</TableCell>\n                  <TableCell className=\"text-xs px-3 text-center font-medium text-slate-900\">{formatNumber(row.retained)}</TableCell>\n                  <TableCell className=\"text-xs px-3 text-center\">\n                    <span className=\"text-sm font-medium text-slate-900\">{row.retentionRate.toFixed(1)}%</span>\n                  </TableCell>\n                  <TableCell className=\"text-xs px-3 text-center font-medium text-slate-900\">{formatNumber(row.converted)}</TableCell>\n                  <TableCell className=\"text-xs px-3 text-center\">\n                    <span className=\"text-sm font-medium text-slate-900\">{row.conversionRate.toFixed(1)}%</span>\n                  </TableCell>\n                  <TableCell className=\"text-xs px-3 text-right font-medium text-slate-900\">{formatCurrency(row.avgLTV)}</TableCell>\n                  <TableCell className=\"text-xs px-3 text-right font-medium text-slate-900\">{formatCurrency(row.totalLTV)}</TableCell>\n                  <TableCell className=\"text-xs px-3 text-center font-medium text-slate-900\">{row.avgConversionDays.toFixed(0)} days</TableCell>\n                  <TableCell className=\"text-xs px-3 text-center font-medium text-slate-900\">{row.avgVisits.toFixed(1)}</TableCell>\n                </TableRow>\n              ))}\n              <TableRow className=\"border-t-4 border-gray-800 text-gray-900\">\n                <TableCell className=\"border-t-4 border-gray-800 text-gray-900\">{totalsRow.month}</TableCell>\n                <TableCell className=\"text-xs px-3 text-center\">\n                  <Badge variant=\"outline\" className=\"text-xs font-bold\">\n                    {totalsRow.type}\n                  </Badge>\n                </TableCell>\n                <TableCell className=\"text-xs px-3 text-center font-bold\">{formatNumber(totalsRow.totalTrials)}</TableCell>\n                <TableCell className=\"text-xs px-3 text-center font-bold\">{formatNumber(totalsRow.newMembers)}</TableCell>\n                <TableCell className=\"text-xs px-3 text-center font-bold\">{formatNumber(totalsRow.retained)}</TableCell>\n                <TableCell className=\"text-xs px-3 text-center\">\n                  <span className={`font-bold ${totalsRow.retentionRate >= 70 ? 'text-green-600' : totalsRow.retentionRate >= 50 ? 'text-orange-600' : 'text-red-600'}`}>{totalsRow.retentionRate.toFixed(1)}%</span>\n                </TableCell>\n                <TableCell className=\"text-xs px-3 text-center font-bold\">{formatNumber(totalsRow.converted)}</TableCell>\n                <TableCell className=\"text-xs px-3 text-center\">\n                  <span className={`font-bold ${totalsRow.conversionRate >= 50 ? 'text-green-600' : totalsRow.conversionRate >= 30 ? 'text-orange-600' : 'text-red-600'}`}>{totalsRow.conversionRate.toFixed(1)}%</span>\n                </TableCell>\n                <TableCell className=\"text-xs px-3 text-right font-bold text-emerald-600\">{formatCurrency(totalsRow.avgLTV)}</TableCell>\n                <TableCell className=\"text-xs px-3 text-right font-bold text-green-600\">{formatCurrency(totalsRow.totalLTV)}</TableCell>\n                <TableCell className=\"text-xs px-3 text-center font-bold\">{totalsRow.avgConversionDays.toFixed(0)} days</TableCell>\n                <TableCell className=\"text-xs px-3 text-center font-bold\">{totalsRow.avgVisits.toFixed(1)}</TableCell>\n              </TableRow>\n            </TableBody>\n          </Table>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};","import React, { useMemo, useState, useRef, useEffect, useCallback } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { BarChart3, ArrowUpDown } from 'lucide-react';\nimport CopyTableButton from '@/components/ui/CopyTableButton';\nimport { useMetricsTablesRegistry } from '@/contexts/MetricsTablesRegistryContext';\nimport { NewClientData } from '@/types/dashboard';\nimport { parseDate } from '@/utils/dateUtils';\nimport { formatCurrency, formatNumber } from '@/utils/formatters';\n\ntype MetricKey =\n  | 'trials'\n  | 'newMembers'\n  | 'converted'\n  | 'retained'\n  | 'retentionRate'\n  | 'conversionRate'\n  | 'avgLTV'\n  | 'totalLTV'\n  | 'avgConversionDays'\n  | 'avgVisits';\n\nconst METRIC_LABELS: Record<MetricKey, string> = {\n  trials: 'Trials',\n  newMembers: 'New Members',\n  converted: 'Converted',\n  retained: 'Retained',\n  retentionRate: 'Retention %',\n  conversionRate: 'Conversion %',\n  avgLTV: 'Avg LTV',\n  totalLTV: 'Total LTV',\n  avgConversionDays: 'Avg Conv Days',\n  avgVisits: 'Avg Visits',\n};\n\ntype RowType = 'clientType' | 'membership';\n\ninterface Props {\n  data: NewClientData[];\n  onRowClick?: (data: any) => void;\n}\n\nexport const ClientRetentionYearOnYearPivot: React.FC<Props> = ({ data, onRowClick }) => {\n  const [metric, setMetric] = useState<MetricKey>('trials');\n  const [rowType, setRowType] = useState<RowType>('clientType');\n  const [displayMode, setDisplayMode] = useState<'values' | 'growth'>('values');\n  const [sortColumn, setSortColumn] = useState<string | null>(null);\n  const [sortDir, setSortDir] = useState<'asc' | 'desc'>('desc');\n  const containerRef = useRef<HTMLDivElement>(null);\n  const registry = useMetricsTablesRegistry();\n  const tableId = 'Client Retention YoY Pivot';\n  \n  const now = new Date();\n  const currentYear = now.getFullYear();\n  const previousYear = currentYear - 1;\n\n  const months = useMemo(() => {\n    const currentMonth = now.getMonth() + 1;\n    const monthsArr: { key: string; display: string; year: number; month: number; monthName: string }[] = [];\n    \n    // Generate months from Jan to current month only\n    for (let monthNum = 1; monthNum <= currentMonth; monthNum++) {\n      const monthName = new Date(2024, monthNum - 1, 1).toLocaleDateString('en-US', { month: 'short' });\n      \n      // Add 2024 entry\n      monthsArr.push({\n        key: `2024-${String(monthNum).padStart(2, '0')}`,\n        display: `${monthName} 2024`,\n        year: 2024,\n        month: monthNum,\n        monthName: monthName\n      });\n      \n      // Add 2025 entry\n      monthsArr.push({\n        key: `${currentYear}-${String(monthNum).padStart(2, '0')}`,\n        display: `${monthName} ${currentYear}`,\n        year: currentYear,\n        month: monthNum,\n        monthName: monthName\n      });\n    }\n    return monthsArr;\n  }, [currentYear, now]);\n\n  const rowKeys = useMemo(() => {\n    const set = new Set<string>();\n    data.forEach(c => {\n      const key = rowType === 'clientType' ? (c.isNew || 'Unknown') : (c.membershipUsed || 'Unknown');\n      set.add(key);\n    });\n    return Array.from(set).sort((a, b) => {\n      if (rowType === 'clientType') {\n        const an = a.toLowerCase();\n        const bn = b.toLowerCase();\n        if (an.includes('new') && !bn.includes('new')) return -1;\n        if (!an.includes('new') && bn.includes('new')) return 1;\n      }\n      return a.localeCompare(b);\n    });\n  }, [data, rowType]);\n\n  const pivot = useMemo(() => {\n    const initCell = () => ({ \n      trials: 0, \n      newMembers: 0, \n      converted: 0, \n      retained: 0, \n      totalLTV: 0, \n      conversionIntervals: [] as number[],\n      visitsPostTrial: [] as number[],\n      clients: [] as NewClientData[] // Store actual client data for drill-down\n    });\n    const map: Record<string, Record<string, any>> = {};\n    \n    rowKeys.forEach(rk => {\n      map[rk] = {};\n      months.forEach(m => {\n        map[rk][m.key] = initCell();\n      });\n    });\n\n    data.forEach(c => {\n      const d = parseDate(c.firstVisitDate || '');\n      if (!d) return;\n      const year = d.getFullYear();\n      const month = d.getMonth() + 1;\n      const dataKey = `${year}-${String(month).padStart(2, '0')}`;\n      const rowKey = rowType === 'clientType' ? (c.isNew || 'Unknown') : (c.membershipUsed || 'Unknown');\n      \n      if (!map[rowKey]) return;\n      const bucket = map[rowKey][dataKey];\n      if (!bucket) return;\n      \n      bucket.trials += 1;\n      if ((c.isNew || '').toLowerCase().includes('new')) bucket.newMembers += 1;\n      if (c.conversionStatus === 'Converted') bucket.converted += 1;\n      if (c.retentionStatus === 'Retained') bucket.retained += 1;\n      bucket.totalLTV += c.ltv || 0;\n      bucket.clients.push(c); // Add client to bucket\n      \n      // Add conversion interval and visits tracking\n      if (c.conversionSpan !== undefined && c.conversionSpan !== null) {\n        bucket.conversionIntervals.push(c.conversionSpan);\n      }\n      if (c.visitsPostTrial !== undefined && c.visitsPostTrial !== null) {\n        bucket.visitsPostTrial.push(c.visitsPostTrial);\n      }\n    });\n\n    // Derived metrics\n    rowKeys.forEach(rk => {\n      months.forEach(m => {\n        const b = map[rk][m.key];\n        if (!b) return;\n        b.avgLTV = b.trials > 0 ? b.totalLTV / b.trials : 0;\n        b.conversionRate = b.newMembers > 0 ? (b.converted / b.newMembers) * 100 : 0;\n        b.retentionRate = b.newMembers > 0 ? (b.retained / b.newMembers) * 100 : 0;\n        b.avgConversionDays = b.conversionIntervals.length > 0 \n          ? b.conversionIntervals.reduce((sum: number, val: number) => sum + val, 0) / b.conversionIntervals.length \n          : 0;\n        b.avgVisits = b.visitsPostTrial.length > 0\n          ? b.visitsPostTrial.reduce((sum: number, val: number) => sum + val, 0) / b.visitsPostTrial.length\n          : 0;\n      });\n    });\n    \n    return map;\n  }, [data, rowKeys, months, currentYear, previousYear, rowType]);\n\n  const renderValue = (current: any, previous: any) => {\n    let currVal = 0, prevVal = 0;\n    \n    switch (metric) {\n      case 'trials':\n        currVal = current.trials || 0;\n        prevVal = previous.trials || 0;\n        break;\n      case 'newMembers':\n        currVal = current.newMembers || 0;\n        prevVal = previous.newMembers || 0;\n        break;\n      case 'converted':\n        currVal = current.converted || 0;\n        prevVal = previous.converted || 0;\n        break;\n      case 'retained':\n        currVal = current.retained || 0;\n        prevVal = previous.retained || 0;\n        break;\n      case 'conversionRate':\n        currVal = current.conversionRate || 0;\n        prevVal = previous.conversionRate || 0;\n        break;\n      case 'retentionRate':\n        currVal = current.retentionRate || 0;\n        prevVal = previous.retentionRate || 0;\n        break;\n      case 'avgLTV':\n        currVal = current.avgLTV || 0;\n        prevVal = previous.avgLTV || 0;\n        break;\n      case 'totalLTV':\n        currVal = current.totalLTV || 0;\n        prevVal = previous.totalLTV || 0;\n        break;\n      case 'avgConversionDays':\n        currVal = current.avgConversionDays || 0;\n        prevVal = previous.avgConversionDays || 0;\n        break;\n      case 'avgVisits':\n        currVal = current.avgVisits || 0;\n        prevVal = previous.avgVisits || 0;\n        break;\n    }\n\n    if (displayMode === 'growth') {\n      const growth = prevVal !== 0 ? ((currVal - prevVal) / prevVal) * 100 : 0;\n      const isPositive = growth >= 0;\n      return (\n        <span className={`text-xs font-semibold ${isPositive ? 'text-emerald-600' : 'text-rose-600'}`}>\n          {isPositive ? '▲' : '▼'} {Math.abs(growth).toFixed(1)}%\n        </span>\n      );\n    }\n\n    // Values mode: show prev | curr\n    const format = (val: number) => {\n      switch (metric) {\n        case 'trials':\n        case 'newMembers':\n        case 'converted':\n        case 'retained':\n          return formatNumber(val);\n        case 'conversionRate':\n        case 'retentionRate':\n          return `${val.toFixed(1)}%`;\n        case 'avgLTV':\n        case 'totalLTV':\n          return formatCurrency(val);\n        case 'avgConversionDays':\n          return `${val.toFixed(0)} days`;\n        case 'avgVisits':\n          return `${val.toFixed(1)}`;\n        default:\n          return String(val);\n      }\n    };\n\n    return (\n      <div className=\"flex flex-col gap-0.5 text-xs\">\n        <span className=\"text-slate-500\">{format(prevVal)}</span>\n        <span className=\"font-bold text-slate-800\">{format(currVal)}</span>\n      </div>\n    );\n  };\n\n  // Render value with white text for totals row\n  const renderValueWhite = (current: any, previous: any) => {\n    let currVal = 0, prevVal = 0;\n    \n    switch (metric) {\n      case 'trials':\n        currVal = current.trials || 0;\n        prevVal = previous.trials || 0;\n        break;\n      case 'newMembers':\n        currVal = current.newMembers || 0;\n        prevVal = previous.newMembers || 0;\n        break;\n      case 'converted':\n        currVal = current.converted || 0;\n        prevVal = previous.converted || 0;\n        break;\n      case 'retained':\n        currVal = current.retained || 0;\n        prevVal = previous.retained || 0;\n        break;\n      case 'conversionRate':\n        currVal = current.conversionRate || 0;\n        prevVal = previous.conversionRate || 0;\n        break;\n      case 'retentionRate':\n        currVal = current.retentionRate || 0;\n        prevVal = previous.retentionRate || 0;\n        break;\n      case 'avgLTV':\n        currVal = current.avgLTV || 0;\n        prevVal = previous.avgLTV || 0;\n        break;\n      case 'totalLTV':\n        currVal = current.totalLTV || 0;\n        prevVal = previous.totalLTV || 0;\n        break;\n      case 'avgConversionDays':\n        currVal = current.avgConversionDays || 0;\n        prevVal = previous.avgConversionDays || 0;\n        break;\n      case 'avgVisits':\n        currVal = current.avgVisits || 0;\n        prevVal = previous.avgVisits || 0;\n        break;\n    }\n\n    if (displayMode === 'growth') {\n      const growth = prevVal !== 0 ? ((currVal - prevVal) / prevVal) * 100 : 0;\n      const isPositive = growth >= 0;\n      return (\n        <span className=\"text-xs font-semibold text-white\">\n          {isPositive ? '▲' : '▼'} {Math.abs(growth).toFixed(1)}%\n        </span>\n      );\n    }\n\n    // Values mode: show prev | curr with white text\n    const format = (val: number) => {\n      switch (metric) {\n        case 'trials':\n        case 'newMembers':\n        case 'converted':\n        case 'retained':\n          return formatNumber(val);\n        case 'conversionRate':\n        case 'retentionRate':\n          return `${val.toFixed(1)}%`;\n        case 'avgLTV':\n        case 'totalLTV':\n          return formatCurrency(val);\n        case 'avgConversionDays':\n          return `${val.toFixed(0)} days`;\n        case 'avgVisits':\n          return `${val.toFixed(1)}`;\n        default:\n          return String(val);\n      }\n    };\n\n    return (\n      <div className=\"flex flex-col gap-0.5 text-xs\">\n        <span className=\"text-white/70\">{format(prevVal)}</span>\n        <span className=\"font-bold text-white\">{format(currVal)}</span>\n      </div>\n    );\n  };\n\n  const sortedRowKeys = useMemo(() => {\n    if (!sortColumn) return rowKeys;\n    \n    const sorted = [...rowKeys].sort((a, b) => {\n      if (sortColumn === 'row') return a.localeCompare(b);\n      \n      const aData = pivot[a];\n      const bData = pivot[b];\n      if (!aData || !bData) return 0;\n      \n      const aCurr = aData.current[sortColumn];\n      const bCurr = bData.current[sortColumn];\n      if (!aCurr || !bCurr) return 0;\n      \n      let aVal = 0, bVal = 0;\n      switch (metric) {\n        case 'trials': aVal = aCurr.trials || 0; bVal = bCurr.trials || 0; break;\n        case 'newMembers': aVal = aCurr.newMembers || 0; bVal = bCurr.newMembers || 0; break;\n        case 'converted': aVal = aCurr.converted || 0; bVal = bCurr.converted || 0; break;\n        case 'retained': aVal = aCurr.retained || 0; bVal = bCurr.retained || 0; break;\n        case 'retentionRate': aVal = aCurr.retentionRate || 0; bVal = bCurr.retentionRate || 0; break;\n        case 'conversionRate': aVal = aCurr.conversionRate || 0; bVal = bCurr.conversionRate || 0; break;\n        case 'avgLTV': aVal = aCurr.avgLTV || 0; bVal = bCurr.avgLTV || 0; break;\n        case 'totalLTV': aVal = aCurr.totalLTV || 0; bVal = bCurr.totalLTV || 0; break;\n      }\n      \n      return sortDir === 'desc' ? bVal - aVal : aVal - bVal;\n    });\n    \n    return sorted;\n  }, [rowKeys, sortColumn, sortDir, pivot, metric]);\n\n  const handleSort = (col: string) => {\n    if (sortColumn === col) {\n      setSortDir(d => d === 'desc' ? 'asc' : 'desc');\n    } else {\n      setSortColumn(col);\n      setSortDir('desc');\n    }\n  };\n\n  // Calculate totals\n  const totalsRow = useMemo(() => {\n    const totals: Record<string, any> = {};\n    \n    months.forEach(m => {\n      totals[m.key] = { \n        trials: 0, \n        newMembers: 0, \n        converted: 0, \n        retained: 0, \n        totalLTV: 0,\n        conversionIntervals: [] as number[],\n        visitsPostTrial: [] as number[],\n        clients: [] as NewClientData[]\n      };\n      \n      rowKeys.forEach(rk => {\n        const cell = pivot[rk]?.[m.key];\n        \n        if (cell) {\n          totals[m.key].trials += cell.trials || 0;\n          totals[m.key].newMembers += cell.newMembers || 0;\n          totals[m.key].converted += cell.converted || 0;\n          totals[m.key].retained += cell.retained || 0;\n          totals[m.key].totalLTV += cell.totalLTV || 0;\n          totals[m.key].conversionIntervals.push(...(cell.conversionIntervals || []));\n          totals[m.key].visitsPostTrial.push(...(cell.visitsPostTrial || []));\n          totals[m.key].clients.push(...(cell.clients || []));\n        }\n      });\n      \n      const b = totals[m.key];\n      b.avgLTV = b.trials > 0 ? b.totalLTV / b.trials : 0;\n      b.conversionRate = b.newMembers > 0 ? (b.converted / b.newMembers) * 100 : 0;\n      b.retentionRate = b.newMembers > 0 ? (b.retained / b.newMembers) * 100 : 0;\n      b.avgConversionDays = b.conversionIntervals.length > 0 \n        ? b.conversionIntervals.reduce((sum: number, val: number) => sum + val, 0) / b.conversionIntervals.length \n        : 0;\n      b.avgVisits = b.visitsPostTrial.length > 0\n        ? b.visitsPostTrial.reduce((sum: number, val: number) => sum + val, 0) / b.visitsPostTrial.length\n        : 0;\n    });\n    \n    return totals;\n  }, [pivot, rowKeys, months]);\n\n  // Multi-metric export across ALL metrics & months for both previous and current year\n  const generateAllTabsContent = useCallback(() => {\n    const sections: string[] = [];\n    sections.push(`${tableId} - All Metrics Export`);\n    sections.push(`Exported on ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}`);\n    sections.push(`Row Mode: ${rowType}`);\n    sections.push('');\n\n    const metricKeys = Object.keys(METRIC_LABELS) as MetricKey[];\n    const formatVal = (mk: MetricKey, cell: any) => {\n      switch (mk) {\n        case 'trials': return formatNumber(cell?.trials || 0);\n        case 'newMembers': return formatNumber(cell?.newMembers || 0);\n        case 'converted': return formatNumber(cell?.converted || 0);\n        case 'retained': return formatNumber(cell?.retained || 0);\n        case 'retentionRate': return `${(cell?.retentionRate || 0).toFixed(1)}%`;\n        case 'conversionRate': return `${(cell?.conversionRate || 0).toFixed(1)}%`;\n        case 'avgLTV': return formatCurrency(cell?.avgLTV || 0);\n        case 'totalLTV': return formatCurrency(cell?.totalLTV || 0);\n        case 'avgConversionDays': return `${Math.round(cell?.avgConversionDays || 0)}`;\n        case 'avgVisits': return `${(cell?.avgVisits || 0).toFixed(1)}`;\n      }\n    };\n\n    metricKeys.forEach(mk => {\n      sections.push(`\\n${METRIC_LABELS[mk].toUpperCase()}`);\n      const headers = [rowType === 'clientType' ? 'Client Type' : 'Membership'];\n      months.forEach(m => headers.push(m.display));\n      sections.push(headers.join('\\t'));\n      sections.push(headers.map(() => '---').join('\\t'));\n\n      rowKeys.forEach(rk => {\n        const row: string[] = [rk];\n        months.forEach(m => {\n          const cell = pivot[rk]?.[m.key];\n          row.push(formatVal(mk, cell) as string);\n        });\n        sections.push(row.join('\\t'));\n      });\n\n      // Totals row\n      const totalRow: string[] = ['TOTALS'];\n      months.forEach(m => {\n        const cell = totalsRow[m.key];\n        totalRow.push(formatVal(mk, cell) as string);\n      });\n      sections.push(totalRow.join('\\t'));\n    });\n\n    return sections.join('\\n');\n  }, [pivot, rowKeys, months, totalsRow, rowType, tableId]);\n\n  useEffect(() => {\n    if (!registry) return;\n    const el = containerRef.current;\n    if (!el) return;\n    const getTextContent = () => {\n      const table = el.querySelector('table');\n      if (!table) return `${tableId} (No Data)`;\n      let text = `${tableId}\\nMetric: ${METRIC_LABELS[metric]} | Mode: ${displayMode} | Rows: ${rowType}\\n`;\n      const headerCells = table.querySelectorAll('thead th');\n      const headers: string[] = [];\n      headerCells.forEach(h => headers.push((h.textContent || '').trim().replace(/Prev \\| Curr/i, '').trim()));\n      if (headers.length) {\n        text += headers.join('\\t') + '\\n';\n        text += headers.map(() => '---').join('\\t') + '\\n';\n      }\n      const rows = table.querySelectorAll('tbody tr');\n      rows.forEach(r => {\n        const cells = r.querySelectorAll('td');\n        const rowData: string[] = [];\n        cells.forEach(c => rowData.push((c.textContent || '').trim()));\n        if (rowData.length) text += rowData.join('\\t') + '\\n';\n      });\n      return text.trim();\n    };\n    registry.register({ id: tableId, getTextContent });\n    return () => registry.unregister(tableId);\n  }, [registry, metric, displayMode, rowType, pivot, sortedRowKeys]);\n\n  return (\n    <Card ref={containerRef} className=\"bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-shadow duration-300\">\n      <div className=\"absolute inset-x-0 top-0 h-1.5 bg-gradient-to-r from-emerald-500 via-teal-500 to-cyan-500\" />\n      <CardHeader className=\"border-b border-gray-100 bg-gradient-to-r from-emerald-700 to-teal-800 text-white pt-4\">\n        <div className=\"flex flex-col gap-3\">\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"flex items-center gap-2\">\n              <BarChart3 className=\"w-5 h-5\" />\n              Year-on-Year Analysis\n              <Badge variant=\"secondary\" className=\"bg-white/20 text-white\">{previousYear} vs {currentYear}</Badge>\n              <div className=\"ml-4\">\n                <CopyTableButton\n                  tableRef={containerRef as any}\n                  tableName={tableId}\n                  size=\"sm\"\n                  onCopyAllTabs={async () => generateAllTabsContent()}\n                />\n              </div>\n            </CardTitle>\n            <div className=\"flex items-center gap-2\">\n              <Button\n                size=\"sm\"\n                variant={displayMode === 'values' ? 'default' : 'outline'}\n                onClick={() => setDisplayMode('values')}\n                className={displayMode === 'values' ? 'bg-white text-emerald-700 hover:bg-white/90' : 'bg-white/10 text-white hover:bg-white/20 border-white/30'}\n              >\n                Values\n              </Button>\n              <Button\n                size=\"sm\"\n                variant={displayMode === 'growth' ? 'default' : 'outline'}\n                onClick={() => setDisplayMode('growth')}\n                className={displayMode === 'growth' ? 'bg-white text-emerald-700 hover:bg-white/90' : 'bg-white/10 text-white hover:bg-white/20 border-white/30'}\n              >\n                Growth %\n              </Button>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-3 flex-wrap\">\n            <div className=\"flex items-center gap-2 bg-white/10 rounded-lg p-1\">\n              <Button\n                size=\"sm\"\n                variant=\"ghost\"\n                onClick={() => setRowType('clientType')}\n                className={`min-w-[110px] ${rowType === 'clientType' ? 'bg-white text-emerald-700' : 'text-white hover:bg-white/20'}`}\n              >\n                Client Type\n              </Button>\n              <Button\n                size=\"sm\"\n                variant=\"ghost\"\n                onClick={() => setRowType('membership')}\n                className={`min-w-[110px] ${rowType === 'membership' ? 'bg-white text-emerald-700' : 'text-white hover:bg-white/20'}`}\n              >\n                Membership\n              </Button>\n            </div>\n            <div className=\"flex items-center gap-2 flex-wrap\">\n              {(Object.keys(METRIC_LABELS) as MetricKey[]).map(k => (\n                <button\n                  key={k}\n                  onClick={() => setMetric(k)}\n                  className={`px-3 py-1.5 rounded-md text-xs font-semibold transition-all min-w-[90px] ${metric === k ? 'bg-white text-emerald-700 shadow-md' : 'bg-white/10 text-white hover:bg-white/20'}`}\n                  title={METRIC_LABELS[k]}\n                >\n                  {METRIC_LABELS[k]}\n                </button>\n              ))}\n            </div>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent className=\"p-0\">\n  <div className=\"overflow-x-auto max-h-[900px] relative\">\n          <table className=\"min-w-full relative\">\n            <thead>\n              <tr className=\"bg-gradient-to-r from-green-800 via-green-900 to-green-800 text-white sticky top-0 z-10\">\n                <th \n                  className=\"px-4 py-3 text-left sticky left-0 z-20 font-bold text-xs uppercase tracking-wide cursor-pointer select-none border-r border-white/20 bg-green-900\"\n                  style={{ width: '300px', minWidth: '300px' }}\n                  onClick={() => handleSort('row')}\n                >\n                  <div className=\"flex items-center gap-1\">\n                    {rowType === 'clientType' ? 'Client Type' : 'Membership'}\n                    <ArrowUpDown className=\"w-3 h-3\" />\n                  </div>\n                </th>\n                {months.map((m, index) => {\n                  const prevMonth = index > 0 ? months[index - 1] : null;\n                  const nextMonth = index < months.length - 1 ? months[index + 1] : null;\n                  \n                  const isFirstOfGroup = !prevMonth || prevMonth.month !== m.month;\n                  const isLastOfGroup = !nextMonth || nextMonth.month !== m.month;\n                  \n                  return (\n                    <th \n                      key={m.key} \n                      className={`px-3 py-3 text-center font-bold text-xs uppercase tracking-wider min-w-[90px] cursor-pointer hover:bg-green-700/50 select-none sticky top-0 ${\n                        isFirstOfGroup ? 'border-l-2 border-green-400' : ''\n                      } ${\n                        isLastOfGroup ? 'border-r-2 border-green-400' : ''\n                      }`}\n                      onClick={() => handleSort(m.key)}\n                    >\n                      <div className=\"flex flex-col items-center\">\n                        <span className=\"text-xs font-bold whitespace-nowrap leading-tight\">{m.monthName}</span>\n                        <span className=\"text-green-300 text-xs leading-tight\">{m.year}</span>\n                      </div>\n                    </th>\n                  );\n                })}\n              </tr>\n            </thead>\n            <tbody>\n              {sortedRowKeys.map((rk) => (\n                <tr \n                  key={rk} \n                  className=\"border-b border-slate-100 hover:bg-slate-50 cursor-pointer transition-colors\"\n                  style={{ maxHeight: '35px' }}\n                  onClick={() => {\n                    // Aggregate clients from all months for this row\n                    const allClients = months.flatMap(m => pivot[rk]?.[m.key]?.clients || []);\n                    onRowClick?.({ \n                      rowKey: rk, \n                      rowType, \n                      data: pivot[rk], \n                      metric,\n                      clients: allClients\n                    });\n                  }}\n                >\n                  <td className=\"px-4 py-2 text-sm font-semibold text-slate-800 sticky left-0 bg-white hover:bg-slate-50 z-10 border-r\" style={{ width: '300px', minWidth: '300px', maxHeight: '35px' }}>{rk}</td>\n                  {months.map((m, index) => {\n                    const prevMonth = index > 0 ? months[index - 1] : null;\n                    const nextMonth = index < months.length - 1 ? months[index + 1] : null;\n                    \n                    const isFirstOfGroup = !prevMonth || prevMonth.month !== m.month;\n                    const isLastOfGroup = !nextMonth || nextMonth.month !== m.month;\n                    \n                    const cellData = pivot[rk]?.[m.key];\n                    \n                    return (\n                      <td \n                        key={m.key} \n                        className={`px-2 py-2 text-center text-sm font-mono text-slate-800 ${\n                          isFirstOfGroup ? 'border-l-2 border-slate-300' : 'border-l'\n                        } ${\n                          isLastOfGroup ? 'border-r-2 border-slate-300' : ''\n                        }`}\n                        style={{ maxHeight: '35px' }}\n                        onClick={(e) => {\n                          // Allow clicking individual cells for month-specific drill-down\n                          e.stopPropagation();\n                          const clients = cellData?.clients || [];\n                          onRowClick?.({ \n                            rowKey: rk, \n                            rowType,\n                            month: m.month,\n                            year: m.year,\n                            data: cellData,\n                            metric,\n                            clients: clients\n                          });\n                        }}\n                      >\n                        {(() => {\n                          const val = cellData || {};\n                          switch (metric) {\n                            case 'trials': return formatNumber(val.trials || 0);\n                            case 'newMembers': return formatNumber(val.newMembers || 0);\n                            case 'converted': return formatNumber(val.converted || 0);\n                            case 'retained': return formatNumber(val.retained || 0);\n                            case 'conversionRate': return `${(val.conversionRate || 0).toFixed(1)}%`;\n                            case 'retentionRate': return `${(val.retentionRate || 0).toFixed(1)}%`;\n                            case 'avgLTV': return formatCurrency(val.avgLTV || 0);\n                            case 'totalLTV': return formatCurrency(val.totalLTV || 0);\n                            case 'avgConversionDays': return `${(val.avgConversionDays || 0).toFixed(0)}`;\n                            case 'avgVisits': return `${(val.avgVisits || 0).toFixed(1)}`;\n                          }\n                        })()}\n                      </td>\n                    );\n                  })}\n                </tr>\n              ))}\n              {/* Totals Row */}\n              <tr className=\"bg-slate-800 font-bold border-t-4 border-slate-600\" style={{ maxHeight: '35px' }}>\n                <td className=\"px-4 py-2 text-sm text-white sticky left-0 bg-slate-800 z-10 border-r\" style={{ width: '300px', minWidth: '300px', maxHeight: '35px' }}>TOTALS</td>\n                {months.map((m, index) => {\n                  const prevMonth = index > 0 ? months[index - 1] : null;\n                  const nextMonth = index < months.length - 1 ? months[index + 1] : null;\n                  \n                  const isFirstOfGroup = !prevMonth || prevMonth.month !== m.month;\n                  const isLastOfGroup = !nextMonth || nextMonth.month !== m.month;\n                  \n                  const cellData = totalsRow[m.key];\n                  \n                  return (\n                    <td \n                      key={m.key} \n                      className={`px-2 py-2 text-center text-sm font-mono text-white cursor-pointer hover:bg-slate-700 ${\n                        isFirstOfGroup ? 'border-l-2 border-slate-500' : 'border-l'\n                      } ${\n                        isLastOfGroup ? 'border-r-2 border-slate-500' : ''\n                      }`}\n                      style={{ maxHeight: '35px' }}\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        const clients = cellData?.clients || [];\n                        onRowClick?.({ \n                          rowKey: 'TOTALS', \n                          rowType,\n                          month: m.month,\n                          year: m.year,\n                          data: cellData,\n                          metric,\n                          clients: clients\n                        });\n                      }}\n                    >\n                      {(() => {\n                        const val = cellData || {};\n                        switch (metric) {\n                          case 'trials': return formatNumber(val.trials || 0);\n                          case 'newMembers': return formatNumber(val.newMembers || 0);\n                          case 'converted': return formatNumber(val.converted || 0);\n                          case 'retained': return formatNumber(val.retained || 0);\n                          case 'conversionRate': return `${(val.conversionRate || 0).toFixed(1)}%`;\n                          case 'retentionRate': return `${(val.retentionRate || 0).toFixed(1)}%`;\n                          case 'avgLTV': return formatCurrency(val.avgLTV || 0);\n                          case 'totalLTV': return formatCurrency(val.totalLTV || 0);\n                          case 'avgConversionDays': return `${(val.avgConversionDays || 0).toFixed(0)}`;\n                          case 'avgVisits': return `${(val.avgVisits || 0).toFixed(1)}`;\n                        }\n                      })()}\n                    </td>\n                  );\n                })}\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n\nexport default ClientRetentionYearOnYearPivot;\n","\nimport React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Award, TrendingUp, TrendingDown } from 'lucide-react';\nimport { formatCurrency, formatNumber } from '@/utils/formatters';\nimport { NewClientData } from '@/types/dashboard';\nimport { ModernDataTable } from '@/components/ui/ModernDataTable';\n\ninterface ClientConversionMembershipTableProps {\n  data: NewClientData[];\n}\n\nexport const ClientConversionMembershipTable: React.FC<ClientConversionMembershipTableProps> = ({ data }) => {\n  const [sortField, setSortField] = React.useState<string | undefined>(undefined);\n  const [sortDirection, setSortDirection] = React.useState<'asc' | 'desc'>('desc');\n  const membershipData = React.useMemo(() => {\n    const membershipStats = data.reduce((acc, client) => {\n      const membership = client.membershipUsed || 'No Membership';\n      if (!acc[membership]) {\n        acc[membership] = {\n          membershipType: membership,\n          totalMembers: 0,\n          newMembers: 0,\n          converted: 0,\n          retained: 0,\n          totalLTV: 0,\n          totalVisits: 0,\n          conversionSpans: []\n        };\n      }\n      \n      acc[membership].totalMembers++;\n      \n      // Count new members - when isNew contains \"new\" (case-insensitive)\n      if ((client.isNew || '').toLowerCase().includes('new')) {\n        acc[membership].newMembers++;\n      }\n      \n      // Strict equality per business rule\n      if (client.conversionStatus === 'Converted') acc[membership].converted++;\n      if (client.retentionStatus === 'Retained') acc[membership].retained++;\n      acc[membership].totalLTV += client.ltv || 0;\n      acc[membership].totalVisits += client.visitsPostTrial || 0;\n      if (client.conversionSpan && client.conversionSpan > 0) {\n        acc[membership].conversionSpans.push(client.conversionSpan);\n      }\n      \n      return acc;\n    }, {} as Record<string, any>);\n\n    return Object.values(membershipStats)\n      .map((stat: any) => ({\n        ...stat,\n        conversionRate: stat.newMembers > 0 ? (stat.converted / stat.newMembers) * 100 : 0,\n  // Standardize retention rate: retained / newMembers\n  retentionRate: stat.newMembers > 0 ? (stat.retained / stat.newMembers) * 100 : 0,\n        avgLTV: stat.totalMembers > 0 ? stat.totalLTV / stat.totalMembers : 0,\n        avgVisits: stat.totalMembers > 0 ? stat.totalVisits / stat.totalMembers : 0,\n        avgConversionSpan: stat.conversionSpans.length > 0 \n          ? stat.conversionSpans.reduce((a: number, b: number) => a + b, 0) / stat.conversionSpans.length \n          : 0\n      }))\n      .filter((stat: any) => stat.totalMembers > 0)\n      .sort((a: any, b: any) => b.totalMembers - a.totalMembers);\n  }, [data]);\n\n  const columns = [\n    {\n      key: 'membershipType' as const,\n      header: 'Membership Type',\n      className: 'font-medium text-xs min-w-[240px]',\n      sortable: true,\n      render: (value: string) => (\n        <span className=\"text-sm font-medium text-slate-700 truncate\" title={value}>{value}</span>\n      )\n    },\n    {\n      key: 'totalMembers' as const,\n      header: 'Trials',\n      align: 'center' as const,\n      sortable: true,\n      render: (value: number) => <span className=\"text-sm font-medium text-slate-700\">{formatNumber(value)}</span>\n    },\n    {\n      key: 'newMembers' as const,\n      header: 'New Members',\n      align: 'center' as const,\n      sortable: true,\n      render: (value: number) => <span className=\"text-sm font-medium text-slate-700\">{formatNumber(value)}</span>\n    },\n    {\n      key: 'retained' as const,\n      header: 'Retained',\n      align: 'center' as const,\n      sortable: true,\n      render: (value: number) => <span className=\"text-sm font-medium text-slate-700\">{formatNumber(value)}</span>\n    },\n    {\n      key: 'retentionRate' as const,\n      header: 'Retention %',\n      align: 'center' as const,\n      sortable: true,\n      render: (value: number) => <span className=\"text-sm font-medium text-slate-700\">{value.toFixed(1)}%</span>\n    },\n    {\n      key: 'converted' as const,\n      header: 'Converted',\n      align: 'center' as const,\n      sortable: true,\n      render: (value: number) => <span className=\"text-sm font-medium text-slate-700\">{formatNumber(value)}</span>\n    },\n    {\n      key: 'conversionRate' as const,\n      header: 'Conversion %',\n      align: 'center' as const,\n      sortable: true,\n      render: (value: number) => <span className=\"text-sm font-medium text-slate-700\">{value.toFixed(1)}%</span>\n    },\n    {\n      key: 'avgLTV' as const,\n      header: 'Avg LTV',\n      align: 'right' as const,\n      sortable: true,\n      render: (value: number) => <span className=\"text-sm font-medium text-slate-700\">{formatCurrency(value)}</span>\n    },\n    {\n      key: 'totalLTV' as const,\n      header: 'Total LTV',\n      align: 'right' as const,\n      sortable: true,\n      render: (value: number) => <span className=\"text-sm font-medium text-slate-700\">{formatCurrency(value)}</span>\n    }\n  ];\n\n  // Calculate totals with consistent calculation\n  const totals = {\n    membershipType: 'TOTAL',\n    totalMembers: membershipData.reduce((sum, row) => sum + row.totalMembers, 0),\n    newMembers: membershipData.reduce((sum, row) => sum + row.newMembers, 0),\n    converted: membershipData.reduce((sum, row) => sum + row.converted, 0),\n    conversionRate: 0,\n    retained: membershipData.reduce((sum, row) => sum + row.retained, 0),\n    retentionRate: 0,\n    totalLTV: membershipData.reduce((sum, row) => sum + row.totalLTV, 0),\n    avgLTV: membershipData.reduce((sum, row) => sum + row.totalLTV, 0) / Math.max(membershipData.reduce((sum, row) => sum + row.totalMembers, 0), 1)\n  };\n  totals.conversionRate = totals.newMembers > 0 ? (totals.converted / totals.newMembers) * 100 : 0;\n  totals.retentionRate = totals.newMembers > 0 ? (totals.retained / totals.newMembers) * 100 : 0;\n\n  const displayedData = React.useMemo(() => {\n    if (!sortField) return membershipData;\n    const arr = [...membershipData];\n    return arr.sort((a: any, b: any) => {\n      const av = a[sortField as any];\n      const bv = b[sortField as any];\n      const dir = sortDirection === 'asc' ? 1 : -1;\n      if (typeof av === 'number' && typeof bv === 'number') return (av - bv) * dir;\n      return String(av ?? '').localeCompare(String(bv ?? '')) * dir;\n    });\n  }, [membershipData, sortField, sortDirection]);\n\n  const handleSort = (field: string) => {\n    if (sortField === field) setSortDirection(prev => (prev === 'asc' ? 'desc' : 'asc'));\n    else { setSortField(field); setSortDirection('desc'); }\n  };\n\n  return (\n    <Card className=\"bg-white shadow-lg border-0\">\n  <CardHeader className=\"border-b border-gray-100 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white\">\n        <CardTitle className=\"flex items-center gap-2\">\n          <Award className=\"w-5 h-5\" />\n          Membership Type Performance Analysis\n          <Badge variant=\"secondary\" className=\"bg-white/20 text-white\">\n            {membershipData.length} Types\n          </Badge>\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"p-0\">\n        <ModernDataTable\n          data={displayedData}\n          columns={columns}\n          headerGradient=\"from-slate-800 via-slate-900 to-slate-800\"\n          showFooter={true}\n          footerData={totals}\n          maxHeight=\"500px\"\n          onSort={handleSort}\n          sortField={sortField}\n          sortDirection={sortDirection}\n          tableId=\"Membership Type Performance Analysis\"\n        />\n        <div className=\"border-t border-slate-200 p-4 bg-slate-50\">\n          <ul className=\"list-disc pl-5 text-sm text-slate-600 space-y-1\">\n            <li>Top membership by trials: {(() => {\n              if (membershipData.length === 0) return 'N/A';\n              const top = [...membershipData].sort((a,b) => b.totalMembers - a.totalMembers)[0];\n              return `${top.membershipType} (${formatNumber(top.totalMembers)})`;\n            })()}</li>\n            <li>Best conversion: {(() => {\n              const withNew = membershipData.filter(r => r.newMembers > 0);\n              if (withNew.length === 0) return 'N/A';\n              const top = [...withNew].sort((a,b) => b.conversionRate - a.conversionRate)[0];\n              return `${top.membershipType} at ${top.conversionRate.toFixed(1)}%`;\n            })()}</li>\n            <li>Best retention: {(() => {\n              const withNew = membershipData.filter(r => r.newMembers > 0);\n              if (withNew.length === 0) return 'N/A';\n              const top = [...withNew].sort((a,b) => b.retentionRate - a.retentionRate)[0];\n              return `${top.membershipType} at ${top.retentionRate.toFixed(1)}%`;\n            })()}</li>\n          </ul>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n","import React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Dumbbell, TrendingUp, TrendingDown } from 'lucide-react';\nimport { formatCurrency, formatNumber } from '@/utils/formatters';\nimport { NewClientData } from '@/types/dashboard';\nimport { ModernDataTable } from '@/components/ui/ModernDataTable';\nimport { motion } from 'framer-motion';\n\ninterface ClientHostedClassesTableProps {\n  data: NewClientData[];\n  onRowClick?: (classData: any) => void;\n}\n\nexport const ClientHostedClassesTable: React.FC<ClientHostedClassesTableProps> = ({ data, onRowClick }) => {\n  const [sortField, setSortField] = React.useState<string | undefined>(undefined);\n  const [sortDirection, setSortDirection] = React.useState<'asc' | 'desc'>('desc');\n\n  // Early return if no data\n  if (!data || data.length === 0) {\n    return (\n      <Card className=\"bg-white shadow-xl border-0 overflow-hidden\">\n  <CardHeader className=\"border-b border-gray-100 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <Dumbbell className=\"w-5 h-5\" />\n            Hosted Classes Performance Analysis\n            <Badge variant=\"secondary\" className=\"bg-white/20 text-white\">\n              0 Classes\n            </Badge>\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"p-6\">\n          <p className=\"text-gray-500 text-center\">No class data available for analysis.</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const hostedClassData = React.useMemo(() => {\n    // Filter data to only include hosted classes based on class name\n    const filteredData = data.filter(client => {\n      if (!client || !client.firstVisitEntityName) return false;\n      \n      const className = client.firstVisitEntityName.toLowerCase();\n      // Hosted classes contain any of: host, hosted, p57, birthday, rugby, lrs\n      const tokens = ['host', 'hosted', 'p57', 'birthday', 'rugby', 'lrs'];\n      return tokens.some(t => className.includes(t));\n    });\n\n    const classStats = filteredData.reduce((acc, client) => {\n      // Safety checks for client data\n      if (!client) return acc;\n      \n      const className = client.firstVisitEntityName || 'Unknown Class';\n      \n      // Parse date properly from \"01/01/2020, 17:30:00\" format\n      let month = 'Unknown';\n      if (client.firstVisitDate) {\n        try {\n          let date: Date;\n          if (client.firstVisitDate.includes('/')) {\n            const datePart = client.firstVisitDate.split(',')[0].trim();\n            const [day, monthNum, year] = datePart.split('/');\n            date = new Date(parseInt(year), parseInt(monthNum) - 1, parseInt(day));\n          } else {\n            date = new Date(client.firstVisitDate);\n          }\n          \n          if (!isNaN(date.getTime())) {\n            month = date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });\n          }\n        } catch (error) {\n          // Silently fail on date parsing errors\n        }\n      }\n      \n      const key = `${month}-${className}`;\n      \n      if (!acc[key]) {\n        acc[key] = {\n          month,\n          className,\n          totalMembers: 0,\n          newMembers: 0,\n          converted: 0,\n          retained: 0,\n          totalLTV: 0,\n          conversionIntervals: [],\n          clients: []\n        };\n      }\n      \n      acc[key].totalMembers++;\n      acc[key].clients.push(client);\n      \n      // Count new members - when isNew contains \"new\" (case insensitive)\n      if ((client.isNew || '').toLowerCase().includes('new')) {\n        acc[key].newMembers++;\n      }\n      \n      // Count converted - when conversionStatus is exactly \"Converted\"\n      if (client.conversionStatus === 'Converted') {\n        acc[key].converted++;\n      }\n      \n      // Count retained - when retentionStatus is exactly \"Retained\"\n      if (client.retentionStatus === 'Retained') {\n        acc[key].retained++;\n      }\n      \n      acc[key].totalLTV += client.ltv || 0;\n      \n      // Calculate conversion interval with safety checks\n      if (client.firstPurchase && client.firstVisitDate) {\n        try {\n          const firstVisitDate = new Date(client.firstVisitDate);\n          const firstPurchaseDate = new Date(client.firstPurchase);\n          \n          if (!isNaN(firstVisitDate.getTime()) && !isNaN(firstPurchaseDate.getTime())) {\n            const intervalDays = Math.ceil((firstPurchaseDate.getTime() - firstVisitDate.getTime()) / (1000 * 60 * 60 * 24));\n            if (intervalDays >= 0) {\n              acc[key].conversionIntervals.push(intervalDays);\n            }\n          }\n        } catch (error) {\n          // Silently fail on conversion interval calculation errors\n        }\n      }\n      \n      return acc;\n    }, {} as Record<string, any>);\n\n    return Object.values(classStats)\n      .map((stat: any) => ({\n        ...stat,\n        conversionRate: stat.newMembers > 0 ? (stat.converted / stat.newMembers) * 100 : 0,\n  // Standardize retention rate: retained / newMembers\n  retentionRate: stat.newMembers > 0 ? (stat.retained / stat.newMembers) * 100 : 0,\n        avgLTV: stat.totalMembers > 0 ? stat.totalLTV / stat.totalMembers : 0,\n        avgConversionInterval: stat.conversionIntervals.length > 0 \n          ? stat.conversionIntervals.reduce((a: number, b: number) => a + b, 0) / stat.conversionIntervals.length \n          : 0\n      }))\n      .sort((a, b) => b.totalMembers - a.totalMembers);\n  }, [data]);\n\n  const columns = [\n    {\n      key: 'month',\n      header: 'Month',\n      className: 'font-semibold min-w-[120px]',\n      sortable: true,\n      render: (value: string) => (\n        <span className=\"text-sm font-medium text-slate-700 whitespace-nowrap\">{value}</span>\n      )\n    },\n    {\n      key: 'className',\n      header: 'Class Name',\n      className: 'font-medium min-w-[360px] max-w-none h-auto whitespace-normal',\n      sortable: true,\n      render: (value: string) => (\n        <span className=\"text-sm font-medium text-slate-700 whitespace-normal break-words\" title={value}>{value}</span>\n      )\n    },\n    {\n      key: 'totalMembers',\n      header: 'Trials',\n      align: 'center' as const,\n      sortable: true,\n      render: (value: number) => (\n        <span className=\"text-sm font-medium text-slate-700 whitespace-nowrap\">{formatNumber(value)}</span>\n      )\n    },\n    {\n      key: 'newMembers',\n      header: 'New Members',\n      align: 'center' as const,\n      sortable: true,\n      render: (value: number) => (\n        <span className=\"text-sm font-medium text-slate-700 whitespace-nowrap\">{formatNumber(value)}</span>\n      )\n    },\n    {\n      key: 'retained',\n      header: 'Retained',\n      align: 'center' as const,\n      sortable: true,\n      render: (value: number) => (\n        <span className=\"text-sm font-medium text-slate-700 whitespace-nowrap\">{formatNumber(value)}</span>\n      )\n    },\n    {\n      key: 'retentionRate',\n      header: 'Retention %',\n      align: 'center' as const,\n      sortable: true,\n      render: (value: number) => {\n        const safeValue = value ?? 0;\n        return <span className=\"text-sm font-medium text-slate-700\">{safeValue.toFixed(1)}%</span>;\n      }\n    },\n    {\n      key: 'converted',\n      header: 'Converted',\n      align: 'center' as const,\n      sortable: true,\n      render: (value: number) => (\n        <span className=\"text-sm font-medium text-slate-700\">{formatNumber(value)}</span>\n      )\n    },\n    {\n      key: 'conversionRate',\n      header: 'Conversion %',\n      align: 'center' as const,\n      sortable: true,\n      render: (value: number) => {\n        const safeValue = value ?? 0;\n        return <span className=\"text-sm font-medium text-slate-700\">{safeValue.toFixed(1)}%</span>;\n      }\n    },\n    {\n      key: 'avgLTV',\n      header: 'Avg LTV',\n      align: 'right' as const,\n      sortable: true,\n      render: (value: number) => (\n        <span className=\"text-sm font-medium text-slate-700\">{formatCurrency(value)}</span>\n      )\n    },\n    {\n      key: 'avgConversionInterval',\n      header: 'Avg Conv Days',\n      align: 'center' as const,\n      sortable: true,\n      render: (value: number) => {\n        const safeValue = value ?? 0;\n        return <span className=\"text-sm font-medium text-slate-700\">{Math.round(safeValue)} days</span>;\n      }\n    }\n  ];\n\n  // Calculate totals\n  const totals = {\n    month: 'TOTAL',\n    className: `${hostedClassData.length} Classes`,\n    totalMembers: hostedClassData.reduce((sum, row) => sum + row.totalMembers, 0),\n    newMembers: hostedClassData.reduce((sum, row) => sum + row.newMembers, 0),\n    converted: hostedClassData.reduce((sum, row) => sum + row.converted, 0),\n    conversionRate: 0,\n    retained: hostedClassData.reduce((sum, row) => sum + row.retained, 0),\n    retentionRate: 0,\n    avgLTV: hostedClassData.reduce((sum, row) => sum + row.totalLTV, 0) / Math.max(hostedClassData.reduce((sum, row) => sum + row.totalMembers, 0), 1),\n    avgConversionInterval: hostedClassData.reduce((sum, row) => sum + (row.avgConversionInterval * row.totalMembers), 0) / Math.max(hostedClassData.reduce((sum, row) => sum + row.totalMembers, 0), 1)\n  };\n  totals.conversionRate = totals.newMembers > 0 ? (totals.converted / totals.newMembers) * 100 : 0;\n  totals.retentionRate = totals.newMembers > 0 ? (totals.retained / totals.newMembers) * 100 : 0;\n\n  // Sorting logic\n  const displayedData = React.useMemo(() => {\n    const arr = [...hostedClassData];\n    if (!sortField) return arr;\n    return arr.sort((a: any, b: any) => {\n      const av = a[sortField];\n      const bv = b[sortField];\n      const dir = sortDirection === 'asc' ? 1 : -1;\n      if (typeof av === 'number' && typeof bv === 'number') return (av - bv) * dir;\n      return String(av ?? '').localeCompare(String(bv ?? '')) * dir;\n    });\n  }, [hostedClassData, sortField, sortDirection]);\n\n  const handleSort = (field: string) => {\n    if (sortField === field) {\n      setSortDirection(prev => (prev === 'asc' ? 'desc' : 'asc'));\n    } else {\n      setSortField(field);\n      setSortDirection('desc');\n    }\n  };\n\n  const aiNotes = React.useMemo(() => {\n    if (!hostedClassData || hostedClassData.length === 0) return [] as string[];\n    const topTrials = [...hostedClassData].sort((a,b) => b.totalMembers - a.totalMembers)[0];\n    const bestConv = [...hostedClassData.filter(r => r.newMembers > 0)].sort((a,b) => b.conversionRate - a.conversionRate)[0];\n    const bestRet = [...hostedClassData.filter(r => r.newMembers > 0)].sort((a,b) => b.retentionRate - a.retentionRate)[0];\n    const notes: string[] = [];\n    if (topTrials) notes.push(`${topTrials.className} (${topTrials.month}) drove the most trials (${formatNumber(topTrials.totalMembers)}).`);\n    if (bestConv) notes.push(`${bestConv.className} (${bestConv.month}) has the best conversion ${bestConv.conversionRate.toFixed(1)}% (${bestConv.converted}/${bestConv.newMembers}).`);\n    if (bestRet) notes.push(`${bestRet.className} (${bestRet.month}) leads retention ${bestRet.retentionRate.toFixed(1)}% (${bestRet.retained}/${bestRet.newMembers}).`);\n    return notes;\n  }, [hostedClassData]);\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.6 }}\n    >\n      <Card className=\"bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-all duration-300\">\n  <CardHeader className=\"border-b border-gray-100 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <Dumbbell className=\"w-5 h-5\" />\n            Hosted Classes Performance Analysis\n            <Badge variant=\"secondary\" className=\"bg-white/20 text-white\">\n              {hostedClassData.length} Classes\n            </Badge>\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"p-0\">\n          <ModernDataTable\n            data={displayedData}\n            columns={columns}\n            headerGradient=\"from-slate-800 via-slate-900 to-slate-800\"\n            showFooter={true}\n            footerData={totals}\n            maxHeight=\"600px\"\n            onRowClick={onRowClick}\n            onSort={handleSort}\n            sortField={sortField}\n            sortDirection={sortDirection}\n            tableId=\"Hosted Classes Performance Analysis\"\n            />\n          <div className=\"border-t border-slate-200 p-4 bg-slate-50\">\n            <ul className=\"list-disc pl-5 text-sm text-slate-600 space-y-1\">\n              {aiNotes.map((insight, index) => (\n                <li key={index}>{insight}</li>\n              ))}\n            </ul>\n          </div>\n        </CardContent>\n      </Card>\n    </motion.div>\n  );\n};","import React, { useMemo, useRef, useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { ModernDataTable } from '@/components/ui/ModernDataTable';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { UserCheck, Users, Target, TrendingUp, Award, FileText, Image, Download } from 'lucide-react';\nimport { formatNumber, formatPercentage } from '@/utils/formatters';\nimport { NewClientData } from '@/types/dashboard';\nimport CopyTableButton from '@/components/ui/CopyTableButton';\nimport { useRegisterTableForCopy } from '@/hooks/useRegisterTableForCopy';\nimport html2canvas from 'html2canvas';\nimport jsPDF from 'jspdf';\n\ninterface TeacherPerformanceTableProps {\n  data: NewClientData[];\n  onRowClick?: (rowData: any) => void;\n}\n\ninterface TeacherStats {\n  trainerName: string;\n  newMembers: number;\n  sessions: number;\n  converted: number;\n  conversionRate: number;\n  retained: number;\n  retentionRate: number;\n}\n\nexport const TeacherPerformanceTable: React.FC<TeacherPerformanceTableProps> = ({\n  data,\n  onRowClick\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const tableTitle = 'Teacher Performance Analysis';\n  const { getAllTabsText } = useRegisterTableForCopy(containerRef as any, tableTitle);\n  const [displayMode, setDisplayMode] = useState<'values' | 'growth'>('values');\n\n  const teacherStats = useMemo(() => {\n    const stats = new Map<string, {\n      newMembers: Set<string>;\n      sessions: number;\n      converted: Set<string>;\n      retained: Set<string>;\n    }>();\n\n    // Process data to calculate teacher statistics\n    data.forEach(client => {\n      const trainerName = client.trainerName || 'Unknown Trainer';\n      \n      if (!stats.has(trainerName)) {\n        stats.set(trainerName, {\n          newMembers: new Set(),\n          sessions: 0,\n          converted: new Set(),\n          retained: new Set()\n        });\n      }\n\n      const trainerStats = stats.get(trainerName)!;\n      \n      // Track unique new members\n      if (client.memberId) {\n        trainerStats.newMembers.add(client.memberId);\n      }\n      \n      // Track sessions (visits)\n      trainerStats.sessions += client.classNo || 0;\n      \n      // Track conversions\n      if (client.conversionStatus === 'Converted' && client.memberId) {\n        trainerStats.converted.add(client.memberId);\n      }\n      \n      // Track retention\n      if (client.retentionStatus === 'Retained' && client.memberId) {\n        trainerStats.retained.add(client.memberId);\n      }\n    });\n\n    // Convert to array and calculate rates\n    const results: TeacherStats[] = Array.from(stats.entries()).map(([trainerName, stats]) => {\n      const newMembers = stats.newMembers.size;\n      const converted = stats.converted.size;\n      const retained = stats.retained.size;\n      \n      return {\n        trainerName,\n        newMembers,\n        sessions: stats.sessions,\n        converted,\n        conversionRate: newMembers > 0 ? (converted / newMembers) * 100 : 0,\n        retained,\n        retentionRate: newMembers > 0 ? (retained / newMembers) * 100 : 0,\n      };\n    });\n\n    // Sort by new members descending\n    return results.sort((a, b) => b.newMembers - a.newMembers);\n  }, [data]);\n\n  // Sorting state\n  const [sortField, setSortField] = useState<string | undefined>('newMembers');\n  const [sortDirection, setSortDirection] = useState<'asc' | 'desc'>('desc');\n\n  const sortedData = useMemo(() => {\n    if (!sortField) return [...teacherStats];\n    const copy = [...teacherStats];\n    copy.sort((a: any, b: any) => {\n      const va = a[sortField as keyof TeacherStats];\n      const vb = b[sortField as keyof TeacherStats];\n      if (typeof va === 'string' && typeof vb === 'string') {\n        return sortDirection === 'asc' ? va.localeCompare(vb) : vb.localeCompare(va);\n      }\n      const na = Number(va || 0);\n      const nb = Number(vb || 0);\n      return sortDirection === 'asc' ? na - nb : nb - na;\n    });\n    return copy;\n  }, [teacherStats, sortField, sortDirection]);\n\n  const handleSort = (field: string) => {\n    if (field === sortField) {\n      setSortDirection(prev => prev === 'asc' ? 'desc' : 'asc');\n    } else {\n      setSortField(field);\n      setSortDirection('desc');\n    }\n  };\n\n  // Export functions\n  const exportToCSV = () => {\n    const csvHeaders = ['Teacher Name', 'New Members', 'Sessions', 'Converted', 'Conversion Rate', 'Retained', 'Retention Rate'];\n    const csvData = sortedData.map(teacher => [\n      teacher.trainerName,\n      teacher.newMembers,\n      teacher.sessions,\n      teacher.converted,\n      `${teacher.conversionRate.toFixed(1)}%`,\n      teacher.retained,\n      `${teacher.retentionRate.toFixed(1)}%`\n    ]);\n    // Append totals row\n    const totalsRow = [\n      totals.trainerName,\n      totals.newMembers,\n      totals.sessions,\n      totals.converted,\n      `${totals.conversionRate.toFixed(1)}%`,\n      totals.retained,\n      `${totals.retentionRate.toFixed(1)}%`\n    ];\n\n    // Basic CSV escaping for commas/newlines\n    const escape = (v: any) => {\n      if (v === null || v === undefined) return '';\n      const s = String(v);\n      if (s.includes(',') || s.includes('\\n') || s.includes('\"')) {\n        return '\"' + s.replace(/\"/g, '\"\"') + '\"';\n      }\n      return s;\n    };\n\n    const csvContent = [\n      csvHeaders.map(escape).join(','),\n      ...csvData.map(row => row.map(escape).join(',')),\n      totalsRow.map(escape).join(',')\n    ].join('\\n');\n    \n    const blob = new Blob([csvContent], { type: 'text/csv' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = 'teacher-performance.csv';\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  const exportToPDF = async () => {\n    if (!containerRef.current) return;\n\n    // Render a full offscreen table (all rows + totals) with proper styling\n    const offscreen = document.createElement('div');\n    offscreen.style.position = 'absolute';\n    offscreen.style.left = '-99999px';\n    offscreen.style.top = '0';\n    offscreen.style.background = '#ffffff';\n    offscreen.style.padding = '20px';\n    offscreen.style.color = '#000';\n    offscreen.style.fontFamily = '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    offscreen.style.fontSize = '14px';\n    offscreen.style.width = '1200px';\n\n    // Add title\n    const title = document.createElement('h1');\n    title.textContent = 'Teacher Performance Analysis';\n    title.style.fontSize = '24px';\n    title.style.fontWeight = '600';\n    title.style.marginBottom = '20px';\n    title.style.color = '#1f2937';\n    title.style.textAlign = 'center';\n    offscreen.appendChild(title);\n\n    const table = document.createElement('table');\n    table.style.borderCollapse = 'collapse';\n    table.style.width = '100%';\n    table.style.background = '#ffffff';\n    table.style.color = '#000';\n    table.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1)';\n    table.style.borderRadius = '8px';\n    table.style.overflow = 'hidden';\n    \n    const thead = document.createElement('thead');\n    thead.style.background = 'linear-gradient(to right, #334155, #1e293b, #4f46e5)';\n    const headerRow = document.createElement('tr');\n    ['Teacher Name','New Members','Sessions','Converted','Conversion Rate','Retained','Retention Rate'].forEach(h => {\n      const th = document.createElement('th');\n      th.textContent = h;\n      th.style.textAlign = 'center';\n      th.style.padding = '12px 8px';\n      th.style.border = '1px solid #e5e7eb';\n      th.style.color = '#ffffff';\n      th.style.fontWeight = '600';\n      th.style.fontSize = '12px';\n      th.style.textTransform = 'uppercase';\n      th.style.letterSpacing = '0.05em';\n      th.style.background = 'linear-gradient(to right, #334155, #1e293b, #4f46e5)';\n      headerRow.appendChild(th);\n    });\n    thead.appendChild(headerRow);\n    table.appendChild(thead);\n\n    const tbody = document.createElement('tbody');\n    sortedData.forEach(r => {\n      const tr = document.createElement('tr');\n      [r.trainerName, r.newMembers, r.sessions, r.converted, `${r.conversionRate.toFixed(1)}%`, r.retained, `${r.retentionRate.toFixed(1)}%`].forEach(cell => {\n        const td = document.createElement('td');\n        td.textContent = String(cell);\n        td.style.padding = '6px 8px';\n        td.style.border = '1px solid #e5e7eb';\n        td.style.height = '35px';\n        td.style.whiteSpace = 'nowrap';\n        tr.appendChild(td);\n      });\n      tbody.appendChild(tr);\n    });\n\n    // totals row\n    const trTotal = document.createElement('tr');\n    trTotal.style.backgroundColor = '#f3f4f6';\n    trTotal.style.borderTop = '2px solid #d1d5db';\n    [totals.trainerName, totals.newMembers, totals.sessions, totals.converted, `${totals.conversionRate.toFixed(1)}%`, totals.retained, `${totals.retentionRate.toFixed(1)}%`].forEach((cell, cellIndex) => {\n      const td = document.createElement('td');\n      td.textContent = String(cell);\n      td.style.padding = '12px 8px';\n      td.style.border = '1px solid #d1d5db';\n      td.style.fontWeight = '700';\n      td.style.height = '40px';\n      td.style.color = '#111827';\n      td.style.fontSize = '14px';\n      td.style.textAlign = cellIndex === 0 ? 'left' : 'center';\n      td.style.backgroundColor = '#f9fafb';\n      trTotal.appendChild(td);\n    });\n    tbody.appendChild(trTotal);\n    table.appendChild(tbody);\n    offscreen.appendChild(table);\n    document.body.appendChild(offscreen);\n\n    const canvas = await html2canvas(offscreen, { scale: 2, backgroundColor: '#ffffff', useCORS: true });\n    \n    const imgData = canvas.toDataURL('image/png');\n    const pdf = new jsPDF('l', 'mm', 'a4');\n    const imgWidth = 297;\n    const pageHeight = 210;\n    const imgHeight = (canvas.height * imgWidth) / canvas.width;\n    let heightLeft = imgHeight;\n    let position = 0;\n\n    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\n    heightLeft -= pageHeight;\n\n    while (heightLeft >= 0) {\n      position = heightLeft - imgHeight;\n      pdf.addPage();\n      pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\n      heightLeft -= pageHeight;\n    }\n\n    pdf.save('teacher-performance.pdf');\n\n    // Cleanup offscreen\n    try { document.body.removeChild(offscreen); } catch (e) { /* ignore */ }\n  };\n\n  const exportToPNG = async () => {\n    // Build offscreen table for full content with proper styling\n    const offscreen = document.createElement('div');\n    offscreen.style.position = 'absolute';\n    offscreen.style.left = '-99999px';\n    offscreen.style.top = '0';\n    offscreen.style.background = '#ffffff';\n    offscreen.style.padding = '20px';\n    offscreen.style.color = '#000';\n    offscreen.style.fontFamily = '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    offscreen.style.fontSize = '14px';\n    offscreen.style.width = '1200px';\n\n    // Add title\n    const title = document.createElement('h1');\n    title.textContent = 'Teacher Performance Analysis';\n    title.style.fontSize = '24px';\n    title.style.fontWeight = '600';\n    title.style.marginBottom = '20px';\n    title.style.color = '#1f2937';\n    title.style.textAlign = 'center';\n    offscreen.appendChild(title);\n\n    const table = document.createElement('table');\n    table.style.borderCollapse = 'collapse';\n    table.style.width = '100%';\n    table.style.background = '#ffffff';\n    table.style.color = '#000';\n    table.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1)';\n    table.style.borderRadius = '8px';\n    table.style.overflow = 'hidden';\n    \n    const thead = document.createElement('thead');\n    thead.style.background = 'linear-gradient(to right, #334155, #1e293b, #4f46e5)';\n    const headerRow = document.createElement('tr');\n    ['Teacher Name','New Members','Sessions','Converted','Conversion Rate','Retained','Retention Rate'].forEach(h => {\n      const th = document.createElement('th');\n      th.textContent = h;\n      th.style.textAlign = 'center';\n      th.style.padding = '12px 8px';\n      th.style.border = '1px solid #e5e7eb';\n      th.style.color = '#ffffff';\n      th.style.fontWeight = '600';\n      th.style.fontSize = '12px';\n      th.style.textTransform = 'uppercase';\n      th.style.letterSpacing = '0.05em';\n      th.style.background = 'linear-gradient(to right, #334155, #1e293b, #4f46e5)';\n      headerRow.appendChild(th);\n    });\n    thead.appendChild(headerRow);\n    table.appendChild(thead);\n\n    const tbody = document.createElement('tbody');\n    sortedData.forEach((r, index) => {\n      const tr = document.createElement('tr');\n      tr.style.backgroundColor = index % 2 === 0 ? '#ffffff' : '#f9fafb';\n      tr.style.borderBottom = '1px solid #e5e7eb';\n      \n      [r.trainerName, r.newMembers, r.sessions, r.converted, `${r.conversionRate.toFixed(1)}%`, r.retained, `${r.retentionRate.toFixed(1)}%`].forEach((cell, cellIndex) => {\n        const td = document.createElement('td');\n        td.textContent = String(cell);\n        td.style.padding = '10px 8px';\n        td.style.border = '1px solid #e5e7eb';\n        td.style.height = '35px';\n        td.style.whiteSpace = 'nowrap';\n        td.style.color = '#374151';\n        td.style.fontSize = '13px';\n        td.style.textAlign = cellIndex === 0 ? 'left' : 'center';\n        td.style.fontWeight = cellIndex === 0 ? '500' : '400';\n        tr.appendChild(td);\n      });\n      tbody.appendChild(tr);\n    });\n\n    const trTotal = document.createElement('tr');\n    trTotal.style.backgroundColor = '#f3f4f6';\n    trTotal.style.borderTop = '2px solid #d1d5db';\n    [totals.trainerName, totals.newMembers, totals.sessions, totals.converted, `${totals.conversionRate.toFixed(1)}%`, totals.retained, `${totals.retentionRate.toFixed(1)}%`].forEach((cell, cellIndex) => {\n      const td = document.createElement('td');\n      td.textContent = String(cell);\n      td.style.padding = '12px 8px';\n      td.style.border = '1px solid #d1d5db';\n      td.style.fontWeight = '700';\n      td.style.height = '40px';\n      td.style.color = '#111827';\n      td.style.fontSize = '14px';\n      td.style.textAlign = cellIndex === 0 ? 'left' : 'center';\n      td.style.backgroundColor = '#f9fafb';\n      trTotal.appendChild(td);\n    });\n    tbody.appendChild(trTotal);\n    table.appendChild(tbody);\n    offscreen.appendChild(table);\n    document.body.appendChild(offscreen);\n\n    const canvas = await html2canvas(offscreen, { scale: 2, backgroundColor: '#ffffff', useCORS: true });\n    const link = document.createElement('a');\n    link.download = 'teacher-performance.png';\n    link.href = canvas.toDataURL();\n    link.click();\n\n    try { document.body.removeChild(offscreen); } catch (e) { /* ignore */ }\n  };\n  const totals = useMemo(() => {\n    const totalNewMembers = teacherStats.reduce((sum, t) => sum + t.newMembers, 0);\n    const totalSessions = teacherStats.reduce((sum, t) => sum + t.sessions, 0);\n    const totalConverted = teacherStats.reduce((sum, t) => sum + t.converted, 0);\n    const totalRetained = teacherStats.reduce((sum, t) => sum + t.retained, 0);\n    \n    return {\n      trainerName: 'TOTAL',\n      newMembers: totalNewMembers,\n      sessions: totalSessions,\n      converted: totalConverted,\n      conversionRate: totalNewMembers > 0 ? (totalConverted / totalNewMembers) * 100 : 0,\n      retained: totalRetained,\n      retentionRate: totalNewMembers > 0 ? (totalRetained / totalNewMembers) * 100 : 0,\n    };\n  }, [teacherStats]);\n\n  // Calculate growth data (placeholder since we don't have historical data)\n  const growthColumns = [\n    {\n      key: 'trainerName',\n      header: 'Teacher Name',\n      render: (value: string) => (\n        <div className=\"truncate text-black font-medium\" style={{ maxHeight: '35px', lineHeight: '35px' }}>\n          {value}\n        </div>\n      ),\n      align: 'left' as const,\n      sortable: true\n    },\n    {\n      key: 'newMembers',\n      header: 'New Members Growth',\n      render: (value: number) => (\n        <div className=\"text-center text-black font-medium\" style={{ maxHeight: '35px', lineHeight: '35px' }}>\n          --% (No historical data)\n        </div>\n      ),\n      align: 'center' as const,\n      sortable: true\n    },\n    {\n      key: 'sessions',\n      header: 'Sessions Growth',\n      render: (value: number) => (\n        <div className=\"text-center text-black font-medium\" style={{ maxHeight: '35px', lineHeight: '35px' }}>\n          --% (No historical data)\n        </div>\n      ),\n      align: 'center' as const,\n      sortable: true\n    },\n    {\n      key: 'converted',\n      header: 'Conversions Growth',\n      render: (value: number) => (\n        <div className=\"text-center text-black font-medium\" style={{ maxHeight: '35px', lineHeight: '35px' }}>\n          --% (No historical data)\n        </div>\n      ),\n      align: 'center' as const,\n      sortable: true\n    },\n    {\n      key: 'conversionRate',\n      header: 'Conv. Rate Growth',\n      render: (value: number) => (\n        <div className=\"text-center text-black font-medium\" style={{ maxHeight: '35px', lineHeight: '35px' }}>\n          --% (No historical data)\n        </div>\n      ),\n      align: 'center' as const,\n      sortable: true\n    },\n    {\n      key: 'retained',\n      header: 'Retention Growth',\n      render: (value: number) => (\n        <div className=\"text-center text-black font-medium\" style={{ maxHeight: '35px', lineHeight: '35px' }}>\n          --% (No historical data)\n        </div>\n      ),\n      align: 'center' as const,\n      sortable: true\n    },\n    {\n      key: 'retentionRate',\n      header: 'Ret. Rate Growth',\n      render: (value: number) => (\n        <div className=\"text-center text-black font-medium\" style={{ maxHeight: '35px', lineHeight: '35px' }}>\n          --% (No historical data)\n        </div>\n      ),\n      align: 'center' as const,\n      sortable: true\n    },\n  ];\n\n  const columns = displayMode === 'values' ? [\n    {\n      key: 'trainerName',\n      header: 'Teacher Name',\n      render: (value: string) => (\n        <div className=\"truncate text-black font-medium\" style={{ maxHeight: '35px', lineHeight: '35px' }}>\n          {value}\n        </div>\n      ),\n      align: 'left' as const,\n      sortable: true\n    },\n    {\n      key: 'newMembers',\n      header: 'New Members',\n      render: (value: number) => (\n        <div className=\"text-center text-black font-medium\" style={{ maxHeight: '35px', lineHeight: '35px' }}>\n          {formatNumber(value)}\n        </div>\n      ),\n      align: 'center' as const,\n      sortable: true\n    },\n    {\n      key: 'sessions',\n      header: 'Sessions',\n      render: (value: number) => (\n        <div className=\"text-center text-black font-medium\" style={{ maxHeight: '35px', lineHeight: '35px' }}>\n          {formatNumber(value)}\n        </div>\n      ),\n      align: 'center' as const,\n      sortable: true\n    },\n    {\n      key: 'converted',\n      header: 'Converted',\n      render: (value: number) => (\n        <div className=\"text-center text-black font-medium\" style={{ maxHeight: '35px', lineHeight: '35px' }}>\n          {formatNumber(value)}\n        </div>\n      ),\n      align: 'center' as const,\n      sortable: true\n    },\n    {\n      key: 'conversionRate',\n      header: 'Conversion Rate',\n      render: (value: number) => (\n        <div className=\"text-center text-black font-medium\" style={{ maxHeight: '35px', lineHeight: '35px' }}>\n          {formatPercentage(value)}\n        </div>\n      ),\n      align: 'center' as const,\n      sortable: true\n    },\n    {\n      key: 'retained',\n      header: 'Retained',\n      render: (value: number) => (\n        <div className=\"text-center text-black font-medium\" style={{ maxHeight: '35px', lineHeight: '35px' }}>\n          {formatNumber(value)}\n        </div>\n      ),\n      align: 'center' as const,\n      sortable: true\n    },\n    {\n      key: 'retentionRate',\n      header: 'Retention Rate',\n      render: (value: number) => (\n        <div className=\"text-center text-black font-medium\" style={{ maxHeight: '35px', lineHeight: '35px' }}>\n          {formatPercentage(value)}\n        </div>\n      ),\n      align: 'center' as const,\n      sortable: true\n    },\n  ] : growthColumns;\n\n  return (\n    <div ref={containerRef} className=\"space-y-6\">\n      <Card className=\"shadow-xl border-0 bg-gradient-to-br from-slate-50 to-white overflow-hidden\">\n        <CardHeader className=\"bg-gradient-to-r from-slate-800 via-blue-900 to-indigo-900 text-white p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm\">\n                <UserCheck className=\"w-6 h-6 text-white\" />\n              </div>\n              <div>\n                <CardTitle className=\"text-2xl font-bold text-white mb-1\">\n                  Teacher Performance Analysis\n                </CardTitle>\n                <p className=\"text-blue-200 text-sm\">\n                  Comprehensive teacher metrics including conversions and retention rates\n                </p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <Badge className=\"bg-white/20 text-white border-white/30 px-3 py-1\">\n                {teacherStats.length} Teachers\n              </Badge>\n              \n              {/* Display Mode Toggle */}\n              <div className=\"flex items-center gap-2\">\n                <Button\n                  size=\"sm\"\n                  variant={displayMode === 'values' ? 'default' : 'outline'}\n                  onClick={() => setDisplayMode('values')}\n                  className=\"h-8 bg-white/20 text-white border-white/30 hover:bg-white/30\"\n                >\n                  Values\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant={displayMode === 'growth' ? 'default' : 'outline'}\n                  onClick={() => setDisplayMode('growth')}\n                  className=\"h-8 bg-white/20 text-white border-white/30 hover:bg-white/30\"\n                >\n                  Growth\n                </Button>\n              </div>\n\n              {/* Export Buttons */}\n              <div className=\"flex items-center gap-2\">\n                <Button\n                  size=\"sm\"\n                  onClick={exportToCSV}\n                  className=\"h-8 bg-white/20 text-white border-white/30 hover:bg-white/30 gap-1\"\n                  variant=\"outline\"\n                >\n                  <FileText className=\"w-3 h-3\" />\n                  CSV\n                </Button>\n                <Button\n                  size=\"sm\"\n                  onClick={exportToPNG}\n                  className=\"h-8 bg-white/20 text-white border-white/30 hover:bg-white/30 gap-1\"\n                  variant=\"outline\"\n                >\n                  <Image className=\"w-3 h-3\" />\n                  PNG\n                </Button>\n                <Button\n                  size=\"sm\"\n                  onClick={exportToPDF}\n                  className=\"h-8 bg-white/20 text-white border-white/30 hover:bg-white/30 gap-1\"\n                  variant=\"outline\"\n                >\n                  <Download className=\"w-3 h-3\" />\n                  PDF\n                </Button>\n              </div>\n\n              <CopyTableButton \n                tableRef={containerRef}\n                tableName={tableTitle}\n                size=\"sm\"\n                onCopyAllTabs={async () => getAllTabsText()}\n              />\n            </div>\n          </div>\n        </CardHeader>\n        \n        <CardContent className=\"p-0\">\n          <div style={{ \n            '--row-height': '35px',\n            '--text-color': '#000000',\n            '--bg-color': '#ffffff'\n          } as React.CSSProperties}>\n            <ModernDataTable\n              data={sortedData}\n              columns={columns}\n              headerGradient=\"from-slate-800 via-blue-900 to-indigo-900\"\n              showFooter={true}\n              footerData={totals}\n              maxHeight=\"600px\"\n              stickyHeader={true}\n              onRowClick={onRowClick ? (row) => onRowClick(row) : undefined}\n              onSort={handleSort}\n              sortField={sortField}\n              sortDirection={sortDirection}\n              className=\"teacher-performance-table\"\n            />\n          </div>\n          \n          <style>{`\n            .teacher-performance-table tbody tr {\n              height: 35px !important;\n              max-height: 35px !important;\n              background-color: white !important;\n            }\n            /* Uniform white background for all rows per request */\n            .teacher-performance-table tbody tr:nth-child(even) {\n              background-color: white !important;\n            }\n            .teacher-performance-table tbody tr:hover {\n              background-color: white !important;\n            }\n            .teacher-performance-table td {\n              height: 35px !important;\n              max-height: 35px !important;\n              padding: 8px 12px !important;\n              white-space: nowrap !important;\n              overflow: hidden !important;\n              text-overflow: ellipsis !important;\n              color: black !important;\n            }\n            .teacher-performance-table .truncate {\n              overflow: hidden !important;\n              text-overflow: ellipsis !important;\n              white-space: nowrap !important;\n            }\n          `}</style>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};","import React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { ShoppingCart, TrendingUp, X, Users, Calendar, TrendingDown, DollarSign, Activity } from 'lucide-react';\nimport { formatCurrency, formatNumber, formatPercentage } from '@/utils/formatters';\nimport { NewClientData } from '@/types/dashboard';\nimport { ModernDataTable } from '@/components/ui/ModernDataTable';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\n\ninterface NewClientMembershipPurchaseTableProps {\n  data: NewClientData[];\n}\n\ninterface DrillDownData {\n  membershipType: string;\n  clients: NewClientData[];\n  stats: MembershipPurchaseStats;\n  field: string;\n  fieldLabel: string;\n}\n\ninterface MembershipPurchaseStats {\n  membershipType: string;\n  clientType: string; // Moved from nested to top-level\n  units: number; // Number of purchases\n  newClientsCount: number; // Number of unique new clients who bought this\n  totalRevenue: number;\n  avgRevenue: number;\n  avgDaysTaken: number; // Average conversion span\n  avgVisitsPostTrial: number;\n  avgLTV: number;\n  totalLTV: number;\n  clientTypes: Record<string, number>; // Kept for drill-down compatibility\n}\n\nexport const NewClientMembershipPurchaseTable: React.FC<NewClientMembershipPurchaseTableProps> = ({ data }) => {\n  const [sortField, setSortField] = React.useState<string | undefined>(undefined);\n  const [sortDirection, setSortDirection] = React.useState<'asc' | 'desc'>('desc');\n  const [drillDownData, setDrillDownData] = React.useState<DrillDownData | null>(null);\n  const [groupBy, setGroupBy] = React.useState<'detailed' | 'membership' | 'clientType'>('detailed');\n\n  // Filter to only new clients\n  const newClientsData = React.useMemo(() => {\n    return data.filter(client => \n      String(client.isNew || '').toLowerCase().includes('new')\n    );\n  }, [data]);\n\n  // Store client data by membership + client type combination for drill-down\n  const membershipClientMap = React.useMemo(() => {\n    const map: Record<string, NewClientData[]> = {};\n    \n    newClientsData.forEach(client => {\n      const membership = client.membershipsBoughtPostTrial || 'No Membership Purchase';\n      const memberships = membership.split(',').map(m => m.trim()).filter(m => m);\n      const clientType = client.isNew || 'Unknown';\n      \n      if (memberships.length === 0 || membership === '') {\n        const key = `No Membership Purchase|${clientType}`;\n        if (!map[key]) map[key] = [];\n        map[key].push(client);\n        return;\n      }\n      \n      memberships.forEach(mem => {\n        const key = `${mem}|${clientType}`;\n        if (!map[key]) map[key] = [];\n        map[key].push(client);\n      });\n    });\n    \n    return map;\n  }, [newClientsData]);\n\n  const membershipPurchaseData = React.useMemo(() => {\n    // Create a combined key structure: membership + client type\n    const membershipStats: Record<string, {\n      membershipType: string;\n      clientType: string;\n      units: number;\n      clients: Set<string>;\n      totalRevenue: number;\n      conversionSpans: number[];\n      visitsPostTrial: number[];\n      ltvs: number[];\n      convertedClients: number;\n    }> = {};\n\n    // Process each new client\n    newClientsData.forEach(client => {\n      const membership = client.membershipsBoughtPostTrial || 'No Membership Purchase';\n      const memberships = membership.split(',').map(m => m.trim()).filter(m => m);\n      const clientType = client.isNew || 'Unknown';\n      \n      // If no memberships bought, create a \"No Purchase\" entry\n      if (memberships.length === 0 || membership === '') {\n        const key = `No Membership Purchase|${clientType}`;\n        if (!membershipStats[key]) {\n          membershipStats[key] = {\n            membershipType: 'No Membership Purchase',\n            clientType,\n            units: 0,\n            clients: new Set(),\n            totalRevenue: 0,\n            conversionSpans: [],\n            visitsPostTrial: [],\n            ltvs: [],\n            convertedClients: 0\n          };\n        }\n        membershipStats[key].clients.add(client.memberId);\n        membershipStats[key].ltvs.push(client.ltv || 0);\n        membershipStats[key].visitsPostTrial.push(client.visitsPostTrial || 0);\n        return;\n      }\n\n      // Process each membership purchased\n      memberships.forEach(mem => {\n        const key = `${mem}|${clientType}`;\n        if (!membershipStats[key]) {\n          membershipStats[key] = {\n            membershipType: mem,\n            clientType,\n            units: 0,\n            clients: new Set(),\n            totalRevenue: 0,\n            conversionSpans: [],\n            visitsPostTrial: [],\n            ltvs: [],\n            convertedClients: 0\n          };\n        }\n\n        membershipStats[key].units++; // Count each purchase\n        membershipStats[key].clients.add(client.memberId);\n        membershipStats[key].ltvs.push(client.ltv || 0);\n        \n        // Only add conversion span and visits if they converted\n        if (client.conversionStatus === 'Converted') {\n          membershipStats[key].convertedClients++;\n          if (client.conversionSpan && client.conversionSpan > 0) {\n            membershipStats[key].conversionSpans.push(client.conversionSpan);\n          }\n        }\n        \n        if (client.visitsPostTrial) {\n          membershipStats[key].visitsPostTrial.push(client.visitsPostTrial);\n        }\n      });\n    });\n\n    // Calculate averages and format data\n    const formattedData: MembershipPurchaseStats[] = Object.values(membershipStats).map((stats) => {\n      const newClientsCount = stats.clients.size;\n      const totalLTV = stats.ltvs.reduce((sum, ltv) => sum + ltv, 0);\n      const avgLTV = newClientsCount > 0 ? totalLTV / newClientsCount : 0;\n      \n      // Use LTV as proxy for revenue since we don't have direct purchase amounts\n      const totalRevenue = totalLTV;\n      const avgRevenue = avgLTV;\n      \n      const avgDaysTaken = stats.conversionSpans.length > 0 \n        ? stats.conversionSpans.reduce((sum, span) => sum + span, 0) / stats.conversionSpans.length \n        : 0;\n      \n      const avgVisitsPostTrial = stats.visitsPostTrial.length > 0\n        ? stats.visitsPostTrial.reduce((sum, visits) => sum + visits, 0) / stats.visitsPostTrial.length\n        : 0;\n\n      return {\n        membershipType: stats.membershipType,\n        clientType: stats.clientType,\n        units: stats.units,\n        newClientsCount,\n        totalRevenue,\n        avgRevenue,\n        avgDaysTaken,\n        avgVisitsPostTrial,\n        avgLTV,\n        totalLTV,\n        clientTypes: { [stats.clientType]: newClientsCount } // For backward compatibility\n      };\n    });\n\n    // Filter out empty rows\n    const filteredData = formattedData.filter(stat => stat.newClientsCount > 0);\n\n    // Apply grouping based on selected mode\n    if (groupBy === 'membership') {\n      // Aggregate by membership type only\n      const aggregated: Record<string, MembershipPurchaseStats> = {};\n      filteredData.forEach(row => {\n        if (!aggregated[row.membershipType]) {\n          aggregated[row.membershipType] = {\n            membershipType: row.membershipType,\n            clientType: 'All Types',\n            units: 0,\n            newClientsCount: 0,\n            totalRevenue: 0,\n            avgRevenue: 0,\n            avgDaysTaken: 0,\n            avgVisitsPostTrial: 0,\n            avgLTV: 0,\n            totalLTV: 0,\n            clientTypes: {}\n          };\n        }\n        aggregated[row.membershipType].units += row.units;\n        aggregated[row.membershipType].newClientsCount += row.newClientsCount;\n        aggregated[row.membershipType].totalRevenue += row.totalRevenue;\n        aggregated[row.membershipType].clientTypes[row.clientType] = (aggregated[row.membershipType].clientTypes[row.clientType] || 0) + row.newClientsCount;\n      });\n      \n      // Calculate averages\n      Object.values(aggregated).forEach(agg => {\n        agg.avgRevenue = agg.newClientsCount > 0 ? agg.totalRevenue / agg.newClientsCount : 0;\n        \n        // Weighted averages\n        const matchingRows = filteredData.filter(r => r.membershipType === agg.membershipType);\n        const totalClients = matchingRows.reduce((sum, r) => sum + r.newClientsCount, 0);\n        agg.avgDaysTaken = totalClients > 0\n          ? matchingRows.reduce((sum, r) => sum + r.avgDaysTaken * r.newClientsCount, 0) / totalClients\n          : 0;\n        agg.avgVisitsPostTrial = totalClients > 0\n          ? matchingRows.reduce((sum, r) => sum + r.avgVisitsPostTrial * r.newClientsCount, 0) / totalClients\n          : 0;\n      });\n      \n      return Object.values(aggregated).sort((a, b) => b.units - a.units);\n    } else if (groupBy === 'clientType') {\n      // Aggregate by client type only\n      const aggregated: Record<string, MembershipPurchaseStats> = {};\n      filteredData.forEach(row => {\n        if (!aggregated[row.clientType]) {\n          aggregated[row.clientType] = {\n            membershipType: 'All Memberships',\n            clientType: row.clientType,\n            units: 0,\n            newClientsCount: 0,\n            totalRevenue: 0,\n            avgRevenue: 0,\n            avgDaysTaken: 0,\n            avgVisitsPostTrial: 0,\n            avgLTV: 0,\n            totalLTV: 0,\n            clientTypes: {}\n          };\n        }\n        aggregated[row.clientType].units += row.units;\n        aggregated[row.clientType].newClientsCount += row.newClientsCount;\n        aggregated[row.clientType].totalRevenue += row.totalRevenue;\n        aggregated[row.clientType].clientTypes[row.clientType] = aggregated[row.clientType].newClientsCount;\n      });\n      \n      // Calculate averages\n      Object.values(aggregated).forEach(agg => {\n        agg.avgRevenue = agg.newClientsCount > 0 ? agg.totalRevenue / agg.newClientsCount : 0;\n        \n        // Weighted averages\n        const matchingRows = filteredData.filter(r => r.clientType === agg.clientType);\n        const totalClients = matchingRows.reduce((sum, r) => sum + r.newClientsCount, 0);\n        agg.avgDaysTaken = totalClients > 0\n          ? matchingRows.reduce((sum, r) => sum + r.avgDaysTaken * r.newClientsCount, 0) / totalClients\n          : 0;\n        agg.avgVisitsPostTrial = totalClients > 0\n          ? matchingRows.reduce((sum, r) => sum + r.avgVisitsPostTrial * r.newClientsCount, 0) / totalClients\n          : 0;\n      });\n      \n      return Object.values(aggregated).sort((a, b) => b.units - a.units);\n    } else {\n      // Detailed view: sort by membership type, then client type\n      return filteredData.sort((a, b) => {\n        if (a.membershipType !== b.membershipType) {\n          return a.membershipType.localeCompare(b.membershipType);\n        }\n        return a.clientType.localeCompare(b.clientType);\n      });\n    }\n  }, [newClientsData, groupBy]);\n\n  const handleCellClick = (row: MembershipPurchaseStats, field: string, fieldLabel: string) => {\n    let clients: NewClientData[] = [];\n    let title = '';\n    \n    if (groupBy === 'membership') {\n      // Aggregate all clients for this membership across all client types\n      clients = Object.entries(membershipClientMap)\n        .filter(([key]) => key.startsWith(`${row.membershipType}|`))\n        .flatMap(([, clientList]) => clientList);\n      title = `${row.membershipType} (All Client Types)`;\n    } else if (groupBy === 'clientType') {\n      // Aggregate all clients of this type across all memberships\n      clients = Object.entries(membershipClientMap)\n        .filter(([key]) => key.endsWith(`|${row.clientType}`))\n        .flatMap(([, clientList]) => clientList);\n      title = `All Memberships (${row.clientType})`;\n    } else {\n      // Detailed view: use exact combination\n      const key = `${row.membershipType}|${row.clientType}`;\n      clients = membershipClientMap[key] || [];\n      title = `${row.membershipType} (${row.clientType})`;\n    }\n    \n    setDrillDownData({\n      membershipType: title,\n      clients,\n      stats: row,\n      field,\n      fieldLabel\n    });\n  };\n\n  const columns = React.useMemo(() => {\n    const baseColumns = [\n      ...(groupBy !== 'clientType' ? [{\n        key: 'membershipType' as const,\n        header: 'Membership Type',\n        className: 'font-medium text-xs min-w-[200px]',\n        sortable: true,\n        render: (value: string, row: MembershipPurchaseStats) => (\n          <span \n            className=\"text-sm font-medium text-slate-700 truncate cursor-pointer hover:text-indigo-600 hover:underline\" \n            title={value}\n            onClick={() => handleCellClick(row, 'membershipType', 'Membership Overview')}\n          >\n            {value}\n          </span>\n        )\n      }] : []),\n      ...(groupBy !== 'membership' ? [{\n        key: 'clientType' as const,\n        header: 'Client Type',\n        className: 'font-medium text-xs min-w-[120px]',\n        sortable: true,\n        render: (value: string, row: MembershipPurchaseStats) => (\n          <span \n            className=\"text-sm text-slate-600 cursor-pointer hover:text-indigo-600 hover:underline\" \n            title={value}\n            onClick={() => handleCellClick(row, 'clientType', 'Client Type Analysis')}\n          >\n            {value}\n          </span>\n        )\n      }] : []),\n    ];\n\n    return [\n      ...baseColumns,\n      {\n        key: 'units' as const,\n      header: 'Units Sold',\n      align: 'center' as const,\n      sortable: true,\n      render: (value: number, row: MembershipPurchaseStats) => (\n        <span \n          className=\"text-sm font-medium text-slate-700 cursor-pointer hover:text-indigo-600 hover:underline\"\n          onClick={() => handleCellClick(row, 'units', 'Units Sold Analysis')}\n        >\n          {formatNumber(value)}\n        </span>\n      )\n    },\n    {\n      key: 'newClientsCount' as const,\n      header: 'Clients',\n      align: 'center' as const,\n      sortable: true,\n      render: (value: number, row: MembershipPurchaseStats) => (\n        <span \n          className=\"text-sm font-medium text-slate-700 cursor-pointer hover:text-indigo-600 hover:underline\"\n          onClick={() => handleCellClick(row, 'newClientsCount', 'Client Details')}\n        >\n          {formatNumber(value)}\n        </span>\n      )\n    },\n    {\n      key: 'totalRevenue' as const,\n      header: 'Total Value (LTV)',\n      align: 'right' as const,\n      sortable: true,\n      render: (value: number, row: MembershipPurchaseStats) => (\n        <span \n          className=\"text-sm font-medium text-slate-700 cursor-pointer hover:text-indigo-600 hover:underline\"\n          onClick={() => handleCellClick(row, 'totalRevenue', 'Revenue Breakdown')}\n        >\n          {formatCurrency(value)}\n        </span>\n      )\n    },\n    {\n      key: 'avgRevenue' as const,\n      header: 'Avg Value',\n      align: 'right' as const,\n      sortable: true,\n      render: (value: number, row: MembershipPurchaseStats) => (\n        <span \n          className=\"text-sm font-medium text-slate-700 cursor-pointer hover:text-indigo-600 hover:underline\"\n          onClick={() => handleCellClick(row, 'avgRevenue', 'Average Value Analysis')}\n        >\n          {formatCurrency(value)}\n        </span>\n      )\n    },\n    {\n      key: 'avgDaysTaken' as const,\n      header: 'Avg Days to Convert',\n      align: 'center' as const,\n      sortable: true,\n      render: (value: number, row: MembershipPurchaseStats) => (\n        <span \n          className=\"text-sm font-medium text-slate-700 cursor-pointer hover:text-indigo-600 hover:underline\"\n          onClick={() => handleCellClick(row, 'avgDaysTaken', 'Conversion Timeline')}\n        >\n          {value > 0 ? `${value.toFixed(1)} days` : 'N/A'}\n        </span>\n      )\n    },\n    {\n      key: 'avgVisitsPostTrial' as const,\n      header: 'Avg Visits',\n      align: 'center' as const,\n      sortable: true,\n      render: (value: number, row: MembershipPurchaseStats) => (\n        <span \n          className=\"text-sm font-medium text-slate-700 cursor-pointer hover:text-indigo-600 hover:underline\"\n          onClick={() => handleCellClick(row, 'avgVisitsPostTrial', 'Visit Patterns')}\n        >\n          {value.toFixed(1)}\n        </span>\n      )\n    }\n    ];\n  }, [groupBy]);\n\n  // Calculate totals\n  const totals = React.useMemo(() => {\n    const totalClients = membershipPurchaseData.reduce((sum, row) => sum + row.newClientsCount, 0);\n    const totalRevenue = membershipPurchaseData.reduce((sum, row) => sum + row.totalRevenue, 0);\n    const avgRevenue = totalClients > 0 ? totalRevenue / totalClients : 0;\n    \n    return {\n      membershipType: 'TOTAL',\n      clientType: 'All Types',\n      units: membershipPurchaseData.reduce((sum, row) => sum + row.units, 0),\n      newClientsCount: totalClients,\n      clientTypes: {},\n      totalRevenue,\n      avgRevenue,\n      avgDaysTaken: membershipPurchaseData.length > 0\n        ? membershipPurchaseData.reduce((sum, row) => sum + row.avgDaysTaken * row.newClientsCount, 0) / totalClients\n        : 0,\n      avgVisitsPostTrial: totalClients > 0\n        ? membershipPurchaseData.reduce((sum, row) => sum + row.avgVisitsPostTrial * row.newClientsCount, 0) / totalClients\n        : 0,\n      avgLTV: 0,\n      totalLTV: 0\n    };\n  }, [membershipPurchaseData]);\n\n  const displayedData = React.useMemo(() => {\n    if (!sortField) return membershipPurchaseData;\n    const arr = [...membershipPurchaseData];\n    return arr.sort((a: any, b: any) => {\n      const av = a[sortField];\n      const bv = b[sortField];\n      const dir = sortDirection === 'asc' ? 1 : -1;\n      if (typeof av === 'number' && typeof bv === 'number') return (av - bv) * dir;\n      return String(av ?? '').localeCompare(String(bv ?? '')) * dir;\n    });\n  }, [membershipPurchaseData, sortField, sortDirection]);\n\n  const handleSort = (field: string) => {\n    if (sortField === field) setSortDirection(prev => (prev === 'asc' ? 'desc' : 'asc'));\n    else { setSortField(field); setSortDirection('desc'); }\n  };\n\n  // Calculate insights\n  const insights = React.useMemo(() => {\n    if (membershipPurchaseData.length === 0) return null;\n\n    const topByUnits = [...membershipPurchaseData].sort((a, b) => b.units - a.units)[0];\n    const topByRevenue = [...membershipPurchaseData].sort((a, b) => b.totalRevenue - a.totalRevenue)[0];\n    const fastestConversion = [...membershipPurchaseData]\n      .filter(m => m.avgDaysTaken > 0)\n      .sort((a, b) => a.avgDaysTaken - b.avgDaysTaken)[0];\n\n    // Helper to get display label\n    const getLabel = (row: MembershipPurchaseStats) => {\n      if (groupBy === 'membership') return row.membershipType;\n      if (groupBy === 'clientType') return row.clientType;\n      return `${row.membershipType} (${row.clientType})`;\n    };\n\n    return {\n      topByUnits,\n      topByRevenue,\n      fastestConversion,\n      getLabel\n    };\n  }, [membershipPurchaseData, groupBy]);\n\n  return (\n    <Card className=\"bg-white shadow-lg border-0\">\n      <CardHeader className=\"border-b border-gray-100 bg-gradient-to-r from-indigo-800 via-indigo-900 to-indigo-800 text-white\">\n        <CardTitle className=\"flex items-center gap-2 flex-wrap\">\n          <ShoppingCart className=\"w-5 h-5\" />\n          New Client Membership Purchases\n          <Badge variant=\"secondary\" className=\"bg-white/20 text-white\">\n            {newClientsData.length} New Clients\n          </Badge>\n          <Badge variant=\"secondary\" className=\"bg-white/20 text-white\">\n            {membershipPurchaseData.length} {groupBy === 'detailed' ? 'Rows' : groupBy === 'membership' ? 'Memberships' : 'Client Types'}\n          </Badge>\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"p-0\">\n        {membershipPurchaseData.length === 0 ? (\n          <div className=\"p-8 text-center text-gray-500\">\n            No membership purchase data available for new clients.\n          </div>\n        ) : (\n          <>\n            {/* Grouping Controls */}\n            <div className=\"bg-slate-50 border-b border-slate-200 px-6 py-4\">\n              <div className=\"flex items-center gap-3\">\n                <span className=\"text-sm font-medium text-slate-700\">Group By:</span>\n                <div className=\"flex gap-2\">\n                  <Button\n                    size=\"sm\"\n                    variant={groupBy === 'detailed' ? 'default' : 'outline'}\n                    onClick={() => setGroupBy('detailed')}\n                    className={groupBy === 'detailed' ? 'bg-indigo-600 hover:bg-indigo-700' : ''}\n                  >\n                    Detailed View\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant={groupBy === 'membership' ? 'default' : 'outline'}\n                    onClick={() => setGroupBy('membership')}\n                    className={groupBy === 'membership' ? 'bg-indigo-600 hover:bg-indigo-700' : ''}\n                  >\n                    By Membership\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant={groupBy === 'clientType' ? 'default' : 'outline'}\n                    onClick={() => setGroupBy('clientType')}\n                    className={groupBy === 'clientType' ? 'bg-indigo-600 hover:bg-indigo-700' : ''}\n                  >\n                    By Client Type\n                  </Button>\n                </div>\n                <span className=\"text-xs text-slate-500 ml-auto\">\n                  {groupBy === 'detailed' && 'Showing all membership + client type combinations'}\n                  {groupBy === 'membership' && 'Aggregated by membership type across all client types'}\n                  {groupBy === 'clientType' && 'Aggregated by client type across all memberships'}\n                </span>\n              </div>\n            </div>\n\n            <div className=\"overflow-auto\" style={{ maxHeight: '600px' }}>\n              <table className=\"w-full border-collapse\">\n                <thead className=\"sticky top-0 z-10\">\n                  <tr className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white\">\n                    {groupBy !== 'clientType' && (\n                      <th className=\"text-left py-2 px-3 text-xs font-semibold uppercase tracking-wider border-r border-slate-700\" style={{ width: '300px', minWidth: '300px', maxHeight: '35px' }}>\n                        Membership Type\n                      </th>\n                    )}\n                    {groupBy !== 'membership' && (\n                      <th className=\"text-left py-2 px-3 text-xs font-semibold uppercase tracking-wider border-r border-slate-700\" style={{ width: '100px', minWidth: '100px', maxHeight: '35px' }}>\n                        Client Type\n                      </th>\n                    )}\n                    <th className=\"text-center py-2 px-3 text-xs font-semibold uppercase tracking-wider border-r border-slate-700\" style={{ width: '100px', minWidth: '100px', maxHeight: '35px' }}>\n                      Units\n                    </th>\n                    <th className=\"text-center py-2 px-3 text-xs font-semibold uppercase tracking-wider border-r border-slate-700\" style={{ width: '100px', minWidth: '100px', maxHeight: '35px' }}>\n                      Clients\n                    </th>\n                    <th className=\"text-right py-2 px-3 text-xs font-semibold uppercase tracking-wider border-r border-slate-700\" style={{ width: '100px', minWidth: '100px', maxHeight: '35px' }}>\n                      Total Value\n                    </th>\n                    <th className=\"text-right py-2 px-3 text-xs font-semibold uppercase tracking-wider border-r border-slate-700\" style={{ width: '100px', minWidth: '100px', maxHeight: '35px' }}>\n                      Avg Value\n                    </th>\n                    <th className=\"text-center py-2 px-3 text-xs font-semibold uppercase tracking-wider border-r border-slate-700\" style={{ width: '100px', minWidth: '100px', maxHeight: '35px' }}>\n                      Avg Days\n                    </th>\n                    <th className=\"text-center py-2 px-3 text-xs font-semibold uppercase tracking-wider\" style={{ width: '100px', minWidth: '100px', maxHeight: '35px' }}>\n                      Avg Visits\n                    </th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {displayedData.map((row, idx) => (\n                    <tr key={idx} className=\"border-b border-gray-200 hover:bg-slate-50 transition-colors\" style={{ maxHeight: '35px' }}>\n                      {groupBy !== 'clientType' && (\n                        <td className=\"py-2 px-3 text-sm text-slate-700 font-medium border-r border-gray-200 cursor-pointer hover:text-indigo-600 hover:underline truncate\" \n                            style={{ maxHeight: '35px' }}\n                            onClick={() => handleCellClick(row, 'membershipType', 'Membership Overview')}>\n                          {row.membershipType}\n                        </td>\n                      )}\n                      {groupBy !== 'membership' && (\n                        <td className=\"py-2 px-3 text-sm text-slate-600 border-r border-gray-200 cursor-pointer hover:text-indigo-600 hover:underline truncate\" \n                            style={{ maxHeight: '35px' }}\n                            onClick={() => handleCellClick(row, 'clientType', 'Client Type Analysis')}>\n                          {row.clientType}\n                        </td>\n                      )}\n                      <td className=\"py-2 px-3 text-sm text-center text-slate-700 border-r border-gray-200 cursor-pointer hover:text-indigo-600 hover:underline\" \n                          style={{ maxHeight: '35px' }}\n                          onClick={() => handleCellClick(row, 'units', 'Units Sold Analysis')}>\n                        {formatNumber(row.units)}\n                      </td>\n                      <td className=\"py-2 px-3 text-sm text-center text-slate-700 border-r border-gray-200 cursor-pointer hover:text-indigo-600 hover:underline\" \n                          style={{ maxHeight: '35px' }}\n                          onClick={() => handleCellClick(row, 'newClientsCount', 'Client Details')}>\n                        {formatNumber(row.newClientsCount)}\n                      </td>\n                      <td className=\"py-2 px-3 text-sm text-right text-slate-700 font-medium border-r border-gray-200 cursor-pointer hover:text-indigo-600 hover:underline\" \n                          style={{ maxHeight: '35px' }}\n                          onClick={() => handleCellClick(row, 'totalRevenue', 'Revenue Breakdown')}>\n                        {formatCurrency(row.totalRevenue)}\n                      </td>\n                      <td className=\"py-2 px-3 text-sm text-right text-slate-700 border-r border-gray-200 cursor-pointer hover:text-indigo-600 hover:underline\" \n                          style={{ maxHeight: '35px' }}\n                          onClick={() => handleCellClick(row, 'avgRevenue', 'Average Value Analysis')}>\n                        {formatCurrency(row.avgRevenue)}\n                      </td>\n                      <td className=\"py-2 px-3 text-sm text-center text-slate-700 border-r border-gray-200 cursor-pointer hover:text-indigo-600 hover:underline\" \n                          style={{ maxHeight: '35px' }}\n                          onClick={() => handleCellClick(row, 'avgDaysTaken', 'Conversion Timeline')}>\n                        {row.avgDaysTaken > 0 ? `${row.avgDaysTaken.toFixed(1)}` : 'N/A'}\n                      </td>\n                      <td className=\"py-2 px-3 text-sm text-center text-slate-700 cursor-pointer hover:text-indigo-600 hover:underline\" \n                          style={{ maxHeight: '35px' }}\n                          onClick={() => handleCellClick(row, 'avgVisitsPostTrial', 'Visit Patterns')}>\n                        {row.avgVisitsPostTrial.toFixed(1)}\n                      </td>\n                    </tr>\n                  ))}\n                  {/* Totals Row */}\n                  <tr className=\"bg-slate-100 font-bold border-t-2 border-slate-300\" style={{ maxHeight: '35px' }}>\n                    {groupBy !== 'clientType' && (\n                      <td className=\"py-2 px-3 text-sm text-slate-900 border-r border-slate-300\" style={{ maxHeight: '35px' }}>\n                        {totals.membershipType}\n                      </td>\n                    )}\n                    {groupBy !== 'membership' && (\n                      <td className=\"py-2 px-3 text-sm text-slate-900 border-r border-slate-300\" style={{ maxHeight: '35px' }}>\n                        {totals.clientType}\n                      </td>\n                    )}\n                    <td className=\"py-2 px-3 text-sm text-center text-slate-900 border-r border-slate-300\" style={{ maxHeight: '35px' }}>\n                      {formatNumber(totals.units)}\n                    </td>\n                    <td className=\"py-2 px-3 text-sm text-center text-slate-900 border-r border-slate-300\" style={{ maxHeight: '35px' }}>\n                      {formatNumber(totals.newClientsCount)}\n                    </td>\n                    <td className=\"py-2 px-3 text-sm text-right text-slate-900 font-semibold border-r border-slate-300\" style={{ maxHeight: '35px' }}>\n                      {formatCurrency(totals.totalRevenue)}\n                    </td>\n                    <td className=\"py-2 px-3 text-sm text-right text-slate-900 border-r border-slate-300\" style={{ maxHeight: '35px' }}>\n                      {formatCurrency(totals.avgRevenue)}\n                    </td>\n                    <td className=\"py-2 px-3 text-sm text-center text-slate-900 border-r border-slate-300\" style={{ maxHeight: '35px' }}>\n                      {totals.avgDaysTaken > 0 ? totals.avgDaysTaken.toFixed(1) : 'N/A'}\n                    </td>\n                    <td className=\"py-2 px-3 text-sm text-center text-slate-900\" style={{ maxHeight: '35px' }}>\n                      {totals.avgVisitsPostTrial.toFixed(1)}\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n            \n            {insights && (\n              <div className=\"border-t border-slate-200 p-6 bg-gradient-to-br from-slate-50 to-indigo-50\">\n                <h4 className=\"text-sm font-semibold text-slate-800 mb-3 flex items-center gap-2\">\n                  <TrendingUp className=\"w-4 h-4 text-indigo-600\" />\n                  Key Insights\n                </h4>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                  <div className=\"bg-white p-4 rounded-lg border border-slate-200 shadow-sm\">\n                    <p className=\"text-xs text-slate-500 mb-1\">Most Popular</p>\n                    <p className=\"text-sm font-semibold text-slate-800\">\n                      {insights.getLabel(insights.topByUnits)}\n                    </p>\n                    <p className=\"text-xs text-slate-600 mt-1\">\n                      {formatNumber(insights.topByUnits.units)} units sold to {formatNumber(insights.topByUnits.newClientsCount)} clients\n                    </p>\n                  </div>\n                  \n                  <div className=\"bg-white p-4 rounded-lg border border-slate-200 shadow-sm\">\n                    <p className=\"text-xs text-slate-500 mb-1\">Highest Revenue</p>\n                    <p className=\"text-sm font-semibold text-slate-800\">\n                      {insights.getLabel(insights.topByRevenue)}\n                    </p>\n                    <p className=\"text-xs text-slate-600 mt-1\">\n                      {formatCurrency(insights.topByRevenue.totalRevenue)} total value\n                    </p>\n                  </div>\n                  \n                  {insights.fastestConversion && (\n                    <div className=\"bg-white p-4 rounded-lg border border-slate-200 shadow-sm\">\n                      <p className=\"text-xs text-slate-500 mb-1\">Fastest Conversion</p>\n                      <p className=\"text-sm font-semibold text-slate-800\">\n                        {insights.getLabel(insights.fastestConversion)}\n                      </p>\n                      <p className=\"text-xs text-slate-600 mt-1\">\n                        Avg {insights.fastestConversion.avgDaysTaken.toFixed(1)} days to convert\n                      </p>\n                    </div>\n                  )}\n                </div>\n                \n                <div className=\"mt-4 p-3 bg-blue-50 border border-blue-100 rounded-lg\">\n                  <p className=\"text-xs text-blue-800\">\n                    <strong>Note:</strong> This table shows memberships purchased by new clients post-trial. \n                    \"Units Sold\" represents the total number of membership purchases, while \"New Clients\" shows unique buyers. \n                    Values are based on client LTV. Average days to convert is calculated only for clients who completed conversion.\n                  </p>\n                </div>\n              </div>\n            )}\n          </>\n        )}\n      </CardContent>\n\n      {/* Drill-Down Modal */}\n      <Dialog open={!!drillDownData} onOpenChange={() => setDrillDownData(null)}>\n        <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\n          {drillDownData && (\n            <>\n              <DialogHeader>\n                <DialogTitle className=\"flex items-center gap-2 text-xl\">\n                  <ShoppingCart className=\"w-6 h-6 text-indigo-600\" />\n                  {drillDownData.fieldLabel} - {drillDownData.membershipType}\n                </DialogTitle>\n                <DialogDescription>\n                  Detailed analysis and client breakdown for this membership type\n                </DialogDescription>\n              </DialogHeader>\n\n              <div className=\"space-y-6 mt-4\">\n                {/* Summary Stats */}\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                  <div className=\"bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-lg border border-blue-200\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <Users className=\"w-4 h-4 text-blue-600\" />\n                      <p className=\"text-xs font-medium text-blue-800\">Total Clients</p>\n                    </div>\n                    <p className=\"text-2xl font-bold text-blue-900\">{formatNumber(drillDownData.stats.newClientsCount)}</p>\n                    <p className=\"text-xs text-blue-700 mt-1\">{formatNumber(drillDownData.stats.units)} units sold</p>\n                  </div>\n\n                  <div className=\"bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-lg border border-green-200\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <DollarSign className=\"w-4 h-4 text-green-600\" />\n                      <p className=\"text-xs font-medium text-green-800\">Total Value</p>\n                    </div>\n                    <p className=\"text-2xl font-bold text-green-900\">{formatCurrency(drillDownData.stats.totalRevenue)}</p>\n                    <p className=\"text-xs text-green-700 mt-1\">{formatCurrency(drillDownData.stats.avgRevenue)} avg per client</p>\n                  </div>\n\n                  <div className=\"bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg border border-purple-200\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <Calendar className=\"w-4 h-4 text-purple-600\" />\n                      <p className=\"text-xs font-medium text-purple-800\">Conversion Time</p>\n                    </div>\n                    <p className=\"text-2xl font-bold text-purple-900\">\n                      {drillDownData.stats.avgDaysTaken > 0 ? `${drillDownData.stats.avgDaysTaken.toFixed(1)}` : 'N/A'}\n                    </p>\n                    <p className=\"text-xs text-purple-700 mt-1\">days average</p>\n                  </div>\n\n                  <div className=\"bg-gradient-to-br from-orange-50 to-orange-100 p-4 rounded-lg border border-orange-200\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <Activity className=\"w-4 h-4 text-orange-600\" />\n                      <p className=\"text-xs font-medium text-orange-800\">Conversion Rate</p>\n                    </div>\n                    <p className=\"text-2xl font-bold text-orange-900\">{drillDownData.stats.avgVisitsPostTrial.toFixed(1)}</p>\n                    <p className=\"text-xs text-orange-700 mt-1\">avg visits post-trial</p>\n                  </div>\n                </div>\n\n                {/* Client Type Info */}\n                <div className=\"bg-gradient-to-br from-teal-50 to-teal-100 p-4 rounded-lg border border-teal-200\">\n                  <h4 className=\"text-sm font-semibold text-teal-900 mb-2 flex items-center gap-2\">\n                    <Users className=\"w-4 h-4 text-teal-600\" />\n                    Client Segment\n                  </h4>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-lg text-teal-800 font-bold\">{drillDownData.stats.clientType}</span>\n                    <span className=\"text-sm text-teal-700\">{drillDownData.clients.length} clients (100%)</span>\n                  </div>\n                  <p className=\"text-xs text-teal-700 mt-2\">\n                    All clients in this analysis belong to the same type segment for targeted insights.\n                  </p>\n                </div>\n\n                {/* Contextual Analysis */}\n                <div className=\"bg-gradient-to-br from-slate-50 to-indigo-50 p-6 rounded-lg border border-slate-200\">\n                  <h4 className=\"text-sm font-semibold text-slate-800 mb-3 flex items-center gap-2\">\n                    <TrendingUp className=\"w-4 h-4 text-indigo-600\" />\n                    Contextual Insights\n                  </h4>\n                  <div className=\"space-y-3 text-sm text-slate-700\">\n                    {drillDownData.field === 'membershipType' && (\n                      <>\n                        <p>• This membership has been purchased by <strong>{drillDownData.clients.length}</strong> unique new clients, generating a total LTV of <strong>{formatCurrency(drillDownData.stats.totalRevenue)}</strong>.</p>\n                        <p>• On average, clients visit <strong>{drillDownData.stats.avgVisitsPostTrial.toFixed(1)}</strong> times post-trial before making their purchase decision.</p>\n                        {drillDownData.stats.avgDaysTaken > 0 && (\n                          <p>• The conversion timeline averages <strong>{drillDownData.stats.avgDaysTaken.toFixed(1)} days</strong>, suggesting {drillDownData.stats.avgDaysTaken <= 14 ? 'quick decision-making' : drillDownData.stats.avgDaysTaken <= 30 ? 'moderate consideration time' : 'extended evaluation period'}.</p>\n                        )}\n                      </>\n                    )}\n                    {drillDownData.field === 'units' && (\n                      <>\n                        <p>• A total of <strong>{drillDownData.stats.units}</strong> units of this membership have been sold to <strong>{drillDownData.clients.length}</strong> new clients.</p>\n                        <p>• This represents an average of <strong>{(drillDownData.stats.units / drillDownData.clients.length).toFixed(2)}</strong> purchases per client, indicating {(drillDownData.stats.units / drillDownData.clients.length) > 1 ? 'multiple purchases or renewals' : 'single purchase behavior'}.</p>\n                        <p>• The membership is generating <strong>{formatCurrency(drillDownData.stats.avgRevenue)}</strong> in average value per client.</p>\n                      </>\n                    )}\n                    {drillDownData.field === 'newClientsCount' && (\n                      <>\n                        <p>• <strong>{drillDownData.clients.length}</strong> clients of type <strong>{drillDownData.stats.clientType}</strong> have chosen this membership since their trial period.</p>\n                        <p>• Client distribution: {drillDownData.clients.filter(c => c.conversionStatus === 'Converted').length} converted, {drillDownData.clients.filter(c => c.retentionStatus === 'Retained').length} retained.</p>\n                        <p>• All clients in this segment are classified as: <strong>{drillDownData.stats.clientType}</strong></p>\n                        <p>• Popular locations: {(() => {\n                          const locations = drillDownData.clients.reduce((acc, c) => {\n                            const loc = c.homeLocation || 'Unknown';\n                            acc[loc] = (acc[loc] || 0) + 1;\n                            return acc;\n                          }, {} as Record<string, number>);\n                          const topLoc = Object.entries(locations).sort((a, b) => b[1] - a[1])[0];\n                          return `${topLoc?.[0]} (${topLoc?.[1]} clients)`;\n                        })()}</p>\n                      </>\n                    )}\n                    {drillDownData.field === 'clientType' && (\n                      <>\n                        <p>• This segment represents <strong>{drillDownData.stats.clientType}</strong> clients who purchased <strong>{drillDownData.stats.membershipType}</strong>.</p>\n                        <p>• Segment size: <strong>{drillDownData.clients.length}</strong> clients generating {formatCurrency(drillDownData.stats.totalRevenue)} in total value.</p>\n                        <p>• Average value per client: <strong>{formatCurrency(drillDownData.stats.avgRevenue)}</strong> with {drillDownData.stats.avgVisitsPostTrial.toFixed(1)} average visits.</p>\n                        <p>• Engagement status: {drillDownData.clients.filter(c => c.conversionStatus === 'Converted').length} converted clients, {drillDownData.clients.filter(c => c.retentionStatus === 'Retained').length} retained</p>\n                        <p>• Client type insight: {(() => {\n                          const type = drillDownData.stats.clientType.toLowerCase();\n                          if (type.includes('new')) return 'New clients typically show higher engagement and are building their relationship with the studio.';\n                          if (type.includes('return') || type.includes('existing')) return 'Returning clients demonstrate loyalty and familiarity with the studio offerings.';\n                          return 'This client segment shows unique engagement patterns worth monitoring.';\n                        })()}</p>\n                      </>\n                    )}\n                    {drillDownData.field === 'totalRevenue' && (\n                      <>\n                        <p>• Total lifetime value from this membership: <strong>{formatCurrency(drillDownData.stats.totalRevenue)}</strong></p>\n                        <p>• Revenue distribution: {formatCurrency(drillDownData.stats.avgRevenue)} average per client with {drillDownData.clients.length} contributing clients.</p>\n                        <p>• Top contributors: {(() => {\n                          const sorted = [...drillDownData.clients].sort((a, b) => (b.ltv || 0) - (a.ltv || 0));\n                          const top3 = sorted.slice(0, 3);\n                          const topRevenue = top3.reduce((sum, c) => sum + (c.ltv || 0), 0);\n                          const percentage = drillDownData.stats.totalRevenue > 0 ? (topRevenue / drillDownData.stats.totalRevenue) * 100 : 0;\n                          return `Top 3 clients contribute ${formatPercentage(percentage)}`;\n                        })()}</p>\n                      </>\n                    )}\n                    {drillDownData.field === 'avgRevenue' && (\n                      <>\n                        <p>• Average client value: <strong>{formatCurrency(drillDownData.stats.avgRevenue)}</strong></p>\n                        <p>• Value range: {formatCurrency(Math.min(...drillDownData.clients.map(c => c.ltv || 0)))} to {formatCurrency(Math.max(...drillDownData.clients.map(c => c.ltv || 0)))}</p>\n                        <p>• Median value: <strong>{formatCurrency((() => {\n                          const sorted = [...drillDownData.clients].map(c => c.ltv || 0).sort((a, b) => a - b);\n                          return sorted[Math.floor(sorted.length / 2)];\n                        })())}</strong>, indicating {(() => {\n                          const median = [...drillDownData.clients].map(c => c.ltv || 0).sort((a, b) => a - b)[Math.floor(drillDownData.clients.length / 2)];\n                          return drillDownData.stats.avgRevenue > median * 1.2 ? 'some high-value outliers' : 'balanced distribution';\n                        })()}</p>\n                      </>\n                    )}\n                    {drillDownData.field === 'avgDaysTaken' && (\n                      <>\n                        <p>• Average conversion time: <strong>{drillDownData.stats.avgDaysTaken > 0 ? `${drillDownData.stats.avgDaysTaken.toFixed(1)} days` : 'Not available'}</strong></p>\n                        {drillDownData.stats.avgDaysTaken > 0 && (\n                          <>\n                            <p>• Fastest conversion: {Math.min(...drillDownData.clients.filter(c => c.conversionSpan > 0).map(c => c.conversionSpan))} days | Slowest: {Math.max(...drillDownData.clients.filter(c => c.conversionSpan > 0).map(c => c.conversionSpan))} days</p>\n                            <p>• {drillDownData.clients.filter(c => c.conversionSpan > 0 && c.conversionSpan <= 7).length} clients ({formatPercentage((drillDownData.clients.filter(c => c.conversionSpan > 0 && c.conversionSpan <= 7).length / drillDownData.clients.filter(c => c.conversionSpan > 0).length) * 100)}) converted within first week</p>\n                            <p>• Sales cycle insight: {drillDownData.stats.avgDaysTaken <= 14 ? 'Short decision cycle - effective for immediate promotions' : drillDownData.stats.avgDaysTaken <= 30 ? 'Moderate consideration - nurture campaigns recommended' : 'Long evaluation - focus on building trust and value demonstration'}</p>\n                          </>\n                        )}\n                      </>\n                    )}\n                    {drillDownData.field === 'avgVisitsPostTrial' && (\n                      <>\n                        <p>• Average visits post-trial: <strong>{drillDownData.stats.avgVisitsPostTrial.toFixed(1)}</strong></p>\n                        <p>• Visit distribution: {drillDownData.clients.filter(c => (c.visitsPostTrial || 0) >= drillDownData.stats.avgVisitsPostTrial).length} clients above average, {drillDownData.clients.filter(c => (c.visitsPostTrial || 0) < drillDownData.stats.avgVisitsPostTrial).length} below</p>\n                        <p>• Engagement pattern: {drillDownData.stats.avgVisitsPostTrial >= 10 ? 'High engagement - clients are actively trying the service before committing' : drillDownData.stats.avgVisitsPostTrial >= 5 ? 'Moderate engagement - healthy trial period utilization' : 'Quick decision - minimal trial needed before purchase'}</p>\n                      </>\n                    )}\n                    {drillDownData.field === 'clientType' && (\n                      <>\n                        <p>• Client type: <strong>{drillDownData.stats.clientType}</strong> ({drillDownData.clients.length} clients)</p>\n                        <p>• Conversion status: {drillDownData.clients.filter(c => c.conversionStatus === 'Converted').length} converted clients</p>\n                        <p>• Retention correlation: {drillDownData.clients.filter(c => c.retentionStatus === 'Retained').length} clients ({formatPercentage((drillDownData.clients.filter(c => c.retentionStatus === 'Retained').length / drillDownData.clients.length) * 100)}) are retained, indicating {(drillDownData.clients.filter(c => c.retentionStatus === 'Retained').length / drillDownData.clients.length) >= 0.5 ? 'strong long-term engagement' : 'potential retention challenges'}</p>\n                      </>\n                    )}\n                  </div>\n                </div>\n\n                {/* Client List */}\n                <div className=\"bg-white border border-slate-200 rounded-lg\">\n                  <div className=\"bg-slate-100 px-4 py-3 border-b border-slate-200\">\n                    <h4 className=\"text-sm font-semibold text-slate-800\">Client Details ({drillDownData.clients.length} clients)</h4>\n                  </div>\n                  <div className=\"max-h-96 overflow-y-auto\">\n                    <table className=\"w-full text-sm\">\n                      <thead className=\"bg-slate-50 sticky top-0\">\n                        <tr>\n                          <th className=\"px-4 py-2 text-left text-xs font-medium text-slate-600\">Client</th>\n                          <th className=\"px-4 py-2 text-left text-xs font-medium text-slate-600\">Client Type</th>\n                          <th className=\"px-4 py-2 text-left text-xs font-medium text-slate-600\">Location</th>\n                          <th className=\"px-4 py-2 text-center text-xs font-medium text-slate-600\">LTV</th>\n                          <th className=\"px-4 py-2 text-center text-xs font-medium text-slate-600\">Visits</th>\n                          <th className=\"px-4 py-2 text-center text-xs font-medium text-slate-600\">Days to Convert</th>\n                          <th className=\"px-4 py-2 text-center text-xs font-medium text-slate-600\">Status</th>\n                        </tr>\n                      </thead>\n                      <tbody className=\"divide-y divide-slate-200\">\n                        {drillDownData.clients.map((client, idx) => (\n                          <tr key={idx} className=\"hover:bg-slate-50\">\n                            <td className=\"px-4 py-2 text-slate-700\">\n                              <div className=\"font-medium\">{client.firstName} {client.lastName}</div>\n                              <div className=\"text-xs text-slate-500\">{client.email}</div>\n                            </td>\n                            <td className=\"px-4 py-2 text-slate-600 text-xs\">{client.isNew || 'Unknown'}</td>\n                            <td className=\"px-4 py-2 text-slate-600\">{client.homeLocation || 'N/A'}</td>\n                            <td className=\"px-4 py-2 text-center text-slate-700 font-medium\">{formatCurrency(client.ltv || 0)}</td>\n                            <td className=\"px-4 py-2 text-center text-slate-700\">{client.visitsPostTrial || 0}</td>\n                            <td className=\"px-4 py-2 text-center text-slate-700\">{client.conversionSpan > 0 ? `${client.conversionSpan} days` : 'N/A'}</td>\n                            <td className=\"px-4 py-2 text-center\">\n                              <div className=\"flex flex-col gap-1\">\n                                <span className=\"text-xs text-slate-600\">{client.conversionStatus}</span>\n                                <span className=\"text-xs text-slate-600\">{client.retentionStatus}</span>\n                              </div>\n                            </td>\n                          </tr>\n                        ))}\n                      </tbody>\n                    </table>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"flex justify-end pt-4 border-t border-slate-200\">\n                <Button onClick={() => setDrillDownData(null)} variant=\"outline\">\n                  Close\n                </Button>\n              </div>\n            </>\n          )}\n        </DialogContent>\n      </Dialog>\n    </Card>\n  );\n};\n","import React, { useEffect, useState, useMemo } from 'react';\nimport { useNewClientData } from '@/hooks/useNewClientData';\nimport { useSessionsData } from '@/hooks/useSessionsData';\nimport { usePayrollData } from '@/hooks/usePayrollData';\nimport { useGlobalLoading } from '@/hooks/useGlobalLoading';\nimport { useSectionNavigation } from '@/contexts/SectionNavigationContext';\nimport { useNavigate } from 'react-router-dom';\nimport { Button } from '@/components/ui/button';\nimport { Home, Users } from 'lucide-react';\nimport { Footer } from '@/components/ui/footer';\nimport { StudioLocationTabs } from '@/components/ui/StudioLocationTabs';\nimport { AdvancedExportButton } from '@/components/ui/AdvancedExportButton';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { InfoPopover } from '@/components/ui/InfoSidebar';\nimport { NewClientFilterOptions } from '@/types/dashboard';\nimport DashboardMotionHero from '@/components/ui/DashboardMotionHero';\nimport { formatNumber, formatCurrency, formatPercentage } from '@/utils/formatters';\nimport { getPreviousMonthDateRange, getCurrentMonthDateRange, parseDate } from '@/utils/dateUtils';\nimport { cn } from '@/lib/utils';\n\n// Import new components for rebuilt client conversion tab\nimport { EnhancedClientConversionFilterSection } from '@/components/dashboard/EnhancedClientConversionFilterSection';\nimport { ClientConversionMetricCards } from '@/components/dashboard/ClientConversionMetricCards';\nimport { ClientConversionSimplifiedRanks } from '@/components/dashboard/ClientConversionSimplifiedRanks';\nimport { ClientConversionEnhancedCharts } from '@/components/dashboard/ClientConversionEnhancedCharts';\nimport { ClientConversionDataTableSelector } from '@/components/dashboard/ClientConversionDataTableSelector';\nimport { ClientConversionMonthOnMonthByTypeTable } from '@/components/dashboard/ClientConversionMonthOnMonthByTypeTable';\nimport { ClientRetentionMonthByTypePivot } from '@/components/dashboard/ClientRetentionMonthByTypePivot';\nimport ClientRetentionYearOnYearPivot from '@/components/dashboard/ClientRetentionYearOnYearPivotNew';\nimport { ClientConversionMembershipTable } from '@/components/dashboard/ClientConversionMembershipTable';\nimport { ClientHostedClassesTable } from '@/components/dashboard/ClientHostedClassesTable';\nimport { TeacherPerformanceTable } from '@/components/dashboard/TeacherPerformanceTable';\nimport { NewClientMembershipPurchaseTable } from '@/components/dashboard/NewClientMembershipPurchaseTable';\nimport { LazyClientConversionDrillDownModalV3 } from '@/components/lazy/LazyModals';\nimport { ModalSuspense } from '@/components/lazy/ModalSuspense';\n// Removed NotesBlock (AI summary/notes) per request\nimport { SectionTimelineNav } from '@/components/ui/SectionTimelineNav';\nconst ClientRetention = () => {\n  const {\n    data,\n    loading\n  } = useNewClientData();\n  const {\n    data: sessionsData,\n    loading: sessionsLoading\n  } = useSessionsData();\n  const {\n    data: payrollData,\n    isLoading: payrollLoading\n  } = usePayrollData();\n  const {\n    isLoading,\n    setLoading\n  } = useGlobalLoading();\n  const navigate = useNavigate();\n  const [selectedLocation, setSelectedLocation] = useState('Kwality House, Kemps Corner');\n  const [activeTable, setActiveTable] = useState('monthonmonthbytype');\n  const [selectedMetric, setSelectedMetric] = useState('conversion'); // New state for metric selection\n  const [drillDownModal, setDrillDownModal] = useState({\n    isOpen: false,\n    client: null,\n    title: '',\n    data: null,\n    type: 'month' as any\n  });\n\n  // Filters state\n  const [filters, setFilters] = useState<NewClientFilterOptions>(() => {\n    // Default to previous month date range\n    const prev = getPreviousMonthDateRange();\n    return {\n      dateRange: { start: prev.start, end: prev.end },\n      location: [],\n      homeLocation: [],\n      trainer: [],\n      paymentMethod: [],\n      retentionStatus: [],\n      conversionStatus: [],\n      isNew: [],\n      minLTV: undefined,\n      maxLTV: undefined\n    };\n  });\n  useEffect(() => {\n    setLoading(loading || sessionsLoading || payrollLoading, 'Analyzing client conversion and retention patterns...');\n  }, [loading, sessionsLoading, payrollLoading, setLoading]);\n\n  // Create comprehensive filtered payroll data matching all applied filters\n  const filteredPayrollData = useMemo(() => {\n    if (!payrollData || payrollData.length === 0) return [];\n    \n    let filtered = payrollData;\n    \n    // Apply location filter\n    if (selectedLocation !== 'All Locations') {\n      filtered = filtered.filter(payroll => {\n        const payrollLocation = payroll.location || '';\n        \n        // For Kenkere House, use flexible matching\n        if (selectedLocation === 'Kenkere House, Bengaluru') {\n          return payrollLocation.toLowerCase().includes('kenkere') || \n                 payrollLocation.toLowerCase().includes('bengaluru') || \n                 payrollLocation === 'Kenkere House';\n        }\n        \n        // For other locations, use exact match\n        return payrollLocation === selectedLocation;\n      });\n    }\n    \n    // Apply date range filter to payroll data using monthYear field\n    if (filters.dateRange.start && filters.dateRange.end) {\n      const startDate = new Date(filters.dateRange.start + 'T00:00:00');\n      const endDate = new Date(filters.dateRange.end + 'T23:59:59');\n      \n      filtered = filtered.filter(payroll => {\n        if (!payroll.monthYear) return false;\n        \n        // Parse monthYear (format: \"Jan 2024\" or \"2024-01\")\n        let payrollDate: Date;\n        if (payroll.monthYear.includes('-')) {\n          // Format: \"2024-01\"\n          payrollDate = new Date(payroll.monthYear + '-01');\n        } else {\n          // Format: \"Jan 2024\"\n          payrollDate = new Date(payroll.monthYear + ' 01');\n        }\n        \n        if (isNaN(payrollDate.getTime())) return false;\n        \n        // Check if payroll month falls within the selected date range\n        return payrollDate >= startDate && payrollDate <= endDate;\n      });\n    }\n    \n    // Apply trainer filter if specified\n    if (filters.trainer.length > 0) {\n      filtered = filtered.filter(payroll => filters.trainer.includes(payroll.teacherName || ''));\n    }\n    \n    return filtered;\n  }, [payrollData, selectedLocation, filters]);\n\n  // Create visits summary from filtered payroll data\n  const visitsSummary = useMemo(() => {\n    if (!filteredPayrollData || filteredPayrollData.length === 0) return {};\n    \n    const summary: Record<string, number> = {};\n    filteredPayrollData.forEach(payroll => {\n      if (payroll.monthYear && payroll.totalCustomers) {\n        // Use monthYear directly as key (should be in format like \"Jan 2024\")\n        const key = payroll.monthYear;\n        summary[key] = (summary[key] || 0) + payroll.totalCustomers;\n      }\n    });\n    \n    return summary;\n  }, [filteredPayrollData]);\n\n  // Create visits summary without date range (for MoM tables that ignore date range)\n  const filteredPayrollDataNoDateRange = useMemo(() => {\n    if (!payrollData || payrollData.length === 0) return [];\n    let filtered = payrollData;\n\n    // Apply location filter\n    if (selectedLocation !== 'All Locations') {\n      filtered = filtered.filter(payroll => {\n        const payrollLocation = payroll.location || '';\n        if (selectedLocation === 'Kenkere House, Bengaluru') {\n          return payrollLocation.toLowerCase().includes('kenkere') ||\n            payrollLocation.toLowerCase().includes('bengaluru') ||\n            payrollLocation === 'Kenkere House';\n        }\n        return payrollLocation === selectedLocation;\n      });\n    }\n\n    // Apply trainer filter if specified\n    if (filters.trainer.length > 0) {\n      filtered = filtered.filter(payroll => filters.trainer.includes(payroll.teacherName || ''));\n    }\n\n    return filtered;\n  }, [payrollData, selectedLocation, filters.trainer]);\n\n  const visitsSummaryNoDateRange = useMemo(() => {\n    if (!filteredPayrollDataNoDateRange || filteredPayrollDataNoDateRange.length === 0) return {};\n    const summary: Record<string, number> = {};\n    filteredPayrollDataNoDateRange.forEach(payroll => {\n      if (payroll.monthYear && payroll.totalCustomers) {\n        const key = payroll.monthYear; // Expect format like \"Jan 2024\"\n        summary[key] = (summary[key] || 0) + payroll.totalCustomers;\n      }\n    });\n    return summary;\n  }, [filteredPayrollDataNoDateRange]);\n\n  // Get unique values for filters (only 3 main locations)\n  const uniqueLocations = React.useMemo(() => {\n    const mainLocations = ['Kwality House, Kemps Corner', 'Supreme HQ, Bandra', 'Kenkere House, Bengaluru'];\n    const locations = new Set<string>();\n    data.forEach(client => {\n      if (client.firstVisitLocation && mainLocations.includes(client.firstVisitLocation)) {\n        locations.add(client.firstVisitLocation);\n      }\n      if (client.homeLocation && mainLocations.includes(client.homeLocation)) {\n        locations.add(client.homeLocation);\n      }\n    });\n    return Array.from(locations).filter(Boolean);\n  }, [data]);\n  const uniqueTrainers = React.useMemo(() => {\n    const trainers = new Set<string>();\n    data.forEach(client => {\n      if (client.trainerName) trainers.add(client.trainerName);\n    });\n    return Array.from(trainers).filter(Boolean);\n  }, [data]);\n  const uniqueMembershipTypes = React.useMemo(() => {\n    const memberships = new Set<string>();\n    data.forEach(client => {\n      if (client.membershipUsed) memberships.add(client.membershipUsed);\n    });\n    return Array.from(memberships).filter(Boolean);\n  }, [data]);\n\n  // Filter data by selected location and filters\n  const filteredData = React.useMemo(() => {\n    let filtered = data;\n\n    // Apply date range filter FIRST - only if both start and end dates are provided\n    if (filters.dateRange.start && filters.dateRange.end) {\n      const startDate = filters.dateRange.start ? new Date(filters.dateRange.start + 'T00:00:00') : null;\n      const endDate = filters.dateRange.end ? new Date(filters.dateRange.end + 'T23:59:59') : null;\n      \n      filtered = filtered.filter(client => {\n        if (!client.firstVisitDate) return false;\n        \n        const clientDate = parseDate(client.firstVisitDate);\n        if (!clientDate) return false;\n\n        // Set client date to start of day for comparison\n        clientDate.setHours(0, 0, 0, 0);\n        return (!startDate || clientDate >= startDate) && (!endDate || clientDate <= endDate);\n      });\n    }\n\n    // Apply location filter - check both firstVisitLocation and homeLocation\n    if (selectedLocation !== 'All Locations') {\n      filtered = filtered.filter(client => {\n        const firstLocation = client.firstVisitLocation || '';\n        const homeLocation = client.homeLocation || '';\n\n        // For Kenkere House, try more flexible matching\n        if (selectedLocation === 'Kenkere House, Bengaluru') {\n          const matchesFirst = firstLocation.toLowerCase().includes('kenkere') || firstLocation.toLowerCase().includes('bengaluru') || firstLocation === 'Kenkere House';\n          const matchesHome = homeLocation.toLowerCase().includes('kenkere') || homeLocation.toLowerCase().includes('bengaluru') || homeLocation === 'Kenkere House';\n          return matchesFirst || matchesHome;\n        }\n\n        // For other locations, use exact match\n        return firstLocation === selectedLocation || homeLocation === selectedLocation;\n      });\n    }\n\n    // Apply additional filters\n    if (filters.location.length > 0) {\n      filtered = filtered.filter(client => filters.location.includes(client.firstVisitLocation || '') || filters.location.includes(client.homeLocation || ''));\n    }\n    if (filters.trainer.length > 0) {\n      filtered = filtered.filter(client => filters.trainer.includes(client.trainerName || ''));\n    }\n\n    // Apply other filters\n    if (filters.conversionStatus.length > 0) {\n      filtered = filtered.filter(client => filters.conversionStatus.includes(client.conversionStatus || ''));\n    }\n    if (filters.retentionStatus.length > 0) {\n      filtered = filtered.filter(client => filters.retentionStatus.includes(client.retentionStatus || ''));\n    }\n    if (filters.paymentMethod.length > 0) {\n      filtered = filtered.filter(client => filters.paymentMethod.includes(client.paymentMethod || ''));\n    }\n    if (filters.isNew.length > 0) {\n      filtered = filtered.filter(client => filters.isNew.includes(client.isNew || ''));\n    }\n\n    // Apply LTV filters\n    if (filters.minLTV !== undefined) {\n      filtered = filtered.filter(client => (client.ltv || 0) >= filters.minLTV!);\n    }\n    if (filters.maxLTV !== undefined) {\n      filtered = filtered.filter(client => (client.ltv || 0) <= filters.maxLTV!);\n    }\n    \n    return filtered;\n  }, [data, selectedLocation, filters]);\n\n  // Build a filtered dataset that applies ALL current filters EXCEPT the selectedLocation tab\n  // This powers the tab counts to reflect the active filters rather than the entire dataset\n  const filteredByFiltersOnly = React.useMemo(() => {\n    let filtered = data;\n\n    // Apply date range filter FIRST - only if both start and end dates are provided\n    if (filters.dateRange.start && filters.dateRange.end) {\n      const startDate = filters.dateRange.start ? new Date(filters.dateRange.start + 'T00:00:00') : null;\n      const endDate = filters.dateRange.end ? new Date(filters.dateRange.end + 'T23:59:59') : null;\n\n      filtered = filtered.filter(client => {\n        if (!client.firstVisitDate) return false;\n        const clientDate = parseDate(client.firstVisitDate);\n        if (!clientDate) return false;\n        clientDate.setHours(0, 0, 0, 0);\n        return (!startDate || clientDate >= startDate) && (!endDate || clientDate <= endDate);\n      });\n    }\n\n    // Apply additional filters (but NOT the selectedLocation tab filter)\n    if (filters.location.length > 0) {\n      filtered = filtered.filter(client => filters.location.includes(client.firstVisitLocation || '') || filters.location.includes(client.homeLocation || ''));\n    }\n    if (filters.trainer.length > 0) {\n      filtered = filtered.filter(client => filters.trainer.includes(client.trainerName || ''));\n    }\n    if (filters.conversionStatus.length > 0) {\n      filtered = filtered.filter(client => filters.conversionStatus.includes(client.conversionStatus || ''));\n    }\n    if (filters.retentionStatus.length > 0) {\n      filtered = filtered.filter(client => filters.retentionStatus.includes(client.retentionStatus || ''));\n    }\n    if (filters.paymentMethod.length > 0) {\n      filtered = filtered.filter(client => filters.paymentMethod.includes(client.paymentMethod || ''));\n    }\n    if (filters.isNew.length > 0) {\n      filtered = filtered.filter(client => filters.isNew.includes(client.isNew || ''));\n    }\n    if (filters.minLTV !== undefined) {\n      filtered = filtered.filter(client => (client.ltv || 0) >= filters.minLTV!);\n    }\n    if (filters.maxLTV !== undefined) {\n      filtered = filtered.filter(client => (client.ltv || 0) <= filters.maxLTV!);\n    }\n\n    return filtered;\n  }, [data, filters]);\n\n  // Compute counts per location using the current filters only (no selectedLocation tab filter)\n  const tabCounts = React.useMemo(() => {\n    const matchKenkere = (loc: string) => loc.toLowerCase().includes('kenkere') || loc.toLowerCase().includes('bengaluru') || loc === 'Kenkere House';\n\n    const countFor = (predicate: (c: typeof data[number]) => boolean) => filteredByFiltersOnly.filter(predicate).length;\n\n    const all = filteredByFiltersOnly.length;\n    const kwality = countFor(c => (c.firstVisitLocation === 'Kwality House, Kemps Corner') || (c.homeLocation === 'Kwality House, Kemps Corner'));\n    const supreme = countFor(c => (c.firstVisitLocation === 'Supreme HQ, Bandra') || (c.homeLocation === 'Supreme HQ, Bandra'));\n    const kenkere = countFor(c => matchKenkere(c.firstVisitLocation || '') || matchKenkere(c.homeLocation || ''));\n\n    return { all, kwality, supreme, kenkere };\n  }, [filteredByFiltersOnly]);\n\n  // Special filtered data for month-on-month and year-on-year tables - ignores date range but applies location filter\n  const filteredDataNoDateRange = React.useMemo(() => {\n    let filtered = data;\n\n    // Apply location filter - check both firstVisitLocation and homeLocation\n    if (selectedLocation !== 'All Locations') {\n      filtered = filtered.filter(client => {\n        const firstLocation = client.firstVisitLocation || '';\n        const homeLocation = client.homeLocation || '';\n\n        // For Kenkere House, try more flexible matching\n        if (selectedLocation === 'Kenkere House, Bengaluru') {\n          const matchesFirst = firstLocation.toLowerCase().includes('kenkere') || firstLocation.toLowerCase().includes('bengaluru') || firstLocation === 'Kenkere House';\n          const matchesHome = homeLocation.toLowerCase().includes('kenkere') || homeLocation.toLowerCase().includes('bengaluru') || homeLocation === 'Kenkere House';\n          return matchesFirst || matchesHome;\n        }\n\n        // For other locations, use exact match\n        return firstLocation === selectedLocation || homeLocation === selectedLocation;\n      });\n    }\n\n    // Apply additional filters (but NOT date range)\n    if (filters.location.length > 0) {\n      filtered = filtered.filter(client => filters.location.includes(client.firstVisitLocation || '') || filters.location.includes(client.homeLocation || ''));\n    }\n    if (filters.trainer.length > 0) {\n      filtered = filtered.filter(client => filters.trainer.includes(client.trainerName || ''));\n    }\n\n    // Apply other filters\n    if (filters.conversionStatus.length > 0) {\n      filtered = filtered.filter(client => filters.conversionStatus.includes(client.conversionStatus || ''));\n    }\n    if (filters.retentionStatus.length > 0) {\n      filtered = filtered.filter(client => filters.retentionStatus.includes(client.retentionStatus || ''));\n    }\n    if (filters.paymentMethod.length > 0) {\n      filtered = filtered.filter(client => filters.paymentMethod.includes(client.paymentMethod || ''));\n    }\n    if (filters.isNew.length > 0) {\n      filtered = filtered.filter(client => filters.isNew.includes(client.isNew || ''));\n    }\n\n    // Apply LTV filters\n    if (filters.minLTV !== undefined) {\n      filtered = filtered.filter(client => (client.ltv || 0) >= filters.minLTV!);\n    }\n    if (filters.maxLTV !== undefined) {\n      filtered = filtered.filter(client => (client.ltv || 0) <= filters.maxLTV!);\n    }\n    \n    return filtered;\n  }, [data, selectedLocation, filters]);\n  const heroMetrics = useMemo(() => {\n    if (!filteredData || filteredData.length === 0) return [];\n    \n    const totalTrials = filteredData.length;\n    const newMembers = filteredData.filter(c => String(c.isNew || '').toLowerCase().includes('new')).length;\n    const converted = filteredData.filter(c => c.conversionStatus === 'Converted').length;\n    const retained = filteredData.filter(c => c.retentionStatus === 'Retained').length;\n    const conversionRate = newMembers > 0 ? (converted / newMembers) * 100 : 0;\n    const retentionRate = newMembers > 0 ? (retained / newMembers) * 100 : 0;\n    const totalLTV = filteredData.reduce((sum, c) => sum + (c.ltv || 0), 0);\n    const avgLTV = totalTrials > 0 ? totalLTV / totalTrials : 0;\n    \n    return [\n      {\n        location: 'Overview',\n        label: 'Total Trials',\n        value: formatNumber(totalTrials),\n        subtext: `${formatNumber(newMembers)} new members`\n      },\n      {\n        location: 'Conversion',\n        label: 'Conversion Rate',\n        value: formatPercentage(conversionRate),\n        subtext: `${formatNumber(converted)} converted`\n      },\n      {\n        location: 'Retention',\n        label: 'Retention Rate',\n        value: formatPercentage(retentionRate),\n        subtext: `${formatNumber(retained)} retained`\n      },\n      {\n        location: 'LTV',\n        label: 'Avg LTV',\n        value: formatCurrency(avgLTV),\n        subtext: `${formatCurrency(totalLTV)} total`\n      }\n    ];\n  }, [filteredData]);\n  \n  // Build section-wise processed export maps (not raw sheet rows)\n  const exportAdditionalData = React.useMemo(() => {\n    // Export visible pivot table data\n    const momByTypeExport: any[] = [];\n    const yoyExport: any[] = [];\n    const membershipExport: any[] = [];\n    const hostedClassesExport: any[] = [];\n    const newClientPurchasesExport: any[] = [];\n    \n    // For Month on Month by Type - build from client types\n    const clientTypes = [...new Set(filteredDataNoDateRange.map(c => c.isNew || 'Unknown'))];\n    clientTypes.forEach(type => {\n      const typeData = filteredDataNoDateRange.filter(c => (c.isNew || 'Unknown') === type);\n      momByTypeExport.push({\n        'Client Type': type,\n        'Total Trials': typeData.length,\n        'New Members': typeData.filter(c => String(c.isNew || '').toLowerCase().includes('new')).length,\n        'Converted': typeData.filter(c => c.conversionStatus === 'Converted').length,\n        'Retained': typeData.filter(c => c.retentionStatus === 'Retained').length,\n        'Total LTV': formatCurrency(typeData.reduce((s, c) => s + (c.ltv || 0), 0))\n      });\n    });\n\n    // For Year on Year - build from membership types\n    const membershipTypes = [...new Set(filteredDataNoDateRange.map(c => c.membershipUsed || 'Unknown'))];\n    membershipTypes.forEach(type => {\n      const typeData = filteredDataNoDateRange.filter(c => (c.membershipUsed || 'Unknown') === type);\n      yoyExport.push({\n        'Membership Type': type,\n        'Total Trials': typeData.length,\n        'New Members': typeData.filter(c => String(c.isNew || '').toLowerCase().includes('new')).length,\n        'Converted': typeData.filter(c => c.conversionStatus === 'Converted').length,\n        'Retained': typeData.filter(c => c.retentionStatus === 'Retained').length,\n        'Total LTV': formatCurrency(typeData.reduce((s, c) => s + (c.ltv || 0), 0))\n      });\n    });\n\n    // For New Client Purchases - build membership purchase stats\n    const newClientsData = filteredDataNoDateRange.filter(c => String(c.isNew || '').toLowerCase().includes('new'));\n    const membershipPurchaseStats: Record<string, any> = {};\n    \n    newClientsData.forEach(client => {\n      const membership = client.membershipsBoughtPostTrial || 'No Membership Purchase';\n      const memberships = membership.split(',').map(m => m.trim()).filter(m => m);\n      \n      if (memberships.length === 0 || membership === '') {\n        if (!membershipPurchaseStats['No Membership Purchase']) {\n          membershipPurchaseStats['No Membership Purchase'] = {\n            units: 0, clients: new Set(), totalLTV: 0, conversionSpans: [], visitsPostTrial: [], convertedClients: 0\n          };\n        }\n        membershipPurchaseStats['No Membership Purchase'].clients.add(client.memberId);\n        membershipPurchaseStats['No Membership Purchase'].totalLTV += client.ltv || 0;\n        return;\n      }\n      \n      memberships.forEach(mem => {\n        if (!membershipPurchaseStats[mem]) {\n          membershipPurchaseStats[mem] = {\n            units: 0, clients: new Set(), totalLTV: 0, conversionSpans: [], visitsPostTrial: [], convertedClients: 0\n          };\n        }\n        membershipPurchaseStats[mem].units++;\n        membershipPurchaseStats[mem].clients.add(client.memberId);\n        membershipPurchaseStats[mem].totalLTV += client.ltv || 0;\n        \n        if (client.conversionStatus === 'Converted') {\n          membershipPurchaseStats[mem].convertedClients++;\n          if (client.conversionSpan && client.conversionSpan > 0) {\n            membershipPurchaseStats[mem].conversionSpans.push(client.conversionSpan);\n          }\n        }\n        \n        if (client.visitsPostTrial) {\n          membershipPurchaseStats[mem].visitsPostTrial.push(client.visitsPostTrial);\n        }\n      });\n    });\n    \n    Object.entries(membershipPurchaseStats).forEach(([membershipType, stats]: [string, any]) => {\n      const newClientsCount = stats.clients.size;\n      const avgDaysTaken = stats.conversionSpans.length > 0 \n        ? stats.conversionSpans.reduce((sum: number, span: number) => sum + span, 0) / stats.conversionSpans.length \n        : 0;\n      const avgVisitsPostTrial = stats.visitsPostTrial.length > 0\n        ? stats.visitsPostTrial.reduce((sum: number, visits: number) => sum + visits, 0) / stats.visitsPostTrial.length\n        : 0;\n      const conversionRate = newClientsCount > 0 ? (stats.convertedClients / newClientsCount) * 100 : 0;\n      \n      newClientPurchasesExport.push({\n        'Membership Type': membershipType,\n        'Units Sold': stats.units,\n        'New Clients': newClientsCount,\n        'Total Value (LTV)': formatCurrency(stats.totalLTV),\n        'Avg Value': formatCurrency(newClientsCount > 0 ? stats.totalLTV / newClientsCount : 0),\n        'Avg Days to Convert': avgDaysTaken > 0 ? `${avgDaysTaken.toFixed(1)} days` : 'N/A',\n        'Avg Visits': avgVisitsPostTrial.toFixed(1),\n        'Conversion %': `${conversionRate.toFixed(1)}%`\n      });\n    });\n\n    return {\n      'Client Retention • Month on Month by Type': momByTypeExport,\n      'Client Retention • Year on Year': yoyExport,\n      'Client Retention • Memberships': membershipExport,\n      'Client Retention • Hosted Classes': hostedClassesExport,\n      'Client Retention • New Client Purchases': newClientPurchasesExport\n    };\n  }, [filteredDataNoDateRange]);\n\n  const exportButton = <AdvancedExportButton additionalData={exportAdditionalData} defaultFileName={`client-retention-${selectedLocation.replace(/\\s+/g, '-').toLowerCase()}`} size=\"sm\" variant=\"ghost\" buttonClassName=\"rounded-xl border border-white/30 text-white hover:border-white/50\" />;\n  return <div className=\"min-h-screen bg-white relative overflow-hidden\">\n      {/* Enhanced Background Elements */}\n      <div className=\"absolute inset-0 overflow-hidden\">\n        <div className=\"absolute top-20 left-10 w-96 h-96 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-full floating-animation stagger-1\"></div>\n        <div className=\"absolute bottom-20 right-10 w-80 h-80 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-full floating-animation stagger-3\"></div>\n        <div className=\"absolute top-1/2 left-1/3 w-72 h-72 bg-gradient-to-r from-cyan-500/10 to-teal-500/10 rounded-full morph-shape stagger-2\"></div>\n      </div>\n\n      <div className=\"relative z-10\">\n        <div className=\"bg-white text-slate-800 slide-in-from-left\">\n          <DashboardMotionHero \n            title=\"Client Conversion & Retention\" \n            subtitle=\"Comprehensive client acquisition and retention analysis across all customer touchpoints\" \n            metrics={heroMetrics}\n            extra={exportButton}\n          />\n        </div>\n\n        <div className=\"container mx-auto px-6 py-8 bg-white min-h-screen\">\n          <main className=\"space-y-8 slide-in-from-right stagger-1\">\n            {/* Section Navigation */}\n            <SectionTimelineNav />\n            \n            {/* Enhanced Location Tabs - unified styling (moved above filters) */}\n            <StudioLocationTabs \n              activeLocation={selectedLocation === 'All Locations' ? 'all' : \n                selectedLocation.toLowerCase().includes('kwality') ? 'kwality' : \n                selectedLocation.toLowerCase().includes('supreme') ? 'supreme' : \n                selectedLocation.toLowerCase().includes('kenkere') ? 'kenkere' : 'all'}\n              onLocationChange={(locationId) => {\n                const locationMap: Record<string, string> = {\n                  'all': 'All Locations',\n                  'kwality': 'Kwality House, Kemps Corner',\n                  'supreme': 'Supreme HQ, Bandra',\n                  'kenkere': 'Kenkere House, Bengaluru'\n                };\n                setSelectedLocation(locationMap[locationId] || 'All Locations');\n              }}\n              showInfoPopover={true}\n              infoPopoverContext=\"client-retention-overview\"\n            />\n\n            {/* Enhanced Filter Section */}\n            <div className=\"glass-card modern-card-hover p-6 rounded-2xl\" id=\"filters\">\n              <EnhancedClientConversionFilterSection filters={filters} onFiltersChange={setFilters} locations={uniqueLocations} trainers={uniqueTrainers} membershipTypes={uniqueMembershipTypes} />\n            </div>\n\n          {/* Enhanced Metric Cards */}\n          <div id=\"metrics\" className=\"rounded-2xl p-0\">\n            <ClientConversionMetricCards \n              data={filteredData}\n              historicalData={filteredDataNoDateRange}\n              dateRange={filters.dateRange}\n              onCardClick={(title, data, metricType) => setDrillDownModal({\n              isOpen: true,\n              client: null,\n              title: `${title} - Detailed Analysis`,\n              data: {\n                clients: data,\n                metricType\n              },\n              type: 'metric'\n            })}\n            />\n          </div>\n\n          {/* Enhanced Simplified Ranking System */}\n          <div className=\"glass-card modern-card-hover rounded-2xl p-6 slide-in-right stagger-3\" id=\"rankings\">\n            <ClientConversionSimplifiedRanks \n              data={filteredData} \n              payrollData={filteredPayrollData}\n              allPayrollData={payrollData}\n              allClientData={data}\n              selectedLocation={selectedLocation}\n              dateRange={filters.dateRange}\n              selectedMetric={selectedMetric}\n              onDrillDown={(type, item, metric) => {\n                // Enhanced filtering\n                const relatedClients = filteredData.filter(client => {\n                  let match = false;\n                  if (type === 'trainer') {\n                    match = client.trainerName === item.name;\n                  } else if (type === 'location') {\n                    match = client.firstVisitLocation === item.name || client.homeLocation === item.name;\n                  } else if (type === 'membership') {\n                    match = client.membershipUsed === item.name;\n                  }\n                  return match;\n                });\n\n                const relatedPayroll = filteredPayrollData.filter(payroll => {\n                  if (type === 'trainer') return payroll.teacherName === item.name;\n                  if (type === 'location') return payroll.location === item.name;\n                  return false;\n                });\n\n                setDrillDownModal({\n                  isOpen: true,\n                  client: null,\n                  title: `${item.name} - ${metric} Analysis`,\n                  data: {\n                    type,\n                    item,\n                    metric,\n                    relatedClients,\n                    relatedPayroll\n                  },\n                  type: 'ranking'\n                });\n              }}\n            />\n          </div>\n\n          {/* Enhanced Interactive Charts - Collapsed by default */}\n          <div className=\"space-y-4 slide-in-left stagger-4\" id=\"charts\">\n            <div className=\"glass-card rounded-2xl border-0 shadow-lg\">\n              <details className=\"group\">\n                <summary className=\"cursor-pointer p-6 font-semibold text-slate-800 border-b border-white/20 group-open:bg-gradient-to-r group-open:from-purple-50/50 group-open:to-pink-50/50 rounded-t-2xl transition-all duration-300\">\n                  📊 Interactive Charts & Visualizations\n                </summary>\n                <div className=\"p-6 bg-gradient-to-br from-white to-slate-50/50\">\n                  <ClientConversionEnhancedCharts data={filteredData} />\n                </div>\n              </details>\n            </div>\n          </div>\n\n          {/* Enhanced Data Table Selector */}\n          <div className=\"glass-card modern-card-hover rounded-2xl p-6 slide-in-right stagger-5\" id=\"table-selector\">\n            <ClientConversionDataTableSelector activeTable={activeTable} onTableChange={setActiveTable} dataLength={filteredData.length} />\n          </div>\n\n          {/* Selected Data Table */}\n          <div className=\"space-y-8\">\n            {activeTable === 'monthonmonthbytype' && <>\n              <div id=\"monthonmonthbytype-table\">\n                <ClientConversionMonthOnMonthByTypeTable \n                data={filteredData} \n                visitsSummary={visitsSummary}\n                onRowClick={rowData => setDrillDownModal({\n              isOpen: true,\n              client: null,\n              title: `${rowData.month} - ${rowData.type} Analysis`,\n              data: rowData,\n              type: 'month'\n            })} />\n              </div>\n              {/* AI Notes removed */}\n            </>}\n\n            {activeTable === 'monthonmonth' && <>\n              <div id=\"monthonmonth-table\">\n                {/* Pivoted MoM by Client Type with months as columns, independent from date range */}\n                <ClientRetentionMonthByTypePivot\n                  data={filteredDataNoDateRange}\n                  visitsSummary={visitsSummaryNoDateRange}\n                  onRowClick={rowData => setDrillDownModal({\n                    isOpen: true,\n                    client: null,\n                    title: `${rowData.type} - Analysis`,\n                    data: rowData,\n                    type: 'month'\n                  })}\n                />\n              </div>\n              {/* AI Notes removed */}\n            </>}\n\n            {activeTable === 'yearonyear' && <>\n              <div id=\"yearonyear-table\">\n                {/* Pivoted YoY with months as columns and prev/curr values */}\n                <ClientRetentionYearOnYearPivot \n                  data={filteredDataNoDateRange}\n                  onRowClick={rowData => setDrillDownModal({\n                    isOpen: true,\n                    client: null,\n                    title: `${rowData.rowKey} - Year Comparison`,\n                    data: rowData,\n                    type: 'year'\n                  })}\n                />\n              </div>\n              {/* AI Notes removed */}\n            </>}\n\n            {activeTable === 'hostedclasses' && <>\n              <div id=\"hostedclasses-table\">\n                <ClientHostedClassesTable data={filteredData} onRowClick={rowData => setDrillDownModal({\n              isOpen: true,\n              client: null,\n              title: `${rowData.className} - ${rowData.month}`,\n              data: rowData,\n              type: 'class'\n            })} />\n              </div>\n              {/* AI Notes removed */}\n            </>}\n\n            {activeTable === 'memberships' && <>\n              <div id=\"memberships-table\">\n                <ClientConversionMembershipTable data={filteredData} />\n              </div>\n              {/* AI Notes removed */}\n            </>}\n\n            {activeTable === 'teacherperformance' && <>\n              <div id=\"teacherperformance-table\">\n                <TeacherPerformanceTable \n                  data={filteredData}\n                  onRowClick={rowData => setDrillDownModal({\n                    isOpen: true,\n                    client: null,\n                    title: `${rowData.trainerName} - Teacher Performance Analysis`,\n                    data: {\n                      type: 'trainer',\n                      item: { name: rowData.trainerName },\n                      metric: 'performance',\n                      relatedClients: filteredData.filter(client => client.trainerName === rowData.trainerName),\n                      relatedPayroll: filteredPayrollData.filter(payroll => payroll.teacherName === rowData.trainerName)\n                    },\n                    type: 'ranking'\n                  })}\n                />\n              </div>\n              {/* AI Notes removed */}\n            </>}\n\n            {activeTable === 'newclientpurchases' && <>\n              <div id=\"newclientpurchases-table\">\n                <NewClientMembershipPurchaseTable data={filteredData}\n                />\n              </div>\n              {/* AI Notes removed */}\n            </>}\n          </div>\n        </main>\n\n        {/* Enhanced Drill Down Modal - Lazy loaded */}\n        <ModalSuspense>\n          {drillDownModal.isOpen && (\n            <LazyClientConversionDrillDownModalV3 \n              isOpen={drillDownModal.isOpen} \n              onClose={() => setDrillDownModal({\n                isOpen: false,\n                client: null,\n                title: '',\n                data: null,\n                type: 'month'\n              })} \n              title={drillDownModal.title} \n              data={drillDownModal.data} \n              type={drillDownModal.type} \n            />\n          )}\n        </ModalSuspense>\n        </div>\n      </div>\n      \n      <Footer />\n\n      <style>{`\n        @keyframes fade-in-up {\n          from {\n            opacity: 0;\n            transform: translateY(30px);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0);\n          }\n        }\n        \n        .animate-fade-in-up {\n          animation: fade-in-up 0.6s ease-out forwards;\n        }\n        \n        .delay-200 {\n          animation-delay: 0.2s;\n        }\n        \n        .delay-300 {\n          animation-delay: 0.3s;\n        }\n        \n        .delay-500 {\n          animation-delay: 0.5s;\n        }\n      `}</style>\n    </div>;\n};\nexport default ClientRetention;\n"],"names":["Image","createLucideIcon","EnhancedClientConversionFilterSection","filters","onFiltersChange","locations","trainers","membershipTypes","isExpanded","setIsExpanded","useState","searchTerm","setSearchTerm","handleArrayFilterChange","filterKey","value","currentValues","newValues","v","handleDateRangeChange","range","formatDateForFilter","date","year","month","day","resetFilters","activeFiltersCount","mainLocations","availableLocations","loc","filterSections","MapPin","Users","Target","CreditCard","jsxs","Card","jsx","CardHeader","CardTitle","Filter","Badge","Button","RotateCcw","ChevronUp","CardContent","Calendar","DatePickerWithRange","Search","Input","e","DollarSign","section","filter","option","ChevronDown","ClientConversionSimplifiedRanks","data","payrollData","allPayrollData","allClientData","selectedLocation","dateRange","selectedMetric","onDrillDown","selectedRanking","setSelectedRanking","trainerStats","React","stats","payroll","trainer","trainerStat","client","stat","conversionRate","retentionRate","classAverage","avgLTV","emptyClassRate","locationStats","location","locationStat","membershipStats","membership","membershipStat","avgVisitsPerClient","rankingOptions","Trophy","AlertTriangle","Crown","getCurrentData","r","sourceData","minThreshold","sorted","item","a","b","aValue","top","bottom","currentOption","formatValue","metric","formatCurrency","formatNumber","RankCard","title","rankData","isTop","Fragment","index","drillDownType","cn","Eye","ClientConversionEnhancedCharts","selectedChart","setSelectedChart","chartOptions","TrendingUp","Activity","monthlyData","monthMap","monthKey","monthData","locationData","locationMap","trainerData","trainerMap","ltvData","ranges","ltv","renderChart","c","ResponsiveContainer","LineChart","CartesianGrid","XAxis","YAxis","Tooltip","name","Line","funnelData","BarChart","Bar","AreaChart","Area","PieChart","Pie","percent","entry","Cell","BarChart3","ClientConversionDataTableSelector","activeTable","onTableChange","dataLength","tableOptions","UserCheck","ClientConversionMonthOnMonthByTypeTable","checkins","visitsSummary","onRowClick","containerRef","useRef","registry","useMetricsTablesRegistry","tableId","sortField","setSortField","sortDirection","setSortDirection","rowType","setRowType","monthlyDataByType","useMemo","monthlyStats","parseDate","monthName","groupBy","key","y","m","summaryKey","visits","monthCompare","tableData","avgConversionDays","sum","interval","avgVisits","displayedData","av","bv","dir","handleSort","field","prev","totals","acc","row","totalsRow","useEffect","el","getTextContent","table","text","headerCells","headers","cell","cells","rowData","CopyTableButton","Table","TableHeader","TableRow","TableHead","TableBody","TableCell","METRIC_LABELS","ClientRetentionYearOnYearPivot","setMetric","displayMode","setDisplayMode","sortColumn","setSortColumn","sortDir","setSortDir","now","currentYear","previousYear","months","currentMonth","monthsArr","monthNum","rowKeys","set","an","bn","pivot","initCell","map","rk","d","dataKey","rowKey","bucket","val","sortedRowKeys","aData","bData","aCurr","bCurr","aVal","bVal","col","generateAllTabsContent","useCallback","sections","metricKeys","formatVal","mk","totalRow","h","k","ArrowUpDown","prevMonth","nextMonth","isFirstOfGroup","isLastOfGroup","allClients","cellData","clients","ClientConversionMembershipTable","membershipData","columns","Award","ModernDataTable","withNew","ClientHostedClassesTable","Dumbbell","hostedClassData","classStats","className","t","datePart","firstVisitDate","firstPurchaseDate","intervalDays","safeValue","arr","aiNotes","topTrials","bestConv","bestRet","notes","motion","insight","TeacherPerformanceTable","tableTitle","getAllTabsText","useRegisterTableForCopy","teacherStats","trainerName","newMembers","converted","retained","sortedData","copy","va","vb","na","nb","exportToCSV","csvHeaders","csvData","teacher","escape","s","csvContent","blob","url","exportToPDF","offscreen","thead","headerRow","th","tbody","tr","td","trTotal","cellIndex","canvas","html2canvas","imgData","pdf","jsPDF","imgWidth","pageHeight","imgHeight","heightLeft","position","exportToPNG","link","totalNewMembers","totalSessions","totalConverted","totalRetained","formatPercentage","FileText","Download","NewClientMembershipPurchaseTable","drillDownData","setDrillDownData","setGroupBy","newClientsData","membershipClientMap","memberships","clientType","mem","membershipPurchaseData","filteredData","newClientsCount","totalLTV","totalRevenue","avgRevenue","avgDaysTaken","span","avgVisitsPostTrial","aggregated","agg","matchingRows","totalClients","handleCellClick","fieldLabel","clientList","insights","topByUnits","topByRevenue","fastestConversion","ShoppingCart","idx","Dialog","DialogContent","DialogHeader","DialogTitle","DialogDescription","topLoc","type","topRevenue","percentage","median","ClientRetention","loading","useNewClientData","sessionsLoading","useSessionsData","payrollLoading","usePayrollData","isLoading","setLoading","useGlobalLoading","useNavigate","setSelectedLocation","setActiveTable","setSelectedMetric","drillDownModal","setDrillDownModal","setFilters","getPreviousMonthDateRange","filteredPayrollData","filtered","payrollLocation","startDate","endDate","payrollDate","summary","filteredPayrollDataNoDateRange","visitsSummaryNoDateRange","uniqueLocations","uniqueTrainers","uniqueMembershipTypes","clientDate","firstLocation","homeLocation","matchesFirst","matchesHome","filteredByFiltersOnly","matchKenkere","countFor","predicate","all","kwality","supreme","kenkere","filteredDataNoDateRange","heroMetrics","totalTrials","exportAdditionalData","momByTypeExport","yoyExport","membershipExport","hostedClassesExport","newClientPurchasesExport","typeData","membershipPurchaseStats","membershipType","exportButton","AdvancedExportButton","DashboardMotionHero","SectionTimelineNav","StudioLocationTabs","locationId","ClientConversionMetricCards","metricType","relatedClients","match","relatedPayroll","ClientRetentionMonthByTypePivot","ModalSuspense","LazyClientConversionDrillDownModalV3","Footer"],"mappings":"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","x_google_ignoreList":[0]}