import{r as E,p as O,j as e,T as q,C as k,f as v,c as M,S as J,a as T,b as R,B as K}from"./index-Bm67KBkU.js";import{a as h,f as P,B as Q}from"./index-DkD_C-d1.js";import{T as I}from"./googleAuth-BGo8ElRc.js";import{C as X}from"./clock-BP1BFskn.js";import{C as Z}from"./circle-check-big-y8tZauB3.js";import{U as Y}from"./users-7Ku-1TDB.js";import{T as _}from"./trending-down-B5K1omnR.js";import{I as ee}from"./select-CM-Birqk.js";import{a as te,A as se}from"./arrow-up-narrow-wide-CQ9hbA7a.js";const g=(o,x)=>{if(x===0)return{rate:o>0?100:0,isSignificant:o>0,trend:o>0?"moderate":"weak"};const i=(o-x)/x*100,n=Math.abs(i);let m;return i>0?m=n>20?"strong":n>5?"moderate":"weak":m=n>20?"weak":n>5?"moderate":"weak",{rate:i,isSignificant:n>2,trend:m}};function re(o=[],x,i){return E.useMemo(()=>{const n=o,m=i?.dateRange?.end?typeof i.dateRange.end=="string"?new Date(i.dateRange.end):i.dateRange.end:new Date,C=l=>new Date(l.getFullYear(),l.getMonth(),1),N=l=>new Date(l.getFullYear(),l.getMonth()+1,0,23,59,59,999),a=C(m);N(m);const r=new Date(a.getFullYear(),a.getMonth()-1,15),f=C(r),w=N(r),j=l=>l.toLocaleDateString(void 0,{month:"short",year:"numeric"}),u=`${j(a)} vs ${j(f)}`,$=(l,p,A)=>!!(l&&p&&A&&l>=p&&l<=A),c=(x&&x.length>0?x:o).filter(l=>$(O(l.endDate),f,w)),b=(l,p)=>l.filter(A=>(A.status||"").toLowerCase()===p).length,t=n.length,s=c.length,d=b(n,"active"),D=b(c,"active"),y=b(n,"churned"),F=b(c,"churned"),S=b(n,"frozen"),V=b(c,"frozen"),W=t>0?y/t*100:0,G=t>0?d/t*100:0,H=t>0?S/t*100:0,U=l=>{if(!l)return 0;const p=parseFloat(String(l).replace(/[^0-9.-]/g,""));return isNaN(p)?0:p},z=n.filter(l=>(l.status||"").toLowerCase()==="churned").reduce((l,p)=>l+U(p.paid),0),L=c.filter(l=>(l.status||"").toLowerCase()==="churned").reduce((l,p)=>l+U(p.paid),0);return{metrics:[{title:"Total Memberships",value:h(t),rawValue:t,change:g(t,s).rate,changeDetails:g(t,s),previousValue:h(s),previousRawValue:s,periodLabel:u,icon:"Users",description:"All tracked membership records"},{title:"Active Members",value:h(d),rawValue:d,change:g(d,D).rate,changeDetails:g(d,D),previousValue:h(D),previousRawValue:D,periodLabel:u,icon:"CheckCircle",description:`${G.toFixed(1)}% of total memberships`},{title:"Churned Members",value:h(y),rawValue:y,change:g(y,F).rate,changeDetails:g(y,F),previousValue:h(F),previousRawValue:F,periodLabel:u,icon:"AlertTriangle",description:`${W.toFixed(1)}% churn rate`},{title:"Frozen Members",value:h(S),rawValue:S,change:g(S,V).rate,changeDetails:g(S,V),previousValue:h(V),previousRawValue:V,periodLabel:u,icon:"Clock",description:`${H.toFixed(1)}% of total memberships`},{title:"Revenue Impact",value:P(z),rawValue:z,change:g(z,L).rate,changeDetails:g(z,L),previousValue:P(L),previousRawValue:L,periodLabel:u,icon:"TrendingUp",description:"Loss from churned members"}]}},[o,x,i?.dateRange?.start,i?.dateRange?.end])}const ae={Users:Y,CheckCircle:Z,AlertTriangle:q,Clock:X,TrendingUp:I},ue=({data:o,historicalData:x,dateRange:i,onMetricClick:n})=>{const{metrics:m}=re(o,x,{dateRange:i}),C=a=>a.title==="Active Members"?o.filter(r=>r.status==="Active"):a.title==="Churned Members"?o.filter(r=>r.status==="Churned"):a.title==="Frozen Members"?o.filter(r=>r.status==="Frozen"):o,N=m.slice(0,8);return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:N.map((a,r)=>{const f=ae[a.icon]||Y,w=a.change>0,j=a.change<0;return e.jsx(k,{className:v("group relative overflow-hidden cursor-pointer transition-all duration-700","bg-white hover:bg-gradient-to-br hover:from-gray-900 hover:via-slate-900 hover:to-slate-900",r%4===0&&"border-t-4 border-green-700 hover:border-green-700 shadow-lg",r%4===1&&"border-t-4 border-blue-700 hover:border-blue-700 shadow-lg",r%4===2&&"border-t-4 border-pink-700 hover:border-pink-700 shadow-lg",r%4===3&&"border-t-4 border-red-700 hover:border-red-700 shadow-lg","hover:shadow-2xl hover:shadow-slate-900/30","hover:-translate-y-2 hover:scale-[1.02]",n&&"hover:cursor-pointer"),onClick:()=>{const u=C(a);n?.(u,a.title.toLowerCase())},children:e.jsxs(M,{className:"p-6 relative",children:[e.jsx("div",{className:"absolute top-4 right-4 opacity-10 group-hover:opacity-20 transition-all duration-700",children:e.jsx(f,{className:v("w-12 h-12 transition-all duration-700",r%4===0&&"text-green-700",r%4===1&&"text-blue-700",r%4===2&&"text-pink-700",r%4===3&&"text-red-700","group-hover:text-white/40")})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:v("p-4 rounded-2xl transition-all duration-700 border-1 shadow-md",r%4===0&&"bg-gradient-to-br from-green-700 to-green-600 border-green-900 text-white shadow-green-200",r%4===1&&"bg-gradient-to-br from-blue-700 to-blue-600 border-blue-900 text-white shadow-blue-200",r%4===2&&"bg-gradient-to-br from-pink-700 to-pink-600 border-pink-900 text-white shadow-pink-200",r%4===3&&"bg-gradient-to-br from-red-700 to-red-600 border-red-900 text-white shadow-red-200","group-hover:bg-white/20 group-hover:border-white/40 group-hover:text-white group-hover:shadow-white/20"),children:e.jsx(f,{className:"w-6 h-6 drop-shadow-sm"})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h3",{className:"font-semibold text-lg text-slate-900 group-hover:text-white/95 transition-colors duration-700",children:a.title})})]}),e.jsxs("div",{className:v("flex items-center space-x-1 px-3 py-1 rounded-full text-xs font-semibold transition-all duration-700",w?"bg-green-50 text-green-700 group-hover:bg-green-400/30 group-hover:text-green-100":j?"bg-red-50 text-red-700 group-hover:bg-red-400/30 group-hover:text-red-100":"bg-blue-50 text-blue-700 group-hover:bg-blue-400/30 group-hover:text-blue-100"),children:[w&&e.jsx(I,{className:"w-3 h-3"}),j&&e.jsx(_,{className:"w-3 h-3"}),e.jsxs("span",{children:[a.change>0?"+":"",a.change.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:v("text-4xl font-bold transition-all duration-700 text-slate-900 group-hover:text-white"),children:a.value}),e.jsx("p",{className:v("text-xs text-slate-500 group-hover:text-slate-200 transition-colors"),children:a.periodLabel?e.jsxs(e.Fragment,{children:[a.periodLabel,": ",e.jsx("span",{className:"font-medium",children:a.previousValue})]}):e.jsxs(e.Fragment,{children:["vs previous month: ",e.jsx("span",{className:"font-medium",children:a.previousValue})]})})]})]}),e.jsx("div",{className:v("mt-4 p-3 border-t border-l-4 transition-all duration-700","bg-slate-50 group-hover:bg-slate-800/50 border-t-slate-200 group-hover:border-t-white/10",r%4===0&&"border-l-green-700",r%4===1&&"border-l-blue-700",r%4===2&&"border-l-pink-700",r%4===3&&"border-l-red-700"),children:e.jsx("p",{className:"text-xs text-slate-900 group-hover:text-white transition-colors duration-700",children:a.description})})]})},a.title)})})},be=({data:o,onRowClick:x})=>{const[i,n]=E.useState(""),[m,C]=E.useState("endDate"),[N,a]=E.useState("asc"),r=t=>{m===t?a(N==="asc"?"desc":"asc"):(C(t),a("asc"))},f=o.filter(t=>{const s=i.toLowerCase();return t.firstName?.toLowerCase().includes(s)||t.lastName?.toLowerCase().includes(s)||t.email?.toLowerCase().includes(s)||t.membershipName?.toLowerCase().includes(s)||t.status?.toLowerCase().includes(s)}).sort((t,s)=>{const d=t[m]||"",D=s[m]||"",y=N==="asc"?1:-1;return d.localeCompare(D)*y}),w=f.filter(t=>t.status==="Churned"),j=f.filter(t=>t.status==="Frozen"),u=f.filter(t=>t.status==="Active"),$=o.reduce((t,s)=>{const d=s.membershipName||"Unknown";return t[d]||(t[d]={name:d,total:0,active:0,churned:0,frozen:0}),t[d].total++,s.status==="Active"&&t[d].active++,s.status==="Churned"&&t[d].churned++,s.status==="Frozen"&&t[d].frozen++,t},{}),B=Object.values($).sort((t,s)=>s.total-t.total),c=({field:t,children:s})=>e.jsxs(K,{variant:"ghost",size:"sm",onClick:()=>r(t),className:"h-auto p-1 font-medium text-slate-700 hover:text-slate-900",children:[s,m===t&&(N==="asc"?e.jsx(te,{className:"ml-1 h-3 w-3"}):e.jsx(se,{className:"ml-1 h-3 w-3"}))]}),b=t=>e.jsx(Q,{variant:"outline",className:v("text-xs",t==="Churned"?"border-red-200 bg-red-50 text-red-700":t==="Frozen"?"border-yellow-200 bg-yellow-50 text-yellow-700":"border-green-200 bg-green-50 text-green-700"),children:t});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(k,{className:"bg-white/70 backdrop-blur-lg border-gray-200/80 shadow-lg rounded-2xl",children:e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 h-4 w-4"}),e.jsx(ee,{placeholder:"Search by name, email, membership, or status...",value:i,onChange:t=>n(t.target.value),className:"pl-10 border-slate-300 focus:border-blue-500 focus:ring-blue-500"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(k,{className:"bg-white/70 backdrop-blur-lg border-gray-200/80 shadow-lg rounded-2xl hover:shadow-xl transition-all duration-300",children:[e.jsx(T,{className:"pb-3",children:e.jsxs(R,{className:"text-lg font-semibold bg-gradient-to-r from-red-600 to-red-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),"Churned Memberships (",h(w.length),")"]})}),e.jsx(M,{children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-white/90",children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(c,{field:"firstName",children:"Member"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(c,{field:"membershipName",children:"Membership"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(c,{field:"endDate",children:"End Date"})}),e.jsx("th",{className:"text-left py-2 px-3",children:"Status"})]})}),e.jsx("tbody",{children:w.slice(0,50).map((t,s)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50 cursor-pointer",onClick:()=>x?.(t),children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:`${t.firstName} ${t.lastName}`}),e.jsx("td",{className:"py-2 px-3 text-slate-600 text-xs",children:t.membershipName}),e.jsx("td",{className:"py-2 px-3 text-slate-600",children:t.endDate}),e.jsx("td",{className:"py-2 px-3",children:b(t.status)})]},s))})]})})})]}),e.jsxs(k,{className:"bg-white/70 backdrop-blur-lg border-gray-200/80 shadow-lg rounded-2xl hover:shadow-xl transition-all duration-300",children:[e.jsx(T,{className:"pb-3",children:e.jsxs(R,{className:"text-lg font-semibold bg-gradient-to-r from-yellow-600 to-yellow-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),"Frozen Memberships (",h(j.length),")"]})}),e.jsx(M,{children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-white/90",children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(c,{field:"firstName",children:"Member"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(c,{field:"membershipName",children:"Membership"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(c,{field:"endDate",children:"End Date"})}),e.jsx("th",{className:"text-left py-2 px-3",children:"Status"})]})}),e.jsx("tbody",{children:j.slice(0,50).map((t,s)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50 cursor-pointer",onClick:()=>x?.(t),children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:`${t.firstName} ${t.lastName}`}),e.jsx("td",{className:"py-2 px-3 text-slate-600 text-xs",children:t.membershipName}),e.jsx("td",{className:"py-2 px-3 text-slate-600",children:t.endDate}),e.jsx("td",{className:"py-2 px-3",children:b(t.status)})]},s))})]})})})]}),e.jsxs(k,{className:"bg-white/70 backdrop-blur-lg border-gray-200/80 shadow-lg rounded-2xl hover:shadow-xl transition-all duration-300",children:[e.jsx(T,{className:"pb-3",children:e.jsxs(R,{className:"text-lg font-semibold bg-gradient-to-r from-green-600 to-green-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Active Memberships (",h(u.length),")"]})}),e.jsx(M,{children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-white/90",children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(c,{field:"firstName",children:"Member"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(c,{field:"membershipName",children:"Membership"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(c,{field:"endDate",children:"End Date"})}),e.jsx("th",{className:"text-left py-2 px-3",children:"Status"})]})}),e.jsx("tbody",{children:u.slice(0,50).map((t,s)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50 cursor-pointer",onClick:()=>x?.(t),children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:`${t.firstName} ${t.lastName}`}),e.jsx("td",{className:"py-2 px-3 text-slate-600 text-xs",children:t.membershipName}),e.jsx("td",{className:"py-2 px-3 text-slate-600",children:t.endDate}),e.jsx("td",{className:"py-2 px-3",children:b(t.status)})]},s))})]})})})]}),e.jsxs(k,{className:"bg-white/70 backdrop-blur-lg border-gray-200/80 shadow-lg rounded-2xl hover:shadow-xl transition-all duration-300",children:[e.jsx(T,{className:"pb-3",children:e.jsxs(R,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-slate-500 to-slate-600 rounded-full"}),"Membership Type Summary"]})}),e.jsx(M,{children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-white/90",children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium text-slate-700",children:"Membership"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-slate-700",children:"Total"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-green-600",children:"Active"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-yellow-600",children:"Frozen"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-red-600",children:"Churned"})]})}),e.jsx("tbody",{children:B.map((t,s)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50",children:[e.jsx("td",{className:"py-2 px-3 font-medium text-xs",children:t.name}),e.jsx("td",{className:"py-2 px-3 text-center font-medium",children:h(t.total)}),e.jsx("td",{className:"py-2 px-3 text-center text-green-600",children:h(t.active)}),e.jsx("td",{className:"py-2 px-3 text-center text-yellow-600",children:h(t.frozen)}),e.jsx("td",{className:"py-2 px-3 text-center text-red-600",children:h(t.churned)})]},s))})]})})})]})]})]})};export{ue as E,be as a};
//# sourceMappingURL=ExpirationDataTables-Dix9gqRP.js.map
