{"version":3,"file":"SalesAnimatedMetricCards-9SxqinUB.js","sources":["../../src/components/dashboard/ProductCategoryMetricsTable.tsx","../../src/hooks/useSalesMetrics.ts","../../src/utils/performanceUtils.ts","../../src/components/dashboard/SalesAnimatedMetricCards.tsx"],"sourcesContent":["import React, { useMemo, useRef, useState } from 'react';\nimport { BarChart3, ChevronDown, ChevronRight } from 'lucide-react';\nimport { SalesData, FilterOptions, YearOnYearMetricType } from '@/types/dashboard';\nimport { ModernTableWrapper, STANDARD_METRICS } from './ModernTableWrapper';\nimport { TABLE_STYLES } from '@/styles/tableStyles';\nimport { cn } from '@/lib/utils';\nimport { formatCurrency, formatNumber } from '@/utils/formatters';\nimport { parseDate } from '@/utils/dateUtils';\nimport { Badge } from '@/components/ui/badge';\n\ninterface ProductCategoryMetricsTableProps {\n  /** Raw sales rows (can be already filtered). The table will re-apply the provided dateRange. */\n  data: SalesData[];\n  /** Date range context (defaults to previous-month range provided by parent Sales tab). */\n  filters?: FilterOptions;\n  onReady?: () => void;\n}\n\ntype MetricDef = { key: YearOnYearMetricType; label: string };\n\nconst METRICS: MetricDef[] = STANDARD_METRICS.map((m) => ({\n  key: m.key as YearOnYearMetricType,\n  label: m.label,\n}));\n\nconst toDateRange = (filters?: FilterOptions) => {\n  const start = filters?.dateRange?.start ? new Date(filters.dateRange.start) : null;\n  const end = filters?.dateRange?.end\n    ? (() => {\n        const d = new Date(filters.dateRange.end);\n        d.setHours(23, 59, 59, 999);\n        return d;\n      })()\n    : null;\n  return { start, end };\n};\n\nconst withinRange = (dateStr: string | undefined, start: Date | null, end: Date | null) => {\n  if (!dateStr) return false;\n  const d = parseDate(dateStr);\n  if (!d) return false;\n  if (start && d < start) return false;\n  if (end && d > end) return false;\n  return true;\n};\n\nconst getPeriodLabel = (filters?: FilterOptions) => {\n  const start = filters?.dateRange?.start ? parseDate(filters.dateRange.start) : null;\n  const end = filters?.dateRange?.end ? parseDate(filters.dateRange.end) : null;\n\n  const base = start || end;\n  if (base) {\n    return base.toLocaleString('en-US', { month: 'short', year: 'numeric' });\n  }\n\n  // Fallback: previous month\n  const now = new Date();\n  const prevMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\n  return prevMonth.toLocaleString('en-US', { month: 'short', year: 'numeric' });\n};\n\nconst num = (v: any): number => {\n  if (typeof v === 'number') return isFinite(v) ? v : 0;\n  if (typeof v === 'string') {\n    const n = parseFloat(v.replace(/[\\s,]/g, ''));\n    return isNaN(n) ? 0 : n;\n  }\n  return 0;\n};\n\nconst getMetricValue = (items: SalesData[], metric: YearOnYearMetricType) => {\n  if (!items.length) return 0;\n\n  // NET revenue: paymentValue - VAT\n  const totalRevenue = items.reduce((sum, item) => {\n    const payment = num((item as any).paymentValue);\n    const vat = num((item as any).paymentVAT) || num((item as any).vat);\n    return sum + (payment - vat);\n  }, 0);\n\n  const transactionIds = new Set(\n    items\n      .map((item) => (item as any).paymentTransactionId || (item as any).paymentTransactionID || (item as any).transactionId)\n      .filter(Boolean)\n  );\n  const totalTransactions = transactionIds.size > 0 ? transactionIds.size : items.length;\n\n  const uniqueMembers = new Set(items.map((item) => item.memberId || item.customerEmail).filter(Boolean)).size;\n\n  const unitIds = new Set(\n    items\n      .map((item) => (item as any).salesItemId || (item as any).saleItemId || (item as any).saleItemID || (item as any).itemId)\n      .filter(Boolean)\n  );\n  const totalUnits = unitIds.size > 0 ? unitIds.size : items.length;\n\n  const totalDiscountAmount = items.reduce((sum, item) => sum + num((item as any).discountAmount), 0);\n  const totalVat = items.reduce((sum, item) => sum + (num((item as any).paymentVAT) || num((item as any).vat)), 0);\n\n  const totalGrossRevenue = items.reduce((sum, item) => sum + num((item as any).paymentValue), 0);\n  const discountPercentage = totalGrossRevenue > 0 ? (totalDiscountAmount / totalGrossRevenue) * 100 : 0;\n\n  // Purchase Frequency in Days\n  const dates = items\n    .map((item) => parseDate(item.paymentDate))\n    .filter((d): d is Date => !!d)\n    .sort((a, b) => a.getTime() - b.getTime());\n\n  let purchaseFrequency = 0;\n  if (dates.length > 1) {\n    const totalDays = (dates[dates.length - 1].getTime() - dates[0].getTime()) / (1000 * 60 * 60 * 24);\n    purchaseFrequency = totalDays / (dates.length - 1);\n  }\n\n  switch (metric) {\n    case 'revenue':\n      return totalRevenue;\n    case 'units':\n      return totalUnits;\n    case 'transactions':\n      return totalTransactions;\n    case 'members':\n      return uniqueMembers;\n    case 'auv':\n      return uniqueMembers > 0 ? totalRevenue / uniqueMembers : 0;\n    case 'atv':\n      return totalTransactions > 0 ? totalRevenue / totalTransactions : 0;\n    case 'asv':\n      return uniqueMembers > 0 ? totalRevenue / uniqueMembers : 0;\n    case 'upt':\n      return totalTransactions > 0 ? totalUnits / totalTransactions : 0;\n    case 'vat':\n      return totalVat;\n    case 'discountAmount':\n    case 'discountValue':\n      return totalDiscountAmount;\n    case 'discountPercentage':\n      return discountPercentage;\n    case 'purchaseFrequency':\n      return purchaseFrequency;\n    default:\n      return 0;\n  }\n};\n\nconst formatMetricValue = (value: number, metric: YearOnYearMetricType) => {\n  switch (metric) {\n    case 'revenue':\n    case 'auv':\n    case 'atv':\n    case 'asv':\n    case 'vat':\n    case 'discountValue':\n    case 'discountAmount':\n      return formatCurrency(value);\n    case 'transactions':\n    case 'members':\n    case 'units':\n      return formatNumber(value);\n    case 'upt':\n      return value.toFixed(1);\n    case 'discountPercentage':\n      return `${value.toFixed(1)}%`;\n    case 'purchaseFrequency':\n      return `${value.toFixed(1)} days`;\n    default:\n      return formatNumber(value);\n  }\n};\n\ntype CategoryBlock = {\n  category: string;\n  products: Array<{ product: string; items: SalesData[] }>;\n};\n\nexport const ProductCategoryMetricsTable: React.FC<ProductCategoryMetricsTableProps> = ({\n  data,\n  filters,\n  onReady,\n}) => {\n  const tableRef = useRef<HTMLTableElement>(null);\n  const [collapsedCategories, setCollapsedCategories] = useState<Set<string>>(new Set());\n\n  const periodLabel = useMemo(() => getPeriodLabel(filters), [filters]);\n\n  const { start, end } = useMemo(() => toDateRange(filters), [filters]);\n\n  const periodData = useMemo(() => {\n    const rows = Array.isArray(data) ? data : [];\n    // Re-apply date-range so this table is always “previous month/current selected period”\n    return rows.filter((r) => withinRange(r.paymentDate, start, end));\n  }, [data, start, end]);\n\n  const grouped = useMemo<CategoryBlock[]>(() => {\n    const byCategory = new Map<string, Map<string, SalesData[]>>();\n\n    for (const row of periodData) {\n      const category = row.cleanedCategory || 'Uncategorized';\n      const product = row.cleanedProduct || 'Unspecified';\n      if (!byCategory.has(category)) byCategory.set(category, new Map());\n      const byProduct = byCategory.get(category)!;\n      if (!byProduct.has(product)) byProduct.set(product, []);\n      byProduct.get(product)!.push(row);\n    }\n\n    const blocks: CategoryBlock[] = [];\n    for (const [category, byProduct] of byCategory.entries()) {\n      const products = Array.from(byProduct.entries())\n        .map(([product, items]) => ({ product, items }))\n        .sort((a, b) => getMetricValue(b.items, 'revenue') - getMetricValue(a.items, 'revenue'));\n      blocks.push({ category, products });\n    }\n\n    // Sort categories by revenue descending\n    blocks.sort((a, b) => {\n      const aRev = getMetricValue(a.products.flatMap((p) => p.items), 'revenue');\n      const bRev = getMetricValue(b.products.flatMap((p) => p.items), 'revenue');\n      return bRev - aRev;\n    });\n\n    return blocks;\n  }, [periodData]);\n\n  const totals = useMemo(() => {\n    const totalByMetric = new Map<YearOnYearMetricType, number>();\n    for (const m of METRICS) {\n      totalByMetric.set(m.key, getMetricValue(periodData, m.key));\n    }\n    return totalByMetric;\n  }, [periodData]);\n\n  const totalProducts = useMemo(() => grouped.reduce((sum, g) => sum + g.products.length, 0), [grouped]);\n\n  const toggleCategory = (category: string) => {\n    setCollapsedCategories((prev) => {\n      const next = new Set(prev);\n      if (next.has(category)) next.delete(category);\n      else next.add(category);\n      return next;\n    });\n  };\n\n  const collapseAll = () => setCollapsedCategories(new Set(grouped.map((g) => g.category)));\n  const expandAll = () => setCollapsedCategories(new Set());\n\n  React.useEffect(() => {\n    onReady?.();\n  }, [onReady]);\n\n  return (\n    <ModernTableWrapper\n      title=\"Product × Category Metrics (Previous Month)\"\n      description={`Each metric is a column; rows are products grouped by category for ${periodLabel}.`}\n      icon={<BarChart3 className=\"w-5 h-5 text-white\" />}\n      totalItems={totalProducts}\n      headerControls={\n        <Badge variant=\"secondary\" className=\"bg-white/20 text-white font-semibold\">\n          {periodLabel}\n        </Badge>\n      }\n      showCollapseControls={true}\n      onCollapseAll={collapseAll}\n      onExpandAll={expandAll}\n      tableRef={tableRef}\n      contextInfo={{\n        selectedMetric: 'all',\n        dateRange: filters?.dateRange?.start && filters?.dateRange?.end ? filters.dateRange : undefined,\n        filters: {\n          category: filters?.category,\n          product: filters?.product,\n          soldBy: filters?.soldBy,\n          paymentMethod: filters?.paymentMethod,\n        },\n      }}\n    >\n      <div className={TABLE_STYLES.container}>\n        <table ref={tableRef} className={TABLE_STYLES.table}>\n          <thead className={TABLE_STYLES.header.wrapper}>\n            <tr className={TABLE_STYLES.header.row}>\n              <th\n                className={cn(\n                  TABLE_STYLES.header.cell,\n                  TABLE_STYLES.header.cellSticky,\n                  'min-w-[280px]'\n                )}\n              >\n                Product\n              </th>\n              {METRICS.map((m) => (\n                <th\n                  key={m.key}\n                  className={cn(TABLE_STYLES.header.cell, TABLE_STYLES.header.monthCell)}\n                >\n                  <div className={TABLE_STYLES.header.monthDisplay}>\n                    <span className={TABLE_STYLES.header.monthText}>{m.label}</span>\n                  </div>\n                </th>\n              ))}\n            </tr>\n          </thead>\n\n          <tbody>\n            {grouped.length === 0 ? (\n              <tr className={TABLE_STYLES.body.row}>\n                <td className={cn(TABLE_STYLES.body.cell, 'text-center text-slate-500')} colSpan={METRICS.length + 1}>\n                  No records found for the selected period.\n                </td>\n              </tr>\n            ) : (\n              grouped.map((group, groupIndex) => {\n                const isCollapsed = collapsedCategories.has(group.category);\n                const categoryItems = group.products.flatMap((p) => p.items);\n                return (\n                  <React.Fragment key={group.category}>\n                    <tr className={TABLE_STYLES.group.row}>\n                      <td className={cn(TABLE_STYLES.group.cell, TABLE_STYLES.group.cellSticky)}>\n                        <button\n                          type=\"button\"\n                          onClick={() => toggleCategory(group.category)}\n                          className=\"flex items-center gap-2 w-full text-left\"\n                        >\n                          {isCollapsed ? (\n                            <ChevronRight className={TABLE_STYLES.group.expandIcon} />\n                          ) : (\n                            <ChevronDown className={TABLE_STYLES.group.expandIcon} />\n                          )}\n                          <span className=\"font-bold\">{group.category}</span>\n                        </button>\n                      </td>\n\n                      {METRICS.map((m) => {\n                        const val = getMetricValue(categoryItems, m.key);\n                        return (\n                          <td\n                            key={`${group.category}::group::${m.key}`}\n                            className={cn(TABLE_STYLES.group.cell, TABLE_STYLES.body.cellCenter, 'tabular-nums')}\n                          >\n                            {formatMetricValue(val, m.key)}\n                          </td>\n                        );\n                      })}\n                    </tr>\n\n                    {!isCollapsed &&\n                      group.products.map((p, productIndex) => {\n                        const rowAlt = (groupIndex + productIndex) % 2 === 1;\n                        return (\n                          <tr\n                            key={`${group.category}::${p.product}`}\n                            className={cn(TABLE_STYLES.body.row, rowAlt && TABLE_STYLES.body.rowAlternate)}\n                          >\n                            <td\n                              className={cn(\n                                TABLE_STYLES.body.cell,\n                                TABLE_STYLES.body.cellSticky,\n                                TABLE_STYLES.body.cellBold\n                              )}\n                            >\n                              {p.product}\n                            </td>\n                            {METRICS.map((m) => {\n                              const val = getMetricValue(p.items, m.key);\n                              return (\n                                <td\n                                  key={`${group.category}::${p.product}::${m.key}`}\n                                  className={cn(TABLE_STYLES.body.cell, TABLE_STYLES.body.cellCenter, 'tabular-nums')}\n                                >\n                                  {formatMetricValue(val, m.key)}\n                                </td>\n                              );\n                            })}\n                          </tr>\n                        );\n                      })}\n                  </React.Fragment>\n                );\n              })\n            )}\n\n            {/* Totals footer row */}\n            {grouped.length > 0 && (\n              <tr className={TABLE_STYLES.footer.row}>\n                <td className={cn(TABLE_STYLES.footer.cell, TABLE_STYLES.footer.cellSticky)}>\n                  <span className={TABLE_STYLES.footer.label}>TOTALS</span>\n                </td>\n                {METRICS.map((m) => (\n                  <td key={`totals::${m.key}`} className={cn(TABLE_STYLES.footer.cell, TABLE_STYLES.footer.cellCenter)}>\n                    {formatMetricValue(totals.get(m.key) || 0, m.key)}\n                  </td>\n                ))}\n              </tr>\n            )}\n          </tbody>\n        </table>\n      </div>\n    </ModernTableWrapper>\n  );\n};\n","import { useMemo } from 'react';\nimport { SalesData } from '@/types/dashboard';\nimport { formatCurrency, formatNumber, formatPercentage } from '@/utils/formatters';\nimport { parseDate as robustParseDate } from '@/utils/dateUtils';\nimport { useGlobalFilters } from '@/contexts/GlobalFiltersContext';\n\nexport interface SalesMetric {\n  title: string;\n  value: string;\n  rawValue: number;\n  change: number;\n  changeDetails: {\n    rate: number;\n    isSignificant: boolean;\n    trend: 'strong' | 'moderate' | 'weak';\n  };\n  icon: string;\n  color: string;\n  description: string;\n  previousValue: string;\n  previousRawValue: number;\n  comparison: {\n    current: number;\n    previous: number;\n    difference: number;\n  };\n  periodLabel?: string; // e.g., \"Sep 2025 vs Aug 2025\"\n  // Year-on-year comparison\n  yoyChange?: number;\n  yoyChangeDetails?: {\n    rate: number;\n    isSignificant: boolean;\n    trend: 'strong' | 'moderate' | 'weak';\n  };\n  yoyPreviousValue?: string;\n  yoyPreviousRawValue?: number;\n  yoyPeriodLabel?: string; // e.g., \"Sep 2025 vs Sep 2024\"\n}\n\ntype UseSalesMetricsOptions = {\n  /**\n   * Comparison mode. 'previousPeriod' compares the selected date range to the immediately preceding\n   * same-length range. Fallback to data-derived ranges if filters are absent.\n   */\n  compareMode?: 'previousMonth' | 'previousPeriod';\n  /** Optional explicit date range to define the current period. If omitted, derives from currentData. */\n  dateRange?: { start: string | Date; end: string | Date };\n};\n\nexport const useSalesMetrics = (\n  currentData: SalesData[],\n  historicalData?: SalesData[],\n  options: UseSalesMetricsOptions = { compareMode: 'previousMonth' }\n) => {\n  const { filters } = useGlobalFilters();\n  \n  const metrics = useMemo(() => {\n    const compareMode: 'previousMonth' | 'previousPeriod' = options?.compareMode ?? 'previousMonth';\n    if (!currentData || currentData.length === 0) {\n      return [];\n    }\n\n    // Helper: robustly parse a payment date (handles DD/MM/YYYY and more)\n    const parseDate = (d: any): Date | null => robustParseDate(typeof d === 'string' ? d : String(d));\n\n    // Determine comparison ranges\n  // Base dataset for both current and previous months: should not be limited by the current date filter,\n  // only by the location context. Caller passes location-only historical data when possible.\n  const base = historicalData && historicalData.length ? historicalData : currentData;\n\n    const getFirstAndLast = (arr: SalesData[]) => {\n      const dates = arr\n        .map(it => parseDate((it as any).paymentDate))\n        .filter((d): d is Date => !!d)\n        .sort((a,b) => a.getTime() - b.getTime());\n      return { first: dates[0], last: dates[dates.length - 1] };\n    };\n\n    // Prefer explicit dateRange; otherwise infer anchor date from base data\n    let explicitStart: Date | null = null;\n    let explicitEnd: Date | null = null;\n    if (options?.dateRange?.start && options?.dateRange?.end) {\n      explicitStart = new Date(options.dateRange.start);\n      explicitEnd = new Date(options.dateRange.end);\n      explicitEnd.setHours(23,59,59,999);\n    } else if (filters?.dateRange?.start && filters?.dateRange?.end) {\n      explicitStart = new Date(filters.dateRange.start);\n      explicitEnd = new Date(filters.dateRange.end);\n      explicitEnd.setHours(23,59,59,999);\n    }\n\n    // Anchor: for 'previousMonth' we use the selected period's end date month if provided; otherwise today.\n    // For 'previousPeriod' we fall back to explicitEnd or data-derived last date.\n    const anchorDate = compareMode === 'previousMonth'\n      ? (explicitEnd || new Date())\n      : (explicitEnd || getFirstAndLast(base).last || new Date());\n\n    const monthStart = (d: Date) => new Date(d.getFullYear(), d.getMonth(), 1);\n    const monthEnd = (d: Date) => new Date(d.getFullYear(), d.getMonth() + 1, 0, 23, 59, 59, 999);\n\n    let currentStart: Date;\n    let currentEnd: Date;\n    let prevStart: Date;\n    let prevEnd: Date;\n\n    let currentPeriodLabel: string | undefined;\n    let previousPeriodLabel: string | undefined;\n\n  if (compareMode === 'previousMonth') {\n      currentStart = monthStart(anchorDate);\n      currentEnd = monthEnd(anchorDate);\n      const prevAnchor = new Date(currentStart.getFullYear(), currentStart.getMonth() - 1, 15);\n      prevStart = monthStart(prevAnchor);\n      prevEnd = monthEnd(prevAnchor);\n      const fmt = (d: Date) => d.toLocaleDateString(undefined, { month: 'short', year: 'numeric' });\n      currentPeriodLabel = fmt(currentStart);\n      previousPeriodLabel = fmt(prevStart);\n    } else {\n      // previousPeriod: same-length window\n      // If explicit range given, respect it; else infer from base data\n      const inferred = getFirstAndLast(currentData);\n      const rangeStart = explicitStart || inferred.first || anchorDate;\n      const rangeEnd = explicitEnd || inferred.last || anchorDate;\n      currentStart = rangeStart;\n      currentEnd = rangeEnd;\n      const periodMs = Math.max(1, currentEnd.getTime() - currentStart.getTime() + 1);\n      prevEnd = new Date(currentStart.getTime() - 1);\n      prevStart = new Date(prevEnd.getTime() - periodMs + 1);\n    }\n\n    // Build datasets from base (prefer historicalData) so both months are computed consistently\n    // Base records for MoM analysis\n    const currentPeriodData = base.filter((it) => {\n      const d = parseDate((it as any).paymentDate);\n      return d && d >= currentStart && d <= currentEnd;\n    });\n\n    const previousPeriodData = base.filter((it) => {\n      const d = parseDate((it as any).paymentDate);\n      return d && d >= prevStart && d <= prevEnd;\n    });\n\n  // Sales metrics comparison analysis\n\n    // Helper to coerce numeric fields (handles numeric strings)\n    const num = (v: any): number => {\n      if (typeof v === 'number') return isFinite(v) ? v : 0;\n      if (typeof v === 'string') {\n        const n = parseFloat(v.replace(/[,\\s]/g, ''));\n        return isNaN(n) ? 0 : n;\n      }\n      return 0;\n    };\n    // Calculate current period metrics - using NET revenue (paymentValue - VAT)\n    // Revenue Definitions:\n    // - paymentValue = Net revenue after discount, before VAT\n    // - paymentValue - VAT = Net revenue after discount and VAT\n    // - paymentValue + discountAmount = Gross revenue before discount\n    const currentRevenue = currentPeriodData.reduce((sum, item) => {\n      const payment = num((item as any).paymentValue);\n      const vat = num((item as any).paymentVAT) || num((item as any).vat);\n      return sum + (payment - vat);\n    }, 0);\n    const currentDiscount = currentPeriodData.reduce((sum, item) => sum + num((item as any).discountAmount), 0);\n    const currentVAT = currentPeriodData.reduce((sum, item) => sum + (num((item as any).paymentVAT) || num((item as any).vat)), 0);\n    const currentTransactions = new Set(currentPeriodData.map(item => (item as any).paymentTransactionId || (item as any).paymentTransactionID).filter(Boolean)).size;\n    const currentMembers = new Set(currentPeriodData.map(item => item.memberId || item.customerEmail).filter(Boolean)).size;\n    const currentUnits = new Set(currentPeriodData.map(item => (item as any).saleItemId || (item as any).saleItemID).filter(Boolean)).size;\n    const currentATV = currentTransactions > 0 ? currentRevenue / currentTransactions : 0;\n    const currentASV = currentMembers > 0 ? currentRevenue / currentMembers : 0;\n    // Calculate discount percentage correctly: Total Discounts / (Total Revenue + Total Discounts) * 100\n    const currentGrossRevenue = currentPeriodData.reduce((sum, item) => sum + num((item as any).paymentValue), 0);\n    const currentDiscountPercentage = (currentGrossRevenue + currentDiscount) > 0 ? \n      (currentDiscount / (currentGrossRevenue + currentDiscount)) * 100 : 0;\n\n    // Calculate comparison period metrics (true previous period) - using NET revenue (paymentValue - VAT)\n  const prevRevenue = previousPeriodData.reduce((sum, item) => {\n      const payment = num((item as any).paymentValue);\n      const vat = num((item as any).paymentVAT) || num((item as any).vat);\n      return sum + (payment - vat);\n    }, 0);\n  const prevDiscount = previousPeriodData.reduce((sum, item) => sum + num((item as any).discountAmount), 0);\n  const prevVAT = previousPeriodData.reduce((sum, item) => sum + (num((item as any).paymentVAT) || num((item as any).vat)), 0);\n    const prevTransactions = new Set(previousPeriodData.map(item => (item as any).paymentTransactionId || (item as any).paymentTransactionID).filter(Boolean)).size;\n    const prevMembers = new Set(previousPeriodData.map(item => item.memberId || item.customerEmail).filter(Boolean)).size;\n    const prevUnits = new Set(previousPeriodData.map(item => (item as any).saleItemId || (item as any).saleItemID).filter(Boolean)).size;\n    const prevATV = prevTransactions > 0 ? prevRevenue / prevTransactions : 0;\n    const prevASV = prevMembers > 0 ? prevRevenue / prevMembers : 0;\n    // Calculate previous period discount percentage correctly\n    const prevGrossRevenue = previousPeriodData.reduce((sum, item) => sum + num((item as any).paymentValue), 0);\n    const prevDiscountPercentage = (prevGrossRevenue + prevDiscount) > 0 ? \n      (prevDiscount / (prevGrossRevenue + prevDiscount)) * 100 : 0;\n\n    // Debug logs removed for production performance\n\n    // Calculate growth rates\n    const calculateGrowth = (current: number, previous: number): { rate: number; isSignificant: boolean; trend: 'strong' | 'moderate' | 'weak' } => {\n      if (previous === 0) return { rate: current > 0 ? 100 : 0, isSignificant: current > 0, trend: current > 0 ? 'moderate' : 'weak' };\n      const rate = ((current - previous) / previous) * 100;\n      const isSignificant = Math.abs(rate) >= 5;\n      \n      // Trend should consider direction of change\n      let trend: 'strong' | 'moderate' | 'weak';\n      if (rate > 0) {\n        // Positive growth\n        trend = rate >= 20 ? 'strong' : rate >= 10 ? 'moderate' : 'weak';\n      } else {\n        // Negative growth (decline) - should always be weak or moderate at best\n        trend = rate <= -20 ? 'weak' : rate <= -10 ? 'moderate' : 'weak';\n      }\n      \n      return { rate, isSignificant, trend };\n    };\n\n    // YEAR-ON-YEAR COMPARISON: Calculate same period last year\n    const yoyStart = new Date(currentStart.getFullYear() - 1, currentStart.getMonth(), currentStart.getDate());\n    const yoyEnd = new Date(currentEnd.getFullYear() - 1, currentEnd.getMonth(), currentEnd.getDate());\n    yoyEnd.setHours(23, 59, 59, 999);\n\n    const yoyPeriodData = base.filter((it) => {\n      const d = parseDate((it as any).paymentDate);\n      return d && d >= yoyStart && d <= yoyEnd;\n    });\n\n    // Calculate year-on-year metrics\n    const yoyRevenue = yoyPeriodData.reduce((sum, item) => {\n      const payment = num((item as any).paymentValue);\n      const vat = num((item as any).paymentVAT) || num((item as any).vat);\n      return sum + (payment - vat);\n    }, 0);\n    const yoyDiscount = yoyPeriodData.reduce((sum, item) => sum + num((item as any).discountAmount), 0);\n    const yoyVAT = yoyPeriodData.reduce((sum, item) => sum + (num((item as any).paymentVAT) || num((item as any).vat)), 0);\n    const yoyTransactions = new Set(yoyPeriodData.map(item => (item as any).paymentTransactionId || (item as any).paymentTransactionID).filter(Boolean)).size;\n    const yoyMembers = new Set(yoyPeriodData.map(item => item.memberId || item.customerEmail).filter(Boolean)).size;\n    const yoyUnits = new Set(yoyPeriodData.map(item => (item as any).saleItemId || (item as any).saleItemID).filter(Boolean)).size;\n    const yoyATV = yoyTransactions > 0 ? yoyRevenue / yoyTransactions : 0;\n    const yoyASV = yoyMembers > 0 ? yoyRevenue / yoyMembers : 0;\n    const yoyGrossRevenue = yoyPeriodData.reduce((sum, item) => sum + num((item as any).paymentValue), 0);\n    const yoyDiscountPercentage = (yoyGrossRevenue + yoyDiscount) > 0 ? \n      (yoyDiscount / (yoyGrossRevenue + yoyDiscount)) * 100 : 0;\n\n    const fmt = (d: Date) => d.toLocaleDateString(undefined, { month: 'short', year: 'numeric' });\n    const yoyPeriodLabel = `${fmt(currentStart)} vs ${fmt(yoyStart)}`;\n\n    const revenueGrowth = calculateGrowth(currentRevenue, prevRevenue);\n    const transactionGrowth = calculateGrowth(currentTransactions, prevTransactions);\n    const memberGrowth = calculateGrowth(currentMembers, prevMembers);\n    const unitsGrowth = calculateGrowth(currentUnits, prevUnits);\n    const atvGrowth = calculateGrowth(currentATV, prevATV);\n    const asvGrowth = calculateGrowth(currentASV, prevASV);\n    const discountGrowth = calculateGrowth(currentDiscount, prevDiscount);\n    const discountPercentageGrowth = calculateGrowth(currentDiscountPercentage, prevDiscountPercentage);\n    const vatGrowth = calculateGrowth(currentVAT, prevVAT);\n\n    // Year-on-year growth rates\n    const yoyRevenueGrowth = calculateGrowth(currentRevenue, yoyRevenue);\n    const yoyTransactionGrowth = calculateGrowth(currentTransactions, yoyTransactions);\n    const yoyMemberGrowth = calculateGrowth(currentMembers, yoyMembers);\n    const yoyUnitsGrowth = calculateGrowth(currentUnits, yoyUnits);\n    const yoyAtvGrowth = calculateGrowth(currentATV, yoyATV);\n    const yoyAsvGrowth = calculateGrowth(currentASV, yoyASV);\n    const yoyDiscountGrowth = calculateGrowth(currentDiscount, yoyDiscount);\n    const yoyDiscountPercentageGrowth = calculateGrowth(currentDiscountPercentage, yoyDiscountPercentage);\n    const yoyVatGrowth = calculateGrowth(currentVAT, yoyVAT);\n\n    const calculatedMetrics: SalesMetric[] = [\n      {\n        title: \"Sales Revenue\",\n        value: formatCurrency(currentRevenue),\n        rawValue: currentRevenue,\n        change: revenueGrowth.rate,\n        changeDetails: revenueGrowth,\n        icon: \"DollarSign\",\n        color: \"blue\",\n        description: \"Total sales revenue across all transactions\",\n        previousValue: formatCurrency(prevRevenue),\n        previousRawValue: prevRevenue,\n        comparison: {\n          current: currentRevenue,\n          previous: prevRevenue,\n          difference: currentRevenue - prevRevenue\n        },\n        periodLabel: currentPeriodLabel && previousPeriodLabel ? `${currentPeriodLabel} vs ${previousPeriodLabel}` : undefined,\n        yoyChange: yoyRevenueGrowth.rate,\n        yoyChangeDetails: yoyRevenueGrowth,\n        yoyPreviousValue: formatCurrency(yoyRevenue),\n        yoyPreviousRawValue: yoyRevenue,\n        yoyPeriodLabel\n      },\n      {\n        title: \"Units Sold\",\n        value: formatNumber(currentUnits),\n        rawValue: currentUnits,\n        change: unitsGrowth.rate,\n        changeDetails: unitsGrowth,\n        icon: \"ShoppingCart\",\n        color: \"green\",\n        description: \"Total number of units/items sold\",\n        previousValue: formatNumber(prevUnits),\n        previousRawValue: prevUnits,\n        comparison: {\n          current: currentUnits,\n          previous: prevUnits,\n          difference: currentUnits - prevUnits\n        },\n        periodLabel: currentPeriodLabel && previousPeriodLabel ? `${currentPeriodLabel} vs ${previousPeriodLabel}` : undefined,\n        yoyChange: yoyUnitsGrowth.rate,\n        yoyChangeDetails: yoyUnitsGrowth,\n        yoyPreviousValue: formatNumber(yoyUnits),\n        yoyPreviousRawValue: yoyUnits,\n        yoyPeriodLabel\n      },\n      {\n        title: \"Transactions\",\n        value: formatNumber(currentTransactions),\n        rawValue: currentTransactions,\n        change: transactionGrowth.rate,\n        changeDetails: transactionGrowth,\n        icon: \"Activity\",\n        color: \"purple\",\n        description: \"Number of completed transactions\",\n        previousValue: formatNumber(prevTransactions),\n        previousRawValue: prevTransactions,\n        comparison: {\n          current: currentTransactions,\n          previous: prevTransactions,\n          difference: currentTransactions - prevTransactions\n        },\n        periodLabel: currentPeriodLabel && previousPeriodLabel ? `${currentPeriodLabel} vs ${previousPeriodLabel}` : undefined,\n        yoyChange: yoyTransactionGrowth.rate,\n        yoyChangeDetails: yoyTransactionGrowth,\n        yoyPreviousValue: formatNumber(yoyTransactions),\n        yoyPreviousRawValue: yoyTransactions,\n        yoyPeriodLabel\n      },\n      {\n        title: \"Unique Members\",\n        value: formatNumber(currentMembers),\n        rawValue: currentMembers,\n        change: memberGrowth.rate,\n        changeDetails: memberGrowth,\n        icon: \"Users\",\n        color: \"orange\",\n        description: \"Individual customers who made purchases\",\n        previousValue: formatNumber(prevMembers),\n        previousRawValue: prevMembers,\n        comparison: {\n          current: currentMembers,\n          previous: prevMembers,\n          difference: currentMembers - prevMembers\n        },\n        periodLabel: currentPeriodLabel && previousPeriodLabel ? `${currentPeriodLabel} vs ${previousPeriodLabel}` : undefined,\n        yoyChange: yoyMemberGrowth.rate,\n        yoyChangeDetails: yoyMemberGrowth,\n        yoyPreviousValue: formatNumber(yoyMembers),\n        yoyPreviousRawValue: yoyMembers,\n        yoyPeriodLabel\n      },\n      {\n        title: \"Avg Transaction Value\",\n        value: formatCurrency(currentATV),\n        rawValue: currentATV,\n        change: atvGrowth.rate,\n        changeDetails: atvGrowth,\n        icon: \"Target\",\n        color: \"cyan\",\n        description: \"Average value per transaction\",\n        previousValue: formatCurrency(prevATV),\n        previousRawValue: prevATV,\n        comparison: {\n          current: currentATV,\n          previous: prevATV,\n          difference: currentATV - prevATV\n        },\n        periodLabel: currentPeriodLabel && previousPeriodLabel ? `${currentPeriodLabel} vs ${previousPeriodLabel}` : undefined,\n        yoyChange: yoyAtvGrowth.rate,\n        yoyChangeDetails: yoyAtvGrowth,\n        yoyPreviousValue: formatCurrency(yoyATV),\n        yoyPreviousRawValue: yoyATV,\n        yoyPeriodLabel\n      },\n      {\n        title: \"Avg Spend per Member\",\n        value: formatCurrency(currentASV),\n        rawValue: currentASV,\n        change: asvGrowth.rate,\n        changeDetails: asvGrowth,\n        icon: \"Calendar\",\n        color: \"pink\",\n        description: \"Average spending per unique customer\",\n        previousValue: formatCurrency(prevASV),\n        previousRawValue: prevASV,\n        comparison: {\n          current: currentASV,\n          previous: prevASV,\n          difference: currentASV - prevASV\n        },\n        periodLabel: currentPeriodLabel && previousPeriodLabel ? `${currentPeriodLabel} vs ${previousPeriodLabel}` : undefined,\n        yoyChange: yoyAsvGrowth.rate,\n        yoyChangeDetails: yoyAsvGrowth,\n        yoyPreviousValue: formatCurrency(yoyASV),\n        yoyPreviousRawValue: yoyASV,\n        yoyPeriodLabel\n      },\n      {\n        title: \"Discount Value\",\n        value: formatCurrency(currentDiscount),\n        rawValue: currentDiscount,\n        change: discountGrowth.rate,\n        changeDetails: discountGrowth,\n        icon: \"CreditCard\",\n        color: \"red\",\n        description: \"Total discount amount applied\",\n        previousValue: formatCurrency(prevDiscount),\n        previousRawValue: prevDiscount,\n        comparison: {\n          current: currentDiscount,\n          previous: prevDiscount,\n          difference: currentDiscount - prevDiscount\n        },\n        periodLabel: currentPeriodLabel && previousPeriodLabel ? `${currentPeriodLabel} vs ${previousPeriodLabel}` : undefined,\n        yoyChange: yoyDiscountGrowth.rate,\n        yoyChangeDetails: yoyDiscountGrowth,\n        yoyPreviousValue: formatCurrency(yoyDiscount),\n        yoyPreviousRawValue: yoyDiscount,\n        yoyPeriodLabel\n      },\n      {\n        title: \"Discount Percentage\",\n        value: formatPercentage(currentDiscountPercentage),\n        rawValue: currentDiscountPercentage,\n        change: discountPercentageGrowth.rate,\n        changeDetails: discountPercentageGrowth,\n        icon: \"ArrowDownRight\",\n        color: \"amber\",\n        description: \"Average discount rate applied\",\n        previousValue: formatPercentage(prevDiscountPercentage),\n        previousRawValue: prevDiscountPercentage,\n        comparison: {\n          current: currentDiscountPercentage,\n          previous: prevDiscountPercentage,\n          difference: currentDiscountPercentage - prevDiscountPercentage\n        },\n        periodLabel: currentPeriodLabel && previousPeriodLabel ? `${currentPeriodLabel} vs ${previousPeriodLabel}` : undefined,\n        yoyChange: yoyDiscountPercentageGrowth.rate,\n        yoyChangeDetails: yoyDiscountPercentageGrowth,\n        yoyPreviousValue: formatPercentage(yoyDiscountPercentage),\n        yoyPreviousRawValue: yoyDiscountPercentage,\n        yoyPeriodLabel\n      },\n      {\n        title: \"VAT Amount\",\n        value: formatCurrency(currentVAT),\n        rawValue: currentVAT,\n        change: vatGrowth.rate,\n        changeDetails: vatGrowth,\n        icon: \"Receipt\",\n        color: \"green\",\n        description: \"Total VAT collected from sales\",\n        previousValue: formatCurrency(prevVAT),\n        previousRawValue: prevVAT,\n        comparison: {\n          current: currentVAT,\n          previous: prevVAT,\n          difference: currentVAT - prevVAT\n        },\n        periodLabel: currentPeriodLabel && previousPeriodLabel ? `${currentPeriodLabel} vs ${previousPeriodLabel}` : undefined,\n        yoyChange: yoyVatGrowth.rate,\n        yoyChangeDetails: yoyVatGrowth,\n        yoyPreviousValue: formatCurrency(yoyVAT),\n        yoyPreviousRawValue: yoyVAT,\n        yoyPeriodLabel\n      }\n    ];\n\n    // Final sales metrics calculated\n\n    return calculatedMetrics;\n  }, [currentData, historicalData, options?.dateRange?.start, options?.dateRange?.end, filters?.dateRange?.start, filters?.dateRange?.end, options?.compareMode]);\n\n  return { metrics };\n};","// Performance utility functions for optimization\nimport React from 'react';\n\nexport const debounce = <T extends (...args: any[]) => any>(\n  func: T,\n  wait: number\n): ((...args: Parameters<T>) => void) => {\n  let timeout: NodeJS.Timeout;\n  return (...args: Parameters<T>) => {\n    clearTimeout(timeout);\n    timeout = setTimeout(() => func(...args), wait);\n  };\n};\n\nexport const throttle = <T extends (...args: any[]) => any>(\n  func: T,\n  limit: number\n): ((...args: Parameters<T>) => void) => {\n  let inThrottle: boolean;\n  return (...args: Parameters<T>) => {\n    if (!inThrottle) {\n      func(...args);\n      inThrottle = true;\n      setTimeout(() => (inThrottle = false), limit);\n    }\n  };\n};\n\nexport const memoize = <T extends (...args: any[]) => any>(fn: T): T => {\n  const cache = new Map();\n  return ((...args: Parameters<T>) => {\n    const key = JSON.stringify(args);\n    if (cache.has(key)) {\n      return cache.get(key);\n    }\n    const result = fn(...args);\n    cache.set(key, result);\n    return result;\n  }) as T;\n};\n\n/**\n * Shallow comparison for objects - useful for React.memo comparisons\n */\nexport const shallowEqual = (obj1: any, obj2: any): boolean => {\n  if (obj1 === obj2) return true;\n  \n  if (typeof obj1 !== 'object' || typeof obj2 !== 'object' || obj1 === null || obj2 === null) {\n    return false;\n  }\n  \n  const keys1 = Object.keys(obj1);\n  const keys2 = Object.keys(obj2);\n  \n  if (keys1.length !== keys2.length) return false;\n  \n  for (const key of keys1) {\n    if (obj1[key] !== obj2[key]) return false;\n  }\n  \n  return true;\n};\n\n/**\n * Deep comparison for nested objects and arrays\n */\nexport const deepEqual = (obj1: any, obj2: any): boolean => {\n  if (obj1 === obj2) return true;\n  \n  if (typeof obj1 !== 'object' || typeof obj2 !== 'object' || obj1 === null || obj2 === null) {\n    return false;\n  }\n  \n  if (Array.isArray(obj1) && Array.isArray(obj2)) {\n    if (obj1.length !== obj2.length) return false;\n    return obj1.every((item, index) => deepEqual(item, obj2[index]));\n  }\n  \n  const keys1 = Object.keys(obj1);\n  const keys2 = Object.keys(obj2);\n  \n  if (keys1.length !== keys2.length) return false;\n  \n  for (const key of keys1) {\n    if (!deepEqual(obj1[key], obj2[key])) return false;\n  }\n  \n  return true;\n};\n\n/**\n * Intersection Observer hook for lazy rendering\n */\nexport const useIntersectionObserver = (\n  ref: React.RefObject<Element>,\n  options: IntersectionObserverInit = {}\n): boolean => {\n  const [isIntersecting, setIsIntersecting] = React.useState(false);\n  \n  React.useEffect(() => {\n    if (!ref.current) return;\n    \n    const observer = new IntersectionObserver(\n      ([entry]) => setIsIntersecting(entry.isIntersecting),\n      { threshold: 0.1, ...options }\n    );\n    \n    observer.observe(ref.current);\n    \n    return () => observer.disconnect();\n  }, [ref, options]);\n  \n  return isIntersecting;\n};\n\nexport const lazyLoadImages = () => {\n  if ('IntersectionObserver' in window) {\n    const imageObserver = new IntersectionObserver((entries, observer) => {\n      entries.forEach(entry => {\n        if (entry.isIntersecting) {\n          const img = entry.target as HTMLImageElement;\n          if (img.dataset.src) {\n            img.src = img.dataset.src;\n            img.classList.remove('lazy');\n            observer.unobserve(img);\n          }\n        }\n      });\n    });\n\n    document.querySelectorAll('img[data-src]').forEach(img => {\n      imageObserver.observe(img);\n    });\n  }\n};\n\nexport const preloadRoute = (routePath: string) => {\n  const link = document.createElement('link');\n  link.rel = 'prefetch';\n  link.href = routePath;\n  document.head.appendChild(link);\n};\n\nexport const batchDOMUpdates = (updates: (() => void)[]) => {\n  requestAnimationFrame(() => {\n    updates.forEach(update => update());\n  });\n};\n\nexport const measurePerformance = (name: string, fn: () => void) => {\n  fn();\n};","import React from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { TrendingUp, TrendingDown, DollarSign, ShoppingCart, CreditCard, Target, Users, Calendar, ArrowDownRight, Activity, ArrowUpRight, Minus } from 'lucide-react';\nimport { SalesData } from '@/types/dashboard';\nimport { formatCurrency } from '@/utils/formatters';\nimport { cn } from '@/lib/utils';\nimport { useSalesMetrics } from '@/hooks/useSalesMetrics';\nimport { shallowEqual } from '@/utils/performanceUtils';\n\ninterface SalesAnimatedMetricCardsProps {\n  data: SalesData[];\n  historicalData?: SalesData[];\n  dateRange?: { start: string | Date; end: string | Date };\n  onMetricClick?: (metricData: any) => void;\n  locationId?: string;\n}\n\nconst iconMap = {\n  DollarSign,\n  ShoppingCart,\n  CreditCard,\n  Target,\n  Users,\n  Calendar,\n  ArrowDownRight,\n  Activity,\n};\n\nexport const SalesAnimatedMetricCardsComponent: React.FC<SalesAnimatedMetricCardsProps> = ({ \n  data,\n  historicalData,\n  dateRange,\n  onMetricClick,\n  locationId\n}) => {\n  const { metrics } = useSalesMetrics(data, historicalData, { dateRange });\n\n  // Take the first 8 metrics for the cards (was 4, now 8)\n  const displayMetrics = metrics.slice(0, 8);\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n      {displayMetrics.map((metric, index) => {\n        const IconComponent = iconMap[metric.icon as keyof typeof iconMap] || DollarSign;\n        const isPositive = metric.change > 0;\n        const isNegative = metric.change < 0;\n\n        return (\n          <Card\n            key={metric.title}\n            className={cn(\n              \"group relative overflow-hidden cursor-pointer transition-all duration-500\",\n              \"bg-white hover:bg-gradient-to-br hover:from-slate-900 hover:via-slate-900 hover:to-slate-950\",\n              \"border border-slate-200 hover:border-slate-800 border-t-4\",\n              \"shadow-md hover:shadow-2xl hover:shadow-slate-950/60\",\n              \"hover:-translate-y-1 hover:scale-[1.01]\",\n              index % 4 === 0 && \"border-t-emerald-500\",\n              index % 4 === 1 && \"border-t-blue-500\",\n              index % 4 === 2 && \"border-t-purple-500\",\n              index % 4 === 3 && \"border-t-rose-500\",\n              onMetricClick && \"hover:cursor-pointer\"\n            )}\n            onClick={() => onMetricClick?.({\n              ...metric,\n              metricType: metric.title.toLowerCase().replace(/\\s+/g, '-'),\n              specificData: metric,\n              drillDownType: 'metric'\n            })}\n          >\n            <CardContent className=\"p-5 relative\">\n              {/* Decorative gradient overlay */}\n              <div className={cn(\n                \"absolute inset-0 opacity-[0.03] group-hover:opacity-[0.08] transition-all duration-500\",\n                index % 4 === 0 && \"bg-gradient-to-br from-emerald-500 to-teal-500\",\n                index % 4 === 1 && \"bg-gradient-to-br from-blue-500 to-cyan-500\",\n                index % 4 === 2 && \"bg-gradient-to-br from-purple-500 to-pink-500\",\n                index % 4 === 3 && \"bg-gradient-to-br from-rose-500 to-orange-500\"\n              )} />\n              \n              {/* Background Icon - Enhanced */}\n              <div className=\"absolute top-3 right-3 opacity-[0.08] group-hover:opacity-[0.15] transition-all duration-700 ease-out group-hover:scale-110 group-hover:rotate-6\">\n                <IconComponent className=\"w-20 h-20 text-slate-900 group-hover:text-white\" />\n              </div>\n              \n              {/* Background pattern */}\n              <div className=\"absolute inset-0 opacity-[0.02] group-hover:opacity-[0.04] transition-opacity duration-500\" \n                   style={{backgroundImage: 'radial-gradient(circle at 2px 2px, currentColor 1px, transparent 0)', backgroundSize: '24px 24px'}} />\n              \n              {/* Main Content */}\n              <div className=\"relative z-10 space-y-2.5\">\n                {/* Header Section - Icon and Title */}\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex items-center gap-2.5\">\n                    <div className={cn(\n                      \"p-2.5 rounded-xl shadow-sm transition-all duration-500 group-hover:scale-110 group-hover:shadow-md\",\n                      index % 4 === 0 && \"bg-gradient-to-br from-emerald-500/15 to-emerald-600/10 text-emerald-700 group-hover:from-emerald-500/25 group-hover:to-emerald-600/20 group-hover:text-emerald-400 group-hover:shadow-emerald-500/20\",\n                      index % 4 === 1 && \"bg-gradient-to-br from-blue-500/15 to-blue-600/10 text-blue-700 group-hover:from-blue-500/25 group-hover:to-blue-600/20 group-hover:text-blue-400 group-hover:shadow-blue-500/20\",\n                      index % 4 === 2 && \"bg-gradient-to-br from-purple-500/15 to-purple-600/10 text-purple-700 group-hover:from-purple-500/25 group-hover:to-purple-600/20 group-hover:text-purple-400 group-hover:shadow-purple-500/20\",\n                      index % 4 === 3 && \"bg-gradient-to-br from-rose-500/15 to-rose-600/10 text-rose-700 group-hover:from-rose-500/25 group-hover:to-rose-600/20 group-hover:text-rose-400 group-hover:shadow-rose-500/20\"\n                    )}>\n                      <IconComponent className=\"w-5 h-5\" />\n                    </div>\n                    <div>\n                      <h3 className={cn(\n                        \"font-bold text-sm text-slate-700 transition-all duration-500 leading-tight\",\n                        \"group-hover:text-white group-hover:underline group-hover:underline-offset-4 group-hover:decoration-2\",\n                        index % 4 === 0 && \"group-hover:decoration-emerald-400\",\n                        index % 4 === 1 && \"group-hover:decoration-blue-400\",\n                        index % 4 === 2 && \"group-hover:decoration-purple-400\",\n                        index % 4 === 3 && \"group-hover:decoration-rose-400\"\n                      )}>\n                        {metric.title}\n                      </h3>\n                      <p className=\"text-[9px] text-slate-500 group-hover:text-slate-400 transition-colors duration-500 mt-0.5 uppercase tracking-wide font-semibold\">\n                        Current Period\n                      </p>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Value with Background Card */}\n                <div className={cn(\n                  \"p-2.5 rounded-lg transition-all duration-500\",\n                  \"bg-slate-50 group-hover:bg-slate-800/30\",\n                  \"border border-slate-100 group-hover:border-slate-700/50\"\n                )}>\n                  <p className=\"text-3xl font-bold text-slate-900 group-hover:text-white transition-colors duration-500 tracking-tight\">\n                    {metric.value}\n                  </p>\n                  <div className=\"flex items-center gap-2 mt-1\">\n                    <div className={cn(\n                      \"h-0.5 flex-1 rounded-full transition-all duration-500\",\n                      metric.change > 0 && \"bg-emerald-200 group-hover:bg-emerald-500/40\",\n                      metric.change < 0 && \"bg-rose-200 group-hover:bg-rose-500/40\",\n                      metric.change === 0 && \"bg-slate-200 group-hover:bg-slate-500/40\"\n                    )} />\n                    <div className=\"flex items-center gap-1\">\n                      {metric.change > 0 && <ArrowUpRight className=\"w-3 h-3 text-emerald-600 group-hover:text-emerald-400\" />}\n                      {metric.change < 0 && <ArrowDownRight className=\"w-3 h-3 text-rose-600 group-hover:text-rose-400\" />}\n                      {metric.change === 0 && <Minus className=\"w-3 h-3 text-slate-600 group-hover:text-slate-400\" />}\n                      <span className={cn(\n                        \"text-[10px] font-bold transition-colors duration-500\",\n                        metric.change > 0 && \"text-emerald-600 group-hover:text-emerald-400\",\n                        metric.change < 0 && \"text-rose-600 group-hover:text-rose-400\",\n                        metric.change === 0 && \"text-slate-600 group-hover:text-slate-400\"\n                      )}>\n                        {metric.changeDetails.trend}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Comparison Metrics - Enhanced Cards */}\n                <div className=\"grid grid-cols-2 gap-2\">\n                  {/* MoM Card */}\n                  <div className={cn(\n                    \"p-2.5 rounded-lg border transition-all duration-500\",\n                    \"bg-white/50 group-hover:bg-slate-800/20\",\n                    \"border-slate-200 group-hover:border-slate-700/50\"\n                  )}>\n                    <div className=\"text-[9px] font-bold text-slate-500 group-hover:text-slate-400 uppercase tracking-wider mb-1 transition-colors duration-500\">\n                      Month over Month\n                    </div>\n                      <div className=\"flex items-baseline gap-1.5 mb-1.5\">\n                        <span className=\"text-sm font-bold text-slate-700 group-hover:text-white transition-colors duration-500 tabular-nums\">\n                          {metric.previousValue ?? '—'}\n                        </span>\n                      <span className=\"text-[8px] text-slate-400 group-hover:text-slate-500 transition-colors duration-500\">prev</span>\n                    </div>\n                      <div className={cn(\n                      \"inline-flex items-center justify-center gap-1 px-3 py-1.5 rounded-lg font-bold text-[11px] tabular-nums transition-all duration-500 min-w-[65px]\",\n                      metric.change > 0 && \"bg-emerald-900/90 text-white group-hover:bg-emerald-800 group-hover:shadow-lg group-hover:shadow-emerald-900/40\",\n                      metric.change < 0 && \"bg-rose-900/90 text-white group-hover:bg-rose-800 group-hover:shadow-lg group-hover:shadow-rose-900/40\",\n                      metric.change === 0 && \"bg-slate-700/90 text-white group-hover:bg-slate-600 group-hover:shadow-lg\"\n                    )}>\n                      {metric.change > 0 && <ArrowUpRight className=\"w-3.5 h-3.5 flex-shrink-0\" />}\n                      {metric.change < 0 && <ArrowDownRight className=\"w-3.5 h-3.5 flex-shrink-0\" />}\n                      {metric.change === 0 && <Minus className=\"w-3.5 h-3.5 flex-shrink-0\" />}\n                      <span>{typeof metric.change === 'number' ? (metric.change > 0 ? '+' : '') + Math.round(metric.change) + '%' : 'N/A'}</span>\n                    </div>\n                  </div>\n                  \n                  {/* YoY Card */}\n                  {metric.yoyPreviousValue != null ? (\n                    <div className={cn(\n                      \"p-2.5 rounded-lg border transition-all duration-500\",\n                      \"bg-white/50 group-hover:bg-slate-800/20\",\n                      \"border-slate-200 group-hover:border-slate-700/50\"\n                    )}>\n                      <div className=\"text-[9px] font-bold text-slate-500 group-hover:text-slate-400 uppercase tracking-wider mb-1 transition-colors duration-500\">\n                        Year over Year\n                      </div>\n                      <div className=\"flex items-baseline gap-1.5 mb-1.5\">\n                        <span className=\"text-sm font-bold text-slate-700 group-hover:text-white transition-colors duration-500 tabular-nums\">\n                          {metric.yoyPreviousValue ?? '—'}\n                        </span>\n                        <span className=\"text-[8px] text-slate-400 group-hover:text-slate-500 transition-colors duration-500\">prev</span>\n                      </div>\n                      {typeof metric.yoyChange === 'number' && (\n                        <div className={cn(\n                          \"inline-flex items-center justify-center gap-1 px-3 py-1.5 rounded-lg font-bold text-[11px] tabular-nums transition-all duration-500 min-w-[65px]\",\n                          metric.yoyChange > 0 && \"bg-emerald-900/90 text-white group-hover:bg-emerald-800 group-hover:shadow-lg group-hover:shadow-emerald-900/40\",\n                          metric.yoyChange < 0 && \"bg-rose-900/90 text-white group-hover:bg-rose-800 group-hover:shadow-lg group-hover:shadow-rose-900/40\",\n                          metric.yoyChange === 0 && \"bg-slate-700/90 text-white group-hover:bg-slate-600 group-hover:shadow-lg\"\n                        )}>\n                          {metric.yoyChange > 0 && <ArrowUpRight className=\"w-3.5 h-3.5 flex-shrink-0\" />}\n                          {metric.yoyChange < 0 && <ArrowDownRight className=\"w-3.5 h-3.5 flex-shrink-0\" />}\n                          {metric.yoyChange === 0 && <Minus className=\"w-3.5 h-3.5 flex-shrink-0\" />}\n                          <span>{typeof metric.yoyChange === 'number' ? (metric.yoyChange > 0 ? '+' : '') + Math.round(metric.yoyChange) + '%' : 'N/A'}</span>\n                        </div>\n                      )}\n                    </div>\n                  ) : (\n                    <div className={cn(\n                      \"p-2.5 rounded-lg border transition-all duration-500 flex items-center justify-center\",\n                      \"bg-slate-50/50 group-hover:bg-slate-800/10\",\n                      \"border-slate-200 group-hover:border-slate-700/30\"\n                    )}>\n                      <span className=\"text-[9px] text-slate-400 group-hover:text-slate-500 transition-colors duration-500 font-semibold\">\n                        No YoY Data\n                      </span>\n                    </div>\n                  )}\n                </div>\n\n                {/* Description Footer with Enhanced Side Border */}\n                <div className={cn(\n                  \"relative pt-1.5 border-l-3 pl-3 transition-all duration-500\",\n                  \"before:absolute before:left-0 before:top-0 before:w-1 before:h-full before:rounded-r-full before:transition-all before:duration-500\",\n                  index % 4 === 0 && \"border-l-emerald-500/50 group-hover:border-l-emerald-400 before:bg-emerald-500/20 group-hover:before:bg-emerald-400/30\",\n                  index % 4 === 1 && \"border-l-blue-500/50 group-hover:border-l-blue-400 before:bg-blue-500/20 group-hover:before:bg-blue-400/30\",\n                  index % 4 === 2 && \"border-l-purple-500/50 group-hover:border-l-purple-400 before:bg-purple-500/20 group-hover:before:bg-purple-400/30\",\n                  index % 4 === 3 && \"border-l-rose-500/50 group-hover:border-l-rose-400 before:bg-rose-500/20 group-hover:before:bg-rose-400/30\"\n                )}>\n                  <p className=\"text-xs text-slate-600 group-hover:text-slate-300 leading-snug transition-colors duration-500 line-clamp-2 font-medium\">\n                    {metric.description}\n                  </p>\n                </div>\n\n                {/* Additional Info - Hidden by default, shown on hover */}\n                <div className={cn(\n                  \"pt-2 space-y-2 border-t transition-all duration-500 overflow-hidden\",\n                  \"max-h-0 opacity-0 group-hover:max-h-40 group-hover:opacity-100\",\n                  index % 4 === 0 && \"border-emerald-200 group-hover:border-emerald-500/30\",\n                  index % 4 === 1 && \"border-blue-200 group-hover:border-blue-500/30\",\n                  index % 4 === 2 && \"border-purple-200 group-hover:border-purple-500/30\",\n                  index % 4 === 3 && \"border-rose-200 group-hover:border-rose-500/30\"\n                )}>\n                  {/* Trend Info */}\n                  <div className=\"text-xs space-y-1\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-slate-400 font-medium\">Trend:</span>\n                      <span className=\"text-white font-semibold\">{metric.changeDetails.trend}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-slate-400 font-medium\">Difference:</span>\n                      <span className=\"text-white font-semibold\">{formatCurrency(Math.abs(metric.comparison.difference))}</span>\n                    </div>\n                    {metric.yoyChangeDetails && (\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-slate-400 font-medium\">YoY Trend:</span>\n                        <span className=\"text-white font-semibold\">{metric.yoyChangeDetails.trend}</span>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        );\n      })}\n    </div>\n  );\n};\n\n// Memoized export with custom comparison function\nexport const SalesAnimatedMetricCards = React.memo(\n  SalesAnimatedMetricCardsComponent,\n  (prevProps, nextProps) => {\n    return (\n      prevProps.data === nextProps.data &&\n      shallowEqual(prevProps.historicalData, nextProps.historicalData) &&\n      shallowEqual(prevProps.dateRange, nextProps.dateRange) &&\n      prevProps.onMetricClick === nextProps.onMetricClick &&\n      prevProps.locationId === nextProps.locationId\n    );\n  }\n);\n\nexport default SalesAnimatedMetricCards;\n"],"names":["METRICS","STANDARD_METRICS","m","toDateRange","filters","start","end","d","withinRange","dateStr","parseDate","getPeriodLabel","base","now","num","v","n","getMetricValue","items","metric","totalRevenue","sum","item","payment","vat","transactionIds","totalTransactions","uniqueMembers","unitIds","totalUnits","totalDiscountAmount","totalVat","totalGrossRevenue","discountPercentage","dates","a","purchaseFrequency","formatMetricValue","value","formatCurrency","formatNumber","ProductCategoryMetricsTable","data","onReady","tableRef","useRef","collapsedCategories","setCollapsedCategories","useState","periodLabel","useMemo","periodData","r","grouped","byCategory","row","category","product","byProduct","blocks","products","b","aRev","p","totals","totalByMetric","totalProducts","g","toggleCategory","prev","next","collapseAll","expandAll","React","jsx","ModernTableWrapper","BarChart3","Badge","TABLE_STYLES","jsxs","cn","group","groupIndex","isCollapsed","categoryItems","ChevronRight","ChevronDown","val","productIndex","rowAlt","useSalesMetrics","currentData","historicalData","options","useGlobalFilters","compareMode","robustParseDate","getFirstAndLast","arr","it","explicitStart","explicitEnd","anchorDate","monthStart","monthEnd","currentStart","currentEnd","prevStart","prevEnd","currentPeriodLabel","previousPeriodLabel","prevAnchor","fmt","inferred","rangeStart","rangeEnd","periodMs","currentPeriodData","previousPeriodData","currentRevenue","currentDiscount","currentVAT","currentTransactions","currentMembers","currentUnits","currentATV","currentASV","currentGrossRevenue","currentDiscountPercentage","prevRevenue","prevDiscount","prevVAT","prevTransactions","prevMembers","prevUnits","prevATV","prevASV","prevGrossRevenue","prevDiscountPercentage","calculateGrowth","current","previous","rate","isSignificant","trend","yoyStart","yoyEnd","yoyPeriodData","yoyRevenue","yoyDiscount","yoyVAT","yoyTransactions","yoyMembers","yoyUnits","yoyATV","yoyASV","yoyGrossRevenue","yoyDiscountPercentage","yoyPeriodLabel","revenueGrowth","transactionGrowth","memberGrowth","unitsGrowth","atvGrowth","asvGrowth","discountGrowth","discountPercentageGrowth","vatGrowth","yoyRevenueGrowth","yoyTransactionGrowth","yoyMemberGrowth","yoyUnitsGrowth","yoyAtvGrowth","yoyAsvGrowth","yoyDiscountGrowth","yoyDiscountPercentageGrowth","yoyVatGrowth","formatPercentage","shallowEqual","obj1","obj2","keys1","keys2","key","iconMap","DollarSign","ShoppingCart","CreditCard","Target","Users","Calendar","ArrowDownRight","Activity","SalesAnimatedMetricCardsComponent","dateRange","onMetricClick","locationId","metrics","displayMetrics","index","IconComponent","Card","CardContent","ArrowUpRight","Minus","SalesAnimatedMetricCards","prevProps","nextProps"],"mappings":"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"}