{"version":3,"file":"FunnelLeads-CvL9SsNJ.js","sources":["../../node_modules/lucide-react/dist/esm/icons/heart-handshake.js","../../node_modules/lucide-react/dist/esm/icons/indian-rupee.js","../../node_modules/lucide-react/dist/esm/icons/zoom-in.js","../../src/components/dashboard/FunnelLeadsFilterSection.tsx","../../src/components/dashboard/FunnelMetricCards.tsx","../../src/components/dashboard/FunnelInteractiveCharts.tsx","../../src/components/dashboard/FunnelMonthOnMonthTable.tsx","../../src/components/dashboard/FunnelYearOnYearTable.tsx","../../src/components/dashboard/EnhancedFunnelRankings.tsx","../../src/components/dashboard/FunnelHealthMetricsTable.tsx","../../src/components/dashboard/FunnelAnalyticsTables.tsx","../../src/pages/FunnelLeads.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst HeartHandshake = createLucideIcon(\"HeartHandshake\", [\n  [\n    \"path\",\n    {\n      d: \"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z\",\n      key: \"c3ymky\"\n    }\n  ],\n  [\n    \"path\",\n    {\n      d: \"M12 5 9.04 7.96a2.17 2.17 0 0 0 0 3.08c.82.82 2.13.85 3 .07l2.07-1.9a2.82 2.82 0 0 1 3.79 0l2.96 2.66\",\n      key: \"4oyue0\"\n    }\n  ],\n  [\"path\", { d: \"m18 15-2-2\", key: \"60u0ii\" }],\n  [\"path\", { d: \"m15 18-2-2\", key: \"6p76be\" }]\n]);\n\nexport { HeartHandshake as default };\n//# sourceMappingURL=heart-handshake.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst IndianRupee = createLucideIcon(\"IndianRupee\", [\n  [\"path\", { d: \"M6 3h12\", key: \"ggurg9\" }],\n  [\"path\", { d: \"M6 8h12\", key: \"6g4wlu\" }],\n  [\"path\", { d: \"m6 13 8.5 8\", key: \"u1kupk\" }],\n  [\"path\", { d: \"M6 13h3\", key: \"wdp6ag\" }],\n  [\"path\", { d: \"M9 13c6.667 0 6.667-10 0-10\", key: \"1nkvk2\" }]\n]);\n\nexport { IndianRupee as default };\n//# sourceMappingURL=indian-rupee.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst ZoomIn = createLucideIcon(\"ZoomIn\", [\n  [\"circle\", { cx: \"11\", cy: \"11\", r: \"8\", key: \"4ej97u\" }],\n  [\"line\", { x1: \"21\", x2: \"16.65\", y1: \"21\", y2: \"16.65\", key: \"13gj7c\" }],\n  [\"line\", { x1: \"11\", x2: \"11\", y1: \"8\", y2: \"14\", key: \"1vmskp\" }],\n  [\"line\", { x1: \"8\", x2: \"14\", y1: \"11\", y2: \"11\", key: \"durymu\" }]\n]);\n\nexport { ZoomIn as default };\n//# sourceMappingURL=zoom-in.js.map\n","\nimport React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { \n  CalendarIcon, \n  Filter, \n  X, \n  MapPin,\n  Tag,\n  Users,\n  Building,\n  Activity,\n  Clock,\n  Target,\n  Phone,\n  UserCheck,\n  TrendingUp,\n  DollarSign\n} from 'lucide-react';\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select';\nimport { DatePickerWithRange } from '@/components/ui/date-picker';\nimport { Input } from '@/components/ui/input';\nimport { LeadsFilterOptions } from '@/types/leads';\nimport { getPreviousMonthDateRange } from '@/utils/dateUtils';\n\ninterface FunnelLeadsFilterSectionProps {\n  filters: LeadsFilterOptions;\n  onFiltersChange: (filters: LeadsFilterOptions) => void;\n  uniqueValues: {\n    locations: string[];\n    sources: string[];\n    stages: string[];\n    statuses: string[];\n    associates: string[];\n    channels: string[];\n    trialStatuses: string[];\n    conversionStatuses: string[];\n    retentionStatuses: string[];\n  };\n}\n\nexport const FunnelLeadsFilterSection: React.FC<FunnelLeadsFilterSectionProps> = ({\n  filters,\n  onFiltersChange,\n  uniqueValues\n}) => {\n  const handleArrayFilterChange = (filterKey: keyof LeadsFilterOptions, value: string) => {\n    const currentValues = [...(filters[filterKey] as string[])];\n    const newValues = currentValues.includes(value) \n      ? currentValues.filter(v => v !== value)\n      : [...currentValues, value];\n    \n    onFiltersChange({ \n      ...filters, \n      [filterKey]: newValues \n    });\n  };\n\n  const handleDateRangeChange = (range: { from?: Date; to?: Date }) => {\n    onFiltersChange({\n      ...filters,\n      dateRange: {\n        start: range.from ? range.from.toISOString() : '',\n        end: range.to ? range.to.toISOString() : ''\n      }\n    });\n  };\n\n  const getPreviousMonthRange = () => {\n    const now = new Date();\n    const firstDayPreviousMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\n    const lastDayPreviousMonth = new Date(now.getFullYear(), now.getMonth(), 0);\n    \n    const formatDate = (date: Date) => {\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const day = String(date.getDate()).padStart(2, '0');\n      return `${year}-${month}-${day}`;\n    };\n    \n    return {\n      start: formatDate(firstDayPreviousMonth),\n      end: formatDate(lastDayPreviousMonth)\n    };\n  };\n\n  const clearAllFilters = () => {\n    const now = new Date();\n    const firstDayPreviousMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\n    const lastDayPreviousMonth = new Date(now.getFullYear(), now.getMonth(), 0);\n    \n    const formatDate = (date: Date) => {\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const day = String(date.getDate()).padStart(2, '0');\n      return `${year}-${month}-${day}`;\n    };\n    \n    const previousMonth = {\n      start: formatDate(firstDayPreviousMonth),\n      end: formatDate(lastDayPreviousMonth)\n    };\n    \n    onFiltersChange({\n      dateRange: previousMonth,\n      location: [],\n      source: [],\n      stage: [],\n      status: [],\n      associate: [],\n      channel: [],\n      trialStatus: [],\n      conversionStatus: [],\n      retentionStatus: [],\n      minLTV: undefined,\n      maxLTV: undefined\n    });\n  };\n\n  const activeFilterCount = (filters.location?.length || 0) + \n    (filters.source?.length || 0) + \n    (filters.stage?.length || 0) + \n    (filters.status?.length || 0) + \n    (filters.associate?.length || 0) + \n    (filters.channel?.length || 0) + \n    (filters.trialStatus?.length || 0) + \n    (filters.conversionStatus?.length || 0) + \n    (filters.retentionStatus?.length || 0) + \n    (filters.minLTV ? 1 : 0) + \n    (filters.maxLTV ? 1 : 0);\n\n  const filterConfigs = [\n    {\n      key: 'location' as keyof LeadsFilterOptions,\n      label: 'Location',\n      icon: MapPin,\n      options: uniqueValues.locations,\n      values: filters.location\n    },\n    {\n      key: 'source' as keyof LeadsFilterOptions,\n      label: 'Source',\n      icon: Tag,\n      options: uniqueValues.sources,\n      values: filters.source\n    },\n    {\n      key: 'stage' as keyof LeadsFilterOptions,\n      label: 'Stage',\n      icon: Activity,\n      options: uniqueValues.stages,\n      values: filters.stage\n    },\n    {\n      key: 'status' as keyof LeadsFilterOptions,\n      label: 'Status',\n      icon: Clock,\n      options: uniqueValues.statuses,\n      values: filters.status\n    },\n    {\n      key: 'associate' as keyof LeadsFilterOptions,\n      label: 'Associate',\n      icon: Users,\n      options: uniqueValues.associates,\n      values: filters.associate\n    },\n    {\n      key: 'channel' as keyof LeadsFilterOptions,\n      label: 'Channel',\n      icon: Phone,\n      options: uniqueValues.channels,\n      values: filters.channel\n    },\n    {\n      key: 'trialStatus' as keyof LeadsFilterOptions,\n      label: 'Trial Status',\n      icon: Target,\n      options: uniqueValues.trialStatuses,\n      values: filters.trialStatus\n    },\n    {\n      key: 'conversionStatus' as keyof LeadsFilterOptions,\n      label: 'Conversion',\n      icon: UserCheck,\n      options: uniqueValues.conversionStatuses,\n      values: filters.conversionStatus\n    },\n    {\n      key: 'retentionStatus' as keyof LeadsFilterOptions,\n      label: 'Retention',\n      icon: TrendingUp,\n      options: uniqueValues.retentionStatuses,\n      values: filters.retentionStatus\n    }\n  ];\n\n  return (\n    <Card className=\"bg-white/95 backdrop-blur-sm border border-slate-200 shadow-lg\">\n      <CardHeader className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white rounded-t-lg\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"flex items-center gap-2 text-white\">\n            <Filter className=\"w-5 h-5\" />\n            Lead Filters\n            {activeFilterCount > 0 && (\n              <Badge className=\"bg-white/20 text-white border-white/30\">\n                {activeFilterCount} Active\n              </Badge>\n            )}\n          </CardTitle>\n          <Button \n            variant=\"outline\" \n            size=\"sm\" \n            onClick={clearAllFilters}\n            disabled={activeFilterCount === 0}\n            className=\"bg-white/10 border-white/30 text-white hover:bg-white/20\"\n          >\n            <X className=\"w-4 h-4 mr-1\" />\n            Clear All\n          </Button>\n        </div>\n      </CardHeader>\n      \n      <CardContent className=\"p-6 space-y-6\">\n        {/* Date Range Filter */}\n        <div className=\"space-y-3\">\n          <label className=\"text-sm font-semibold text-slate-700 flex items-center gap-2\">\n            <CalendarIcon className=\"w-4 h-4 text-blue-600\" />\n            Date Range\n          </label>\n          <DatePickerWithRange\n            value={{\n              from: filters.dateRange.start ? new Date(filters.dateRange.start) : undefined,\n              to: filters.dateRange.end ? new Date(filters.dateRange.end) : undefined\n            }}\n            onChange={handleDateRangeChange}\n          />\n        </div>\n\n        {/* Multi-select Filters Grid */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {filterConfigs.map((config) => (\n            <div key={config.key} className=\"space-y-2\">\n              <label className=\"text-sm font-semibold text-slate-700 flex items-center gap-2\">\n                <config.icon className=\"w-4 h-4 text-blue-600\" />\n                {config.label}\n                {config.values.length > 0 && (\n                  <Badge variant=\"secondary\" className=\"text-xs bg-blue-100 text-blue-700\">\n                    {config.values.length}\n                  </Badge>\n                )}\n              </label>\n              <Select\n                value=\"\"\n                onValueChange={(value) => handleArrayFilterChange(config.key, value)}\n              >\n                <SelectTrigger className=\"h-9\">\n                  <SelectValue placeholder={`Select ${config.label.toLowerCase()}`} />\n                </SelectTrigger>\n                <SelectContent className=\"bg-white z-50 max-h-48\">\n                  {config.options.map((option) => (\n                    <SelectItem key={option} value={option} className=\"text-sm\">\n                      {option}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              \n              {/* Show selected values */}\n              {config.values.length > 0 && (\n                <div className=\"flex flex-wrap gap-1\">\n                  {config.values.slice(0, 3).map((value) => (\n                    <Badge \n                      key={value} \n                      variant=\"secondary\" \n                      className=\"text-xs cursor-pointer hover:bg-red-100 bg-slate-100 text-slate-700\"\n                      onClick={() => handleArrayFilterChange(config.key, value)}\n                    >\n                      {value}\n                      <X className=\"w-3 h-3 ml-1\" />\n                    </Badge>\n                  ))}\n                  {config.values.length > 3 && (\n                    <Badge variant=\"outline\" className=\"text-xs\">\n                      +{config.values.length - 3} more\n                    </Badge>\n                  )}\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n\n        {/* LTV Range Filters */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-slate-200\">\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-semibold text-slate-700 flex items-center gap-2\">\n              <DollarSign className=\"w-4 h-4 text-blue-600\" />\n              Min LTV\n            </label>\n            <Input\n              type=\"number\"\n              placeholder=\"₹0\"\n              value={filters.minLTV || ''}\n              onChange={(e) => onFiltersChange({\n                ...filters,\n                minLTV: e.target.value ? parseFloat(e.target.value) : undefined\n              })}\n              className=\"h-9\"\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-semibold text-slate-700 flex items-center gap-2\">\n              <DollarSign className=\"w-4 h-4 text-blue-600\" />\n              Max LTV\n            </label>\n            <Input\n              type=\"number\"\n              placeholder=\"₹100000\"\n              value={filters.maxLTV || ''}\n              onChange={(e) => onFiltersChange({\n                ...filters,\n                maxLTV: e.target.value ? parseFloat(e.target.value) : undefined\n              })}\n              className=\"h-9\"\n            />\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n","\nimport React, { useMemo } from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { \n  Users, \n  Target, \n  Calendar, \n  MapPin, \n  TrendingUp,\n  TrendingDown,\n  DollarSign, \n  Activity, \n  CheckCircle,\n  Clock,\n  AlertTriangle,\n  Eye,\n  Zap\n} from 'lucide-react';\nimport { LeadsData } from '@/types/leads';\nimport { formatCurrency } from '@/utils/formatters';\nimport { cn } from '@/lib/utils';\n\ninterface FunnelMetricCardsProps {\n  data: LeadsData[];\n  onCardClick?: (title: string, data: LeadsData[], metricType: string) => void;\n}\n\nexport const FunnelMetricCards: React.FC<FunnelMetricCardsProps> = ({ data, onCardClick }) => {\n  const metrics = useMemo(() => {\n    if (!data || !data.length) {\n      return {\n        leadsReceived: 0,\n        trialsCompleted: 0,\n        trialsScheduled: 0,\n        proximityIssues: 0,\n        convertedLeads: 0,\n        trialToMemberConversion: 0,\n        leadToTrialConversion: 0,\n        leadToMemberConversion: 0,\n        avgLTV: 0,\n        avgVisitsPerLead: 0,\n        pipelineHealth: 0\n      };\n    }\n\n    const leadsReceived = data.length;\n    // Prefer trialStatus over stage to avoid double-counting\n    const trialsCompleted = data.filter(\n      lead => lead.trialStatus === 'Trial Completed' || lead.stage === 'Trial Completed'\n    ).length;\n    const trialsScheduled = data.filter(lead => {\n      const ts = (lead.trialStatus || '').toLowerCase();\n      const st = (lead.stage || '').toLowerCase();\n      // Count scheduled/booked trials but exclude completed\n      const statusSuggestsTrial = ts.includes('trial') && !ts.includes('completed');\n      const stageSuggestsTrial = st.includes('trial') && !st.includes('completed');\n      return statusSuggestsTrial || stageSuggestsTrial;\n    }).length;\n    const proximityIssues = data.filter(lead => lead.stage?.includes('Proximity') || lead.remarks?.toLowerCase().includes('proximity')).length;\n    const convertedLeads = data.filter(lead => lead.conversionStatus === 'Converted').length;\n    \n    const trialToMemberConversion = trialsCompleted > 0 ? (convertedLeads / trialsCompleted) * 100 : 0;\n    const leadToTrialConversion = leadsReceived > 0 ? (trialsScheduled / leadsReceived) * 100 : 0;\n    const leadToMemberConversion = leadsReceived > 0 ? (convertedLeads / leadsReceived) * 100 : 0;\n    \n    const totalLTV = data.reduce((sum, lead) => sum + (lead.ltv || 0), 0);\n    const avgLTV = leadsReceived > 0 ? totalLTV / leadsReceived : 0;\n    \n    const totalVisits = data.reduce((sum, lead) => sum + (lead.visits || 0), 0);\n    const avgVisitsPerLead = leadsReceived > 0 ? totalVisits / leadsReceived : 0;\n    \n    const pipelineHealth = Math.min(100, Math.round(\n      (leadToTrialConversion * 0.3) + \n      (trialToMemberConversion * 0.4) + \n      (avgVisitsPerLead * 10 * 0.2) + \n      ((leadsReceived - proximityIssues) / leadsReceived * 100 * 0.1)\n    ));\n\n    return {\n      leadsReceived,\n      trialsCompleted,\n      trialsScheduled,\n      proximityIssues,\n      convertedLeads,\n      trialToMemberConversion,\n      leadToTrialConversion,\n      leadToMemberConversion,\n      avgLTV,\n      avgVisitsPerLead,\n      pipelineHealth\n    };\n  }, [data]);\n\n  const MetricCard = ({ \n    id,\n    title, \n    value, \n    icon: Icon, \n    colorIndex,\n    subtitle, \n    format = 'number',\n    description\n  }: {\n    id: string;\n    title: string;\n    value: number;\n    icon: React.ElementType;\n    colorIndex: number;\n    subtitle?: string;\n    format?: 'number' | 'currency' | 'percentage';\n    description: string;\n  }) => {\n    const formatValue = (val: number) => {\n      switch (format) {\n        case 'currency': return formatCurrency(val);\n        case 'percentage': return `${val.toFixed(1)}%`;\n        default: return val.toLocaleString('en-IN');\n      }\n    };\n\n    return (\n      <Card\n        className={cn(\n          \"group relative overflow-hidden cursor-pointer transition-all duration-700\",\n          \"bg-white hover:bg-gradient-to-br hover:from-gray-900 hover:via-slate-900 hover:to-slate-900\",\n          colorIndex % 4 === 0 && \"border-t-4 border-green-700 hover:border-green-700 shadow-lg\",\n          colorIndex % 4 === 1 && \"border-t-4 border-blue-700 hover:border-blue-700 shadow-lg\",\n          colorIndex % 4 === 2 && \"border-t-4 border-pink-700 hover:border-pink-700 shadow-lg\", \n          colorIndex % 4 === 3 && \"border-t-4 border-red-700 hover:border-red-700 shadow-lg\",\n          \"hover:shadow-2xl hover:shadow-slate-900/30\",\n          \"hover:-translate-y-2 hover:scale-[1.02]\"\n        )}\n        onClick={() => onCardClick?.(title, data, id)}\n      >\n        <CardContent className=\"p-6 relative\">\n          <div className=\"absolute top-4 right-4 opacity-10 group-hover:opacity-20 transition-all duration-700\">\n            <Icon className={cn(\n              \"w-12 h-12 transition-all duration-700\",\n              colorIndex % 4 === 0 && \"text-green-700\",\n              colorIndex % 4 === 1 && \"text-blue-700\",\n              colorIndex % 4 === 2 && \"text-pink-700\",\n              colorIndex % 4 === 3 && \"text-red-700\",\n              \"group-hover:text-white/40\"\n            )} />\n          </div>\n          \n          <div className=\"relative z-10\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"flex items-center gap-6\">\n                <div className={cn(\n                  \"p-4 rounded-2xl transition-all duration-700 border-1 shadow-md\",\n                  colorIndex % 4 === 0 && \"bg-gradient-to-br from-green-700 to-green-600 border-green-900 text-white shadow-green-200\",\n                  colorIndex % 4 === 1 && \"bg-gradient-to-br from-blue-700 to-blue-600 border-blue-900 text-white shadow-blue-200\",\n                  colorIndex % 4 === 2 && \"bg-gradient-to-br from-pink-700 to-pink-600 border-pink-900 text-white shadow-pink-200\",\n                  colorIndex % 4 === 3 && \"bg-gradient-to-br from-red-700 to-red-600 border-red-900 text-white shadow-red-200\",\n                  \"group-hover:bg-white/20 group-hover:border-white/40 group-hover:text-white group-hover:shadow-white/20\"\n                )}>\n                  <Icon className=\"w-6 h-6 drop-shadow-sm\" />\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <h3 className=\"font-semibold text-lg text-slate-900 group-hover:text-white/95 transition-colors duration-700\">\n                    {title}\n                  </h3>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <p className={cn(\n                \"text-4xl font-bold transition-all duration-700 text-slate-900 group-hover:text-white\"\n              )}>\n                {formatValue(value)}\n              </p>\n              <p className={cn(\n                \"text-xs text-slate-500 group-hover:text-slate-200 transition-colors\"\n              )}>\n                {subtitle}\n              </p>\n            </div>\n          </div>\n          \n          <div className={cn(\n            \"mt-4 p-3 border-t border-l-4 transition-all duration-700\",\n            \"bg-slate-50 group-hover:bg-slate-800/50 border-t-slate-200 group-hover:border-t-white/10\",\n            colorIndex % 4 === 0 && \"border-l-green-700\",\n            colorIndex % 4 === 1 && \"border-l-blue-700\",\n            colorIndex % 4 === 2 && \"border-l-pink-700\",\n            colorIndex % 4 === 3 && \"border-l-red-700\"\n          )}>\n            <p className=\"text-xs text-slate-900 group-hover:text-white transition-colors duration-700\">\n              {description}\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n      <MetricCard\n        id=\"leadsReceived\"\n        title=\"Leads Received\"\n        value={metrics.leadsReceived}\n        icon={Users}\n        colorIndex={0}\n        subtitle=\"Total incoming leads\"\n        description=\"Total number of leads received in the selected period\"\n      />\n      \n      <MetricCard\n        id=\"trialsCompleted\"\n        title=\"Trials Completed\"\n        value={metrics.trialsCompleted}\n        icon={CheckCircle}\n        colorIndex={1}\n        subtitle=\"Successful trial sessions\"\n        description=\"Number of trial sessions that were successfully completed\"\n      />\n      \n      <MetricCard\n        id=\"convertedLeads\"\n        title=\"Converted Leads\"\n        value={metrics.convertedLeads}\n        icon={Target}\n        colorIndex={2}\n        subtitle=\"Successfully converted\"\n        description=\"Number of leads successfully converted to paying members\"\n      />\n      \n      <MetricCard\n        id=\"trialToMemberRate\"\n        title=\"Trial → Member %\"\n        value={metrics.trialToMemberConversion}\n        icon={TrendingUp}\n        colorIndex={3}\n        subtitle=\"Trial conversion efficiency\"\n        format=\"percentage\"\n        description=\"Percentage of completed trials that converted to memberships\"\n      />\n      \n      <MetricCard\n        id=\"leadToMemberRate\"\n        title=\"Lead → Member %\"\n        value={metrics.leadToMemberConversion}\n        icon={Zap}\n        colorIndex={0}\n        subtitle=\"Overall conversion rate\"\n        format=\"percentage\"\n        description=\"Overall percentage of leads converted to paying members\"\n      />\n      \n      <MetricCard\n        id=\"avgLTV\"\n        title=\"Average LTV\"\n        value={metrics.avgLTV}\n        icon={DollarSign}\n        colorIndex={1}\n        subtitle=\"Lifetime value per lead\"\n        format=\"currency\"\n        description=\"Average lifetime value generated per lead\"\n      />\n      \n      <MetricCard\n        id=\"avgVisitsPerLead\"\n        title=\"Avg Visits/Lead\"\n        value={metrics.avgVisitsPerLead}\n        icon={Eye}\n        colorIndex={2}\n        subtitle=\"Engagement frequency\"\n        description=\"Average number of visits per lead during the funnel process\"\n      />\n      \n      <MetricCard\n        id=\"pipelineHealth\"\n        title=\"Pipeline Health\"\n        value={metrics.pipelineHealth}\n        icon={metrics.pipelineHealth >= 70 ? CheckCircle : metrics.pipelineHealth >= 50 ? Clock : AlertTriangle}\n        colorIndex={3}\n        subtitle=\"Overall funnel performance\"\n        format=\"percentage\"\n        description=\"Composite score based on conversion rates, engagement, and lead quality\"\n      />\n    </div>\n  );\n};\n","\nimport React, { useState, useMemo } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell, LineChart, Line, Legend, Area, AreaChart } from 'recharts';\nimport { TrendingUp, BarChart3, PieChart as PieChartIcon, Users, Target, Calendar, RotateCcw, Download, ZoomIn, Maximize2, Filter, Clock, IndianRupee } from 'lucide-react';\nimport { LeadsData } from '@/types/leads';\nimport { formatCurrency } from '@/utils/formatters';\nimport { cn } from '@/lib/utils';\n\ninterface FunnelInteractiveChartsProps {\n  data: LeadsData[];\n}\n\nexport const FunnelInteractiveCharts: React.FC<FunnelInteractiveChartsProps> = ({ data }) => {\n  const [chartType, setChartType] = useState<'source' | 'stage' | 'timeline'>('source');\n  const [metricType, setMetricType] = useState<'volume' | 'conversion' | 'ltv'>('volume');\n\n  const chartData = useMemo(() => {\n    if (!data || !data.length) return [];\n\n    switch (chartType) {\n      case 'source': {\n        const sourceStats = data.reduce((acc, lead) => {\n          const source = lead.source || 'Unknown';\n          if (!acc[source]) {\n            acc[source] = { name: source, leads: 0, converted: 0, totalLTV: 0 };\n          }\n          acc[source].leads += 1;\n          if (lead.conversionStatus === 'Converted') acc[source].converted += 1;\n          acc[source].totalLTV += lead.ltv || 0;\n          return acc;\n        }, {} as Record<string, any>);\n\n        return Object.values(sourceStats)\n          .map((source: any) => ({\n            name: source.name,\n            volume: source.leads,\n            conversion: source.leads > 0 ? (source.converted / source.leads) * 100 : 0,\n            ltv: source.leads > 0 ? source.totalLTV / source.leads : 0\n          }))\n          .sort((a, b) => b.volume - a.volume)\n          .slice(0, 10);\n      }\n\n      case 'stage': {\n        const stageStats = data.reduce((acc, lead) => {\n          const stage = lead.stage || 'Unknown';\n          if (!acc[stage]) {\n            acc[stage] = { name: stage, leads: 0, converted: 0, totalLTV: 0 };\n          }\n          acc[stage].leads += 1;\n          if (lead.conversionStatus === 'Converted') acc[stage].converted += 1;\n          acc[stage].totalLTV += lead.ltv || 0;\n          return acc;\n        }, {} as Record<string, any>);\n\n        return Object.values(stageStats)\n          .map((stage: any) => ({\n            name: stage.name,\n            volume: stage.leads,\n            conversion: stage.leads > 0 ? (stage.converted / stage.leads) * 100 : 0,\n            ltv: stage.leads > 0 ? stage.totalLTV / stage.leads : 0\n          }))\n          .sort((a, b) => b.volume - a.volume);\n      }\n\n      case 'timeline': {\n        const monthlyStats = data.reduce((acc, lead) => {\n          if (!lead.createdAt) return acc;\n          \n          const date = new Date(lead.createdAt);\n          if (isNaN(date.getTime())) return acc;\n          \n          const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;\n          if (!acc[monthKey]) {\n            acc[monthKey] = { name: monthKey, leads: 0, converted: 0, totalLTV: 0 };\n          }\n          acc[monthKey].leads += 1;\n          if (lead.conversionStatus === 'Converted') acc[monthKey].converted += 1;\n          acc[monthKey].totalLTV += lead.ltv || 0;\n          return acc;\n        }, {} as Record<string, any>);\n\n        return Object.values(monthlyStats)\n          .map((month: any) => ({\n            name: month.name,\n            volume: month.leads,\n            conversion: month.leads > 0 ? (month.converted / month.leads) * 100 : 0,\n            ltv: month.leads > 0 ? month.totalLTV / month.leads : 0\n          }))\n          .sort((a, b) => a.name.localeCompare(b.name))\n          .slice(-12);\n      }\n\n      default:\n        return [];\n    }\n  }, [data, chartType]);\n\n  const pieData = useMemo(() => {\n    if (!data || !data.length) return [];\n\n    const conversionStats = data.reduce((acc, lead) => {\n      const status = lead.conversionStatus || 'Unknown';\n      acc[status] = (acc[status] || 0) + 1;\n      return acc;\n    }, {} as Record<string, number>);\n\n    const colors = ['#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#06b6d4'];\n    \n    return Object.entries(conversionStats)\n      .map(([status, count], index) => ({\n        name: status,\n        value: count,\n        percentage: ((count / data.length) * 100).toFixed(1),\n        color: colors[index % colors.length]\n      }))\n      .sort((a, b) => b.value - a.value);\n  }, [data]);\n\n  const getMetricValue = (item: any) => {\n    switch (metricType) {\n      case 'volume': return item.volume;\n      case 'conversion': return item.conversion;\n      case 'ltv': return item.ltv;\n      default: return item.volume;\n    }\n  };\n\n  const getMetricLabel = () => {\n    switch (metricType) {\n      case 'volume': return 'Lead Volume';\n      case 'conversion': return 'Conversion Rate (%)';\n      case 'ltv': return 'Average LTV (₹)';\n      default: return 'Lead Volume';\n    }\n  };\n\n  const CustomTooltip = ({ active, payload, label }: any) => {\n    if (active && payload && payload.length) {\n      return (\n        <div className=\"bg-white p-4 border border-slate-200 rounded-lg shadow-xl backdrop-blur-sm\">\n          <p className=\"font-semibold text-slate-800 mb-2\">{label}</p>\n          <p className=\"text-sm text-slate-600\">\n            {getMetricLabel()}: {\n              metricType === 'ltv' \n                ? formatCurrency(payload[0].value)\n                : metricType === 'conversion'\n                ? `${payload[0].value.toFixed(1)}%`\n                : payload[0].value.toLocaleString('en-IN')\n            }\n          </p>\n        </div>\n      );\n    }\n    return null;\n  };\n\n  const PieTooltip = ({ active, payload }: any) => {\n    if (active && payload && payload.length) {\n      const data = payload[0].payload;\n      return (\n        <div className=\"bg-white p-4 border border-slate-200 rounded-lg shadow-xl backdrop-blur-sm\">\n          <p className=\"font-semibold text-slate-800 mb-2\">{data.name}</p>\n          <p className=\"text-sm text-slate-600\">\n            Count: {data.value.toLocaleString('en-IN')} ({data.percentage}%)\n          </p>\n        </div>\n      );\n    }\n    return null;\n  };\n\n  if (!data || !data.length) {\n    return (\n      <Card className=\"w-full bg-white/90 backdrop-blur-sm border-0 shadow-xl\">\n        <CardContent className=\"p-12\">\n          <div className=\"text-center py-8 text-slate-500\">\n            <BarChart3 className=\"w-16 h-16 mx-auto mb-4 opacity-50\" />\n            <p className=\"text-lg font-medium\">No data available for charts</p>\n            <p className=\"text-sm\">Adjust your filters to see analytics</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n      {/* Main Chart - Left Side */}\n      <Card className=\"w-full bg-white/95 backdrop-blur-sm border-0 shadow-2xl overflow-hidden relative group\">\n        {/* 3D Card Effect */}\n        <div className=\"absolute inset-0 bg-gradient-to-br from-blue-600/5 to-purple-600/5 rounded-xl transform translate-x-1 translate-y-1 -z-10 group-hover:translate-x-2 group-hover:translate-y-2 transition-transform duration-300\" />\n        <div className=\"absolute inset-0 bg-gradient-to-br from-slate-800/5 to-slate-900/5 rounded-xl transform translate-x-0.5 translate-y-0.5 -z-10\" />\n        \n        <CardHeader className=\"bg-gradient-to-r from-red-700 via-red-800 to-red-900 text-white border-0 relative overflow-hidden\">\n          {/* 3D Header Effect */}\n          <div className=\"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent pointer-events-none\" />\n          <div className=\"absolute bottom-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-white/30 to-transparent\" />\n          \n          <div className=\"flex flex-col gap-4 relative z-10\">\n            <div className=\"flex items-center justify-between\">\n              <CardTitle className=\"flex items-center gap-3 text-white text-lg font-bold\">\n                <div className=\"p-2 bg-white/20 rounded-xl backdrop-blur-sm shadow-lg border border-white/20\">\n                  <BarChart3 className=\"w-5 h-5 text-white drop-shadow-lg\" />\n                </div>\n                {chartType === 'source' ? 'Lead Source Analytics' : chartType === 'stage' ? 'Funnel Stage Analytics' : 'Timeline Trend Analysis'}\n              </CardTitle>\n              \n              {/* Interactive Controls */}\n              <div className=\"flex items-center gap-2\">\n                <Button size=\"sm\" variant=\"ghost\" className=\"text-white hover:bg-white/10 border border-white/20 backdrop-blur-sm\">\n                  <RotateCcw className=\"w-4 h-4\" />\n                </Button>\n                <Button size=\"sm\" variant=\"ghost\" className=\"text-white hover:bg-white/10 border border-white/20 backdrop-blur-sm\">\n                  <ZoomIn className=\"w-4 h-4\" />\n                </Button>\n                <Button size=\"sm\" variant=\"ghost\" className=\"text-white hover:bg-white/10 border border-white/20 backdrop-blur-sm\">\n                  <Maximize2 className=\"w-4 h-4\" />\n                </Button>\n                <Button size=\"sm\" variant=\"ghost\" className=\"text-white hover:bg-white/10 border border-white/20 backdrop-blur-sm\">\n                  <Download className=\"w-4 h-4\" />\n                </Button>\n              </div>\n            </div>\n            \n            {/* Chart Type Selector */}\n            <div className=\"flex gap-2 bg-black/20 rounded-xl p-2 border border-white/10 backdrop-blur-sm\">\n              <Button\n                size=\"sm\"\n                variant={chartType === 'source' ? 'default' : 'ghost'}\n                onClick={() => setChartType('source')}\n                className={`transition-all duration-300 shadow-lg ${\n                  chartType === 'source' \n                    ? 'bg-white text-red-900 hover:bg-white/90 shadow-xl border border-white/20' \n                    : 'text-white hover:bg-white/10 border border-white/20'\n                }`}\n              >\n                <Users className=\"w-4 h-4 mr-2\" />\n                Source\n              </Button>\n              <Button\n                size=\"sm\"\n                variant={chartType === 'stage' ? 'default' : 'ghost'}\n                onClick={() => setChartType('stage')}\n                className={`transition-all duration-300 shadow-lg ${\n                  chartType === 'stage' \n                    ? 'bg-white text-red-900 hover:bg-white/90 shadow-xl border border-white/20' \n                    : 'text-white hover:bg-white/10 border border-white/20'\n                }`}\n              >\n                <Filter className=\"w-4 h-4 mr-2\" />\n                Stage\n              </Button>\n              <Button\n                size=\"sm\"\n                variant={chartType === 'timeline' ? 'default' : 'ghost'}\n                onClick={() => setChartType('timeline')}\n                className={`transition-all duration-300 shadow-lg ${\n                  chartType === 'timeline' \n                    ? 'bg-white text-red-900 hover:bg-white/90 shadow-xl border border-white/20' \n                    : 'text-white hover:bg-white/10 border border-white/20'\n                }`}\n              >\n                <Clock className=\"w-4 h-4 mr-2\" />\n                Timeline\n              </Button>\n            </div>\n          </div>\n        </CardHeader>\n        \n        {/* Metric Type Selector */}\n        <div className=\"px-6 pt-4 bg-gradient-to-r from-slate-50 to-white border-b border-slate-200\">\n          <div className=\"flex flex-wrap gap-2 pb-4\">\n            <Badge \n              variant={metricType === 'volume' ? 'secondary' : 'outline'}\n              className={cn(\n                \"cursor-pointer transition-all duration-300 hover:scale-105 shadow-sm\",\n                metricType === 'volume' \n                  ? \"bg-red-700 text-white border-red-600 shadow-red-200\" \n                  : \"bg-white text-slate-600 border-slate-300 hover:bg-red-50 hover:border-red-300\"\n              )}\n              onClick={() => setMetricType('volume')}\n            >\n              <TrendingUp className=\"w-3 h-3 mr-1\" />\n              Volume\n            </Badge>\n            <Badge \n              variant={metricType === 'conversion' ? 'secondary' : 'outline'}\n              className={cn(\n                \"cursor-pointer transition-all duration-300 hover:scale-105 shadow-sm\",\n                metricType === 'conversion' \n                  ? \"bg-red-700 text-white border-red-600 shadow-red-200\" \n                  : \"bg-white text-slate-600 border-slate-300 hover:bg-red-50 hover:border-red-300\"\n              )}\n              onClick={() => setMetricType('conversion')}\n            >\n              <Target className=\"w-3 h-3 mr-1\" />\n              Conversion\n            </Badge>\n            <Badge \n              variant={metricType === 'ltv' ? 'secondary' : 'outline'}\n              className={cn(\n                \"cursor-pointer transition-all duration-300 hover:scale-105 shadow-sm\",\n                metricType === 'ltv' \n                  ? \"bg-red-700 text-white border-red-600 shadow-red-200\" \n                  : \"bg-white text-slate-600 border-slate-300 hover:bg-red-50 hover:border-red-300\"\n              )}\n              onClick={() => setMetricType('ltv')}\n            >\n              <IndianRupee className=\"w-3 h-3 mr-1\" />\n              LTV\n            </Badge>\n          </div>\n        </div>\n        \n        <CardContent className=\"p-6 bg-gradient-to-br from-slate-50 to-white relative overflow-hidden\">\n          {/* 3D Content Background Effect */}\n          <div className=\"absolute inset-0 bg-gradient-to-br from-blue-600/5 to-purple-600/10 pointer-events-none\" />\n          <div className=\"absolute top-0 right-0 w-32 h-32 bg-gradient-to-bl from-red-500/10 to-transparent rounded-full blur-xl\" />\n          \n          <div className=\"h-80 relative z-10\">\n            <div className=\"absolute top-0 right-0 text-xs text-slate-500 font-medium bg-white/80 px-2 py-1 rounded-md backdrop-blur-sm shadow-sm\">\n              {getMetricLabel()}\n            </div>\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              {chartType === 'timeline' ? (\n                <AreaChart data={chartData}>\n                  <defs>\n                    {/* 3D Gradient Effects */}\n                    <linearGradient id=\"areaGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                      <stop offset=\"5%\" stopColor=\"#dc2626\" stopOpacity={0.8}/>\n                      <stop offset=\"50%\" stopColor=\"#ea580c\" stopOpacity={0.4}/>\n                      <stop offset=\"95%\" stopColor=\"#f97316\" stopOpacity={0.1}/>\n                    </linearGradient>\n                    <linearGradient id=\"lineGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                      <stop offset=\"0%\" stopColor=\"#b91c1c\" stopOpacity={1}/>\n                      <stop offset=\"100%\" stopColor=\"#dc2626\" stopOpacity={1}/>\n                    </linearGradient>\n                    <filter id=\"shadow\" x=\"-50%\" y=\"-50%\" width=\"200%\" height=\"200%\">\n                      <feDropShadow dx=\"2\" dy=\"2\" stdDeviation=\"3\" floodColor=\"#dc2626\" floodOpacity=\"0.3\"/>\n                    </filter>\n                  </defs>\n                  <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e2e8f0\" opacity={0.6} />\n                  <XAxis \n                    dataKey=\"name\" \n                    stroke=\"#475569\"\n                    fontSize={11}\n                    fontWeight={600}\n                    tickFormatter={(value) => String(value).slice(-5)}\n                  />\n                  <YAxis stroke=\"#475569\" fontSize={11} fontWeight={600} />\n                  <Tooltip content={<CustomTooltip />} />\n                  <Area \n                    type=\"monotone\" \n                    dataKey={metricType} \n                    stroke=\"url(#lineGradient)\" \n                    strokeWidth={4}\n                    fill=\"url(#areaGradient)\"\n                    filter=\"url(#shadow)\"\n                    dot={{ fill: '#dc2626', strokeWidth: 3, r: 6, filter: 'url(#shadow)' }}\n                    activeDot={{ r: 8, fill: '#b91c1c', stroke: '#ffffff', strokeWidth: 4 }}\n                  />\n                </AreaChart>\n              ) : (\n                <BarChart data={chartData}>\n                  <defs>\n                    {/* Enhanced 3D Bar Gradient */}\n                    <linearGradient id=\"barGradient3D\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                      <stop offset=\"0%\" stopColor=\"#dc2626\" stopOpacity={1}/>\n                      <stop offset=\"50%\" stopColor=\"#b91c1c\" stopOpacity={0.9}/>\n                      <stop offset=\"100%\" stopColor=\"#991b1b\" stopOpacity={0.8}/>\n                    </linearGradient>\n                    <filter id=\"barShadow\" x=\"-20%\" y=\"-20%\" width=\"140%\" height=\"140%\">\n                      <feDropShadow dx=\"3\" dy=\"3\" stdDeviation=\"4\" floodColor=\"#dc2626\" floodOpacity=\"0.4\"/>\n                    </filter>\n                  </defs>\n                  <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e2e8f0\" opacity={0.6} />\n                  <XAxis \n                    dataKey=\"name\" \n                    stroke=\"#475569\"\n                    fontSize={11}\n                    fontWeight={600}\n                    angle={-45}\n                    textAnchor=\"end\"\n                    height={80}\n                  />\n                  <YAxis stroke=\"#475569\" fontSize={11} fontWeight={600} />\n                  <Tooltip content={<CustomTooltip />} />\n                  <Bar \n                    dataKey={metricType} \n                    fill=\"url(#barGradient3D)\" \n                    radius={[6, 6, 0, 0]}\n                    filter=\"url(#barShadow)\"\n                  />\n                </BarChart>\n              )}\n            </ResponsiveContainer>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Enhanced 3D Pie Chart - Right Side */}\n      <Card className=\"w-full bg-white/95 backdrop-blur-sm border-0 shadow-2xl overflow-hidden relative group\">\n        {/* 3D Card Effect */}\n        <div className=\"absolute inset-0 bg-gradient-to-br from-orange-600/5 to-red-600/5 rounded-xl transform translate-x-1 translate-y-1 -z-10 group-hover:translate-x-2 group-hover:translate-y-2 transition-transform duration-300\" />\n        <div className=\"absolute inset-0 bg-gradient-to-br from-slate-800/5 to-slate-900/5 rounded-xl transform translate-x-0.5 translate-y-0.5 -z-10\" />\n        \n        <CardHeader className=\"bg-gradient-to-r from-orange-700 via-red-700 to-red-800 text-white border-0 relative overflow-hidden\">\n          {/* 3D Header Effect */}\n          <div className=\"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent pointer-events-none\" />\n          <div className=\"absolute bottom-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-white/30 to-transparent\" />\n          \n          <div className=\"flex items-center justify-between relative z-10\">\n            <CardTitle className=\"flex items-center gap-3 text-white text-lg font-bold\">\n              <div className=\"p-2 bg-white/20 rounded-xl backdrop-blur-sm shadow-lg border border-white/20\">\n                <PieChartIcon className=\"w-5 h-5 text-white drop-shadow-lg\" />\n              </div>\n              Conversion Status Distribution\n            </CardTitle>\n            \n            {/* Interactive Controls */}\n            <div className=\"flex items-center gap-2\">\n              <Button size=\"sm\" variant=\"ghost\" className=\"text-white hover:bg-white/10 border border-white/20 backdrop-blur-sm\">\n                <RotateCcw className=\"w-4 h-4\" />\n              </Button>\n              <Button size=\"sm\" variant=\"ghost\" className=\"text-white hover:bg-white/10 border border-white/20 backdrop-blur-sm\">\n                <Download className=\"w-4 h-4\" />\n              </Button>\n            </div>\n          </div>\n        </CardHeader>\n        \n        <CardContent className=\"p-6 bg-gradient-to-br from-slate-50 to-white relative overflow-hidden\">\n          {/* 3D Content Background Effect */}\n          <div className=\"absolute inset-0 bg-gradient-to-br from-orange-600/5 to-red-600/10 pointer-events-none\" />\n          <div className=\"absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-tr from-orange-500/10 to-transparent rounded-full blur-xl\" />\n          \n          <div className=\"h-80 relative z-10\">\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              <PieChart>\n                <defs>\n                  {/* Enhanced 3D Pie Shadows */}\n                  <filter id=\"pieShadow\" x=\"-50%\" y=\"-50%\" width=\"200%\" height=\"200%\">\n                    <feDropShadow dx=\"4\" dy=\"4\" stdDeviation=\"6\" floodColor=\"#000000\" floodOpacity=\"0.3\"/>\n                  </filter>\n                  <filter id=\"pieInnerShadow\" x=\"-50%\" y=\"-50%\" width=\"200%\" height=\"200%\">\n                    <feDropShadow dx=\"2\" dy=\"2\" stdDeviation=\"3\" floodColor=\"#000000\" floodOpacity=\"0.2\"/>\n                  </filter>\n                </defs>\n                <Pie\n                  data={pieData}\n                  cx=\"50%\"\n                  cy=\"50%\"\n                  labelLine={false}\n                  outerRadius={100}\n                  innerRadius={40}\n                  fill=\"#8884d8\"\n                  dataKey=\"value\"\n                  filter=\"url(#pieShadow)\"\n                  label={({ name, percentage }) => `${name} (${percentage}%)`}\n                >\n                  {pieData.map((entry, index) => (\n                    <Cell \n                      key={`cell-${index}`} \n                      fill={entry.color} \n                      stroke=\"#ffffff\"\n                      strokeWidth={3}\n                      filter=\"url(#pieInnerShadow)\"\n                    />\n                  ))}\n                </Pie>\n                <Tooltip content={<PieTooltip />} />\n                <Legend \n                  verticalAlign=\"bottom\" \n                  height={36}\n                  iconType=\"circle\"\n                  wrapperStyle={{\n                    paddingTop: '20px',\n                    fontSize: '12px',\n                    fontWeight: '600'\n                  }}\n                />\n              </PieChart>\n            </ResponsiveContainer>\n          </div>\n          \n          {/* Enhanced Statistics Summary */}\n          <div className=\"mt-6 pt-4 border-t border-slate-200\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"text-center p-3 bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl border border-green-200\">\n                <div className=\"text-2xl font-bold text-green-700\">\n                  {pieData.find(item => item.name.toLowerCase().includes('converted'))?.value || 0}\n                </div>\n                <div className=\"text-xs text-green-600 font-medium\">Converted</div>\n              </div>\n              <div className=\"text-center p-3 bg-gradient-to-br from-red-50 to-rose-50 rounded-xl border border-red-200\">\n                <div className=\"text-2xl font-bold text-red-700\">\n                  {pieData.find(item => !item.name.toLowerCase().includes('converted'))?.value || 0}\n                </div>\n                <div className=\"text-xs text-red-600 font-medium\">Pending</div>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};\n","import React, { useMemo, useState, useRef } from 'react';\nimport { motion } from 'framer-motion';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { BarChart3, Calendar, ChevronDown, ChevronUp, Eye, Filter, Minus, TrendingDown, TrendingUp, ShrinkIcon, ExpandIcon, Percent, Star, Users, Target } from 'lucide-react';\nimport { LeadsData } from '@/types/leads';\nimport { cn } from '@/lib/utils';\nimport { ModernDataTable } from '@/components/ui/ModernDataTable';\nimport { ModernTableWrapper } from './ModernTableWrapper';\nimport { useTableCopyContext } from '@/hooks/useTableCopyContext';\nimport { useMetricsTablesRegistry } from '@/contexts/MetricsTablesRegistryContext';\nimport { formatNumber } from '@/utils/formatters';\nimport { generateStandardMonthRange } from '@/utils/dateUtils';\nimport { PersistentTableFooter } from './PersistentTableFooter';\n\ntype GroupKey = 'source' | 'stage' | 'center' | 'channel' | 'associate';\ntype MetricType = 'totalLeads' | 'trialsCompleted' | 'trialsScheduled' | 'convertedLeads' | 'ltv' | 'avgVisits';\n\ninterface FunnelMonthOnMonthTableProps {\n  data: LeadsData[];\n  onDrillDown?: (title: string, data: LeadsData[], type: string) => void;\n}\n\nconst FunnelMonthOnMonthTable: React.FC<FunnelMonthOnMonthTableProps> = ({ data, onDrillDown }) => {\n  const [groupKey, setGroupKey] = useState<GroupKey>('source');\n  const [metric, setMetric] = useState<MetricType>('totalLeads');\n  const [viewMode, setViewMode] = useState<'values' | 'growth'>('values');\n  const [sortBy, setSortBy] = useState<'group' | 'total'>('total');\n  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc');\n\n  // Get context information for enhanced table copying\n  const copyContext = useTableCopyContext();\n\n  const handleSort = (column: 'group' | 'total') => {\n    if (sortBy === column) setSortOrder(prev => (prev === 'asc' ? 'desc' : 'asc'));\n    else {\n      setSortBy(column);\n      setSortOrder('desc');\n    }\n  };\n\n  const formatNumber = (n: number) => new Intl.NumberFormat('en-IN').format(n);\n  const formatPct = (n: number) => `${n >= 0 ? '+' : ''}${n.toFixed(1)}%`;\n  const growthIcon = (n: number) => (n > 0 ? <TrendingUp className=\"w-3 h-3 text-green-600\" /> : n < 0 ? <TrendingDown className=\"w-3 h-3 text-red-600\" /> : <Minus className=\"w-3 h-3 text-slate-400\" />);\n\n  const months = useMemo(() => {\n    // Full range from Jan 2024 to current month\n    const start = new Date(2024, 0, 1);\n    const now = new Date();\n    const arr: string[] = [];\n    const end = new Date(now.getFullYear(), now.getMonth(), 1);\n    for (let d = new Date(start.getFullYear(), start.getMonth(), 1); d <= end; d.setMonth(d.getMonth() + 1)) {\n      arr.push(`${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`);\n    }\n    return arr;\n  }, []);\n\n  // Display exactly Jan 2024 up to current month\n  const displayMonths = months;\n\n  const processedData = useMemo(() => {\n    type Bucket = { totalLeads: number; trialsCompleted: number; trialsScheduled: number; convertedLeads: number; totalLTV: number; totalVisits: number };\n    const emptyBucket = (): Bucket => ({ totalLeads: 0, trialsCompleted: 0, trialsScheduled: 0, convertedLeads: 0, totalLTV: 0, totalVisits: 0 });\n    const map = new Map<string, { group: string; months: Map<string, Bucket>; totals: Bucket }>();\n\n    const inc = (b: Bucket, l: LeadsData) => {\n      b.totalLeads += 1;\n      if (l.trialStatus === 'Trial Completed' || l.stage === 'Trial Completed') b.trialsCompleted += 1;\n      const ts = (l.trialStatus || '').toLowerCase();\n      const st = (l.stage || '').toLowerCase();\n      if ((ts.includes('trial') && !ts.includes('completed')) || (st.includes('trial') && !st.includes('completed'))) b.trialsScheduled += 1;\n      if (l.conversionStatus === 'Converted') b.convertedLeads += 1;\n      b.totalLTV += l.ltv || 0;\n      b.totalVisits += l.visits || 0;\n    };\n\n    data.forEach(l => {\n      if (!l.createdAt) return;\n      const d = new Date(l.createdAt);\n      if (isNaN(d.getTime())) return;\n      const mKey = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;\n      const gVal = ((l as any)[groupKey] as string) || 'Unknown';\n      if (!map.has(gVal)) map.set(gVal, { group: gVal, months: new Map(), totals: emptyBucket() });\n      const entry = map.get(gVal)!;\n      if (!entry.months.has(mKey)) entry.months.set(mKey, emptyBucket());\n      inc(entry.months.get(mKey)!, l);\n      inc(entry.totals, l);\n    });\n\n    const metricVal = (b: Bucket) => {\n      switch (metric) {\n        case 'totalLeads': return b.totalLeads;\n        case 'trialsCompleted': return b.trialsCompleted;\n        case 'trialsScheduled': return b.trialsScheduled;\n        case 'convertedLeads': return b.convertedLeads;\n        case 'ltv': return b.totalLeads > 0 ? b.totalLTV / b.totalLeads : 0;\n        case 'avgVisits': return b.totalLeads > 0 ? b.totalVisits / b.totalLeads : 0;\n      }\n    };\n\n    const rows = Array.from(map.values()).map(r => {\n      const totalVal = metricVal(r.totals) as number;\n      return { group: r.group, months: r.months, totalVal };\n    });\n\n    return rows.sort((a, b) => {\n      if (sortBy === 'group') return sortOrder === 'asc' ? a.group.localeCompare(b.group) : b.group.localeCompare(a.group);\n      if (sortBy === 'total') return sortOrder === 'asc' ? (a.totalVal as number) - (b.totalVal as number) : (b.totalVal as number) - (a.totalVal as number);\n    });\n  }, [data, groupKey, metric, months, sortBy, sortOrder]);\n\n  const tableVariants = { hidden: { opacity: 0, y: 20 }, visible: { opacity: 1, y: 0, transition: { duration: 0.6 } } };\n  const headerVariants = { hidden: { opacity: 0, y: -10 }, visible: { opacity: 1, y: 0, transition: { duration: 0.4, delay: 0.2 } } };\n\n  const tableRef = useRef<HTMLTableElement>(null);\n\n  return (\n    <motion.div variants={tableVariants} initial=\"hidden\" animate=\"visible\" className=\"w-full\">\n      <ModernTableWrapper\n        title=\"Month-on-Month Performance\"\n        description={`Historical trends by ${groupKey} and ${metric}`}\n        icon={<BarChart3 className=\"w-5 h-5 text-white\" />}\n        totalItems={processedData.length}\n        showDisplayToggle={true}\n        displayMode={viewMode}\n        onDisplayModeChange={(mode) => setViewMode(mode as 'values' | 'growth')}\n        showCollapseControls={false}\n        tableRef={tableRef}\n        contextInfo={{\n          selectedMetric: metric,\n          dateRange: copyContext.dateRange,\n          filters: copyContext.filters,\n          additionalInfo: {\n            groupKey: groupKey,\n            metric: metric,\n            viewMode: viewMode,\n            sortBy: sortBy,\n            sortOrder: sortOrder,\n            totalItems: processedData.length\n          }\n        }}\n        headerControls={\n          <div className=\"flex items-center gap-2\">\n            <select className=\"border border-white/30 bg-white/10 text-white rounded-md px-2 py-1 text-xs\" value={groupKey} onChange={e => setGroupKey(e.target.value as GroupKey)}>\n              <option value=\"source\" className=\"text-slate-900\">Group: Source</option>\n              <option value=\"stage\" className=\"text-slate-900\">Group: Stage</option>\n              <option value=\"center\" className=\"text-slate-900\">Group: Center</option>\n              <option value=\"channel\" className=\"text-slate-900\">Group: Channel</option>\n              <option value=\"associate\" className=\"text-slate-900\">Group: Associate</option>\n            </select>\n            <select className=\"border border-white/30 bg-white/10 text-white rounded-md px-2 py-1 text-xs\" value={metric} onChange={e => setMetric(e.target.value as MetricType)}>\n              <option value=\"totalLeads\" className=\"text-slate-900\">Metric: Total Leads</option>\n              <option value=\"trialsCompleted\" className=\"text-slate-900\">Metric: Trials Completed</option>\n              <option value=\"trialsScheduled\" className=\"text-slate-900\">Metric: Trials Scheduled</option>\n              <option value=\"convertedLeads\" className=\"text-slate-900\">Metric: Converted Leads</option>\n              <option value=\"ltv\" className=\"text-slate-900\">Metric: Avg LTV</option>\n              <option value=\"avgVisits\" className=\"text-slate-900\">Metric: Avg Visits</option>\n            </select>\n          </div>\n        }\n      >\n        <div className=\"pt-0\">\n          <motion.div className=\"overflow-x-auto\" initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.3 }}>\n            {\n              // Build ModernDataTable columns dynamically per month\n            }\n            {(() => {\n              type Bucket = { totalLeads: number; trialsCompleted: number; trialsScheduled: number; convertedLeads: number; totalLTV: number; totalVisits: number };\n              const metricVal = (b: Bucket | undefined): number => {\n                if (!b) return 0;\n                switch (metric) {\n                  case 'totalLeads': return b.totalLeads;\n                  case 'trialsCompleted': return b.trialsCompleted;\n                  case 'trialsScheduled': return b.trialsScheduled;\n                  case 'convertedLeads': return b.convertedLeads;\n                  case 'ltv': return b.totalLeads > 0 ? b.totalLTV / b.totalLeads : 0;\n                  case 'avgVisits': return b.totalLeads > 0 ? b.totalVisits / b.totalLeads : 0;\n                }\n              };\n\n              const columns: any[] = [\n                {\n                  key: 'group',\n                  header: 'Group',\n                  align: 'left' as const,\n                  className: 'min-w-[160px] sticky left-0 bg-white',\n                  render: (value: string) => (\n                    <div className=\"font-semibold text-slate-700 truncate\">{value}</div>\n                  )\n                },\n                ...displayMonths.map((mKey, idx) => ({\n                  key: mKey,\n                  header: new Date(mKey + '-01').toLocaleDateString('en-US', { month: 'short', year: 'numeric' }),\n                  align: 'center' as const,\n                  className: 'min-w-[90px]',\n                  render: (_: any, row: any) => {\n                    if (viewMode === 'values') {\n                      const v = metricVal(row.months.get(mKey));\n                      return <div className=\"text-xs font-medium text-slate-700\">{metric === 'ltv' || metric === 'avgVisits' ? v.toFixed(1) : formatNumber(v)}</div>;\n                    }\n                    // growth mode vs previous displayed month\n                    const prevKey = displayMonths[idx - 1];\n                    if (!prevKey) return <span className=\"text-slate-400 text-xs\">-</span>;\n                    const curr = metricVal(row.months.get(mKey));\n                    const prev = metricVal(row.months.get(prevKey));\n                    const growth = prev > 0 ? ((curr - prev) / prev) * 100 : 0;\n                    return (\n                      <div className={cn('text-xs font-semibold', growth > 0 ? 'text-green-600' : growth < 0 ? 'text-red-600' : 'text-slate-500')}>\n                        {growth === 0 ? '0.0%' : `${growth > 0 ? '+' : ''}${growth.toFixed(1)}%`}\n                      </div>\n                    );\n                  }\n                }))\n              ];\n\n              // Build totals row per month\n              const totalsMap = new Map<string, Bucket>();\n              processedData.forEach((row: any) => {\n                displayMonths.forEach(mKey => {\n                  const b = row.months.get(mKey) as Bucket | undefined;\n                  if (!totalsMap.has(mKey)) totalsMap.set(mKey, { totalLeads: 0, trialsCompleted: 0, trialsScheduled: 0, convertedLeads: 0, totalLTV: 0, totalVisits: 0 });\n                  const acc = totalsMap.get(mKey)!;\n                  if (b) {\n                    acc.totalLeads += b.totalLeads;\n                    acc.trialsCompleted += b.trialsCompleted;\n                    acc.trialsScheduled += b.trialsScheduled;\n                    acc.convertedLeads += b.convertedLeads;\n                    acc.totalLTV += b.totalLTV;\n                    acc.totalVisits += b.totalVisits;\n                  }\n                });\n              });\n\n              // Pre-format footer data to extract the selected metric value for each month\n              const footerData: Record<string, any> = { group: 'TOTALS' };\n              displayMonths.forEach((mKey, idx) => {\n                const bucket = totalsMap.get(mKey);\n                if (viewMode === 'values') {\n                  const v = metricVal(bucket);\n                  footerData[mKey] = metric === 'ltv' || metric === 'avgVisits' ? v.toFixed(1) : formatNumber(v);\n                } else {\n                  // growth mode vs previous displayed month\n                  const prevKey = displayMonths[idx - 1];\n                  if (!prevKey) {\n                    footerData[mKey] = '-';\n                  } else {\n                    const curr = metricVal(bucket);\n                    const prevBucket = totalsMap.get(prevKey);\n                    const prev = metricVal(prevBucket);\n                    const growth = prev > 0 ? ((curr - prev) / prev) * 100 : 0;\n                    footerData[mKey] = growth === 0 ? '0.0%' : `${growth > 0 ? '+' : ''}${growth.toFixed(1)}%`;\n                  }\n                }\n              });\n\n              const table = (\n                <ModernDataTable\n                  data={processedData}\n                  columns={columns}\n                  loading={false}\n                  stickyHeader={true}\n                  showFooter={true}\n                  footerData={footerData}\n                  maxHeight=\"480px\"\n                  className=\"rounded-lg\"\n                  headerGradient=\"from-slate-800 via-slate-900 to-slate-800\"\n                  onRowClick={onDrillDown ? (row) => {\n                    // Filter data based on the group value and pass to drill down\n                    const filteredData = data.filter(lead => {\n                      const leadValue = ((lead as any)[groupKey] as string) || 'Unknown';\n                      return leadValue === row.group;\n                    });\n                    onDrillDown(`${groupKey}: ${row.group}`, filteredData, 'month-on-month');\n                  } : undefined}\n                />\n              );\n              // Simple AI notes based on displayed metric\n              const aiNotes: string[] = [];\n              if (processedData.length > 0) {\n                const latestKey = displayMonths[displayMonths.length - 1];\n                const best = [...processedData]\n                  .map(r => ({ name: r.group, v: metricVal(r.months.get(latestKey)) }))\n                  .sort((a,b) => (b.v - a.v))[0];\n                if (best && best.v > 0) aiNotes.push(`Top ${groupKey} in the latest month: ${best.name} (${metric === 'ltv' || metric === 'avgVisits' ? best.v.toFixed(1) : formatNumber(best.v)})`);\n                if (viewMode === 'growth') {\n                  const idx = displayMonths.length - 1;\n                  const prevKey = displayMonths[idx - 1];\n                  if (prevKey) {\n                    const growths = processedData.map(r => {\n                      const curr = metricVal(r.months.get(latestKey));\n                      const prev = metricVal(r.months.get(prevKey));\n                      return { name: r.group, g: prev > 0 ? ((curr - prev) / prev) * 100 : 0 };\n                    });\n                    const topG = [...growths].sort((a,b) => b.g - a.g)[0];\n                    if (topG && (topG.g !== 0)) aiNotes.push(`Strongest MoM growth: ${topG.name} (${topG.g > 0 ? '+' : ''}${topG.g.toFixed(1)}%)`);\n                  }\n                }\n              }\n              return (\n                <div>\n                  {table}\n                  <div className=\"border-t border-slate-200 p-4 bg-slate-50 mt-2 rounded-b-xl\">\n                    <div className=\"text-sm font-bold text-slate-700 mb-2\">AI Notes</div>\n                    {aiNotes.length ? (\n                      <ul className=\"list-disc pl-5 text-sm text-slate-600 space-y-1\">\n                        {aiNotes.map((n, i) => <li key={i}>{n}</li>)}\n                      </ul>\n                    ) : (\n                      <div className=\"text-xs text-slate-500\">No notable anomalies detected in the selected view.</div>\n                    )}\n                  </div>\n                </div>\n              );\n            })()}\n          </motion.div>\n        </div>\n      </ModernTableWrapper>\n    </motion.div>\n  );\n};\n\nexport default FunnelMonthOnMonthTable;","import React, { useState, useMemo, useRef } from 'react';\nimport { motion } from 'framer-motion';\nimport { Badge } from '@/components/ui/badge';\nimport { Calendar, BarChart3, TrendingUp, TrendingDown, Filter, Eye, Percent, Star, Users, Target } from 'lucide-react';\nimport { LeadsData } from '@/types/leads';\nimport { formatNumber, formatCurrency, formatPercentage } from '@/utils/formatters';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { cn } from '@/lib/utils';\nimport { ModernTableWrapper } from './ModernTableWrapper';\nimport { PersistentTableFooter } from '@/components/dashboard/PersistentTableFooter';\nimport { Button } from '@/components/ui/button';\nimport { useMetricsTablesRegistry } from '@/contexts/MetricsTablesRegistryContext';\nimport { generateStandardMonthRange } from '@/utils/dateUtils';\ninterface FunnelYearOnYearTableProps {\n  allData: LeadsData[]; // Use all data, not filtered\n  onDrillDown?: (title: string, data: LeadsData[], type: string) => void;\n}\ntype MetricType = 'totalLeads' | 'trialsCompleted' | 'trialsScheduled' | 'proximityIssues' | 'convertedLeads' | 'trialToMemberRate' | 'leadToTrialRate' | 'leadToMemberRate' | 'ltv' | 'avgVisits' | 'pipelineHealth';\nexport const FunnelYearOnYearTable: React.FC<FunnelYearOnYearTableProps> = ({\n  allData,\n  onDrillDown\n}) => {\n  const [selectedMetric, setSelectedMetric] = useState<MetricType>('totalLeads');\n  const [viewMode, setViewMode] = useState<'values' | 'growth'>('values');\n  const [sortKey, setSortKey] = useState<string>('total');\n  const [sortDir, setSortDir] = useState<'asc' | 'desc'>('desc');\n  const tableRef = useRef<HTMLTableElement>(null);\n  const registry = useMetricsTablesRegistry();\n\n  // Register table for metrics\n  React.useEffect(() => {\n    if (tableRef.current) {\n      registry.registerTable('funnel-year-on-year-analysis', tableRef.current);\n    }\n    return () => registry.unregisterTable('funnel-year-on-year-analysis');\n  }, [registry]);\n\n  const tableVariants = {\n    hidden: { opacity: 0, y: 20 },\n    visible: {\n      opacity: 1,\n      y: 0,\n      transition: { duration: 0.6 }\n    }\n  };\n\n  const headerVariants = {\n    hidden: { opacity: 0, y: -10 },\n    visible: {\n      opacity: 1,\n      y: 0,\n      transition: { duration: 0.4 }\n    }\n  };\n  const processedData = useMemo(() => {\n    if (!allData.length) return [];\n    const sourceData = allData.reduce((acc, lead) => {\n      const source = lead.source || 'Unknown';\n      if (!acc[source]) {\n        acc[source] = {};\n      }\n      if (lead.createdAt) {\n        const date = new Date(lead.createdAt);\n        const year = date.getFullYear();\n        const month = date.getMonth() + 1;\n        const yearMonthKey = `${year}-${String(month).padStart(2, '0')}`;\n        if (!acc[source][yearMonthKey]) {\n          acc[source][yearMonthKey] = {\n            totalLeads: 0,\n            trialsCompleted: 0,\n            trialsScheduled: 0,\n            proximityIssues: 0,\n            convertedLeads: 0,\n            totalLTV: 0,\n            totalVisits: 0\n          };\n        }\n        const yearMonthData = acc[source][yearMonthKey];\n        yearMonthData.totalLeads += 1;\n  const ts = (lead.trialStatus || '').toLowerCase();\n  const st = (lead.stage || '').toLowerCase();\n  if (lead.trialStatus === 'Trial Completed' || lead.stage === 'Trial Completed') yearMonthData.trialsCompleted += 1;\n  if ((ts.includes('trial') && !ts.includes('completed')) || (st.includes('trial') && !st.includes('completed'))) yearMonthData.trialsScheduled += 1;\n  if (st.includes('proximity') || (lead.remarks || '').toLowerCase().includes('proximity')) yearMonthData.proximityIssues += 1;\n        if (lead.conversionStatus === 'Converted') yearMonthData.convertedLeads += 1;\n        yearMonthData.totalLTV += lead.ltv || 0;\n        yearMonthData.totalVisits += lead.visits || 0;\n      }\n      return acc;\n    }, {} as Record<string, Record<string, any>>);\n\n    // Generate months for current year and previous year\n    const currentDate = new Date();\n    const currentYear = currentDate.getFullYear();\n    const currentMonth = currentDate.getMonth() + 1;\n    const months = [] as { month: number; name: string; current: string; previous: string }[];\n    // Build months from Jan to current month for both years\n    for (let month = 1; month <= currentMonth; month++) {\n      const monthName = new Date(currentYear, month - 1).toLocaleString('default', { month: 'short' });\n      months.push({\n        month,\n        name: monthName,\n        current: `${currentYear}-${String(month).padStart(2, '0')}`,\n        previous: `${currentYear - 1}-${String(month).padStart(2, '0')}`\n      });\n    }\n    return Object.keys(sourceData).map(source => {\n      const sourceStats = sourceData[source];\n      const result: any = {\n        source\n      };\n      months.forEach(monthInfo => {\n        const currentData = sourceStats[monthInfo.current] || {\n          totalLeads: 0,\n          trialsCompleted: 0,\n          trialsScheduled: 0,\n          proximityIssues: 0,\n          convertedLeads: 0,\n          totalLTV: 0,\n          totalVisits: 0\n        };\n        const previousData = sourceStats[monthInfo.previous] || {\n          totalLeads: 0,\n          trialsCompleted: 0,\n          trialsScheduled: 0,\n          proximityIssues: 0,\n          convertedLeads: 0,\n          totalLTV: 0,\n          totalVisits: 0\n        };\n        const calculateMetric = (data: any) => {\n          const trialToMemberRate = data.trialsCompleted > 0 ? data.convertedLeads / data.trialsCompleted * 100 : 0;\n          const leadToTrialRate = data.totalLeads > 0 ? data.trialsCompleted / data.totalLeads * 100 : 0;\n          const leadToMemberRate = data.totalLeads > 0 ? data.convertedLeads / data.totalLeads * 100 : 0;\n          const avgLTV = data.totalLeads > 0 ? data.totalLTV / data.totalLeads : 0;\n          const avgVisits = data.totalLeads > 0 ? data.totalVisits / data.totalLeads : 0;\n          const pipelineHealth = data.totalLeads > 0 ? (data.totalLeads - data.proximityIssues) / data.totalLeads * 100 : 0;\n          return {\n            totalLeads: data.totalLeads,\n            trialsCompleted: data.trialsCompleted,\n            trialsScheduled: data.trialsScheduled,\n            proximityIssues: data.proximityIssues,\n            convertedLeads: data.convertedLeads,\n            trialToMemberRate,\n            leadToTrialRate,\n            leadToMemberRate,\n            ltv: avgLTV,\n            avgVisits,\n            pipelineHealth\n          };\n        };\n        const currentMetrics = calculateMetric(currentData);\n        const previousMetrics = calculateMetric(previousData);\n        result[`${monthInfo.name}_${currentYear}`] = currentMetrics;\n        result[`${monthInfo.name}_${currentYear - 1}`] = previousMetrics;\n      });\n      return result;\n    }).filter(source => {\n      return months.some(monthInfo => source[`${monthInfo.name}_${currentYear}`]?.totalLeads > 0 || source[`${monthInfo.name}_${currentYear - 1}`]?.totalLeads > 0);\n    });\n  }, [allData]);\n  // Raw totals with nested metrics (for calculations)\n  const rawTotals = useMemo(() => {\n    const currentDate = new Date();\n    const currentYear = currentDate.getFullYear();\n    const currentMonth = currentDate.getMonth() + 1;\n    const months = [] as { month: number; name: string }[];\n    for (let month = 1; month <= currentMonth; month++) {\n      const monthName = new Date(currentYear, month - 1).toLocaleString('default', { month: 'short' });\n      months.push({ month, name: monthName });\n    }\n    const result: any = {\n      source: 'TOTALS'\n    };\n    months.forEach(monthInfo => {\n      const currentTotals = processedData.reduce((acc, source) => {\n        const data = source[`${monthInfo.name}_${currentYear}`] || {};\n        acc.totalLeads += data.totalLeads || 0;\n        acc.trialsCompleted += data.trialsCompleted || 0;\n        acc.trialsScheduled += data.trialsScheduled || 0;\n        acc.proximityIssues += data.proximityIssues || 0;\n        acc.convertedLeads += data.convertedLeads || 0;\n        acc.totalLTV += (data.ltv || 0) * (data.totalLeads || 0);\n        acc.totalVisits += (data.avgVisits || 0) * (data.totalLeads || 0);\n        return acc;\n      }, {\n        totalLeads: 0,\n        trialsCompleted: 0,\n        trialsScheduled: 0,\n        proximityIssues: 0,\n        convertedLeads: 0,\n        totalLTV: 0,\n        totalVisits: 0\n      });\n      const previousTotals = processedData.reduce((acc, source) => {\n        const data = source[`${monthInfo.name}_${currentYear - 1}`] || {};\n        acc.totalLeads += data.totalLeads || 0;\n        acc.trialsCompleted += data.trialsCompleted || 0;\n        acc.trialsScheduled += data.trialsScheduled || 0;\n        acc.proximityIssues += data.proximityIssues || 0;\n        acc.convertedLeads += data.convertedLeads || 0;\n        acc.totalLTV += (data.ltv || 0) * (data.totalLeads || 0);\n        acc.totalVisits += (data.avgVisits || 0) * (data.totalLeads || 0);\n        return acc;\n      }, {\n        totalLeads: 0,\n        trialsCompleted: 0,\n        trialsScheduled: 0,\n        proximityIssues: 0,\n        convertedLeads: 0,\n        totalLTV: 0,\n        totalVisits: 0\n      });\n      const calculateTotalMetrics = (totals: any) => {\n        const trialToMemberRate = totals.trialsCompleted > 0 ? totals.convertedLeads / totals.trialsCompleted * 100 : 0;\n        const leadToTrialRate = totals.totalLeads > 0 ? totals.trialsCompleted / totals.totalLeads * 100 : 0;\n        const leadToMemberRate = totals.totalLeads > 0 ? totals.convertedLeads / totals.totalLeads * 100 : 0;\n        const avgLTV = totals.totalLeads > 0 ? totals.totalLTV / totals.totalLeads : 0;\n        const avgVisits = totals.totalLeads > 0 ? totals.totalVisits / totals.totalLeads : 0;\n        const pipelineHealth = totals.totalLeads > 0 ? (totals.totalLeads - totals.proximityIssues) / totals.totalLeads * 100 : 0;\n        return {\n          totalLeads: totals.totalLeads,\n          trialsCompleted: totals.trialsCompleted,\n          trialsScheduled: totals.trialsScheduled,\n          proximityIssues: totals.proximityIssues,\n          convertedLeads: totals.convertedLeads,\n          trialToMemberRate,\n          leadToTrialRate,\n          leadToMemberRate,\n          ltv: avgLTV,\n          avgVisits,\n          pipelineHealth\n        };\n      };\n      result[`${monthInfo.name}_${currentYear}`] = calculateTotalMetrics(currentTotals);\n      result[`${monthInfo.name}_${currentYear - 1}`] = calculateTotalMetrics(previousTotals);\n    });\n    return result;\n  }, [processedData]);\n\n  // Helper function to format values based on metric type\n  const formatValue = (value: any, metric: MetricType) => {\n    if (typeof value !== 'object' || !value) return '-';\n    const metricValue = value[metric];\n    if (metricValue === undefined || metricValue === 0) return '-';\n    switch (metric) {\n      case 'ltv':\n        return metricValue < 1000 ? `₹${Math.round(metricValue)}` : formatCurrency(metricValue);\n      case 'trialToMemberRate':\n      case 'leadToTrialRate':\n      case 'leadToMemberRate':\n      case 'pipelineHealth':\n        return `${metricValue.toFixed(1)}%`;\n      case 'avgVisits':\n        return metricValue.toFixed(1);\n      default:\n        return metricValue.toLocaleString('en-IN');\n    }\n  };\n\n  // Pre-formatted footer data that extracts the selected metric for display\n  const totals = useMemo(() => {\n    const currentDate = new Date();\n    const currentYear = currentDate.getFullYear();\n    const currentMonth = currentDate.getMonth() + 1;\n    const months = [] as { month: number; name: string }[];\n    for (let month = 1; month <= currentMonth; month++) {\n      const monthName = new Date(currentYear, month - 1).toLocaleString('default', { month: 'short' });\n      months.push({ month, name: monthName });\n    }\n    \n    const result: any = {\n      source: 'TOTALS'\n    };\n    \n    months.forEach(monthInfo => {\n      const currentData = rawTotals[`${monthInfo.name}_${currentYear}`];\n      const previousData = rawTotals[`${monthInfo.name}_${currentYear - 1}`];\n      \n      if (viewMode === 'growth') {\n        // In growth mode, show YoY growth percentage\n        const currentVal = currentData?.[selectedMetric] || 0;\n        const previousVal = previousData?.[selectedMetric] || 0;\n        if (previousVal > 0) {\n          const growth = ((currentVal - previousVal) / previousVal) * 100;\n          result[`${monthInfo.name}_${currentYear}`] = growth > 0 ? `+${growth.toFixed(1)}%` : `${growth.toFixed(1)}%`;\n        } else {\n          result[`${monthInfo.name}_${currentYear}`] = '-';\n        }\n        result[`${monthInfo.name}_${currentYear - 1}`] = '—';\n      } else {\n        // In values mode, show the formatted metric value\n        result[`${monthInfo.name}_${currentYear}`] = formatValue(currentData, selectedMetric);\n        result[`${monthInfo.name}_${currentYear - 1}`] = formatValue(previousData, selectedMetric);\n      }\n    });\n    \n    return result;\n  }, [rawTotals, selectedMetric, viewMode]);\n\n  const metricTabs = [{\n    value: 'totalLeads',\n    label: 'Total Leads'\n  }, {\n    value: 'trialsCompleted',\n    label: 'Trials Completed'\n  }, {\n    value: 'trialsScheduled',\n    label: 'Trials Scheduled'\n  }, {\n    value: 'proximityIssues',\n    label: 'Proximity Issues'\n  }, {\n    value: 'convertedLeads',\n    label: 'Converted Leads'\n  }, {\n    value: 'trialToMemberRate',\n    label: 'Trial → Member Rate'\n  }, {\n    value: 'leadToTrialRate',\n    label: 'Lead → Trial Rate'\n  }, {\n    value: 'leadToMemberRate',\n    label: 'Lead → Member Rate'\n  }, {\n    value: 'ltv',\n    label: 'Average LTV'\n  }, {\n    value: 'avgVisits',\n    label: 'Avg Visits/Lead'\n  }, {\n    value: 'pipelineHealth',\n    label: 'Pipeline Health'\n  }];\n\n  // Generate columns\n  const currentDate = new Date();\n  const currentYear = currentDate.getFullYear();\n  const currentMonth = currentDate.getMonth() + 1;\n  const monthsForColumns = [] as { month: number; name: string }[];\n  for (let month = 1; month <= currentMonth; month++) {\n    const monthName = new Date(currentYear, month - 1).toLocaleString('default', { month: 'short' });\n    monthsForColumns.push({ month, name: monthName });\n  }\n  const columns = [{\n    key: 'source',\n    header: 'Lead Source',\n    render: (value: string) => <div className=\"font-semibold text-slate-700 min-w-[120px] truncate\">\n          {value === 'TOTALS' ? (\n            <span className=\"text-slate-900 font-extrabold uppercase tracking-wide\">TOTALS</span>\n          ) : (\n            value\n          )}\n        </div>,\n    align: 'left' as const,\n    className: 'min-w-[140px] sticky left-0 bg-white'\n  }, ...monthsForColumns.flatMap(monthInfo => [{\n    key: `${monthInfo.name}_${currentYear}`,\n    header: `${monthInfo.name} ${currentYear}`,\n    render: (value: any, row: any) => {\n      // If growth view, show YoY growth vs previous year in the current year column\n      if (viewMode === 'growth') {\n        const currentValue = value;\n        const previousValue = row[`${monthInfo.name}_${currentYear - 1}`];\n        let growth: number | null = null;\n        let growthDisplay = '';\n        if (currentValue && previousValue && typeof currentValue === 'object' && typeof previousValue === 'object') {\n          const current = currentValue[selectedMetric];\n          const previous = previousValue[selectedMetric];\n          if (current !== undefined && previous !== undefined && previous !== 0) {\n            growth = ((current - previous) / previous) * 100;\n            if (Math.abs(growth) > 0.1) {\n              growthDisplay = growth > 0 ? `+${growth.toFixed(1)}%` : `${growth.toFixed(1)}%`;\n            } else {\n              growthDisplay = '0.0%';\n            }\n          }\n        }\n        return (\n          <div className=\"text-center text-xs font-semibold\">\n            {growthDisplay ? (\n              <span className={cn(growth && growth > 0 ? 'text-green-600' : 'text-red-600')}>\n                {growthDisplay}\n              </span>\n            ) : (\n              <span className=\"text-slate-400\">-</span>\n            )}\n          </div>\n        );\n      }\n      // Values view: show the metric value\n      return (\n        <div className=\"text-center font-medium text-xs text-slate-700\">\n          {formatValue(value, selectedMetric)}\n        </div>\n      );\n    },\n    align: 'center' as const,\n    className: 'min-w-[90px]'\n  }, {\n    key: `${monthInfo.name}_${currentYear - 1}`,\n    header: `${monthInfo.name} ${currentYear - 1}`,\n    render: (value: any, row: any) => {\n      const currentValue = row[`${monthInfo.name}_${currentYear}`];\n      const previousValue = value;\n      if (viewMode === 'growth') {\n        // Show only growth % (rendered in current-year column), keep baseline column minimal\n        let growth: number | null = null;\n        let growthDisplay = '';\n        if (currentValue && previousValue && typeof currentValue === 'object' && typeof previousValue === 'object') {\n          const current = currentValue[selectedMetric];\n          const previous = previousValue[selectedMetric];\n          if (current !== undefined && previous !== undefined && previous !== 0) {\n            growth = ((current - previous) / previous) * 100;\n            if (Math.abs(growth) > 0.1) {\n              growthDisplay = growth > 0 ? `+${growth.toFixed(1)}%` : `${growth.toFixed(1)}%`;\n            } else {\n              growthDisplay = '0.0%';\n            }\n          }\n        }\n        return (\n          <div className=\"text-center text-xs text-slate-400\">—</div>\n        );\n      }\n      // Values view: show the previous year's value only\n      return (\n        <div className=\"text-center\">\n          <div className=\"font-medium text-slate-700 text-xs\">\n            {formatValue(value, selectedMetric)}\n          </div>\n        </div>\n      );\n    },\n    align: 'center' as const,\n    className: 'min-w-[90px]'\n  }])];\n  return (\n    <motion.div\n      variants={tableVariants}\n      initial=\"hidden\"\n      animate=\"visible\"\n      className=\"w-full\"\n    >\n      <ModernTableWrapper\n        title=\"Year-on-Year Source Performance\"\n        description={`Historical comparison across years by source - ${metricTabs.find(t => t.value === selectedMetric)?.label || selectedMetric}`}\n        icon={<BarChart3 className=\"w-5 h-5 text-white\" />}\n        totalItems={processedData.length}\n        showDisplayToggle={true}\n        displayMode={viewMode}\n        onDisplayModeChange={(mode) => setViewMode(mode as 'values' | 'growth')}\n        showCollapseControls={false}\n        tableRef={tableRef}\n        headerControls={\n          <div className=\"flex items-center gap-2\">\n            <select \n              className=\"border border-white/30 bg-white/10 text-white rounded-md px-2 py-1 text-xs\"\n              value={selectedMetric}\n              onChange={(e) => setSelectedMetric(e.target.value as MetricType)}\n            >\n              {metricTabs.map((tab) => (\n                <option key={tab.value} value={tab.value} className=\"text-slate-900\">\n                  {tab.label}\n                </option>\n              ))}\n            </select>\n          </div>\n        }\n      >\n        <div className=\"pt-0\">\n          {/* Metric Selector Tabs */}\n          <div className=\"flex flex-wrap items-center gap-4 p-4 bg-white rounded-lg border mb-4\">\n            <div className=\"space-y-1\">\n              <label className=\"text-sm font-medium text-gray-700\">Metric</label>\n              <select \n                value={selectedMetric} \n                onChange={(e) => setSelectedMetric(e.target.value as MetricType)}\n                className=\"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              >\n                {metricTabs.map((tab) => (\n                  <option key={tab.value} value={tab.value}>{tab.label}</option>\n                ))}\n              </select>\n            </div>\n            \n            <div className=\"space-y-1\">\n              <label className=\"text-sm font-medium text-gray-700\">View Mode</label>\n              <select \n                value={viewMode} \n                onChange={(e) => setViewMode(e.target.value as 'values' | 'growth')}\n                className=\"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              >\n                <option value=\"values\">Values</option>\n                <option value=\"growth\">Growth %</option>\n              </select>\n            </div>\n          </div>\n\n          {/* Table */}\n          <motion.div \n            className=\"overflow-auto rounded-lg\"\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            transition={{ delay: 0.4 }}\n          >\n            <div className=\"overflow-x-auto\" data-table=\"funnel-year-on-year-analysis\">\n              <table ref={tableRef} className=\"min-w-full bg-white\">\n                <thead>\n                  <tr className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n                    <th className=\"px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide sticky left-0 z-40 border-r border-white/20 cursor-pointer select-none\">\n                      <div className=\"flex items-center space-x-2\">\n                        <Star className=\"w-4 h-4 text-white\" />\n                        <span>Source</span>\n                      </div>\n                    </th>\n                    {monthsForColumns.map((monthInfo) => {\n                      const currentYear = new Date().getFullYear();\n                      return [\n                        <th\n                          key={`${monthInfo.name}_${currentYear}`}\n                          className=\"px-3 py-3 text-center font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[90px] cursor-pointer select-none text-white\"\n                          onClick={() => {\n                            const key = `${monthInfo.name}_${currentYear}`;\n                            if (sortKey !== key) { setSortKey(key); setSortDir('desc'); }\n                            else setSortDir(d => d === 'desc' ? 'asc' : 'desc');\n                          }}\n                          title={`Sort by ${monthInfo.name} ${currentYear} (${sortDir})`}\n                        >\n                          <div className=\"flex flex-col items-center\">\n                            <div className=\"flex items-center space-x-1\">\n                              <Star className=\"w-3 h-3\" />\n                              <span className=\"text-xs font-bold whitespace-nowrap\">{monthInfo.name}</span>\n                            </div>\n                            <span className=\"text-slate-300 text-xs\">{currentYear}</span>\n                          </div>\n                        </th>,\n                        <th\n                          key={`${monthInfo.name}_${currentYear - 1}`}\n                          className=\"px-3 py-3 text-center font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[90px] cursor-pointer select-none text-white\"\n                          onClick={() => {\n                            const key = `${monthInfo.name}_${currentYear - 1}`;\n                            if (sortKey !== key) { setSortKey(key); setSortDir('desc'); }\n                            else setSortDir(d => d === 'desc' ? 'asc' : 'desc');\n                          }}\n                          title={`Sort by ${monthInfo.name} ${currentYear - 1} (${sortDir})`}\n                        >\n                          <div className=\"flex flex-col items-center\">\n                            <span className=\"text-xs font-bold whitespace-nowrap\">{monthInfo.name}</span>\n                            <span className=\"text-slate-300 text-xs\">{currentYear - 1}</span>\n                          </div>\n                        </th>\n                      ];\n                    })}\n                  </tr>\n                </thead>\n                <tbody>\n                  {processedData.map((row, index) => (\n                    <tr \n                      key={row.source}\n                      className=\"bg-white hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 border-b border-gray-200 transition-all duration-300 hover:shadow-lg animate-in slide-in-from-left-2 fade-in duration-300 cursor-pointer h-9 max-h-9\"\n                      onClick={() => {\n                        if (onDrillDown) {\n                          const filteredData = allData.filter(lead => lead.source === row.source);\n                          onDrillDown(`Source: ${row.source} - Year Analysis`, filteredData, 'year-source');\n                        }\n                      }}\n                    >\n                      <td className=\"px-6 py-2 text-left sticky left-0 bg-white border-r border-gray-200 z-10 transition-all duration-300 whitespace-nowrap overflow-hidden text-ellipsis\">\n                        <div className=\"flex items-center space-x-2\">\n                          <span className=\"text-slate-400 text-xs\">•</span>\n                          <span className=\"text-slate-700 font-medium text-xs\">{row.source}</span>\n                        </div>\n                      </td>\n                      {monthsForColumns.map((monthInfo) => {\n                        const currentYear = new Date().getFullYear();\n                        const currentValue = row[`${monthInfo.name}_${currentYear}`];\n                        const previousValue = row[`${monthInfo.name}_${currentYear - 1}`];\n                        \n                        return [\n                          <td \n                            key={`${monthInfo.name}_${currentYear}`}\n                            className=\"px-2 py-2 text-center text-sm font-mono text-slate-700 border-l border-gray-200 hover:bg-blue-100/60 cursor-pointer transition-all duration-200 whitespace-nowrap\"\n                          >\n                            <div className=\"space-y-1\">\n                              <div className=\"font-bold\">\n                                {viewMode === 'values' ? formatValue(currentValue, selectedMetric) : (\n                                  (() => {\n                                    let growth: number | null = null;\n                                    if (currentValue && previousValue && typeof currentValue === 'object' && typeof previousValue === 'object') {\n                                      const current = currentValue[selectedMetric];\n                                      const previous = previousValue[selectedMetric];\n                                      if (current !== undefined && previous !== undefined && previous !== 0) {\n                                        growth = ((current - previous) / previous) * 100;\n                                      }\n                                    }\n                                    if (growth === null) return '—';\n                                    return (\n                                      <span className={growth > 0 ? 'text-emerald-600' : growth < 0 ? 'text-red-500' : 'text-gray-500'}>\n                                        {growth > 0 ? '+' : ''}{growth.toFixed(1)}%\n                                      </span>\n                                    );\n                                  })()\n                                )}\n                              </div>\n                            </div>\n                          </td>,\n                          <td \n                            key={`${monthInfo.name}_${currentYear - 1}`}\n                            className=\"px-2 py-2 text-center text-sm font-mono text-slate-700 border-l border-gray-200 hover:bg-blue-100/60 cursor-pointer transition-all duration-200 whitespace-nowrap\"\n                          >\n                            <div className=\"space-y-1\">\n                              <div className=\"font-bold\">\n                                {viewMode === 'values' ? formatValue(previousValue, selectedMetric) : (\n                                  <span className=\"text-slate-400 text-xs\">—</span>\n                                )}\n                              </div>\n                            </div>\n                          </td>\n                        ];\n                      })}\n                    </tr>\n                  ))}\n                  \n                  {/* Totals Row */}\n                  <tr className=\"bg-slate-800 text-white font-bold border-t-2 border-slate-400\">\n                    <td className=\"px-6 py-3 text-left sticky left-0 bg-slate-800 border-r border-slate-400 z-20 cursor-pointer hover:underline whitespace-nowrap\">\n                      <div className=\"flex items-center space-x-2\">\n                        <Target className=\"w-4 h-4 text-cyan-400\" />\n                        <span className=\"text-cyan-100 font-bold text-sm\">TOTALS</span>\n                      </div>\n                    </td>\n                    {monthsForColumns.map((monthInfo) => {\n                      const currentYear = new Date().getFullYear();\n                      const currentTotal = totals[`${monthInfo.name}_${currentYear}`];\n                      const previousTotal = totals[`${monthInfo.name}_${currentYear - 1}`];\n                      \n                      return [\n                        <td \n                          key={`totals_${monthInfo.name}_${currentYear}`}\n                          className=\"px-2 py-2 text-center text-sm font-bold text-white border-l border-slate-400 hover:bg-slate-700 cursor-pointer transition-all duration-200\"\n                        >\n                          <div className=\"flex flex-col items-center space-y-0.5 min-h-6 justify-center\">\n                            <span className=\"font-mono text-xs whitespace-nowrap\">\n                              {formatValue(currentTotal, selectedMetric)}\n                            </span>\n                          </div>\n                        </td>,\n                        <td \n                          key={`totals_${monthInfo.name}_${currentYear - 1}`}\n                          className=\"px-2 py-2 text-center text-sm font-bold text-white border-l border-slate-400 hover:bg-slate-700 cursor-pointer transition-all duration-200\"\n                        >\n                          <div className=\"flex flex-col items-center space-y-0.5 min-h-6 justify-center\">\n                            <span className=\"font-mono text-xs whitespace-nowrap\">\n                              {formatValue(previousTotal, selectedMetric)}\n                            </span>\n                          </div>\n                        </td>\n                      ];\n                    })}\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n            \n            <div className=\"border-t border-slate-200 p-4 bg-slate-50 rounded-b-xl mt-2\">\n              {(() => {\n                const currentDate = new Date();\n                const currentYear = currentDate.getFullYear();\n                const recentMonthKey = monthsForColumns[monthsForColumns.length - 1]?.name;\n                if (!recentMonthKey) return <div className=\"text-xs text-slate-500\">No data available.</div>;\n                const currField = `${recentMonthKey}_${currentYear}`;\n                const prevField = `${recentMonthKey}_${currentYear - 1}`;\n                const withCurr = processedData.filter(r => r[currField]?.[selectedMetric] > 0);\n                if (!withCurr.length) return <div className=\"text-xs text-slate-500\">No notable points for the latest month.</div>;\n                const top = [...withCurr].sort((a,b) => (b[currField]?.[selectedMetric] || 0) - (a[currField]?.[selectedMetric] || 0))[0];\n                if (!top) return <div className=\"text-xs text-slate-500\">No data available.</div>;\n                const growth = (top[currField] && top[prevField] && top[prevField][selectedMetric]) ? ((top[currField][selectedMetric] - top[prevField][selectedMetric]) / top[prevField][selectedMetric]) * 100 : 0;\n                return (\n                  <ul className=\"list-disc pl-5 text-sm text-slate-600 space-y-1\">\n                    <li>Top source in {recentMonthKey} {currentYear}: <span className=\"font-semibold\">{top.source}</span></li>\n                    <li>{selectedMetric} YoY change: {growth > 0 ? '+' : ''}{growth.toFixed(1)}%</li>\n                  </ul>\n                );\n              })()}\n            </div>\n          </motion.div>\n          \n          <PersistentTableFooter\n            tableRef={tableRef}\n            filename=\"funnel-year-on-year-analysis\"\n            sheetName=\"Funnel YoY Analysis\"\n          />\n        </div>\n      </ModernTableWrapper>\n    </motion.div>\n  );\n};","import React, { useMemo, useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { TrendingUp, TrendingDown, Users, Target, AlertTriangle, Award, Crown, Trophy, Medal, Star, ArrowDownCircle, ThumbsDown, BarChart3 } from 'lucide-react';\nimport { formatNumber, formatCurrency } from '@/utils/formatters';\nimport { cn } from '@/lib/utils';\nimport { LeadsData } from '@/types/leads';\n\ninterface EnhancedFunnelRankingsProps {\n  data: LeadsData[];\n}\n\nexport const EnhancedFunnelRankings: React.FC<EnhancedFunnelRankingsProps> = ({ data }) => {\n  const [activeType, setActiveType] = useState<'source' | 'stage'>('source');\n  const [showMore, setShowMore] = useState(false);\n\n  const rankings = useMemo(() => {\n    if (!data || data.length === 0) return { sources: [], stages: [] };\n\n    // Source rankings\n    const sourceMap = new Map();\n    data.forEach(lead => {\n      const source = lead.source || 'Unknown';\n      if (!sourceMap.has(source)) {\n        sourceMap.set(source, {\n          name: source,\n          count: 0,\n          converted: 0,\n          revenue: 0,\n          conversionRate: 0\n        });\n      }\n\n      const sourceData = sourceMap.get(source);\n      sourceData.count += 1;\n      \n      if (lead.conversionStatus === 'Converted') {\n        sourceData.converted += 1;\n      }\n      \n      sourceData.revenue += (lead.ltv || 0);\n    });\n\n    const sources = Array.from(sourceMap.values()).map(source => ({\n      ...source,\n      conversionRate: source.count > 0 ? (source.converted / source.count) * 100 : 0,\n      avgRevenue: source.count > 0 ? source.revenue / source.count : 0\n    })).sort((a, b) => b.count - a.count);\n\n    // Stage rankings\n    const stageMap = new Map();\n    data.forEach(lead => {\n      const stage = lead.stage || 'Unknown';\n      if (!stageMap.has(stage)) {\n        stageMap.set(stage, {\n          name: stage,\n          count: 0,\n          converted: 0,\n          revenue: 0,\n          conversionRate: 0\n        });\n      }\n\n      const stageData = stageMap.get(stage);\n      stageData.count += 1;\n      \n      if (lead.conversionStatus === 'Converted') {\n        stageData.converted += 1;\n      }\n      \n      stageData.revenue += (lead.ltv || 0);\n    });\n\n    const stages = Array.from(stageMap.values()).map(stage => ({\n      ...stage,\n      conversionRate: stage.count > 0 ? (stage.converted / stage.count) * 100 : 0,\n      avgRevenue: stage.count > 0 ? stage.revenue / stage.count : 0,\n      percentage: stage.count > 0 ? (stage.count / data.length) * 100 : 0\n    })).sort((a, b) => b.count - a.count);\n\n    return { sources, stages };\n  }, [data]);\n\n  const totalLeads = data?.length || 0;\n  const displayCount = showMore ? 10 : 5;\n  const currentRankings = activeType === 'source' ? rankings.sources : rankings.stages;\n  const topItems = currentRankings.slice(0, displayCount);\n  const bottomItems = currentRankings.slice(-displayCount).reverse();\n\n  const getTypeConfig = (type: 'source' | 'stage') => {\n    if (type === 'source') {\n      return { icon: Users, label: 'Sources', description: 'Lead source performance' };\n    }\n    return { icon: Target, label: 'Stages', description: 'Funnel stage performance' };\n  };\n\n  const renderRankingCard = (items: any[], isTop: boolean, type: 'source' | 'stage') => {\n    const config = getTypeConfig(type);\n\n    return (\n      <Card className=\"bg-gradient-to-br from-white via-slate-50/50 to-white border-0 shadow-xl hover:shadow-2xl transition-all duration-500\">\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"flex items-center gap-3 text-xl\">\n            {isTop ? (\n              <>\n                <div className=\"p-2 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500\">\n                  <Award className=\"w-5 h-5 text-white\" />\n                </div>\n                <div>\n                  <span className=\"bg-gradient-to-r from-yellow-600 to-orange-600 bg-clip-text text-transparent\">\n                    Top {displayCount} {config.label}\n                  </span>\n                  <p className=\"text-sm text-slate-600 font-normal\">{config.description}</p>\n                </div>\n              </>\n            ) : (\n              <>\n                <div className=\"p-2 rounded-full bg-gradient-to-r from-red-500 to-rose-600\">\n                  <TrendingDown className=\"w-5 h-5 text-white\" />\n                </div>\n                <div>\n                  <span className=\"bg-gradient-to-r from-red-600 to-rose-600 bg-clip-text text-transparent\">\n                    Bottom {displayCount} {config.label}\n                  </span>\n                  <p className=\"text-sm text-slate-600 font-normal\">Areas for improvement</p>\n                </div>\n              </>\n            )}\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {items.map((item, index) => (\n            <div \n              key={item.name} \n              className={`group flex items-center justify-between p-4 rounded-xl bg-white shadow-sm border hover:shadow-md transition-all duration-300 ${isTop ? 'hover:border-emerald-200/70' : 'hover:border-rose-200/70'}`}\n            >\n              <div className=\"flex items-center gap-4 flex-1\">\n                <div className={cn(\n                  \"w-12 h-12 rounded-full flex items-center justify-center shadow-lg\",\n                  isTop \n                    ? 'bg-gradient-to-br from-yellow-400 via-amber-500 to-orange-500 text-white'\n                    : 'bg-gradient-to-br from-red-500 via-rose-600 to-red-700 text-white'\n                )}>\n                  {isTop ? (\n                    index === 0 ? <Crown className=\"w-6 h-6\" /> :\n                    index === 1 ? <Trophy className=\"w-6 h-6\" /> :\n                    index === 2 ? <Medal className=\"w-5 h-5\" /> :\n                    index === 3 ? <Star className=\"w-5 h-5\" /> :\n                    <span className=\"text-sm font-bold\">{index + 1}</span>\n                  ) : (\n                    index === 0 ? <ArrowDownCircle className=\"w-6 h-6\" /> :\n                    index === 1 ? <TrendingDown className=\"w-6 h-6\" /> :\n                    index === 2 ? <ThumbsDown className=\"w-5 h-5\" /> :\n                    <span className=\"text-sm font-bold\">{index + 1}</span>\n                  )}\n                </div>\n                <div className=\"flex-1\">\n                  <p className=\"font-semibold text-slate-900 whitespace-normal break-words group-hover:text-blue-600 transition-colors\">\n                    {item.name}\n                  </p>\n                  <div className=\"flex flex-wrap gap-2 mt-2\">\n                    <Badge variant=\"secondary\" className=\"text-xs bg-blue-50 text-blue-700 border-blue-200\">\n                      {formatNumber(item.count)} leads\n                    </Badge>\n                    <Badge variant=\"outline\" className=\"text-xs border-green-200 text-green-700\">\n                      {item.conversionRate.toFixed(1)}% conv.\n                    </Badge>\n                    <Badge variant=\"outline\" className=\"text-xs border-purple-200 text-purple-700\">\n                      Avg: {formatCurrency(item.avgRevenue)}\n                    </Badge>\n                    {type === 'stage' && (\n                      <Badge variant=\"outline\" className=\"text-xs border-orange-200 text-orange-700\">\n                        {item.percentage.toFixed(1)}% of funnel\n                      </Badge>\n                    )}\n                  </div>\n                </div>\n              </div>\n              <div className=\"text-right\">\n                <p className=\"font-bold text-xl text-slate-900 group-hover:text-blue-600 transition-colors\">\n                  {formatNumber(item.count)}\n                </p>\n                <p className=\"text-sm text-slate-500\">{formatNumber(item.converted)} converted</p>\n                <p className=\"text-xs text-slate-400\">{formatCurrency(item.revenue)} revenue</p>\n              </div>\n            </div>\n          ))}\n          \n          <div className=\"mt-6 p-4 bg-gradient-to-r from-slate-50 to-slate-100 rounded-lg border\">\n            <div className=\"flex justify-between items-center mb-2\">\n              <h4 className=\"font-semibold text-slate-800 flex items-center gap-2\">\n                <BarChart3 className=\"w-4 h-4\" />\n                Performance Summary\n              </h4>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setShowMore(!showMore)}\n                className=\"text-xs\"\n              >\n                Show {showMore ? 'Less' : 'More'}\n              </Button>\n            </div>\n            <ul className=\"text-sm text-slate-600 space-y-1\">\n              <li>• Average leads: {formatNumber(items.reduce((sum, s) => sum + s.count, 0) / items.length)}</li>\n              <li>• Total converted: {formatNumber(items.reduce((sum, s) => sum + s.converted, 0))}</li>\n              <li>• Combined revenue: {formatCurrency(items.reduce((sum, s) => sum + s.revenue, 0))}</li>\n              <li>• Performance spread: {((items[0]?.count / items[items.length - 1]?.count || 1) - 1).toFixed(1)}x variance</li>\n            </ul>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Enhanced Tab Navigation */}\n      <Card className=\"bg-gradient-to-br from-white via-slate-50/20 to-white border-0 shadow-xl\">\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"text-2xl font-bold bg-gradient-to-r from-slate-700 via-slate-800 to-slate-900 bg-clip-text text-transparent\">\n            Lead Performance Rankings\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Tabs value={activeType} onValueChange={(val) => setActiveType(val as 'source' | 'stage')} className=\"w-full\">\n            <TabsList className=\"bg-white/90 backdrop-blur-sm p-1.5 rounded-2xl shadow-xl border border-slate-200 w-full max-w-2xl mx-auto overflow-visible grid grid-cols-2 gap-0.5\">\n              <TabsTrigger \n                value=\"source\" \n                className=\"relative text-center px-3 py-3 font-semibold text-sm min-h-[60px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-700 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-10 data-[state=active]:scale-105 hover:bg-gray-50 rounded-lg transition-all duration-200 flex items-center justify-center gap-2\"\n              >\n                <Crown className=\"w-4 h-4 shrink-0\" />\n                <span className=\"text-sm leading-tight whitespace-nowrap\">Lead Sources</span>\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"stage\" \n                className=\"relative text-center px-3 py-3 font-semibold text-sm min-h-[60px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-700 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-10 data-[state=active]:scale-105 hover:bg-gray-50 rounded-lg transition-all duration-200 flex items-center justify-center gap-2\"\n              >\n                <Trophy className=\"w-4 h-4 shrink-0\" />\n                <span className=\"text-sm leading-tight whitespace-nowrap\">Funnel Stages</span>\n              </TabsTrigger>\n            </TabsList>\n\n            <TabsContent value={activeType} className=\"mt-6\">\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                {renderRankingCard(topItems, true, activeType)}\n                {renderRankingCard(bottomItems, false, activeType)}\n              </div>\n            </TabsContent>\n          </Tabs>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};","import React, { useMemo, useRef } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { HeartHandshake, TrendingUp, AlertCircle, CheckCircle, Star, Target } from 'lucide-react';\nimport { LeadsData } from '@/types/leads';\nimport { formatNumber, formatCurrency, formatPercentage } from '@/utils/formatters';\nimport { cn } from '@/lib/utils';\nimport { ModernTableWrapper } from './ModernTableWrapper';\nimport { PersistentTableFooter } from '@/components/dashboard/PersistentTableFooter';\nimport { useMetricsTablesRegistry } from '@/contexts/MetricsTablesRegistryContext';\n\ninterface FunnelHealthMetricsTableProps {\n  data: LeadsData[];\n}\n\nexport const FunnelHealthMetricsTable: React.FC<FunnelHealthMetricsTableProps> = ({ data }) => {\n  const tableRef = useRef<HTMLTableElement>(null);\n  const registry = useMetricsTablesRegistry();\n\n  // Register table for metrics\n  React.useEffect(() => {\n    if (tableRef.current) {\n      registry.registerTable('funnel-health-metrics', tableRef.current);\n    }\n    return () => registry.unregisterTable('funnel-health-metrics');\n  }, [registry]);\n  const healthMetrics = useMemo(() => {\n    if (!data.length) return [];\n\n    const totalLeads = data.length;\n    const trialsScheduled = data.filter(l => l.stage?.includes('Trial')).length;\n    const trialsCompleted = data.filter(l => l.stage === 'Trial Completed').length;\n    const converted = data.filter(l => l.conversionStatus === 'Converted').length;\n    const lost = data.filter(l => l.status === 'Lost').length;\n    const proximityIssues = data.filter(l => l.stage === 'Proximity Issues').length;\n    const followUps = data.filter(l => l.followUp1Date || l.followUp2Date || l.followUp3Date).length;\n    \n    const totalLTV = data.reduce((sum, l) => sum + (l.ltv || 0), 0);\n    const totalVisits = data.reduce((sum, l) => sum + (l.visits || 0), 0);\n\n    return [\n      {\n        metric: 'Lead Volume Health',\n        value: totalLeads,\n        benchmark: 1000,\n        status: totalLeads >= 1000 ? 'Excellent' : totalLeads >= 500 ? 'Good' : 'Needs Attention',\n        description: 'Total leads generated in period'\n      },\n      {\n        metric: 'Trial Scheduling Rate',\n        value: totalLeads > 0 ? (trialsScheduled / totalLeads) * 100 : 0,\n        benchmark: 60,\n        status: ((trialsScheduled / totalLeads) * 100) >= 60 ? 'Excellent' : ((trialsScheduled / totalLeads) * 100) >= 40 ? 'Good' : 'Needs Attention',\n        description: 'Percentage of leads scheduling trials'\n      },\n      {\n        metric: 'Trial Completion Rate',\n        value: trialsScheduled > 0 ? (trialsCompleted / trialsScheduled) * 100 : 0,\n        benchmark: 80,\n        status: ((trialsCompleted / trialsScheduled) * 100) >= 80 ? 'Excellent' : ((trialsCompleted / trialsScheduled) * 100) >= 60 ? 'Good' : 'Needs Attention',\n        description: 'Trials completed vs scheduled'\n      },\n      {\n        metric: 'Conversion Efficiency',\n        value: totalLeads > 0 ? (converted / totalLeads) * 100 : 0,\n        benchmark: 25,\n        status: ((converted / totalLeads) * 100) >= 25 ? 'Excellent' : ((converted / totalLeads) * 100) >= 15 ? 'Good' : 'Needs Attention',\n        description: 'Overall lead to member conversion'\n      },\n      {\n        metric: 'Proximity Issue Rate',\n        value: totalLeads > 0 ? (proximityIssues / totalLeads) * 100 : 0,\n        benchmark: 10,\n        status: ((proximityIssues / totalLeads) * 100) <= 10 ? 'Excellent' : ((proximityIssues / totalLeads) * 100) <= 20 ? 'Good' : 'Needs Attention',\n        description: 'Leads lost due to location issues'\n      },\n      {\n        metric: 'Follow-up Coverage',\n        value: totalLeads > 0 ? (followUps / totalLeads) * 100 : 0,\n        benchmark: 70,\n        status: ((followUps / totalLeads) * 100) >= 70 ? 'Excellent' : ((followUps / totalLeads) * 100) >= 50 ? 'Good' : 'Needs Attention',\n        description: 'Leads receiving follow-up actions'\n      },\n      {\n        metric: 'Average LTV',\n        value: totalLeads > 0 ? totalLTV / totalLeads : 0,\n        benchmark: 5000,\n        status: (totalLTV / totalLeads) >= 5000 ? 'Excellent' : (totalLTV / totalLeads) >= 3000 ? 'Good' : 'Needs Attention',\n        description: 'Revenue quality per lead'\n      },\n      {\n        metric: 'Engagement Level',\n        value: totalLeads > 0 ? totalVisits / totalLeads : 0,\n        benchmark: 3,\n        status: (totalVisits / totalLeads) >= 3 ? 'Excellent' : (totalVisits / totalLeads) >= 2 ? 'Good' : 'Needs Attention',\n        description: 'Average visits per lead'\n      }\n    ];\n  }, [data]);\n\n  const formatValue = (metric: any) => {\n    if (metric.metric.includes('Rate') || metric.metric.includes('Coverage') || metric.metric.includes('Efficiency')) {\n      return `${metric.value.toFixed(1)}%`;\n    } else if (metric.metric.includes('LTV')) {\n      return formatCurrency(metric.value);\n    } else if (metric.metric.includes('Volume')) {\n      return formatNumber(metric.value);\n    } else {\n      return metric.value.toFixed(1);\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'Excellent':\n        return <Badge className=\"w-24 justify-center bg-green-600 text-white hover:bg-green-700 font-bold\">Excellent</Badge>;\n      case 'Good':\n        return <Badge className=\"w-24 justify-center bg-yellow-500 text-white hover:bg-yellow-600 font-bold\">Good</Badge>;\n      default:\n        return <Badge className=\"w-24 justify-center bg-red-600 text-white hover:bg-red-700 font-bold\">Needs Fix</Badge>;\n    }\n  };\n\n  const columns = [\n    {\n      key: 'metric',\n      header: 'Health Metric',\n      render: (value: string) => (\n        <div className=\"font-semibold text-slate-700 min-w-[200px] text-left\">\n          {value}\n        </div>\n      ),\n      align: 'left' as const\n    },\n    {\n      key: 'value',\n      header: 'Current Value',\n      render: (value: number, item: any) => (\n        <div className=\"text-center font-medium text-slate-700\">\n          {formatValue(item)}\n        </div>\n      ),\n      align: 'center' as const\n    },\n    {\n      key: 'benchmark',\n      header: 'Benchmark',\n      render: (value: number, item: any) => (\n        <div className=\"text-center font-medium text-slate-700\">\n          {item.metric.includes('Rate') || item.metric.includes('Coverage') || item.metric.includes('Efficiency') \n            ? `${value}%` \n            : item.metric.includes('LTV') \n            ? formatCurrency(value)\n            : value.toLocaleString('en-IN')\n          }\n        </div>\n      ),\n      align: 'center' as const\n    },\n    {\n      key: 'status',\n      header: 'Status',\n      render: (value: string) => (\n        <div className=\"text-center\">\n          {getStatusBadge(value)}\n        </div>\n      ),\n      align: 'center' as const\n    },\n    {\n      key: 'description',\n      header: 'Description',\n      render: (value: string) => (\n        <div className=\"text-sm text-slate-700 max-w-[200px]\">\n          {value}\n        </div>\n      ),\n      align: 'left' as const\n    }\n  ];\n\n  const healthScore = useMemo(() => {\n    const scores = healthMetrics.map(metric => {\n      switch (metric.status) {\n        case 'Excellent': return 100;\n        case 'Good': return 70;\n        default: return 30;\n      }\n    });\n    return scores.length > 0 ? Math.round(scores.reduce((sum, score) => sum + score, 0) / scores.length) : 0;\n  }, [healthMetrics]);\n\n  return (\n    <ModernTableWrapper\n      title=\"Funnel Health Metrics\"\n      description=\"Key performance indicators for lead funnel health\"\n      icon={<HeartHandshake className=\"w-6 h-6 text-white\" />}\n      totalItems={healthMetrics.length}\n      className=\"animate-in slide-in-from-bottom-8 fade-in duration-1000\"\n      showCopyButton={true}\n      headerControls={\n        <div className=\"flex items-center gap-2\">\n          <span className=\"text-sm text-slate-300\">Overall Health:</span>\n          <Badge \n            className={cn(\n              \"text-lg px-4 py-2 font-black\",\n              healthScore >= 85 ? \"bg-green-600 text-white\" \n              : healthScore >= 70 ? \"bg-yellow-500 text-white\" \n              : \"bg-red-600 text-white\"\n            )}\n          >\n            {healthScore}%\n          </Badge>\n        </div>\n      }\n    >\n      <div className=\"overflow-x-auto\" data-table=\"funnel-health-metrics\">\n        <table ref={tableRef} className=\"min-w-full bg-white\">\n          <thead>\n            <tr className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n              <th className=\"px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide border-r border-white/20\">\n                <div className=\"flex items-center space-x-2\">\n                  <Star className=\"w-4 h-4 text-white\" />\n                  <span>Health Metric</span>\n                </div>\n              </th>\n              <th className=\"px-3 py-3 text-center font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[120px] text-white\">\n                Current Value\n              </th>\n              <th className=\"px-3 py-3 text-center font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[120px] text-white\">\n                Benchmark\n              </th>\n              <th className=\"px-3 py-3 text-center font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[120px] text-white\">\n                Status\n              </th>\n              <th className=\"px-3 py-3 text-left font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[200px] text-white\">\n                Description\n              </th>\n            </tr>\n          </thead>\n          <tbody>\n            {healthMetrics.map((metric, index) => (\n              <tr \n                key={metric.metric}\n                className=\"bg-white hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 border-b border-gray-200 transition-all duration-300 hover:shadow-lg h-9 max-h-9\"\n              >\n                <td className=\"px-6 py-2 text-left bg-white border-r border-gray-200 transition-all duration-300 whitespace-nowrap overflow-hidden text-ellipsis\">\n                  <div className=\"flex items-center space-x-2\">\n                    <span className=\"text-slate-400 text-xs\">•</span>\n                    <span className=\"text-slate-700 font-semibold text-xs\">{metric.metric}</span>\n                  </div>\n                </td>\n                <td className=\"px-2 py-2 text-center text-sm font-mono text-slate-700 border-l border-gray-200 whitespace-nowrap\">\n                  <span className=\"font-bold text-xs\">{formatValue(metric)}</span>\n                </td>\n                <td className=\"px-2 py-2 text-center text-sm font-mono text-slate-700 border-l border-gray-200 whitespace-nowrap\">\n                  <span className=\"font-medium text-xs\">\n                    {metric.metric.includes('Rate') || metric.metric.includes('Coverage') || metric.metric.includes('Efficiency') \n                      ? `${metric.benchmark}%` \n                      : metric.metric.includes('LTV') \n                        ? formatCurrency(metric.benchmark) \n                        : formatNumber(metric.benchmark)\n                    }\n                  </span>\n                </td>\n                <td className=\"px-2 py-2 text-center border-l border-gray-200 whitespace-nowrap\">\n                  {getStatusBadge(metric.status)}\n                </td>\n                <td className=\"px-3 py-2 text-left text-xs text-slate-600 border-l border-gray-200 whitespace-nowrap overflow-hidden text-ellipsis\">\n                  {metric.description}\n                </td>\n              </tr>\n            ))}\n            \n            {/* Summary Row */}\n            <tr className=\"bg-slate-800 text-white font-bold border-t-2 border-slate-400\">\n              <td className=\"px-6 py-3 text-left bg-slate-800 border-r border-slate-400 whitespace-nowrap\">\n                <div className=\"flex items-center space-x-2\">\n                  <Target className=\"w-4 h-4 text-cyan-400\" />\n                  <span className=\"text-cyan-100 font-bold text-sm\">OVERALL HEALTH</span>\n                </div>\n              </td>\n              <td className=\"px-2 py-2 text-center text-sm font-bold text-white border-l border-slate-400\">\n                <span className=\"font-mono text-xs\">{healthScore}%</span>\n              </td>\n              <td className=\"px-2 py-2 text-center text-sm font-bold text-white border-l border-slate-400\">\n                <span className=\"font-mono text-xs\">85%</span>\n              </td>\n              <td className=\"px-2 py-2 text-center border-l border-slate-400\">\n                <Badge \n                  className={cn(\n                    \"text-xs px-2 py-1 font-bold\",\n                    healthScore >= 85 ? \"bg-green-600 text-white\" \n                    : healthScore >= 70 ? \"bg-yellow-500 text-white\" \n                    : \"bg-red-600 text-white\"\n                  )}\n                >\n                  {healthScore >= 85 ? 'Excellent' : healthScore >= 70 ? 'Good' : 'Needs Attention'}\n                </Badge>\n              </td>\n              <td className=\"px-3 py-2 text-left text-xs text-slate-300 border-l border-slate-400\">\n                Composite funnel health score\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n\n      {/* Health Summary */}\n      <div className=\"p-6 bg-slate-50 border-t mt-4 rounded-b-xl\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <CheckCircle className=\"w-5 h-5 text-green-600\" />\n          <h3 className=\"font-semibold text-slate-800\">Health Assessment</h3>\n        </div>\n        \n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          <div className=\"p-4 bg-green-50 rounded-lg border border-green-200\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <CheckCircle className=\"w-4 h-4 text-green-600\" />\n              <span className=\"font-semibold text-green-800\">Strengths</span>\n            </div>\n            <div className=\"text-sm text-green-600\">\n              {healthMetrics.filter(m => m.status === 'Excellent').length} metrics excellent\n            </div>\n          </div>\n          \n          <div className=\"p-4 bg-yellow-50 rounded-lg border border-yellow-200\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <TrendingUp className=\"w-4 h-4 text-yellow-600\" />\n              <span className=\"font-semibold text-yellow-800\">Opportunities</span>\n            </div>\n            <div className=\"text-sm text-yellow-600\">\n              {healthMetrics.filter(m => m.status === 'Good').length} metrics good\n            </div>\n          </div>\n          \n          <div className=\"p-4 bg-red-50 rounded-lg border border-red-200\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <AlertCircle className=\"w-4 h-4 text-red-600\" />\n              <span className=\"font-semibold text-red-800\">Action Needed</span>\n            </div>\n            <div className=\"text-sm text-red-600\">\n              {healthMetrics.filter(m => m.status === 'Needs Attention').length} metrics need attention\n            </div>\n          </div>\n        </div>\n\n        <div className=\"mt-4 p-3 bg-white rounded-lg border\">\n          <h4 className=\"font-semibold text-slate-800 mb-2\">Quick Recommendations:</h4>\n          <ul className=\"text-sm text-slate-600 space-y-1\">\n            {healthScore < 70 && <li>• Focus on improving trial completion rates</li>}\n            {healthMetrics.find(m => m.metric === 'Proximity Issue Rate' && m.status === 'Needs Attention') && \n              <li>• Address location accessibility concerns</li>}\n            {healthMetrics.find(m => m.metric === 'Follow-up Coverage' && m.status === 'Needs Attention') && \n              <li>• Implement systematic follow-up processes</li>}\n            {healthScore >= 85 && <li>• Excellent funnel health - maintain current strategies</li>}\n          </ul>\n        </div>\n      </div>\n\n      <PersistentTableFooter\n        tableRef={tableRef}\n        filename=\"funnel-health-metrics\"\n        sheetName=\"Health Metrics\"\n      />\n    </ModernTableWrapper>\n  );\n};\n","import React, { useState, useMemo, useRef } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { \n  Target, \n  Clock, \n  DollarSign, \n  Activity, \n  MapPin, \n  AlertTriangle,\n  BarChart3,\n  Star,\n  Users\n} from 'lucide-react';\nimport { LeadsData } from '@/types/leads';\nimport { formatNumber, formatCurrency } from '@/utils/formatters';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { useMetricsTablesRegistry } from '@/contexts/MetricsTablesRegistryContext';\nimport CopyTableButton from '@/components/ui/CopyTableButton';\n\ninterface FunnelAnalyticsTablesProps {\n  data: LeadsData[];\n  onDrillDown?: (title: string, data: LeadsData[], type: string) => void;\n}\n\nexport const FunnelAnalyticsTables: React.FC<FunnelAnalyticsTablesProps> = ({\n  data,\n  onDrillDown\n}) => {\n  const [sortConfig, setSortConfig] = useState<{\n    key: string;\n    direction: 'asc' | 'desc';\n    table: string;\n  }>({\n    key: 'totalLeads',\n    direction: 'desc',\n    table: 'source'\n  });\n\n  const sourceTableRef = useRef<HTMLTableElement>(null);\n  const stageTableRef = useRef<HTMLTableElement>(null);\n  const spanTableRef = useRef<HTMLTableElement>(null);\n  const ltvTableRef = useRef<HTMLTableElement>(null);\n  const topStagesTableRef = useRef<HTMLTableElement>(null);\n  const proximityTableRef = useRef<HTMLTableElement>(null);\n  const registry = useMetricsTablesRegistry();\n\n  // Handle sorting\n  const handleSort = (key: string, table: string) => {\n    setSortConfig(prevConfig => ({\n      key,\n      table,\n      direction: prevConfig.key === key && prevConfig.table === table && prevConfig.direction === 'desc' ? 'asc' : 'desc'\n    }));\n  };\n\n  // Sort data based on configuration\n  const sortData = (data: any[], table: string) => {\n    if (sortConfig.table !== table) return data;\n    \n    return [...data].sort((a, b) => {\n      const aVal = a[sortConfig.key];\n      const bVal = b[sortConfig.key];\n      \n      if (typeof aVal === 'string' && typeof bVal === 'string') {\n        return sortConfig.direction === 'desc' \n          ? bVal.localeCompare(aVal)\n          : aVal.localeCompare(bVal);\n      }\n      \n      return sortConfig.direction === 'desc' ? bVal - aVal : aVal - bVal;\n    });\n  };\n\n  // Handle row click for drill down\n  const handleRowClick = (type: string, row: any) => {\n    if (onDrillDown) {\n      let filteredData: LeadsData[] = [];\n      let title = '';\n\n      switch (type) {\n        case 'source':\n          filteredData = data.filter(lead => (lead.source || 'Unknown') === row.source);\n          title = `${row.source} - Source Analysis`;\n          break;\n        case 'stage':\n          filteredData = data.filter(lead => (lead.stage || 'Unknown') === row.stage);\n          title = `${row.stage} - Stage Analysis`;\n          break;\n        case 'ltv':\n          title = `${row.ltvRange} - LTV Analysis`;\n          break;\n        case 'proximity':\n          filteredData = data.filter(lead => lead.stage?.includes('Proximity'));\n          title = `Proximity Issues - ${row.location}`;\n          break;\n        default:\n          return;\n      }\n\n      onDrillDown(title, filteredData, type);\n    }\n  };\n\n  // Register tables for metrics\n  React.useEffect(() => {\n    if (sourceTableRef.current) {\n      registry.registerTable('funnel-source-analytics', sourceTableRef.current);\n    }\n    if (stageTableRef.current) {\n      registry.registerTable('funnel-stage-analytics', stageTableRef.current);\n    }\n    return () => {\n      registry.unregisterTable('funnel-source-analytics');\n      registry.unregisterTable('funnel-stage-analytics');\n    };\n  }, [registry]);\n\n  // Conversion by Source Analytics\n  const conversionBySource = useMemo(() => {\n    const sourceStats = data.reduce((acc, lead) => {\n      const source = lead.source || 'Unknown';\n      if (!acc[source]) {\n        acc[source] = {\n          totalLeads: 0,\n          trialsScheduled: 0,\n          trialsCompleted: 0,\n          converted: 0,\n          totalLTV: 0,\n          totalVisits: 0,\n          proximityIssues: 0\n        };\n      }\n      \n      acc[source].totalLeads += 1;\n      const ts = (lead.trialStatus || '').toLowerCase();\n      const st = (lead.stage || '').toLowerCase();\n      if ((ts.includes('trial') && !ts.includes('completed')) || (st.includes('trial') && !st.includes('completed'))) acc[source].trialsScheduled += 1;\n      if (lead.trialStatus === 'Trial Completed' || lead.stage === 'Trial Completed') acc[source].trialsCompleted += 1;\n      if (lead.conversionStatus === 'Converted') acc[source].converted += 1;\n      if (lead.stage?.includes('Proximity')) acc[source].proximityIssues += 1;\n      acc[source].totalLTV += lead.ltv || 0;\n      acc[source].totalVisits += lead.visits || 0;\n      \n      return acc;\n    }, {} as Record<string, any>);\n\n    return Object.entries(sourceStats).map(([source, stats]) => ({\n      source,\n      totalLeads: stats.totalLeads,\n      trialsScheduled: stats.trialsScheduled,\n      trialsCompleted: stats.trialsCompleted,\n      converted: stats.converted,\n      conversionRate: stats.totalLeads > 0 ? (stats.converted / stats.totalLeads) * 100 : 0,\n      trialToMemberRate: stats.trialsCompleted > 0 ? (stats.converted / stats.trialsCompleted) * 100 : 0,\n      avgLTV: stats.totalLeads > 0 ? stats.totalLTV / stats.totalLeads : 0,\n      avgVisits: stats.totalLeads > 0 ? stats.totalVisits / stats.totalLeads : 0,\n      proximityIssues: stats.proximityIssues,\n      leadQuality: ((stats.converted * 0.4) + (stats.trialsCompleted * 0.3) + ((stats.totalLeads - stats.proximityIssues) * 0.3)) / stats.totalLeads * 100\n    })).sort((a, b) => b.totalLeads - a.totalLeads);\n  }, [data]);\n\n  // Conversion by Stage Analytics\n  const conversionByStage = useMemo(() => {\n    const stageStats = data.reduce((acc, lead) => {\n      const stage = lead.stage || 'Unknown';\n      if (!acc[stage]) {\n        acc[stage] = {\n          totalLeads: 0,\n          converted: 0,\n          totalLTV: 0,\n          avgDaysInStage: 0,\n          retained: 0\n        };\n      }\n      \n      acc[stage].totalLeads += 1;\n      if (lead.conversionStatus === 'Converted') acc[stage].converted += 1;\n      if (lead.retentionStatus === 'Retained') acc[stage].retained += 1;\n      acc[stage].totalLTV += lead.ltv || 0;\n      \n      return acc;\n    }, {} as Record<string, any>);\n\n    return Object.entries(stageStats).map(([stage, stats]) => ({\n      stage,\n      totalLeads: stats.totalLeads,\n      converted: stats.converted,\n      conversionRate: stats.totalLeads > 0 ? (stats.converted / stats.totalLeads) * 100 : 0,\n      retentionRate: stats.totalLeads > 0 ? (stats.retained / stats.totalLeads) * 100 : 0,\n      avgLTV: stats.totalLeads > 0 ? stats.totalLTV / stats.totalLeads : 0,\n      stageEfficiency: ((stats.converted * 0.5) + (stats.retained * 0.3) + (stats.totalLeads * 0.2)) / stats.totalLeads * 100\n    })).sort((a, b) => b.totalLeads - a.totalLeads);\n  }, [data]);\n\n  // Conversion Span Analytics\n  const conversionSpanAnalytics = useMemo(() => {\n    const spanRanges = [\n      { label: '0-7 days', min: 0, max: 7 },\n      { label: '8-14 days', min: 8, max: 14 },\n      { label: '15-30 days', min: 15, max: 30 },\n      { label: '31-60 days', min: 31, max: 60 },\n      { label: '60+ days', min: 61, max: Infinity }\n    ];\n\n    return spanRanges.map(range => {\n      const leadsInRange = data.filter(lead => {\n        if (!lead.createdAt || !lead.convertedToCustomerAt) return false;\n        const created = new Date(lead.createdAt);\n        const converted = new Date(lead.convertedToCustomerAt);\n        const daysDiff = Math.ceil((converted.getTime() - created.getTime()) / (1000 * 60 * 60 * 24));\n        return daysDiff >= range.min && daysDiff <= range.max;\n      });\n\n      const convertedInRange = leadsInRange.filter(lead => lead.conversionStatus === 'Converted');\n      \n      return {\n        timeRange: range.label,\n        totalLeads: leadsInRange.length,\n        converted: convertedInRange.length,\n        conversionRate: leadsInRange.length > 0 ? (convertedInRange.length / leadsInRange.length) * 100 : 0,\n        avgLTV: convertedInRange.length > 0 ? convertedInRange.reduce((sum, lead) => sum + (lead.ltv || 0), 0) / convertedInRange.length : 0,\n        efficiency: leadsInRange.length > 0 ? ((convertedInRange.length * 0.6) + (leadsInRange.length * 0.4)) / leadsInRange.length * 100 : 0\n      };\n    });\n  }, [data]);\n\n  // LTV Analytics\n  const ltvAnalytics = useMemo(() => {\n    const ltvRanges = [\n      { label: '₹0', min: 0, max: 0 },\n      { label: '₹1-5k', min: 1, max: 5000 },\n      { label: '₹5k-15k', min: 5001, max: 15000 },\n      { label: '₹15k-30k', min: 15001, max: 30000 },\n      { label: '₹30k+', min: 30001, max: Infinity }\n    ];\n\n    return ltvRanges.map(range => {\n      const leadsInRange = data.filter(lead => {\n        const ltv = lead.ltv || 0;\n        return ltv >= range.min && ltv <= range.max;\n      });\n\n      const convertedInRange = leadsInRange.filter(lead => lead.conversionStatus === 'Converted');\n      \n      return {\n        ltvRange: range.label,\n        totalLeads: leadsInRange.length,\n        converted: convertedInRange.length,\n        conversionRate: leadsInRange.length > 0 ? (convertedInRange.length / leadsInRange.length) * 100 : 0,\n        avgVisits: leadsInRange.length > 0 ? leadsInRange.reduce((sum, lead) => sum + (lead.visits || 0), 0) / leadsInRange.length : 0,\n        totalRevenue: leadsInRange.reduce((sum, lead) => sum + (lead.ltv || 0), 0),\n        valueScore: convertedInRange.length > 0 ? (convertedInRange.reduce((sum, lead) => sum + (lead.ltv || 0), 0) / convertedInRange.length) * (convertedInRange.length / leadsInRange.length) : 0\n      };\n    });\n  }, [data]);\n\n  // Most Common Stage Analytics\n  const mostCommonStages = useMemo(() => {\n    const total = data.length || 1;\n    const stageCounts = data.reduce((acc, lead) => {\n      const key = lead.stage || 'Unknown';\n      if (!acc[key]) {\n        acc[key] = { count: 0, converted: 0, totalLTV: 0 };\n      }\n      acc[key].count += 1;\n      if (lead.conversionStatus === 'Converted') acc[key].converted += 1;\n      acc[key].totalLTV += lead.ltv || 0;\n      return acc;\n    }, {} as Record<string, { count: number; converted: number; totalLTV: number }>);\n\n    return Object.entries(stageCounts)\n      .map(([stage, stats]) => ({\n        stage,\n        leadCount: stats.count,\n        percentage: (stats.count / total) * 100,\n        converted: stats.converted,\n        conversionRate: stats.count > 0 ? (stats.converted / stats.count) * 100 : 0,\n        avgLTV: stats.count > 0 ? stats.totalLTV / stats.count : 0,\n        stagePopularity: (stats.count / total) * 100\n      }))\n      .sort((a, b) => b.leadCount - a.leadCount)\n      .slice(0, 10); // Top 10 stages\n  }, [data]);\n\n  // Proximity Issue Analytics\n  const proximityAnalytics = useMemo(() => {\n    const locationStats = data.reduce((acc, lead) => {\n      const location = lead.center || 'Unknown';\n      if (!acc[location]) {\n        acc[location] = {\n          totalLeads: 0,\n          proximityIssues: 0\n        };\n      }\n      acc[location].totalLeads += 1;\n      if (lead.stage?.includes('Proximity')) acc[location].proximityIssues += 1;\n      return acc;\n    }, {} as Record<string, { totalLeads: number; proximityIssues: number }>);\n\n    return Object.entries(locationStats).map(([location, stats]) => ({\n      location,\n      totalLeads: stats.totalLeads,\n      proximityIssues: stats.proximityIssues,\n      proximityRate: stats.totalLeads > 0 ? (stats.proximityIssues / stats.totalLeads) * 100 : 0,\n      impactScore: stats.proximityIssues * (stats.proximityIssues / stats.totalLeads) * 100\n    })).sort((a, b) => b.totalLeads - a.totalLeads);\n  }, [data]);\n\n  // Apply sorting to data\n  const sortedSourceData = useMemo(() => sortData(conversionBySource, 'source'), [conversionBySource, sortConfig]);\n  const sortedStageData = useMemo(() => sortData(conversionByStage, 'stage'), [conversionByStage, sortConfig]);\n  const sortedTimespanData = useMemo(() => sortData(conversionSpanAnalytics, 'timespan'), [conversionSpanAnalytics, sortConfig]);\n  const sortedLtvData = useMemo(() => sortData(ltvAnalytics, 'ltv'), [ltvAnalytics, sortConfig]);\n  const sortedTopStagesData = useMemo(() => sortData(mostCommonStages, 'topstages'), [mostCommonStages, sortConfig]);\n  const sortedProximityData = useMemo(() => sortData(proximityAnalytics, 'proximity'), [proximityAnalytics, sortConfig]);\n\n  return (\n    <div className=\"space-y-6\">\n      <Tabs defaultValue=\"source\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-6 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 p-1 rounded-lg border border-slate-600\">\n          <TabsTrigger value=\"source\" className=\"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-300 hover:text-white hover:bg-slate-600/50 data-[state=active]:bg-gradient-to-r data-[state=active]:from-slate-900 data-[state=active]:to-slate-800 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border data-[state=active]:border-slate-500\">\n            <Target className=\"w-4 h-4 mr-2\" />\n            Source\n          </TabsTrigger>\n          <TabsTrigger value=\"stage\" className=\"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-300 hover:text-white hover:bg-slate-600/50 data-[state=active]:bg-gradient-to-r data-[state=active]:from-slate-900 data-[state=active]:to-slate-800 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border data-[state=active]:border-slate-500\">\n            <Activity className=\"w-4 h-4 mr-2\" />\n            Stage\n          </TabsTrigger>\n          <TabsTrigger value=\"timespan\" className=\"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-300 hover:text-white hover:bg-slate-600/50 data-[state=active]:bg-gradient-to-r data-[state=active]:from-slate-900 data-[state=active]:to-slate-800 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border data-[state=active]:border-slate-500\">\n            <Clock className=\"w-4 h-4 mr-2\" />\n            Time Span\n          </TabsTrigger>\n          <TabsTrigger value=\"ltv\" className=\"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-300 hover:text-white hover:bg-slate-600/50 data-[state=active]:bg-gradient-to-r data-[state=active]:from-slate-900 data-[state=active]:to-slate-800 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border data-[state=active]:border-slate-500\">\n            <DollarSign className=\"w-4 h-4 mr-2\" />\n            LTV\n          </TabsTrigger>\n          <TabsTrigger value=\"topstages\" className=\"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-300 hover:text-white hover:bg-slate-600/50 data-[state=active]:bg-gradient-to-r data-[state=active]:from-slate-900 data-[state=active]:to-slate-800 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border data-[state=active]:border-slate-500\">\n            <BarChart3 className=\"w-4 h-4 mr-2\" />\n            Top Stages\n          </TabsTrigger>\n          <TabsTrigger value=\"proximity\" className=\"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-300 hover:text-white hover:bg-slate-600/50 data-[state=active]:bg-gradient-to-r data-[state=active]:from-slate-900 data-[state=active]:to-slate-800 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border data-[state=active]:border-slate-500\">\n            <MapPin className=\"w-4 h-4 mr-2\" />\n            Proximity\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"source\" className=\"mt-6\">\n          <Card className=\"bg-white/95 backdrop-blur-sm border-0 shadow-xl relative\">\n            <CardHeader className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"text-white flex items-center gap-2 text-lg font-bold\">\n                  <Target className=\"w-5 h-5\" />\n                  Conversion by Source\n                </CardTitle>\n                <CopyTableButton \n                  tableRef={sourceTableRef}\n                  tableName=\"Conversion by Source\"\n                  size=\"sm\"\n                  className=\"text-white hover:bg-white/20\"\n                />\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              <div className=\"overflow-x-auto\" data-table=\"funnel-source-analytics\">\n                <table ref={sourceTableRef} className=\"min-w-full bg-white\">\n                  <thead>\n                    <tr className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n                      <th className=\"px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide h-9 max-h-9 sticky left-0 z-40 border-r border-white/20\">\n                        <div className=\"flex items-center space-x-2\">\n                          <Star className=\"w-4 h-4 text-white\" />\n                          <span>Source</span>\n                        </div>\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px] cursor-pointer select-none\"\n                          onClick={() => handleSort('totalLeads', 'source')}\n                          title=\"Sort by Total Leads\">\n                        Total Leads\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px] cursor-pointer select-none\"\n                          onClick={() => handleSort('converted', 'source')}\n                          title=\"Sort by Converted\">\n                        Converted\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px] cursor-pointer select-none\"\n                          onClick={() => handleSort('conversionRate', 'source')}\n                          title=\"Sort by Conversion Rate\">\n                        Conv. Rate\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px] cursor-pointer select-none\"\n                          onClick={() => handleSort('avgLTV', 'source')}\n                          title=\"Sort by Average LTV\">\n                        Avg LTV\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px] cursor-pointer select-none\"\n                          onClick={() => handleSort('leadQuality', 'source')}\n                          title=\"Sort by Quality Score\">\n                        Quality Score\n                      </th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-gray-200\">\n                    {sortedSourceData.map((row, index) => (\n                      <tr\n                        key={row.source}\n                        className=\"hover:bg-gray-50 cursor-pointer h-9 max-h-9\"\n                        onClick={() => handleRowClick('source', row)}\n                      >\n                        <td className=\"px-6 py-2 font-semibold text-gray-800 h-9 max-h-9 sticky left-0 z-30 bg-white border-r border-gray-200\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {row.source}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {formatNumber(row.totalLeads)}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {formatNumber(row.converted)}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {row.conversionRate.toFixed(1)}%\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {formatCurrency(row.avgLTV)}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {row.leadQuality.toFixed(1)}\n                          </div>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                  <tfoot className=\"bg-gray-50 border-t-2 border-gray-300\">\n                    <tr className=\"font-bold h-9 max-h-9\">\n                      <td className=\"px-6 py-2 text-gray-800 h-9 max-h-9 sticky left-0 z-30 bg-gray-50 border-r border-gray-300\">\n                        <div className=\"whitespace-nowrap overflow-hidden text-ellipsis flex items-center space-x-2\">\n                          <Star className=\"w-4 h-4\" />\n                          <span>TOTALS</span>\n                        </div>\n                      </td>\n                      <td className=\"px-3 py-2 text-center text-gray-800 h-9 max-h-9\">\n                        <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                          {formatNumber(sortedSourceData.reduce((sum, row) => sum + row.totalLeads, 0))}\n                        </div>\n                      </td>\n                      <td className=\"px-3 py-2 text-center text-gray-800 h-9 max-h-9\">\n                        <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                          {formatNumber(sortedSourceData.reduce((sum, row) => sum + row.converted, 0))}\n                        </div>\n                      </td>\n                      <td className=\"px-3 py-2 text-center text-gray-800 h-9 max-h-9\">\n                        <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                          {sortedSourceData.length > 0 ? \n                            ((sortedSourceData.reduce((sum, row) => sum + row.converted, 0) / \n                              sortedSourceData.reduce((sum, row) => sum + row.totalLeads, 0)) * 100).toFixed(1) : '0.0'}%\n                        </div>\n                      </td>\n                      <td className=\"px-3 py-2 text-center text-gray-800 h-9 max-h-9\">\n                        <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                          {formatCurrency(sortedSourceData.length > 0 ? \n                            (sortedSourceData.reduce((sum, row) => sum + row.avgLTV * row.totalLeads, 0) / \n                             sortedSourceData.reduce((sum, row) => sum + row.totalLeads, 0)) : 0)}\n                        </div>\n                      </td>\n                      <td className=\"px-3 py-2 text-center text-gray-800 h-9 max-h-9\">\n                        <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                          {sortedSourceData.length > 0 ? \n                            (sortedSourceData.reduce((sum, row) => sum + row.leadQuality * row.totalLeads, 0) / \n                             sortedSourceData.reduce((sum, row) => sum + row.totalLeads, 0)).toFixed(1) : '0.0'}\n                        </div>\n                      </td>\n                    </tr>\n                  </tfoot>\n                </table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"stage\" className=\"mt-6\">\n          <Card className=\"bg-white/95 backdrop-blur-sm border-0 shadow-xl relative\">\n            <CardHeader className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"text-white flex items-center gap-2 text-lg font-bold\">\n                  <Activity className=\"w-5 h-5\" />\n                  Conversion by Stage\n                </CardTitle>\n                <CopyTableButton \n                  tableRef={stageTableRef}\n                  tableName=\"Conversion by Stage\"\n                  size=\"sm\"\n                  className=\"text-white hover:bg-white/20\"\n                />\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              <div className=\"overflow-x-auto\" data-table=\"funnel-stage-analytics\">\n                <table ref={stageTableRef} className=\"min-w-full bg-white\">\n                  <thead>\n                    <tr className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n                      <th className=\"px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide h-9 max-h-9 sticky left-0 z-40 border-r border-white/20\">\n                        <div className=\"flex items-center space-x-2\">\n                          <Star className=\"w-4 h-4 text-white\" />\n                          <span>Stage</span>\n                        </div>\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Total Leads\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Converted\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Conv. Rate\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Avg LTV\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Efficiency\n                      </th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-gray-200\">\n                    {sortedStageData.map((row, index) => (\n                      <tr\n                        key={row.stage}\n                        className=\"hover:bg-gray-50 cursor-pointer h-9 max-h-9\"\n                        onClick={() => handleRowClick('stage', row)}\n                      >\n                        <td className=\"px-6 py-2 font-semibold text-gray-800 h-9 max-h-9 sticky left-0 z-30 bg-white border-r border-gray-200\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {row.stage}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {formatNumber(row.totalLeads)}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {formatNumber(row.converted)}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {row.conversionRate.toFixed(1)}%\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {formatCurrency(row.avgLTV)}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {row.stageEfficiency.toFixed(1)}\n                          </div>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                  <tfoot className=\"bg-gray-50 border-t-2 border-gray-300\">\n                    <tr className=\"font-bold h-9 max-h-9\">\n                      <td className=\"px-6 py-2 text-gray-800 h-9 max-h-9 sticky left-0 z-30 bg-gray-50 border-r border-gray-300\">\n                        <div className=\"whitespace-nowrap overflow-hidden text-ellipsis flex items-center space-x-2\">\n                          <Star className=\"w-4 h-4\" />\n                          <span>TOTALS</span>\n                        </div>\n                      </td>\n                      <td className=\"px-3 py-2 text-center text-gray-800 h-9 max-h-9\">\n                        <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                          {formatNumber(sortedStageData.reduce((sum, row) => sum + row.totalLeads, 0))}\n                        </div>\n                      </td>\n                      <td className=\"px-3 py-2 text-center text-gray-800 h-9 max-h-9\">\n                        <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                          {formatNumber(sortedStageData.reduce((sum, row) => sum + row.converted, 0))}\n                        </div>\n                      </td>\n                      <td className=\"px-3 py-2 text-center text-gray-800 h-9 max-h-9\">\n                        <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                          {sortedStageData.length > 0 ? \n                            ((sortedStageData.reduce((sum, row) => sum + row.converted, 0) / \n                              sortedStageData.reduce((sum, row) => sum + row.totalLeads, 0)) * 100).toFixed(1) : '0.0'}%\n                        </div>\n                      </td>\n                      <td className=\"px-3 py-2 text-center text-gray-800 h-9 max-h-9\">\n                        <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                          {formatCurrency(sortedStageData.length > 0 ? \n                            (sortedStageData.reduce((sum, row) => sum + row.avgLTV * row.totalLeads, 0) / \n                             sortedStageData.reduce((sum, row) => sum + row.totalLeads, 0)) : 0)}\n                        </div>\n                      </td>\n                      <td className=\"px-3 py-2 text-center text-gray-800 h-9 max-h-9\">\n                        <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                          {sortedStageData.length > 0 ? \n                            (sortedStageData.reduce((sum, row) => sum + row.stageEfficiency * row.totalLeads, 0) / \n                             sortedStageData.reduce((sum, row) => sum + row.totalLeads, 0)).toFixed(1) : '0.0'}\n                        </div>\n                      </td>\n                    </tr>\n                  </tfoot>\n                </table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"timespan\" className=\"mt-6\">\n          <Card className=\"bg-white/95 backdrop-blur-sm border-0 shadow-xl relative\">\n            <CardHeader className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"text-white flex items-center gap-2 text-lg font-bold\">\n                  <Clock className=\"w-5 h-5\" />\n                  Conversion by Time Span\n                </CardTitle>\n                <CopyTableButton \n                  tableRef={spanTableRef}\n                  tableName=\"Conversion by Time Span\"\n                  size=\"sm\"\n                  className=\"text-white hover:bg-white/20\"\n                />\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              <div className=\"overflow-x-auto\" data-table=\"funnel-timespan-analytics\">\n                <table ref={spanTableRef} className=\"min-w-full bg-white\">\n                  <thead>\n                    <tr className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n                      <th className=\"px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide h-9 max-h-9 sticky left-0 z-40 border-r border-white/20\">\n                        <div className=\"flex items-center space-x-2\">\n                          <Star className=\"w-4 h-4 text-white\" />\n                          <span>Time Range</span>\n                        </div>\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Total Leads\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Converted\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Conv. Rate\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Avg LTV\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Efficiency\n                      </th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-gray-200\">\n                    {sortedTimespanData.map((row, index) => (\n                      <tr key={row.timeRange} className=\"hover:bg-gray-50 h-9 max-h-9\">\n                        <td className=\"px-6 py-2 font-semibold text-gray-800 h-9 max-h-9 sticky left-0 z-30 bg-white border-r border-gray-200\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {row.timeRange}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {formatNumber(row.totalLeads)}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {formatNumber(row.converted)}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {row.conversionRate.toFixed(1)}%\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {formatCurrency(row.avgLTV)}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {row.efficiency.toFixed(1)}\n                          </div>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"ltv\" className=\"mt-6\">\n          <Card className=\"bg-white/95 backdrop-blur-sm border-0 shadow-xl relative\">\n            <CardHeader className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"text-white flex items-center gap-2 text-lg font-bold\">\n                  <DollarSign className=\"w-5 h-5\" />\n                  LTV Analysis\n                </CardTitle>\n                <CopyTableButton \n                  tableRef={ltvTableRef}\n                  tableName=\"LTV Analysis\"\n                  size=\"sm\"\n                  className=\"text-white hover:bg-white/20\"\n                />\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              <div className=\"overflow-x-auto\" data-table=\"funnel-ltv-analytics\">\n                <table ref={ltvTableRef} className=\"min-w-full bg-white\">\n                  <thead>\n                    <tr className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n                      <th className=\"px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide h-9 max-h-9 sticky left-0 z-40 border-r border-white/20\">\n                        <div className=\"flex items-center space-x-2\">\n                          <Star className=\"w-4 h-4 text-white\" />\n                          <span>LTV Range</span>\n                        </div>\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Total Leads\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Converted\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Conv. Rate\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Total Revenue\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Avg Visits\n                      </th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-gray-200\">\n                    {sortedLtvData.map((row, index) => (\n                      <tr key={row.ltvRange} className=\"hover:bg-gray-50 h-9 max-h-9\">\n                        <td className=\"px-6 py-2 font-semibold text-gray-800 h-9 max-h-9 sticky left-0 z-30 bg-white border-r border-gray-200\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {row.ltvRange}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {formatNumber(row.totalLeads)}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {formatNumber(row.converted)}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {row.conversionRate.toFixed(1)}%\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {formatCurrency(row.totalRevenue)}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {row.avgVisits.toFixed(1)}\n                          </div>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"topstages\" className=\"mt-6\">\n          <Card className=\"bg-white/95 backdrop-blur-sm border-0 shadow-xl relative\">\n            <CardHeader className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"text-white flex items-center gap-2 text-lg font-bold\">\n                  <BarChart3 className=\"w-5 h-5\" />\n                  Top Performing Stages\n                </CardTitle>\n                <CopyTableButton \n                  tableRef={topStagesTableRef}\n                  tableName=\"Top Performing Stages\"\n                  size=\"sm\"\n                  className=\"text-white hover:bg-white/20\"\n                />\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              <div className=\"overflow-x-auto\" data-table=\"funnel-topstages-analytics\">\n                <table ref={topStagesTableRef} className=\"min-w-full bg-white\">\n                  <thead>\n                    <tr className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n                      <th className=\"px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide h-9 max-h-9 sticky left-0 z-40 border-r border-white/20\">\n                        <div className=\"flex items-center space-x-2\">\n                          <Star className=\"w-4 h-4 text-white\" />\n                          <span>Stage</span>\n                        </div>\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Lead Count\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Percentage\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Converted\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Conv. Rate\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Avg LTV\n                      </th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-gray-200\">\n                    {sortedTopStagesData.map((row, index) => (\n                      <tr key={row.stage} className=\"hover:bg-gray-50 h-9 max-h-9\">\n                        <td className=\"px-6 py-2 font-semibold text-gray-800 h-9 max-h-9 sticky left-0 z-30 bg-white border-r border-gray-200\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {row.stage}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {formatNumber(row.leadCount)}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {row.percentage.toFixed(1)}%\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {formatNumber(row.converted)}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {row.conversionRate.toFixed(1)}%\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {formatCurrency(row.avgLTV)}\n                          </div>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"proximity\" className=\"mt-6\">\n          <Card className=\"bg-white/95 backdrop-blur-sm border-0 shadow-xl relative\">\n            <CardHeader className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"text-white flex items-center gap-2 text-lg font-bold\">\n                  <MapPin className=\"w-5 h-5\" />\n                  Proximity Issue Analysis\n                </CardTitle>\n                <CopyTableButton \n                  tableRef={proximityTableRef}\n                  tableName=\"Proximity Issue Analysis\"\n                  size=\"sm\"\n                  className=\"text-white hover:bg-white/20\"\n                />\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              <div className=\"overflow-x-auto\" data-table=\"funnel-proximity-analytics\">\n                <table ref={proximityTableRef} className=\"min-w-full bg-white\">\n                  <thead>\n                    <tr className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n                      <th className=\"px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide h-9 max-h-9 sticky left-0 z-40 border-r border-white/20\">\n                        <div className=\"flex items-center space-x-2\">\n                          <Star className=\"w-4 h-4 text-white\" />\n                          <span>Location</span>\n                        </div>\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Total Leads\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Proximity Issues\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Proximity Rate\n                      </th>\n                      <th className=\"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]\">\n                        Impact Score\n                      </th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-gray-200\">\n                    {sortedProximityData.map((row, index) => (\n                      <tr\n                        key={row.location}\n                        className=\"hover:bg-gray-50 cursor-pointer h-9 max-h-9\"\n                        onClick={() => handleRowClick('proximity', row)}\n                      >\n                        <td className=\"px-6 py-2 font-semibold text-gray-800 h-9 max-h-9 sticky left-0 z-30 bg-white border-r border-gray-200\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis flex items-center space-x-2\">\n                            <MapPin className=\"w-4 h-4 text-gray-400\" />\n                            <span>{row.location}</span>\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {formatNumber(row.totalLeads)}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {formatNumber(row.proximityIssues)}\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {row.proximityRate.toFixed(1)}%\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2 text-center text-gray-700 h-9 max-h-9\">\n                          <div className=\"whitespace-nowrap overflow-hidden text-ellipsis\">\n                            {row.impactScore.toFixed(1)}\n                          </div>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n};","import React, { useState, useMemo, useEffect } from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Button } from '@/components/ui/button';\nimport { RefreshCw, ChevronDown, ChevronUp } from 'lucide-react';\nimport DashboardMotionHero from '@/components/ui/DashboardMotionHero';\nimport { useLeadsData } from '@/hooks/useLeadsData';\nimport { useGlobalLoading } from '@/hooks/useGlobalLoading';\nimport { useNavigate } from 'react-router-dom';\n\n// Import components\nimport { FunnelLeadsFilterSection } from '@/components/dashboard/FunnelLeadsFilterSection';\nimport { FunnelMetricCards } from '@/components/dashboard/FunnelMetricCards';\nimport { FunnelInteractiveCharts } from '@/components/dashboard/FunnelInteractiveCharts';\nimport FunnelMonthOnMonthTable from '@/components/dashboard/FunnelMonthOnMonthTable';\nimport { FunnelYearOnYearTable } from '@/components/dashboard/FunnelYearOnYearTable';\nimport { EnhancedFunnelRankings } from '@/components/dashboard/EnhancedFunnelRankings';\nimport { FunnelHealthMetricsTable } from '@/components/dashboard/FunnelHealthMetricsTable';\nimport { FunnelAnalyticsTables } from '@/components/dashboard/FunnelAnalyticsTables';\nimport { LazyFunnelDrillDownModal } from '@/components/lazy/LazyModals';\nimport { ModalSuspense } from '@/components/lazy/ModalSuspense';\nimport { LeadsFilterOptions } from '@/types/leads';\nimport { getPreviousMonthDateRange } from '@/utils/dateUtils';\nimport { InfoPopover } from '@/components/ui/InfoSidebar';\nimport { StudioLocationTabs } from '@/components/ui/StudioLocationTabs';\nexport default function FunnelLeads() {\n  const {\n    data: allLeadsData,\n    loading,\n    error\n  } = useLeadsData();\n  const { setLoading } = useGlobalLoading();\n  const navigate = useNavigate();\n  \n  useEffect(() => {\n    setLoading(loading, 'Loading funnel and lead conversion data...');\n  }, [loading, setLoading]);\n  const [activeLocation, setActiveLocation] = useState('kwality');\n  const [filtersCollapsed, setFiltersCollapsed] = useState(true);\n  const [chartsCollapsed, setChartsCollapsed] = useState(true);\n  const [drillDownModal, setDrillDownModal] = useState<{\n    isOpen: boolean;\n    title: string;\n    data: any[];\n    type: string;\n  }>({\n    isOpen: false,\n    title: '',\n    data: [],\n    type: ''\n  });\n\n  // Get previous month date range function\n  const getPreviousMonthRange = () => {\n    const now = new Date();\n    const firstDayPreviousMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\n    const lastDayPreviousMonth = new Date(now.getFullYear(), now.getMonth(), 0);\n    const formatDate = (date: Date) => {\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const day = String(date.getDate()).padStart(2, '0');\n      return `${year}-${month}-${day}`;\n    };\n    return {\n      start: formatDate(firstDayPreviousMonth),\n      end: formatDate(lastDayPreviousMonth)\n    };\n  };\n  const [filters, setFilters] = useState<LeadsFilterOptions>(() => {\n    const previousMonth = getPreviousMonthRange();\n    return {\n      dateRange: previousMonth,\n      location: [],\n      source: [],\n      stage: [],\n      status: [],\n      associate: [],\n      channel: [],\n      trialStatus: [],\n      conversionStatus: [],\n      retentionStatus: [],\n      minLTV: undefined,\n      maxLTV: undefined\n    };\n  });\n\n  // Define locations\n  const locations = useMemo(() => {\n    const predefinedLocations = [{\n      id: 'all',\n      name: 'All Locations',\n      fullName: 'All Locations'\n    }, {\n      id: 'kwality',\n      name: 'Kwality House',\n      fullName: 'Kwality House, Kemps Corner'\n    }, {\n      id: 'supreme',\n      name: 'Supreme HQ',\n      fullName: 'Supreme HQ, Bandra'\n    }, {\n      id: 'kenkere',\n      name: 'Kenkere House',\n      fullName: 'Kenkere House'\n    }, {\n      id: 'popup',\n      name: 'Pop-up',\n      fullName: 'Pop-up'\n    }];\n    return predefinedLocations;\n  }, []);\n\n  // Filter data by location\n  const locationFilteredData = useMemo(() => {\n    if (!allLeadsData || activeLocation === 'all') return allLeadsData || [];\n    return allLeadsData.filter(lead => {\n      const leadCenter = lead.center?.toLowerCase() || '';\n      switch (activeLocation) {\n        case 'kwality':\n          return leadCenter.includes('kwality') || leadCenter.includes('kemps');\n        case 'supreme':\n          return leadCenter.includes('supreme') || leadCenter.includes('bandra');\n        case 'kenkere':\n          return leadCenter.includes('kenkere');\n        case 'popup':\n          return leadCenter.includes('pop') || leadCenter.includes('popup') || leadCenter.includes('pop-up');\n        default:\n          return true;\n      }\n    });\n  }, [allLeadsData, activeLocation]);\n\n  // Apply additional filters to location-filtered data\n  const filteredData = useMemo(() => {\n    if (!locationFilteredData) return [];\n    return locationFilteredData.filter(lead => {\n      // Date range filter\n      if (filters.dateRange.start || filters.dateRange.end) {\n        const leadDate = new Date(lead.createdAt);\n        if (filters.dateRange.start && leadDate < new Date(filters.dateRange.start)) return false;\n        if (filters.dateRange.end && leadDate > new Date(filters.dateRange.end)) return false;\n      }\n\n      // Multi-select filters\n      if (filters.location.length > 0 && !filters.location.some(loc => lead.center?.toLowerCase().includes(loc.toLowerCase()))) return false;\n      if (filters.source.length > 0 && !filters.source.includes(lead.source)) return false;\n      if (filters.stage.length > 0 && !filters.stage.includes(lead.stage)) return false;\n      if (filters.status.length > 0 && !filters.status.includes(lead.status)) return false;\n      if (filters.associate.length > 0 && !filters.associate.includes(lead.associate)) return false;\n      if (filters.channel.length > 0 && !filters.channel.includes(lead.channel)) return false;\n      if (filters.trialStatus.length > 0 && !filters.trialStatus.includes(lead.trialStatus)) return false;\n      if (filters.conversionStatus.length > 0 && !filters.conversionStatus.includes(lead.conversionStatus)) return false;\n      if (filters.retentionStatus.length > 0 && !filters.retentionStatus.includes(lead.retentionStatus)) return false;\n\n      // LTV range filters\n      if (filters.minLTV && lead.ltv < filters.minLTV) return false;\n      if (filters.maxLTV && lead.ltv > filters.maxLTV) return false;\n      return true;\n    });\n  }, [locationFilteredData, filters]);\n\n  // Extract unique values for filter options\n  const uniqueValues = useMemo(() => {\n    if (!allLeadsData) return {\n      locations: [],\n      sources: [],\n      stages: [],\n      statuses: [],\n      associates: [],\n      channels: [],\n      trialStatuses: [],\n      conversionStatuses: [],\n      retentionStatuses: []\n    };\n    return {\n      locations: [...new Set(allLeadsData.map(lead => lead.center).filter(Boolean))],\n      sources: [...new Set(allLeadsData.map(lead => lead.source).filter(Boolean))],\n      stages: [...new Set(allLeadsData.map(lead => lead.stage).filter(Boolean))],\n      statuses: [...new Set(allLeadsData.map(lead => lead.status).filter(Boolean))],\n      associates: [...new Set(allLeadsData.map(lead => lead.associate).filter(Boolean))],\n      channels: [...new Set(allLeadsData.map(lead => lead.channel).filter(Boolean))],\n      trialStatuses: [...new Set(allLeadsData.map(lead => lead.trialStatus).filter(Boolean))],\n      conversionStatuses: [...new Set(allLeadsData.map(lead => lead.conversionStatus).filter(Boolean))],\n      retentionStatuses: [...new Set(allLeadsData.map(lead => lead.retentionStatus).filter(Boolean))]\n    };\n  }, [allLeadsData]);\n\n  // Calculate tab counts for location tabs using filtered data\n  const tabCounts = useMemo(() => {\n  const counts = { all: 0, kwality: 0, supreme: 0, kenkere: 0, popup: 0 };\n    \n    const dataToCount = filteredData || allLeadsData || [];\n    dataToCount.forEach(lead => {\n      counts.all++;\n      const leadCenter = lead.center?.toLowerCase() || '';\n      if (leadCenter.includes('kwality') || leadCenter.includes('kemps')) {\n        counts.kwality++;\n      } else if (leadCenter.includes('supreme') || leadCenter.includes('bandra')) {\n        counts.supreme++;\n      } else if (leadCenter.includes('kenkere')) {\n        counts.kenkere++;\n      } else if (leadCenter.includes('pop') || leadCenter.includes('popup') || leadCenter.includes('pop-up')) {\n        counts.popup++;\n      }\n    });\n    \n    return counts;\n  }, [filteredData, allLeadsData]);\n\n  const handleFiltersChange = (newFilters: LeadsFilterOptions) => {\n    setFilters(newFilters);\n  };\n  const handleDrillDown = (title: string, data: any[], type: string) => {\n    setDrillDownModal({\n      isOpen: true,\n      title,\n      data,\n      type\n    });\n  };\n  \n  // Remove individual loader - rely on global loader only\n  \n  if (error) {\n    return <div className=\"min-h-screen bg-gray-50/30 flex items-center justify-center p-4\">\n        <Card className=\"p-8 bg-white shadow-lg max-w-md\">\n          <CardContent className=\"text-center space-y-4\">\n            <RefreshCw className=\"w-12 h-12 text-red-600 mx-auto\" />\n            <div>\n              <p className=\"text-lg font-semibold text-gray-800\">Connection Error</p>\n              <p className=\"text-sm text-gray-600 mt-2\">{error?.toString()}</p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>;\n  }\n  return <div className=\"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/30 to-purple-50/20\">\n      <DashboardMotionHero\n        title=\"Funnel & Leads Analytics\"\n        subtitle=\"Analyze your marketing funnel, lead quality, source effectiveness, and conversion patterns to improve acquisition and retention.\"\n        metrics={[\n          { label: 'Total Leads', value: filteredData.length.toLocaleString() },\n          { label: 'Converted', value: filteredData.filter(lead => lead.conversionStatus === 'Converted').length.toString() },\n          { label: 'Conversion Rate', value: `${(filteredData.length ? (filteredData.filter(lead => lead.conversionStatus === 'Converted').length / filteredData.length * 100) : 0).toFixed(1)}%` },\n        ]}\n      />\n\n      <div className=\"max-w-7xl mx-auto px-6 py-8 space-y-8\">\n        {/* Enhanced Location Tabs - unified styling (matching Client Retention) */}\n        <StudioLocationTabs \n          activeLocation={activeLocation}\n          onLocationChange={setActiveLocation}\n          showInfoPopover={true}\n          infoPopoverContext=\"funnel-leads-overview\"\n        />\n\n        {/* Content Sections */}\n        <div className=\"space-y-8\">\n                  {/* Collapsible Filters Section */}\n                  <Card className=\"bg-white/90 backdrop-blur-sm shadow-sm border border-gray-200 w-full\">\n                    <CardContent className=\"p-6 w-full\">\n                      <div className=\"flex items-center justify-between mb-4\">\n                        <h3 className=\"text-lg font-semibold text-gray-800\">Advanced Filters</h3>\n                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setFiltersCollapsed(!filtersCollapsed)} className=\"gap-2\">\n                          {filtersCollapsed ? <ChevronDown className=\"w-4 h-4\" /> : <ChevronUp className=\"w-4 h-4\" />}\n                          {filtersCollapsed ? 'Show Filters' : 'Hide Filters'}\n                        </Button>\n                      </div>\n                      {!filtersCollapsed && <div className=\"w-full\"><FunnelLeadsFilterSection filters={filters} onFiltersChange={handleFiltersChange} uniqueValues={uniqueValues} /></div>}\n                    </CardContent>\n                  </Card>\n\n                  {/* Metric Cards */}\n                  <FunnelMetricCards data={filteredData} onCardClick={handleDrillDown} />\n\n                  {/* Interactive Charts - Collapsible */}\n                  <Card className=\"bg-white/90 backdrop-blur-sm shadow-sm border border-gray-200 w-full\">\n                    <CardContent className=\"p-6 w-full\">\n                      <div className=\"flex items-center justify-between mb-4\">\n                        <h3 className=\"text-lg font-semibold text-gray-800\">Interactive Charts</h3>\n                        <Button variant=\"ghost\" size=\"sm\" onClick={() => setChartsCollapsed(!chartsCollapsed)} className=\"gap-2\">\n                          {chartsCollapsed ? <ChevronDown className=\"w-4 h-4\" /> : <ChevronUp className=\"w-4 h-4\" />}\n                          {chartsCollapsed ? 'Show Charts' : 'Hide Charts'}\n                        </Button>\n                      </div>\n                      {!chartsCollapsed && (\n                        <div className=\"w-full\">\n                          <FunnelInteractiveCharts data={filteredData} />\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n\n                  {/* Enhanced Rankings Section */}\n                  <EnhancedFunnelRankings data={filteredData} />\n\n                  {/* Tables Sub-Tabs */}\n          <Card className=\"bg-white/90 backdrop-blur-sm shadow-sm border border-gray-200 w-full\">\n            <CardContent className=\"p-4 w-full\">\n              <Tabs defaultValue=\"analytics\" className=\"w-full\">\n                <TabsList className=\"grid w-full grid-cols-4 bg-gradient-to-r from-slate-800 to-slate-700 p-1.5 rounded-xl shadow-lg border border-slate-600\">\n                  <TabsTrigger \n                    value=\"analytics\" \n                    className=\"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-300 hover:text-white hover:bg-slate-600/50 data-[state=active]:bg-gradient-to-r data-[state=active]:from-slate-900 data-[state=active]:to-slate-800 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border data-[state=active]:border-slate-500\"\n                  >\n                    Analytics\n                  </TabsTrigger>\n                  <TabsTrigger \n                    value=\"mom\" \n                    className=\"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-300 hover:text-white hover:bg-slate-600/50 data-[state=active]:bg-gradient-to-r data-[state=active]:from-slate-900 data-[state=active]:to-slate-800 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border data-[state=active]:border-slate-500\"\n                  >\n                    Month-on-Month\n                  </TabsTrigger>\n                  <TabsTrigger \n                    value=\"yoy\" \n                    className=\"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-300 hover:text-white hover:bg-slate-600/50 data-[state=active]:bg-gradient-to-r data-[state=active]:from-slate-900 data-[state=active]:to-slate-800 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border data-[state=active]:border-slate-500\"\n                  >\n                    Year-on-Year\n                  </TabsTrigger>\n                  <TabsTrigger \n                    value=\"health\" \n                    className=\"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-300 hover:text-white hover:bg-slate-600/50 data-[state=active]:bg-gradient-to-r data-[state=active]:from-slate-900 data-[state=active]:to-slate-800 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border data-[state=active]:border-slate-500\"\n                  >\n                    Health Metrics\n                  </TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"analytics\" className=\"mt-4\">\n                  <FunnelAnalyticsTables data={filteredData} onDrillDown={handleDrillDown} />\n                </TabsContent>\n\n                <TabsContent value=\"mom\" className=\"mt-4\">\n                  {/* Uses ALL location data, independent from page date filters */}\n                  <FunnelMonthOnMonthTable data={locationFilteredData} onDrillDown={handleDrillDown} />\n                </TabsContent>\n\n                <TabsContent value=\"yoy\" className=\"mt-4\">\n                  {/* Uses ALL location data, independent from page date filters */}\n                  <FunnelYearOnYearTable allData={locationFilteredData} onDrillDown={handleDrillDown} />\n                </TabsContent>\n\n                <TabsContent value=\"health\" className=\"mt-4\">\n                  <FunnelHealthMetricsTable data={filteredData} />\n                </TabsContent>\n              </Tabs>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      {/* Drill Down Modal - Lazy loaded */}\n      <ModalSuspense>\n        {drillDownModal.isOpen && (\n          <LazyFunnelDrillDownModal \n            isOpen={drillDownModal.isOpen} \n            onClose={() => setDrillDownModal(prev => ({\n              ...prev,\n              isOpen: false\n            }))} \n            title={drillDownModal.title} \n            data={drillDownModal.data} \n            type={drillDownModal.type} \n          />\n        )}\n      </ModalSuspense>\n    </div>;\n}"],"names":["HeartHandshake","createLucideIcon","IndianRupee","ZoomIn","FunnelLeadsFilterSection","filters","onFiltersChange","uniqueValues","handleArrayFilterChange","filterKey","value","currentValues","newValues","handleDateRangeChange","range","clearAllFilters","now","firstDayPreviousMonth","lastDayPreviousMonth","formatDate","date","year","month","day","previousMonth","activeFilterCount","filterConfigs","MapPin","Tag","Activity","Clock","Users","Phone","Target","UserCheck","TrendingUp","jsxs","Card","jsx","CardHeader","CardTitle","Filter","Badge","Button","X","CardContent","CalendarIcon","DatePickerWithRange","config","Select","SelectTrigger","SelectValue","SelectContent","option","SelectItem","DollarSign","Input","e","FunnelMetricCards","data","onCardClick","metrics","useMemo","leadsReceived","trialsCompleted","lead","trialsScheduled","ts","st","statusSuggestsTrial","stageSuggestsTrial","proximityIssues","convertedLeads","trialToMemberConversion","leadToTrialConversion","leadToMemberConversion","totalLTV","sum","avgLTV","totalVisits","avgVisitsPerLead","pipelineHealth","MetricCard","id","title","Icon","colorIndex","subtitle","format","description","formatValue","val","formatCurrency","cn","CheckCircle","Zap","Eye","AlertTriangle","FunnelInteractiveCharts","chartType","setChartType","useState","metricType","setMetricType","chartData","sourceStats","acc","source","a","b","stageStats","stage","monthlyStats","monthKey","pieData","conversionStats","status","colors","count","index","getMetricLabel","CustomTooltip","active","payload","label","PieTooltip","BarChart3","RotateCcw","Maximize2","Download","ResponsiveContainer","AreaChart","CartesianGrid","XAxis","YAxis","Tooltip","Area","BarChart","Bar","PieChartIcon","PieChart","Pie","name","percentage","entry","Cell","Legend","item","FunnelMonthOnMonthTable","onDrillDown","groupKey","setGroupKey","metric","setMetric","viewMode","setViewMode","sortBy","setSortBy","sortOrder","setSortOrder","copyContext","useTableCopyContext","formatNumber","n","months","start","arr","end","d","displayMonths","processedData","emptyBucket","map","inc","l","mKey","gVal","metricVal","r","totalVal","tableVariants","tableRef","useRef","motion","ModernTableWrapper","mode","columns","idx","_","row","v","prevKey","curr","prev","growth","totalsMap","footerData","bucket","prevBucket","table","ModernDataTable","filteredData","aiNotes","latestKey","best","topG","i","FunnelYearOnYearTable","allData","selectedMetric","setSelectedMetric","sortKey","setSortKey","sortDir","setSortDir","registry","useMetricsTablesRegistry","React","sourceData","yearMonthKey","yearMonthData","currentDate","currentYear","currentMonth","monthName","result","monthInfo","currentData","previousData","calculateMetric","trialToMemberRate","leadToTrialRate","leadToMemberRate","avgVisits","currentMetrics","previousMetrics","rawTotals","currentTotals","previousTotals","calculateTotalMetrics","totals","metricValue","currentVal","previousVal","metricTabs","monthsForColumns","currentValue","previousValue","growthDisplay","current","previous","t","tab","Star","key","currentTotal","previousTotal","recentMonthKey","currField","prevField","withCurr","top","PersistentTableFooter","EnhancedFunnelRankings","activeType","setActiveType","showMore","setShowMore","rankings","sourceMap","sources","stageMap","stageData","stages","displayCount","currentRankings","topItems","bottomItems","getTypeConfig","type","renderRankingCard","items","isTop","Fragment","Award","TrendingDown","Crown","Trophy","Medal","ArrowDownCircle","ThumbsDown","s","Tabs","TabsList","TabsTrigger","TabsContent","FunnelHealthMetricsTable","healthMetrics","totalLeads","converted","followUps","getStatusBadge","healthScore","scores","score","m","AlertCircle","FunnelAnalyticsTables","sortConfig","setSortConfig","sourceTableRef","stageTableRef","spanTableRef","ltvTableRef","topStagesTableRef","proximityTableRef","handleSort","prevConfig","sortData","aVal","bVal","handleRowClick","conversionBySource","stats","conversionByStage","conversionSpanAnalytics","leadsInRange","created","daysDiff","convertedInRange","ltvAnalytics","ltv","mostCommonStages","total","stageCounts","proximityAnalytics","locationStats","location","sortedSourceData","sortedStageData","sortedTimespanData","sortedLtvData","sortedTopStagesData","sortedProximityData","CopyTableButton","FunnelLeads","allLeadsData","loading","error","useLeadsData","setLoading","useGlobalLoading","useNavigate","useEffect","activeLocation","setActiveLocation","filtersCollapsed","setFiltersCollapsed","chartsCollapsed","setChartsCollapsed","drillDownModal","setDrillDownModal","getPreviousMonthRange","setFilters","locationFilteredData","leadCenter","leadDate","loc","counts","handleFiltersChange","newFilters","handleDrillDown","RefreshCw","DashboardMotionHero","StudioLocationTabs","ChevronDown","ChevronUp","ModalSuspense","LazyFunnelDrillDownModal"],"mappings":"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","x_google_ignoreList":[0,1,2]}