{"version":3,"file":"SalesAnalytics-DsF2rMef.js","sources":["../../node_modules/lucide-react/dist/esm/icons/folder-open.js","../../src/components/dashboard/UnifiedTopBottomSellers.tsx","../../src/components/dashboard/EnhancedYearOnYearTableNew.tsx","../../src/components/dashboard/MonthOnMonthTableNew.tsx","../../src/components/dashboard/CategoryPerformanceTableNew.tsx","../../src/components/dashboard/SalesInteractiveCharts.tsx","../../src/components/dashboard/SoldByMonthOnMonthTableNew.tsx","../../src/components/dashboard/PaymentMethodMonthOnMonthTableNew.tsx","../../src/components/dashboard/ComprehensiveSalesExportButton.tsx","../../src/components/dashboard/SalesHeroSection.tsx","../../src/components/ui/SectionAnchor.tsx","../../src/components/dashboard/CustomerBehaviorMonthOnMonthTable.tsx","../../src/components/dashboard/SalesAnalyticsSection.tsx","../../src/pages/SalesAnalytics.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst FolderOpen = createLucideIcon(\"FolderOpen\", [\n  [\n    \"path\",\n    {\n      d: \"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2\",\n      key: \"usdka0\"\n    }\n  ]\n]);\n\nexport { FolderOpen as default };\n//# sourceMappingURL=folder-open.js.map\n","\nimport React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { TrendingUp, TrendingDown, Award, AlertTriangle, Eye, BarChart3, Users, Package, Tag, UserCheck, Crown, Trophy, Medal, Star, ArrowDownCircle, ThumbsDown } from 'lucide-react';\nimport { SalesData } from '@/types/dashboard';\nimport { formatCurrency, formatNumber } from '@/utils/formatters';\nimport { cn } from '@/lib/utils';\nimport { SalesDrillDownModal } from './SalesDrillDownModal';\n\ninterface UnifiedTopBottomSellersProps {\n  data: SalesData[];\n  onRowClick?: (row: any) => void;\n}\n\nexport const UnifiedTopBottomSellers: React.FC<UnifiedTopBottomSellersProps> = ({ data, onRowClick }) => {\n  const [activeType, setActiveType] = useState('product');\n  const [showMore, setShowMore] = useState(false);\n  const [drillDownData, setDrillDownData] = useState<any>(null);\n  const [isDrillDownOpen, setIsDrillDownOpen] = useState(false);\n\n  const getGroupedData = (type: 'product' | 'category' | 'member' | 'seller') => {\n    const grouped = data.reduce((acc, item) => {\n      let key = '';\n      switch (type) {\n        case 'product':\n          key = item.cleanedProduct;\n          break;\n        case 'category':\n          key = item.cleanedCategory;\n          break;\n        case 'member':\n          key = item.customerName;\n          break;\n        case 'seller':\n          key = item.soldBy;\n          break;\n      }\n      \n      if (!acc[key]) {\n        acc[key] = {\n          name: key,\n          totalValue: 0,\n          unitsSold: 0,\n          transactions: 0,\n          uniqueMembers: new Set(),\n          atv: 0,\n          auv: 0,\n          asv: 0,\n          upt: 0\n        };\n      }\n      \n      acc[key].totalValue += item.paymentValue;\n      acc[key].unitsSold += 1; // Each sale item is one unit\n      acc[key].transactions += 1;\n      acc[key].uniqueMembers.add(item.memberId);\n      \n      return acc;\n    }, {} as Record<string, any>);\n    \n    // Calculate metrics correctly\n    Object.values(grouped).forEach((item: any) => {\n      const uniqueMembersCount = item.uniqueMembers.size;\n      item.uniqueMembers = uniqueMembersCount;\n      item.atv = item.transactions > 0 ? item.totalValue / item.transactions : 0; // ATV = Revenue/Transactions\n      item.auv = item.unitsSold > 0 ? item.totalValue / item.unitsSold : 0; // AUV = Revenue/Units\n      item.asv = uniqueMembersCount > 0 ? item.totalValue / uniqueMembersCount : 0; // ASV = Revenue/Members\n      item.upt = item.transactions > 0 ? item.unitsSold / item.transactions : 0; // UPT = Units/Transactions\n    });\n    \n    return Object.values(grouped).sort((a: any, b: any) => b.totalValue - a.totalValue);\n  };\n\n  const getTypeConfig = (type: string) => {\n    switch (type) {\n      case 'product':\n        return { icon: Package, label: 'Products', description: 'Individual product performance' };\n      case 'category':\n        return { icon: Tag, label: 'Categories', description: 'Category-wise performance' };\n      case 'member':\n        return { icon: Users, label: 'Members', description: 'Customer spending patterns' };\n      case 'seller':\n        return { icon: UserCheck, label: 'Associates', description: 'Sales representative performance' };\n      default:\n        return { icon: Package, label: 'Products', description: 'Performance data' };\n    }\n  };\n\n  const renderSellerCard = (sellers: any[], isTop: boolean, type: string) => {\n    const config = getTypeConfig(type);\n    const IconComponent = config.icon;\n\n    return (\n      <Card className=\"bg-gradient-to-br from-white via-slate-50/50 to-white border-0 shadow-xl hover:shadow-2xl transition-all duration-500\">\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"flex items-center gap-3 text-xl\">\n            {isTop ? (\n              <>\n                <div className=\"p-2 rounded-full bg-gradient-to-r from-green-400 to-emerald-500\">\n                  <Award className=\"w-5 h-5 text-white\" />\n                </div>\n                <div>\n              <span className=\"bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent\">\n                Top {displayCount} {config.label}\n              </span>\n                  <p className=\"text-sm text-slate-600 font-normal\">{config.description}</p>\n                </div>\n              </>\n            ) : (\n              <>\n                <div className=\"p-2 rounded-full bg-gradient-to-r from-red-500 to-rose-600\">\n                  <TrendingDown className=\"w-5 h-5 text-white\" />\n                </div>\n                <div>\n              <span className=\"bg-gradient-to-r from-red-600 to-rose-600 bg-clip-text text-transparent\">\n                Bottom {displayCount} {config.label}\n              </span>\n                  <p className=\"text-sm text-slate-600 font-normal\">Areas for improvement</p>\n                </div>\n              </>\n            )}\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {sellers.map((seller, index) => (\n            <div \n              key={seller.name} \n              className={`group flex items-center justify-between p-4 rounded-xl bg-white shadow-sm border hover:shadow-md transition-all duration-300 cursor-pointer ${isTop ? 'hover:border-emerald-200/70' : 'hover:border-rose-200/70'}`}\n              onClick={() => {\n                // Filter data for this seller only\n                const filtered = data.filter(item => {\n                  switch (type) {\n                    case 'product': return item.cleanedProduct === seller.name;\n                    case 'category': return item.cleanedCategory === seller.name;\n                    case 'member': return item.customerName === seller.name;\n                    case 'seller': return item.soldBy === seller.name;\n                    default: return false;\n                  }\n                });\n                onRowClick?.({ \n                  ...seller, \n                  rawData: filtered, \n                  filteredTransactionData: filtered,\n                  type,\n                  title: seller.name,\n                  name: seller.name,\n                  grossRevenue: seller.totalValue,\n                  totalRevenue: seller.totalValue,\n                  totalValue: seller.totalValue,\n                  totalCurrent: seller.totalValue,\n                  metricValue: seller.totalValue,\n                  transactions: seller.transactions,\n                  totalTransactions: seller.transactions,\n                  uniqueMembers: seller.uniqueMembers,\n                  totalCustomers: seller.uniqueMembers,\n                  totalChange: 12.5,\n                  months: {},\n                  monthlyValues: {},\n                  isDynamic: true,\n                  calculatedFromFiltered: true\n                });\n              }}\n            >\n              <div className=\"flex items-center gap-4 flex-1\">\n                <div className={cn(\n                  \"w-12 h-12 rounded-full flex items-center justify-center shadow-lg\",\n                  isTop \n                    ? 'bg-gradient-to-br from-green-400 via-emerald-500 to-green-600 text-white'\n                    : 'bg-gradient-to-br from-red-500 via-rose-600 to-red-700 text-white'\n                )}>\n                  {/* Beautiful ranking icons */}\n                  {isTop ? (\n                    index === 0 ? <Crown className=\"w-6 h-6\" /> :\n                    index === 1 ? <Trophy className=\"w-6 h-6\" /> :\n                    index === 2 ? <Medal className=\"w-5 h-5\" /> :\n                    index === 3 ? <Star className=\"w-5 h-5\" /> :\n                    <span className=\"text-sm font-bold\">{index + 1}</span>\n                  ) : (\n                    index === 0 ? <ArrowDownCircle className=\"w-6 h-6\" /> :\n                    index === 1 ? <TrendingDown className=\"w-6 h-6\" /> :\n                    index === 2 ? <ThumbsDown className=\"w-5 h-5\" /> :\n                    <span className=\"text-sm font-bold\">{index + 1}</span>\n                  )}\n                </div>\n                <div className=\"flex-1\">\n                  <p className=\"font-semibold text-slate-900 whitespace-normal break-words group-hover:text-blue-600 transition-colors\">\n                    {seller.name}\n                  </p>\n                  <div className=\"flex flex-wrap gap-2 mt-2\">\n                    <Badge variant=\"secondary\" className=\"text-xs bg-blue-50 text-blue-700 border-blue-200\">\n                      {formatNumber(seller.transactions)} txns\n                    </Badge>\n                    <Badge variant=\"outline\" className=\"text-xs border-purple-200 text-purple-700\">\n                      ATV: {formatCurrency(seller.atv)}\n                    </Badge>\n                    <Badge variant=\"outline\" className=\"text-xs border-green-200 text-green-700\">\n                      AUV: {formatCurrency(seller.auv)}\n                    </Badge>\n                    <Badge variant=\"outline\" className=\"text-xs border-orange-200 text-orange-700\">\n                      ASV: {formatCurrency(seller.asv)}\n                    </Badge>\n                    <Badge variant=\"outline\" className=\"text-xs border-slate-200 text-slate-700\">\n                      UPT: {seller.upt.toFixed(1)}\n                    </Badge>\n                  </div>\n                </div>\n              </div>\n              <div className=\"text-right\">\n                <p className=\"font-bold text-xl text-slate-900 group-hover:text-blue-600 transition-colors\">\n                  {formatCurrency(seller.totalValue)}\n                </p>\n                <p className=\"text-sm text-slate-500\">{formatNumber(seller.unitsSold)} units</p>\n                <p className=\"text-xs text-slate-400\">{formatNumber(seller.uniqueMembers)} customers</p>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"mt-1 opacity-0 group-hover:opacity-100 transition-all duration-300 hover:bg-blue-50 hover:text-blue-600 hover:shadow-sm\"\n                  onClick={e => {\n                    e.stopPropagation();\n                    // Filter data for this seller only\n                    const filtered = data.filter(item => {\n                      switch (type) {\n                        case 'product': return item.cleanedProduct === seller.name;\n                        case 'category': return item.cleanedCategory === seller.name;\n                        case 'member': return item.customerName === seller.name;\n                        case 'seller': return item.soldBy === seller.name;\n                        default: return false;\n                      }\n                    });\n                    \n                    const drillDownInfo = { \n                      ...seller, \n                      rawData: filtered, \n                      filteredTransactionData: filtered,\n                      type,\n                      title: seller.name,\n                      name: seller.name,\n                      grossRevenue: seller.totalValue,\n                      totalValue: seller.totalValue,\n                      totalCurrent: seller.totalValue,\n                      metricValue: seller.totalValue,\n                      transactions: seller.transactions,\n                      totalTransactions: seller.transactions,\n                      uniqueMembers: seller.uniqueMembers,\n                      totalCustomers: seller.uniqueMembers,\n                      totalChange: 0,\n                      months: {},\n                      monthlyValues: {}\n                    };\n                    \n                    setDrillDownData(drillDownInfo);\n                    setIsDrillDownOpen(true);\n                  }}\n                >\n                  <Eye className=\"w-3 h-3 mr-1\" />\n                  View Analytics\n                </Button>\n              </div>\n            </div>\n          ))}\n          \n            <div className=\"mt-6 p-4 bg-gradient-to-r from-slate-50 to-slate-100 rounded-lg border\">\n              <div className=\"flex justify-between items-center mb-2\">\n                <h4 className=\"font-semibold text-slate-800 flex items-center gap-2\">\n                  <BarChart3 className=\"w-4 h-4\" />\n                  Performance Summary\n                </h4>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => setShowMore(!showMore)}\n                  className=\"text-xs\"\n                >\n                  Show {showMore ? 'Less' : 'More'}\n                </Button>\n              </div>\n              <ul className=\"text-sm text-slate-600 space-y-1\">\n                <li>• Average revenue: {formatCurrency(sellers.reduce((sum, s) => sum + s.totalValue, 0) / sellers.length)}</li>\n                <li>• Total transactions: {formatNumber(sellers.reduce((sum, s) => sum + s.transactions, 0))}</li>\n                <li>• Combined customer reach: {formatNumber(sellers.reduce((sum, s) => sum + s.uniqueMembers, 0))} unique customers</li>\n                <li>• Performance spread: {((sellers[0]?.totalValue / sellers[sellers.length - 1]?.totalValue || 1) - 1).toFixed(1)}x variance</li>\n              </ul>\n            </div>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const groupedData = getGroupedData(activeType as 'product' | 'category' | 'member' | 'seller');\n  const displayCount = showMore ? 10 : 5;\n  const topSellers = groupedData.slice(0, displayCount);\n  const bottomSellers = groupedData.slice(-displayCount).reverse();\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Enhanced Tab Navigation */}\n      <Card className=\"bg-gradient-to-br from-white via-slate-50/20 to-white border-0 shadow-xl\">\n        <CardHeader className=\"pb-4\">\n          <CardTitle className=\"text-2xl font-bold bg-gradient-to-r from-slate-700 via-slate-800 to-slate-900 bg-clip-text text-transparent\">\n            Performance Analysis\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Tabs value={activeType} onValueChange={setActiveType} className=\"w-full\">\n            <TabsList className=\"bg-white/90 backdrop-blur-sm p-1.5 rounded-2xl shadow-xl border border-slate-200 w-full max-w-4xl mx-auto overflow-visible grid grid-cols-4 gap-0.5\">\n              <TabsTrigger \n                value=\"product\" \n                className=\"relative text-center px-3 py-3 font-semibold text-sm min-h-[60px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-700 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-10 data-[state=active]:scale-105 hover:bg-gray-50 rounded-lg transition-all duration-200 flex items-center justify-center gap-2\"\n              >\n                <Package className=\"w-4 h-4 shrink-0\" />\n                <span className=\"text-sm leading-tight whitespace-nowrap\">Products</span>\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"category\" \n                className=\"relative text-center px-3 py-3 font-semibold text-sm min-h-[60px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-700 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-10 data-[state=active]:scale-105 hover:bg-gray-50 rounded-lg transition-all duration-200 flex items-center justify-center gap-2\"\n              >\n                <Tag className=\"w-4 h-4 shrink-0\" />\n                <span className=\"text-sm leading-tight whitespace-nowrap\">Categories</span>\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"member\" \n                className=\"relative text-center px-3 py-3 font-semibold text-sm min-h-[60px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-700 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-10 data-[state=active]:scale-105 hover:bg-gray-50 rounded-lg transition-all duration-200 flex items-center justify-center gap-2\"\n              >\n                <Users className=\"w-4 h-4 shrink-0\" />\n                <span className=\"text-sm leading-tight whitespace-nowrap\">Members</span>\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"seller\" \n                className=\"relative text-center px-3 py-3 font-semibold text-sm min-h-[60px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-700 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-10 data-[state=active]:scale-105 hover:bg-gray-50 rounded-lg transition-all duration-200 flex items-center justify-center gap-2\"\n              >\n                <UserCheck className=\"w-4 h-4 shrink-0\" />\n                <span className=\"text-sm leading-tight whitespace-nowrap\">Associates</span>\n              </TabsTrigger>\n            </TabsList>\n\n            <TabsContent value={activeType} className=\"mt-6\">\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                {renderSellerCard(topSellers, true, activeType)}\n                {renderSellerCard(bottomSellers, false, activeType)}\n              </div>\n            </TabsContent>\n          </Tabs>\n        </CardContent>\n      </Card>\n\n      {/* Drill Down Modal */}\n      <SalesDrillDownModal\n        isOpen={isDrillDownOpen}\n        onClose={() => setIsDrillDownOpen(false)}\n        data={drillDownData}\n      />\n    </div>\n  );\n};\n","import React, { useMemo, useState, useCallback, useRef } from 'react';\nimport { SalesData, FilterOptions, YearOnYearMetricType, EnhancedYearOnYearTableProps } from '@/types/dashboard';\nimport { ModernTableWrapper, ModernGroupBadge, ModernMetricTabs, STANDARD_METRICS } from './ModernTableWrapper';\nimport { PersistentTableFooter } from '@/components/dashboard/PersistentTableFooter';\nimport { formatCurrency, formatNumber, formatPercentage } from '@/utils/formatters';\nimport { ChevronDown, ChevronRight, Calendar, TrendingUp, TrendingDown, BarChart3, DollarSign, Users, ShoppingCart, Target, Star } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { shallowEqual } from '@/utils/performanceUtils';\nimport { useTableCopyContext } from '@/hooks/useTableCopyContext';\n\nconst groupDataByCategory = (data: SalesData[]) => {\n  return data.reduce((acc: Record<string, any>, item) => {\n    const category = item.cleanedCategory || 'Uncategorized';\n    const product = item.cleanedProduct || 'Unspecified';\n    if (!acc[category]) {\n      acc[category] = {};\n    }\n    if (!acc[category][product]) {\n      acc[category][product] = [];\n    }\n    acc[category][product].push(item);\n    return acc;\n  }, {});\n};\n\nexport const EnhancedYearOnYearTableNewComponent: React.FC<EnhancedYearOnYearTableProps & { onReady?: () => void }> = ({\n  data,\n  filters = {\n    dateRange: { start: '', end: '' },\n    location: [],\n    category: [],\n    product: [],\n    soldBy: [],\n    paymentMethod: []\n  },\n  onRowClick,\n  collapsedGroups = new Set(),\n  onGroupToggle = () => {},\n  selectedMetric: initialMetric = 'revenue',\n  onReady\n}) => {\n  const tableRef = useRef<HTMLTableElement>(null);\n  const [selectedMetric, setSelectedMetric] = useState<YearOnYearMetricType>(initialMetric);\n  const [localCollapsedGroups, setLocalCollapsedGroups] = useState<Set<string>>(new Set());\n  const [isInitialized, setIsInitialized] = useState(false);\n  const [displayMode, setDisplayMode] = useState<'values' | 'growth'>('values');\n  const [sortKey, setSortKey] = useState<string>('total');\n  const [sortDir, setSortDir] = useState<'desc' | 'asc'>('desc');\n\n  // Get context information for enhanced table copying\n  const copyContext = useTableCopyContext();\n\n  const parseDate = (dateStr: string): Date | null => {\n    if (!dateStr) return null;\n    const ddmmyyyy = dateStr.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})$/);\n    if (ddmmyyyy) {\n      const [, day, month, year] = ddmmyyyy;\n      return new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n    }\n    const date = new Date(dateStr);\n    return isNaN(date.getTime()) ? null : date;\n  };\n\n  const getMetricValue = (items: SalesData[], metric: YearOnYearMetricType) => {\n    if (!items.length) return 0;\n    // Use NET revenue: paymentValue - VAT\n    const totalRevenue = items.reduce((sum, item) => {\n      const payment = item.paymentValue || 0;\n      const vat = item.paymentVAT || item.vat || 0;\n      return sum + (payment - vat);\n    }, 0);\n    \n    // Transactions = unique count of payment transaction ID\n    const uniqueTransactionIds = new Set(items.map(item => item.paymentTransactionId || item.transactionId).filter(Boolean));\n    const totalTransactions = uniqueTransactionIds.size > 0 ? uniqueTransactionIds.size : items.length;\n    \n    // Members = unique count of member ID\n    const uniqueMembers = new Set(items.map(item => item.memberId).filter(Boolean)).size;\n    \n    // Units Sold = unique count of sales item ID\n    const uniqueSalesItemIds = new Set(items.map(item => item.salesItemId || item.itemId || item.saleItemId).filter(Boolean));\n    const totalUnits = uniqueSalesItemIds.size > 0 ? uniqueSalesItemIds.size : items.length;\n    \n    // VAT and Discount\n    const totalVat = items.reduce((sum, item) => sum + (item.paymentVAT || item.vat || 0), 0);\n    const totalDiscount = items.reduce((sum, item) => sum + (item.discountAmount || 0), 0);\n    \n    // Calculate discount percentage correctly: Total Discounts / (Total Gross Revenue) * 100\n    const totalGrossRevenue = items.reduce((sum, item) => sum + (item.paymentValue || 0), 0);\n    const avgDiscountPercentage = totalGrossRevenue > 0\n      ? (totalDiscount / totalGrossRevenue) * 100\n      : 0;\n    \n    // Purchase Frequency in Days\n    const dates = items.map(item => {\n      const dateStr = item.paymentDate;\n      if (!dateStr) return null;\n      const ddmmyyyy = dateStr.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})$/);\n      if (ddmmyyyy) {\n        const [, day, month, year] = ddmmyyyy;\n        return new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n      }\n      return new Date(dateStr);\n    }).filter((date): date is Date => date !== null && !isNaN(date.getTime())).sort((a, b) => a.getTime() - b.getTime());\n    \n    let purchaseFrequency = 0;\n    if (dates.length > 1) {\n      const totalDays = (dates[dates.length - 1].getTime() - dates[0].getTime()) / (1000 * 60 * 60 * 24);\n      purchaseFrequency = totalDays / (dates.length - 1);\n    }\n\n    switch (metric) {\n      case 'revenue': return totalRevenue;\n      case 'transactions': return totalTransactions;\n      case 'members': return uniqueMembers;\n      case 'units': return totalUnits;\n      case 'atv': return totalTransactions > 0 ? totalRevenue / totalTransactions : 0;\n      case 'auv': return uniqueMembers > 0 ? totalRevenue / uniqueMembers : 0;\n      case 'asv': return uniqueMembers > 0 ? totalRevenue / uniqueMembers : 0; // ASV = Gross Sales / Unique Members\n      case 'upt': return totalTransactions > 0 ? totalUnits / totalTransactions : 0;\n      case 'vat': return totalVat;\n      case 'discountAmount': return totalDiscount;\n      case 'discountValue': return totalDiscount;\n      case 'discountPercentage': return avgDiscountPercentage;\n      case 'purchaseFrequency': return purchaseFrequency;\n      default: return 0;\n    }\n  };\n\n  const formatMetricValue = (value: number, metric: YearOnYearMetricType) => {\n    switch (metric) {\n      case 'revenue':\n      case 'auv':\n      case 'atv':\n      case 'asv':\n      case 'vat':\n      case 'discountAmount':\n      case 'discountValue':\n        return formatCurrency(value);\n      case 'transactions':\n      case 'members':\n      case 'units':\n        return formatNumber(value);\n      case 'upt':\n        return value.toFixed(1);\n      case 'discountPercentage':\n        return `${value.toFixed(1)}%`;\n      case 'purchaseFrequency':\n        return `${value.toFixed(1)} days`;\n      default:\n        return formatNumber(value);\n    }\n  };\n\n\n\n  // Get previous month key for highlighting\n  const getPreviousMonthKey = () => {\n    const now = new Date();\n    const prevMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\n    return `${prevMonth.getFullYear()}-${String(prevMonth.getMonth() + 1).padStart(2, '0')}`;\n  };\n  const previousMonthKey = getPreviousMonthKey();\n\n  const getGrowthPercentage = (current: number, previous: number) => {\n    if (previous === 0 && current === 0) return null;\n    if (previous === 0) return '+100';\n    return ((current - previous) / previous * 100).toFixed(1);\n  };\n\n  // Get all data for historic comparison (include 2024 data regardless of filters)\n  const allHistoricData = useMemo(() => {\n    if (!Array.isArray(data)) return [];\n    return data.filter(item => {\n      if (filters?.location?.length > 0 && !filters.location.includes(item.calculatedLocation)) return false;\n      if (filters?.category?.length > 0 && !filters.category.includes(item.cleanedCategory)) return false;\n      if (filters?.product?.length > 0 && !filters.product.includes(item.cleanedProduct)) return false;\n      if (filters?.soldBy?.length > 0 && !filters.soldBy.includes(item.soldBy)) return false;\n      if (filters?.paymentMethod?.length > 0 && !filters.paymentMethod.includes(item.paymentMethod)) return false;\n      if (filters?.minAmount !== undefined && item.paymentValue < filters.minAmount) return false;\n      if (filters?.maxAmount !== undefined && item.paymentValue > filters.maxAmount) return false;\n      return true;\n    });\n  }, [data, filters]);\n\n  // Generate YoY month pairs sorted by month (Jan-Dec), with year pairs (2024, 2025) for each month\n  const monthlyData = useMemo(() => {\n    const months: { key: string; display: string; year: number; month: number }[] = [];\n    const now = new Date();\n    const currentMonth = now.getMonth() + 1;\n    const currentYear = now.getFullYear();\n    \n    // Generate from Jan 2024 to current month, sorted by month number\n    for (let monthNum = 1; monthNum <= 12; monthNum++) {\n      const monthName = new Date(2024, monthNum - 1, 1).toLocaleDateString('en-US', { month: 'short' });\n      \n      // Only include months up to current month in current year\n      if (monthNum > currentMonth && currentYear === now.getFullYear()) {\n        continue;\n      }\n      \n      // Add 2024 entry\n      months.push({\n        key: `2024-${String(monthNum).padStart(2, '0')}`,\n        display: `${monthName} 2024`,\n        year: 2024,\n        month: monthNum\n      });\n      \n      // Add 2025 entry if month has occurred\n      if (monthNum <= currentMonth) {\n        months.push({\n          key: `${currentYear}-${String(monthNum).padStart(2, '0')}`,\n          display: `${monthName} ${currentYear}`,\n          year: currentYear,\n          month: monthNum\n        });\n      }\n    }\n    return months;\n  }, []);\n\n  const visibleMonths = useMemo(() => monthlyData, [monthlyData]);\n\n  const processedData = useMemo(() => {\n    const grouped = groupDataByCategory(allHistoricData);\n    const categories = Object.entries(grouped).map(([category, products]) => {\n      const categoryData = {\n        category,\n        products: Object.entries(products).map(([product, items]) => {\n          const monthlyValues: Record<string, number> = {};\n\n          // Calculate values for each month\n          monthlyData.forEach(({ key, year, month }) => {\n            const monthItems = (items as SalesData[]).filter(item => {\n              const itemDate = parseDate(item.paymentDate);\n              return itemDate && itemDate.getFullYear() === year && itemDate.getMonth() + 1 === month;\n            });\n            monthlyValues[key] = getMetricValue(monthItems, selectedMetric);\n          });\n\n          return {\n            product,\n            monthlyValues,\n            rawData: items,\n            totalValue: getMetricValue(items as SalesData[], selectedMetric)\n          };\n        })\n      };\n\n      // Calculate category totals for each month\n      const categoryMonthlyValues: Record<string, number> = {};\n      monthlyData.forEach(({ key, year, month }) => {\n        // Compute from raw items for averaging metrics correctness\n        const monthItems = (categoryData as any).products.flatMap((p: any) => p.rawData as SalesData[]).filter((item: SalesData) => {\n          const itemDate = parseDate(item.paymentDate);\n          return itemDate && itemDate.getFullYear() === year && itemDate.getMonth() + 1 === month;\n        });\n        categoryMonthlyValues[key] = getMetricValue(monthItems, selectedMetric);\n      });\n      \n      return {\n        ...categoryData,\n        monthlyValues: categoryMonthlyValues,\n        products: categoryData.products.sort((a, b) => b.totalValue - a.totalValue)\n      };\n    });\n\n    // Initialize all groups as expanded by default if not already initialized\n    if (!isInitialized && categories.length > 0) {\n      setLocalCollapsedGroups(new Set());\n      setIsInitialized(true);\n    }\n    \n    const comparator = (a: any, b: any) => {\n      const byMonth = (obj: any, key: string) => obj.monthlyValues?.[key] || 0;\n      let av: number, bv: number;\n      if (sortKey === 'total') {\n        const sumVals = (obj: any): number => {\n          const vals = Object.values(obj?.monthlyValues ?? {}) as number[];\n          return vals.reduce((sum: number, val: number) => {\n            const n = typeof val === 'number' ? val : Number(val || 0);\n            return sum + (isNaN(n) ? 0 : n);\n          }, 0);\n        };\n        av = sumVals(a);\n        bv = sumVals(b);\n      } else {\n        av = byMonth(a, sortKey);\n        bv = byMonth(b, sortKey);\n      }\n      return sortDir === 'desc' ? bv - av : av - bv;\n    };\n    return categories.sort(comparator);\n  }, [allHistoricData, selectedMetric, monthlyData, isInitialized, sortKey, sortDir]);\n\n  const toggleGroup = useCallback((groupKey: string) => {\n    setLocalCollapsedGroups(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(groupKey)) {\n        newSet.delete(groupKey);\n      } else {\n        newSet.add(groupKey);\n      }\n      return newSet;\n    });\n  }, []);\n\n  const handleCollapseAll = useCallback(() => {\n    const allGroups = new Set(processedData.map(item => item.category));\n    setLocalCollapsedGroups(allGroups);\n  }, [processedData]);\n\n  const handleExpandAll = useCallback(() => {\n    setLocalCollapsedGroups(new Set());\n  }, []);\n\n  // Set all categories as collapsed by default on first load\n  React.useEffect(() => {\n    if (processedData.length > 0 && !isInitialized) {\n      const allCategories = new Set(processedData.map(cat => cat.category));\n      setLocalCollapsedGroups(allCategories);\n      setIsInitialized(true);\n    }\n  }, [processedData, isInitialized]);\n\n  // Function to generate content for all metric tabs\n  const generateAllTabsContent = useCallback(async () => {\n    let allContent = `Year-on-Year Analysis - All Metrics\\n`;\n    allContent += `Exported on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}\\n`;\n    allContent += `\\n${'='.repeat(80)}\\n\\n`;\n\n    // Loop through all metrics from STANDARD_METRICS\n    for (const metricInfo of STANDARD_METRICS) {\n      const metric = metricInfo.key as YearOnYearMetricType;\n\n      allContent += `\\n${metricInfo.label.toUpperCase()}\\n`;\n      allContent += `${'-'.repeat(metricInfo.label.length + 10)}\\n\\n`;\n\n      // Add table headers\n      const headers = ['Category / Product', 'Total'];\n      visibleMonths.forEach(month => headers.push(month.display));\n      allContent += headers.join('\\t') + '\\n';\n      allContent += headers.map(() => '---').join('\\t') + '\\n';\n\n      // Reprocess data specifically for this metric\n      const grouped = groupDataByCategory(allHistoricData);\n      const metricProcessedData = Object.entries(grouped).map(([category, products]) => {\n        const categoryProducts = Object.entries(products).map(([product, items]) => {\n          const monthlyValues: Record<string, number> = {};\n\n          monthlyData.forEach(({ key, year, month }) => {\n            const monthItems = (items as SalesData[]).filter(item => {\n              const itemDate = parseDate(item.paymentDate);\n              return itemDate && itemDate.getFullYear() === year && itemDate.getMonth() + 1 === month;\n            });\n            monthlyValues[key] = getMetricValue(monthItems, metric);\n          });\n\n          return {\n            product,\n            monthlyValues,\n            totalValue: getMetricValue(items as SalesData[], metric)\n          };\n        });\n\n        const categoryMonthlyValues: Record<string, number> = {};\n        monthlyData.forEach(({ key }) => {\n          categoryMonthlyValues[key] = categoryProducts.reduce(\n            (sum, product) => sum + (product.monthlyValues[key] || 0),\n            0\n          );\n        });\n\n        return {\n          category,\n          products: categoryProducts,\n          monthlyValues: categoryMonthlyValues,\n          totalValue: categoryProducts.reduce((sum, product) => sum + product.totalValue, 0)\n        };\n      });\n\n      // Add data rows\n      metricProcessedData.forEach(categoryGroup => {\n        // Category row\n        const categoryTotal = categoryGroup.totalValue;\n        const categoryRow = [categoryGroup.category, formatMetricValue(categoryTotal, metric)];\n        \n        visibleMonths.forEach(month => {\n          const value = categoryGroup.monthlyValues[month.key] || 0;\n          categoryRow.push(formatMetricValue(value, metric));\n        });\n        allContent += categoryRow.join('\\t') + '\\n';\n\n        // Product rows (include all products for export)\n        categoryGroup.products.forEach(product => {\n          const productTotal = product.totalValue;\n          const productRow = [`  ${product.product}`, formatMetricValue(productTotal, metric)];\n          \n          visibleMonths.forEach(month => {\n            const value = product.monthlyValues[month.key] || 0;\n            productRow.push(formatMetricValue(value, metric));\n          });\n          allContent += productRow.join('\\t') + '\\n';\n        });\n      });\n\n      allContent += `\\n`;\n    }\n\n    return allContent;\n  }, [allHistoricData, visibleMonths, monthlyData]);\n  \n  // Notify parent when ready\n  const [readySent, setReadySent] = React.useState(false);\n  React.useEffect(() => {\n    if (!readySent && processedData.length > 0 && monthlyData.length > 0) {\n      setReadySent(true);\n      onReady?.();\n    }\n  }, [readySent, processedData, monthlyData, onReady]);\n\n\n\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Modern Metric Selector */}\n      <ModernMetricTabs\n        metrics={STANDARD_METRICS}\n        selectedMetric={selectedMetric}\n        onMetricChange={(metric) => setSelectedMetric(metric as YearOnYearMetricType)}\n      />\n\n      <ModernTableWrapper\n        title=\"Year-on-Year Analysis\"\n        description=\"Comprehensive year-over-year performance comparison across all metrics\"\n        icon={<Calendar className=\"w-6 h-6 text-white\" />}\n        totalItems={processedData.length}\n        collapsedGroups={localCollapsedGroups}\n        onCollapseAll={handleCollapseAll}\n        onExpandAll={handleExpandAll}\n        showDisplayToggle={true}\n        displayMode={displayMode}\n        onDisplayModeChange={setDisplayMode}\n        className=\"animate-in slide-in-from-bottom-8 fade-in duration-1000\"\n        tableRef={tableRef}\n        showCopyButton={true}\n        onCopyAllTabs={generateAllTabsContent}\n        contextInfo={{\n          selectedMetric: selectedMetric,\n          dateRange: copyContext.dateRange,\n          filters: copyContext.filters,\n          additionalInfo: {\n            displayMode: displayMode,\n            totalItems: processedData.length,\n            collapsedGroups: Array.from(localCollapsedGroups),\n            sortBy: sortKey,\n            sortDirection: sortDir\n          }\n        }}\n      >\n        <div className=\"overflow-x-auto\" data-table=\"year-on-year-analysis\">\n          <table ref={tableRef} className=\"min-w-full bg-white\">\n            <thead className=\"sticky top-0 z-30\">\n              <tr className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n                <th\n                  className=\"w-[30rem] px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide sticky left-0 bg-gradient-to-r from-slate-800 to-slate-900 z-40 border-r border-white/20 cursor-pointer select-none\"\n                  onClick={() => {\n                    if (sortKey !== 'total') { setSortKey('total'); setSortDir('desc'); }\n                    else setSortDir(d => d === 'desc' ? 'asc' : 'desc');\n                  }}\n                  title={`Sort by total (${sortDir})`}\n                >\n                  <div className=\"flex items-center space-x-2\">\n                    <Calendar className=\"w-4 h-4 text-white\" />\n                    <span>Category / Product</span>\n                  </div>\n                </th>\n                \n                {visibleMonths.map(({ key, display, year, month }, index) => {\n                  // Check for month grouping - add borders around groups of same months\n                  const prevMonth = index > 0 ? visibleMonths[index - 1] : null;\n                  const nextMonth = index < visibleMonths.length - 1 ? visibleMonths[index + 1] : null;\n                  \n                  const isFirstOfGroup = !prevMonth || prevMonth.month !== month;\n                  const isLastOfGroup = !nextMonth || nextMonth.month !== month;\n                  \n                  const isPreviousMonth = key === previousMonthKey;\n                  \n                  return (\n                    <th\n                      key={key}\n                      className={`px-3 py-3 text-center font-bold text-xs uppercase tracking-wider min-w-[90px] cursor-pointer select-none ${\n                        isFirstOfGroup ? 'border-l-2 border-slate-400' : ''\n                      } ${\n                        isLastOfGroup ? 'border-r-2 border-slate-400' : ''\n                      } ${\n                        isPreviousMonth \n                          ? 'bg-blue-800 text-white' \n                          : 'text-white'\n                      }`}\n                      onClick={() => {\n                        if (sortKey !== key) { setSortKey(key); setSortDir('desc'); }\n                        else setSortDir(d => d === 'desc' ? 'asc' : 'desc');\n                      }}\n                      title={`Sort by ${display} (${sortDir})${isPreviousMonth ? ' - Main Month' : ''}`}\n                    >\n                      <div className=\"flex flex-col items-center\">\n                        <div className=\"flex items-center space-x-1\">\n                          {isPreviousMonth && <Star className=\"w-3 h-3\" />}\n                          <span className=\"text-xs font-bold whitespace-nowrap leading-tight\">{display.split(' ')[0]}</span>\n                        </div>\n                        <span className=\"text-slate-300 text-xs leading-tight\">{display.split(' ')[1]}</span>\n                      </div>\n                    </th>\n                  );\n                })}\n              </tr>\n            </thead>\n\n            <tbody>\n              {processedData.map((categoryGroup, categoryIndex) => (\n                <React.Fragment key={categoryGroup.category}>\n                  {/* Category Row */}\n                  <tr \n                    className=\"group bg-slate-100 border-b border-slate-400 font-semibold hover:bg-slate-200 transition-all duration-200 h-9 max-h-9 cursor-pointer\"\n                    onClick={() => onRowClick?.({\n                      drillDownContext: 'yoy-category-total',\n                      filterCriteria: { category: categoryGroup.category },\n                      name: `${categoryGroup.category} (YoY Total)`,\n                      category: categoryGroup.category,\n                      rawData: categoryGroup.products.flatMap(p => p.rawData),\n                      isGroup: true,\n                    })}\n                  >\n                    <td \n                      className=\"w-[30rem] px-4 py-2 text-left sticky left-0 bg-gradient-to-r from-slate-100 via-blue-50 to-indigo-50 group-hover:from-slate-200 group-hover:via-blue-100 group-hover:to-indigo-100 border-r border-slate-200 z-20 transition-all duration-300 shadow-sm whitespace-nowrap overflow-hidden text-ellipsis\"\n                    >\n                      <div className=\"flex items-center space-x-2\">\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\" \n                          onClick={(e) => {\n                            e.stopPropagation();\n                            toggleGroup(categoryGroup.category);\n                          }} \n                          className=\"p-1 h-5 w-5 rounded text-slate-600 hover:text-slate-800 hover:bg-white/50 transition-all duration-200\"\n                        >\n                          {localCollapsedGroups.has(categoryGroup.category) ? \n                            <ChevronRight className=\"w-5 h-5\" /> : \n                            <ChevronDown className=\"w-5 h-5\" />\n                          }\n                        </Button>\n                        <span className=\"font-bold text-xs text-slate-800\">{categoryGroup.category}</span>\n                      </div>\n                    </td>\n                    \n                    {visibleMonths.map(({ key }, monthIndex) => {\n                      // Calculate grouping borders\n                      const prevMonth = monthIndex > 0 ? visibleMonths[monthIndex - 1] : null;\n                      const nextMonth = monthIndex < visibleMonths.length - 1 ? visibleMonths[monthIndex + 1] : null;\n                      const currentMonth = visibleMonths[monthIndex].month;\n                      \n                      const isFirstOfGroup = !prevMonth || prevMonth.month !== currentMonth;\n                      const isLastOfGroup = !nextMonth || nextMonth.month !== currentMonth;\n                      \n                      const current = categoryGroup.monthlyValues[key] || 0;\n                      // For YoY, compare with same month previous year (dynamic)\n                      const [yearStr, monthStr] = key.split('-');\n                      const prevYear = String(Number(yearStr) - 1);\n                      const previousYearKey = `${prevYear}-${monthStr}`;\n                      const previous = categoryGroup.monthlyValues[previousYearKey] || 0;\n                      const growthPercentage = getGrowthPercentage(current, previous);\n                      \n                      return (\n                        <td \n                          key={key} \n                          className={`px-2 py-2 text-center text-sm font-bold text-slate-800 hover:bg-blue-100/50 cursor-pointer transition-all duration-200 h-12 ${\n                            isFirstOfGroup ? 'border-l-2 border-slate-400' : ''\n                          } ${\n                            isLastOfGroup ? 'border-r-2 border-slate-400' : ''\n                          }`}\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            const monthItems = (categoryGroup.products.flatMap(p => (p.rawData as SalesData[])) as SalesData[]).filter(item => {\n                              const itemDate = parseDate((item as any).paymentDate);\n                              return itemDate && `${itemDate.getFullYear()}-${String(itemDate.getMonth() + 1).padStart(2, '0')}` === key;\n                            });\n                            onRowClick?.({\n                              drillDownContext: 'yoy-category-month',\n                              filterCriteria: { category: categoryGroup.category, month: key },\n                              name: `${categoryGroup.category} (${key})`,\n                              category: categoryGroup.category,\n                              month: key,\n                              rawData: monthItems,\n                            })\n                          }}\n                          title={growthPercentage ? `${growthPercentage}% vs same month last year` : ''}\n                        >\n                          <div className=\"flex flex-col items-center space-y-0.5 min-h-6 justify-center\">\n                            {displayMode === 'values' ? (\n                              <span className=\"font-mono text-xs whitespace-nowrap\">{formatMetricValue(current, selectedMetric)}</span>\n                            ) : (\n                              growthPercentage && (\n                                <div className={`flex items-center justify-center space-x-1 text-xs leading-none ${\n                                  parseFloat(growthPercentage) > 0 ? 'text-emerald-600' : 'text-red-500'\n                                }`}>\n                                  {parseFloat(growthPercentage) > 0 ? \n                                    <TrendingUp className=\"w-3 h-3 shrink-0\" /> : \n                                    <TrendingDown className=\"w-3 h-3 shrink-0\" />\n                                  }\n                                  <span className=\"font-mono text-xs whitespace-nowrap\">\n                                    {parseFloat(growthPercentage) > 0 ? '+' : ''}{growthPercentage}%\n                                  </span>\n                                </div>\n                              )\n                            )}\n                          </div>\n                        </td>\n                      );\n                    })}\n                  </tr>\n\n                  {!localCollapsedGroups.has(categoryGroup.category) && \n                    categoryGroup.products.map((product, productIndex) => (\n                      <tr \n                        key={`${categoryGroup.category}-${product.product}`}\n                        className=\"bg-white hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 border-b border-gray-200 transition-all duration-300 hover:shadow-lg animate-in slide-in-from-left-2 fade-in duration-300 cursor-pointer h-9 max-h-9\"\n                        onClick={() => onRowClick?.({\n                          drillDownContext: 'yoy-product-total',\n                          filterCriteria: { product: product.product },\n                          name: `${product.product} (YoY Total)`,\n                          product: product.product,\n                          rawData: product.rawData,\n                        })}\n                      >\n                        <td className=\"w-[30rem] px-12 py-3 text-left sticky left-0 bg-white hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 border-r border-slate-100 z-10 cursor-pointer transition-all duration-300 whitespace-nowrap overflow-hidden text-ellipsis\">\n                          <div className=\"flex items-center space-x-3\">\n                            <span className=\"text-slate-400 text-xs\">→</span>\n                            <span className=\"text-slate-700 font-medium text-xs\">{product.product}</span>\n                          </div>\n                        </td>\n                        \n                        {visibleMonths.map(({ key }, monthIndex) => {\n                          // Calculate grouping borders\n                          const prevMonth = monthIndex > 0 ? visibleMonths[monthIndex - 1] : null;\n                          const nextMonth = monthIndex < visibleMonths.length - 1 ? visibleMonths[monthIndex + 1] : null;\n                          const currentMonth = visibleMonths[monthIndex].month;\n                          \n                          const isFirstOfGroup = !prevMonth || prevMonth.month !== currentMonth;\n                          const isLastOfGroup = !nextMonth || nextMonth.month !== currentMonth;\n                          \n                          const current = product.monthlyValues[key] || 0;\n                          const [yearStr, monthStr] = key.split('-');\n                          const prevYear = String(Number(yearStr) - 1);\n                          const previousYearKey = `${prevYear}-${monthStr}`;\n                          const previous = product.monthlyValues[previousYearKey] || 0;\n                          const growthPercentage = getGrowthPercentage(current, previous);\n                          \n                          return (\n                            <td \n                              key={key} \n                              className={`px-2 py-2 text-center text-sm font-mono text-slate-700 border-gray-200 hover:bg-blue-100/50 cursor-pointer transition-all duration-200 ${\n                                isFirstOfGroup ? 'border-l-2 border-slate-400' : 'border-l'\n                              } ${\n                                isLastOfGroup ? 'border-r-2 border-slate-400' : ''\n                              }`}\n                              onClick={(e) => {\n                                e.stopPropagation();\n                const monthItems = (product.rawData as SalesData[]).filter(item => {\n                  const itemDate = parseDate((item as any).paymentDate);\n                  return itemDate && `${itemDate.getFullYear()}-${String(itemDate.getMonth() + 1).padStart(2, '0')}` === key;\n                });\n                                onRowClick?.({\n                                  drillDownContext: 'yoy-product-month',\n                                  filterCriteria: { product: product.product, month: key },\n                                  name: `${product.product} (${key})`,\n                                  product: product.product,\n                                  month: key,\n                                  rawData: monthItems,\n                                })\n                              }}\n                              title={growthPercentage ? `${growthPercentage}% vs same month last year` : ''}\n                            >\n                              <div className=\"flex flex-col items-center space-y-0.5 min-h-6 justify-center\">\n                                {displayMode === 'values' ? (\n                                  <span className=\"text-xs whitespace-nowrap\">{formatMetricValue(current, selectedMetric)}</span>\n                                ) : (\n                                  growthPercentage && (\n                                    <div className={`flex items-center justify-center space-x-1 text-xs leading-none ${\n                                      parseFloat(growthPercentage) > 0 ? 'text-emerald-600' : 'text-red-500'\n                                    }`}>\n                                      {parseFloat(growthPercentage) > 0 ? \n                                        <TrendingUp className=\"w-3 h-3 shrink-0\" /> : \n                                        <TrendingDown className=\"w-3 h-3 shrink-0\" />\n                                      }\n                                      <span className=\"font-mono text-xs whitespace-nowrap\">\n                                        {parseFloat(growthPercentage) > 0 ? '+' : ''}{growthPercentage}%\n                                      </span>\n                                    </div>\n                                  )\n                                )}\n                              </div>\n                            </td>\n                          );\n                        })}\n                      </tr>\n                    ))\n                  }\n                </React.Fragment>\n              ))}\n              \n              {/* Totals Row */}\n              <tr \n                className=\"bg-slate-800 text-white font-bold border-t-2 border-slate-400 h-10 max-h-10 cursor-pointer hover:bg-slate-700\"\n                onClick={() => onRowClick?.({\n                  drillDownContext: 'yoy-grand-total',\n                  filterCriteria: {},\n                  name: 'Grand Total (YoY)',\n                  rawData: allHistoricData,\n                  isGroup: true,\n                })}\n              >\n                <td className=\"w-96 px-4 py-2 text-left sticky left-0 bg-slate-800 group-hover:bg-slate-700 border-r border-slate-400 z-20\">\n                  <div className=\"flex items-center space-x-2 min-h-6\">\n                    <span className=\"font-bold text-sm text-white\">TOTALS</span>\n                  </div>\n                </td>\n                \n                {visibleMonths.map(({ key, year, month }, monthIndex) => {\n                  // Calculate grouping borders\n                  const prevMonth = monthIndex > 0 ? visibleMonths[monthIndex - 1] : null;\n                  const nextMonth = monthIndex < visibleMonths.length - 1 ? visibleMonths[monthIndex + 1] : null;\n                  \n                  const isFirstOfGroup = !prevMonth || prevMonth.month !== month;\n                  const isLastOfGroup = !nextMonth || nextMonth.month !== month;\n                  \n                  const isPreviousMonth = key === previousMonthKey;\n                  // Use allHistoricData filtered by month to compute totals, preserving averaging\n                  const monthItems = allHistoricData.filter(item => {\n                    const itemDate = parseDate(item.paymentDate);\n                    return itemDate && itemDate.getFullYear() === year && itemDate.getMonth() + 1 === month;\n                  });\n                  const totalValue = getMetricValue(monthItems, selectedMetric);\n                  \n                  return (\n                    <td \n                      key={key} \n                      className={`px-2 py-2 text-center text-sm font-bold text-white border-slate-400 group-hover:bg-slate-700 ${\n                        isFirstOfGroup ? 'border-l-2' : 'border-l'\n                      } ${\n                        isLastOfGroup ? 'border-r-2' : ''\n                      }`}\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        const monthItems = allHistoricData.filter(item => {\n                            const itemDate = parseDate(item.paymentDate);\n                            return itemDate && `${itemDate.getFullYear()}-${String(itemDate.getMonth() + 1).padStart(2, '0')}` === key;\n                        });\n                        onRowClick?.({\n                          drillDownContext: 'yoy-total-month',\n                          filterCriteria: { month: key },\n                          name: `Grand Total (${key})`,\n                          month: key,\n                          rawData: monthItems,\n                        })\n                      }}\n                    >\n                      <div className=\"flex flex-col items-center space-y-0.5 min-h-6 justify-center\">\n                        <span className=\"font-mono text-xs whitespace-nowrap\">{formatMetricValue(totalValue, selectedMetric)}</span>\n                      </div>\n                    </td>\n                  );\n                })}\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </ModernTableWrapper>\n      \n      {/* Persistent Footer */}\n      <PersistentTableFooter\n        tableId=\"year-on-year-analysis\"\n        initialText=\"• Year-on-year analysis reveals growth patterns and seasonal trends\\n• Strong quarterly performance indicators with year-over-year improvements\\n• Key growth drivers identified across product categories\"\n        className=\"animate-in slide-in-from-bottom-4 fade-in duration-1000 delay-300\"\n      />\n    </div>\n  );\n};\n\n// Memoized export with custom comparison function\nexport const EnhancedYearOnYearTableNew = React.memo(\n  EnhancedYearOnYearTableNewComponent,\n  (prevProps, nextProps) => {\n    return (\n      prevProps.data === nextProps.data &&\n      prevProps.selectedMetric === nextProps.selectedMetric &&\n      shallowEqual(prevProps.filters, nextProps.filters) &&\n      prevProps.collapsedGroups === nextProps.collapsedGroups &&\n      prevProps.onRowClick === nextProps.onRowClick &&\n      prevProps.onGroupToggle === nextProps.onGroupToggle &&\n      prevProps.onReady === nextProps.onReady\n    );\n  }\n);","import React, { useMemo, useState, useCallback, useRef } from 'react';\nimport { SalesData, FilterOptions, YearOnYearMetricType } from '@/types/dashboard';\nimport { ModernTableWrapper, ModernGroupBadge, ModernMetricTabs, STANDARD_METRICS } from './ModernTableWrapper';\nimport { PersistentTableFooter } from '@/components/dashboard/PersistentTableFooter';\nimport { formatCurrency, formatNumber, formatPercentage } from '@/utils/formatters';\nimport { ChevronDown, ChevronRight, Calendar, TrendingUp, TrendingDown, Star } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { shallowEqual } from '@/utils/performanceUtils';\nimport { useTableCopyContext } from '@/hooks/useTableCopyContext';\n\ninterface MonthOnMonthTableNewProps {\n  data: SalesData[];\n  onRowClick?: (row: any) => void;\n  filters?: FilterOptions;\n  collapsedGroups?: Set<string>;\n  onGroupToggle?: (groups: Set<string>) => void;\n  selectedMetric?: YearOnYearMetricType;\n  onReady?: () => void;\n  contextInfo?: {\n    selectedMetric?: string;\n    dateRange?: { start: string; end: string };\n    location?: string;\n    filters?: Record<string, any>;\n    additionalInfo?: Record<string, any>;\n  };\n}\n\nconst groupDataByCategory = (data: SalesData[]) => {\n  return data.reduce((acc: Record<string, any>, item) => {\n    const category = item.cleanedCategory || 'Uncategorized';\n    const product = item.cleanedProduct || 'Unspecified';\n    if (!acc[category]) {\n      acc[category] = {};\n    }\n    if (!acc[category][product]) {\n      acc[category][product] = [];\n    }\n    acc[category][product].push(item);\n    return acc;\n  }, {});\n};\n\nconst MonthOnMonthTableNewComponent: React.FC<MonthOnMonthTableNewProps> = ({\n  data,\n  onRowClick,\n  filters = {\n    dateRange: { start: '', end: '' },\n    location: [],\n    category: [],\n    product: [],\n    soldBy: [],\n    paymentMethod: []\n  },\n  collapsedGroups = new Set(),\n  onGroupToggle = () => {},\n  selectedMetric: initialMetric = 'revenue',\n  onReady,\n  contextInfo\n}) => {\n  const [selectedMetric, setSelectedMetric] = useState<YearOnYearMetricType>(initialMetric);\n  const tableRef = useRef<HTMLTableElement>(null);\n  const [localCollapsedGroups, setLocalCollapsedGroups] = useState<Set<string>>(new Set());\n  const [displayMode, setDisplayMode] = useState<'values' | 'growth'>('values');\n  const [sortKey, setSortKey] = useState<string>('total');\n  const [sortDir, setSortDir] = useState<'desc' | 'asc'>('desc');\n  const [isInitialized, setIsInitialized] = useState(false);\n\n  // Get context information for enhanced table copying\n  const copyContext = useTableCopyContext();\n\n  // Keep local collapsed groups in sync if parent provides a controlled Set\n  React.useEffect(() => {\n    if (!collapsedGroups) return;\n    // Compare contents to avoid unnecessary updates\n    const isSame = (a: Set<string>, b: Set<string>) => {\n      if (a.size !== b.size) return false;\n      for (const v of a) if (!b.has(v)) return false;\n      return true;\n    };\n    if (!isSame(localCollapsedGroups, collapsedGroups)) {\n      setLocalCollapsedGroups(new Set(collapsedGroups));\n    }\n  }, [collapsedGroups]);\n\n  // Get previous month key for highlighting\n  const getPreviousMonthKey = () => {\n    const now = new Date();\n    const prevMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\n    return `${prevMonth.getFullYear()}-${String(prevMonth.getMonth() + 1).padStart(2, '0')}`;\n  };\n  const previousMonthKey = getPreviousMonthKey();\n\n  const parseDate = (dateStr: string): Date | null => {\n    if (!dateStr) return null;\n    const ddmmyyyy = dateStr.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})$/);\n    if (ddmmyyyy) {\n      const [, day, month, year] = ddmmyyyy;\n      return new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n    }\n    const date = new Date(dateStr);\n    return isNaN(date.getTime()) ? null : date;\n  };\n\n  const getMetricValue = (items: SalesData[], metric: YearOnYearMetricType) => {\n    if (!items.length) return 0;\n    // Use NET revenue: paymentValue - VAT\n    const totalRevenue = items.reduce((sum, item) => {\n      const payment = item.paymentValue || 0;\n      const vat = item.paymentVAT || item.vat || 0;\n      return sum + (payment - vat);\n    }, 0);\n    \n    // Transactions = unique count of payment transaction ID\n    const uniqueTransactionIds = new Set(items.map(item => item.paymentTransactionId || item.transactionId).filter(Boolean));\n    const totalTransactions = uniqueTransactionIds.size > 0 ? uniqueTransactionIds.size : items.length;\n    \n    // Members = unique count of member ID\n    const uniqueMembers = new Set(items.map(item => item.memberId).filter(Boolean)).size;\n    \n    // Units Sold = unique count of sales item ID\n    const uniqueSalesItemIds = new Set(items.map(item => item.salesItemId || item.itemId || item.saleItemId).filter(Boolean));\n    const totalUnits = uniqueSalesItemIds.size > 0 ? uniqueSalesItemIds.size : items.length;\n    \n    const totalDiscountAmount = items.reduce((sum, item) => sum + (item.discountAmount || 0), 0);\n    const totalVat = items.reduce((sum, item) => sum + (item.paymentVAT || item.vat || 0), 0);\n    // Calculate discount percentage correctly: Total Discounts / (Total Gross Revenue) * 100\n    const totalGrossRevenue = items.reduce((sum, item) => sum + (item.paymentValue || 0), 0);\n    const avgDiscountPercentage = totalGrossRevenue > 0 ? \n      (totalDiscountAmount / totalGrossRevenue) * 100 : 0;\n    \n    // Purchase Frequency in Days\n    const dates = items.map(item => {\n      const dateStr = item.paymentDate;\n      if (!dateStr) return null;\n      const ddmmyyyy = dateStr.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})$/);\n      if (ddmmyyyy) {\n        const [, day, month, year] = ddmmyyyy;\n        return new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n      }\n      return new Date(dateStr);\n    }).filter((date): date is Date => date !== null && !isNaN(date.getTime())).sort((a, b) => a.getTime() - b.getTime());\n    \n    let purchaseFrequency = 0;\n    if (dates.length > 1) {\n      const totalDays = (dates[dates.length - 1].getTime() - dates[0].getTime()) / (1000 * 60 * 60 * 24);\n      purchaseFrequency = totalDays / (dates.length - 1);\n    }\n\n    switch (metric) {\n      case 'revenue': return totalRevenue;\n      case 'transactions': return totalTransactions;\n      case 'members': return uniqueMembers;\n      case 'units': return totalUnits;\n      case 'atv': return totalTransactions > 0 ? totalRevenue / totalTransactions : 0;\n      case 'auv': return uniqueMembers > 0 ? totalRevenue / uniqueMembers : 0;\n      case 'asv': return uniqueMembers > 0 ? totalRevenue / uniqueMembers : 0; // ASV = Gross Sales / Unique Members\n      case 'upt': return totalTransactions > 0 ? totalUnits / totalTransactions : 0;\n      case 'vat': return totalVat;\n      case 'discountValue': return totalDiscountAmount;\n      case 'discountAmount': return totalDiscountAmount;\n      case 'discountPercentage': return avgDiscountPercentage;\n      case 'purchaseFrequency': return purchaseFrequency;\n      default: return 0;\n    }\n  };\n\n  const formatMetricValue = (value: number, metric: YearOnYearMetricType) => {\n    switch (metric) {\n      case 'revenue':\n      case 'auv':\n      case 'atv':\n      case 'asv':\n      case 'vat':\n      case 'discountValue':\n      case 'discountAmount':\n        return formatCurrency(value);\n      case 'transactions':\n      case 'members':\n      case 'units':\n        return formatNumber(value);\n      case 'upt':\n        return value.toFixed(1);\n      case 'discountPercentage':\n        return `${value.toFixed(1)}%`;\n      case 'purchaseFrequency':\n        return `${value.toFixed(1)} days`;\n      default:\n        return formatNumber(value);\n    }\n  };\n\n  const monthlyData = useMemo(() => {\n    const months = [];\n    const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n    const now = new Date();\n    const currentYear = now.getFullYear();\n    const currentMonth = now.getMonth();\n\n    // Generate months from Jan 2024 to current month in ASCENDING order\n    const startDate = new Date(2024, 0, 1); // January 2024\n    const endDate = new Date(currentYear, currentMonth, 1);\n    \n    let date = new Date(startDate);\n    while (date <= endDate) {\n      const year = date.getFullYear();\n      const month = date.getMonth() + 1;\n      const monthName = monthNames[date.getMonth()];\n      months.push({\n        key: `${year}-${String(month).padStart(2, '0')}`,\n        display: `${monthName} ${year}`,\n        year: year,\n        month: month,\n        quarter: Math.ceil(month / 3)\n      });\n      date = new Date(year, date.getMonth() + 1, 1);\n    }\n    return months;\n  }, []);\n\n  const processedData = useMemo(() => {\n    const grouped = groupDataByCategory(data);\n    const categories = Object.entries(grouped).map(([category, products]) => {\n      const categoryData = {\n        category,\n        products: Object.entries(products).map(([product, items]) => {\n          const monthlyValues: Record<string, number> = {};\n\n          monthlyData.forEach(({ key, year, month }) => {\n            const monthItems = (items as SalesData[]).filter(item => {\n              const itemDate = parseDate(item.paymentDate);\n              return itemDate && itemDate.getFullYear() === year && itemDate.getMonth() + 1 === month;\n            });\n            monthlyValues[key] = getMetricValue(monthItems, selectedMetric);\n          });\n\n          return {\n            product,\n            monthlyValues,\n            rawData: items,\n            totalValue: getMetricValue(items as SalesData[], selectedMetric)\n          };\n        })\n      };\n\n      const categoryMonthlyValues: Record<string, number> = {};\n      monthlyData.forEach(({ key, year, month }) => {\n        // Compute from raw items to ensure averages (ATV/AUV/ASV/UPT/Discount %) are correct\n        const monthItems = (categoryData.products.flatMap(p => p.rawData) as SalesData[]).filter(item => {\n          const itemDate = parseDate(item.paymentDate);\n          return itemDate && itemDate.getFullYear() === year && itemDate.getMonth() + 1 === month;\n        });\n        categoryMonthlyValues[key] = getMetricValue(monthItems, selectedMetric);\n      });\n      \n      return {\n        ...categoryData,\n        monthlyValues: categoryMonthlyValues,\n        products: categoryData.products.sort((a, b) => b.totalValue - a.totalValue)\n      };\n    });\n    \n    const comparator = (a: any, b: any) => {\n      const byMonth = (obj: any, key: string) => obj.monthlyValues?.[key] || 0;\n      let av: number, bv: number;\n      if (sortKey === 'total') {\n        const sumVals = (obj: any): number => {\n          const vals = Object.values(obj?.monthlyValues ?? {}) as number[];\n          return vals.reduce((sum: number, val: number) => sum + (typeof val === 'number' ? val : Number(val || 0)), 0);\n        };\n        av = sumVals(a);\n        bv = sumVals(b);\n      } else {\n        av = byMonth(a, sortKey);\n        bv = byMonth(b, sortKey);\n      }\n      return sortDir === 'desc' ? bv - av : av - bv;\n    };\n    return categories.sort(comparator);\n  }, [data, selectedMetric, monthlyData, sortKey, sortDir]);\n\n  // Set all categories as collapsed by default on first load\n  React.useEffect(() => {\n    if (processedData.length > 0 && !isInitialized) {\n      const allCategories = new Set(processedData.map(cat => cat.category));\n      setLocalCollapsedGroups(allCategories);\n      setIsInitialized(true);\n    }\n  }, [processedData, isInitialized]);\n\n  const toggleGroup = useCallback((groupKey: string) => {\n    setLocalCollapsedGroups(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(groupKey)) {\n        newSet.delete(groupKey);\n      } else {\n        newSet.add(groupKey);\n      }\n      // Inform parent immediately to avoid effect-driven loops\n      onGroupToggle?.(newSet);\n      return newSet;\n    });\n  }, [onGroupToggle]);\n\n  const handleCollapseAll = useCallback(() => {\n    const allGroups = new Set(processedData.map(item => item.category));\n    setLocalCollapsedGroups(allGroups);\n    onGroupToggle?.(allGroups);\n  }, [processedData, onGroupToggle]);\n\n  // Show the full descending range (current month back to Jan 2024)\n  const visibleMonths = useMemo(() => monthlyData, [monthlyData]);\n\n  // Notify parent when ready (once)\n  const [readySent, setReadySent] = React.useState(false);\n  React.useEffect(() => {\n    if (!readySent && processedData.length > 0 && visibleMonths.length > 0) {\n      setReadySent(true);\n      onReady?.();\n    }\n  }, [readySent, processedData, visibleMonths, onReady]);\n\n  // Prepare data for AI analysis\n  const aiTableData = useMemo(() => {\n    const flatData: any[] = [];\n    processedData.forEach(categoryGroup => {\n      categoryGroup.products.forEach(product => {\n        const monthlyEntries = Object.fromEntries(\n          // Use the entire range from current month back to Jan 2024\n          visibleMonths.map(({ key }) => [\n            `month_${key}`, product.monthlyValues[key] || 0\n          ])\n        );\n        \n        flatData.push({\n          category: categoryGroup.category,\n          product: product.product,\n          totalValue: product.totalValue,\n          totalItems: (product.rawData as SalesData[]).length,\n          totalRevenue: (product.rawData as SalesData[]).reduce((sum, item) => sum + (item.paymentValue || 0), 0),\n          uniqueMembers: new Set((product.rawData as SalesData[]).map(item => item.memberId)).size,\n          ...monthlyEntries\n        });\n      });\n    });\n    return flatData;\n  }, [processedData, monthlyData, visibleMonths]);\n\n  const aiTableColumns = useMemo(() => {\n    const baseColumns = [\n      { key: 'category', header: 'Category', type: 'text' as const },\n      { key: 'product', header: 'Product', type: 'text' as const },\n      { key: 'totalValue', header: `Total ${selectedMetric}`, type: selectedMetric === 'revenue' || selectedMetric === 'atv' || selectedMetric === 'auv' ? 'currency' as const : 'number' as const },\n      { key: 'totalItems', header: 'Total Items', type: 'number' as const },\n      { key: 'totalRevenue', header: 'Total Revenue', type: 'currency' as const },\n      { key: 'uniqueMembers', header: 'Unique Members', type: 'number' as const }\n    ];\n\n    const monthColumns = visibleMonths.map(({ key, display }) => ({\n      key: `month_${key}`,\n      header: display,\n      type: selectedMetric === 'revenue' || selectedMetric === 'atv' || selectedMetric === 'auv' ? 'currency' as const : 'number' as const\n    }));\n\n    return [...baseColumns, ...monthColumns];\n  }, [monthlyData, selectedMetric, visibleMonths]);\n\n  const handleExpandAll = useCallback(() => {\n    const empty = new Set<string>();\n    setLocalCollapsedGroups(empty);\n    onGroupToggle?.(empty);\n  }, [onGroupToggle]);\n\n  const getGrowthPercentage = (current: number, previous: number) => {\n    if (previous === 0 && current === 0) return null;\n    if (previous === 0) return '+100';\n    return ((current - previous) / previous * 100).toFixed(1);\n  };\n\n  // Function to generate content for all metric tabs\n  const generateAllTabsContent = useCallback(async () => {\n    let allContent = `Month-on-Month Analysis - All Metrics\\n`;\n    allContent += `Exported on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}\\n`;\n    allContent += `\\n${'='.repeat(80)}\\n\\n`;\n\n    // Loop through all metrics from STANDARD_METRICS\n    for (const metricInfo of STANDARD_METRICS) {\n      const metric = metricInfo.key as YearOnYearMetricType;\n\n      allContent += `\\n${metricInfo.label.toUpperCase()}\\n`;\n      allContent += `${'-'.repeat(metricInfo.label.length + 10)}\\n\\n`;\n\n      // Add table headers\n      const headers = ['Category / Product', 'Total'];\n      visibleMonths.forEach(month => headers.push(month.display));\n      allContent += headers.join('\\t') + '\\n';\n      allContent += headers.map(() => '---').join('\\t') + '\\n';\n\n      // Reprocess data specifically for this metric\n      const grouped = groupDataByCategory(data);\n      const metricProcessedData = Object.entries(grouped).map(([category, products]) => {\n        const categoryProducts = Object.entries(products).map(([product, items]) => {\n          const monthlyValues: Record<string, number> = {};\n\n          monthlyData.forEach(({ key, year, month }) => {\n            const monthItems = (items as SalesData[]).filter(item => {\n              const itemDate = parseDate(item.paymentDate);\n              return itemDate && itemDate.getFullYear() === year && itemDate.getMonth() + 1 === month;\n            });\n            monthlyValues[key] = getMetricValue(monthItems, metric);\n          });\n\n          return {\n            product,\n            monthlyValues,\n            totalValue: getMetricValue(items as SalesData[], metric)\n          };\n        });\n\n        const categoryMonthlyValues: Record<string, number> = {};\n        monthlyData.forEach(({ key }) => {\n          categoryMonthlyValues[key] = categoryProducts.reduce(\n            (sum, product) => sum + (product.monthlyValues[key] || 0),\n            0\n          );\n        });\n\n        return {\n          category,\n          products: categoryProducts,\n          monthlyValues: categoryMonthlyValues,\n          totalValue: categoryProducts.reduce((sum, product) => sum + product.totalValue, 0)\n        };\n      });\n\n      // Add data rows\n      metricProcessedData.forEach(categoryGroup => {\n        // Category row\n        const categoryTotal = categoryGroup.totalValue;\n        const categoryRow = [categoryGroup.category, formatMetricValue(categoryTotal, metric)];\n        \n        visibleMonths.forEach(month => {\n          const value = categoryGroup.monthlyValues[month.key] || 0;\n          categoryRow.push(formatMetricValue(value, metric));\n        });\n        allContent += categoryRow.join('\\t') + '\\n';\n\n        // Product rows (include all products for export)\n        categoryGroup.products.forEach(product => {\n          const productTotal = product.totalValue;\n          const productRow = [`  ${product.product}`, formatMetricValue(productTotal, metric)];\n          \n          visibleMonths.forEach(month => {\n            const value = product.monthlyValues[month.key] || 0;\n            productRow.push(formatMetricValue(value, metric));\n          });\n          allContent += productRow.join('\\t') + '\\n';\n        });\n      });\n\n      allContent += `\\n`;\n    }\n\n    return allContent;\n  }, [data, visibleMonths, monthlyData]);\n\n  // visibleMonths already defined above\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Modern Metric Selector */}\n      <ModernMetricTabs\n        metrics={STANDARD_METRICS}\n        selectedMetric={selectedMetric}\n        onMetricChange={(metric) => setSelectedMetric(metric as YearOnYearMetricType)}\n        className=\"mb-4\"\n      />\n      <ModernTableWrapper\n        title=\"Month-on-Month Analysis\"\n        description=\"Comprehensive monthly performance comparison across categories and products\"\n        icon={<Calendar className=\"w-5 h-5 text-white\" />}\n        totalItems={processedData.reduce((sum, cat) => sum + cat.products.length, 0)}\n        collapsedGroups={localCollapsedGroups}\n        onCollapseAll={handleCollapseAll}\n        onExpandAll={handleExpandAll}\n        showDisplayToggle={true}\n        displayMode={displayMode}\n        onDisplayModeChange={setDisplayMode}\n        tableRef={tableRef}\n        showCopyButton={true}\n        onCopyAllTabs={generateAllTabsContent}\n        contextInfo={{\n          selectedMetric: contextInfo?.selectedMetric || selectedMetric,\n          dateRange: contextInfo?.dateRange || copyContext.dateRange,\n          location: contextInfo?.location,\n          filters: contextInfo?.filters || copyContext.filters,\n          additionalInfo: {\n            ...contextInfo?.additionalInfo,\n            displayMode: displayMode,\n            totalItems: processedData.reduce((sum, cat) => sum + cat.products.length, 0),\n            collapsedGroups: Array.from(localCollapsedGroups),\n            sortBy: sortKey,\n            sortDirection: sortDir\n          }\n        }}\n      >\n        <div className=\"overflow-x-auto\">\n          <table ref={tableRef} className=\"min-w-full bg-white\">\n            <thead className=\"sticky top-0 z-30\">\n              <tr className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n                <th\n                  className=\"w-96 px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide sticky left-0 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 z-40 border-r border-white/20 cursor-pointer select-none\"\n                  onClick={() => {\n                    if (sortKey !== 'total') { setSortKey('total'); setSortDir('desc'); }\n                    else setSortDir(d => d === 'desc' ? 'asc' : 'desc');\n                  }}\n                  title={`Sort by total (${sortDir})`}\n                >\n                  <div className=\"flex items-center space-x-2\">\n                    <Calendar className=\"w-4 h-4 text-white\" />\n                    <span>Category / Product</span>\n                  </div>\n                </th>\n                \n                {visibleMonths.map(({ key, display }) => {\n                  const isPreviousMonth = key === previousMonthKey;\n                  return (\n                  <th\n                    key={key}\n                    className={`px-3 py-3 text-center font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[90px] cursor-pointer select-none ${\n                      isPreviousMonth \n                        ? 'bg-blue-800 text-white' \n                        : 'text-white'\n                    }`}\n                    onClick={() => {\n                      if (sortKey !== key) { setSortKey(key); setSortDir('desc'); }\n                      else setSortDir(d => d === 'desc' ? 'asc' : 'desc');\n                    }}\n                    title={`Sort by ${display} (${sortDir})${isPreviousMonth ? ' - Main Month' : ''}`}\n                  >\n                    <div className=\"flex flex-col items-center\">\n                      <div className=\"flex items-center space-x-1\">\n                        {isPreviousMonth && <Star className=\"w-3 h-3\" />}\n                        <span className=\"text-xs font-bold whitespace-nowrap\">{display.split(' ')[0]}</span>\n                      </div>\n                      <span className=\"text-slate-300 text-xs\">{display.split(' ')[1]}</span>\n                    </div>\n                  </th>\n                  );\n                })}\n              </tr>\n            </thead>\n\n            <tbody>\n              {processedData.map((categoryGroup, categoryIndex) => {\n                const categoryTotalValue = Object.values(categoryGroup.monthlyValues).reduce((sum, val) => sum + val, 0);\n                \n                return (\n                  <React.Fragment key={categoryGroup.category}>\n                    {/* Category Row */}\n                    <tr className=\"group bg-slate-100 border-b border-slate-400 font-semibold hover:bg-slate-200 transition-all duration-200 h-12\">\n                      <td \n                        className=\"w-96 px-4 py-2 text-left sticky left-0 bg-slate-100 group-hover:bg-slate-200 border-r border-slate-300 z-20 cursor-pointer transition-all duration-200\"\n                        onClick={(e) => {\n                          const target = e.target as HTMLElement;\n                          if (target.closest('button')) return;\n                          \n                          onRowClick?.({\n                            type: 'category',\n                            category: categoryGroup.category,\n                            data: categoryGroup.products,\n                            metric: selectedMetric,\n                            value: categoryTotalValue\n                          });\n                        }}\n                      >\n                        <div className=\"flex items-center space-x-2 min-h-8\">\n                          <Button \n                            variant=\"ghost\" \n                            size=\"sm\" \n                            onClick={(e) => {\n                              e.stopPropagation();\n                              toggleGroup(categoryGroup.category);\n                            }} \n                            className=\"p-1 h-5 w-5 rounded text-slate-600 hover:text-slate-800 hover:bg-white/50 transition-all duration-200 shrink-0\"\n                          >\n                            {localCollapsedGroups.has(categoryGroup.category) ? \n                              <ChevronRight className=\"w-3 h-3\" /> : \n                              <ChevronDown className=\"w-3 h-3\" />\n                            }\n                          </Button>\n                          <div className=\"flex items-center space-x-2 flex-1\">\n                            <span className=\"font-bold text-sm text-slate-800 truncate\">{categoryGroup.category}</span>\n                          </div>\n                        </div>\n                      </td>\n                      \n                      {visibleMonths.map(({ key }, monthIndex) => {\n                        const current = categoryGroup.monthlyValues[key] || 0;\n                        // Since months are now ascending (Jan 2024 first), previous month is at monthIndex - 1\n                        const previousMonthKeyData = monthIndex > 0 ? visibleMonths[monthIndex - 1]?.key : null;\n                        const previous = previousMonthKeyData ? (categoryGroup.monthlyValues[previousMonthKeyData] || 0) : 0;\n                        const growthPercentage = monthIndex > 0 ? getGrowthPercentage(current, previous) : null;\n                        const isPreviousMonth = key === previousMonthKey;\n                        \n                        return (\n                          <td \n                            key={key} \n                            className=\"px-2 py-2 text-center text-sm font-bold border-l transition-all duration-200 cursor-pointer text-slate-800 border-slate-300 hover:bg-slate-100\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              onRowClick?.({\n                                drillDownContext: 'mom-category-month',\n                                filterCriteria: { category: categoryGroup.category, month: key },\n                                name: `${categoryGroup.category} (${key})`,\n                                category: categoryGroup.category,\n                                month: key,\n                              });\n                            }}\n                            title={growthPercentage ? `${growthPercentage}% vs previous month` : ''}\n                          >\n                            <div className=\"flex flex-col items-center space-y-0.5 min-h-6 justify-center\">\n                              {displayMode === 'values' ? (\n                                <span className=\"font-mono text-xs whitespace-nowrap\">{formatMetricValue(current, selectedMetric)}</span>\n                              ) : (\n                                growthPercentage && (\n                                  <div className={`flex items-center space-x-1 text-xs ${\n                                    parseFloat(growthPercentage) > 0 ? 'text-emerald-600' : 'text-red-500'\n                                  }`}>\n                                    {parseFloat(growthPercentage) > 0 ? \n                                      <TrendingUp className=\"w-2 h-2\" /> : \n                                      <TrendingDown className=\"w-2 h-2\" />\n                                    }\n                                    <span className=\"font-mono\">{Math.abs(parseFloat(growthPercentage))}%</span>\n                                  </div>\n                                )\n                              )}\n                            </div>\n                          </td>\n                        );\n                      })}\n                    </tr>\n\n                    {/* Product Rows */}\n                    {!localCollapsedGroups.has(categoryGroup.category) && \n                      categoryGroup.products.map((product, productIndex) => (\n                        <tr \n                          key={`${categoryGroup.category}-${product.product}`}\n                          className=\"bg-white hover:bg-slate-50 border-b border-gray-200 transition-all duration-200 h-12\"\n                        >\n                        <td \n                          className=\"w-96 px-8 py-2 text-left sticky left-0 bg-white hover:bg-slate-50 border-r border-gray-200 z-10 cursor-pointer transition-all duration-200\"\n                          onClick={() => {\n                            onRowClick?.({\n                              drillDownContext: 'mom-product-all',\n                              filterCriteria: { product: product.product, category: categoryGroup.category },\n                              name: product.product,\n                              product: product.product,\n                              category: categoryGroup.category,\n                            });\n                          }}\n                        >\n                          <div className=\"flex items-center space-x-2 min-h-8\">\n                              <span className=\"text-slate-400 text-xs\">→</span>\n                              <span className=\"text-slate-700 font-medium text-sm truncate\">{product.product}</span>\n                            </div>\n                          </td>\n                          \n                          {visibleMonths.map(({ key }, monthIndex) => {\n                            const current = product.monthlyValues[key] || 0;\n                            // Since months are now ascending (Jan 2024 first), previous month is at monthIndex - 1\n                            const previousMonthKeyData = monthIndex > 0 ? visibleMonths[monthIndex - 1]?.key : null;\n                            const previous = previousMonthKeyData ? (product.monthlyValues[previousMonthKeyData] || 0) : 0;\n                            const growthPercentage = monthIndex > 0 ? getGrowthPercentage(current, previous) : null;\n                            const isPreviousMonth = key === previousMonthKey;\n                            \n                            return (\n                              <td \n                                key={key} \n                                className=\"px-2 py-2 text-center text-sm font-mono border-l border-gray-200 cursor-pointer transition-all duration-200 text-slate-700 hover:bg-slate-100\"\n                                onClick={(e) => {\n                                  e.stopPropagation();\n                                  onRowClick?.({\n                                    drillDownContext: 'mom-product-month',\n                                    filterCriteria: { product: product.product, category: categoryGroup.category, month: key },\n                                    name: `${product.product} (${key})`,\n                                    product: product.product,\n                                    category: categoryGroup.category,\n                                    month: key,\n                                  });\n                                }}\n                                title={growthPercentage ? `${growthPercentage}% vs previous month` : ''}\n                              >\n                                <div className=\"flex flex-col items-center space-y-0.5 min-h-6 justify-center\">\n                                  {displayMode === 'values' ? (\n                                    <span className=\"text-xs whitespace-nowrap\">{formatMetricValue(current, selectedMetric)}</span>\n                                  ) : (\n                                    growthPercentage && (\n                                      <div className={`flex items-center space-x-1 text-xs ${\n                                        parseFloat(growthPercentage) > 0 ? 'text-emerald-500' : 'text-red-400'\n                                      }`}>\n                                        {parseFloat(growthPercentage) > 0 ? \n                                          <TrendingUp className=\"w-2 h-2\" /> : \n                                          <TrendingDown className=\"w-2 h-2\" />\n                                        }\n                                        <span className=\"font-mono\">{Math.abs(parseFloat(growthPercentage))}%</span>\n                                      </div>\n                                    )\n                                  )}\n                                </div>\n                              </td>\n                            );\n                          })}\n                        </tr>\n                      ))\n                    }\n                  </React.Fragment>\n                );\n              })}\n              \n              {/* Totals Row */}\n              <tr className=\"bg-slate-800 text-white font-bold border-t-2 border-slate-400 h-10 max-h-10\">\n                <td className=\"w-96 px-4 py-2 text-left sticky left-0 bg-slate-800 border-r border-slate-400 z-20\">\n                  <div className=\"flex items-center space-x-2 min-h-6\">\n                    <span className=\"font-bold text-sm text-white\">TOTALS</span>\n                  </div>\n                </td>\n                \n                {visibleMonths.map(({ key, year, month }) => {\n                  const isPreviousMonth = key === previousMonthKey;\n                  // Derive from all data in the month so average-type metrics are correct\n                  const monthItems = (data as SalesData[]).filter(item => {\n                    const itemDate = parseDate(item.paymentDate);\n                    return itemDate && itemDate.getFullYear() === year && itemDate.getMonth() + 1 === month;\n                  });\n                  const totalValue = getMetricValue(monthItems, selectedMetric);\n                  \n                  return (\n                    <td \n                      key={key} \n                      className=\"px-2 py-2 text-center text-sm font-bold text-white border-l border-slate-400 hover:bg-slate-700 cursor-pointer transition-all duration-200\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        onRowClick?.({\n                          drillDownContext: 'mom-total-month',\n                          filterCriteria: { month: key },\n                          name: `All Products (${key})`,\n                          month: key,\n                        });\n                      }}\n                    >\n                      <div className=\"flex flex-col items-center space-y-0.5 min-h-6 justify-center\">\n                        <span className=\"font-mono text-xs whitespace-nowrap\">{formatMetricValue(totalValue, selectedMetric)}</span>\n                      </div>\n                    </td>\n                  );\n                })}\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </ModernTableWrapper>\n      \n      {/* Persistent Footer */}\n      <PersistentTableFooter\n        tableId=\"month-on-month-analysis\"\n        initialText=\"• Monthly performance trends across all product categories • Growth patterns and seasonal variations • Key performance indicators by category and product\"\n        tableData={aiTableData}\n        tableColumns={aiTableColumns}\n        tableName=\"Month-on-Month Performance Analysis\"\n        tableContext={`Detailed monthly performance tracking by category and product showing ${selectedMetric} trends over ${visibleMonths.length} months`}\n      />\n    </div>\n  );\n};\n\n// Memoize component with custom comparison\nexport const MonthOnMonthTableNew = React.memo(\n  MonthOnMonthTableNewComponent,\n  (prevProps, nextProps) => {\n    // Custom comparison to prevent unnecessary re-renders\n    return (\n      prevProps.data === nextProps.data &&\n      prevProps.selectedMetric === nextProps.selectedMetric &&\n      prevProps.onRowClick === nextProps.onRowClick &&\n      prevProps.onReady === nextProps.onReady &&\n      shallowEqual(prevProps.filters, nextProps.filters) &&\n      prevProps.collapsedGroups === nextProps.collapsedGroups &&\n      prevProps.onGroupToggle === nextProps.onGroupToggle\n    );\n  }\n);","import React, { useMemo, useState, useCallback, useRef } from 'react';\nimport { SalesData, YearOnYearMetricType } from '@/types/dashboard';\nimport { ModernTableWrapper, ModernGroupBadge, ModernMetricTabs, STANDARD_METRICS } from './ModernTableWrapper';\nimport { PersistentTableFooter } from '@/components/dashboard/PersistentTableFooter';\nimport { formatCurrency, formatNumber } from '@/utils/formatters';\nimport { ChevronDown, ChevronRight, FolderOpen, TrendingUp, TrendingDown, BarChart3, DollarSign, Users, ShoppingCart, Target, Layers, Star } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { shallowEqual } from '@/utils/performanceUtils';\nimport { useTableCopyContext } from '@/hooks/useTableCopyContext';\n\ninterface CategoryPerformanceTableNewProps {\n  data: SalesData[];\n  onRowClick: (row: any) => void;\n  selectedMetric?: YearOnYearMetricType;\n  onReady?: () => void;\n}\n\nexport const CategoryPerformanceTableNewComponent: React.FC<CategoryPerformanceTableNewProps> = ({\n  data,\n  onRowClick,\n  selectedMetric: initialMetric = 'revenue',\n  onReady\n}) => {\n  const [selectedMetric, setSelectedMetric] = useState<YearOnYearMetricType>(initialMetric);\n  const tableRef = useRef<HTMLTableElement>(null);\n  const [localCollapsedGroups, setLocalCollapsedGroups] = useState<Set<string>>(new Set());\n  const [displayMode, setDisplayMode] = useState<'values' | 'growth'>('values');\n  const [sortKey, setSortKey] = useState<string>('total');\n  const [sortDir, setSortDir] = useState<'desc' | 'asc'>('desc');\n\n  // Get context information for enhanced table copying\n  const copyContext = useTableCopyContext();\n  \n  const getPreviousMonthKey = () => {\n    const now = new Date();\n    const prevMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\n    return `${prevMonth.getFullYear()}-${String(prevMonth.getMonth() + 1).padStart(2, '0')}`;\n  };\n  const previousMonthKey = getPreviousMonthKey();\n\n  const parseDate = (dateStr: string): Date | null => {\n    if (!dateStr) return null;\n    const ddmmyyyy = dateStr.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})$/);\n    if (ddmmyyyy) {\n      const [, day, month, year] = ddmmyyyy;\n      return new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n    }\n    const date = new Date(dateStr);\n    return isNaN(date.getTime()) ? null : date;\n  };\n\n  const getMetricValue = (items: SalesData[], metric: YearOnYearMetricType) => {\n    if (!items.length) return 0;\n    // Use NET revenue: paymentValue - VAT\n    const totalRevenue = items.reduce((sum, item) => {\n      const payment = item.paymentValue || 0;\n      const vat = item.paymentVAT || item.vat || 0;\n      return sum + (payment - vat);\n    }, 0);\n    \n    // Transactions = unique count of payment transaction ID\n    const uniqueTransactionIds = new Set(items.map(item => item.paymentTransactionId || item.transactionId).filter(Boolean));\n    const totalTransactions = uniqueTransactionIds.size > 0 ? uniqueTransactionIds.size : items.length;\n    \n    // Members = unique count of member ID\n    const uniqueMembers = new Set(items.map(item => item.memberId).filter(Boolean)).size;\n    \n    // Units Sold = unique count of sales item ID\n    const uniqueSalesItemIds = new Set(items.map(item => item.salesItemId || item.itemId).filter(Boolean));\n    const totalUnits = uniqueSalesItemIds.size > 0 ? uniqueSalesItemIds.size : items.length;\n    \n    // VAT and Discount\n    const totalVat = items.reduce((sum, item) => sum + (item.paymentVAT || item.vat || 0), 0);\n    const totalDiscount = items.reduce((sum, item) => sum + (item.discountAmount || 0), 0);\n    \n    // Calculate discount percentage correctly: Total Discounts / (Total Gross Revenue) * 100\n    const totalGrossRevenue = items.reduce((sum, item) => sum + (item.paymentValue || 0), 0);\n    const avgDiscountPercentage = totalGrossRevenue > 0\n      ? (totalDiscount / totalGrossRevenue) * 100\n      : 0;\n    \n    // Purchase Frequency in Days\n    const dates = items.map(item => {\n      const dateStr = item.paymentDate;\n      if (!dateStr) return null;\n      const ddmmyyyy = dateStr.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})$/);\n      if (ddmmyyyy) {\n        const [, day, month, year] = ddmmyyyy;\n        return new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n      }\n      return new Date(dateStr);\n    }).filter((date): date is Date => date !== null && !isNaN(date.getTime())).sort((a, b) => a.getTime() - b.getTime());\n    \n    let purchaseFrequency = 0;\n    if (dates.length > 1) {\n      const totalDays = (dates[dates.length - 1].getTime() - dates[0].getTime()) / (1000 * 60 * 60 * 24);\n      purchaseFrequency = totalDays / (dates.length - 1);\n    }\n\n    switch (metric) {\n      case 'revenue': return totalRevenue;\n      case 'transactions': return totalTransactions;\n      case 'members': return uniqueMembers;\n      case 'units': return totalUnits;\n      case 'atv': return totalTransactions > 0 ? totalRevenue / totalTransactions : 0;\n      case 'auv': return uniqueMembers > 0 ? totalRevenue / uniqueMembers : 0;\n      case 'asv': return uniqueMembers > 0 ? totalRevenue / uniqueMembers : 0; // ASV = Gross Sales / Unique Members\n      case 'upt': return totalTransactions > 0 ? totalUnits / totalTransactions : 0;\n      case 'vat': return totalVat;\n      case 'discountAmount': return totalDiscount;\n      case 'discountPercentage': return avgDiscountPercentage;\n      case 'purchaseFrequency': return purchaseFrequency;\n      default: return 0;\n    }\n  };\n\n  const formatMetricValue = (value: number, metric: YearOnYearMetricType) => {\n    switch (metric) {\n      case 'revenue':\n      case 'auv':\n      case 'atv':\n      case 'asv':\n      case 'vat':\n      case 'discountAmount':\n        return formatCurrency(value);\n      case 'transactions':\n      case 'members':\n      case 'units':\n        return formatNumber(value);\n      case 'upt':\n        return value.toFixed(1);\n      case 'discountPercentage':\n        return `${value.toFixed(1)}%`;\n      case 'purchaseFrequency':\n        return `${value.toFixed(1)} days`;\n      default:\n        return formatNumber(value);\n    }\n  };\n\n  const monthlyData = useMemo(() => {\n    const months = [];\n    const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n    const now = new Date();\n    const currentYear = now.getFullYear();\n    const currentMonth = now.getMonth();\n\n    // Generate months from Jan 2024 to current month in ASCENDING order\n    const startDate = new Date(2024, 0, 1); // January 2024\n    const endDate = new Date(currentYear, currentMonth, 1);\n    \n    let date = new Date(startDate);\n    while (date <= endDate) {\n      const year = date.getFullYear();\n      const month = date.getMonth() + 1;\n      const monthName = monthNames[date.getMonth()];\n      months.push({\n        key: `${year}-${String(month).padStart(2, '0')}`,\n        display: `${monthName} ${year}`,\n        year: year,\n        month: month,\n        quarter: Math.ceil(month / 3)\n      });\n      date = new Date(year, date.getMonth() + 1, 1);\n    }\n    return months;\n  }, []);\n\n  const processedData = useMemo(() => {\n    // Group by category\n    const categoryGroups = data.reduce((acc: Record<string, SalesData[]>, item) => {\n      const category = item.cleanedCategory || 'Uncategorized';\n      if (!acc[category]) {\n        acc[category] = [];\n      }\n      acc[category].push(item);\n      return acc;\n    }, {});\n\n  const categoryData = Object.entries(categoryGroups).map(([category, items]) => {\n      const monthlyValues: Record<string, number> = {};\n      \n      monthlyData.forEach(({ key, year, month }) => {\n        const monthItems = items.filter(item => {\n          const itemDate = parseDate(item.paymentDate);\n          return itemDate && itemDate.getFullYear() === year && itemDate.getMonth() + 1 === month;\n        });\n        monthlyValues[key] = getMetricValue(monthItems, selectedMetric);\n      });\n\n      // Get unique products in this category\n      const uniqueProducts = new Set(items.map(item => item.cleanedProduct || 'Unknown')).size;\n\n      return {\n        category,\n        monthlyValues,\n        totalValue: getMetricValue(items, selectedMetric),\n        totalRevenue: items.reduce((sum, item) => {\n          const payment = item.paymentValue || 0;\n          const vat = item.paymentVAT || item.vat || 0;\n          return sum + (payment - vat);\n        }, 0),\n        totalTransactions: items.length,\n        uniqueMembers: new Set(items.map(item => item.memberId)).size,\n        uniqueProducts,\n        rawData: items\n      };\n    });\n\n    const comparator = (a: any, b: any) => {\n      const byMonth = (obj: any, key: string) => obj.monthlyValues?.[key] || 0;\n      let av: number, bv: number;\n      if (sortKey === 'total') { av = a.totalValue; bv = b.totalValue; }\n      else { av = byMonth(a, sortKey); bv = byMonth(b, sortKey); }\n      return sortDir === 'desc' ? bv - av : av - bv;\n    };\n    return categoryData.sort(comparator);\n  }, [data, selectedMetric, monthlyData, sortKey, sortDir]);\n\n  // monthlyData here is built in descending order (current back); show the entire range to Jan 2024\n  const visibleMonths = useMemo(() => monthlyData, [monthlyData]);\n\n  // Notify parent when ready\n  const [readySent, setReadySent] = React.useState(false);\n  React.useEffect(() => {\n    if (!readySent && processedData.length > 0 && visibleMonths.length > 0) {\n      setReadySent(true);\n      onReady?.();\n    }\n  }, [readySent, processedData, visibleMonths, onReady]);\n\n  const getGrowthPercentage = (current: number, previous: number) => {\n    if (previous === 0 && current === 0) return null;\n    if (previous === 0) return '+100';\n    return ((current - previous) / previous * 100).toFixed(1);\n  };\n\n  // Function to generate content for all metric tabs\n  const generateAllTabsContent = useCallback(async () => {\n    let allContent = `Category Performance Analysis - All Metrics\\n`;\n    allContent += `Exported on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}\\n`;\n    allContent += `\\n${'='.repeat(80)}\\n\\n`;\n\n    // Loop through all metrics from STANDARD_METRICS\n    for (const metricInfo of STANDARD_METRICS) {\n      const metric = metricInfo.key as YearOnYearMetricType;\n\n      allContent += `\\n${metricInfo.label.toUpperCase()}\\n`;\n      allContent += `${'-'.repeat(metricInfo.label.length + 10)}\\n\\n`;\n\n      // Add table headers\n      const headers = ['Category', 'Total'];\n      visibleMonths.forEach(month => headers.push(month.display));\n      allContent += headers.join('\\t') + '\\n';\n      allContent += headers.map(() => '---').join('\\t') + '\\n';\n\n      // Reprocess data specifically for this metric\n      const categoryData = data.reduce((acc: Record<string, SalesData[]>, item) => {\n        const category = item.cleanedCategory || 'Uncategorized';\n        if (!acc[category]) acc[category] = [];\n        acc[category].push(item);\n        return acc;\n      }, {});\n\n      const metricProcessedData = Object.entries(categoryData).map(([category, items]) => {\n        const monthlyValues: Record<string, number> = {};\n        \n        monthlyData.forEach(({ key, year, month }) => {\n          const monthItems = items.filter(item => {\n            const itemDate = parseDate(item.paymentDate);\n            return itemDate && itemDate.getFullYear() === year && itemDate.getMonth() + 1 === month;\n          });\n          monthlyValues[key] = getMetricValue(monthItems, metric);\n        });\n\n        return {\n          category,\n          monthlyValues,\n          totalValue: getMetricValue(items, metric)\n        };\n      });\n\n      // Add data rows\n      metricProcessedData.forEach(categoryData => {\n        const categoryRow = [categoryData.category, formatMetricValue(categoryData.totalValue, metric)];\n        \n        visibleMonths.forEach(month => {\n          const value = categoryData.monthlyValues[month.key] || 0;\n          categoryRow.push(formatMetricValue(value, metric));\n        });\n        allContent += categoryRow.join('\\t') + '\\n';\n      });\n\n      allContent += `\\n`;\n    }\n\n    return allContent;\n  }, [data, visibleMonths, monthlyData]);\n\n  // Prepare data and columns for AI analysis\n  const aiTableData = useMemo(() => {\n    return processedData.map(category => ({\n      category: category.category,\n      totalRevenue: category.totalRevenue,\n      totalTransactions: category.totalTransactions,\n      uniqueMembers: category.uniqueMembers,\n      uniqueProducts: category.uniqueProducts,\n      avgTransactionValue: category.totalTransactions > 0 ? category.totalRevenue / category.totalTransactions : 0,\n      avgRevenuePerMember: category.uniqueMembers > 0 ? category.totalRevenue / category.uniqueMembers : 0,\n      ...Object.fromEntries(\n        visibleMonths.map(({ key }) => [\n          `month_${key}`, category.monthlyValues[key] || 0\n        ])\n      )\n    }));\n  }, [processedData, monthlyData, visibleMonths]);\n\n  const aiTableColumns = useMemo(() => {\n    const baseColumns = [\n      { key: 'category', header: 'Category', type: 'text' as const },\n      { key: 'totalRevenue', header: 'Total Revenue', type: 'currency' as const },\n      { key: 'totalTransactions', header: 'Total Transactions', type: 'number' as const },\n      { key: 'uniqueMembers', header: 'Unique Members', type: 'number' as const },\n      { key: 'uniqueProducts', header: 'Unique Products', type: 'number' as const },\n      { key: 'avgTransactionValue', header: 'Avg Transaction Value', type: 'currency' as const },\n      { key: 'avgRevenuePerMember', header: 'Avg Revenue per Member', type: 'currency' as const }\n    ];\n\n    const monthColumns = visibleMonths.map(({ key, display }) => ({\n      key: `month_${key}`,\n      header: `${display}`,\n      type: selectedMetric === 'revenue' || selectedMetric === 'atv' || selectedMetric === 'auv' ? 'currency' as const : 'number' as const\n    }));\n\n    return [...baseColumns, ...monthColumns];\n  }, [monthlyData, selectedMetric, visibleMonths]);\n\n\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Modern Metric Selector */}\n      <ModernMetricTabs\n        metrics={STANDARD_METRICS}\n        selectedMetric={selectedMetric}\n        onMetricChange={(metric) => setSelectedMetric(metric as YearOnYearMetricType)}\n      />\n\n      <ModernTableWrapper\n        title=\"Category Performance Analysis\"\n        description=\"High-level category performance overview with comprehensive metrics and trends\"\n        icon={<Layers className=\"w-6 h-6 text-white\" />}\n        totalItems={processedData.length}\n        showDisplayToggle={true}\n        displayMode={displayMode}\n        onDisplayModeChange={setDisplayMode}\n        className=\"animate-in slide-in-from-bottom-8 fade-in duration-1000\"\n        tableRef={tableRef}\n        showCopyButton={true}\n        onCopyAllTabs={generateAllTabsContent}\n        contextInfo={{\n          selectedMetric: selectedMetric,\n          dateRange: copyContext.dateRange,\n          filters: copyContext.filters,\n          additionalInfo: {\n            displayMode: displayMode,\n            totalItems: processedData.length,\n            sortBy: sortKey,\n            sortDirection: sortDir\n          }\n        }}\n      >\n        <div className=\"overflow-x-auto\" data-table=\"category-performance-analysis\">\n          <table ref={tableRef} className=\"min-w-full bg-white\">\n            <thead className=\"sticky top-0 z-30\">\n              <tr className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n                <th\n                  className=\"w-[30rem] px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide sticky left-0 z-40 border-r border-white/20 cursor-pointer select-none\"\n                  onClick={() => {\n                    if (sortKey !== 'total') { setSortKey('total'); setSortDir('desc'); }\n                    else setSortDir(d => d === 'desc' ? 'asc' : 'desc');\n                  }}\n                  title={`Sort by total (${sortDir})`}\n                >\n                  <div className=\"flex items-center space-x-2\">\n                    <FolderOpen className=\"w-4 h-4 text-white\" />\n                    <span>Category</span>\n                  </div>\n                </th>\n                \n                {visibleMonths.map(({ key, display }) => {\n                  const isPreviousMonth = key === previousMonthKey;\n                  return (\n                  <th\n                    key={key}\n                    className={`px-3 py-3 text-center font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[90px] cursor-pointer select-none ${\n                      isPreviousMonth \n                        ? 'bg-blue-800 text-white' \n                        : 'text-white'\n                    }`}\n                    onClick={() => {\n                      if (sortKey !== key) { setSortKey(key); setSortDir('desc'); }\n                      else setSortDir(d => d === 'desc' ? 'asc' : 'desc');\n                    }}\n                    title={`Sort by ${display} (${sortDir})${isPreviousMonth ? ' - Main Month' : ''}`}\n                  >\n                    <div className=\"flex flex-col items-center\">\n                      <div className=\"flex items-center space-x-1\">\n                        {isPreviousMonth && <Star className=\"w-3 h-3\" />}\n                        <span className=\"text-xs font-bold whitespace-nowrap\">{display.split(' ')[0]}</span>\n                      </div>\n                      <span className=\"text-slate-300 text-xs\">{display.split(' ')[1]}</span>\n                    </div>\n                  </th>\n                  );\n                })}\n              </tr>\n            </thead>\n\n            <tbody>\n              {processedData.map((category, categoryIndex) => (\n                <tr \n                  key={category.category}\n                  className=\"bg-white hover:bg-slate-50 border-b border-gray-200 transition-all duration-200 h-9 max-h-9\"\n                  onClick={() => onRowClick?.({\n                    ...category,\n                    contextType: 'category',\n                    drillDownContext: 'category-performance',\n                    filterCriteria: {\n                      category: category.category\n                    },\n                    clickedItemName: category.category,\n                    contextDescription: `Complete performance analysis for ${category.category} category`\n                  })}\n                >\n                  <td className=\"w-[30rem] px-4 py-2 text-left sticky left-0 bg-white hover:bg-slate-50 border-r border-gray-200 z-20 cursor-pointer transition-all duration-200 whitespace-nowrap overflow-hidden text-ellipsis\">\n                    <div className=\"flex items-center space-x-2 min-h-8\">\n                      <div className=\"flex items-center space-x-2 flex-1\">\n                        <span className=\"text-slate-700 font-medium text-sm whitespace-nowrap\">{category.category}</span>\n                      </div>\n                    </div>\n                  </td>\n                  \n                  {visibleMonths.map(({ key }, monthIndex) => {\n                    const current = category.monthlyValues[key] || 0;\n                    const previousMonthKey = visibleMonths[monthIndex + 1]?.key;\n                    const previous = previousMonthKey ? (category.monthlyValues[previousMonthKey] || 0) : 0;\n                    const growthPercentage = monthIndex < visibleMonths.length - 1 ? getGrowthPercentage(current, previous) : null;\n                    \n                    return (\n                      <td \n                        key={key} \n                        className=\"px-2 py-2 text-center text-sm font-mono text-slate-700 border-l border-gray-200 hover:bg-slate-100 cursor-pointer transition-all duration-200\"\n                        title={growthPercentage ? `${growthPercentage}% vs previous month` : ''}\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          onRowClick?.({\n                            ...category,\n                            contextType: 'category-month',\n                            filterCriteria: {\n                              category: category.category,\n                              month: key,\n                              specificValue: current\n                            },\n                            drillDownContext: {\n                              type: 'category-month',\n                              itemName: category.category,\n                              month: key,\n                              value: current,\n                              metric: selectedMetric\n                            },\n                            clickedItemName: category.category,\n                            contextDescription: `${category.category} performance in ${key}: ${formatMetricValue(current, selectedMetric)}`\n                          });\n                        }}\n                      >\n                        <div className=\"flex flex-col items-center space-y-0.5 min-h-6 justify-center\">\n                          {displayMode === 'values' ? (\n                            <span className=\"text-xs whitespace-nowrap\">{formatMetricValue(current, selectedMetric)}</span>\n                          ) : (\n                            growthPercentage && (\n                              <div className={`flex items-center space-x-1 text-xs ${\n                                parseFloat(growthPercentage) > 0 ? 'text-emerald-500' : 'text-red-400'\n                              }`}>\n                                {parseFloat(growthPercentage) > 0 ? \n                                  <TrendingUp className=\"w-2 h-2\" /> : \n                                  <TrendingDown className=\"w-2 h-2\" />\n                                }\n                                <span className=\"font-mono\">{Math.abs(parseFloat(growthPercentage))}%</span>\n                              </div>\n                            )\n                          )}\n                        </div>\n                      </td>\n                    );\n                  })}\n                </tr>\n              ))}\n              \n              {/* Totals Row */}\n              <tr \n                className=\"bg-slate-800 text-white font-bold border-t-2 border-slate-400 h-10 max-h-10 cursor-pointer hover:bg-slate-700\"\n                onClick={() => onRowClick?.({\n                  drillDownContext: 'category-grand-total',\n                  filterCriteria: {},\n                  name: 'Grand Total (All Categories)',\n                  rawData: data,\n                  isGroup: true,\n                })}\n              >\n                <td className=\"w-80 px-4 py-2 text-left sticky left-0 bg-slate-800 group-hover:bg-slate-700 border-r border-slate-400 z-20\">\n                  <div className=\"flex items-center space-x-2 min-h-6\">\n                    <span className=\"font-bold text-sm text-white\">TOTALS</span>\n                  </div>\n                </td>\n                \n                {visibleMonths.map(({ key }) => {\n                  const totalValue = processedData.reduce((sum, category) => {\n                    return sum + (category.monthlyValues[key] || 0);\n                  }, 0);\n                  \n                  return (\n                    <td \n                      key={key} \n                      className=\"px-2 py-2 text-center text-sm font-bold text-white border-l border-slate-400 group-hover:bg-slate-700\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        onRowClick?.({\n                          drillDownContext: 'category-total-month',\n                          filterCriteria: { month: key },\n                          name: `Grand Total (${key})`,\n                          month: key,\n                        })\n                      }}\n                    >\n                      <div className=\"flex flex-col items-center space-y-0.5 min-h-6 justify-center\">\n                        <span className=\"font-mono text-xs whitespace-nowrap\">{formatMetricValue(totalValue, selectedMetric)}</span>\n                      </div>\n                    </td>\n                  );\n                })}\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </ModernTableWrapper>\n      \n      {/* Persistent Footer */}\n      <PersistentTableFooter\n        tableId=\"category-performance-analysis\"\n        initialText=\"• Category-level performance insights across all product lines\\n• Revenue distribution and market share analysis by category\\n• Growth trends and seasonal patterns identification\"\n        className=\"animate-in slide-in-from-bottom-4 fade-in duration-1000 delay-300\"\n        tableData={aiTableData}\n        tableColumns={aiTableColumns}\n        tableName=\"Category Performance Analysis\"\n        tableContext={`Performance analysis by product category showing ${selectedMetric} trends across ${visibleMonths.length} months`}\n      />\n    </div>\n  );\n};\n\n// Memoized export with custom comparison function\nexport const CategoryPerformanceTableNew = React.memo(\n  CategoryPerformanceTableNewComponent,\n  (prevProps, nextProps) => {\n    return (\n      prevProps.data === nextProps.data &&\n      prevProps.selectedMetric === nextProps.selectedMetric &&\n      prevProps.onRowClick === nextProps.onRowClick &&\n      prevProps.onReady === nextProps.onReady\n    );\n  }\n);","import React, { useMemo, useState, useCallback } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { SalesData } from '@/types/dashboard';\nimport { formatCurrency, formatNumber } from '@/utils/formatters';\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell, Legend, AreaChart, Area } from 'recharts';\nimport { TrendingUp, BarChart3, PieChart as PieChartIcon, LineChart as LineChartIcon, Calendar } from 'lucide-react';\nimport { motion } from 'framer-motion';\n\n// Darker sales-themed palette (deep blues) to match the Sales tab headers\n// Tailwind references: blue-900, blue-800, blue-700, blue-600, indigo-900\nconst SALES_DARK_PALETTE = [\n  '#1e3a8a', // blue-900 (primary stroke)\n  '#1e40af', // blue-800 (primary fill)\n  '#1d4ed8', // blue-700\n  '#2563eb', // blue-600 (accent)\n  '#312e81', // indigo-900\n  '#3730a3', // indigo-800\n  '#4338ca', // indigo-700\n  '#0f172a', // slate-900 (deep accent)\n];\n\n// Custom Tooltip with a dark, sales-themed design and correct value formatting\nconst CustomTooltip = ({ active, payload, label }: any) => {\n  if (active && payload && payload.length) {\n    return (\n      <div className=\"p-3 bg-slate-900/90 text-white backdrop-blur-xl rounded-lg shadow-xl border border-slate-700/70\">\n        <p className=\"label font-semibold text-white/90 mb-1\">{`${label}`}</p>\n        {payload.map((pld: any, index: number) => (\n          <div key={index} className=\"flex items-center space-x-2\">\n            <div style={{ width: 10, height: 10, backgroundColor: pld.color, borderRadius: '50%' }} />\n            <span className=\"font-medium text-white/80\">{`${pld.name}: `}</span>\n            <span className=\"font-mono font-semibold text-white\">\n              {['revenue', 'value'].includes(String(pld.name)) ? formatCurrency(pld.value) : formatNumber(pld.value)}\n            </span>\n          </div>\n        ))}\n      </div>\n    );\n  }\n  return null;\n};\n\n// A custom Bar component to create the 3D effect\nconst CustomBar = (props: any) => {\n  const { fill, x, y, width, height } = props;\n  \n  // Create a pseudo-3D effect by layering shapes\n  return (\n    <g>\n      <rect x={x} y={y} width={width} height={height} fill={fill} />\n      {/* Top face - slightly lighter to emulate light source */}\n      <path d={`M${x},${y} L${x + 8},${y - 5} L${x + width + 8},${y - 5} L${x + width},${y} Z`} fill=\"#ffffff\" fillOpacity={0.08} />\n      {/* Side face - slightly darker shadow */}\n      <path d={`M${x + width},${y} L${x + width + 8},${y - 5} L${x + width + 8},${y + height - 5} L${x + width},${y + height} Z`} fill=\"#000000\" fillOpacity={0.15} />\n    </g>\n  );\n};\n\ninterface SalesInteractiveChartsProps {\n  data: SalesData[];\n}\n\nexport const SalesInteractiveCharts: React.FC<SalesInteractiveChartsProps> = React.memo(({ data }) => {\n  const [timeRange, setTimeRange] = useState('6m');\n  const [activeChart, setActiveChart] = useState('revenue');\n  const [productMetric, setProductMetric] = useState('revenue');\n\n  // Filter data based on time range\n  const filteredData = useMemo(() => {\n    if (!data || data.length === 0) return [];\n    \n    const now = new Date();\n    let startDate = new Date();\n    \n    switch (timeRange) {\n      case '1m':\n        startDate.setMonth(now.getMonth() - 1);\n        break;\n      case '3m':\n        startDate.setMonth(now.getMonth() - 3);\n        break;\n      case '6m':\n        startDate.setMonth(now.getMonth() - 6);\n        break;\n      case '1y':\n        startDate.setFullYear(now.getFullYear() - 1);\n        break;\n      default:\n        return data;\n    }\n    \n    return data.filter(item => {\n      if (!item.paymentDate) return false;\n      const itemDate = new Date(item.paymentDate);\n      return itemDate >= startDate && itemDate <= now;\n    });\n  }, [data, timeRange]);\n\n  // Monthly revenue trend data\n  const monthlyRevenueData = useMemo(() => {\n    if (!filteredData.length) return [];\n    \n    const monthlyGroups = filteredData.reduce((acc, item) => {\n      if (!item.paymentDate) return acc;\n      const date = new Date(item.paymentDate);\n      const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;\n      \n      if (!acc[monthKey]) {\n        acc[monthKey] = {\n          month: date.toLocaleDateString('en', { month: 'short', year: 'numeric' }),\n          revenue: 0,\n          transactions: 0,\n          customers: new Set()\n        };\n      }\n      \n      acc[monthKey].revenue += item.paymentValue || 0;\n      acc[monthKey].transactions += 1;\n      acc[monthKey].customers.add(item.memberId);\n      \n      return acc;\n    }, {} as Record<string, any>);\n    \n    return Object.values(monthlyGroups).map((group: any) => ({\n      ...group,\n      customers: group.customers.size\n    })).sort((a: any, b: any) => new Date(a.month).getTime() - new Date(b.month).getTime());\n  }, [filteredData]);\n\n  // Top 10 products data\n  const topProductsData = useMemo(() => {\n    if (!filteredData.length) return [];\n    \n    const productGroups = filteredData.reduce((acc, item) => {\n      const product = item.cleanedProduct || 'Unknown Product';\n      \n      if (!acc[product]) {\n        acc[product] = {\n          name: product,\n          revenue: 0,\n          transactions: 0,\n          customers: new Set(),\n          units: 0\n        };\n      }\n      \n      acc[product].revenue += item.paymentValue || 0;\n      acc[product].transactions += 1;\n      acc[product].customers.add(item.memberId);\n      acc[product].units += 1; // Each sale item is one unit\n      \n      return acc;\n    }, {} as Record<string, any>);\n    \n    const products = Object.values(productGroups).map((product: any) => ({\n      ...product,\n      customers: product.customers.size\n    }));\n    \n    // Sort by the selected metric\n    let sortedProducts;\n    switch (productMetric) {\n      case 'transactions':\n        sortedProducts = products.sort((a: any, b: any) => b.transactions - a.transactions);\n        break;\n      case 'customers':\n        sortedProducts = products.sort((a: any, b: any) => b.customers - a.customers);\n        break;\n      case 'units':\n        sortedProducts = products.sort((a: any, b: any) => b.units - a.units);\n        break;\n      default: // revenue\n        sortedProducts = products.sort((a: any, b: any) => b.revenue - a.revenue);\n    }\n    \n    return sortedProducts.slice(0, 10);\n  }, [filteredData, productMetric]);\n\n  // Category distribution data\n  const categoryData = useMemo(() => {\n    if (!filteredData.length) return [];\n    \n    const categoryGroups = filteredData.reduce((acc, item) => {\n      const category = item.cleanedCategory || 'Uncategorized';\n      \n      if (!acc[category]) {\n        acc[category] = 0;\n      }\n      \n      acc[category] += item.paymentValue || 0;\n      \n      return acc;\n    }, {} as Record<string, number>);\n    \n    return Object.entries(categoryGroups)\n      .map(([name, value]) => ({ name, value }))\n      .sort((a, b) => b.value - a.value);\n  }, [filteredData]);\n\n  const handleTimeRangeChange = useCallback((newRange: string) => {\n    setTimeRange(newRange);\n  }, []);\n\n  const handleChartChange = useCallback((newChart: string) => {\n    setActiveChart(newChart);\n  }, []);\n\n  const handleProductMetricChange = useCallback((newMetric: string) => {\n    setProductMetric(newMetric);\n  }, []);\n\n  // Show loading state or empty state if no data\n  if (!data || data.length === 0) {\n    return (\n  <Card className=\"bg-white/70 backdrop-blur-lg border-gray-200/80 shadow-lg rounded-2xl\">\n        <CardHeader>\n          <CardTitle className=\"text-lg font-semibold text-gray-800 flex items-center gap-2\">\n            <BarChart3 className=\"w-5 h-5 text-blue-500\" />\n            Interactive Sales Charts\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"flex items-center justify-center h-64\">\n          <p className=\"text-gray-500\">No data available for charts</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const renderChart = () => {\n    switch (activeChart) {\n      case 'revenue':\n        return (\n          <ResponsiveContainer width=\"100%\" height={400}>\n            <AreaChart data={monthlyRevenueData} margin={{ top: 10, right: 30, left: 20, bottom: 0 }}>\n              <defs>\n                <linearGradient id=\"colorRevenue\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                  <stop offset=\"5%\" stopColor={SALES_DARK_PALETTE[1]} stopOpacity={0.55}/>\n                  <stop offset=\"95%\" stopColor={SALES_DARK_PALETTE[1]} stopOpacity={0}/>\n                </linearGradient>\n              </defs>\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" vertical={false} />\n              <XAxis dataKey=\"month\" tick={{ fill: '#334155', fontSize: 12 }} axisLine={false} tickLine={false} />\n              <YAxis tickFormatter={(value) => formatCurrency(value)} tick={{ fill: '#334155', fontSize: 12 }} axisLine={false} tickLine={false} />\n              <Tooltip content={<CustomTooltip />} />\n              <Area \n                type=\"monotone\" \n                dataKey=\"revenue\" \n                stroke={SALES_DARK_PALETTE[0]}\n                strokeWidth={3}\n                fillOpacity={1}\n                fill=\"url(#colorRevenue)\"\n                dot={{ stroke: SALES_DARK_PALETTE[0], strokeWidth: 2, r: 4, fill: 'white' }}\n                activeDot={{ r: 8, fill: SALES_DARK_PALETTE[0], stroke: 'white', strokeWidth: 2 }}\n              />\n            </AreaChart>\n          </ResponsiveContainer>\n        );\n      \n      case 'products':\n        return (\n          <div className=\"space-y-4\">\n            <div className=\"flex gap-2 flex-wrap\">\n              <Button\n                variant={productMetric === 'revenue' ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={() => handleProductMetricChange('revenue')}\n              >\n                Revenue\n              </Button>\n              <Button\n                variant={productMetric === 'transactions' ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={() => handleProductMetricChange('transactions')}\n              >\n                Transactions\n              </Button>\n              <Button\n                variant={productMetric === 'customers' ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={() => handleProductMetricChange('customers')}\n              >\n                Customers\n              </Button>\n              <Button\n                variant={productMetric === 'units' ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={() => handleProductMetricChange('units')}\n              >\n                Units Sold\n              </Button>\n            </div>\n            <ResponsiveContainer width=\"100%\" height={400}>\n              <BarChart data={topProductsData} margin={{ left: 20, right: 30, top: 20, bottom: 60 }}>\n                <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#e5e7eb\" />\n                <XAxis \n                  dataKey=\"name\" \n                  angle={-45}\n                  textAnchor=\"end\"\n                  height={100}\n                  interval={0}\n                  tick={{ fill: '#334155', fontSize: 12 }}\n                  axisLine={false} tickLine={false}\n                />\n                <YAxis \n                  tickFormatter={(value) => {\n                    if (productMetric === 'revenue') return formatCurrency(value);\n                    return formatNumber(value);\n                  }} \n                  tick={{ fill: '#334155', fontSize: 12 }}\n                  axisLine={false} tickLine={false}\n                />\n                <Tooltip content={<CustomTooltip />} cursor={{fill: 'rgba(230, 230, 230, 0.4)'}} />\n                <Bar dataKey={productMetric} shape={<CustomBar />} fill={SALES_DARK_PALETTE[1]} />\n              </BarChart>\n            </ResponsiveContainer>\n          </div>\n        );\n      \n      case 'categories':\n        return (\n          <ResponsiveContainer width=\"100%\" height={400}>\n            <PieChart>\n              <Pie\n                data={categoryData}\n                cx=\"50%\"\n                cy=\"50%\"\n                labelLine={false}\n                label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\n                outerRadius={150}\n                innerRadius={80}\n                paddingAngle={3}\n                dataKey=\"value\"\n                cornerRadius={8}\n              >\n                {categoryData.map((entry, index) => (\n                  <Cell \n                    key={`cell-${index}`} \n                    fill={SALES_DARK_PALETTE[index % SALES_DARK_PALETTE.length]} \n                    stroke={'#ffffff'}\n                    strokeWidth={2}\n                  />\n                ))}\n              </Pie>\n              <Tooltip content={<CustomTooltip />} />\n              <Legend iconType=\"circle\" wrapperStyle={{ color: '#334155' }} />\n            </PieChart>\n          </ResponsiveContainer>\n        );\n      \n      default:\n        return null;\n    }\n  };\n\n  return (\n    <Card className=\"bg-white/70 backdrop-blur-lg border-gray-200/80 shadow-lg rounded-2xl overflow-hidden\">\n      <CardHeader className=\"pb-4 border-b border-gray-200/80\">\n        <div className=\"flex flex-col gap-4\">\n          <div className=\"flex justify-between items-start\">\n            <CardTitle className=\"text-xl font-semibold text-gray-800 flex items-center gap-3\">\n              <div className=\"p-2 bg-gray-100 rounded-lg border border-gray-200\">\n                <BarChart3 className=\"w-5 h-5 text-gray-600\" />\n              </div>\n              Interactive Sales Charts\n            </CardTitle>\n          </div>\n          \n          {/* Time Range Buttons */}\n          <div className=\"flex gap-2 flex-wrap\">\n            <span className=\"text-sm font-medium text-gray-600 flex items-center gap-1\">\n              <Calendar className=\"w-4 h-4\" />\n              Time Range:\n            </span>\n            {[\n              { key: '1m', label: 'Last Month' },\n              { key: '3m', label: 'Last 3 Months' },\n              { key: '6m', label: 'Last 6 Months' },\n              { key: '1y', label: 'Last Year' }\n            ].map(({ key, label }) => (\n              <Button\n                key={key}\n                variant={timeRange === key ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={() => handleTimeRangeChange(key)}\n                className=\"transition-all duration-300 rounded-full\"\n              >\n                {label}\n              </Button>\n            ))}\n          </div>\n          \n          {/* Chart Type Buttons */}\n          <div className=\"flex gap-2 flex-wrap\">\n            <span className=\"text-sm font-medium text-gray-600 flex items-center gap-1\">\n              <TrendingUp className=\"w-4 h-4\" />\n              Chart Type:\n            </span>\n            <Button\n              variant={activeChart === 'revenue' ? 'default' : 'outline'}\n              size=\"sm\"\n              onClick={() => handleChartChange('revenue')}\n              className=\"flex items-center gap-1 transition-all duration-300 rounded-full\"\n            >\n              <LineChartIcon className=\"w-4 h-4\" />\n              Revenue Trend\n            </Button>\n            <Button\n              variant={activeChart === 'products' ? 'default' : 'outline'}\n              size=\"sm\"\n              onClick={() => handleChartChange('products')}\n              className=\"flex items-center gap-1 transition-all duration-300 rounded-full\"\n            >\n              <BarChart3 className=\"w-4 h-4\" />\n              Top 10 Products\n            </Button>\n            <Button\n              variant={activeChart === 'categories' ? 'default' : 'outline'}\n              size=\"sm\"\n              onClick={() => handleChartChange('categories')}\n              className=\"flex items-center gap-1 transition-all duration-300 rounded-full\"\n            >\n              <PieChartIcon className=\"w-4 h-4\" />\n              Categories\n            </Button>\n          </div>\n        </div>\n      </CardHeader>\n\n      <CardContent className=\"p-6\">\n        <motion.div\n          key={activeChart + productMetric + timeRange}\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.5, ease: \"easeOut\" }}\n        >\n          {renderChart()}\n        </motion.div>\n      </CardContent>\n    </Card>\n  );\n});\n\nSalesInteractiveCharts.displayName = 'SalesInteractiveCharts';\n","import React, { useMemo, useState, useCallback, useRef } from 'react';\nimport { SalesData, YearOnYearMetricType } from '@/types/dashboard';\nimport { ModernTableWrapper, ModernGroupBadge, ModernMetricTabs, STANDARD_METRICS } from './ModernTableWrapper';\nimport { PersistentTableFooter } from '@/components/dashboard/PersistentTableFooter';\nimport { formatCurrency, formatNumber } from '@/utils/formatters';\nimport { ChevronDown, ChevronRight, Users, TrendingUp, TrendingDown, Star } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { getRankingDisplay } from '@/utils/rankingUtils';\nimport { shallowEqual } from '@/utils/performanceUtils';\nimport { useTableCopyContext } from '@/hooks/useTableCopyContext';\nimport { generateStandardMonthRange } from '@/utils/dateUtils';\nimport { cn } from '@/lib/utils';\n\ninterface SoldByMonthOnMonthTableNewProps {\n  data: SalesData[];\n  onRowClick?: (row: any) => void;\n  selectedMetric?: YearOnYearMetricType;\n  onReady?: () => void;\n}\n\nexport const SoldByMonthOnMonthTableNewComponent: React.FC<SoldByMonthOnMonthTableNewProps> = ({\n  data,\n  onRowClick,\n  selectedMetric: initialMetric = 'revenue',\n  onReady\n}) => {\n  const [selectedMetric, setSelectedMetric] = useState<YearOnYearMetricType>(initialMetric);\n  const [displayMode, setDisplayMode] = useState<'values' | 'growth'>('values');\n  const [sortKey, setSortKey] = useState<string>('total');\n  const [sortDir, setSortDir] = useState<'desc' | 'asc'>('desc');\n  const tableRef = useRef<HTMLTableElement>(null);\n\n  // Get context information for enhanced table copying\n  const copyContext = useTableCopyContext();\n\n  const parseDate = (dateStr: string): Date | null => {\n    if (!dateStr) return null;\n    const ddmmyyyy = dateStr.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})$/);\n    if (ddmmyyyy) {\n      const [, day, month, year] = ddmmyyyy;\n      return new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n    }\n    const date = new Date(dateStr);\n    return isNaN(date.getTime()) ? null : date;\n  };\n\n  const getMetricValue = (items: SalesData[], metric: YearOnYearMetricType) => {\n    if (!items.length) return 0;\n    // Use NET revenue: paymentValue - VAT\n    const totalRevenue = items.reduce((sum, item) => {\n      const payment = item.paymentValue || 0;\n      const vat = item.paymentVAT || item.vat || 0;\n      return sum + (payment - vat);\n    }, 0);\n    const totalTransactions = items.length;\n    const uniqueMembers = new Set(items.map(item => item.memberId)).size;\n    const totalUnits = items.length; // Each transaction is 1 unit\n    \n    // Use actual VAT from data, not calculated percentage\n    const totalVat = items.reduce((sum, item) => sum + (item.paymentVAT || item.vat || 0), 0);\n    \n    // Use actual discount data from the items\n    const totalDiscount = items.reduce((sum, item) => sum + (item.discountAmount || 0), 0);\n    \n    // Calculate discount percentage correctly: Total Discounts / (Total Gross Revenue) * 100\n    const totalGrossRevenue = items.reduce((sum, item) => sum + (item.paymentValue || 0), 0);\n    const avgDiscountPercentage = totalGrossRevenue > 0 \n      ? (totalDiscount / totalGrossRevenue) * 100\n      : 0;\n\n    // Calculate purchase frequency (average days between purchases)\n    const calculatePurchaseFrequency = () => {\n      if (uniqueMembers <= 1) return 0;\n      \n      const memberPurchases: Record<string, Date[]> = {};\n      items.forEach(item => {\n        const date = parseDate(item.paymentDate);\n        if (date && item.memberId) {\n          if (!memberPurchases[item.memberId]) {\n            memberPurchases[item.memberId] = [];\n          }\n          memberPurchases[item.memberId].push(date);\n        }\n      });\n      \n      let totalDaysBetweenPurchases = 0;\n      let intervalCount = 0;\n      \n      Object.values(memberPurchases).forEach(dates => {\n        if (dates.length > 1) {\n          dates.sort((a, b) => a.getTime() - b.getTime());\n          for (let i = 1; i < dates.length; i++) {\n            const daysDiff = (dates[i].getTime() - dates[i-1].getTime()) / (1000 * 60 * 60 * 24);\n            totalDaysBetweenPurchases += daysDiff;\n            intervalCount++;\n          }\n        }\n      });\n      \n      return intervalCount > 0 ? totalDaysBetweenPurchases / intervalCount : 0;\n    };\n\n    switch (metric) {\n      case 'revenue': return totalRevenue;\n      case 'transactions': return totalTransactions;\n      case 'members': return uniqueMembers;\n      case 'units': return totalUnits;\n      case 'atv': return totalTransactions > 0 ? totalRevenue / totalTransactions : 0;\n      case 'auv': return uniqueMembers > 0 ? totalRevenue / uniqueMembers : 0;\n      case 'upt': return totalTransactions > 0 ? totalUnits / totalTransactions : 0;\n      case 'asv': return totalTransactions > 0 ? totalRevenue / totalTransactions : 0;\n      case 'vat': return totalVat;\n      case 'discountValue': return totalDiscount;\n      case 'discountPercentage': return avgDiscountPercentage;\n      case 'purchaseFrequency': return calculatePurchaseFrequency();\n      default: return 0;\n    }\n  };\n\n  const formatMetricValue = (value: number, metric: YearOnYearMetricType) => {\n    switch (metric) {\n      case 'revenue':\n      case 'auv':\n      case 'atv':\n      case 'asv':\n      case 'vat':\n      case 'discountValue':\n        return formatCurrency(value);\n      case 'transactions':\n      case 'members':\n      case 'units':\n        return formatNumber(value);\n      case 'upt':\n        return value.toFixed(1);\n      case 'discountPercentage':\n        return `${value.toFixed(1)}%`;\n      case 'purchaseFrequency':\n        return `${value.toFixed(1)} days`;\n      default:\n        return formatNumber(value);\n    }\n  };\n\n  // Use standard month range from Jan 2024 to current month in ASCENDING order\n  const monthlyData = useMemo(() => generateStandardMonthRange(), []);\n  const visibleMonths = useMemo(() => monthlyData, [monthlyData]);\n\n  // Get previous month key for highlighting\n  const getPreviousMonthKey = () => {\n    const now = new Date();\n    const prevMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\n    return `${prevMonth.getFullYear()}-${String(prevMonth.getMonth() + 1).padStart(2, '0')}`;\n  };\n  const previousMonthKey = getPreviousMonthKey();\n\n  const processedData = useMemo(() => {\n    // Group by soldBy\n    const soldByGroups = data.reduce((acc: Record<string, SalesData[]>, item) => {\n      const seller = item.soldBy || 'Unknown';\n      if (!acc[seller]) {\n        acc[seller] = [];\n      }\n      acc[seller].push(item);\n      return acc;\n    }, {});\n\n    const sellerData = Object.entries(soldByGroups).map(([seller, items]) => {\n  const monthlyValues: Record<string, number> = {};\n      \n      visibleMonths.forEach(({ key, year, month }) => {\n        const monthItems = items.filter(item => {\n          const itemDate = parseDate(item.paymentDate);\n          return itemDate && itemDate.getFullYear() === year && itemDate.getMonth() + 1 === month;\n        });\n        monthlyValues[key] = getMetricValue(monthItems, selectedMetric);\n      });\n\n      return {\n        seller,\n        monthlyValues,\n        totalValue: getMetricValue(items, selectedMetric),\n        totalRevenue: items.reduce((sum, item) => {\n          const payment = item.paymentValue || 0;\n          const vat = item.paymentVAT || item.vat || 0;\n          return sum + (payment - vat);\n        }, 0),\n        totalTransactions: items.length,\n        uniqueMembers: new Set(items.map(item => item.memberId)).size,\n        rawData: items\n      };\n    });\n\n    const comparator = (a: any, b: any) => {\n      const byMonth = (obj: any, key: string) => obj.monthlyValues?.[key] || 0;\n      let av: number, bv: number;\n      if (sortKey === 'total') { av = a.totalValue; bv = b.totalValue; }\n      else { av = byMonth(a, sortKey); bv = byMonth(b, sortKey); }\n      return sortDir === 'desc' ? bv - av : av - bv;\n    };\n    return sellerData.sort(comparator);\n  }, [data, selectedMetric, visibleMonths, sortKey, sortDir]);\n\n  // monthlyData here is descending (current back). Use full range to Jan 2024.\n  // visibleMonths is already defined above and reversed properly\n\n  // Notify parent when ready\n  const [readySent, setReadySent] = React.useState(false);\n  React.useEffect(() => {\n    if (!readySent && processedData.length > 0 && visibleMonths.length > 0) {\n      setReadySent(true);\n      onReady?.();\n    }\n  }, [readySent, processedData, visibleMonths, onReady]);\n\n  const getGrowthPercentage = (current: number, previous: number) => {\n    if (previous === 0 && current === 0) return null;\n    if (previous === 0) return '+100';\n    return ((current - previous) / previous * 100).toFixed(1);\n  };\n\n  // Function to generate content for all metric tabs\n  const generateAllTabsContent = useCallback(async () => {\n    let allContent = `Sales Team Performance - All Metrics\\n`;\n    allContent += `Exported on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}\\n`;\n    allContent += `\\n${'='.repeat(80)}\\n\\n`;\n\n    // Loop through all metrics from STANDARD_METRICS\n    for (const metricInfo of STANDARD_METRICS) {\n      const metric = metricInfo.key as YearOnYearMetricType;\n\n      allContent += `\\n${metricInfo.label.toUpperCase()}\\n`;\n      allContent += `${'-'.repeat(metricInfo.label.length + 10)}\\n\\n`;\n\n      // Add table headers\n      const headers = ['Sold By', 'Total'];\n      visibleMonths.forEach(month => headers.push(month.display));\n      allContent += headers.join('\\t') + '\\n';\n      allContent += headers.map(() => '---').join('\\t') + '\\n';\n\n      // Reprocess data specifically for this metric\n      const soldByGroups = data.reduce((acc: Record<string, SalesData[]>, item) => {\n        const soldBy = item.soldBy || 'Unknown';\n        if (!acc[soldBy]) acc[soldBy] = [];\n        acc[soldBy].push(item);\n        return acc;\n      }, {});\n\n      const metricProcessedData = Object.entries(soldByGroups).map(([soldBy, items]) => {\n        const monthlyValues: Record<string, number> = {};\n        \n        monthlyData.forEach(({ key, year, month }) => {\n          const monthItems = items.filter(item => {\n            const itemDate = parseDate(item.paymentDate);\n            return itemDate && itemDate.getFullYear() === year && itemDate.getMonth() + 1 === month;\n          });\n          monthlyValues[key] = getMetricValue(monthItems, metric);\n        });\n\n        return {\n          soldBy,\n          monthlyValues,\n          totalValue: getMetricValue(items, metric)\n        };\n      });\n\n      // Add data rows\n      metricProcessedData.forEach(sellerData => {\n        const sellerRow = [sellerData.soldBy, formatMetricValue(sellerData.totalValue, metric)];\n        \n        visibleMonths.forEach(month => {\n          const value = sellerData.monthlyValues[month.key] || 0;\n          sellerRow.push(formatMetricValue(value, metric));\n        });\n        allContent += sellerRow.join('\\t') + '\\n';\n      });\n\n      allContent += `\\n`;\n    }\n\n    return allContent;\n  }, [data, visibleMonths, monthlyData]);\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Modern Metric Selector */}\n      <ModernMetricTabs\n        metrics={STANDARD_METRICS}\n        selectedMetric={selectedMetric}\n        onMetricChange={(metric) => setSelectedMetric(metric as YearOnYearMetricType)}\n      />\n\n      <ModernTableWrapper\n        title=\"Sales Team Performance\"\n        description=\"Individual seller performance analysis across all metrics and timeframes\"\n        icon={<Users className=\"w-5 h-5 text-white\" />}\n        totalItems={processedData.length}\n        showDisplayToggle={true}\n        displayMode={displayMode}\n        onDisplayModeChange={setDisplayMode}\n        showCollapseControls={false}\n        tableRef={tableRef}\n        showCopyButton={true}\n        onCopyAllTabs={generateAllTabsContent}\n        contextInfo={{\n          ...copyContext.contextInfo,\n          selectedMetric: selectedMetric,\n          additionalInfo: {\n            displayMode: displayMode,\n            totalItems: processedData.length,\n            sortBy: sortKey,\n            sortDirection: sortDir\n          }\n        }}\n      >\n        <div className=\"overflow-x-auto\">\n          <table ref={tableRef} className=\"min-w-full bg-white\">\n            <thead className=\"sticky top-0 z-30\">\n              <tr className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n                <th\n                  className=\"w-80 px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide sticky left-0 bg-gradient-to-r from-slate-800 to-slate-900 z-40 border-r border-white/20 cursor-pointer select-none\"\n                  onClick={() => {\n                    if (sortKey !== 'total') { setSortKey('total'); setSortDir('desc'); }\n                    else setSortDir(d => d === 'desc' ? 'asc' : 'desc');\n                  }}\n                  title={`Sort by total (${sortDir})`}\n                >\n                  <div className=\"flex items-center space-x-2\">\n                    <Users className=\"w-4 h-4 text-white\" />\n                    <span>Sales Representative</span>\n                  </div>\n                </th>\n                \n                {visibleMonths.map(({ key, display }) => {\n                  const isPreviousMonth = key === previousMonthKey;\n                  return (\n                  <th\n                    key={key}\n                    className={`px-3 py-3 text-center font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[90px] cursor-pointer select-none ${\n                      isPreviousMonth \n                        ? 'bg-blue-800 text-white' \n                        : 'text-white'\n                    }`}\n                    onClick={() => {\n                      if (sortKey !== key) { setSortKey(key); setSortDir('desc'); }\n                      else setSortDir(d => d === 'desc' ? 'asc' : 'desc');\n                    }}\n                    title={`Sort by ${display} (${sortDir})${isPreviousMonth ? ' - Main Month' : ''}`}\n                  >\n                    <div className=\"flex flex-col items-center\">\n                      <div className=\"flex items-center space-x-1\">\n                        {isPreviousMonth && <Star className=\"w-3 h-3\" />}\n                        <span className=\"text-xs font-bold whitespace-nowrap\">{display.split(' ')[0]}</span>\n                      </div>\n                      <span className=\"text-slate-300 text-xs\">{display.split(' ')[1]}</span>\n                    </div>\n                  </th>\n                  );\n                })}\n              </tr>\n            </thead>\n\n            <tbody>\n              {processedData.map((seller, sellerIndex) => (\n                <tr \n                  key={seller.seller}\n                  className=\"bg-white hover:bg-slate-50 border-b border-gray-200 transition-all duration-200 h-10 max-h-10\"\n                  onClick={() => onRowClick?.({\n                    ...seller,\n                    contextType: 'soldBy',\n                    drillDownContext: 'soldby-analysis',\n                    filterCriteria: {\n                      soldBy: seller.seller\n                    }\n                  })}\n                >\n                  <td className=\"w-80 px-4 py-2 text-left sticky left-0 bg-white hover:bg-slate-50 border-r border-gray-200 z-20 cursor-pointer transition-all duration-200\">\n                    <div className=\"flex items-center space-x-2 min-h-6\">\n                      <div className=\"flex items-center space-x-2 flex-1\">\n                        <span className=\"text-slate-700 font-medium text-sm truncate\">{seller.seller}</span>\n                      </div>\n                    </div>\n                  </td>\n                  \n                  {visibleMonths.map(({ key }, monthIndex) => {\n                    const current = seller.monthlyValues[key] || 0;\n                    const isPreviousMonth = key === previousMonthKey;\n                    const previousMonthKeyLocal = visibleMonths[monthIndex + 1]?.key;\n                    const previous = previousMonthKeyLocal ? (seller.monthlyValues[previousMonthKeyLocal] || 0) : 0;\n                    const growthPercentage = monthIndex < visibleMonths.length - 1 ? getGrowthPercentage(current, previous) : null;\n                    \n                    return (\n                      <td \n                        key={key} \n                        className=\"px-2 py-2 text-center text-sm font-mono text-slate-700 border-l border-gray-200 hover:bg-slate-100 cursor-pointer transition-all duration-200\"\n                        title={growthPercentage ? `${growthPercentage}% vs previous month${isPreviousMonth ? ' - Main Month' : ''}` : (isPreviousMonth ? 'Main Month' : '')}\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          onRowClick?.({\n                            ...seller,\n                            contextType: 'soldBy-month',\n                            filterCriteria: {\n                              soldBy: seller.seller,\n                              month: key,\n                              specificValue: current\n                            },\n                            drillDownContext: {\n                              type: 'soldBy-month',\n                              itemName: seller.seller,\n                              month: key,\n                              value: current,\n                              metric: selectedMetric\n                            },\n                            clickedItemName: seller.seller,\n                            contextDescription: `${seller.seller} performance in ${key}: ${formatMetricValue(current, selectedMetric)}`\n                          });\n                        }}\n                      >\n                        <div className=\"flex flex-col items-center space-y-0.5 min-h-6 justify-center\">\n                          {displayMode === 'values' ? (\n                            <span className=\"text-xs whitespace-nowrap\">{formatMetricValue(current, selectedMetric)}</span>\n                          ) : (\n                            growthPercentage && (\n                              <div className={`flex items-center space-x-1 text-xs ${\n                                parseFloat(growthPercentage) > 0 ? 'text-emerald-500' : 'text-red-400'\n                              }`}>\n                                {parseFloat(growthPercentage) > 0 ? \n                                  <TrendingUp className=\"w-2 h-2\" /> : \n                                  <TrendingDown className=\"w-2 h-2\" />\n                                }\n                                <span className=\"font-mono\">{Math.abs(parseFloat(growthPercentage))}%</span>\n                              </div>\n                            )\n                          )}\n                        </div>\n                      </td>\n                    );\n                  })}\n                </tr>\n              ))}\n              \n              {/* Totals Row */}\n              <tr \n                className=\"bg-slate-800 text-white font-bold border-t-2 border-slate-400 h-10 max-h-10 cursor-pointer hover:bg-slate-700\"\n                onClick={() => onRowClick?.({\n                  drillDownContext: 'soldby-grand-total',\n                  filterCriteria: {},\n                  name: 'Grand Total (All Sellers)',\n                  rawData: data,\n                  isGroup: true,\n                })}\n              >\n                <td className=\"w-80 px-4 py-2 text-left sticky left-0 bg-slate-800 group-hover:bg-slate-700 border-r border-slate-400 z-20\">\n                  <div className=\"flex items-center space-x-2 min-h-6\">\n                    <span className=\"font-bold text-sm text-white\">TOTALS</span>\n                  </div>\n                </td>\n                \n                {visibleMonths.map(({ key, year, month }) => {\n                  const monthItems = (data as SalesData[]).filter(item => {\n                    const itemDate = parseDate(item.paymentDate);\n                    return itemDate && itemDate.getFullYear() === year && itemDate.getMonth() + 1 === month;\n                  });\n                  const totalValue = getMetricValue(monthItems, selectedMetric);\n                  const isPreviousMonth = key === previousMonthKey;\n                  \n                  return (\n                    <td \n                      key={key} \n                      className=\"px-2 py-2 text-center text-sm font-bold text-white border-l border-slate-400 group-hover:bg-slate-700 cursor-pointer transition-all duration-200\"\n                      title={isPreviousMonth ? 'Main Month - Grand Total' : ''}\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        onRowClick?.({\n                          drillDownContext: 'soldby-total-month',\n                          filterCriteria: { month: key },\n                          name: `Grand Total (${key})`,\n                          month: key,\n                        })\n                      }}\n                    >\n                      <div className=\"flex flex-col items-center space-y-0.5 min-h-6 justify-center\">\n                        <span className=\"font-mono text-xs whitespace-nowrap\">{formatMetricValue(totalValue, selectedMetric)}</span>\n                      </div>\n                    </td>\n                  );\n                })}\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </ModernTableWrapper>\n      \n      {/* Persistent Footer */}\n      <PersistentTableFooter\n        tableId=\"sales-team-performance\"\n        initialText=\"• Sales team performance analysis by individual seller • Consistent performers identified for recognition • Training opportunities highlighted for underperformers\"\n      />\n    </div>\n  );\n};\n\n// Memoized export with custom comparison function\nexport const SoldByMonthOnMonthTableNew = React.memo(\n  SoldByMonthOnMonthTableNewComponent,\n  (prevProps, nextProps) => {\n    return (\n      prevProps.data === nextProps.data &&\n      prevProps.selectedMetric === nextProps.selectedMetric &&\n      prevProps.onRowClick === nextProps.onRowClick &&\n      prevProps.onReady === nextProps.onReady\n    );\n  }\n);","import React, { useMemo, useState, useCallback, useRef } from 'react';\nimport { SalesData, YearOnYearMetricType } from '@/types/dashboard';\nimport { ModernTableWrapper, ModernGroupBadge, ModernMetricTabs, STANDARD_METRICS } from './ModernTableWrapper';\nimport { PersistentTableFooter } from '@/components/dashboard/PersistentTableFooter';\nimport { formatCurrency, formatNumber } from '@/utils/formatters';\nimport { CreditCard, TrendingUp, TrendingDown, Star } from 'lucide-react';\nimport { generateStandardMonthRange } from '@/utils/dateUtils';\nimport { shallowEqual } from '@/utils/performanceUtils';\nimport { useTableCopyContext } from '@/hooks/useTableCopyContext';\n\ninterface PaymentMethodMonthOnMonthTableNewProps {\n  data: SalesData[];\n  onRowClick?: (row: any) => void;\n  selectedMetric?: YearOnYearMetricType;\n  onReady?: () => void;\n}\n\nexport const PaymentMethodMonthOnMonthTableNewComponent: React.FC<PaymentMethodMonthOnMonthTableNewProps> = ({\n  data,\n  onRowClick,\n  selectedMetric: initialMetric = 'revenue',\n  onReady\n}) => {\n  const [selectedMetric, setSelectedMetric] = useState<YearOnYearMetricType>(initialMetric);\n  const [displayMode, setDisplayMode] = useState<'values' | 'growth'>('values');\n  const [sortKey, setSortKey] = useState<string>('total');\n  const [sortDir, setSortDir] = useState<'desc' | 'asc'>('desc');\n  const tableRef = useRef<HTMLTableElement>(null);\n\n  // Get context information for enhanced table copying\n  const copyContext = useTableCopyContext();\n\n  const getPreviousMonthKey = () => {\n    const now = new Date();\n    const prevMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\n    return `${prevMonth.getFullYear()}-${String(prevMonth.getMonth() + 1).padStart(2, '0')}`;\n  };\n  const previousMonthKey = getPreviousMonthKey();\n\n  const parseDate = (dateStr: string): Date | null => {\n    if (!dateStr) return null;\n    const ddmmyyyy = dateStr.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})$/);\n    if (ddmmyyyy) {\n      const [, day, month, year] = ddmmyyyy;\n      return new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n    }\n    const date = new Date(dateStr);\n    return isNaN(date.getTime()) ? null : date;\n  };\n\n  const getMetricValue = (items: SalesData[], metric: YearOnYearMetricType) => {\n    if (!items.length) return 0;\n    // Use NET revenue: paymentValue - VAT\n    const totalRevenue = items.reduce((sum, item) => {\n      const payment = item.paymentValue || 0;\n      const vat = item.paymentVAT || item.vat || 0;\n      return sum + (payment - vat);\n    }, 0);\n    const totalTransactions = items.length;\n    const uniqueMembers = new Set(items.map(item => item.memberId)).size;\n    const totalUnits = items.length;\n    \n    // Use actual VAT from data, not calculated percentage\n    const totalVat = items.reduce((sum, item) => sum + (item.paymentVAT || item.vat || 0), 0);\n    \n    // Use actual discount data from the items\n    const totalDiscount = items.reduce((sum, item) => sum + (item.discountAmount || 0), 0);\n    \n    // Calculate discount percentage correctly: Total Discounts / (Total Gross Revenue) * 100\n    const totalGrossRevenue = items.reduce((sum, item) => sum + (item.paymentValue || 0), 0);\n    const avgDiscountPercentage = totalGrossRevenue > 0 \n      ? (totalDiscount / totalGrossRevenue) * 100\n      : 0;\n\n    // Purchase Frequency in Days\n    const dates = items.map(item => {\n      const dateStr = item.paymentDate;\n      if (!dateStr) return null;\n      const ddmmyyyy = dateStr.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})$/);\n      if (ddmmyyyy) {\n        const [, day, month, year] = ddmmyyyy;\n        return new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n      }\n      return new Date(dateStr);\n    }).filter((date): date is Date => date !== null && !isNaN(date.getTime())).sort((a, b) => a.getTime() - b.getTime());\n    \n    let purchaseFrequency = 0;\n    if (dates.length > 1) {\n      const totalDays = (dates[dates.length - 1].getTime() - dates[0].getTime()) / (1000 * 60 * 60 * 24);\n      purchaseFrequency = totalDays / (dates.length - 1);\n    }\n\n    switch (metric) {\n      case 'revenue': return totalRevenue;\n      case 'transactions': return totalTransactions;\n      case 'members': return uniqueMembers;\n      case 'units': return totalUnits;\n      case 'atv': return totalTransactions > 0 ? totalRevenue / totalTransactions : 0;\n      case 'auv': return uniqueMembers > 0 ? totalRevenue / uniqueMembers : 0;\n      case 'upt': return totalTransactions > 0 ? totalUnits / totalTransactions : 0;\n      case 'asv': return totalTransactions > 0 ? totalRevenue / totalTransactions : 0;\n      case 'vat': return totalVat;\n      case 'discountValue': return totalDiscount;\n      case 'discountPercentage': return avgDiscountPercentage;\n      case 'purchaseFrequency': return purchaseFrequency;\n      default: return 0;\n    }\n  };\n\n  const formatMetricValue = (value: number, metric: YearOnYearMetricType) => {\n    switch (metric) {\n      case 'revenue':\n      case 'auv':\n      case 'atv':\n      case 'asv':\n      case 'vat':\n      case 'discountValue':\n        return formatCurrency(value);\n      case 'transactions':\n      case 'members':\n      case 'units':\n        return formatNumber(value);\n      case 'upt':\n        return value.toFixed(1);\n      case 'discountPercentage':\n        return `${value.toFixed(1)}%`;\n      case 'purchaseFrequency':\n        return `${value.toFixed(1)} days`;\n      default:\n        return formatNumber(value);\n    }\n  };\n\n  // Use standard month range from Jan 2024 to current month in ASCENDING order\n  const monthlyData = useMemo(() => generateStandardMonthRange(), []);\n  const visibleMonths = useMemo(() => monthlyData, [monthlyData]);\n\n  // Notify parent when ready (effect placed after processedData declaration)\n\n  const processedData = useMemo(() => {\n    // Group by payment method\n    const paymentMethodGroups = data.reduce((acc: Record<string, SalesData[]>, item) => {\n      const method = item.paymentMethod || 'Unknown';\n      if (!acc[method]) {\n        acc[method] = [];\n      }\n      acc[method].push(item);\n      return acc;\n    }, {});\n\n    const methodData = Object.entries(paymentMethodGroups).map(([method, items]) => {\n      const monthlyValues: Record<string, number> = {};\n      \n      monthlyData.forEach(({ key, year, month }) => {\n        const monthItems = items.filter(item => {\n          const itemDate = parseDate(item.paymentDate);\n          return itemDate && itemDate.getFullYear() === year && itemDate.getMonth() + 1 === month;\n        });\n        monthlyValues[key] = getMetricValue(monthItems, selectedMetric);\n      });\n\n      return {\n        method,\n        monthlyValues,\n        totalValue: getMetricValue(items, selectedMetric),\n        totalRevenue: items.reduce((sum, item) => {\n          const payment = item.paymentValue || 0;\n          const vat = item.paymentVAT || item.vat || 0;\n          return sum + (payment - vat);\n        }, 0),\n        totalTransactions: items.length,\n        uniqueMembers: new Set(items.map(item => item.memberId)).size,\n        rawData: items\n      };\n    });\n\n    const comparator = (a: any, b: any) => {\n      const byMonth = (obj: any, key: string) => obj.monthlyValues?.[key] || 0;\n      let av: number, bv: number;\n      if (sortKey === 'total') { av = a.totalValue; bv = b.totalValue; }\n      else { av = byMonth(a, sortKey); bv = byMonth(b, sortKey); }\n      return sortDir === 'desc' ? bv - av : av - bv;\n    };\n    return methodData.sort(comparator);\n  }, [data, selectedMetric, monthlyData, sortKey, sortDir]);\n\n  // Notify parent when ready\n  const [readySent, setReadySent] = React.useState(false);\n  React.useEffect(() => {\n    if (!readySent && processedData.length > 0 && visibleMonths.length > 0) {\n      setReadySent(true);\n      onReady?.();\n    }\n  }, [readySent, processedData, visibleMonths, onReady]);\n\n  const getGrowthPercentage = (current: number, previous: number) => {\n    if (previous === 0 && current === 0) return null;\n    if (previous === 0) return '+100';\n    return ((current - previous) / previous * 100).toFixed(1);\n  };\n\n  // Function to generate content for all metric tabs\n  const generateAllTabsContent = useCallback(async () => {\n    let allContent = `Payment Method Analysis - All Metrics\\n`;\n    allContent += `Exported on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}\\n`;\n    allContent += `\\n${'='.repeat(80)}\\n\\n`;\n\n    // Loop through all metrics from STANDARD_METRICS\n    for (const metricInfo of STANDARD_METRICS) {\n      const metric = metricInfo.key as YearOnYearMetricType;\n\n      allContent += `\\n${metricInfo.label.toUpperCase()}\\n`;\n      allContent += `${'-'.repeat(metricInfo.label.length + 10)}\\n\\n`;\n\n      // Add table headers\n      const headers = ['Payment Method', 'Total'];\n      visibleMonths.forEach(month => headers.push(month.display));\n      allContent += headers.join('\\t') + '\\n';\n      allContent += headers.map(() => '---').join('\\t') + '\\n';\n\n      // Reprocess data specifically for this metric\n      const paymentMethodGroups = data.reduce((acc: Record<string, SalesData[]>, item) => {\n        const method = item.paymentMethod || 'Unknown';\n        if (!acc[method]) acc[method] = [];\n        acc[method].push(item);\n        return acc;\n      }, {});\n\n      const metricProcessedData = Object.entries(paymentMethodGroups).map(([method, items]) => {\n        const monthlyValues: Record<string, number> = {};\n        \n        monthlyData.forEach(({ key, year, month }) => {\n          const monthItems = items.filter(item => {\n            const itemDate = parseDate(item.paymentDate);\n            return itemDate && itemDate.getFullYear() === year && itemDate.getMonth() + 1 === month;\n          });\n          monthlyValues[key] = getMetricValue(monthItems, metric);\n        });\n\n        return {\n          method,\n          monthlyValues,\n          totalValue: getMetricValue(items, metric)\n        };\n      });\n\n      // Add data rows\n      metricProcessedData.forEach(methodData => {\n        const methodRow = [methodData.method, formatMetricValue(methodData.totalValue, metric)];\n        \n        visibleMonths.forEach(month => {\n          const value = methodData.monthlyValues[month.key] || 0;\n          methodRow.push(formatMetricValue(value, metric));\n        });\n        allContent += methodRow.join('\\t') + '\\n';\n      });\n\n      allContent += `\\n`;\n    }\n\n    return allContent;\n  }, [data, visibleMonths, monthlyData]);\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Modern Metric Selector */}\n      <ModernMetricTabs\n        metrics={STANDARD_METRICS}\n        selectedMetric={selectedMetric}\n        onMetricChange={(metric) => setSelectedMetric(metric as YearOnYearMetricType)}\n      />\n\n      <ModernTableWrapper\n        title=\"Payment Method Analysis\"\n        description=\"Performance breakdown by payment method across all metrics and timeframes\"\n        icon={<CreditCard className=\"w-5 h-5 text-white\" />}\n        totalItems={processedData.length}\n        showDisplayToggle={true}\n        displayMode={displayMode}\n        onDisplayModeChange={setDisplayMode}\n        showCollapseControls={false}\n        tableRef={tableRef}\n        showCopyButton={true}\n        onCopyAllTabs={generateAllTabsContent}\n        contextInfo={{\n          selectedMetric: selectedMetric,\n          dateRange: copyContext.dateRange,\n          filters: copyContext.filters,\n          additionalInfo: {\n            displayMode: displayMode,\n            totalItems: processedData.length,\n            sortBy: sortKey,\n            sortDirection: sortDir\n          }\n        }}\n      >\n        <div className=\"overflow-x-auto\">\n          <table ref={tableRef} className=\"min-w-full bg-white\">\n            <thead className=\"sticky top-0 z-30\">\n              <tr className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n                <th\n                  className=\"w-80 px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide sticky left-0 bg-gradient-to-r from-slate-800 to-slate-900 z-40 border-r border-white/20 cursor-pointer select-none\"\n                  onClick={() => {\n                    if (sortKey !== 'total') { setSortKey('total'); setSortDir('desc'); }\n                    else setSortDir(d => d === 'desc' ? 'asc' : 'desc');\n                  }}\n                  title={`Sort by total (${sortDir})`}\n                >\n                  <div className=\"flex items-center space-x-2\">\n                    <CreditCard className=\"w-4 h-4 text-white\" />\n                    <span>Payment Method</span>\n                  </div>\n                </th>\n                \n                {visibleMonths.map(({ key, display }) => {\n                  const isPreviousMonth = key === previousMonthKey;\n                  return (\n                  <th\n                    key={key}\n                    className={`px-3 py-3 text-center font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[90px] cursor-pointer select-none ${\n                      isPreviousMonth \n                        ? 'bg-blue-800 text-white' \n                        : 'text-white'\n                    }`}\n                    onClick={() => {\n                      if (sortKey !== key) { setSortKey(key); setSortDir('desc'); }\n                      else setSortDir(d => d === 'desc' ? 'asc' : 'desc');\n                    }}\n                    title={`Sort by ${display} (${sortDir})${isPreviousMonth ? ' - Main Month' : ''}`}\n                  >\n                    <div className=\"flex flex-col items-center\">\n                      <div className=\"flex items-center space-x-1\">\n                        {isPreviousMonth && <Star className=\"w-3 h-3\" />}\n                        <span className=\"text-xs font-bold whitespace-nowrap\">{display.split(' ')[0]}</span>\n                      </div>\n                      <span className=\"text-slate-300 text-xs\">{display.split(' ')[1]}</span>\n                    </div>\n                  </th>\n                  );\n                })}\n              </tr>\n            </thead>\n\n            <tbody>\n              {processedData.map((method, methodIndex) => (\n                <tr \n                  key={method.method}\n                  className=\"bg-white hover:bg-slate-50 border-b border-gray-200 transition-all duration-200 h-12\"\n                  onClick={() => onRowClick?.({\n                    ...method,\n                    contextType: 'paymentMethod',\n                    drillDownContext: 'payment-method-analysis',\n                    filterCriteria: {\n                      paymentMethod: method.method\n                    }\n                  })}\n                >\n                  <td className=\"w-80 px-4 py-2 text-left sticky left-0 bg-white hover:bg-slate-50 border-r border-gray-200 z-20 cursor-pointer transition-all duration-200\">\n                    <div className=\"flex items-center space-x-2 min-h-8\">\n                      <span className=\"text-slate-400 text-xs\">→</span>\n                      <span className=\"text-slate-700 font-medium text-sm truncate\">{method.method}</span>\n                    </div>\n                  </td>\n                  \n                  {visibleMonths.map(({ key }, monthIndex) => {\n                    const current = method.monthlyValues[key] || 0;\n                    const previousMonthKey = visibleMonths[monthIndex + 1]?.key;\n                    const previous = previousMonthKey ? (method.monthlyValues[previousMonthKey] || 0) : 0;\n                    const growthPercentage = monthIndex < visibleMonths.length - 1 ? getGrowthPercentage(current, previous) : null;\n                    \n                    return (\n                      <td \n                        key={key} \n                        className=\"px-2 py-2 text-center text-sm font-mono text-slate-700 border-l border-gray-200 hover:bg-slate-100 cursor-pointer transition-all duration-200\"\n                        title={growthPercentage ? `${growthPercentage}% vs previous month` : ''}\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          onRowClick?.({\n                            ...method,\n                            contextType: 'paymentMethod-month',\n                            filterCriteria: {\n                              paymentMethod: method.method,\n                              month: key,\n                              specificValue: current\n                            },\n                            drillDownContext: {\n                              type: 'paymentMethod-month',\n                              itemName: method.method,\n                              month: key,\n                              value: current,\n                              metric: selectedMetric\n                            },\n                            clickedItemName: method.method,\n                            contextDescription: `${method.method} performance in ${key}: ${formatMetricValue(current, selectedMetric)}`\n                          });\n                        }}\n                      >\n                        <div className=\"flex flex-col items-center space-y-0.5 min-h-6 justify-center\">\n                          {displayMode === 'values' ? (\n                            <span className=\"text-xs whitespace-nowrap\">{formatMetricValue(current, selectedMetric)}</span>\n                          ) : (\n                            growthPercentage && (\n                              <div className={`flex items-center space-x-1 text-xs ${\n                                parseFloat(growthPercentage) > 0 ? 'text-emerald-500' : 'text-red-400'\n                              }`}>\n                                {parseFloat(growthPercentage) > 0 ? \n                                  <TrendingUp className=\"w-2 h-2\" /> : \n                                  <TrendingDown className=\"w-2 h-2\" />\n                                }\n                                <span className=\"font-mono\">{Math.abs(parseFloat(growthPercentage))}%</span>\n                              </div>\n                            )\n                          )}\n                        </div>\n                      </td>\n                    );\n                  })}\n                </tr>\n              ))}\n              \n              {/* Totals Row */}\n              <tr \n                className=\"bg-slate-800 text-white font-bold border-t-2 border-slate-400 h-10 max-h-10 cursor-pointer hover:bg-slate-700\"\n                onClick={() => onRowClick?.({\n                  drillDownContext: 'payment-method-grand-total',\n                  filterCriteria: {},\n                  name: 'Grand Total (All Payment Methods)',\n                  rawData: data,\n                  isGroup: true,\n                })}\n              >\n                <td className=\"w-80 px-4 py-2 text-left sticky left-0 bg-slate-800 group-hover:bg-slate-700 border-r border-slate-400 z-20\">\n                  <div className=\"flex items-center space-x-2 min-h-6\">\n                    <span className=\"font-bold text-sm text-white\">TOTALS</span>\n                  </div>\n                </td>\n                \n                {visibleMonths.map(({ key }) => {\n                  const totalValue = processedData.reduce((sum, method) => \n                    sum + (method.monthlyValues[key] || 0), 0\n                  );\n                  \n                  return (\n                    <td \n                      key={key} \n                      className=\"px-2 py-2 text-center text-sm font-bold text-white border-l border-slate-400 group-hover:bg-slate-700\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        onRowClick?.({\n                          drillDownContext: 'payment-method-total-month',\n                          filterCriteria: { month: key },\n                          name: `Grand Total (${key})`,\n                          month: key,\n                        })\n                      }}\n                    >\n                      <div className=\"flex flex-col items-center space-y-0.5 min-h-6 justify-center\">\n                        <span className=\"font-mono text-xs whitespace-nowrap\">{formatMetricValue(totalValue, selectedMetric)}</span>\n                      </div>\n                    </td>\n                  );\n                })}\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </ModernTableWrapper>\n      \n      {/* Persistent Footer */}\n      <PersistentTableFooter\n        tableId=\"payment-method-analysis\"\n        initialText=\"• Payment method preference analysis across customer base • Transaction distribution and processing efficiency metrics • Revenue optimization opportunities by payment channel\"\n      />\n    </div>\n  );\n};\n\n// Memoized export with custom comparison function\nexport const PaymentMethodMonthOnMonthTableNew = React.memo(\n  PaymentMethodMonthOnMonthTableNewComponent,\n  (prevProps, nextProps) => {\n    return (\n      prevProps.data === nextProps.data &&\n      prevProps.selectedMetric === nextProps.selectedMetric &&\n      prevProps.onRowClick === nextProps.onRowClick &&\n      prevProps.onReady === nextProps.onReady\n    );\n  }\n);","import React, { useState, useMemo, useRef, useEffect } from 'react';\nimport { Button, type ButtonProps } from '@/components/ui/button';\nimport { cn } from '@/lib/utils';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Label } from '@/components/ui/label';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Download, FileSpreadsheet, TrendingUp } from 'lucide-react';\nimport { BrandSpinner } from '@/components/ui/BrandSpinner';\nimport { SalesData, YearOnYearMetricType } from '@/types/dashboard';\nimport { formatCurrency, formatNumber, formatPercentage } from '@/utils/formatters';\n\ninterface TableExportData {\n  name: string;\n  headers: string[];\n  rows: string[][];\n}\n\ninterface ComprehensiveSalesExportButtonProps {\n  data: SalesData[];\n  currentLocation: string;\n  locationName: string;\n  // Refs to table components to extract their processed data\n  yearOnYearTableRef?: React.RefObject<any>;\n  monthOnMonthTableRef?: React.RefObject<any>;\n  productPerformanceTableRef?: React.RefObject<any>;\n  categoryPerformanceTableRef?: React.RefObject<any>;\n  soldByTableRef?: React.RefObject<any>;\n  paymentMethodTableRef?: React.RefObject<any>;\n  buttonVariant?: ButtonProps['variant'];\n  buttonSize?: ButtonProps['size'];\n  buttonClassName?: string;\n  buttonLabel?: string;\n  /** When provided, the component will assign an open() method to this ref so parents can programmatically open the dialog */\n  openRef?: React.RefObject<{ open: () => void }>;\n  /** If false, hides the default trigger button and only renders the dialog content. */\n  renderTrigger?: boolean;\n}\n\ninterface ExportConfig {\n  currentView: boolean;\n  monthOnMonth: boolean;\n  yearOnYear: boolean;\n  productPerformance: boolean;\n  categoryPerformance: boolean;\n  soldByAnalysis: boolean;\n  paymentMethodAnalysis: boolean;\n  allTabs: boolean;\n}\n\nconst LOCATION_MAPPING: Record<string, string> = {\n  'all': 'All Locations',\n  'kwality': 'Kwality House, Kemps Corner',\n  'supreme': 'Supreme HQ, Bandra',\n  'kenkere': 'Kenkere House'\n};\n\nexport const ComprehensiveSalesExportButton: React.FC<ComprehensiveSalesExportButtonProps> = ({\n  data,\n  currentLocation,\n  locationName,\n  buttonVariant = 'outline',\n  buttonSize = 'sm',\n  buttonClassName,\n  buttonLabel,\n  openRef,\n  renderTrigger = true,\n}) => {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  // Expose programmatic open\n  useEffect(() => {\n    if (openRef) {\n      openRef.current = {\n        open: () => setIsDialogOpen(true),\n      };\n    }\n  }, [openRef]);\n  const [isExporting, setIsExporting] = useState(false);\n  const [exportConfig, setExportConfig] = useState<ExportConfig>({\n    currentView: true,\n    monthOnMonth: true,\n    yearOnYear: true,\n    productPerformance: true,\n    categoryPerformance: true,\n    soldByAnalysis: true,\n    paymentMethodAnalysis: true,\n    allTabs: true\n  });\n\n  // Get current tab information\n  const getCurrentTabInfo = () => {\n    const activeTab = document.querySelector('[role=\"tab\"][data-state=\"active\"]');\n    const tabValue = activeTab?.getAttribute('data-value') || 'current-view';\n    const tabText = activeTab?.textContent?.trim() || 'Current View';\n    return { tabValue, tabText };\n  };\n\n  // Extract table data from DOM elements\n  const extractTableData = (tableSelector: string, tableName: string): TableExportData | null => {\n    const tableElements = document.querySelectorAll(tableSelector);\n    if (tableElements.length === 0) {\n      console.warn(`No tables found: ${tableSelector}`);\n      return null;\n    }\n\n    // Use the first visible table or the largest table if multiple found\n    let tableElement = tableElements[0] as HTMLTableElement;\n    if (tableElements.length > 1) {\n      // Find the table with most rows (likely the main data table)\n      let maxRows = 0;\n      tableElements.forEach(table => {\n        const el = table as HTMLTableElement;\n        const isVisible = (el as any).offsetParent !== null;\n        const rowCount = el.querySelectorAll('tr').length;\n        if ((isVisible && maxRows === 0) || rowCount > maxRows) {\n          maxRows = rowCount;\n          tableElement = el;\n        }\n      });\n    }\n\n    const headers: string[] = [];\n    const rows: string[][] = [];\n\n    // Extract headers - look for thead first, then first tr, then th elements anywhere\n    let headerRow = tableElement.querySelector('thead tr');\n    if (!headerRow) {\n      headerRow = tableElement.querySelector('tr:has(th)');\n    }\n    if (!headerRow) {\n      headerRow = tableElement.querySelector('tr');\n    }\n\n    if (headerRow) {\n      const headerCells = headerRow.querySelectorAll('th, td');\n      headerCells.forEach(cell => {\n        // Get text content and clean it up\n        let text = cell.textContent?.trim() || '';\n        // Remove any arrow indicators or sorting symbols\n        text = text.replace(/[↑↓▲▼]/g, '').trim();\n        headers.push(text);\n      });\n    }\n\n    // Extract data rows - skip header row if it exists\n    const allRows = tableElement.querySelectorAll('tr');\n    allRows.forEach((row, index) => {\n      // Skip header row\n      if (headerRow && row === headerRow) return;\n      \n      const cells = row.querySelectorAll('td, th');\n      if (cells.length === 0) return;\n      \n      const rowData: string[] = [];\n      cells.forEach(cell => {\n        // Get text content and clean it up\n        let text = cell.textContent?.trim() || '';\n        // Handle special cases like buttons, badges, etc.\n        if (cell.querySelector('button')) {\n          const buttonText = cell.querySelector('button')?.textContent?.trim();\n          text = buttonText || text;\n        }\n        // Clean up currency and number formatting\n        text = text.replace(/[↑↓▲▼]/g, '').trim();\n        rowData.push(text);\n      });\n      \n      // Only add rows that have actual data\n      if (rowData.some(cell => cell.length > 0 && cell !== '—' && cell !== '-')) {\n        rows.push(rowData);\n      }\n    });\n\n    return {\n      name: tableName,\n      headers,\n      rows\n    };\n  };\n\n  // Lower-level: extract a single table element to data\n  const extractTableFromElement = (tableElement: HTMLTableElement, tableName: string): TableExportData => {\n    const headers: string[] = [];\n    const rows: string[][] = [];\n\n    let headerRow = tableElement.querySelector('thead tr');\n    if (!headerRow) headerRow = tableElement.querySelector('tr:has(th)');\n    if (!headerRow) headerRow = tableElement.querySelector('tr');\n\n    if (headerRow) {\n      const headerCells = headerRow.querySelectorAll('th, td');\n      headerCells.forEach(cell => {\n        let text = cell.textContent?.trim() || '';\n        text = text.replace(/[↑↓▲▼]/g, '').trim();\n        headers.push(text);\n      });\n    }\n\n    const allRows = tableElement.querySelectorAll('tr');\n    allRows.forEach(row => {\n      if (headerRow && row === headerRow) return;\n      const cells = row.querySelectorAll('td, th');\n      if (cells.length === 0) return;\n      const rowData: string[] = [];\n      cells.forEach(cell => {\n        let text = cell.textContent?.trim() || '';\n        if (cell.querySelector('button')) {\n          const buttonText = cell.querySelector('button')?.textContent?.trim();\n          text = buttonText || text;\n        }\n        text = text.replace(/[↑↓▲▼]/g, '').trim();\n        rowData.push(text);\n      });\n      if (rowData.some(cell => cell.length > 0 && cell !== '—' && cell !== '-')) {\n        rows.push(rowData);\n      }\n    });\n\n    return { name: tableName, headers, rows };\n  };\n\n  // Extract data from visible tables within all active tabpanels\n  const extractAllTableData = (): TableExportData[] => {\n    const tables: TableExportData[] = [];\n    const activePanels = document.querySelectorAll('[role=\"tabpanel\"][data-state=\"active\"]');\n    const visibleTables: HTMLTableElement[] = [];\n\n    activePanels.forEach(panel => {\n      const tablesInPanel = panel.querySelectorAll('table');\n      tablesInPanel.forEach(t => {\n        const el = t as HTMLTableElement;\n        const style = window.getComputedStyle(el);\n        const isVisible = (el as any).offsetParent !== null && style.display !== 'none' && style.visibility !== 'hidden' && style.opacity !== '0';\n        if (isVisible) visibleTables.push(el);\n      });\n    });\n\n    // Fallback: any visible table in document\n    if (visibleTables.length === 0) {\n      document.querySelectorAll('table').forEach(t => {\n        const el = t as HTMLTableElement;\n        const style = window.getComputedStyle(el);\n        const isVisible = (el as any).offsetParent !== null && style.display !== 'none' && style.visibility !== 'hidden' && style.opacity !== '0';\n        if (isVisible) visibleTables.push(el);\n      });\n    }\n\n    visibleTables.forEach((el, idx) => {\n      const name = `Data Table ${idx + 1}`;\n      const data = extractTableFromElement(el, name);\n      if (data.rows.length > 0) tables.push(data);\n    });\n\n    return tables;\n  };\n\n  // Metric labels used by ModernMetricTabs across tables. We will iterate these to export per-metric variants.\n  const METRIC_LABELS = [\n    'Revenue',\n    'Units Sold',\n    'Transactions',\n    'Members',\n    'AUV',\n    'ATV',\n    'ASV',\n    'UPT',\n    'VAT',\n    'Discount ₹',\n    'Discount %',\n    'Purchase Freq.'\n  ];\n\n  // Click helper\n  const clickElement = async (el: Element | null, waitMs = 300) => {\n    if (el instanceof HTMLElement) {\n      try {\n        el.scrollIntoView({ block: 'center' });\n        el.click();\n        await new Promise(r => setTimeout(r, waitMs));\n      } catch (e) {\n        console.warn('Failed to click element', e);\n      }\n    }\n  };\n\n  // Export tables for each metric in the currently active analysis section\n  const exportMetricVariantsForActiveSection = async (locationSuffix: string, timestamp: string, sectionTag: string) => {\n    // Find metric buttons inside the active panel by matching known labels\n    const activePanel = document.querySelector('[role=\"tabpanel\"][data-state=\"active\"], [data-state=\"active\"][role=\"tabpanel\"], [data-state=\"active\"]') as HTMLElement | null;\n    if (!activePanel) return;\n\n    // Collect unique buttons by their text content\n    const metricButtons: HTMLElement[] = [];\n    METRIC_LABELS.forEach(label => {\n      const btn = Array.from(activePanel.querySelectorAll('button'))\n        .find(b => (b.textContent || '').trim() === label) as HTMLElement | undefined;\n      if (btn && !metricButtons.includes(btn)) metricButtons.push(btn);\n    });\n\n    if (metricButtons.length === 0) return; // No metric toggles in this section\n\n    for (const btn of metricButtons) {\n      const metricLabel = (btn.textContent || '').trim();\n      await clickElement(btn, 350);\n\n      // After toggling metric, extract current visible tables\n      const perMetricTables = extractAllTableData();\n      for (const table of perMetricTables) {\n        let csvContent = '';\n        // Optional metadata header\n        csvContent += `# Sales Analytics Export\\n`;\n        csvContent += `# Section: ${sectionTag}\\n`;\n        csvContent += `# Metric: ${metricLabel}\\n`;\n        csvContent += `# Location: ${locationSuffix}\\n`;\n        csvContent += `# Export Time: ${new Date().toLocaleString()}\\n`;\n        csvContent += `# Table: ${table.name}\\n\\n`;\n\n        if (table.headers.length > 0) {\n          csvContent += table.headers.map(h => `\"${h.replace(/\"/g, '\"\"')}\"`).join(',') + '\\n';\n        }\n        table.rows.forEach(row => {\n          csvContent += row.map(cell => `\"${cell.replace(/\"/g, '\"\"')}\"`).join(',') + '\\n';\n        });\n\n        const cleanSection = sectionTag.replace(/[^a-zA-Z0-9\\-]/g, '-');\n        const cleanMetric = metricLabel.replace(/[^a-zA-Z0-9\\-]/g, '-');\n        const cleanTableName = table.name.replace(/[^a-zA-Z0-9\\-\\s]/g, '').replace(/\\s+/g, '-');\n        const fileName = `${cleanSection}-${cleanMetric}-${cleanTableName}-${locationSuffix}-${timestamp}.csv`;\n\n        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n        const link = document.createElement('a');\n        const url = URL.createObjectURL(blob);\n        link.setAttribute('href', url);\n        link.setAttribute('download', fileName);\n        link.style.visibility = 'hidden';\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        await new Promise(resolve => setTimeout(resolve, 250));\n      }\n    }\n  };\n\n  const handleExport = async () => {\n    setIsExporting(true);\n    try {\n      const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');\n      const locationSuffix = currentLocation === 'all' ? 'All-Locations' : LOCATION_MAPPING[currentLocation] || currentLocation;\n      \n      // Extract data from currently visible tables\n      const tableData = extractAllTableData();\n      \n      if (tableData.length === 0) {\n        alert('No table data found to export. Please ensure tables are loaded and visible.');\n        return;\n      }\n\n      // Export each table as a separate CSV file (current view)\n      for (const table of tableData) {\n        let csvContent = '';\n        \n        // Add headers\n        if (table.headers.length > 0) {\n          csvContent += table.headers.join(',') + '\\n';\n        }\n        \n        // Add rows\n        table.rows.forEach(row => {\n          csvContent += row.map(cell => `\"${cell.replace(/\"/g, '\"\"')}\"`).join(',') + '\\n';\n        });\n\n        // Create and download file\n        const fileName = `${table.name.replace(/\\s+/g, '-')}-${locationSuffix}-${timestamp}.csv`;\n        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n        const link = document.createElement('a');\n        const url = URL.createObjectURL(blob);\n        link.setAttribute('href', url);\n        link.setAttribute('download', fileName);\n        link.style.visibility = 'hidden';\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        \n        // Add small delay between downloads\n        await new Promise(resolve => setTimeout(resolve, 200));\n      }\n\n      // Also export per-metric variants for the current active section\n      const currentTab = document.querySelector('[role=\"tab\"][data-state=\"active\"]');\n      const currentTabText = (currentTab?.textContent || '').trim() || 'current-view';\n      await exportMetricVariantsForActiveSection(locationSuffix, timestamp, currentTabText);\n\n      // Also export all tabs if the user wants comprehensive data\n      if (exportConfig.yearOnYear || exportConfig.monthOnMonth || exportConfig.productPerformance || \n          exportConfig.categoryPerformance || exportConfig.soldByAnalysis || exportConfig.paymentMethodAnalysis || exportConfig.allTabs) {\n        await exportAllTabsData(locationSuffix, timestamp);\n      }\n\n      setIsDialogOpen(false);\n    } catch (error) {\n      console.error('Export failed:', error);\n      alert('Export failed. Please try again.');\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  // Build a consolidated printable HTML string from table data\n  const buildPrintableHtml = (title: string, sections: Array<{ heading: string; subtitle?: string; tables: TableExportData[] }>) => {\n    const styles = `\n      <style>\n        body { font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif; padding: 24px; color: #0f172a; }\n        h1 { font-size: 20px; margin: 0 0 16px; }\n        h2 { font-size: 16px; margin: 24px 0 8px; color: #334155; }\n        h3 { font-size: 14px; margin: 12px 0 8px; color: #475569; }\n        .meta { font-size: 12px; color: #64748b; margin-bottom: 16px; }\n        table { border-collapse: collapse; width: 100%; margin: 8px 0 24px; font-size: 12px; }\n        th, td { border: 1px solid #e2e8f0; padding: 6px 8px; text-align: left; }\n        thead th { background: #0f172a; color: white; position: sticky; top: 0; }\n        .page-break { page-break-after: always; height: 0; }\n      </style>\n    `;\n    let html = `<!doctype html><html><head><meta charset=\"utf-8\" />${styles}<title>${title}</title></head><body>`;\n    html += `<h1>${title}</h1>`;\n    html += `<div class=\"meta\">Generated: ${new Date().toLocaleString()} | Location: ${locationName}</div>`;\n    sections.forEach((sec, sIdx) => {\n      html += `<h2>${sec.heading}</h2>`;\n      if (sec.subtitle) html += `<div class=\"meta\">${sec.subtitle}</div>`;\n      sec.tables.forEach((t, tIdx) => {\n        html += `<h3>${t.name}</h3>`;\n        if (t.headers.length || t.rows.length) {\n          html += '<table><thead><tr>' + (t.headers.map(h => `<th>${h}</th>`).join('')) + '</tr></thead><tbody>';\n          t.rows.forEach(r => {\n            html += '<tr>' + r.map(c => `<td>${c}</td>`).join('') + '</tr>';\n          });\n          html += '</tbody></table>';\n        }\n      });\n      if (sIdx < sections.length - 1) html += '<div class=\"page-break\"></div>';\n    });\n    html += '</body></html>';\n    return html;\n  };\n\n  const handleExportPDF = async () => {\n    setIsExporting(true);\n    try {\n      const sections: Array<{ heading: string; subtitle?: string; tables: TableExportData[] }> = [];\n\n      // Current view\n      if (exportConfig.currentView) {\n        const currentTables = extractAllTableData();\n        if (currentTables.length > 0) {\n          const { tabText } = getCurrentTabInfo();\n          sections.push({ heading: `Current View – ${tabText}`, subtitle: 'Filtered tables as displayed', tables: currentTables });\n        }\n      }\n\n      // All configured tabs\n      if (exportConfig.allTabs || exportConfig.monthOnMonth || exportConfig.yearOnYear || exportConfig.productPerformance || exportConfig.categoryPerformance || exportConfig.soldByAnalysis || exportConfig.paymentMethodAnalysis) {\n        const tabTriggers = document.querySelectorAll('[role=\"tab\"]');\n        const originalActiveTab = document.querySelector('[role=\"tab\"][data-state=\"active\"]');\n        const tabMapping: Record<keyof ExportConfig, string[]> = {\n          currentView: [],\n          monthOnMonth: ['monthOnMonth', 'month-on-month'],\n          yearOnYear: ['yearOnYear', 'year-on-year'],\n          productPerformance: ['productPerformance', 'product-performance'],\n          categoryPerformance: ['categoryPerformance', 'category-performance'],\n          soldByAnalysis: ['soldByAnalysis', 'sold-by', 'soldBy'],\n          paymentMethodAnalysis: ['paymentMethodAnalysis', 'payment-method', 'paymentMethod'],\n          allTabs: []\n        };\n\n        for (const trigger of tabTriggers) {\n          if (!(trigger instanceof HTMLElement)) continue;\n          const tabLabel = trigger.textContent?.trim() || '';\n          const normalizedLabel = tabLabel.replace(/\\s+/g, '-').toLowerCase();\n          const dataValue = trigger.getAttribute('data-value') || '';\n          const tabValue = (dataValue || normalizedLabel || 'unknown');\n\n          let shouldExport = exportConfig.allTabs;\n          if (!shouldExport) {\n            for (const [configKey, configValue] of Object.entries(exportConfig)) {\n              if (configValue && configKey !== 'currentView' && configKey !== 'allTabs') {\n                const mappedValues = tabMapping[configKey as keyof ExportConfig] || [];\n                if (mappedValues.some(mapped => tabValue.includes(mapped) || mapped.includes(tabValue) || normalizedLabel.includes(mapped))) {\n                  shouldExport = true; break;\n                }\n              }\n            }\n          }\n          if (!shouldExport) continue;\n\n          trigger.click();\n          await new Promise(r => setTimeout(r, 800));\n\n          const baseTables = extractAllTableData();\n          if (baseTables.length > 0) {\n            sections.push({ heading: `Tab – ${tabLabel || tabValue}`, subtitle: 'Base metric', tables: baseTables });\n          }\n\n          // Per-metric variants in PDF too\n          const activePanel = document.querySelector('[role=\"tabpanel\"][data-state=\"active\"]') as HTMLElement | null;\n          if (activePanel) {\n            const metricButtons: HTMLElement[] = [];\n            METRIC_LABELS.forEach(label => {\n              const btn = Array.from(activePanel.querySelectorAll('button')).find(b => (b.textContent || '').trim() === label) as HTMLElement | undefined;\n              if (btn && !metricButtons.includes(btn)) metricButtons.push(btn);\n            });\n            for (const btn of metricButtons) {\n              const metricLabel = (btn.textContent || '').trim();\n              btn.click();\n              await new Promise(r => setTimeout(r, 400));\n              const metricTables = extractAllTableData();\n              if (metricTables.length > 0) {\n                sections.push({ heading: `Tab – ${tabLabel || tabValue} (${metricLabel})`, tables: metricTables });\n              }\n            }\n          }\n        }\n\n        // Restore original active tab\n        if (originalActiveTab instanceof HTMLElement) {\n          originalActiveTab.click();\n          await new Promise(r => setTimeout(r, 300));\n        }\n      }\n\n      if (sections.length === 0) {\n        alert('No table data found to export for PDF. Please ensure tables are loaded and visible.');\n        return;\n      }\n\n      const title = `Sales Analytics – ${locationName}`;\n      const html = buildPrintableHtml(title, sections);\n      const w = window.open('', '_blank');\n      if (!w) {\n        alert('Popup blocked. Please allow popups to view the PDF.');\n        return;\n      }\n      w.document.open();\n      w.document.write(html);\n      w.document.close();\n      // Give the browser a moment to render before printing\n      setTimeout(() => {\n        w.focus();\n        w.print();\n      }, 300);\n    } catch (e) {\n      console.error('PDF export failed', e);\n      alert('PDF export failed. Please try again.');\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  const exportAllTabsData = async (locationSuffix: string, timestamp: string) => {\n    const tabTriggers = document.querySelectorAll('[role=\"tab\"]');\n    const originalActiveTab = document.querySelector('[role=\"tab\"][data-state=\"active\"]');\n    \n    // Create a mapping of export config to tab values\n    const tabMapping: Record<keyof ExportConfig, string[]> = {\n      currentView: [],\n      monthOnMonth: ['monthOnMonth', 'month-on-month'],\n      yearOnYear: ['yearOnYear', 'year-on-year'],\n      productPerformance: ['productPerformance', 'product-performance'],\n      categoryPerformance: ['categoryPerformance', 'category-performance'],\n      soldByAnalysis: ['soldByAnalysis', 'sold-by', 'soldBy'],\n      paymentMethodAnalysis: ['paymentMethodAnalysis', 'payment-method', 'paymentMethod'],\n      allTabs: []\n    };\n    \n    for (const trigger of tabTriggers) {\n      if (trigger instanceof HTMLElement) {\n        const tabLabel = trigger.textContent?.trim() || '';\n        const normalizedLabel = tabLabel.replace(/\\s+/g, '-').toLowerCase();\n        const dataValue = trigger.getAttribute('data-value') || '';\n        const tabValue = (dataValue || normalizedLabel || 'unknown');\n\n        // Determine if this tab should be exported\n        let shouldExport = exportConfig.allTabs;\n        \n        if (!shouldExport) {\n          for (const [configKey, configValue] of Object.entries(exportConfig)) {\n            if (configValue && configKey !== 'currentView' && configKey !== 'allTabs') {\n              const mappedValues = tabMapping[configKey as keyof ExportConfig] || [];\n              if (mappedValues.some(mapped => \n                tabValue.includes(mapped) || \n                mapped.includes(tabValue) ||\n                tabValue.toLowerCase().includes(mapped.toLowerCase()) ||\n                normalizedLabel.includes(mapped)\n              )) {\n                shouldExport = true;\n                break;\n              }\n            }\n          }\n        }\n\n        if (!shouldExport) continue;\n\n        console.log(`Exporting tab: ${tabValue}`);\n        \n        // Click the tab to make it active\n        trigger.click();\n        \n        // Wait for the tab content to load and any animations to complete\n        await new Promise(resolve => setTimeout(resolve, 800));\n        \n        // Extract table data from this tab\n        const tabTableData = extractAllTableData();\n        \n        if (tabTableData.length === 0) {\n          console.warn(`No table data found in tab: ${tabValue}`);\n          // Try metric variants anyway in case content is metric-driven\n          await exportMetricVariantsForActiveSection(locationSuffix, timestamp, tabLabel || tabValue);\n          continue;\n        }\n        \n        // Export data from this tab\n        for (const table of tabTableData) {\n          let csvContent = '';\n          \n          // Add metadata header\n          csvContent += `# Sales Analytics Export\\n`;\n          csvContent += `# Tab: ${tabLabel || tabValue}\\n`;\n          csvContent += `# Location: ${locationSuffix}\\n`;\n          csvContent += `# Export Time: ${new Date().toLocaleString()}\\n`;\n          csvContent += `# Table: ${table.name}\\n\\n`;\n          \n          // Add headers\n          if (table.headers.length > 0) {\n            csvContent += table.headers.map(h => `\"${h.replace(/\"/g, '\"\"')}\"`).join(',') + '\\n';\n          }\n          \n          // Add rows\n          table.rows.forEach(row => {\n            csvContent += row.map(cell => `\"${cell.replace(/\"/g, '\"\"')}\"`).join(',') + '\\n';\n          });\n\n          // Create and download file\n          const cleanTabValue = (tabLabel || tabValue).replace(/[^a-zA-Z0-9\\-]/g, '-');\n          const cleanTableName = table.name.replace(/[^a-zA-Z0-9\\-\\s]/g, '').replace(/\\s+/g, '-');\n          const fileName = `${cleanTabValue}-${cleanTableName}-${locationSuffix}-${timestamp}.csv`;\n          \n          const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n          const link = document.createElement('a');\n          const url = URL.createObjectURL(blob);\n          link.setAttribute('href', url);\n          link.setAttribute('download', fileName);\n          link.style.visibility = 'hidden';\n          document.body.appendChild(link);\n          link.click();\n          document.body.removeChild(link);\n          \n          // Add delay between downloads\n          await new Promise(resolve => setTimeout(resolve, 400));\n        }\n\n        // After exporting base tables for this tab, export per-metric variants as well\n        await exportMetricVariantsForActiveSection(locationSuffix, timestamp, tabLabel || tabValue);\n      }\n    }\n    \n    // Return to the original active tab\n    if (originalActiveTab instanceof HTMLElement) {\n      originalActiveTab.click();\n      // Wait for tab to become active again\n      await new Promise(resolve => setTimeout(resolve, 300));\n    }\n  };\n\n  const toggleExportSection = (section: keyof ExportConfig) => {\n    setExportConfig(prev => ({\n      ...prev,\n      [section]: !prev[section]\n    }));\n  };\n\n  return (\n    <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n      {renderTrigger !== false && (\n        <DialogTrigger asChild>\n          <Button \n            variant={buttonVariant} \n            size={buttonSize} \n            className={cn('gap-2', buttonClassName)}\n            style={{ borderColor: 'var(--hero-accent, rgba(255,255,255,0.3))' }}\n          >\n            <Download className=\"h-4 w-4\" />\n            {buttonLabel ?? 'Export All Sales Data'}\n          </Button>\n        </DialogTrigger>\n      )}\n      <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <TrendingUp className=\"h-5 w-5\" />\n            Comprehensive Sales Export\n          </DialogTitle>\n          <DialogDescription>\n            Export all sales analytics tables and metrics for {locationName}. \n            Each metric will be exported as separate CSV files for detailed analysis.\n          </DialogDescription>\n        </DialogHeader>\n        \n        <div className=\"space-y-6\">\n          {/* Export Sections */}\n          <div>\n            <Label className=\"text-sm font-medium\">Export Options</Label>\n            <div className=\"grid grid-cols-2 gap-3 mt-2\">\n              {Object.entries(exportConfig).map(([key, value]) => {\n                const labelMap: Record<keyof ExportConfig, string> = {\n                  currentView: 'Current View Only',\n                  monthOnMonth: 'Month-on-Month Tab',\n                  yearOnYear: 'Year-on-Year Tab',\n                  productPerformance: 'Product Performance Tab',\n                  categoryPerformance: 'Category Performance Tab',\n                  soldByAnalysis: 'Sold By Analysis Tab',\n                  paymentMethodAnalysis: 'Payment Methods Tab',\n                  allTabs: 'All Tabs (Comprehensive)'\n                };\n                \n                return (\n                  <div key={key} className=\"flex items-center space-x-2\">\n                    <Checkbox\n                      id={key}\n                      checked={value}\n                      onCheckedChange={() => toggleExportSection(key as keyof ExportConfig)}\n                    />\n                    <Label htmlFor={key} className=\"text-sm\">\n                      {labelMap[key as keyof ExportConfig] || key}\n                    </Label>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n\n          {/* Current View Info */}\n          <div className=\"p-3 bg-green-50 rounded-lg border border-green-200\">\n            <h4 className=\"font-medium text-green-900 mb-2\">Current View</h4>\n            <p className=\"text-sm text-green-700\">\n              Active Tab: <span className=\"font-medium\">{(() => {\n                const { tabText } = getCurrentTabInfo();\n                return tabText;\n              })()}</span><br/>\n              Location: <span className=\"font-medium\">{locationName}</span><br/>\n              Data Source: <span className=\"font-medium\">Live table data as displayed in UI</span>\n            </p>\n          </div>\n\n          {/* Export Summary */}\n          <div className=\"p-3 bg-blue-50 rounded-lg border border-blue-200\">\n            <h4 className=\"font-medium text-blue-900 mb-2\">Export Summary</h4>\n            <p className=\"text-sm text-blue-700\">\n              {exportConfig.currentView && (\n                <>Current view will be exported as displayed.<br/></>\n              )}\n              {(exportConfig.allTabs || Object.entries(exportConfig).filter(([key, value]) => \n                key !== 'currentView' && key !== 'allTabs' && value\n              ).length > 0) && (\n                <>Additional tabs will be exported by switching between them.<br/></>\n              )}\n              Export format: <span className=\"font-medium\">CSV files</span>\n            </p>\n          </div>\n\n          <div className=\"flex justify-end space-x-3\">\n            <Button \n              variant=\"outline\" \n              onClick={() => setIsDialogOpen(false)}\n              disabled={isExporting}\n            >\n              Cancel\n            </Button>\n            <Button \n              onClick={handleExportPDF}\n              disabled={isExporting}\n              variant=\"secondary\"\n              className=\"gap-2\"\n            >\n              {isExporting ? (\n                <>\n                  <BrandSpinner size=\"xs\" />\n                  Building PDF...\n                </>\n              ) : (\n                <>\n                  <FileSpreadsheet className=\"h-4 w-4\" />\n                  Export PDF\n                </>\n              )}\n            </Button>\n            <Button \n              onClick={handleExport}\n              disabled={isExporting}\n              className=\"gap-2\"\n            >\n              {isExporting ? (\n                <>\n                  <BrandSpinner size=\"xs\" />\n                  Exporting...\n                </>\n              ) : (\n                <>\n                  <FileSpreadsheet className=\"h-4 w-4\" />\n                  Export CSV Files\n                </>\n              )}\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};","import React from 'react';\nimport SalesMotionHero from '@/components/ui/SalesMotionHero';\nimport { ComprehensiveSalesExportButton } from './ComprehensiveSalesExportButton';\nimport { useNavigate } from 'react-router-dom';\nimport { useSalesMetrics } from '@/hooks/useSalesMetrics';\nimport { SalesData } from '@/types/dashboard';\n\ninterface SalesHeroSectionProps {\n  data: SalesData[];\n  historicalData?: SalesData[];\n  dateRange?: { start: string | Date; end: string | Date };\n  currentLocation: string;\n  locationName: string;\n}\n\nexport const SalesHeroSection: React.FC<SalesHeroSectionProps> = ({ data, historicalData, dateRange, currentLocation, locationName }) => {\n  const { metrics } = useSalesMetrics(data, historicalData, { dateRange });\n  const [heroColor, setHeroColor] = React.useState<string>('#3b82f6');\n  const lastUpdateRef = React.useRef<number>(0);\n  const lastSetColorRef = React.useRef<string>('#3b82f6');\n  const navigate = useNavigate();\n  const exportOpenRef = React.useRef<{ open: () => void }>(null);\n\n  // Throttled color update to prevent excessive updates from animation\n  const throttledColorUpdate = React.useCallback((newColor: string) => {\n    const now = Date.now();\n    // Throttle to maximum 5 updates per second (200ms) and check if color actually changed\n    if (now - lastUpdateRef.current > 200 && newColor !== lastSetColorRef.current) {\n      lastUpdateRef.current = now;\n      lastSetColorRef.current = newColor;\n      setHeroColor(newColor);\n    }\n  }, []);\n\n  // Make hero accent available globally for other components (like tabs) but throttle DOM updates\n  React.useEffect(() => {\n    const root = document.documentElement;\n    const currentValue = root.style.getPropertyValue('--hero-accent');\n    \n    // Only update if the color has actually changed significantly\n    if (heroColor !== currentValue) {\n      root.style.setProperty('--hero-accent', heroColor);\n    }\n    \n    return () => {\n      // Clean up on unmount\n      root.style.removeProperty('--hero-accent');\n    };\n  }, [heroColor]);\n\n  // Select only 3 key metrics for hero section\n  const metricOrder = [\n    'Transactions',\n    'Sales Revenue', \n    'Unique Members'\n  ];\n  \n  const heroMetrics = metricOrder\n    .map(title => metrics.find(metric => metric.title === title))\n    .filter(Boolean)\n    .map(metric => ({\n      location: metric!.title,\n      label: metric!.description,\n      value: metric!.value,\n      icon: metric!.icon,\n      change: metric!.change,\n      trend: metric!.changeDetails.trend,\n      previousValue: metric!.previousValue\n    }));\n\n  return (\n    <div style={{ ['--hero-accent' as any]: heroColor }}>\n      <SalesMotionHero\n        title=\"Sales & Revenue Analytics\"\n        subtitle=\"Track all transactional and payment metrics in one place with real-time, location-aware analytics\"\n      metrics={heroMetrics.map(m => ({\n        label: m.location,\n        value: m.value,\n        change: m.change != null \n          ? `${m.change > 0 ? '+' : ''}${m.change.toFixed(1)}%`\n          : undefined\n      }))}\n      primaryAction={{ label: 'View Dashboard', onClick: () => navigate('/') }}\n      secondaryAction={{ label: 'Export All Sales Data', onClick: () => exportOpenRef.current?.open() }}\n        compact\n        onColorChange={throttledColorUpdate}\n        extra={<ComprehensiveSalesExportButton \n          data={data} \n          currentLocation={currentLocation} \n          locationName={locationName}\n          renderTrigger={false}\n          openRef={exportOpenRef}\n        />}\n      />\n    </div>\n  );\n};","import * as React from \"react\";\nimport { useSectionNavigation } from \"@/contexts/SectionNavigationContext\";\n\ntype SectionAnchorProps = {\n  id: string;\n  label: string;\n  activate?: () => void | Promise<void>;\n  children: React.ReactNode;\n  className?: string;\n};\n\nexport function SectionAnchor({ id, label, activate, children, className }: SectionAnchorProps) {\n  const { addSection, removeSection } = useSectionNavigation();\n\n  React.useEffect(() => {\n    // Use activate directly without memoization to prevent dependency issues\n    const activateFunction = activate || (() => {});\n    addSection({ id, label, activate: activateFunction, getElement: () => document.getElementById(id) });\n    return () => removeSection(id);\n  }, [id, label]); // Only depend on id and label which are stable\n\n  return (\n    <section id={id} className={\"scroll-mt-24 \" + (className ?? \"\") }>\n      {children}\n    </section>\n  );\n}\n\nexport default SectionAnchor;\n","import React, { useMemo, useState, useCallback } from 'react';\nimport { SalesData } from '@/types/dashboard';\nimport { ModernMetricTabs, ModernTableWrapper } from './ModernTableWrapper';\nimport { Activity, Users, ShoppingCart, Clock, Percent, Calendar, Star } from 'lucide-react';\nimport { formatCurrency, formatNumber } from '@/utils/formatters';\nimport { PersistentTableFooter } from '@/components/dashboard/PersistentTableFooter';\nimport { useTableCopyContext } from '@/hooks/useTableCopyContext';\n\ninterface Props {\n  data: SalesData[]; // Provide data independent of date filters\n  onRowClick?: (row: any) => void;\n  onReady?: () => void;\n}\n\nconst BEHAVIOR_METRICS = [\n  { key: 'purchaseFrequency', label: 'Purchase Frequency (days)', icon: <Clock className=\"w-4 h-4\" /> },\n  { key: 'avgSpend', label: 'Avg Spend per Member', icon: <Activity className=\"w-4 h-4\" /> },\n  { key: 'transactions', label: 'Transactions', icon: <ShoppingCart className=\"w-4 h-4\" /> },\n  { key: 'discountedTx', label: 'Discounted Transactions', icon: <Activity className=\"w-4 h-4\" /> },\n  { key: 'undiscountedTx', label: 'Undiscounted Transactions', icon: <Activity className=\"w-4 h-4\" /> },\n  { key: 'percentDiscounted', label: '% Discounted Transactions', icon: <Percent className=\"w-4 h-4\" /> },\n  { key: 'usedSessions', label: 'Used Sessions', icon: <Users className=\"w-4 h-4\" /> },\n  { key: 'avgSessionsPerMember', label: 'Avg Sessions per Member', icon: <Users className=\"w-4 h-4\" /> },\n  { key: 'avgCustomerLifespan', label: 'Avg Customer Lifespan (days)', icon: <Calendar className=\"w-4 h-4\" /> },\n  { key: 'avgDaysToSecondPurchase', label: 'Avg Days to Second Purchase', icon: <Clock className=\"w-4 h-4\" /> },\n];\n\nexport const CustomerBehaviorMonthOnMonthTable: React.FC<Props> = ({ data, onRowClick, onReady }) => {\n  const [selectedMetric, setSelectedMetric] = useState<string>('purchaseFrequency');\n  const [displayMode, setDisplayMode] = useState<'values' | 'growth'>('values');\n  const [collapsedCategories, setCollapsedCategories] = useState<Set<string>>(new Set());\n\n  // Get context information for enhanced table copying\n  const copyContext = useTableCopyContext();\n\n  const parseDate = (dateStr: string): Date | null => {\n    if (!dateStr) return null;\n    const ddmmyyyy = dateStr.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})$/);\n    if (ddmmyyyy) {\n      const [, day, month, year] = ddmmyyyy;\n      return new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n    }\n    const d = new Date(dateStr);\n    return isNaN(d.getTime()) ? null : d;\n  };\n\n  const monthKeys = useMemo(() => {\n    const months: { key: string; display: string; year: number; month: number }[] = [];\n    const now = new Date();\n    const currentYear = now.getFullYear();\n    const currentMonth = now.getMonth();\n\n    // Generate months from Jan 2024 to current month in ASCENDING order\n    const startDate = new Date(2024, 0, 1); // January 2024\n    const endDate = new Date(currentYear, currentMonth, 1);\n    \n    let date = new Date(startDate);\n    while (date <= endDate) {\n      const year = date.getFullYear();\n      const month = date.getMonth() + 1;\n      months.push({\n        key: `${year}-${String(month).padStart(2, '0')}`,\n        display: date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }),\n        year: year,\n        month: month,\n      });\n      date = new Date(year, date.getMonth() + 1, 1);\n    }\n    return months;\n  }, []);\n  \n  const getPreviousMonthKey = () => {\n    const now = new Date();\n    const prevMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\n    return `${prevMonth.getFullYear()}-${String(prevMonth.getMonth() + 1).padStart(2, '0')}`;\n  };\n  const previousMonthKey = getPreviousMonthKey();\n\n  const groupData = useMemo(() => {\n    const catMap = new Map<string, Map<string, SalesData[]>>();\n    data.forEach(item => {\n      const cat = item.cleanedCategory || 'Uncategorized';\n      const prod = item.cleanedProduct || 'Unspecified';\n      if (!catMap.has(cat)) catMap.set(cat, new Map());\n      const prodMap = catMap.get(cat)!;\n      if (!prodMap.has(prod)) prodMap.set(prod, []);\n      prodMap.get(prod)!.push(item);\n    });\n    return catMap;\n  }, [data]);\n\n  const groupByMember = (items: SalesData[]) => {\n    const map = new Map<string, SalesData[]>();\n    items.forEach(it => {\n      const id = it.memberId || it.customerEmail || 'unknown';\n      if (!map.has(id)) map.set(id, []);\n      map.get(id)!.push(it);\n    });\n    return map;\n  };\n\n  const getMetricValue = (items: SalesData[], metric: string) => {\n    if (items.length === 0) return 0;\n    if (metric === 'transactions') return items.length;\n    if (metric === 'discountedTx') return items.filter(it => (it.discountAmount || 0) > 0).length;\n    if (metric === 'undiscountedTx') return items.filter(it => (it.discountAmount || 0) <= 0).length;\n    if (metric === 'percentDiscounted') {\n      const disc = items.filter(it => (it.discountAmount || 0) > 0).length;\n      return items.length > 0 ? (disc / items.length) * 100 : 0;\n    }\n    if (metric === 'usedSessions') return items.reduce((s, it) => s + (it.secMembershipUsedSessions || 0), 0);\n\n    const byMember = groupByMember(items);\n    if (metric === 'avgSpend') {\n      const spends = Array.from(byMember.values()).map(list => list.reduce((sum, i) => sum + (i.paymentValue || 0), 0));\n      return spends.length ? spends.reduce((a, b) => a + b, 0) / spends.length : 0;\n    }\n    if (metric === 'avgSessionsPerMember') {\n      const sessions = Array.from(byMember.values()).map(list => list.reduce((sum, i) => sum + (i.secMembershipUsedSessions || 0), 0));\n      return sessions.length ? sessions.reduce((a, b) => a + b, 0) / sessions.length : 0;\n    }\n    if (metric === 'purchaseFrequency') {\n      const freqs: number[] = [];\n      byMember.forEach(list => {\n        const dates = list.map(l => parseDate(l.paymentDate)).filter((d): d is Date => !!d).sort((a, b) => a.getTime() - b.getTime());\n        if (dates.length > 1) {\n          const totalDays = (dates[dates.length - 1].getTime() - dates[0].getTime()) / (1000 * 60 * 60 * 24);\n          freqs.push(totalDays / (dates.length - 1));\n        }\n      });\n      return freqs.length ? freqs.reduce((a, b) => a + b, 0) / freqs.length : 0;\n    }\n    if (metric === 'avgCustomerLifespan') {\n      const spans: number[] = [];\n      byMember.forEach(list => {\n        const dates = list.map(l => parseDate(l.paymentDate)).filter((d): d is Date => !!d).sort((a, b) => a.getTime() - b.getTime());\n        if (dates.length > 0) {\n          const span = (dates[dates.length - 1].getTime() - dates[0].getTime()) / (1000 * 60 * 60 * 24);\n          spans.push(span);\n        }\n      });\n      return spans.length ? spans.reduce((a, b) => a + b, 0) / spans.length : 0;\n    }\n    if (metric === 'avgDaysToSecondPurchase') {\n      const diffs: number[] = [];\n      byMember.forEach(list => {\n        const dates = list.map(l => parseDate(l.paymentDate)).filter((d): d is Date => !!d).sort((a, b) => a.getTime() - b.getTime());\n        if (dates.length > 1) {\n          const diff = (dates[1].getTime() - dates[0].getTime()) / (1000 * 60 * 60 * 24);\n          diffs.push(diff);\n        }\n      });\n      return diffs.length ? diffs.reduce((a, b) => a + b, 0) / diffs.length : 0;\n    }\n    return 0;\n  };\n\n  const formatValue = (value: number, metric: string) => {\n    if (metric === 'avgSpend') return formatCurrency(value);\n    if (['purchaseFrequency', 'avgCustomerLifespan', 'avgDaysToSecondPurchase'].includes(metric)) return value.toFixed(1);\n    if (metric === 'avgSessionsPerMember') return value.toFixed(1);\n    if (metric === 'percentDiscounted') return value.toFixed(1);\n    return formatNumber(value);\n  };\n\n  const processed = useMemo(() => {\n    // Build nested structure: category -> product -> monthly values\n    const categories: Array<{ \n      category: string;\n      products: Array<{ product: string; monthlyValues: Record<string, number>; rawData: SalesData[]; totalValue: number; }>;\n      monthlyValues: Record<string, number>;\n    }> = [];\n\n    groupData.forEach((prodMap, category) => {\n      const products: Array<{ product: string; monthlyValues: Record<string, number>; rawData: SalesData[]; totalValue: number; }> = [];\n      prodMap.forEach((items, product) => {\n        const monthlyValues: Record<string, number> = {};\n        monthKeys.forEach(({ key, year, month }) => {\n          const monthItems = items.filter(it => {\n            const d = parseDate(it.paymentDate);\n            return d && d.getFullYear() === year && d.getMonth() + 1 === month;\n          });\n          monthlyValues[key] = getMetricValue(monthItems, selectedMetric);\n        });\n        products.push({ product, monthlyValues, rawData: items, totalValue: getMetricValue(items, selectedMetric) });\n      });\n\n      // Category monthly values derived from raw items across all its products\n      const categoryMonthlyValues: Record<string, number> = {};\n      monthKeys.forEach(({ key, year, month }) => {\n        const monthItems = Array.from(prodMap.values()).flat().filter(it => {\n          const d = parseDate(it.paymentDate);\n          return d && d.getFullYear() === year && d.getMonth() + 1 === month;\n        });\n        categoryMonthlyValues[key] = getMetricValue(monthItems, selectedMetric);\n      });\n\n      categories.push({\n        category,\n        products: products.sort((a, b) => b.totalValue - a.totalValue),\n        monthlyValues: categoryMonthlyValues,\n      });\n    });\n\n    return categories.sort((a, b) => {\n      const aSum = Object.values(a.monthlyValues).reduce((s, v) => s + v, 0);\n      const bSum = Object.values(b.monthlyValues).reduce((s, v) => s + v, 0);\n      return bSum - aSum;\n    });\n  }, [groupData, monthKeys, selectedMetric]);\n\n  React.useEffect(() => {\n    if (processed.length) onReady?.();\n  }, [processed, onReady]);\n\n  const getGrowthPercentage = (current: number, previous: number) => {\n    if (previous === 0) return null;\n    const growth = ((current - previous) / previous) * 100;\n    return `${growth.toFixed(1)}%`;\n  };\n\n  // Function to generate content for all metric tabs\n  const generateAllTabsContent = useCallback(async () => {\n    let allContent = `Customer Purchase Behavior - All Metrics\\n`;\n    allContent += `Exported on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}\\n`;\n    allContent += `\\n${'='.repeat(80)}\\n\\n`;\n\n    // Loop through all behavior metrics\n    for (const metricInfo of BEHAVIOR_METRICS) {\n      const metric = metricInfo.key;\n\n      allContent += `\\n${metricInfo.label.toUpperCase()}\\n`;\n      allContent += `${'-'.repeat(metricInfo.label.length + 10)}\\n\\n`;\n\n      // Add table headers\n      const headers = ['Category / Product', 'Total'];\n      monthKeys.forEach(month => headers.push(month.display));\n      allContent += headers.join('\\t') + '\\n';\n      allContent += headers.map(() => '---').join('\\t') + '\\n';\n\n      // Reprocess data specifically for this metric\n      const categoryGroups: Record<string, Record<string, SalesData[]>> = {};\n      data.forEach(item => {\n        const cat = item.cleanedCategory || 'Uncategorized';\n        const prod = item.cleanedProduct || 'Unknown';\n        if (!categoryGroups[cat]) categoryGroups[cat] = {};\n        if (!categoryGroups[cat][prod]) categoryGroups[cat][prod] = [];\n        categoryGroups[cat][prod].push(item);\n      });\n\n      const metricProcessedData = Object.entries(categoryGroups).map(([category, products]) => {\n        const productsData = Object.entries(products).map(([product, items]) => {\n          const monthlyValues: Record<string, number> = {};\n          \n          monthKeys.forEach(({ key, year, month }) => {\n            const monthItems = items.filter(item => {\n              const itemDate = parseDate(item.paymentDate);\n              return itemDate && itemDate.getFullYear() === year && itemDate.getMonth() + 1 === month;\n            });\n            monthlyValues[key] = getMetricValue(monthItems, metric);\n          });\n\n          return {\n            product,\n            monthlyValues,\n            totalValue: getMetricValue(items, metric)\n          };\n        });\n\n        const categoryMonthlyValues: Record<string, number> = {};\n        monthKeys.forEach(({ key }) => {\n          categoryMonthlyValues[key] = productsData.reduce((sum, p) => sum + (p.monthlyValues[key] || 0), 0);\n        });\n\n        return {\n          category,\n          products: productsData,\n          monthlyValues: categoryMonthlyValues,\n          totalValue: productsData.reduce((sum, p) => sum + p.totalValue, 0)\n        };\n      });\n\n      // Add data rows\n      metricProcessedData.forEach(categoryData => {\n        // Category row\n        const categoryRow = [categoryData.category, formatMetricValue(categoryData.totalValue, metric)];\n        \n        monthKeys.forEach(month => {\n          const value = categoryData.monthlyValues[month.key] || 0;\n          categoryRow.push(formatMetricValue(value, metric));\n        });\n        allContent += categoryRow.join('\\t') + '\\n';\n\n        // Product rows\n        categoryData.products.forEach(productData => {\n          const productRow = [`  ${productData.product}`, formatMetricValue(productData.totalValue, metric)];\n          \n          monthKeys.forEach(month => {\n            const value = productData.monthlyValues[month.key] || 0;\n            productRow.push(formatMetricValue(value, metric));\n          });\n          allContent += productRow.join('\\t') + '\\n';\n        });\n      });\n\n      allContent += `\\n`;\n    }\n\n    return allContent;\n  }, [data, monthKeys]);\n\n  // Helper function to format metric values\n  const formatMetricValue = (value: number, metric: string): string => {\n    if (metric === 'avgSpend') return formatCurrency(value);\n    if (metric === 'percentDiscounted') return `${value.toFixed(1)}%`;\n    if (metric.includes('Frequency') || metric.includes('Lifespan') || metric.includes('Days')) {\n      return `${value.toFixed(1)} days`;\n    }\n    return formatNumber(value);\n  };\n\n  // AI footer data (flattened rows for current metric)\n  const aiTableColumns = [\n    { header: 'Category', key: 'category', type: 'text' },\n    { header: 'Product', key: 'product', type: 'text' },\n    { header: 'Month', key: 'month', type: 'text' },\n    { header: 'Value', key: 'value', type: 'number' },\n  ];\n  const aiTableData = useMemo(() => {\n    const rows: any[] = [];\n    processed.forEach(cat => {\n      cat.products.forEach(prod => {\n        Object.entries(prod.monthlyValues).forEach(([month, val]) => {\n          rows.push({ category: cat.category, product: prod.product, month, value: val });\n        });\n      });\n    });\n    return rows;\n  }, [processed]);\n\n  return (\n    <div className=\"space-y-4\">\n      <ModernMetricTabs metrics={BEHAVIOR_METRICS as any} selectedMetric={selectedMetric} onMetricChange={setSelectedMetric} />\n\n      <ModernTableWrapper\n        title=\"Customer Purchase Behavior (All Dates)\"\n        description=\"Month-on-month behavior metrics by category and product (ignores date filters)\"\n        icon={<Activity className=\"w-5 h-5 text-white\" />}\n        showCollapseControls={true}\n        onCollapseAll={() => {\n          const all = new Set<string>();\n          processed.forEach(c => all.add(c.category));\n          setCollapsedCategories(all);\n        }}\n        onExpandAll={() => setCollapsedCategories(new Set())}\n        showDisplayToggle={true}\n        displayMode={displayMode}\n        onDisplayModeChange={setDisplayMode}\n        onCopyAllTabs={generateAllTabsContent}\n        contextInfo={{\n          selectedMetric: selectedMetric,\n          dateRange: copyContext.dateRange,\n          filters: copyContext.filters,\n          additionalInfo: {\n            displayMode: displayMode,\n            behaviorMetric: selectedMetric,\n            collapsedCategories: Array.from(collapsedCategories)\n          }\n        }}\n      >\n        <div className=\"overflow-x-auto\" data-table=\"customer-behavior-analysis\">\n          <table className=\"min-w-full bg-white\">\n            <thead className=\"sticky top-0 z-30\">\n              <tr className=\"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n                <th className=\"w-[30rem] px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide sticky left-0 bg-gradient-to-r from-slate-800 to-slate-900 z-40 border-r border-white/20\">\n                  Category / Product\n                </th>\n                {monthKeys.map(({ key, display }) => {\n                  const isPreviousMonth = key === previousMonthKey;\n                  return (\n                    <th key={key} className={`px-3 py-3 text-center font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[90px] ${\n                      isPreviousMonth ? 'bg-blue-800 text-white' : 'text-white'\n                    }`}>\n                      <div className=\"flex flex-col items-center\">\n                        <div className=\"flex items-center space-x-1\">\n                          {isPreviousMonth && <Star className=\"w-3 h-3\" />}\n                          <span className=\"text-xs font-bold whitespace-nowrap\">{display.split(' ')[0]}</span>\n                        </div>\n                        <span className=\"text-slate-300 text-xs\">{display.split(' ')[1]}</span>\n                      </div>\n                    </th>\n                  );\n                })}\n              </tr>\n            </thead>\n\n            <tbody>\n              {processed.map(cat => (\n                <React.Fragment key={cat.category}>\n                  <tr className=\"bg-slate-100 border-b border-slate-300 font-semibold h-9 max-h-9\">\n                    <td\n                      className=\"w-[30rem] px-6 py-3 text-left sticky left-0 bg-gradient-to-r from-slate-100 via-blue-50 to-indigo-50 border-r border-slate-300 z-20 cursor-pointer hover:underline whitespace-nowrap overflow-hidden text-ellipsis\"\n                      onClick={() =>\n                        onRowClick?.({\n                          category: cat.category,\n                          name: cat.category,\n                          filterCriteria: { category: cat.category },\n                          drillDownContext: {\n                            source: 'customerBehavior',\n                            level: 'category',\n                            metric: selectedMetric,\n                            category: cat.category,\n                          },\n                        })\n                      }\n                      title={`View all transactions for ${cat.category}`}\n                    >\n                      <span className=\"text-slate-800 font-bold\">{cat.category}</span>\n                    </td>\n                    {monthKeys.map(({ key }, idx) => {\n                      const current = cat.monthlyValues[key] || 0;\n                      const prevKey = monthKeys[idx + 1]?.key;\n                      const previous = prevKey ? (cat.monthlyValues[prevKey] || 0) : 0;\n                      const growth = prevKey ? getGrowthPercentage(current, previous) : null;\n                      return (\n                        <td\n                          key={key}\n                          className=\"px-2 py-3 text-center text-sm font-bold text-slate-800 border-l border-slate-300 cursor-pointer hover:bg-blue-100/60 whitespace-nowrap\"\n                          onClick={() =>\n                            onRowClick?.({\n                              category: cat.category,\n                              name: cat.category,\n                              filterCriteria: { month: key, category: cat.category },\n                              drillDownContext: {\n                                source: 'customerBehavior',\n                                level: 'category',\n                                metric: selectedMetric,\n                                category: cat.category,\n                                month: key,\n                              },\n                            })\n                          }\n                          title={`View ${cat.category} transactions for ${key}`}\n                        >\n                          {displayMode === 'values' ? (\n                            formatValue(current, selectedMetric)\n                          ) : (\n                            <span className={growth ? (parseFloat(growth) > 0 ? 'text-emerald-600' : 'text-red-500') : ''}>\n                              {growth ?? '—'}\n                            </span>\n                          )}\n                        </td>\n                      );\n                    })}\n                  </tr>\n                  {!collapsedCategories.has(cat.category) && cat.products.map(prod => (\n                    <tr key={`${cat.category}-${prod.product}`} className=\"bg-white hover:bg-blue-50 border-b border-gray-200 transition-all h-9 max-h-9\">\n                      <td\n                        className=\"w-[30rem] px-10 py-3 text-left sticky left-0 bg-white border-r border-gray-200 z-10 cursor-pointer hover:underline whitespace-nowrap overflow-hidden text-ellipsis\"\n                        onClick={() =>\n                          onRowClick?.({\n                            product: prod.product,\n                            name: prod.product,\n                            filterCriteria: { product: prod.product },\n                            drillDownContext: {\n                              source: 'customerBehavior',\n                              level: 'product',\n                              metric: selectedMetric,\n                              category: cat.category,\n                              product: prod.product,\n                            },\n                          })\n                        }\n                        title={`View all transactions for ${prod.product}`}\n                      >\n                        <div className=\"flex items-center space-x-2\">\n                          <span className=\"text-slate-400 text-xs\">→</span>\n                          <span className=\"text-slate-700 font-medium text-xs\">{prod.product}</span>\n                        </div>\n                      </td>\n                      {monthKeys.map(({ key }, idx) => {\n                        const current = prod.monthlyValues[key] || 0;\n                        const prevKey = monthKeys[idx + 1]?.key;\n                        const previous = prevKey ? (prod.monthlyValues[prevKey] || 0) : 0;\n                        const growth = prevKey ? getGrowthPercentage(current, previous) : null;\n                        return (\n                          <td\n                            key={key}\n                            className=\"px-2 py-3 text-center text-sm font-mono text-slate-700 border-l border-gray-200 cursor-pointer hover:bg-blue-100/60 whitespace-nowrap\"\n                            onClick={() =>\n                              onRowClick?.({\n                                product: prod.product,\n                                name: prod.product,\n                                filterCriteria: { month: key, product: prod.product },\n                                drillDownContext: {\n                                  source: 'customerBehavior',\n                                  level: 'product',\n                                  metric: selectedMetric,\n                                  category: cat.category,\n                                  product: prod.product,\n                                  month: key,\n                                },\n                              })\n                            }\n                            title={`View ${prod.product} transactions for ${key}`}\n                          >\n                            {displayMode === 'values' ? (\n                              formatValue(current, selectedMetric)\n                            ) : (\n                              <span className={growth ? (parseFloat(growth) > 0 ? 'text-emerald-600' : 'text-red-500') : ''}>\n                                {growth ?? '—'}\n                              </span>\n                            )}\n                          </td>\n                        );\n                      })}\n                    </tr>\n                  ))}\n                </React.Fragment>\n              ))}\n\n              {/* Totals row across all categories/products per month */}\n              <tr className=\"bg-slate-800 text-white font-bold border-t-2 border-slate-400 h-9 max-h-9\">\n                <td\n                  className=\"w-[30rem] px-6 py-3 text-left sticky left-0 bg-slate-800 border-r border-slate-400 z-20 cursor-pointer hover:underline whitespace-nowrap\"\n                  onClick={() =>\n                    onRowClick?.({\n                      name: 'TOTALS',\n                      filterCriteria: {},\n                      drillDownContext: {\n                        source: 'customerBehavior',\n                        level: 'total',\n                        metric: selectedMetric,\n                      },\n                    })\n                  }\n                  title=\"View all transactions across all months\"\n                >\n                  TOTALS\n                </td>\n                {monthKeys.map(({ key, year, month }, idx) => {\n                  const monthItems = data.filter(it => {\n                    const d = parseDate(it.paymentDate);\n                    return d && d.getFullYear() === year && d.getMonth() + 1 === month;\n                  });\n                  const totalVal = getMetricValue(monthItems, selectedMetric);\n                  const prevMonth = monthKeys[idx + 1];\n                  let growth: string | null = null;\n                  if (prevMonth) {\n                    const prevItems = data.filter(it => {\n                      const d = parseDate(it.paymentDate);\n                      return d && d.getFullYear() === prevMonth.year && d.getMonth() + 1 === prevMonth.month;\n                    });\n                    const prevVal = getMetricValue(prevItems, selectedMetric);\n                    growth = getGrowthPercentage(totalVal, prevVal);\n                  }\n                  return (\n                    <td\n                      key={key}\n                      className=\"px-2 py-3 text-center text-sm font-bold text-white border-l border-slate-400 cursor-pointer hover:bg-slate-700/60 whitespace-nowrap\"\n                      onClick={() =>\n                        onRowClick?.({\n                          name: 'TOTALS',\n                          filterCriteria: { month: key },\n                          drillDownContext: {\n                            source: 'customerBehavior',\n                            level: 'total',\n                            metric: selectedMetric,\n                            month: key,\n                          },\n                        })\n                      }\n                      title={`View all transactions for ${key}`}\n                    >\n                      {displayMode === 'values' ? (\n                        formatValue(totalVal, selectedMetric)\n                      ) : (\n                        <span className={growth ? (parseFloat(growth) > 0 ? 'text-emerald-300' : 'text-red-300') : ''}>\n                          {growth ?? '—'}\n                        </span>\n                      )}\n                    </td>\n                  );\n                })}\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </ModernTableWrapper>\n\n      <PersistentTableFooter\n        tableId=\"customer-behavior-mom\"\n        initialText=\"• Behavior insights across all dates (location context may still apply)\\n• Metrics include purchase frequency, spends, sessions usage, and discount patterns\\n• Use the export for AI-driven summaries and trends\"\n        tableName=\"Customer Behavior (MoM)\"\n        tableContext={`Behavior metric: ${BEHAVIOR_METRICS.find(m => m.key === selectedMetric)?.label}`}\n        tableData={aiTableData}\n        tableColumns={aiTableColumns as any}\n      />\n    </div>\n  );\n};\n","import React, { useState, useMemo, useEffect, useCallback } from 'react';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { MapPin, Building2, Landmark, Building, Calendar, TrendingUp, ShoppingCart, FolderOpen, Users, CreditCard, UserCheck } from 'lucide-react';\nimport { AutoCloseFilterSection } from './AutoCloseFilterSection';\nimport { MetricCard } from './MetricCard';\nimport { UnifiedTopBottomSellers } from './UnifiedTopBottomSellers';\nimport { DataTable } from './DataTable';\nimport { InteractiveChart } from './InteractiveChart';\nimport { ThemeSelector } from './ThemeSelector';\nimport { LazyEnhancedSalesDrillDownModal } from '@/components/lazy/LazyModals';\nimport { ModalSuspense } from '@/components/lazy/ModalSuspense';\nimport { getActiveTabClasses } from '@/utils/colorThemes';\nimport { EnhancedYearOnYearTableNew } from './EnhancedYearOnYearTableNew';\nimport { MonthOnMonthTableNew } from './MonthOnMonthTableNew';\nimport { ProductPerformanceTableNew } from './ProductPerformanceTableNew';\nimport { CategoryPerformanceTableNew } from './CategoryPerformanceTableNew';\nimport { SalesAnimatedMetricCards } from './SalesAnimatedMetricCards';\nimport { SalesInteractiveCharts } from './SalesInteractiveCharts';\nimport { SoldByMonthOnMonthTableNew } from './SoldByMonthOnMonthTableNew';\nimport { PaymentMethodMonthOnMonthTableNew } from './PaymentMethodMonthOnMonthTableNew';\nimport { ProductCategoryMetricsTable } from './ProductCategoryMetricsTable';\nimport { SalesHeroSection } from './SalesHeroSection';\nimport QuickSections from '@/components/ui/QuickSections';\nimport SectionTimelineNav from '@/components/ui/SectionTimelineNav';\nimport SectionAnchor from '@/components/ui/SectionAnchor';\nimport { useSectionNavigation } from '@/contexts/SectionNavigationContext';\nimport { ModernSalesTable } from './ModernSalesTable';\nimport { SalesData, FilterOptions, MetricCardData, YearOnYearMetricType } from '@/types/dashboard';\nimport { formatCurrency, formatNumber, formatPercentage, formatDiscount } from '@/utils/formatters';\nimport { getPreviousMonthDateRange } from '@/utils/dateUtils';\nimport { cn } from '@/lib/utils';\nimport { AdvancedExportButton } from '@/components/ui/AdvancedExportButton';\nimport { ComprehensiveSalesExportButton } from './ComprehensiveSalesExportButton';\nimport { useGlobalFilters } from '@/contexts/GlobalFiltersContext';\nimport { CustomerBehaviorMonthOnMonthTable } from './CustomerBehaviorMonthOnMonthTable';\nimport { InfoPopover } from '@/components/ui/InfoSidebar';\nimport { StudioLocationTabs } from '@/components/ui/StudioLocationTabs';\n\ninterface SalesAnalyticsSectionProps {\n  data: SalesData[];\n  onReady?: () => void;\n}\n\nconst locations = [{\n  id: 'all',\n  name: 'All Locations, ',\n  fullName: 'All Studio Locations'\n}, {\n  id: 'kwality',\n  name: 'Kwality House, Kemps Corner',\n  fullName: 'Kwality House, Kemps Corner'\n}, {\n  id: 'supreme',\n  name: 'Supreme HQ, Bandra',\n  fullName: 'Supreme HQ, Bandra'\n}, {\n  id: 'kenkere',\n  name: 'Kenkere House, Bengaluru',\n  fullName: 'Kenkere House, Bengaluru'\n}, {\n  id: 'popup',\n  name: 'Pop-up',\n  fullName: 'Pop-up'\n}];\n\nexport const SalesAnalyticsSection: React.FC<SalesAnalyticsSectionProps> = ({ data, onReady }) => {\n  const { filters: globalFilters } = useGlobalFilters();\n  const periodId = globalFilters?.dateRange\n    ? `${globalFilters.dateRange.start}:${globalFilters.dateRange.end}`\n    : 'all-time';\n  const [activeLocation, setActiveLocation] = useState('kwality');\n  const [currentTheme, setCurrentTheme] = useState('classic');\n  const [isDarkMode, setIsDarkMode] = useState(false);\n  const [drillDownData, setDrillDownData] = useState<any>(null);\n  const [drillDownType, setDrillDownType] = useState<'metric' | 'product' | 'category' | 'member' | 'soldBy' | 'paymentMethod'>('metric');\n  const [collapsedGroups, setCollapsedGroups] = useState<Set<string>>(new Set());\n  const [activeYoyMetric, setActiveYoyMetric] = useState<YearOnYearMetricType>('revenue');\n\n  // Debug CSS variables\n  React.useEffect(() => {\n    const root = document.documentElement;\n    const heroAccent = root.style.getPropertyValue('--hero-accent') || getComputedStyle(root).getPropertyValue('--hero-accent');\n    console.log('Sales Section: Current --hero-accent:', heroAccent);\n    console.log('Sales Section: Active location:', activeLocation);\n  }, [activeLocation]);\n  const [isReady, setIsReady] = useState(false);\n  const markReady = React.useCallback(() => setIsReady(true), []);\n  const { addSection, removeSection } = useSectionNavigation();\n\n  React.useEffect(() => {\n    if (isReady) {\n      onReady?.();\n    }\n  }, [isReady, onReady]);\n\n  // Initialize filters with previous month as default\n  const [filters, setFilters] = useState<FilterOptions>(() => {\n    const previousMonth = getPreviousMonthDateRange();\n    \n    return {\n      dateRange: previousMonth,\n      location: [],\n      category: [],\n      product: [],\n      soldBy: [],\n      paymentMethod: []\n    };\n  });\n\n  const applyFilters = (rawData: SalesData[], includeHistoric: boolean = false) => {\n\n    \n    let filtered = [...rawData];\n\n    // Apply location filter\n    if (activeLocation !== 'all') {\n      filtered = filtered.filter(item => {\n        const loc = (item.calculatedLocation || '').toString().toLowerCase();\n        const locationMatch = activeLocation === 'kwality'\n          ? loc.includes('kwality') || loc.includes('kemps')\n          : activeLocation === 'supreme'\n          ? loc.includes('supreme') || loc.includes('bandra')\n          : activeLocation === 'kenkere'\n          ? loc.includes('kenkere') || loc.includes('bengaluru')\n          : activeLocation === 'popup'\n          ? loc.includes('pop') || loc.includes('popup') || loc.includes('pop-up')\n          : false;\n        return locationMatch;\n      });\n    }\n\n\n\n    // Apply date range filter\n    if (!includeHistoric && (filters.dateRange.start || filters.dateRange.end)) {\n      const startDate = filters.dateRange.start ? new Date(filters.dateRange.start) : null;\n      const endDate = filters.dateRange.end ? (() => {\n        const date = new Date(filters.dateRange.end);\n        // Set to end of day to include all transactions on the end date\n        date.setHours(23, 59, 59, 999);\n        return date;\n      })() : null;\n      \n\n      \n      filtered = filtered.filter(item => {\n        if (!item.paymentDate) return false;\n\n        let itemDate: Date | null = null;\n\n        // Try DD/MM/YYYY format first\n        const ddmmyyyy = item.paymentDate.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})$/);\n        if (ddmmyyyy) {\n          const [, day, month, year] = ddmmyyyy;\n          itemDate = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n        } else {\n          // Try other formats\n          const formats = [\n            new Date(item.paymentDate), \n            new Date(item.paymentDate.replace(/(\\d{2})\\/(\\d{2})\\/(\\d{4})/, '$3-$2-$1')), \n            new Date(item.paymentDate.replace(/(\\d{2})\\/(\\d{2})\\/(\\d{4})/, '$2/$1/$3'))\n          ];\n          \n          for (const date of formats) {\n            if (!isNaN(date.getTime()) && date.getFullYear() > 1900 && date.getFullYear() < 2100) {\n              itemDate = date;\n              break;\n            }\n          }\n        }\n\n        if (!itemDate || isNaN(itemDate.getTime())) return false;\n        if (startDate && itemDate < startDate) return false;\n        if (endDate && itemDate > endDate) return false;\n        return true;\n      });\n      \n\n    }\n\n    // Apply category filter\n    if (filters.category?.length) {\n      filtered = filtered.filter(item => \n        filters.category!.some(cat => \n          item.cleanedCategory?.toLowerCase().includes(cat.toLowerCase())\n        )\n      );\n\n    }\n\n    // Apply payment method filter\n    if (filters.paymentMethod?.length) {\n      filtered = filtered.filter(item => \n        filters.paymentMethod!.some(method => \n          item.paymentMethod?.toLowerCase().includes(method.toLowerCase())\n        )\n      );\n\n    }\n\n    // Apply sold by filter\n    if (filters.soldBy?.length) {\n      filtered = filtered.filter(item => \n        filters.soldBy!.some(seller => \n          item.soldBy?.toLowerCase().includes(seller.toLowerCase())\n        )\n      );\n\n    }\n\n    // Apply amount range filters\n    if (filters.minAmount) {\n      filtered = filtered.filter(item => (item.paymentValue || 0) >= filters.minAmount!);\n\n    }\n    \n    if (filters.maxAmount) {\n      filtered = filtered.filter(item => (item.paymentValue || 0) <= filters.maxAmount!);\n\n    }\n\n\n    return filtered;\n  };\n\n  const filteredData = useMemo(() => applyFilters(data), [data, filters, activeLocation]);\n  const allHistoricData = useMemo(() => applyFilters(data, true), [data, activeLocation]);\n  // Location-only historical dataset for MoM metrics (ignore non-date filters to reflect total sales at location)\n  const metricsHistoricData = useMemo(() => {\n    let filtered = [...data];\n    if (activeLocation !== 'all') {\n      filtered = filtered.filter(item => {\n        const loc = (item.calculatedLocation || '').toString().toLowerCase();\n        if (activeLocation === 'kwality') return loc.includes('kwality') || loc.includes('kemps');\n        if (activeLocation === 'supreme') return loc.includes('supreme') || loc.includes('bandra');\n        if (activeLocation === 'kenkere') return loc.includes('kenkere') || loc.includes('bengaluru');\n        if (activeLocation === 'popup') return loc.includes('pop') || loc.includes('popup') || loc.includes('pop-up');\n        return false;\n      });\n    }\n    return filtered;\n  }, [data, activeLocation]);\n\n  const handleRowClick = useCallback((rowData: any) => {\n\n    \n    // Use RAW DATA for drill-down to be independent of current filters\n    // Only apply location filtering to maintain context\n    let baseData = data;\n    console.log(`🔍 DRILL-DOWN: Starting with ${data.length} total records (RAW DATA)`);\n    console.log(`📊 COMPARISON: Current filtered view has ${filteredData.length} records`);\n    \n    if (activeLocation !== 'all') {\n      baseData = data.filter(item => {\n        const loc = (item.calculatedLocation || '').toString().toLowerCase();\n        const locationMatch = activeLocation === 'kwality'\n          ? loc.includes('kwality') || loc.includes('kemps')\n          : activeLocation === 'supreme'\n          ? loc.includes('supreme') || loc.includes('bandra')\n          : activeLocation === 'kenkere'\n          ? loc.includes('kenkere') || loc.includes('bengaluru')\n          : activeLocation === 'popup'\n          ? loc.includes('pop') || loc.includes('popup') || loc.includes('pop-up')\n          : false;\n        return locationMatch;\n      });\n      console.log(`📍 LOCATION FILTER: Reduced to ${baseData.length} records for location: ${activeLocation}`);\n    }\n    \n    let specificFilteredData = baseData;\n    let drillDownTypeToSet: 'metric' | 'product' | 'category' | 'member' | 'soldBy' | 'paymentMethod' = 'product';\n    \n    // Handle the new contextual filtering system - filter from ALL DATA, not current filtered view\n    if (rowData.filterCriteria && rowData.drillDownContext) {\n      console.log('Using enhanced contextual filtering on raw data:', rowData.drillDownContext);\n      const criteria = rowData.filterCriteria;\n      \n      // Check MORE SPECIFIC conditions first (combinations) before general conditions\n      if (criteria.month && criteria.product) {\n        // Month-specific product filtering - match YYYY-MM format from ALL DATA\n        console.log('🎯 CELL-SPECIFIC FILTERING:', {\n          month: criteria.month,\n          product: criteria.product,\n          baseDataCount: baseData.length\n        });\n        \n        specificFilteredData = baseData.filter(item => {\n          if (!item.paymentDate) return false;\n          \n          const itemDate = new Date(item.paymentDate);\n          const year = itemDate.getFullYear();\n          const month = itemDate.getMonth() + 1;\n          const itemKey = `${year}-${String(month).padStart(2, '0')}`;\n          \n          const productMatches = (\n            item.cleanedProduct?.toLowerCase() === criteria.product?.toLowerCase() ||\n            item.paymentItem?.toLowerCase() === criteria.product?.toLowerCase() ||\n            // Removed membershipName which does not exist on SalesData\n            item.paymentItem?.toLowerCase().includes(criteria.product?.toLowerCase() || '')\n          );\n          \n          const monthMatches = itemKey === criteria.month;\n          \n          if (productMatches && monthMatches) {\n            console.log('✅ EXACT MATCH FOUND:', {\n              product: item.cleanedProduct || item.paymentItem,\n              date: item.paymentDate,\n              itemKey,\n              criteriaMonth: criteria.month,\n              paymentValue: item.paymentValue\n            });\n          }\n          \n          return productMatches && monthMatches;\n        });\n        \n        console.log(`🎯 FINAL CELL-SPECIFIC RESULT: Found ${specificFilteredData.length} transactions for ${criteria.product} in ${criteria.month}`);\n        if (specificFilteredData.length > 0) {\n          const totalRevenue = specificFilteredData.reduce((sum, item) => sum + (item.paymentValue || 0), 0);\n          console.log(`💰 CELL REVENUE: ${totalRevenue} (should NOT be 13.4L if filtering correctly)`);\n        }\n        drillDownTypeToSet = 'product';\n        console.log(`Context-filtered by product + month: ${criteria.product} in ${criteria.month} - Found ${specificFilteredData.length} matching transactions`);\n      } else if (criteria.month && criteria.category) {\n        // Month-specific category filtering from ALL DATA\n        specificFilteredData = baseData.filter(item => {\n          if (!item.paymentDate) return false;\n          \n          const itemDate = new Date(item.paymentDate);\n          const year = itemDate.getFullYear();\n          const month = itemDate.getMonth() + 1;\n          const itemKey = `${year}-${String(month).padStart(2, '0')}`;\n          \n          const categoryMatches = item.cleanedCategory?.toLowerCase() === criteria.category?.toLowerCase();\n          const monthMatches = itemKey === criteria.month;\n          \n          return categoryMatches && monthMatches;\n        });\n        drillDownTypeToSet = 'category';\n        console.log(`Context-filtered by category + month: ${criteria.category} in ${criteria.month} - Found ${specificFilteredData.length} matching transactions`);\n      } else if (criteria.month && criteria.soldBy) {\n        // Month-specific seller filtering from ALL DATA\n        specificFilteredData = baseData.filter(item => {\n          if (!item.paymentDate) return false;\n          \n          const itemDate = new Date(item.paymentDate);\n          const year = itemDate.getFullYear();\n          const month = itemDate.getMonth() + 1;\n          const itemKey = `${year}-${String(month).padStart(2, '0')}`;\n          \n          const sellerMatches = item.soldBy?.toLowerCase() === criteria.soldBy?.toLowerCase();\n          const monthMatches = itemKey === criteria.month;\n          \n          return sellerMatches && monthMatches;\n        });\n        drillDownTypeToSet = 'soldBy';\n        console.log(`Context-filtered by seller + month: ${criteria.soldBy} in ${criteria.month} - Found ${specificFilteredData.length} matching transactions`);\n      } else if (criteria.month && criteria.paymentMethod) {\n        // Month-specific payment method filtering from ALL DATA\n        specificFilteredData = baseData.filter(item => {\n          if (!item.paymentDate) return false;\n          \n          const itemDate = new Date(item.paymentDate);\n          const year = itemDate.getFullYear();\n          const month = itemDate.getMonth() + 1;\n          const itemKey = `${year}-${String(month).padStart(2, '0')}`;\n          \n          const methodMatches = item.paymentMethod?.toLowerCase() === criteria.paymentMethod?.toLowerCase();\n          const monthMatches = itemKey === criteria.month;\n          \n          return methodMatches && monthMatches;\n        });\n        drillDownTypeToSet = 'paymentMethod';\n        console.log(`Context-filtered by payment method + month: ${criteria.paymentMethod} in ${criteria.month} - Found ${specificFilteredData.length} matching transactions`);\n      } else if (criteria.month) {\n        // Month-only filtering (for month total rows)\n        specificFilteredData = baseData.filter(item => {\n          if (!item.paymentDate) return false;\n          \n          const itemDate = new Date(item.paymentDate);\n          const year = itemDate.getFullYear();\n          const month = itemDate.getMonth() + 1;\n          const itemKey = `${year}-${String(month).padStart(2, '0')}`;\n          \n          return itemKey === criteria.month;\n        });\n        console.log(`Context-filtered by month only: ${criteria.month} - Found ${specificFilteredData.length} matching transactions`);\n      } else if (criteria.product) {\n        // Product-only filtering (no month specified)\n        specificFilteredData = baseData.filter(item => \n          item.cleanedProduct?.toLowerCase() === criteria.product?.toLowerCase() ||\n          item.paymentItem?.toLowerCase() === criteria.product?.toLowerCase()\n        );\n        drillDownTypeToSet = 'product';\n        console.log(`Context-filtered by product from ALL DATA: ${criteria.product} - Found ${specificFilteredData.length} matching transactions`);\n      } else if (criteria.category) {\n        // Category-only filtering (no month specified)\n        specificFilteredData = baseData.filter(item => \n          item.cleanedCategory?.toLowerCase() === criteria.category?.toLowerCase()\n        );\n        drillDownTypeToSet = 'category';\n        console.log(`Context-filtered by category from ALL DATA: ${criteria.category} - Found ${specificFilteredData.length} matching transactions`);\n      } else if (criteria.soldBy) {\n        // Seller-only filtering (no month specified)\n        specificFilteredData = baseData.filter(item => \n          item.soldBy?.toLowerCase() === criteria.soldBy?.toLowerCase()\n        );\n        drillDownTypeToSet = 'soldBy';\n        console.log(`Context-filtered by seller from ALL DATA: ${criteria.soldBy} - Found ${specificFilteredData.length} matching transactions`);\n      } else if (criteria.paymentMethod) {\n        // Payment method-only filtering (no month specified)\n        specificFilteredData = baseData.filter(item => \n          item.paymentMethod?.toLowerCase() === criteria.paymentMethod?.toLowerCase()\n        );\n        drillDownTypeToSet = 'paymentMethod';\n        console.log(`Context-filtered by payment method from ALL DATA: ${criteria.paymentMethod} - Found ${specificFilteredData.length} matching transactions`);\n      }\n      \n    } else if (rowData.rawData && Array.isArray(rowData.rawData) && rowData.rawData.length > 0) {\n      // Legacy: If we have transaction data already attached to the row, use that\n      specificFilteredData = rowData.rawData;\n      console.log(`Using pre-filtered rawData: ${specificFilteredData.length} transactions`);\n    } else if (Array.isArray(rowData) && rowData.length > 0) {\n      // Legacy: If rowData itself is an array of transactions, use it directly\n      specificFilteredData = rowData;\n      console.log(`Using rowData array directly: ${specificFilteredData.length} transactions`);\n    } else if (rowData.transactionData && Array.isArray(rowData.transactionData) && rowData.transactionData.length > 0) {\n      specificFilteredData = rowData.transactionData;\n      console.log(`Using pre-filtered transactionData: ${specificFilteredData.length} transactions`);\n    } else if (rowData.currentYearRawData && rowData.lastYearRawData) {\n      // For Year-on-Year data, combine current and last year data for this specific product/category\n      specificFilteredData = [...rowData.currentYearRawData, ...rowData.lastYearRawData];\n      console.log(`Using YoY data: ${rowData.currentYearRawData.length} current year + ${rowData.lastYearRawData.length} last year transactions`);\n    } else {\n      // Apply specific filters based on row properties as fallback\n      specificFilteredData = filteredData.filter(item => {\n        let matches = false; // Start with false and require at least one match\n        \n        // Try multiple possible property names for product matching\n        const productIdentifiers = [\n          rowData.name,\n          rowData.product,\n          rowData.productName,\n          rowData.paymentItem,\n          rowData.cleanedProduct,\n          rowData.membership,\n          rowData.membershipType,\n          rowData.item\n        ].filter(Boolean);\n        \n        const categoryIdentifiers = [\n          rowData.category,\n          rowData.cleanedCategory,\n          rowData.paymentCategory\n        ].filter(Boolean);\n        \n        console.log('Product identifiers to match:', productIdentifiers);\n        console.log('Category identifiers to match:', categoryIdentifiers);\n        \n        // Product-specific filtering - try exact matches\n        for (const identifier of productIdentifiers) {\n          if (item.cleanedProduct === identifier || \n              item.paymentItem === identifier ||\n              item.membershipType === identifier ||\n              (item.paymentItem && item.paymentItem.includes(identifier)) ||\n              (item.cleanedProduct && item.cleanedProduct.includes(identifier))) {\n            matches = true;\n            console.log(`Product match found: ${identifier} matches item ${item.paymentItem || item.cleanedProduct}`);\n            break;\n          }\n        }\n        \n        // Category-specific filtering if no product match\n        if (!matches) {\n          for (const identifier of categoryIdentifiers) {\n            if (item.cleanedCategory === identifier ||\n                item.paymentCategory === identifier ||\n                (item.cleanedCategory && item.cleanedCategory.includes(identifier))) {\n              matches = true;\n              drillDownTypeToSet = 'category';\n              console.log(`Category match found: ${identifier} matches item ${item.cleanedCategory}`);\n              break;\n            }\n          }\n        }\n        \n        // Sales rep specific filtering\n        if (rowData.soldBy && item.soldBy === rowData.soldBy) {\n          matches = true;\n          drillDownTypeToSet = 'member';\n        }\n        \n        // Payment method specific filtering\n        if (rowData.paymentMethod && item.paymentMethod === rowData.paymentMethod) {\n          matches = true;\n          drillDownTypeToSet = 'product';\n        }\n        \n        return matches;\n      });\n      console.log(`Using fallback filtering: ${specificFilteredData.length} transactions from ${filteredData.length} total`);\n      \n    }\n    \n    console.log(`Filtered ${specificFilteredData.length} transactions for drill-down from ${filteredData.length} total`);\n    \n    // Log the filtering results\n    console.log(`Final drill-down data preparation:`);\n    console.log(`- Context type: ${rowData.contextType || 'unknown'}`);\n    console.log(`- Filter criteria:`, rowData.filterCriteria);\n    console.log(`- Specific filtered transactions: ${specificFilteredData.length}`);\n    console.log(`- Sample transactions:`, specificFilteredData.slice(0, 3));\n    \n    // Ensure we have valid transaction data - if no specific filter worked, use a fallback\n    if (specificFilteredData.length === 0) {\n      console.warn('No specific transactions found for this drill-down. Trying fallback filtering...');\n      \n      // More aggressive fallback filtering based on row data properties\n      if (rowData.product || rowData.name) {\n        const productName = rowData.product || rowData.name;\n        specificFilteredData = filteredData.filter(item => \n          item.cleanedProduct?.includes(productName) || \n          item.paymentItem?.includes(productName) ||\n          item.cleanedProduct === productName ||\n          item.paymentItem === productName\n        );\n        console.log(`Fallback product filter found ${specificFilteredData.length} transactions for \"${productName}\"`);\n      } else if (rowData.category) {\n        specificFilteredData = filteredData.filter(item => \n          item.cleanedCategory?.includes(rowData.category) || \n          item.cleanedCategory === rowData.category\n        );\n        console.log(`Fallback category filter found ${specificFilteredData.length} transactions for \"${rowData.category}\"`);\n      } else {\n        // Last resort - use all filtered data but log warning\n        console.warn('Using all filtered data as last resort');\n        specificFilteredData = filteredData.slice(0, 100); // Limit to 100 for performance\n      }\n    }\n\n    // Build enhanced data object with CORRECTLY FILTERED transactions\n    // CRITICAL: Do NOT spread rowData first, as it may contain incorrect pre-filtered data\n    const calculatedRevenue = specificFilteredData.reduce((sum, item) => sum + (item.paymentValue || 0), 0);\n    const calculatedTransactions = specificFilteredData.length;\n    const calculatedCustomers = new Set(specificFilteredData.map(item => item.memberId || item.customerEmail)).size;\n    \n    const enhancedData = {\n      // Spread rowData but it will be overridden by our correctly filtered data below\n      ...rowData,\n      // FORCE override with correctly filtered transaction data\n      rawData: specificFilteredData,\n      filteredTransactionData: specificFilteredData,\n      transactionData: specificFilteredData, // Some modals might read from this property\n      // Calculate specific metrics from our CORRECTLY FILTERED data and override any static values\n      totalRevenue: calculatedRevenue,\n      grossRevenue: calculatedRevenue,\n      netRevenue: calculatedRevenue,\n      totalValue: calculatedRevenue,\n      totalCurrent: calculatedRevenue,\n      metricValue: calculatedRevenue,\n      revenue: calculatedRevenue, // Some modals might read from this property\n      transactions: calculatedTransactions,\n      totalTransactions: calculatedTransactions,\n      transactionCount: calculatedTransactions, // Some modals might read from this property\n      uniqueMembers: calculatedCustomers,\n      totalCustomers: calculatedCustomers,\n      customerCount: calculatedCustomers, // Some modals might read from this property\n      specificRevenue: calculatedRevenue,\n      specificTransactions: calculatedTransactions,\n      specificCustomers: calculatedCustomers,\n      specificProducts: new Set(specificFilteredData.map(item => item.cleanedProduct || item.paymentItem)).size,\n      // Add dynamic calculation flags to ensure modal uses fresh data\n      isDynamic: true,\n      calculatedFromFiltered: true,\n      useCalculatedMetrics: true, // Flag for modal to prefer calculated metrics\n      // Add context information for the modal\n      clickedItemName: rowData.product || rowData.name || rowData.category || 'Selected Item',\n      contextDescription: rowData.filterCriteria ? \n        `Showing data for ${Object.entries(rowData.filterCriteria).map(([key, value]) => `${key}: ${value}`).join(', ')}` :\n        `Showing transactions for ${rowData.product || rowData.name || rowData.category || 'selected item'}`\n    };\n    \n    // Final validation and logging\n    console.log('🎉 === DRILL-DOWN MODAL DATA FINAL SUMMARY ===');\n    console.log('📋 Filter Criteria:', rowData.filterCriteria);\n    console.log('📊 Drill-down Context:', rowData.drillDownContext);\n    console.log('🔢 Specific Filtered Data Count:', specificFilteredData.length);\n    console.log('💰 Calculated Revenue:', calculatedRevenue);\n    console.log('👥 Calculated Customers:', calculatedCustomers);\n    console.log('📦 Enhanced Data Properties:');\n    console.log('  - rawData length:', enhancedData.rawData?.length);\n    console.log('  - filteredTransactionData length:', enhancedData.filteredTransactionData?.length);\n    console.log('  - transactionData length:', enhancedData.transactionData?.length);\n    console.log('  - totalRevenue:', enhancedData.totalRevenue);\n    console.log('  - revenue:', enhancedData.revenue);\n    console.log('  - transactions:', enhancedData.transactions);\n    console.log('  - totalTransactions:', enhancedData.totalTransactions);\n    console.log('🎯 Drill-down Type:', drillDownTypeToSet);\n    console.log('📝 Context Description:', enhancedData.contextDescription);\n    console.log('✅ === END DRILL-DOWN SUMMARY ===');\n    \n    setDrillDownData(enhancedData);\n    setDrillDownType(drillDownTypeToSet);\n  }, [data, activeLocation, filteredData]);\n\n  const handleMetricClick = useCallback((metricData: any) => {\n    console.log('Metric clicked with data:', metricData);\n    \n    // Filter data based on the specific metric clicked\n    let specificData = filteredData;\n    \n    // Apply metric-specific filtering based on the metric type\n    if (metricData.metricType) {\n      switch (metricData.metricType) {\n        case 'sales-revenue':\n        case 'total-revenue':\n          // For revenue metrics, focus on high-value transactions\n          specificData = filteredData.filter(item => (item.paymentValue || 0) > 0);\n          break;\n          \n        case 'units-sold':\n        case 'total-transactions':\n          // For transaction metrics, include all transactions\n          specificData = filteredData;\n          break;\n          \n        case 'unique-members':\n          // For member metrics, focus on unique customer data\n          const uniqueMembers = new Set(filteredData.map(item => item.memberId || item.customerEmail));\n          specificData = filteredData.filter(item => \n            item.memberId || item.customerEmail\n          );\n          break;\n          \n        case 'avg-transaction-value':\n        case 'avg-spend-per-member':\n          // For average metrics, focus on meaningful transactions\n          specificData = filteredData.filter(item => \n            (item.paymentValue || 0) > 0 && (item.memberId || item.customerEmail)\n          );\n          break;\n          \n        default:\n          specificData = filteredData;\n      }\n    }\n    \n    // Calculate fresh metrics from the metric-specific filtered data\n    const dynamicRevenue = specificData.reduce((sum, item) => sum + (item.paymentValue || 0), 0);\n    const dynamicTransactions = specificData.length;\n    const dynamicCustomers = new Set(specificData.map(item => item.memberId || item.customerEmail)).size;\n    \n    // Enhance metric data with dynamic calculations and metric-specific context\n    const enhancedData = {\n      ...metricData,\n      rawData: specificData,\n      filteredTransactionData: specificData,\n      // Override with dynamic values\n      totalRevenue: dynamicRevenue,\n      grossRevenue: dynamicRevenue,\n      netRevenue: dynamicRevenue,\n      totalValue: dynamicRevenue,\n      totalCurrent: dynamicRevenue,\n      metricValue: dynamicRevenue,\n      transactions: dynamicTransactions,\n      totalTransactions: dynamicTransactions,\n      uniqueMembers: dynamicCustomers,\n      totalCustomers: dynamicCustomers,\n      specificRevenue: dynamicRevenue,\n      specificTransactions: dynamicTransactions,\n      specificCustomers: dynamicCustomers,\n      // Add context about the specific metric\n      focusMetric: metricData.title,\n      metricContext: metricData.metricType,\n      // Add flags to indicate this is dynamically calculated\n      isDynamic: true,\n      calculatedFromFiltered: true,\n      isMetricSpecific: true\n    };\n    \n    console.log(`Metric-specific drill-down for '${metricData.title}' with ${specificData.length} filtered transactions, revenue: ${dynamicRevenue}`);\n    setDrillDownData(enhancedData);\n    setDrillDownType('metric');\n  }, [filteredData]);\n\n  const handleGroupToggle = useCallback((groupKey: string) => {\n    const newCollapsed = new Set(collapsedGroups);\n    if (newCollapsed.has(groupKey)) {\n      newCollapsed.delete(groupKey);\n    } else {\n      newCollapsed.add(groupKey);\n    }\n    setCollapsedGroups(newCollapsed);\n  }, [collapsedGroups]);\n\n  const resetFilters = useCallback(() => {\n    const previousMonth = getPreviousMonthDateRange();\n    \n    setFilters({\n      dateRange: previousMonth,\n      location: [],\n      category: [],\n      product: [],\n      soldBy: [],\n      paymentMethod: []\n    });\n  }, []);\n\n  // Calculate tab counts for location tabs using filtered data\n  const tabCounts = useMemo(() => {\n    const counts = { all: 0, kwality: 0, supreme: 0, kenkere: 0 };\n    \n    // Use filtered data instead of raw data to reflect current filters\n    filteredData.forEach(item => {\n      counts.all++;\n      const loc = (item.calculatedLocation || '').toString().toLowerCase();\n      if (loc.includes('kwality')) {\n        counts.kwality++;\n      } else if (loc.includes('supreme')) {\n        counts.supreme++;\n      } else if (loc.includes('kenkere') || loc.includes('bengaluru')) {\n        counts.kenkere++;\n      }\n    });\n    \n    return counts;\n  }, [filteredData]);\n\n  return (\n    <div className=\"space-y-8\">\n      {/* Hero Section with Dynamic Metrics */}\n      <SectionAnchor id=\"sales-overview\" label=\"Overview\">\n        <SalesHeroSection \n          data={filteredData} \n          historicalData={metricsHistoricData}\n          dateRange={filters.dateRange}\n          currentLocation={activeLocation}\n          locationName={locations.find(loc => loc.id === activeLocation)?.fullName || 'All Locations'}\n        />\n      </SectionAnchor>\n\n      {/* Note Taker removed as requested; AI Notes remain elsewhere */}\n\n      {/* Vertical timeline navigation (scrollspy) */}\n      <SectionTimelineNav position=\"right\" title=\"Sales sections\" />\n\n      {/* Enhanced Location Tabs - unified styling (matching Client Retention) */}\n      <div className=\"container mx-auto px-6 space-y-6\">\n        <StudioLocationTabs \n          activeLocation={activeLocation}\n          onLocationChange={setActiveLocation}\n          showInfoPopover={true}\n          infoPopoverContext=\"sales-overview\"\n        />\n\n        {/* Content Sections */}\n        <div className=\"space-y-8\">\n          <SectionAnchor id=\"sales-filters\" label=\"Filters\" className=\"w-full space-y-4\">\n            <AutoCloseFilterSection\n              filters={filters} \n              onFiltersChange={setFilters} \n              onReset={resetFilters} \n            />\n          </SectionAnchor>\n\n          <SectionAnchor id=\"sales-metrics\" label=\"Metrics\">\n            <SalesAnimatedMetricCards \n              data={filteredData} \n              historicalData={metricsHistoricData}\n              dateRange={filters.dateRange}\n              onMetricClick={handleMetricClick}\n              locationId={activeLocation}\n            />\n          </SectionAnchor>\n\n              <SectionAnchor id=\"sales-charts\" label=\"Charts\">\n                <SalesInteractiveCharts data={allHistoricData} />\n              </SectionAnchor>\n\n              <SectionAnchor id=\"sales-sellers\" label=\"Top & Bottom Sellers\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <h2 className=\"text-xl font-semibold text-gray-900\">Top & Bottom Sellers</h2>\n                </div>\n                <UnifiedTopBottomSellers data={filteredData} />\n              </SectionAnchor>\n\n                <Tabs defaultValue=\"monthOnMonth\" className=\"w-full\">\n                  <TabsList className=\"bg-white/95 backdrop-blur-sm p-1.5 rounded-2xl shadow-2xl border-2 border-slate-200 flex w-full max-w-7xl mx-auto overflow-visible relative\">\n                    {/* Uniform trigger styling for consistent size/width/spacing across tabs */}\n                    <TabsTrigger value=\"monthOnMonth\" className=\"relative flex-1 flex items-center justify-center gap-2 px-3 py-3 font-semibold text-xs md:text-sm min-h-[52px] transition-all duration-300 data-[state=active]:bg-gradient-to-br data-[state=active]:from-blue-600 data-[state=active]:via-blue-700 data-[state=active]:to-blue-800 data-[state=active]:text-white data-[state=active]:shadow-2xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-50 hover:bg-gray-50 border-r border-slate-200 last:border-r-0 data-[state=active]:scale-[1.02] data-[state=active]:rounded-xl data-[state=active]:-translate-y-1\">\n                      <Calendar className=\"w-4 h-4\" />\n                      <span className=\"whitespace-nowrap\">Month on Month</span>\n                    </TabsTrigger>\n                    <TabsTrigger value=\"yearOnYear\" className=\"relative flex-1 flex items-center justify-center gap-2 px-3 py-3 font-semibold text-xs md:text-sm min-h-[52px] transition-all duration-300 data-[state=active]:bg-gradient-to-br data-[state=active]:from-emerald-600 data-[state=active]:via-emerald-700 data-[state=active]:to-emerald-800 data-[state=active]:text-white data-[state=active]:shadow-2xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-50 hover:bg-gray-50 border-r border-slate-200 last:border-r-0 data-[state=active]:scale-[1.02] data-[state=active]:rounded-xl data-[state=active]:-translate-y-1\">\n                      <TrendingUp className=\"w-4 h-4\" />\n                      <span className=\"whitespace-nowrap\">Year on Year</span>\n                    </TabsTrigger>\n                    <TabsTrigger value=\"productPerformance\" className=\"relative flex-1 flex items-center justify-center gap-2 px-3 py-3 font-semibold text-xs md:text-sm min-h-[52px] transition-all duration-300 data-[state=active]:bg-gradient-to-br data-[state=active]:from-purple-600 data-[state=active]:via-purple-700 data-[state=active]:to-purple-800 data-[state=active]:text-white data-[state=active]:shadow-2xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-50 hover:bg-gray-50 border-r border-slate-200 last:border-r-0 data-[state=active]:scale-[1.02] data-[state=active]:rounded-xl data-[state=active]:-translate-y-1\">\n                      <ShoppingCart className=\"w-4 h-4\" />\n                      <span className=\"whitespace-nowrap\">Products</span>\n                    </TabsTrigger>\n                    <TabsTrigger value=\"categoryPerformance\" className=\"relative flex-1 flex items-center justify-center gap-2 px-3 py-3 font-semibold text-xs md:text-sm min-h-[52px] transition-all duration-300 data-[state=active]:bg-gradient-to-br data-[state=active]:from-orange-600 data-[state=active]:via-orange-700 data-[state=active]:to-orange-800 data-[state=active]:text-white data-[state=active]:shadow-2xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-50 hover:bg-gray-50 border-r border-slate-200 last:border-r-0 data-[state=active]:scale-[1.02] data-[state=active]:rounded-xl data-[state=active]:-translate-y-1\">\n                      <FolderOpen className=\"w-4 h-4\" />\n                      <span className=\"whitespace-nowrap\">Categories</span>\n                    </TabsTrigger>\n                    <TabsTrigger value=\"soldByAnalysis\" className=\"relative flex-1 flex items-center justify-center gap-2 px-3 py-3 font-semibold text-xs md:text-sm min-h-[52px] transition-all duration-300 data-[state=active]:bg-gradient-to-br data-[state=active]:from-indigo-600 data-[state=active]:via-indigo-700 data-[state=active]:to-indigo-800 data-[state=active]:text-white data-[state=active]:shadow-2xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-50 hover:bg-gray-50 border-r border-slate-200 last:border-r-0 data-[state=active]:scale-[1.02] data-[state=active]:rounded-xl data-[state=active]:-translate-y-1\">\n                      <Users className=\"w-4 h-4\" />\n                      <span className=\"whitespace-nowrap\">Sales Team</span>\n                    </TabsTrigger>\n                    <TabsTrigger value=\"paymentMethodAnalysis\" className=\"relative flex-1 flex items-center justify-center gap-2 px-3 py-3 font-semibold text-xs md:text-sm min-h-[52px] transition-all duration-300 data-[state=active]:bg-gradient-to-br data-[state=active]:from-teal-600 data-[state=active]:via-teal-700 data-[state=active]:to-teal-800 data-[state=active]:text-white data-[state=active]:shadow-2xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-50 hover:bg-gray-50 border-r border-slate-200 last:border-r-0 data-[state=active]:scale-[1.02] data-[state=active]:rounded-xl data-[state=active]:-translate-y-1\">\n                      <CreditCard className=\"w-4 h-4\" />\n                      <span className=\"whitespace-nowrap\">Payments</span>\n                    </TabsTrigger>\n                    <TabsTrigger value=\"customerBehavior\" className=\"relative flex-1 flex items-center justify-center gap-2 px-3 py-3 font-semibold text-xs md:text-sm min-h-[52px] transition-all duration-300 data-[state=active]:bg-gradient-to-br data-[state=active]:from-pink-600 data-[state=active]:via-pink-700 data-[state=active]:to-pink-800 data-[state=active]:text-white data-[state=active]:shadow-2xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-50 hover:bg-gray-50 border-r border-slate-200 last:border-r-0 data-[state=active]:scale-[1.02] data-[state=active]:rounded-xl data-[state=active]:-translate-y-1\">\n                      <UserCheck className=\"w-4 h-4\" />\n                      <span className=\"whitespace-nowrap\">Behavior</span>\n                    </TabsTrigger>\n                  </TabsList>\n\n                  <TabsContent value=\"monthOnMonth\" className=\"mt-8\">\n                    <SectionAnchor id=\"sales-mom\" label=\"Month-on-Month\" activate={() => {\n                      const trigger = document.querySelector(\"[role='tab'][data-state='active'][data-value='monthOnMonth']\") as HTMLElement | null;\n                      if (!trigger) {\n                        const t = Array.from(document.querySelectorAll(\"[role='tab']\")) as HTMLElement[];\n                        t.find(el => el.getAttribute('data-value') === 'monthOnMonth')?.click();\n                      }\n                    }} className=\"space-y-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <h2 className=\"text-2xl font-bold text-gray-900\">Month-on-Month Analysis</h2>\n                      </div>\n                      <MonthOnMonthTableNew \n                        data={allHistoricData} \n                        onRowClick={handleRowClick} \n                        collapsedGroups={collapsedGroups} \n                        // Adapter to match MonthOnMonthTableNew's onGroupToggle signature (Set<string>)\n                        onGroupToggle={React.useCallback((groups: Set<string>) => setCollapsedGroups(new Set(groups)), [])} \n                        selectedMetric={activeYoyMetric} \n                        onReady={markReady}\n                        contextInfo={{\n                          selectedMetric: activeYoyMetric,\n                          dateRange: filters.dateRange,\n                          location: locations.find(loc => loc.id === activeLocation)?.fullName || 'All Locations',\n                          filters: {\n                            location: [activeLocation],\n                            category: filters.category,\n                            product: filters.product,\n                            soldBy: filters.soldBy,\n                            paymentMethod: filters.paymentMethod\n                          }\n                        }}\n                      />\n                    </SectionAnchor>\n                  </TabsContent>\n\n                  <TabsContent value=\"yearOnYear\" className=\"mt-8\">\n                    <SectionAnchor id=\"sales-yoy\" label=\"Year-on-Year\" activate={() => {\n                      const trigger = document.querySelector(\"[role='tab'][data-state='active'][data-value='yearOnYear']\") as HTMLElement | null;\n                      if (!trigger) {\n                        const t = Array.from(document.querySelectorAll(\"[role='tab']\")) as HTMLElement[];\n                        t.find(el => el.getAttribute('data-value') === 'yearOnYear')?.click();\n                      }\n                    }} className=\"space-y-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <h2 className=\"text-2xl font-bold text-gray-900\">Year-on-Year Analysis</h2>\n                      </div>\n                      <EnhancedYearOnYearTableNew \n                        data={allHistoricData} \n                        onRowClick={handleRowClick} \n                        selectedMetric={activeYoyMetric} \n                        onReady={markReady}\n                        contextInfo={{\n                          selectedMetric: activeYoyMetric,\n                          dateRange: filters.dateRange,\n                          location: locations.find(loc => loc.id === activeLocation)?.fullName || 'All Locations',\n                          filters: {\n                            location: [activeLocation],\n                            category: filters.category,\n                            product: filters.product,\n                            soldBy: filters.soldBy,\n                            paymentMethod: filters.paymentMethod\n                          }\n                        }}\n                      />\n                    </SectionAnchor>\n                  </TabsContent>\n\n                <TabsContent value=\"productPerformance\" className=\"mt-8\">\n                  <SectionAnchor id=\"sales-product\" label=\"Products\" activate={() => {\n                    const t = Array.from(document.querySelectorAll(\"[role='tab']\")) as HTMLElement[];\n                    t.find(el => el.getAttribute('data-value') === 'productPerformance')?.click();\n                  }} className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <h2 className=\"text-2xl font-bold text-gray-900\">Product & Category Metrics</h2>\n                    </div>\n                    <ProductCategoryMetricsTable\n                      data={filteredData}\n                      filters={filters}\n                      onReady={markReady}\n                    />\n                  </SectionAnchor>\n                </TabsContent>\n\n                <TabsContent value=\"categoryPerformance\" className=\"mt-8\">\n                  <SectionAnchor id=\"sales-category\" label=\"Categories\" activate={() => {\n                    const t = Array.from(document.querySelectorAll(\"[role='tab']\")) as HTMLElement[];\n                    t.find(el => el.getAttribute('data-value') === 'categoryPerformance')?.click();\n                  }} className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <h2 className=\"text-2xl font-bold text-gray-900\">Category Performance Analysis</h2>\n                    </div>\n                    <CategoryPerformanceTableNew \n                      data={allHistoricData} \n                      onRowClick={handleRowClick} \n                      selectedMetric={activeYoyMetric} \n                      onReady={markReady}\n                      contextInfo={{\n                        selectedMetric: activeYoyMetric,\n                        dateRange: filters.dateRange,\n                        location: locations.find(loc => loc.id === activeLocation)?.fullName || 'All Locations',\n                        filters: {\n                          location: [activeLocation],\n                          category: filters.category,\n                          product: filters.product,\n                          soldBy: filters.soldBy,\n                          paymentMethod: filters.paymentMethod\n                        }\n                      }}\n                    />\n                  </SectionAnchor>\n                </TabsContent>\n\n                <TabsContent value=\"soldByAnalysis\" className=\"mt-8\">\n                  <SectionAnchor id=\"sales-soldby\" label=\"Sold By\" activate={() => {\n                    const t = Array.from(document.querySelectorAll(\"[role='tab']\")) as HTMLElement[];\n                    t.find(el => el.getAttribute('data-value') === 'soldByAnalysis')?.click();\n                  }} className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <h2 className=\"text-2xl font-bold text-gray-900\">Sold By Analysis</h2>\n                    </div>\n                    <SoldByMonthOnMonthTableNew \n                      data={allHistoricData} \n                      onRowClick={handleRowClick} \n                      selectedMetric={activeYoyMetric} \n                      onReady={markReady}\n                      contextInfo={{\n                        selectedMetric: activeYoyMetric,\n                        dateRange: filters.dateRange,\n                        location: locations.find(loc => loc.id === activeLocation)?.fullName || 'All Locations',\n                        filters: {\n                          location: [activeLocation],\n                          category: filters.category,\n                          product: filters.product,\n                          soldBy: filters.soldBy,\n                          paymentMethod: filters.paymentMethod\n                        }\n                      }}\n                    />\n                  </SectionAnchor>\n                </TabsContent>\n\n                <TabsContent value=\"paymentMethodAnalysis\" className=\"mt-8\">\n                  <SectionAnchor id=\"sales-payment\" label=\"Payment Methods\" activate={() => {\n                    const t = Array.from(document.querySelectorAll(\"[role='tab']\")) as HTMLElement[];\n                    t.find(el => el.getAttribute('data-value') === 'paymentMethodAnalysis')?.click();\n                  }} className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <h2 className=\"text-2xl font-bold text-gray-900\">Payment Method Analysis</h2>\n                    </div>\n                    <PaymentMethodMonthOnMonthTableNew \n                      data={allHistoricData} \n                      onRowClick={handleRowClick} \n                      selectedMetric={activeYoyMetric} \n                      onReady={markReady}\n                      contextInfo={{\n                        selectedMetric: activeYoyMetric,\n                        dateRange: filters.dateRange,\n                        location: locations.find(loc => loc.id === activeLocation)?.fullName || 'All Locations',\n                        filters: {\n                          location: [activeLocation],\n                          category: filters.category,\n                          product: filters.product,\n                          soldBy: filters.soldBy,\n                          paymentMethod: filters.paymentMethod\n                        }\n                      }}\n                    />\n                  </SectionAnchor>\n                </TabsContent>\n\n                <TabsContent value=\"customerBehavior\" className=\"space-y-6\">\n                  <SectionAnchor id=\"sales-customer\" label=\"Customer Behavior\" activate={() => {\n                    const t = Array.from(document.querySelectorAll(\"[role='tab']\")) as HTMLElement[];\n                    t.find(el => el.getAttribute('data-value') === 'customerBehavior')?.click();\n                  }}>\n                    <div className=\"flex items-center justify-between\">\n                      <h2 className=\"text-2xl font-bold text-gray-900\">Customer Behavior</h2>\n                    </div>\n                    {/* Use allHistoricData to make this tab independent from the date filters */}\n                    <CustomerBehaviorMonthOnMonthTable \n                      data={allHistoricData} \n                      onReady={markReady} \n                      onRowClick={handleRowClick}\n                      contextInfo={{\n                        selectedMetric: activeYoyMetric,\n                        dateRange: filters.dateRange,\n                        location: locations.find(loc => loc.id === activeLocation)?.fullName || 'All Locations',\n                        filters: {\n                          location: [activeLocation],\n                          category: filters.category,\n                          product: filters.product,\n                          soldBy: filters.soldBy,\n                          paymentMethod: filters.paymentMethod\n                        }\n                      }}\n                    />\n                  </SectionAnchor>\n                </TabsContent>\n              </Tabs>\n        </div>\n      </div>\n\n      {/* Modal - Lazy loaded for performance */}\n      <ModalSuspense>\n        {drillDownData && (\n          <LazyEnhancedSalesDrillDownModal \n            isOpen={!!drillDownData} \n            onClose={() => setDrillDownData(null)} \n            data={drillDownData} \n            type={drillDownType} \n          />\n        )}\n      </ModalSuspense>\n    </div>\n  );\n};\n","import React, { useEffect } from 'react';\nimport { SalesAnalyticsSection } from '@/components/dashboard/SalesAnalyticsSection';\nimport { useGoogleSheets } from '@/hooks/useGoogleSheets';\nimport { Footer } from '@/components/ui/footer';\nimport { GlobalFiltersProvider } from '@/contexts/GlobalFiltersContext';\nimport { useGlobalLoading } from '@/hooks/useGlobalLoading';\nimport { LoadingSkeleton } from '@/components/ui/LoadingSkeleton';\n\nconst SalesAnalytics = () => {\n  const { data, loading, error, refetch } = useGoogleSheets();\n  const { setLoading } = useGlobalLoading();\n  const handleReady = React.useCallback(() => {\n    // Hide any global loader immediately when content is ready\n    setLoading(false);\n  }, [setLoading]);\n\n  // Tie the global loader to the Google Sheets loading state\n  useEffect(() => {\n    setLoading(loading, 'Loading sales analytics data...');\n  }, [loading, setLoading]);\n\n  return (\n    <GlobalFiltersProvider>\n      <div className=\"min-h-screen bg-white relative overflow-hidden\">\n        {/* Enhanced Background Elements */}\n        <div className=\"absolute inset-0 overflow-hidden\">\n          <div className=\"absolute top-20 left-10 w-96 h-96 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-full floating-animation stagger-1\"></div>\n          <div className=\"absolute bottom-20 right-10 w-80 h-80 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-full floating-animation stagger-3\"></div>\n          <div className=\"absolute top-1/2 left-1/3 w-72 h-72 bg-gradient-to-r from-cyan-500/10 to-teal-500/10 rounded-full morph-shape stagger-2\"></div>\n        </div>\n        \n        <div className=\"relative z-10\">\n          {loading ? (\n            <div className=\"container mx-auto px-6 py-10\">\n              <LoadingSkeleton type=\"full-page\" />\n            </div>\n          ) : error ? (\n            <div className=\"container mx-auto px-6 py-10\">\n              <div className=\"bg-red-50 border border-red-200 text-red-800 p-6 rounded-2xl shadow-sm\">\n                <div className=\"font-semibold text-lg mb-1\">Failed to load sales data</div>\n                <div className=\"text-sm opacity-90 mb-4\">{String(error)}</div>\n                <button\n                  onClick={refetch}\n                  className=\"px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 transition\"\n                >\n                  Retry\n                </button>\n              </div>\n            </div>\n          ) : (\n            <div className=\"bg-white text-slate-800 slide-in-from-left\">\n              <SalesAnalyticsSection data={data} onReady={handleReady} />\n            </div>\n          )}\n        </div>\n        <Footer />\n      </div>\n    </GlobalFiltersProvider>\n  );\n};\n\nexport default SalesAnalytics;"],"names":["FolderOpen","createLucideIcon","UnifiedTopBottomSellers","data","onRowClick","activeType","setActiveType","useState","showMore","setShowMore","drillDownData","setDrillDownData","isDrillDownOpen","setIsDrillDownOpen","getGroupedData","type","grouped","acc","item","key","uniqueMembersCount","a","b","getTypeConfig","Package","Tag","Users","UserCheck","renderSellerCard","sellers","isTop","config","jsxs","Card","jsx","CardHeader","CardTitle","Fragment","Award","displayCount","TrendingDown","CardContent","seller","index","filtered","cn","Crown","Trophy","Medal","Star","ArrowDownCircle","ThumbsDown","Badge","formatNumber","formatCurrency","Button","e","drillDownInfo","Eye","BarChart3","sum","s","groupedData","topSellers","bottomSellers","Tabs","TabsList","TabsTrigger","TabsContent","SalesDrillDownModal","groupDataByCategory","category","product","EnhancedYearOnYearTableNewComponent","filters","collapsedGroups","onGroupToggle","initialMetric","onReady","tableRef","useRef","selectedMetric","setSelectedMetric","localCollapsedGroups","setLocalCollapsedGroups","isInitialized","setIsInitialized","displayMode","setDisplayMode","sortKey","setSortKey","sortDir","setSortDir","copyContext","useTableCopyContext","parseDate","dateStr","ddmmyyyy","day","month","year","date","getMetricValue","items","metric","totalRevenue","payment","vat","uniqueTransactionIds","totalTransactions","uniqueMembers","uniqueSalesItemIds","totalUnits","totalVat","totalDiscount","totalGrossRevenue","avgDiscountPercentage","dates","purchaseFrequency","formatMetricValue","value","previousMonthKey","now","prevMonth","getGrowthPercentage","current","previous","allHistoricData","useMemo","monthlyData","months","currentMonth","currentYear","monthNum","monthName","visibleMonths","processedData","categories","products","categoryData","monthlyValues","monthItems","itemDate","categoryMonthlyValues","p","comparator","byMonth","obj","av","bv","sumVals","val","n","toggleGroup","useCallback","groupKey","prev","newSet","handleCollapseAll","allGroups","handleExpandAll","React","allCategories","cat","generateAllTabsContent","allContent","metricInfo","STANDARD_METRICS","headers","categoryProducts","categoryGroup","categoryTotal","categoryRow","productTotal","productRow","readySent","setReadySent","ModernMetricTabs","ModernTableWrapper","Calendar","d","display","nextMonth","isFirstOfGroup","isLastOfGroup","isPreviousMonth","categoryIndex","ChevronRight","ChevronDown","monthIndex","yearStr","monthStr","previousYearKey","growthPercentage","TrendingUp","productIndex","totalValue","PersistentTableFooter","EnhancedYearOnYearTableNew","prevProps","nextProps","shallowEqual","MonthOnMonthTableNewComponent","contextInfo","v","totalDiscountAmount","monthNames","startDate","endDate","aiTableData","flatData","monthlyEntries","aiTableColumns","baseColumns","monthColumns","empty","categoryTotalValue","previousMonthKeyData","MonthOnMonthTableNew","CategoryPerformanceTableNewComponent","categoryGroups","uniqueProducts","Layers","CategoryPerformanceTableNew","SALES_DARK_PALETTE","CustomTooltip","active","payload","label","pld","CustomBar","props","fill","x","y","width","height","SalesInteractiveCharts","timeRange","setTimeRange","activeChart","setActiveChart","productMetric","setProductMetric","filteredData","monthlyRevenueData","monthlyGroups","monthKey","group","topProductsData","productGroups","sortedProducts","name","handleTimeRangeChange","newRange","handleChartChange","newChart","handleProductMetricChange","newMetric","renderChart","ResponsiveContainer","AreaChart","CartesianGrid","XAxis","YAxis","Tooltip","Area","BarChart","Bar","PieChart","Pie","percent","entry","Cell","Legend","LineChartIcon","PieChartIcon","motion","SoldByMonthOnMonthTableNewComponent","calculatePurchaseFrequency","memberPurchases","totalDaysBetweenPurchases","intervalCount","i","daysDiff","generateStandardMonthRange","soldByGroups","sellerData","soldBy","sellerRow","sellerIndex","previousMonthKeyLocal","SoldByMonthOnMonthTableNew","PaymentMethodMonthOnMonthTableNewComponent","paymentMethodGroups","method","methodData","methodRow","CreditCard","methodIndex","PaymentMethodMonthOnMonthTableNew","LOCATION_MAPPING","ComprehensiveSalesExportButton","currentLocation","locationName","buttonVariant","buttonSize","buttonClassName","buttonLabel","openRef","renderTrigger","isDialogOpen","setIsDialogOpen","useEffect","isExporting","setIsExporting","exportConfig","setExportConfig","getCurrentTabInfo","activeTab","tabValue","tabText","extractTableFromElement","tableElement","tableName","rows","headerRow","cell","text","row","cells","rowData","extractAllTableData","tables","activePanels","visibleTables","panel","t","el","style","idx","METRIC_LABELS","clickElement","waitMs","r","exportMetricVariantsForActiveSection","locationSuffix","timestamp","sectionTag","activePanel","metricButtons","btn","metricLabel","perMetricTables","table","csvContent","h","cleanSection","cleanMetric","cleanTableName","fileName","blob","link","url","resolve","handleExport","tableData","currentTabText","exportAllTabsData","buildPrintableHtml","title","sections","html","sec","sIdx","tIdx","c","handleExportPDF","currentTables","tabTriggers","originalActiveTab","tabMapping","trigger","tabLabel","normalizedLabel","shouldExport","configKey","configValue","mapped","baseTables","metricTables","w","tabTableData","cleanTabValue","toggleExportSection","section","Dialog","DialogTrigger","Download","DialogContent","DialogHeader","DialogTitle","DialogDescription","Label","labelMap","Checkbox","BrandSpinner","FileSpreadsheet","SalesHeroSection","historicalData","dateRange","metrics","useSalesMetrics","heroColor","setHeroColor","lastUpdateRef","lastSetColorRef","navigate","useNavigate","exportOpenRef","throttledColorUpdate","newColor","root","currentValue","heroMetrics","SalesMotionHero","m","SectionAnchor","id","activate","children","className","addSection","removeSection","useSectionNavigation","React.useEffect","BEHAVIOR_METRICS","Clock","Activity","ShoppingCart","Percent","CustomerBehaviorMonthOnMonthTable","collapsedCategories","setCollapsedCategories","monthKeys","groupData","catMap","prod","prodMap","groupByMember","map","it","disc","byMember","spends","list","sessions","freqs","l","totalDays","spans","span","diffs","diff","formatValue","processed","aSum","productsData","productData","all","prevKey","growth","totalVal","prevItems","prevVal","locations","SalesAnalyticsSection","globalFilters","useGlobalFilters","activeLocation","setActiveLocation","currentTheme","setCurrentTheme","isDarkMode","setIsDarkMode","drillDownType","setDrillDownType","setCollapsedGroups","activeYoyMetric","setActiveYoyMetric","isReady","setIsReady","markReady","setFilters","getPreviousMonthDateRange","applyFilters","rawData","includeHistoric","loc","formats","metricsHistoricData","handleRowClick","baseData","specificFilteredData","drillDownTypeToSet","criteria","itemKey","productMatches","monthMatches","categoryMatches","sellerMatches","methodMatches","matches","productIdentifiers","categoryIdentifiers","identifier","productName","calculatedRevenue","calculatedTransactions","calculatedCustomers","enhancedData","handleMetricClick","metricData","specificData","dynamicRevenue","dynamicTransactions","dynamicCustomers","newCollapsed","resetFilters","previousMonth","counts","SectionTimelineNav","StudioLocationTabs","AutoCloseFilterSection","SalesAnimatedMetricCards","groups","ProductCategoryMetricsTable","ModalSuspense","LazyEnhancedSalesDrillDownModal","SalesAnalytics","loading","error","refetch","useGoogleSheets","setLoading","useGlobalLoading","handleReady","GlobalFiltersProvider","LoadingSkeleton","Footer"],"mappings":"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","x_google_ignoreList":[0]}