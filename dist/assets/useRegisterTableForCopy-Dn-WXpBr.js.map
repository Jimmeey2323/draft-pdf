{"version":3,"file":"useRegisterTableForCopy-Dn-WXpBr.js","sources":["../../src/hooks/useRegisterTableForCopy.ts"],"sourcesContent":["import React from 'react';\nimport { useMetricsTablesRegistry } from '@/contexts/MetricsTablesRegistryContext';\n\ninterface RegisterTableOptions {\n  selectedMetric?: string;\n  dateRange?: { start: string; end: string };\n  filters?: Record<string, any>;\n  location?: string;\n  additionalInfo?: Record<string, any>;\n}\n\n/**\n * Registers a table container ref with the MetricsTablesRegistry to enable\n * the \"Copy all tabs\" option automatically.\n * Call with the container that wraps your <table> (or the table itself).\n */\nexport function useRegisterTableForCopy(\n  ref: React.RefObject<HTMLElement>,\n  title?: string,\n  disabled?: boolean,\n  contextOptions?: RegisterTableOptions\n) {\n  const registry = useMetricsTablesRegistry();\n\n  React.useEffect(() => {\n    if (disabled) return;\n    if (!registry) return;\n    if (!ref.current) return;\n    if (!title) return;\n\n    const getText = () => {\n      const container = ref.current! as HTMLElement;\n      const table = container.querySelector('table') || container;\n      let text = `${title}\\n`;\n      text += `Exported on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}\\n`;\n      \n      // Add context information if provided\n      if (contextOptions) {\n        text += `\\n--- Export Context ---\\n`;\n        \n        if (contextOptions.selectedMetric) {\n          text += `Metric: ${contextOptions.selectedMetric}\\n`;\n        }\n        \n        // Add location information\n        if (contextOptions.location) {\n          text += `Location: ${contextOptions.location}\\n`;\n        } else if (contextOptions.filters?.location) {\n          // Handle location from filters\n          const locationValue = Array.isArray(contextOptions.filters.location) \n            ? contextOptions.filters.location.join(', ') \n            : contextOptions.filters.location;\n          if (locationValue && locationValue !== 'all') {\n            text += `Location: ${locationValue}\\n`;\n          } else {\n            text += `Location: All Locations\\n`;\n          }\n        } else {\n          text += `Location: All Locations\\n`;\n        }\n        \n        if (contextOptions.dateRange) {\n          const { start, end } = contextOptions.dateRange;\n          if (start && end) {\n            text += `Date Range: ${start} to ${end}\\n`;\n          }\n        }\n        \n        if (contextOptions.filters) {\n          const activeFilters: string[] = [];\n          Object.entries(contextOptions.filters).forEach(([key, value]) => {\n            // Skip location as it's handled separately\n            if (key === 'location') return;\n            \n            if (value && Array.isArray(value) && value.length > 0) {\n              activeFilters.push(`${key.charAt(0).toUpperCase() + key.slice(1)}: ${value.join(', ')}`);\n            } else if (value && typeof value === 'string' && value !== 'All' && value !== '') {\n              activeFilters.push(`${key.charAt(0).toUpperCase() + key.slice(1)}: ${value}`);\n            }\n          });\n          \n          if (activeFilters.length > 0) {\n            text += `Applied Filters: ${activeFilters.join('; ')}\\n`;\n          } else {\n            text += `Applied Filters: None\\n`;\n          }\n        }\n        \n        if (contextOptions.additionalInfo) {\n          Object.entries(contextOptions.additionalInfo).forEach(([key, value]) => {\n            if (value) {\n              text += `${key.charAt(0).toUpperCase() + key.slice(1)}: ${value}\\n`;\n            }\n          });\n        }\n        \n        text += `\\n--- Table Data (Headers + Data Rows + Totals) ---\\n`;\n        text += `Note: Grouped/Category rows have been excluded\\n`;\n      } else {\n        text += `\\n`;\n      }\n      \n      const headerCells = table.querySelectorAll('thead th, thead td, tr:first-child th, tr:first-child td');\n      const headers: string[] = [];\n      headerCells.forEach(cell => { const t = cell.textContent?.trim(); if (t) headers.push(t); });\n      if (headers.length) {\n        text += headers.join('\\t') + '\\n';\n        text += headers.map(() => '---').join('\\t') + '\\n';\n      }\n      const rows = table.querySelectorAll('tbody tr, tr:not(:first-child)');\n      rows.forEach(row => {\n        // Enhanced detection for grouped/category rows (same logic as CopyTableButton)\n        const isGroupRow = (\n          // Common group row styling classes\n          row.classList.contains('bg-slate-100') || \n          row.classList.contains('bg-gray-100') ||\n          row.classList.contains('bg-slate-50') ||\n          row.classList.contains('bg-gray-50') ||\n          row.classList.contains('group-row') ||\n          row.classList.contains('category-row') ||\n          row.classList.contains('section-header') ||\n          row.classList.contains('group-header') ||\n          row.classList.contains('category-header') ||\n          \n          // Detect expand/collapse buttons (chevron icons)\n          row.querySelector('button[class*=\"ChevronRight\"], button[class*=\"ChevronDown\"]') !== null ||\n          row.querySelector('svg.lucide-chevron-right, svg.lucide-chevron-down') !== null ||\n          row.querySelector('[data-lucide=\"chevron-right\"], [data-lucide=\"chevron-down\"]') !== null ||\n          row.querySelector('.fa-chevron-right, .fa-chevron-down') !== null ||\n          \n          // Detect if row has data attributes indicating it's a group\n          row.hasAttribute('data-group') ||\n          row.hasAttribute('data-category') ||\n          row.hasAttribute('data-section') ||\n          row.hasAttribute('data-grouped') ||\n          \n          // Detect if first cell spans multiple columns (common in group headers)\n          (() => {\n            const firstCell = row.querySelector('td:first-child, th:first-child');\n            return firstCell && (\n              firstCell.getAttribute('colspan') && parseInt(firstCell.getAttribute('colspan') || '1') > 1\n            );\n          })() ||\n          \n          // Detect common group row text patterns\n          (() => {\n            const rowText = row.textContent?.trim().toLowerCase() || '';\n            return (\n              rowText.includes('expand') ||\n              rowText.includes('collapse') ||\n              rowText.includes('show more') ||\n              rowText.includes('show less') ||\n              (rowText.includes('items') && !rowText.match(/\\d+\\s+items/)) ||\n              rowText.includes('category:') ||\n              rowText.includes('group:') ||\n              rowText.includes('section:') ||\n              (rowText.length > 0 && rowText.length < 50 && \n               !rowText.match(/\\d/) && \n               !rowText.includes('â‚¹') && \n               !rowText.includes('%') && \n               !rowText.includes(':') && \n               row.querySelectorAll('td, th').length <= 2)\n            );\n          })()\n        );\n        \n        // Enhanced detection for totals/summary rows (these should be included)\n        const isTotalsRow = (\n          row.classList.contains('bg-slate-800') || \n          row.classList.contains('bg-gray-800') ||\n          row.classList.contains('bg-slate-900') ||\n          row.classList.contains('totals-row') ||\n          row.classList.contains('summary-row') ||\n          row.classList.contains('footer-row') ||\n          (() => {\n            const rowText = row.textContent?.trim() || '';\n            return (\n              rowText.includes('TOTALS') ||\n              rowText.includes('TOTAL') ||\n              rowText.includes('Total') ||\n              rowText.includes('Sum') ||\n              rowText.includes('Summary') ||\n              rowText.includes('Grand Total') ||\n              rowText.includes('Subtotal') ||\n              (() => {\n                const firstCell = row.querySelector('td:first-child, th:first-child');\n                const firstCellText = firstCell?.textContent?.trim().toLowerCase() || '';\n                return (\n                  firstCellText === 'total' ||\n                  firstCellText === 'totals' ||\n                  firstCellText === 'grand total' ||\n                  firstCellText === 'summary' ||\n                  firstCellText.startsWith('total ')\n                );\n              })()\n            );\n          })()\n        );\n        \n        // Skip group rows but always include totals rows and regular data rows\n        if (isGroupRow && !isTotalsRow) {\n          return;\n        }\n        \n        const cells = row.querySelectorAll('td, th');\n        const rowData: string[] = [];\n        cells.forEach(cell => {\n          // Skip cells that are just expand/collapse buttons\n          const hasOnlyButton = cell.querySelector('button') && !cell.textContent?.trim().replace(/[\\s\\n\\r]+/g, '').length;\n          if (hasOnlyButton) {\n            rowData.push(''); // Add empty cell for button columns\n          } else {\n            const text = cell.textContent?.trim() || '';\n            rowData.push(text);\n          }\n        });\n        \n        // Only add row if it has meaningful content\n        if (rowData.length > 0 && rowData.some(cell => cell !== '')) {\n          text += rowData.join('\\t') + '\\n';\n        }\n      });\n      return text.trim();\n    };\n\n    registry.register({ id: title, getTextContent: getText });\n    return () => registry.unregister(title);\n  }, [registry, ref, title, disabled, contextOptions]);\n\n  const getAllTabsText = React.useCallback(async () => {\n    if (!registry) return '';\n    return registry.getAllTabsContent();\n  }, [registry]);\n\n  return { getAllTabsText };\n}\n"],"names":["useRegisterTableForCopy","ref","title","disabled","contextOptions","registry","useMetricsTablesRegistry","React","getText","container","table","text","headerCells","headers","cell","t","row","isGroupRow","firstCell","rowText","isTotalsRow","firstCellText","cells","rowData"],"mappings":"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"}