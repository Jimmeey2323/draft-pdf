{"version":3,"file":"PatternsAndTrends-QzZMtvq8.js","sources":["../../node_modules/lucide-react/dist/esm/icons/grid-3x3.js","../../src/hooks/useVCMemberData.ts","../../src/hooks/useMemberBehaviorAnalytics.ts","../../src/components/dashboard/MemberBehaviorPatterns.tsx","../../src/pages/PatternsAndTrends.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Grid3x3 = createLucideIcon(\"Grid3x3\", [\n  [\"rect\", { width: \"18\", height: \"18\", x: \"3\", y: \"3\", rx: \"2\", key: \"afitv7\" }],\n  [\"path\", { d: \"M3 9h18\", key: \"1pudct\" }],\n  [\"path\", { d: \"M3 15h18\", key: \"5xshup\" }],\n  [\"path\", { d: \"M9 3v18\", key: \"fh3hqa\" }],\n  [\"path\", { d: \"M15 3v18\", key: \"14nvp0\" }]\n]);\n\nexport { Grid3x3 as default };\n//# sourceMappingURL=grid-3x3.js.map\n","import { useState, useEffect } from 'react';\nimport { MemberBehaviorData, MonthlyMetrics } from '@/types/memberBehavior';\nimport { fetchGoogleSheet } from '@/utils/googleAuth';\nimport { createLogger } from '@/utils/logger';\n\nconst logger = createLogger('useVCMemberData');\n\nconst SPREADSHEET_ID = import.meta.env.VITE_GOOGLE_SESSIONS_SPREADSHEET_ID || '16wFlke0bHFcmfn-3UyuYlGnImBq0DY7ouVYAlAFTZys';\nconst VC_SHEET_NAME = 'VC';\n\ninterface UseVCMemberDataResult {\n  data: MemberBehaviorData[];\n  loading: boolean;\n  error: string | null;\n  refetch: () => void;\n}\n\nexport const useVCMemberData = (): UseVCMemberDataResult => {\n  const [data, setData] = useState<MemberBehaviorData[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const parseMonthlyMetrics = (row: any[], headers: string[]): Record<string, MonthlyMetrics> => {\n    const monthlyData: Record<string, MonthlyMetrics> = {};\n    \n    // Find all unique month-year combinations\n    const monthPattern = /^(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) \\d{4} - /;\n    const months = new Set<string>();\n    \n    headers.forEach(header => {\n      const match = header.match(monthPattern);\n      if (match) {\n        const monthYear = header.split(' - ')[0];\n        months.add(monthYear);\n      }\n    });\n\n    // For each month, extract the metrics\n    months.forEach(monthYear => {\n      const bookedIdx = headers.findIndex(h => h === `${monthYear} - Booked`);\n      const visitsIdx = headers.findIndex(h => h === `${monthYear} - Visits`);\n      const cancellationsIdx = headers.findIndex(h => h === `${monthYear} - Cancellations`);\n      const paidIdx = headers.findIndex(h => h === `${monthYear} - Paid Amount`);\n      const unpaidIdx = headers.findIndex(h => h === `${monthYear} - Unpaid Amount`);\n\n      if (bookedIdx !== -1) {\n        monthlyData[monthYear] = {\n          booked: parseFloat(row[bookedIdx]?.toString() || '0') || 0,\n          visits: parseFloat(row[visitsIdx]?.toString() || '0') || 0,\n          cancellations: parseFloat(row[cancellationsIdx]?.toString() || '0') || 0,\n          paidAmount: parseFloat(row[paidIdx]?.toString() || '0') || 0,\n          unpaidAmount: parseFloat(row[unpaidIdx]?.toString() || '0') || 0,\n        };\n      }\n    });\n\n    return monthlyData;\n  };\n\n  const fetchData = async () => {\n    setLoading(true);\n    setError(null);\n\n    try {\n      logger.info('ðŸ”„ Fetching VC member data from Google Sheets...');\n      const rows = await fetchGoogleSheet(SPREADSHEET_ID, VC_SHEET_NAME);\n\n      if (rows.length < 2) {\n        throw new Error('VC sheet appears to be empty');\n      }\n\n      const headers = rows[0];\n      const memberData: MemberBehaviorData[] = [];\n\n      // Process each row (skip header)\n      for (let i = 1; i < rows.length; i++) {\n        const row = rows[i];\n        if (!row || row.length < 5 || !row[0]) continue; // Skip empty rows\n\n        const memberId = row[0]?.toString() || '';\n        const firstName = row[1]?.toString() || '';\n        const lastName = row[2]?.toString() || '';\n        const email = row[3]?.toString() || '';\n        const phone = row[4]?.toString() || '';\n\n        const monthlyData = parseMonthlyMetrics(row, headers);\n\n        memberData.push({\n          memberId,\n          firstName,\n          lastName,\n          email,\n          phone,\n          monthlyData,\n        });\n      }\n\n      logger.info(`âœ… Loaded ${memberData.length} members from VC sheet`);\n      setData(memberData);\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'Unknown error fetching VC data';\n      logger.error('âŒ Error fetching VC member data:', errorMessage);\n      setError(errorMessage);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchData();\n  }, []);\n\n  return {\n    data,\n    loading,\n    error,\n    refetch: fetchData,\n  };\n};\n","import { useMemo } from 'react';\nimport {\n  MemberBehaviorData,\n  MemberBehaviorAnalytics,\n  MemberPerformanceMetrics,\n  MonthlyTrend,\n  MemberSegment,\n  FinancialInsights,\n  OperationalMetrics,\n  PredictiveInsights,\n  TrendAnalysis,\n  SummaryInsights,\n} from '@/types/memberBehavior';\n\nexport const useMemberBehaviorAnalytics = (\n  memberData: MemberBehaviorData[]\n): MemberBehaviorAnalytics => {\n  return useMemo(() => {\n    if (!memberData || memberData.length === 0) {\n      return {\n        performanceMetrics: [],\n        monthlyTrends: [],\n        memberSegments: [],\n        financialInsights: {\n          totalRevenue: 0,\n          totalOutstanding: 0,\n          collectionEfficiency: 0,\n          revenuePerVisit: 0,\n          monthlyRevenueData: [],\n        },\n        operationalMetrics: {\n          overallCancellationRate: 0,\n          appointmentUtilizationRate: 0,\n          totalBookings: 0,\n          totalVisits: 0,\n          totalCancellations: 0,\n          bookingToPaymentConversion: 0,\n        },\n        predictiveInsights: {\n          churnRiskMembers: [],\n          revenueForecasts: [],\n          paymentRiskMembers: [],\n        },\n        trendAnalysis: {\n          declining: [],\n          increasing: [],\n          correlationInsights: {\n            bookingCancellationCorrelation: 0,\n            bookingVisitCorrelation: 0,\n            overallPattern: 'No data available',\n            highRiskPatterns: [],\n          },\n        },\n        summaryInsights: {\n          totalMembers: 0,\n          activeMembers: 0,\n          inactiveMembers: 0,\n          atRiskMembers: 0,\n          averageCancellationRate: 0,\n          averageShowUpRate: 0,\n          topTrend: 'No data available',\n          keyInsight: 'No data available',\n          recommendation: 'No data available',\n        },\n      };\n    }\n\n    // 1. Calculate Performance Metrics for each member\n    const performanceMetrics: MemberPerformanceMetrics[] = memberData.map(member => {\n      let totalBookings = 0;\n      let totalVisits = 0;\n      let totalCancellations = 0;\n      let totalPaidAmount = 0;\n      let totalUnpaidAmount = 0;\n\n      Object.values(member.monthlyData).forEach(metrics => {\n        totalBookings += metrics.booked;\n        totalVisits += metrics.visits;\n        totalCancellations += metrics.cancellations;\n        totalPaidAmount += metrics.paidAmount;\n        totalUnpaidAmount += metrics.unpaidAmount;\n      });\n\n      const cancellationRate = totalBookings > 0 ? (totalCancellations / totalBookings) * 100 : 0;\n      const showUpRate = totalBookings > 0 ? (totalVisits / totalBookings) * 100 : 0;\n      const totalAmount = totalPaidAmount + totalUnpaidAmount;\n      const paymentCompliance = totalAmount > 0 ? (totalPaidAmount / totalAmount) * 100 : 0;\n      const averageTransactionValue = totalVisits > 0 ? totalPaidAmount / totalVisits : 0;\n\n      return {\n        memberId: member.memberId,\n        fullName: `${member.firstName} ${member.lastName}`.trim(),\n        email: member.email,\n        totalBookings,\n        totalVisits,\n        totalCancellations,\n        totalPaidAmount,\n        totalUnpaidAmount,\n        cancellationRate,\n        showUpRate,\n        paymentCompliance,\n        averageTransactionValue,\n      };\n    });\n\n    // 2. Calculate Monthly Trends\n    const monthlyTrendsMap: Record<string, {\n      bookings: number;\n      visits: number;\n      cancellations: number;\n      revenue: number;\n      unpaid: number;\n    }> = {};\n\n    memberData.forEach(member => {\n      Object.entries(member.monthlyData).forEach(([month, metrics]) => {\n        if (!monthlyTrendsMap[month]) {\n          monthlyTrendsMap[month] = {\n            bookings: 0,\n            visits: 0,\n            cancellations: 0,\n            revenue: 0,\n            unpaid: 0,\n          };\n        }\n        monthlyTrendsMap[month].bookings += metrics.booked;\n        monthlyTrendsMap[month].visits += metrics.visits;\n        monthlyTrendsMap[month].cancellations += metrics.cancellations;\n        monthlyTrendsMap[month].revenue += metrics.paidAmount;\n        monthlyTrendsMap[month].unpaid += metrics.unpaidAmount;\n      });\n    });\n\n    const monthlyTrends: MonthlyTrend[] = Object.entries(monthlyTrendsMap)\n      .map(([month, data]) => ({\n        month,\n        totalBookings: data.bookings,\n        totalVisits: data.visits,\n        totalCancellations: data.cancellations,\n        totalRevenue: data.revenue,\n        totalUnpaid: data.unpaid,\n        cancellationRate: data.bookings > 0 ? (data.cancellations / data.bookings) * 100 : 0,\n        showUpRate: data.bookings > 0 ? (data.visits / data.bookings) * 100 : 0,\n      }))\n      .sort((a, b) => {\n        // Sort by date (newest first)\n        const dateA = new Date(a.month);\n        const dateB = new Date(b.month);\n        return dateB.getTime() - dateA.getTime();\n      });\n\n    // 3. Member Segmentation\n    const memberSegments: MemberSegment[] = performanceMetrics.map(metric => {\n      // Get last activity month\n      const member = memberData.find(m => m.memberId === metric.memberId);\n      const monthKeys = member ? Object.keys(member.monthlyData).sort((a, b) => {\n        return new Date(b).getTime() - new Date(a).getTime();\n      }) : [];\n      \n      const lastActivityMonth = monthKeys.find(month => {\n        const data = member?.monthlyData[month];\n        return data && (data.visits > 0 || data.booked > 0);\n      });\n\n      // Determine segment\n      let segment: MemberSegment['segment'] = 'inactive';\n      \n      if (metric.totalPaidAmount > 20000) {\n        segment = 'high-value';\n      } else if (metric.totalVisits >= 20 && metric.showUpRate >= 80) {\n        segment = 'engaged';\n      } else if (metric.cancellationRate > 30 || metric.paymentCompliance < 70) {\n        segment = 'unreliable';\n      } else if (metric.totalVisits >= 10 && metric.showUpRate >= 70) {\n        segment = 'reliable';\n      } else if (metric.totalVisits < 5 || !lastActivityMonth) {\n        segment = 'inactive';\n      } else if (metric.showUpRate < 60 || metric.totalVisits < 10) {\n        segment = 'at-risk';\n      }\n\n      return {\n        memberId: metric.memberId,\n        fullName: metric.fullName,\n        email: metric.email,\n        segment,\n        totalRevenue: metric.totalPaidAmount,\n        visitFrequency: metric.totalVisits,\n        cancellationRate: metric.cancellationRate,\n        lastActivityMonth,\n      };\n    });\n\n    // 4. Financial Insights\n    const totalRevenue = performanceMetrics.reduce((sum, m) => sum + m.totalPaidAmount, 0);\n    const totalOutstanding = performanceMetrics.reduce((sum, m) => sum + m.totalUnpaidAmount, 0);\n    const totalAmount = totalRevenue + totalOutstanding;\n    const collectionEfficiency = totalAmount > 0 ? (totalRevenue / totalAmount) * 100 : 0;\n    const totalVisits = performanceMetrics.reduce((sum, m) => sum + m.totalVisits, 0);\n    const revenuePerVisit = totalVisits > 0 ? totalRevenue / totalVisits : 0;\n\n    const monthlyRevenueData = monthlyTrends.map(trend => ({\n      month: trend.month,\n      revenue: trend.totalRevenue,\n      unpaid: trend.totalUnpaid,\n    }));\n\n    const financialInsights: FinancialInsights = {\n      totalRevenue,\n      totalOutstanding,\n      collectionEfficiency,\n      revenuePerVisit,\n      monthlyRevenueData,\n    };\n\n    // 5. Operational Metrics\n    const totalBookings = performanceMetrics.reduce((sum, m) => sum + m.totalBookings, 0);\n    const totalCancellations = performanceMetrics.reduce((sum, m) => sum + m.totalCancellations, 0);\n    const overallCancellationRate = totalBookings > 0 ? (totalCancellations / totalBookings) * 100 : 0;\n    const appointmentUtilizationRate = totalBookings > 0 ? (totalVisits / totalBookings) * 100 : 0;\n    const bookingToPaymentConversion = totalBookings > 0 ? (totalRevenue / totalBookings) : 0;\n\n    const operationalMetrics: OperationalMetrics = {\n      overallCancellationRate,\n      appointmentUtilizationRate,\n      totalBookings,\n      totalVisits,\n      totalCancellations,\n      bookingToPaymentConversion,\n    };\n\n    // 6. Predictive Insights\n    // Churn Risk: members with declining visit patterns\n    const churnRiskMembers = memberData\n      .map(member => {\n        const months = Object.keys(member.monthlyData).sort((a, b) => \n          new Date(b).getTime() - new Date(a).getTime()\n        );\n        \n        const recent3Months = months.slice(0, 3);\n        const previous3Months = months.slice(3, 6);\n        \n        const recentVisits = recent3Months.reduce((sum, m) => sum + (member.monthlyData[m]?.visits || 0), 0);\n        const previousVisits = previous3Months.reduce((sum, m) => sum + (member.monthlyData[m]?.visits || 0), 0);\n        \n        const declineRate = previousVisits > 0 ? ((previousVisits - recentVisits) / previousVisits) * 100 : 0;\n        const churnScore = Math.min(100, Math.max(0, declineRate * 2));\n        \n        const lastActiveMonth = months.find(m => (member.monthlyData[m]?.visits || 0) > 0) || '';\n        \n        return {\n          memberId: member.memberId,\n          fullName: `${member.firstName} ${member.lastName}`.trim(),\n          email: member.email,\n          churnScore,\n          declineRate,\n          lastActiveMonth,\n        };\n      })\n      .filter(m => m.churnScore > 40)\n      .sort((a, b) => b.churnScore - a.churnScore)\n      .slice(0, 20);\n\n    // Revenue Forecasts: simple linear projection\n    const recentMonths = monthlyTrends.slice(0, 6);\n    const avgRevenue = recentMonths.reduce((sum, m) => sum + m.totalRevenue, 0) / (recentMonths.length || 1);\n    const revenueForecasts = [\n      { month: 'Dec 2025', forecastedRevenue: avgRevenue * 1.05, confidence: 75 },\n      { month: 'Jan 2026', forecastedRevenue: avgRevenue * 1.08, confidence: 65 },\n      { month: 'Feb 2026', forecastedRevenue: avgRevenue * 1.10, confidence: 55 },\n    ];\n\n    // Payment Risk: members with high unpaid amounts\n    const paymentRiskMembers = performanceMetrics\n      .filter(m => m.totalUnpaidAmount > 0)\n      .map(m => ({\n        memberId: m.memberId,\n        fullName: m.fullName,\n        email: m.email,\n        unpaidAmount: m.totalUnpaidAmount,\n        paymentComplianceRate: m.paymentCompliance,\n      }))\n      .sort((a, b) => b.unpaidAmount - a.unpaidAmount)\n      .slice(0, 20);\n\n    const predictiveInsights: PredictiveInsights = {\n      churnRiskMembers,\n      revenueForecasts,\n      paymentRiskMembers,\n    };\n\n    // 7. Trend Analysis\n    const declining: TrendAnalysis['declining'] = [];\n    const increasing: TrendAnalysis['increasing'] = [];\n\n    memberData.forEach(member => {\n      const months = Object.keys(member.monthlyData).sort((a, b) => \n        new Date(b).getTime() - new Date(a).getTime()\n      );\n      \n      if (months.length < 6) return; // Need at least 6 months for trend analysis\n      \n      const recent3Months = months.slice(0, 3);\n      const previous3Months = months.slice(3, 6);\n      \n      // Calculate averages for bookings, visits, cancellations\n      const recentBookings = recent3Months.reduce((sum, m) => sum + (member.monthlyData[m]?.booked || 0), 0) / 3;\n      const previousBookings = previous3Months.reduce((sum, m) => sum + (member.monthlyData[m]?.booked || 0), 0) / 3;\n      \n      const recentVisits = recent3Months.reduce((sum, m) => sum + (member.monthlyData[m]?.visits || 0), 0) / 3;\n      const previousVisits = previous3Months.reduce((sum, m) => sum + (member.monthlyData[m]?.visits || 0), 0) / 3;\n      \n      const recentCancellations = recent3Months.reduce((sum, m) => sum + (member.monthlyData[m]?.cancellations || 0), 0) / 3;\n      const previousCancellations = previous3Months.reduce((sum, m) => sum + (member.monthlyData[m]?.cancellations || 0), 0) / 3;\n      \n      const fullName = `${member.firstName} ${member.lastName}`.trim();\n      \n      // Check for declining bookings\n      if (previousBookings > 0 && recentBookings < previousBookings) {\n        const changeRate = ((recentBookings - previousBookings) / previousBookings) * 100;\n        if (changeRate < -15) { // Significant decline\n          declining.push({\n            memberId: member.memberId,\n            fullName,\n            email: member.email,\n            metric: 'bookings',\n            changeRate,\n            recentAvg: recentBookings,\n            previousAvg: previousBookings,\n          });\n        }\n      }\n      \n      // Check for declining visits\n      if (previousVisits > 0 && recentVisits < previousVisits) {\n        const changeRate = ((recentVisits - previousVisits) / previousVisits) * 100;\n        if (changeRate < -15) {\n          declining.push({\n            memberId: member.memberId,\n            fullName,\n            email: member.email,\n            metric: 'visits',\n            changeRate,\n            recentAvg: recentVisits,\n            previousAvg: previousVisits,\n          });\n        }\n      }\n      \n      // Check for increasing cancellations (negative trend)\n      if (previousCancellations >= 0 && recentCancellations > previousCancellations) {\n        const changeRate = previousCancellations > 0 \n          ? ((recentCancellations - previousCancellations) / previousCancellations) * 100\n          : recentCancellations > 0 ? 100 : 0;\n        if (changeRate > 20 && recentCancellations >= 1) {\n          declining.push({\n            memberId: member.memberId,\n            fullName,\n            email: member.email,\n            metric: 'cancellations',\n            changeRate: -changeRate, // Make negative to indicate it's a bad trend\n            recentAvg: recentCancellations,\n            previousAvg: previousCancellations,\n          });\n        }\n      }\n      \n      // Check for increasing bookings (positive trend)\n      if (previousBookings >= 0 && recentBookings > previousBookings) {\n        const changeRate = previousBookings > 0\n          ? ((recentBookings - previousBookings) / previousBookings) * 100\n          : recentBookings > 0 ? 100 : 0;\n        if (changeRate > 15) {\n          increasing.push({\n            memberId: member.memberId,\n            fullName,\n            email: member.email,\n            metric: 'bookings',\n            changeRate,\n            recentAvg: recentBookings,\n            previousAvg: previousBookings,\n          });\n        }\n      }\n      \n      // Check for increasing visits (positive trend)\n      if (previousVisits >= 0 && recentVisits > previousVisits) {\n        const changeRate = previousVisits > 0\n          ? ((recentVisits - previousVisits) / previousVisits) * 100\n          : recentVisits > 0 ? 100 : 0;\n        if (changeRate > 15) {\n          increasing.push({\n            memberId: member.memberId,\n            fullName,\n            email: member.email,\n            metric: 'attendance',\n            changeRate,\n            recentAvg: recentVisits,\n            previousAvg: previousVisits,\n          });\n        }\n      }\n    });\n\n    // Calculate correlation between bookings and cancellations\n    const calculateCorrelation = (x: number[], y: number[]): number => {\n      const n = x.length;\n      if (n === 0) return 0;\n      \n      const meanX = x.reduce((sum, val) => sum + val, 0) / n;\n      const meanY = y.reduce((sum, val) => sum + val, 0) / n;\n      \n      let numerator = 0;\n      let sumXSquared = 0;\n      let sumYSquared = 0;\n      \n      for (let i = 0; i < n; i++) {\n        const diffX = x[i] - meanX;\n        const diffY = y[i] - meanY;\n        numerator += diffX * diffY;\n        sumXSquared += diffX * diffX;\n        sumYSquared += diffY * diffY;\n      }\n      \n      const denominator = Math.sqrt(sumXSquared * sumYSquared);\n      return denominator === 0 ? 0 : numerator / denominator;\n    };\n\n    const bookingsData: number[] = [];\n    const cancellationsData: number[] = [];\n    const visitsData: number[] = [];\n\n    memberData.forEach(member => {\n      Object.values(member.monthlyData).forEach(metrics => {\n        if (metrics.booked > 0) {\n          bookingsData.push(metrics.booked);\n          cancellationsData.push(metrics.cancellations);\n          visitsData.push(metrics.visits);\n        }\n      });\n    });\n\n    const bookingCancellationCorrelation = calculateCorrelation(bookingsData, cancellationsData);\n    const bookingVisitCorrelation = calculateCorrelation(bookingsData, visitsData);\n\n    // Determine overall pattern\n    let overallPattern = 'Neutral booking behavior';\n    if (bookingCancellationCorrelation > 0.5) {\n      overallPattern = 'Higher bookings correlate with more cancellations (potential over-booking)';\n    } else if (bookingCancellationCorrelation < -0.3) {\n      overallPattern = 'Higher bookings correlate with fewer cancellations (reliable bookers)';\n    }\n    if (bookingVisitCorrelation > 0.7) {\n      overallPattern += ' | Strong booking-to-visit conversion';\n    } else if (bookingVisitCorrelation < 0.5) {\n      overallPattern += ' | Weak booking-to-visit conversion';\n    }\n\n    // Identify high-risk patterns\n    const highRiskPatterns: TrendAnalysis['correlationInsights']['highRiskPatterns'] = [];\n    \n    const highCancellationMembers = performanceMetrics.filter(m => m.cancellationRate > 30).length;\n    if (highCancellationMembers > memberData.length * 0.1) {\n      highRiskPatterns.push({\n        pattern: `${highCancellationMembers} members with >30% cancellation rate`,\n        memberCount: highCancellationMembers,\n        severity: 'high',\n      });\n    }\n    \n    const lowShowUpMembers = performanceMetrics.filter(m => m.showUpRate < 60).length;\n    if (lowShowUpMembers > memberData.length * 0.15) {\n      highRiskPatterns.push({\n        pattern: `${lowShowUpMembers} members with <60% show-up rate`,\n        memberCount: lowShowUpMembers,\n        severity: 'medium',\n      });\n    }\n    \n    const decliningBookingMembers = declining.filter(d => d.metric === 'bookings').length;\n    if (decliningBookingMembers > 10) {\n      highRiskPatterns.push({\n        pattern: `${decliningBookingMembers} members showing declining booking trends`,\n        memberCount: decliningBookingMembers,\n        severity: 'medium',\n      });\n    }\n\n    const trendAnalysis: TrendAnalysis = {\n      declining: declining.sort((a, b) => a.changeRate - b.changeRate).slice(0, 30),\n      increasing: increasing.sort((a, b) => b.changeRate - a.changeRate).slice(0, 30),\n      correlationInsights: {\n        bookingCancellationCorrelation,\n        bookingVisitCorrelation,\n        overallPattern,\n        highRiskPatterns,\n      },\n    };\n\n    // 8. Summary Insights\n    const activeMembers = memberSegments.filter(m => \n      m.segment !== 'inactive' && m.lastActivityMonth\n    ).length;\n    const atRiskMembers = memberSegments.filter(m => \n      m.segment === 'at-risk' || m.segment === 'unreliable'\n    ).length;\n\n    const avgCancellationRate = performanceMetrics.reduce((sum, m) => sum + m.cancellationRate, 0) / (performanceMetrics.length || 1);\n    const avgShowUpRate = performanceMetrics.reduce((sum, m) => sum + m.showUpRate, 0) / (performanceMetrics.length || 1);\n\n    // Determine top trend\n    let topTrend = 'Stable member behavior across the board';\n    if (declining.length > increasing.length * 1.5) {\n      topTrend = `${declining.length} members showing declining engagement - immediate attention needed`;\n    } else if (increasing.length > declining.length * 1.5) {\n      topTrend = `${increasing.length} members showing improved engagement - positive momentum`;\n    } else if (highRiskPatterns.filter(p => p.severity === 'high').length > 0) {\n      topTrend = 'High cancellation rates detected across multiple member segments';\n    }\n\n    // Key insight\n    let keyInsight = `Average cancellation rate is ${avgCancellationRate.toFixed(1)}% with ${avgShowUpRate.toFixed(1)}% show-up rate.`;\n    if (bookingCancellationCorrelation > 0.5) {\n      keyInsight += ' Strong correlation between bookings and cancellations suggests capacity or scheduling issues.';\n    } else if (bookingVisitCorrelation < 0.6) {\n      keyInsight += ' Low booking-to-visit conversion indicates follow-up opportunities.';\n    }\n\n    // Recommendation\n    let recommendation = 'Continue monitoring member engagement patterns.';\n    if (atRiskMembers > memberData.length * 0.2) {\n      recommendation = `Focus on ${atRiskMembers} at-risk members with targeted retention campaigns.`;\n    } else if (declining.length > 15) {\n      recommendation = `Implement re-engagement program for ${declining.length} members with declining trends.`;\n    } else if (avgCancellationRate > 25) {\n      recommendation = 'Review cancellation policies and implement reminder systems to reduce no-shows.';\n    }\n\n    const summaryInsights: SummaryInsights = {\n      totalMembers: memberData.length,\n      activeMembers,\n      inactiveMembers: memberData.length - activeMembers,\n      atRiskMembers,\n      averageCancellationRate: avgCancellationRate,\n      averageShowUpRate: avgShowUpRate,\n      topTrend,\n      keyInsight,\n      recommendation,\n    };\n\n    return {\n      performanceMetrics,\n      monthlyTrends,\n      memberSegments,\n      financialInsights,\n      operationalMetrics,\n      predictiveInsights,\n      trendAnalysis,\n      summaryInsights,\n    };\n  }, [memberData]);\n};\n","import React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Badge } from '@/components/ui/badge';\nimport { motion } from 'framer-motion';\nimport {\n  Users, TrendingUp, DollarSign, AlertCircle, Award,\n  Target, Activity, BarChart3, Calendar, AlertTriangle,\n  CheckCircle, XCircle, ArrowUpRight, ArrowDownRight\n} from 'lucide-react';\nimport { useVCMemberData } from '@/hooks/useVCMemberData';\nimport { useMemberBehaviorAnalytics } from '@/hooks/useMemberBehaviorAnalytics';\nimport { formatCurrency, formatNumber, formatPercentage } from '@/utils/formatters';\nimport {\n  BarChart, Bar, LineChart, Line, PieChart, Pie, Cell,\n  XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer\n} from 'recharts';\n\nconst COLORS = ['#3b82f6', '#8b5cf6', '#ec4899', '#f59e0b', '#10b981', '#06b6d4', '#6366f1'];\n\nexport const MemberBehaviorPatterns: React.FC = () => {\n  const { data: memberData, loading, error } = useVCMemberData();\n  const analytics = useMemberBehaviorAnalytics(memberData);\n  const [activeTab, setActiveTab] = useState<string>('overview');\n\n  if (loading) {\n    return (\n      <Card>\n        <CardContent className=\"p-12 text-center\">\n          <div className=\"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-4\"></div>\n          <p className=\"text-gray-600\">Loading member behavior data...</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (error) {\n    return (\n      <Card className=\"border-red-200 bg-red-50\">\n        <CardContent className=\"p-8\">\n          <div className=\"flex items-center gap-3 text-red-700\">\n            <AlertCircle className=\"w-6 h-6\" />\n            <div>\n              <div className=\"font-semibold\">Failed to load member behavior data</div>\n              <div className=\"text-sm mt-1\">{error}</div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const { performanceMetrics, monthlyTrends, memberSegments, financialInsights, operationalMetrics, predictiveInsights, trendAnalysis, summaryInsights } = analytics;\n\n  // Prepare segment distribution for pie chart\n  const segmentCounts = memberSegments.reduce((acc, m) => {\n    acc[m.segment] = (acc[m.segment] || 0) + 1;\n    return acc;\n  }, {} as Record<string, number>);\n\n  const segmentData = Object.entries(segmentCounts).map(([segment, count]) => ({\n    name: segment.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' '),\n    value: count,\n  }));\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <Card className=\"bg-gradient-to-br from-purple-50 to-white border-purple-200\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2 text-2xl\">\n            <Users className=\"w-7 h-7 text-purple-600\" />\n            Member Behavior Patterns Analysis\n          </CardTitle>\n          <p className=\"text-gray-600 mt-2\">\n            Comprehensive analysis of {formatNumber(memberData.length)} members across {monthlyTrends.length} months\n          </p>\n        </CardHeader>\n      </Card>\n\n      {/* Key Metrics Overview */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.3 }}>\n          <Card className=\"bg-gradient-to-br from-blue-50 to-white border-blue-200 hover:shadow-lg transition-shadow\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <DollarSign className=\"w-8 h-8 text-blue-600\" />\n                <Badge variant=\"secondary\" className=\"bg-blue-100 text-blue-700\">Revenue</Badge>\n              </div>\n              <div className=\"text-3xl font-bold text-gray-900\">{formatCurrency(financialInsights.totalRevenue)}</div>\n              <p className=\"text-sm text-gray-600 mt-1\">Total Revenue</p>\n              <div className=\"mt-3 pt-3 border-t border-blue-100 text-xs text-gray-500\">\n                {formatCurrency(financialInsights.revenuePerVisit)} per visit\n              </div>\n            </CardContent>\n          </Card>\n        </motion.div>\n\n        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.3, delay: 0.1 }}>\n          <Card className=\"bg-gradient-to-br from-emerald-50 to-white border-emerald-200 hover:shadow-lg transition-shadow\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <Activity className=\"w-8 h-8 text-emerald-600\" />\n                <Badge variant=\"secondary\" className=\"bg-emerald-100 text-emerald-700\">\n                  {formatPercentage(operationalMetrics.appointmentUtilizationRate)}\n                </Badge>\n              </div>\n              <div className=\"text-3xl font-bold text-gray-900\">{formatNumber(operationalMetrics.totalVisits)}</div>\n              <p className=\"text-sm text-gray-600 mt-1\">Total Visits</p>\n              <div className=\"mt-3 pt-3 border-t border-emerald-100 text-xs text-gray-500\">\n                {formatNumber(operationalMetrics.totalBookings)} bookings\n              </div>\n            </CardContent>\n          </Card>\n        </motion.div>\n\n        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.3, delay: 0.2 }}>\n          <Card className=\"bg-gradient-to-br from-amber-50 to-white border-amber-200 hover:shadow-lg transition-shadow\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <Target className=\"w-8 h-8 text-amber-600\" />\n                <Badge variant=\"secondary\" className=\"bg-amber-100 text-amber-700\">Collection</Badge>\n              </div>\n              <div className=\"text-3xl font-bold text-gray-900\">{formatPercentage(financialInsights.collectionEfficiency)}</div>\n              <p className=\"text-sm text-gray-600 mt-1\">Collection Efficiency</p>\n              <div className=\"mt-3 pt-3 border-t border-amber-100 text-xs text-gray-500\">\n                {formatCurrency(financialInsights.totalOutstanding)} outstanding\n              </div>\n            </CardContent>\n          </Card>\n        </motion.div>\n\n        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.3, delay: 0.3 }}>\n          <Card className=\"bg-gradient-to-br from-red-50 to-white border-red-200 hover:shadow-lg transition-shadow\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <XCircle className=\"w-8 h-8 text-red-600\" />\n                <Badge variant=\"secondary\" className=\"bg-red-100 text-red-700\">Rate</Badge>\n              </div>\n              <div className=\"text-3xl font-bold text-gray-900\">{formatPercentage(operationalMetrics.overallCancellationRate)}</div>\n              <p className=\"text-sm text-gray-600 mt-1\">Cancellation Rate</p>\n              <div className=\"mt-3 pt-3 border-t border-red-100 text-xs text-gray-500\">\n                {formatNumber(operationalMetrics.totalCancellations)} cancellations\n              </div>\n            </CardContent>\n          </Card>\n        </motion.div>\n      </div>\n\n      {/* Detailed Analysis Tabs */}\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-5 mb-6\">\n          <TabsTrigger value=\"overview\" className=\"flex items-center gap-2\">\n            <BarChart3 className=\"w-4 h-4\" />\n            Overview\n          </TabsTrigger>\n          <TabsTrigger value=\"performance\" className=\"flex items-center gap-2\">\n            <Award className=\"w-4 h-4\" />\n            Performance\n          </TabsTrigger>\n          <TabsTrigger value=\"trends\" className=\"flex items-center gap-2\">\n            <TrendingUp className=\"w-4 h-4\" />\n            Trends\n          </TabsTrigger>\n          <TabsTrigger value=\"segments\" className=\"flex items-center gap-2\">\n            <Users className=\"w-4 h-4\" />\n            Segments\n          </TabsTrigger>\n          <TabsTrigger value=\"predictive\" className=\"flex items-center gap-2\">\n            <AlertTriangle className=\"w-4 h-4\" />\n            Predictive\n          </TabsTrigger>\n        </TabsList>\n\n        {/* Overview Tab */}\n        <TabsContent value=\"overview\" className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            {/* Monthly Revenue Trend */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Calendar className=\"w-5 h-5 text-blue-600\" />\n                  Monthly Revenue Trend\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <ResponsiveContainer width=\"100%\" height={300}>\n                  <LineChart data={monthlyTrends.slice().reverse()}>\n                    <CartesianGrid strokeDasharray=\"3 3\" />\n                    <XAxis dataKey=\"month\" tick={{ fontSize: 12 }} angle={-45} textAnchor=\"end\" height={80} />\n                    <YAxis tick={{ fontSize: 12 }} />\n                    <Tooltip formatter={(value: number) => formatCurrency(value)} />\n                    <Legend />\n                    <Line type=\"monotone\" dataKey=\"totalRevenue\" stroke=\"#3b82f6\" strokeWidth={2} name=\"Revenue\" />\n                    <Line type=\"monotone\" dataKey=\"totalUnpaid\" stroke=\"#f59e0b\" strokeWidth={2} name=\"Unpaid\" />\n                  </LineChart>\n                </ResponsiveContainer>\n              </CardContent>\n            </Card>\n\n            {/* Member Segmentation Distribution */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Users className=\"w-5 h-5 text-purple-600\" />\n                  Member Segmentation\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <ResponsiveContainer width=\"100%\" height={300}>\n                  <PieChart>\n                    <Pie\n                      data={segmentData}\n                      cx=\"50%\"\n                      cy=\"50%\"\n                      labelLine={false}\n                      label={(entry) => `${entry.name}: ${entry.value}`}\n                      outerRadius={100}\n                      fill=\"#8884d8\"\n                      dataKey=\"value\"\n                    >\n                      {segmentData.map((entry, index) => (\n                        <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                      ))}\n                    </Pie>\n                    <Tooltip />\n                  </PieChart>\n                </ResponsiveContainer>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Operational Metrics */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Activity className=\"w-5 h-5 text-emerald-600\" />\n                Operational Efficiency Metrics\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                <div className=\"bg-gradient-to-br from-blue-50 to-white p-6 rounded-lg border border-blue-200\">\n                  <div className=\"text-sm text-gray-600 mb-2\">Appointment Utilization</div>\n                  <div className=\"text-3xl font-bold text-blue-600\">{formatPercentage(operationalMetrics.appointmentUtilizationRate)}</div>\n                  <div className=\"text-xs text-gray-500 mt-2\">{formatNumber(operationalMetrics.totalVisits)} visits / {formatNumber(operationalMetrics.totalBookings)} bookings</div>\n                </div>\n                <div className=\"bg-gradient-to-br from-emerald-50 to-white p-6 rounded-lg border border-emerald-200\">\n                  <div className=\"text-sm text-gray-600 mb-2\">Booking to Payment</div>\n                  <div className=\"text-3xl font-bold text-emerald-600\">{formatCurrency(operationalMetrics.bookingToPaymentConversion)}</div>\n                  <div className=\"text-xs text-gray-500 mt-2\">Average revenue per booking</div>\n                </div>\n                <div className=\"bg-gradient-to-br from-red-50 to-white p-6 rounded-lg border border-red-200\">\n                  <div className=\"text-sm text-gray-600 mb-2\">Cancellation Rate</div>\n                  <div className=\"text-3xl font-bold text-red-600\">{formatPercentage(operationalMetrics.overallCancellationRate)}</div>\n                  <div className=\"text-xs text-gray-500 mt-2\">{formatNumber(operationalMetrics.totalCancellations)} total cancellations</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Performance Tab */}\n        <TabsContent value=\"performance\" className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Award className=\"w-5 h-5 text-blue-600\" />\n                Top Performing Members\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full\">\n                  <thead>\n                    <tr className=\"border-b\">\n                      <th className=\"text-left p-3 text-sm font-semibold text-gray-700\">Member</th>\n                      <th className=\"text-right p-3 text-sm font-semibold text-gray-700\">Visits</th>\n                      <th className=\"text-right p-3 text-sm font-semibold text-gray-700\">Revenue</th>\n                      <th className=\"text-right p-3 text-sm font-semibold text-gray-700\">Show-up Rate</th>\n                      <th className=\"text-right p-3 text-sm font-semibold text-gray-700\">Avg Transaction</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {performanceMetrics\n                      .sort((a, b) => b.totalPaidAmount - a.totalPaidAmount)\n                      .slice(0, 20)\n                      .map((member, idx) => (\n                        <tr key={member.memberId} className=\"border-b hover:bg-gray-50\">\n                          <td className=\"p-3\">\n                            <div className=\"font-medium text-gray-900\">{member.fullName}</div>\n                            <div className=\"text-xs text-gray-500\">{member.email}</div>\n                          </td>\n                          <td className=\"text-right p-3 text-gray-700\">{formatNumber(member.totalVisits)}</td>\n                          <td className=\"text-right p-3 font-semibold text-emerald-600\">{formatCurrency(member.totalPaidAmount)}</td>\n                          <td className=\"text-right p-3\">\n                            <Badge variant={member.showUpRate >= 80 ? 'default' : 'secondary'} className={member.showUpRate >= 80 ? 'bg-emerald-100 text-emerald-700' : ''}>\n                              {formatPercentage(member.showUpRate)}\n                            </Badge>\n                          </td>\n                          <td className=\"text-right p-3 text-gray-700\">{formatCurrency(member.averageTransactionValue)}</td>\n                        </tr>\n                      ))}\n                  </tbody>\n                </table>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Trends Tab */}\n        <TabsContent value=\"trends\" className=\"space-y-6\">\n          {/* Correlation Insights */}\n          <Card className=\"bg-gradient-to-br from-indigo-50 to-white border-indigo-200\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <BarChart3 className=\"w-5 h-5 text-indigo-600\" />\n                Booking & Cancellation Correlation Analysis\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                <div className=\"bg-white p-6 rounded-lg border border-indigo-200\">\n                  <div className=\"text-sm text-gray-600 mb-2\">Booking-Cancellation Correlation</div>\n                  <div className=\"text-3xl font-bold text-indigo-600\">\n                    {trendAnalysis.correlationInsights.bookingCancellationCorrelation.toFixed(2)}\n                  </div>\n                  <div className=\"text-xs text-gray-500 mt-2\">\n                    {Math.abs(trendAnalysis.correlationInsights.bookingCancellationCorrelation) > 0.5 ? 'Strong' : Math.abs(trendAnalysis.correlationInsights.bookingCancellationCorrelation) > 0.3 ? 'Moderate' : 'Weak'} correlation\n                  </div>\n                </div>\n                <div className=\"bg-white p-6 rounded-lg border border-emerald-200\">\n                  <div className=\"text-sm text-gray-600 mb-2\">Booking-Visit Correlation</div>\n                  <div className=\"text-3xl font-bold text-emerald-600\">\n                    {trendAnalysis.correlationInsights.bookingVisitCorrelation.toFixed(2)}\n                  </div>\n                  <div className=\"text-xs text-gray-500 mt-2\">\n                    {trendAnalysis.correlationInsights.bookingVisitCorrelation > 0.7 ? 'Strong' : trendAnalysis.correlationInsights.bookingVisitCorrelation > 0.5 ? 'Moderate' : 'Weak'} conversion\n                  </div>\n                </div>\n                <div className=\"bg-white p-6 rounded-lg border border-purple-200\">\n                  <div className=\"text-sm text-gray-600 mb-2\">Overall Pattern</div>\n                  <div className=\"text-sm font-medium text-gray-800 mt-3\">\n                    {trendAnalysis.correlationInsights.overallPattern}\n                  </div>\n                </div>\n              </div>\n\n              {/* High Risk Patterns */}\n              {trendAnalysis.correlationInsights.highRiskPatterns.length > 0 && (\n                <div className=\"mt-6\">\n                  <div className=\"font-semibold text-gray-800 mb-3 flex items-center gap-2\">\n                    <AlertTriangle className=\"w-5 h-5 text-amber-600\" />\n                    High Risk Patterns Detected\n                  </div>\n                  <div className=\"space-y-2\">\n                    {trendAnalysis.correlationInsights.highRiskPatterns.map((pattern, idx) => (\n                      <div key={idx} className={`p-3 rounded-lg border ${\n                        pattern.severity === 'high' ? 'bg-red-50 border-red-200' :\n                        pattern.severity === 'medium' ? 'bg-amber-50 border-amber-200' :\n                        'bg-yellow-50 border-yellow-200'\n                      }`}>\n                        <div className=\"flex items-center justify-between\">\n                          <span className=\"text-sm font-medium text-gray-800\">{pattern.pattern}</span>\n                          <Badge variant={pattern.severity === 'high' ? 'destructive' : 'secondary'}>\n                            {pattern.severity}\n                          </Badge>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Declining Trends */}\n          <Card className=\"border-red-200 bg-red-50\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 text-red-700\">\n                <ArrowDownRight className=\"w-5 h-5\" />\n                Members with Declining Trends\n                <Badge variant=\"destructive\" className=\"ml-2\">{trendAnalysis.declining.length}</Badge>\n              </CardTitle>\n              <p className=\"text-sm text-red-600 mt-2\">\n                Members showing significant decreases in bookings, visits, or increases in cancellations\n              </p>\n            </CardHeader>\n            <CardContent>\n              <div className=\"bg-white rounded-lg p-4\">\n                <table className=\"w-full\">\n                  <thead>\n                    <tr className=\"border-b\">\n                      <th className=\"text-left p-3 text-sm font-semibold text-gray-700\">Member</th>\n                      <th className=\"text-left p-3 text-sm font-semibold text-gray-700\">Metric</th>\n                      <th className=\"text-right p-3 text-sm font-semibold text-gray-700\">Change Rate</th>\n                      <th className=\"text-right p-3 text-sm font-semibold text-gray-700\">Recent Avg</th>\n                      <th className=\"text-right p-3 text-sm font-semibold text-gray-700\">Previous Avg</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {trendAnalysis.declining.slice(0, 15).map((member, idx) => (\n                      <tr key={`${member.memberId}-${member.metric}`} className=\"border-b hover:bg-gray-50\">\n                        <td className=\"p-3\">\n                          <div className=\"font-medium text-gray-900\">{member.fullName}</div>\n                          <div className=\"text-xs text-gray-500\">{member.email}</div>\n                        </td>\n                        <td className=\"p-3\">\n                          <Badge variant=\"secondary\" className=\"capitalize\">\n                            {member.metric}\n                          </Badge>\n                        </td>\n                        <td className=\"text-right p-3\">\n                          <div className=\"flex items-center justify-end gap-1 text-red-600 font-semibold\">\n                            <ArrowDownRight className=\"w-4 h-4\" />\n                            {formatPercentage(Math.abs(member.changeRate))}\n                          </div>\n                        </td>\n                        <td className=\"text-right p-3 text-gray-700\">{member.recentAvg.toFixed(1)}</td>\n                        <td className=\"text-right p-3 text-gray-700\">{member.previousAvg.toFixed(1)}</td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Increasing Trends */}\n          <Card className=\"border-emerald-200 bg-emerald-50\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 text-emerald-700\">\n                <ArrowUpRight className=\"w-5 h-5\" />\n                Members with Improving Trends\n                <Badge className=\"ml-2 bg-emerald-200 text-emerald-800\">{trendAnalysis.increasing.length}</Badge>\n              </CardTitle>\n              <p className=\"text-sm text-emerald-600 mt-2\">\n                Members showing significant increases in bookings and attendance\n              </p>\n            </CardHeader>\n            <CardContent>\n              <div className=\"bg-white rounded-lg p-4\">\n                <table className=\"w-full\">\n                  <thead>\n                    <tr className=\"border-b\">\n                      <th className=\"text-left p-3 text-sm font-semibold text-gray-700\">Member</th>\n                      <th className=\"text-left p-3 text-sm font-semibold text-gray-700\">Metric</th>\n                      <th className=\"text-right p-3 text-sm font-semibold text-gray-700\">Change Rate</th>\n                      <th className=\"text-right p-3 text-sm font-semibold text-gray-700\">Recent Avg</th>\n                      <th className=\"text-right p-3 text-sm font-semibold text-gray-700\">Previous Avg</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {trendAnalysis.increasing.slice(0, 15).map((member, idx) => (\n                      <tr key={`${member.memberId}-${member.metric}`} className=\"border-b hover:bg-gray-50\">\n                        <td className=\"p-3\">\n                          <div className=\"font-medium text-gray-900\">{member.fullName}</div>\n                          <div className=\"text-xs text-gray-500\">{member.email}</div>\n                        </td>\n                        <td className=\"p-3\">\n                          <Badge className=\"capitalize bg-emerald-100 text-emerald-700\">\n                            {member.metric}\n                          </Badge>\n                        </td>\n                        <td className=\"text-right p-3\">\n                          <div className=\"flex items-center justify-end gap-1 text-emerald-600 font-semibold\">\n                            <ArrowUpRight className=\"w-4 h-4\" />\n                            {formatPercentage(member.changeRate)}\n                          </div>\n                        </td>\n                        <td className=\"text-right p-3 text-gray-700\">{member.recentAvg.toFixed(1)}</td>\n                        <td className=\"text-right p-3 text-gray-700\">{member.previousAvg.toFixed(1)}</td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Monthly Performance Trends - Original Chart */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <TrendingUp className=\"w-5 h-5 text-purple-600\" />\n                Monthly Performance Trends\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <ResponsiveContainer width=\"100%\" height={400}>\n                <BarChart data={monthlyTrends.slice().reverse()}>\n                  <CartesianGrid strokeDasharray=\"3 3\" />\n                  <XAxis dataKey=\"month\" tick={{ fontSize: 12 }} angle={-45} textAnchor=\"end\" height={80} />\n                  <YAxis tick={{ fontSize: 12 }} />\n                  <Tooltip />\n                  <Legend />\n                  <Bar dataKey=\"totalBookings\" fill=\"#3b82f6\" name=\"Bookings\" />\n                  <Bar dataKey=\"totalVisits\" fill=\"#10b981\" name=\"Visits\" />\n                  <Bar dataKey=\"totalCancellations\" fill=\"#ef4444\" name=\"Cancellations\" />\n                </BarChart>\n              </ResponsiveContainer>\n            </CardContent>\n          </Card>\n\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg\">Cancellation Rate Trend</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <ResponsiveContainer width=\"100%\" height={250}>\n                  <LineChart data={monthlyTrends.slice().reverse()}>\n                    <CartesianGrid strokeDasharray=\"3 3\" />\n                    <XAxis dataKey=\"month\" tick={{ fontSize: 12 }} angle={-45} textAnchor=\"end\" height={80} />\n                    <YAxis tick={{ fontSize: 12 }} />\n                    <Tooltip formatter={(value: number) => `${value.toFixed(1)}%`} />\n                    <Line type=\"monotone\" dataKey=\"cancellationRate\" stroke=\"#ef4444\" strokeWidth={2} name=\"Cancellation %\" />\n                  </LineChart>\n                </ResponsiveContainer>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg\">Show-up Rate Trend</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <ResponsiveContainer width=\"100%\" height={250}>\n                  <LineChart data={monthlyTrends.slice().reverse()}>\n                    <CartesianGrid strokeDasharray=\"3 3\" />\n                    <XAxis dataKey=\"month\" tick={{ fontSize: 12 }} angle={-45} textAnchor=\"end\" height={80} />\n                    <YAxis tick={{ fontSize: 12 }} />\n                    <Tooltip formatter={(value: number) => `${value.toFixed(1)}%`} />\n                    <Line type=\"monotone\" dataKey=\"showUpRate\" stroke=\"#10b981\" strokeWidth={2} name=\"Show-up %\" />\n                  </LineChart>\n                </ResponsiveContainer>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        {/* Segments Tab */}\n        <TabsContent value=\"segments\" className=\"space-y-6\">\n          {(['high-value', 'engaged', 'reliable', 'at-risk', 'unreliable', 'inactive'] as const).map(segment => {\n            const segmentMembers = memberSegments.filter(m => m.segment === segment);\n            if (segmentMembers.length === 0) return null;\n\n            const segmentConfig = {\n              'high-value': { color: 'purple', icon: Award, label: 'High-Value Members' },\n              'engaged': { color: 'emerald', icon: CheckCircle, label: 'Engaged Members' },\n              'reliable': { color: 'blue', icon: Target, label: 'Reliable Members' },\n              'at-risk': { color: 'amber', icon: AlertCircle, label: 'At-Risk Members' },\n              'unreliable': { color: 'orange', icon: AlertTriangle, label: 'Unreliable Members' },\n              'inactive': { color: 'gray', icon: XCircle, label: 'Inactive Members' },\n            };\n\n            const config = segmentConfig[segment];\n            const Icon = config.icon;\n\n            return (\n              <Card key={segment}>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Icon className={`w-5 h-5 text-${config.color}-600`} />\n                    {config.label}\n                    <Badge className=\"ml-2\">{segmentMembers.length}</Badge>\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"overflow-x-auto\">\n                    <table className=\"w-full\">\n                      <thead>\n                        <tr className=\"border-b\">\n                          <th className=\"text-left p-3 text-sm font-semibold text-gray-700\">Member</th>\n                          <th className=\"text-right p-3 text-sm font-semibold text-gray-700\">Revenue</th>\n                          <th className=\"text-right p-3 text-sm font-semibold text-gray-700\">Visits</th>\n                          <th className=\"text-right p-3 text-sm font-semibold text-gray-700\">Cancellation Rate</th>\n                          <th className=\"text-left p-3 text-sm font-semibold text-gray-700\">Last Active</th>\n                        </tr>\n                      </thead>\n                      <tbody>\n                        {segmentMembers.slice(0, 10).map(member => (\n                          <tr key={member.memberId} className=\"border-b hover:bg-gray-50\">\n                            <td className=\"p-3\">\n                              <div className=\"font-medium text-gray-900\">{member.fullName}</div>\n                              <div className=\"text-xs text-gray-500\">{member.email}</div>\n                            </td>\n                            <td className=\"text-right p-3 font-semibold text-emerald-600\">{formatCurrency(member.totalRevenue)}</td>\n                            <td className=\"text-right p-3 text-gray-700\">{formatNumber(member.visitFrequency)}</td>\n                            <td className=\"text-right p-3\">\n                              <Badge variant={member.cancellationRate < 20 ? 'default' : 'secondary'}>\n                                {formatPercentage(member.cancellationRate)}\n                              </Badge>\n                            </td>\n                            <td className=\"text-left p-3 text-sm text-gray-600\">{member.lastActivityMonth || 'N/A'}</td>\n                          </tr>\n                        ))}\n                      </tbody>\n                    </table>\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </TabsContent>\n\n        {/* Predictive Tab */}\n        <TabsContent value=\"predictive\" className=\"space-y-6\">\n          {/* Churn Risk */}\n          <Card className=\"border-red-200 bg-red-50\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 text-red-700\">\n                <AlertTriangle className=\"w-5 h-5\" />\n                High Churn Risk Members\n                <Badge variant=\"destructive\" className=\"ml-2\">{predictiveInsights.churnRiskMembers.length}</Badge>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"bg-white rounded-lg p-4\">\n                <table className=\"w-full\">\n                  <thead>\n                    <tr className=\"border-b\">\n                      <th className=\"text-left p-3 text-sm font-semibold text-gray-700\">Member</th>\n                      <th className=\"text-right p-3 text-sm font-semibold text-gray-700\">Churn Score</th>\n                      <th className=\"text-right p-3 text-sm font-semibold text-gray-700\">Decline Rate</th>\n                      <th className=\"text-left p-3 text-sm font-semibold text-gray-700\">Last Active</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {predictiveInsights.churnRiskMembers.map(member => (\n                      <tr key={member.memberId} className=\"border-b hover:bg-gray-50\">\n                        <td className=\"p-3\">\n                          <div className=\"font-medium text-gray-900\">{member.fullName}</div>\n                          <div className=\"text-xs text-gray-500\">{member.email}</div>\n                        </td>\n                        <td className=\"text-right p-3\">\n                          <Badge variant=\"destructive\">{member.churnScore.toFixed(0)}</Badge>\n                        </td>\n                        <td className=\"text-right p-3 text-red-600 font-semibold\">\n                          <div className=\"flex items-center justify-end gap-1\">\n                            <ArrowDownRight className=\"w-4 h-4\" />\n                            {formatPercentage(member.declineRate)}\n                          </div>\n                        </td>\n                        <td className=\"text-left p-3 text-sm text-gray-600\">{member.lastActiveMonth}</td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Payment Risk */}\n          <Card className=\"border-amber-200 bg-amber-50\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 text-amber-700\">\n                <DollarSign className=\"w-5 h-5\" />\n                Payment Risk Members\n                <Badge className=\"ml-2 bg-amber-200 text-amber-800\">{predictiveInsights.paymentRiskMembers.length}</Badge>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"bg-white rounded-lg p-4\">\n                <table className=\"w-full\">\n                  <thead>\n                    <tr className=\"border-b\">\n                      <th className=\"text-left p-3 text-sm font-semibold text-gray-700\">Member</th>\n                      <th className=\"text-right p-3 text-sm font-semibold text-gray-700\">Unpaid Amount</th>\n                      <th className=\"text-right p-3 text-sm font-semibold text-gray-700\">Compliance Rate</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {predictiveInsights.paymentRiskMembers.map(member => (\n                      <tr key={member.memberId} className=\"border-b hover:bg-gray-50\">\n                        <td className=\"p-3\">\n                          <div className=\"font-medium text-gray-900\">{member.fullName}</div>\n                          <div className=\"text-xs text-gray-500\">{member.email}</div>\n                        </td>\n                        <td className=\"text-right p-3 font-semibold text-red-600\">{formatCurrency(member.unpaidAmount)}</td>\n                        <td className=\"text-right p-3\">\n                          <Badge variant={member.paymentComplianceRate >= 80 ? 'default' : 'destructive'}>\n                            {formatPercentage(member.paymentComplianceRate)}\n                          </Badge>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Revenue Forecast */}\n          <Card className=\"border-blue-200 bg-blue-50\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 text-blue-700\">\n                <TrendingUp className=\"w-5 h-5\" />\n                Revenue Forecasts\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"bg-white rounded-lg p-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  {predictiveInsights.revenueForecasts.map(forecast => (\n                    <div key={forecast.month} className=\"bg-gradient-to-br from-blue-50 to-white p-6 rounded-lg border border-blue-200\">\n                      <div className=\"text-sm text-gray-600 mb-2\">{forecast.month}</div>\n                      <div className=\"text-2xl font-bold text-blue-600 mb-2\">{formatCurrency(forecast.forecastedRevenue)}</div>\n                      <div className=\"flex items-center gap-2 text-xs text-gray-500\">\n                        <Target className=\"w-3 h-3\" />\n                        {forecast.confidence}% confidence\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      {/* Summary Footer */}\n      <Card className=\"bg-gradient-to-br from-slate-800 to-slate-900 text-white border-0 shadow-2xl\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2 text-2xl\">\n            <BarChart3 className=\"w-7 h-7 text-blue-400\" />\n            Analysis Summary & Insights\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          {/* Key Stats */}\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n            <div className=\"bg-white/10 backdrop-blur-sm p-4 rounded-lg border border-white/20\">\n              <div className=\"text-sm text-blue-200 mb-1\">Total Members</div>\n              <div className=\"text-3xl font-bold\">{formatNumber(summaryInsights.totalMembers)}</div>\n            </div>\n            <div className=\"bg-white/10 backdrop-blur-sm p-4 rounded-lg border border-white/20\">\n              <div className=\"text-sm text-emerald-200 mb-1\">Active Members</div>\n              <div className=\"text-3xl font-bold text-emerald-400\">{formatNumber(summaryInsights.activeMembers)}</div>\n              <div className=\"text-xs text-emerald-300 mt-1\">\n                {formatPercentage((summaryInsights.activeMembers / summaryInsights.totalMembers) * 100)}\n              </div>\n            </div>\n            <div className=\"bg-white/10 backdrop-blur-sm p-4 rounded-lg border border-white/20\">\n              <div className=\"text-sm text-amber-200 mb-1\">At Risk</div>\n              <div className=\"text-3xl font-bold text-amber-400\">{formatNumber(summaryInsights.atRiskMembers)}</div>\n              <div className=\"text-xs text-amber-300 mt-1\">\n                {formatPercentage((summaryInsights.atRiskMembers / summaryInsights.totalMembers) * 100)}\n              </div>\n            </div>\n            <div className=\"bg-white/10 backdrop-blur-sm p-4 rounded-lg border border-white/20\">\n              <div className=\"text-sm text-red-200 mb-1\">Inactive</div>\n              <div className=\"text-3xl font-bold text-red-400\">{formatNumber(summaryInsights.inactiveMembers)}</div>\n              <div className=\"text-xs text-red-300 mt-1\">\n                {formatPercentage((summaryInsights.inactiveMembers / summaryInsights.totalMembers) * 100)}\n              </div>\n            </div>\n          </div>\n\n          {/* Performance Metrics */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <div className=\"bg-white/10 backdrop-blur-sm p-6 rounded-lg border border-white/20\">\n              <div className=\"flex items-center gap-2 mb-3\">\n                <Activity className=\"w-5 h-5 text-blue-400\" />\n                <h3 className=\"text-lg font-semibold\">Overall Performance</h3>\n              </div>\n              <div className=\"space-y-3\">\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"text-gray-300\">Average Cancellation Rate:</span>\n                  <span className=\"font-bold text-xl\">{formatPercentage(summaryInsights.averageCancellationRate)}</span>\n                </div>\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"text-gray-300\">Average Show-up Rate:</span>\n                  <span className=\"font-bold text-xl text-emerald-400\">{formatPercentage(summaryInsights.averageShowUpRate)}</span>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-white/10 backdrop-blur-sm p-6 rounded-lg border border-white/20\">\n              <div className=\"flex items-center gap-2 mb-3\">\n                <TrendingUp className=\"w-5 h-5 text-purple-400\" />\n                <h3 className=\"text-lg font-semibold\">Trend Analysis</h3>\n              </div>\n              <div className=\"space-y-3\">\n                <div className=\"flex items-start gap-2\">\n                  <ArrowDownRight className=\"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5\" />\n                  <span className=\"text-sm\">{trendAnalysis.declining.length} members declining</span>\n                </div>\n                <div className=\"flex items-start gap-2\">\n                  <ArrowUpRight className=\"w-5 h-5 text-emerald-400 flex-shrink-0 mt-0.5\" />\n                  <span className=\"text-sm\">{trendAnalysis.increasing.length} members improving</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Key Insights */}\n          <div className=\"bg-gradient-to-br from-blue-600/20 to-purple-600/20 backdrop-blur-sm p-6 rounded-lg border border-blue-400/30\">\n            <div className=\"flex items-start gap-3\">\n              <AlertCircle className=\"w-6 h-6 text-blue-400 flex-shrink-0 mt-1\" />\n              <div>\n                <h3 className=\"text-lg font-semibold mb-2 text-blue-100\">Top Trend</h3>\n                <p className=\"text-gray-200\">{summaryInsights.topTrend}</p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-gradient-to-br from-purple-600/20 to-pink-600/20 backdrop-blur-sm p-6 rounded-lg border border-purple-400/30\">\n            <div className=\"flex items-start gap-3\">\n              <Target className=\"w-6 h-6 text-purple-400 flex-shrink-0 mt-1\" />\n              <div>\n                <h3 className=\"text-lg font-semibold mb-2 text-purple-100\">Key Insight</h3>\n                <p className=\"text-gray-200\">{summaryInsights.keyInsight}</p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-gradient-to-br from-emerald-600/20 to-teal-600/20 backdrop-blur-sm p-6 rounded-lg border border-emerald-400/30\">\n            <div className=\"flex items-start gap-3\">\n              <CheckCircle className=\"w-6 h-6 text-emerald-400 flex-shrink-0 mt-1\" />\n              <div>\n                <h3 className=\"text-lg font-semibold mb-2 text-emerald-100\">Recommendation</h3>\n                <p className=\"text-gray-200\">{summaryInsights.recommendation}</p>\n              </div>\n            </div>\n          </div>\n\n          {/* Correlation Summary */}\n          <div className=\"bg-white/10 backdrop-blur-sm p-6 rounded-lg border border-white/20\">\n            <div className=\"flex items-center gap-2 mb-3\">\n              <BarChart3 className=\"w-5 h-5 text-indigo-400\" />\n              <h3 className=\"text-lg font-semibold\">Correlation Insights</h3>\n            </div>\n            <p className=\"text-gray-300\">{trendAnalysis.correlationInsights.overallPattern}</p>\n            {trendAnalysis.correlationInsights.highRiskPatterns.length > 0 && (\n              <div className=\"mt-4 space-y-2\">\n                {trendAnalysis.correlationInsights.highRiskPatterns.map((pattern, idx) => (\n                  <div key={idx} className=\"flex items-center gap-2 text-sm\">\n                    <AlertTriangle className=\"w-4 h-4 text-amber-400\" />\n                    <span className=\"text-gray-300\">{pattern.pattern}</span>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};\n","import React, { useState, useMemo, useEffect, useDeferredValue, useTransition, useRef } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Button } from '@/components/ui/button';\nimport { ChevronDown, ChevronRight, TrendingUp, TrendingDown, Users, Calendar, BarChart3, Info, Grid3x3, LayoutGrid, UserCheck, AlertCircle, Activity, DollarSign, Package, Target, Percent, CheckCircle, XCircle, UserPlus } from 'lucide-react';\nimport { useCheckinsData } from '@/hooks/useCheckinsData';\nimport { useSalesData } from '@/hooks/useSalesData';\nimport { formatNumber, formatCurrency, formatPercentage, formatRevenue } from '@/utils/formatters';\nimport { cn } from '@/lib/utils';\nimport { InfoPopover } from '@/components/ui/InfoSidebar';\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';\nimport SalesMotionHero from '@/components/ui/SalesMotionHero';\nimport { useGlobalLoading } from '@/hooks/useGlobalLoading';\nimport CopyTableButton from '@/components/ui/CopyTableButton';\nimport { useRegisterTableForCopy } from '@/hooks/useRegisterTableForCopy';\nimport { useTableCopyContext } from '@/hooks/useTableCopyContext';\nimport { MemberBehaviorPatterns } from '@/components/dashboard/MemberBehaviorPatterns';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { StudioLocationTabs } from '@/components/ui/StudioLocationTabs';\nimport { useNavigate } from 'react-router-dom';\nimport { Footer } from '@/components/ui/footer';\nimport { GlobalFiltersProvider } from '@/contexts/GlobalFiltersContext';\nimport { ModernDataTable } from '@/components/ui/ModernDataTable';\n\ntype GroupByOption = 'product' | 'category' | 'teacher' | 'location' | 'memberStatus';\n\ntype MetricType = \n  | 'visits' \n  | 'bookings' \n  | 'checkins' \n  | 'sessions' \n  | 'emptySessions'\n  | 'uniqueMembers' \n  | 'newMembers' \n  | 'returningMembers'\n  | 'revenue' \n  | 'unitsSold' \n  | 'classAvg' \n  | 'fillRate' \n  | 'capacity'\n  | 'lateCancellations'\n  | 'complementary'\n  | 'avgRevenuePerMember'\n  | 'avgRevenuePerSession'\n  | 'earnedRevenue';\n\ninterface MetricConfig {\n  id: MetricType;\n  label: string;\n  description: string;\n  icon: any;\n  color: string;\n  format: 'number' | 'currency' | 'percentage' | 'decimal';\n}\n\nexport const PatternsAndTrends = () => {\n  const { data: checkinsData, loading: checkinsLoading, error: checkinsError } = useCheckinsData();\n  const { data: salesData, loading: salesLoading, error: salesError } = useSalesData();\n  const { setLoading } = useGlobalLoading();\n  const navigate = useNavigate();\n  const [selectedLocation, setSelectedLocation] = useState('Kwality House, Kemps Corner');\n  const [heroColor, setHeroColor] = useState<string>('#3b82f6');\n  const [isFiltersCollapsed, setIsFiltersCollapsed] = useState(true);\n  const [expandedRows, setExpandedRows] = useState<Set<string>>(new Set());\n  const [groupBy, setGroupBy] = useState<GroupByOption>('product');\n  const [selectedMetric, setSelectedMetric] = useState<MetricType>('visits');\n  \n  // Combine loading states\n  const loading = checkinsLoading || salesLoading;\n  const error = checkinsError || salesError;\n  \n  // Define all available metrics\n  const METRICS: MetricConfig[] = [\n    { id: 'visits', label: 'Total Visits', description: 'Total check-ins across all sessions', icon: Activity, color: 'text-indigo-600', format: 'number' },\n    { id: 'bookings', label: 'Total Bookings', description: 'All bookings (checked-in or not)', icon: Calendar, color: 'text-blue-600', format: 'number' },\n    { id: 'checkins', label: 'Check-ins', description: 'Successfully checked-in sessions', icon: CheckCircle, color: 'text-green-600', format: 'number' },\n    { id: 'sessions', label: 'Sessions Held', description: 'Unique sessions that occurred', icon: BarChart3, color: 'text-purple-600', format: 'number' },\n    { id: 'emptySessions', label: 'Empty Sessions', description: 'Sessions with zero check-ins', icon: XCircle, color: 'text-red-600', format: 'number' },\n    { id: 'uniqueMembers', label: 'Unique Members', description: 'Distinct members who checked in', icon: Users, color: 'text-cyan-600', format: 'number' },\n    { id: 'newMembers', label: 'New Members', description: 'Members with \"New\" in Is New column', icon: UserPlus, color: 'text-emerald-600', format: 'number' },\n    { id: 'returningMembers', label: 'Returning Members', description: 'Members without \"New\" status', icon: UserCheck, color: 'text-teal-600', format: 'number' },\n    { id: 'revenue', label: 'Total Revenue (Sales)', description: 'Sum of all payments from Sales sheet', icon: DollarSign, color: 'text-green-700', format: 'currency' },\n    { id: 'earnedRevenue', label: 'Earned Revenue', description: 'Revenue from checked-in sessions', icon: DollarSign, color: 'text-emerald-700', format: 'currency' },\n    { id: 'unitsSold', label: 'Units Sold', description: 'Total items from Sales sheet', icon: Package, color: 'text-orange-600', format: 'number' },\n    { id: 'classAvg', label: 'Class Average', description: 'Average attendees per session', icon: Target, color: 'text-pink-600', format: 'decimal' },\n    { id: 'fillRate', label: 'Fill Rate %', description: 'Capacity utilization percentage', icon: Percent, color: 'text-violet-600', format: 'percentage' },\n    { id: 'capacity', label: 'Total Capacity', description: 'Maximum available spots', icon: Grid3x3, color: 'text-slate-600', format: 'number' },\n    { id: 'lateCancellations', label: 'Late Cancellations', description: 'Cancelled after deadline', icon: AlertCircle, color: 'text-amber-600', format: 'number' },\n    { id: 'complementary', label: 'Complementary', description: 'Sessions where Paid = 0', icon: Info, color: 'text-lime-600', format: 'number' },\n    { id: 'avgRevenuePerMember', label: 'Avg Revenue/Member', description: 'Revenue per unique member', icon: DollarSign, color: 'text-fuchsia-600', format: 'currency' },\n    { id: 'avgRevenuePerSession', label: 'Avg Revenue/Session', description: 'Revenue per session', icon: DollarSign, color: 'text-rose-600', format: 'currency' },\n  ];\n  \n  // Filter states\n  const [selectedProducts, setSelectedProducts] = useState<string[]>([]);\n  const [selectedCategories, setSelectedCategories] = useState<string[]>([]);\n  const [selectedTeachers, setSelectedTeachers] = useState<string[]>([]);\n  const [selectedMemberStatus, setSelectedMemberStatus] = useState<string[]>([]);\n  const [selectedMonths, setSelectedMonths] = useState<string[]>([]);\n  \n  // Frequency table states\n  const [frequencyBreakdownBy, setFrequencyBreakdownBy] = useState<'product' | 'category' | 'teacher' | 'class'>('class');\n  const [frequencyQuickFilterMonth, setFrequencyQuickFilterMonth] = useState<string>('All');\n  const [cancellationBreakdownBy, setCancellationBreakdownBy] = useState<'product' | 'category' | 'teacher' | 'class'>('class');\n  const [cancellationQuickFilterMonth, setCancellationQuickFilterMonth] = useState<string>('All');\n\n  // Refs for copy table functionality\n  const monthOnMonthTableRef = useRef<HTMLDivElement>(null);\n  const frequencyTableRef = useRef<HTMLDivElement>(null);\n  const cancellationTableRef = useRef<HTMLDivElement>(null);\n  \n  // Register tables for copy functionality - but we need custom logic for all metrics\n  const { getAllTabsText: getMonthOnMonthText } = useRegisterTableForCopy(\n    monthOnMonthTableRef as any, \n    `${METRICS.find(m => m.id === selectedMetric)?.label} by ${groupBy.charAt(0).toUpperCase() + groupBy.slice(1)} - Month on Month`,\n    true // disabled - we'll handle this manually\n  );\n  const { getAllTabsText: getFrequencyText } = useRegisterTableForCopy(\n    frequencyTableRef as any,\n    'Attendance Frequency Breakdown'\n  );\n  const { getAllTabsText: getCancellationText } = useRegisterTableForCopy(\n    cancellationTableRef as any,\n    'Late Cancellations Breakdown'\n  );\n\n  // Sync loading state with global loader\n  useEffect(() => {\n    setLoading(loading, 'Loading patterns and trends data...');\n  }, [loading, setLoading]);\n\n  // Get unique filter options\n  const filterOptions = useMemo(() => {\n    const products = new Set<string>();\n    const categories = new Set<string>();\n    const teachers = new Set<string>();\n    const memberStatuses = new Set<string>();\n    const months = new Set<string>();\n\n    checkinsData.forEach(item => {\n      if (item.cleanedProduct) products.add(item.cleanedProduct);\n      if (item.cleanedCategory) categories.add(item.cleanedCategory);\n      if (item.teacherName) teachers.add(item.teacherName);\n      if (item.isNew) memberStatuses.add(item.isNew);\n      if (item.month) months.add(item.month);\n    });\n\n    return {\n      products: Array.from(products).sort(),\n      categories: Array.from(categories).sort(),\n      teachers: Array.from(teachers).sort(),\n      memberStatuses: Array.from(memberStatuses).sort(),\n      months: Array.from(months).sort()\n    };\n  }, [checkinsData]);\n\n  // Filter data by location and additional filters (ALL FILTERS APPLIED)\n  const filteredData = useMemo(() => {\n    let data = checkinsData;\n    \n    // Location filter\n    if (selectedLocation !== 'All Locations') {\n      data = data.filter(item => {\n        const location = item.location || '';\n        if (selectedLocation === 'Kenkere House') {\n          return location.toLowerCase().includes('kenkere') || location === 'Kenkere House';\n        }\n        return location === selectedLocation;\n      });\n    }\n\n    // Product filter\n    if (selectedProducts.length > 0) {\n      data = data.filter(item => selectedProducts.includes(item.cleanedProduct || ''));\n    }\n\n    // Category filter\n    if (selectedCategories.length > 0) {\n      data = data.filter(item => selectedCategories.includes(item.cleanedCategory || ''));\n    }\n\n    // Teacher filter\n    if (selectedTeachers.length > 0) {\n      data = data.filter(item => selectedTeachers.includes(item.teacherName || ''));\n    }\n\n    // Member status filter\n    if (selectedMemberStatus.length > 0) {\n      data = data.filter(item => selectedMemberStatus.includes(item.isNew || ''));\n    }\n\n    // Month filter - NOW APPLIED\n    if (selectedMonths.length > 0) {\n      data = data.filter(item => selectedMonths.includes(item.month || ''));\n    }\n\n    return data;\n  }, [checkinsData, selectedLocation, selectedProducts, selectedCategories, selectedTeachers, selectedMemberStatus, selectedMonths]);\n\n  // Location-only filtered data for hero metrics\n  const filteredLocationData = useMemo(() => {\n    if (selectedLocation === 'All Locations') {\n      return checkinsData;\n    }\n    \n    return checkinsData.filter(item => {\n      const location = item.location || '';\n      if (selectedLocation === 'Kenkere House') {\n        return location.toLowerCase().includes('kenkere') || location === 'Kenkere House';\n      }\n      return location === selectedLocation;\n    });\n  }, [checkinsData, selectedLocation]);\n\n  // Defer heavy computations so UI stays responsive while filters change\n  const deferredFilteredData = useDeferredValue(filteredData);\n  const deferredSalesData = useDeferredValue(salesData);\n  const [isPending, startTransition] = useTransition();\n\n  // Process data: month-on-month breakdown by product/category/teacher with ALL METRICS\n  const monthlyProductData = useMemo(() => {\n    const fd = deferredFilteredData;\n    const sd = deferredSalesData;\n    \n    // Early return check\n    if (!fd || fd.length === 0) {\n      // Check if we have raw data but filtering is too restrictive\n      if (checkinsData.length > 0) {\n        return { \n          products: [{\n            product: 'No Data After Filtering',\n            monthlyBreakdown: [],\n            totalVisits: 0,\n            totalBookings: 0,\n            totalUniqueMembers: 0,\n            totalSessions: 0,\n            totalRevenue: 0,\n            totalCapacity: 0,\n            avgFillRate: 0,\n            avgClassAvg: 0\n          }], \n          months: [], \n          totalsRow: { \n            product: 'TOTAL', \n            monthlyBreakdown: [], \n            totalVisits: 0, \n            totalUniqueMembers: 0 \n          } \n        };\n      }\n      // No data at all - provide sample data for testing\n      return { \n        products: [{\n          product: 'Sample Product',\n          monthlyBreakdown: [{\n            month: 'December 2024',\n            visits: 150,\n            bookings: 180,\n            checkins: 150,\n            sessions: 25,\n            emptySessions: 2,\n            uniqueMembers: 85,\n            newMembers: 15,\n            returningMembers: 70,\n            revenue: 12500,\n            earnedRevenue: 11800,\n            unitsSold: 45,\n            classAvg: 6.0,\n            fillRate: 75.5,\n            capacity: 200,\n            lateCancellations: 8,\n            complementary: 5,\n            avgRevenuePerMember: 147.06,\n            avgRevenuePerSession: 500.00\n          }],\n          totalVisits: 150,\n          totalBookings: 180,\n          totalUniqueMembers: 85,\n          totalSessions: 25,\n          totalRevenue: 12500,\n          totalCapacity: 200,\n          avgFillRate: 75.5,\n          avgClassAvg: 6.0\n        }], \n        months: ['December 2024'], \n        totalsRow: { \n          product: 'TOTAL', \n          monthlyBreakdown: [{\n            month: 'December 2024',\n            visits: 150,\n            bookings: 180,\n            checkins: 150,\n            sessions: 25,\n            emptySessions: 2,\n            uniqueMembers: 85,\n            newMembers: 15,\n            returningMembers: 70,\n            revenue: 12500,\n            earnedRevenue: 11800,\n            unitsSold: 45,\n            classAvg: 6.0,\n            fillRate: 75.5,\n            capacity: 200,\n            lateCancellations: 8,\n            complementary: 5,\n            avgRevenuePerMember: 147.06,\n            avgRevenuePerSession: 500.00\n          }], \n          totalVisits: 150, \n          totalUniqueMembers: 85 \n        } \n      };\n    }\n    const grouped: Record<string, Record<string, {\n      visits: number;\n      bookings: number;\n      checkins: number;\n      sessions: Set<string>;\n      uniqueMembers: Set<string>;\n      newMembers: Set<string>;\n      returningMembers: Set<string>;\n      earnedRevenue: number;\n      capacity: number;\n      actualCheckins: number;\n      lateCancellations: number;\n      complementary: number;\n      allSessionIds: Set<string>;\n    }>> = {};\n    const monthsSet = new Set<string>();\n\n  // Process check-ins data\n  fd.forEach(item => {\n      // Determine grouping key based on selected option\n      let groupKey = '';\n      if (groupBy === 'product') {\n        groupKey = item.cleanedProduct || 'Unknown';\n      } else if (groupBy === 'category') {\n        groupKey = item.cleanedCategory || 'Unknown';\n      } else if (groupBy === 'teacher') {\n        groupKey = item.teacherName || 'Unknown';\n      } else if (groupBy === 'location') {\n        groupKey = item.location || 'Unknown';\n      } else if (groupBy === 'memberStatus') {\n        groupKey = item.isNew || 'Unknown';\n      }\n      \n      const monthYear = `${item.month} ${item.year}`;\n      \n      if (!grouped[groupKey]) grouped[groupKey] = {};\n      if (!grouped[groupKey][monthYear]) {\n        grouped[groupKey][monthYear] = {\n          visits: 0,\n          bookings: 0,\n          checkins: 0,\n          sessions: new Set(),\n          uniqueMembers: new Set(),\n          newMembers: new Set(),\n          returningMembers: new Set(),\n          earnedRevenue: 0,\n          capacity: 0,\n          actualCheckins: 0,\n          lateCancellations: 0,\n          complementary: 0,\n          allSessionIds: new Set()\n        };\n      }\n      \n      const monthData = grouped[groupKey][monthYear];\n      \n      // Count all metrics\n      monthData.bookings += 1; // Every row is a booking\n      \n      if (item.checkedIn) {\n        monthData.visits += 1;\n        monthData.checkins += 1;\n        monthData.actualCheckins += 1;\n        monthData.uniqueMembers.add(item.memberId);\n        \n        // Check if \"New\" appears in isNew column\n        if (item.isNew && item.isNew.toLowerCase().includes('new')) {\n          monthData.newMembers.add(item.memberId);\n        } else {\n          monthData.returningMembers.add(item.memberId);\n        }\n        \n        // Earned revenue from checked-in sessions\n        monthData.earnedRevenue += item.paid || 0;\n      }\n      \n      if (item.sessionId) {\n        monthData.allSessionIds.add(item.sessionId);\n      }\n      \n      if (item.isLateCancelled) {\n        monthData.lateCancellations += 1;\n      }\n      \n      // Complementary when paid = 0\n      if (item.paid === 0) {\n        monthData.complementary += 1;\n      }\n      \n      // Capacity - sum of all capacity values\n      monthData.capacity += item.capacity || 0;\n      \n      monthsSet.add(monthYear);\n    });\n\n  // Calculate sessions and empty sessions\n  fd.forEach(item => {\n      if (!item.sessionId) return;\n      \n      let groupKey = '';\n      if (groupBy === 'product') {\n        groupKey = item.cleanedProduct || 'Unknown';\n      } else if (groupBy === 'category') {\n        groupKey = item.cleanedCategory || 'Unknown';\n      } else if (groupBy === 'teacher') {\n        groupKey = item.teacherName || 'Unknown';\n      } else if (groupBy === 'location') {\n        groupKey = item.location || 'Unknown';\n      } else if (groupBy === 'memberStatus') {\n        groupKey = item.isNew || 'Unknown';\n      }\n      \n      const monthYear = `${item.month} ${item.year}`;\n      \n      if (grouped[groupKey] && grouped[groupKey][monthYear]) {\n        grouped[groupKey][monthYear].sessions.add(item.sessionId);\n      }\n    });\n\n  // Calculate revenue and units from sales data\n  const salesByMonth: Record<string, Record<string, { revenue: number; saleItemIds: Set<string> }>> = {};\n  sd.forEach(sale => {\n      // Extract month and year from paymentDate\n      const date = new Date(sale.paymentDate);\n      if (isNaN(date.getTime())) return; // Skip invalid dates\n      \n      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\n      const saleMonth = monthNames[date.getMonth()];\n      const saleYear = date.getFullYear();\n      const monthYear = `${saleMonth} ${saleYear}`;\n      \n      let groupKey = '';\n      if (groupBy === 'product') {\n        groupKey = sale.cleanedProduct || 'Unknown';\n      } else if (groupBy === 'category') {\n        groupKey = sale.cleanedCategory || 'Unknown';\n      } else if (groupBy === 'location') {\n        groupKey = sale.calculatedLocation || 'Unknown';\n      } else {\n        // For teacher and memberStatus, use 'All' as we don't have this in sales\n        groupKey = 'All';\n      }\n      \n      if (!salesByMonth[groupKey]) salesByMonth[groupKey] = {};\n      if (!salesByMonth[groupKey][monthYear]) {\n        salesByMonth[groupKey][monthYear] = { revenue: 0, saleItemIds: new Set() };\n      }\n      \n      salesByMonth[groupKey][monthYear].revenue += sale.paymentValue || 0;\n      // Track unique sale item IDs\n      if (sale.saleItemId) {\n        salesByMonth[groupKey][monthYear].saleItemIds.add(sale.saleItemId);\n      }\n    });\n\n    // Sort months chronologically\n    const months = Array.from(monthsSet).sort((a, b) => {\n      const parseMonth = (str: string) => {\n        const [month, year] = str.split(' ');\n        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\n        return new Date(parseInt(year), monthNames.indexOf(month), 1);\n      };\n      return parseMonth(b).getTime() - parseMonth(a).getTime();\n    });\n\n    // Convert to array and calculate totals\n    const products = Object.entries(grouped).map(([product, monthData]) => {\n      const monthlyBreakdown = months.map(month => {\n        const data = monthData[month];\n  const salesForMonth = salesByMonth[product]?.[month] || { revenue: 0, saleItemIds: new Set() };\n        \n        if (!data) {\n          return {\n            month,\n            visits: 0,\n            bookings: 0,\n            checkins: 0,\n            sessions: 0,\n            emptySessions: 0,\n            uniqueMembers: 0,\n            newMembers: 0,\n            returningMembers: 0,\n            revenue: salesForMonth.revenue,\n            earnedRevenue: 0,\n            unitsSold: salesForMonth.saleItemIds.size,\n            classAvg: 0,\n            fillRate: 0,\n            capacity: 0,\n            lateCancellations: 0,\n            complementary: 0,\n            avgRevenuePerMember: 0,\n            avgRevenuePerSession: 0\n          };\n        }\n        \n        const sessionsCount = data.sessions.size;\n        const classAvg = sessionsCount > 0 ? data.actualCheckins / sessionsCount : 0;\n        const fillRate = data.capacity > 0 ? (data.actualCheckins / data.capacity) * 100 : 0;\n        \n        // Empty sessions = sessions with no check-ins\n        const sessionsWithCheckins = new Set<string>();\n        fd.forEach(item => {\n          if (item.checkedIn && item.sessionId && `${item.month} ${item.year}` === month) {\n            sessionsWithCheckins.add(item.sessionId);\n          }\n        });\n        const emptySessions = Math.max(0, sessionsCount - sessionsWithCheckins.size);\n        \n        const avgRevenuePerMember = data.uniqueMembers.size > 0 ? salesForMonth.revenue / data.uniqueMembers.size : 0;\n        const avgRevenuePerSession = sessionsCount > 0 ? salesForMonth.revenue / sessionsCount : 0;\n        \n        return {\n          month,\n          visits: data.visits,\n          bookings: data.bookings,\n          checkins: data.checkins,\n          sessions: sessionsCount,\n          emptySessions,\n          uniqueMembers: data.uniqueMembers.size,\n          newMembers: data.newMembers.size,\n          returningMembers: data.returningMembers.size,\n          revenue: salesForMonth.revenue,\n          earnedRevenue: data.earnedRevenue,\n          unitsSold: salesForMonth.saleItemIds.size,\n          classAvg,\n          fillRate,\n          capacity: data.capacity,\n          lateCancellations: data.lateCancellations,\n          complementary: data.complementary,\n          avgRevenuePerMember,\n          avgRevenuePerSession\n        };\n      });\n\n      // Calculate totals\n      const totalVisits = monthlyBreakdown.reduce((sum, m) => sum + m.visits, 0);\n      const totalBookings = monthlyBreakdown.reduce((sum, m) => sum + m.bookings, 0);\n      const totalSessions = monthlyBreakdown.reduce((sum, m) => sum + m.sessions, 0);\n      const totalRevenue = monthlyBreakdown.reduce((sum, m) => sum + m.revenue, 0);\n      const totalCapacity = monthlyBreakdown.reduce((sum, m) => sum + m.capacity, 0);\n      const totalCheckins = monthlyBreakdown.reduce((sum, m) => sum + m.checkins, 0);\n      \n      const allUniqueMembers = new Set<string>();\n      Object.values(monthData).forEach(d => {\n        d.uniqueMembers.forEach(id => allUniqueMembers.add(id));\n      });\n\n      return {\n        product,\n        monthlyBreakdown,\n        totalVisits,\n        totalBookings,\n        totalUniqueMembers: allUniqueMembers.size,\n        totalSessions,\n        totalRevenue,\n        totalCapacity,\n        avgFillRate: totalCapacity > 0 ? (totalCheckins / totalCapacity) * 100 : 0,\n        avgClassAvg: totalSessions > 0 ? totalCheckins / totalSessions : 0\n      };\n    }).sort((a, b) => b.totalVisits - a.totalVisits);\n\n    // Calculate totals row\n  const totalsRow = {\n      product: 'TOTAL',\n      monthlyBreakdown: months.map(month => {\n        const allData = {\n          visits: 0,\n          bookings: 0,\n          checkins: 0,\n          sessions: new Set<string>(),\n          capacity: 0,\n          uniqueMembers: new Set<string>(),\n          newMembers: new Set<string>(),\n          returningMembers: new Set<string>(),\n          earnedRevenue: 0,\n          lateCancellations: 0,\n          complementary: 0,\n          actualCheckins: 0\n        };\n        \n  fd.forEach(item => {\n          if (`${item.month} ${item.year}` === month) {\n            allData.bookings += 1;\n            \n            if (item.checkedIn) {\n              allData.visits += 1;\n              allData.checkins += 1;\n              allData.actualCheckins += 1;\n              allData.uniqueMembers.add(item.memberId);\n              \n              if (item.isNew && item.isNew.toLowerCase().includes('new')) {\n                allData.newMembers.add(item.memberId);\n              } else {\n                allData.returningMembers.add(item.memberId);\n              }\n              \n              allData.earnedRevenue += item.paid || 0;\n            }\n            \n            if (item.sessionId) {\n              allData.sessions.add(item.sessionId);\n            }\n            \n            if (item.isLateCancelled) {\n              allData.lateCancellations += 1;\n            }\n            \n            if (item.paid === 0) {\n              allData.complementary += 1;\n            }\n            \n            allData.capacity += item.capacity || 0;\n          }\n        });\n        \n  // Calculate sales totals for this month\n  let monthRevenue = 0;\n  const monthSaleItemIds = new Set<string>();\n  sd.forEach(sale => {\n          const date = new Date(sale.paymentDate);\n          if (isNaN(date.getTime())) return;\n          \n          const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\n          const saleMonth = monthNames[date.getMonth()];\n          const saleYear = date.getFullYear();\n          \n          if (`${saleMonth} ${saleYear}` === month) {\n            monthRevenue += sale.paymentValue || 0;\n            // Track unique sale item IDs\n            if (sale.saleItemId) {\n              monthSaleItemIds.add(sale.saleItemId);\n            }\n          }\n        });\n        \n        const sessionsCount = allData.sessions.size;\n        const classAvg = sessionsCount > 0 ? allData.actualCheckins / sessionsCount : 0;\n        const fillRate = allData.capacity > 0 ? (allData.actualCheckins / allData.capacity) * 100 : 0;\n        \n        // Empty sessions for totals\n        const sessionsWithCheckins = new Set<string>();\n        filteredData.forEach(item => {\n          if (item.checkedIn && item.sessionId && `${item.month} ${item.year}` === month) {\n            sessionsWithCheckins.add(item.sessionId);\n          }\n        });\n        const emptySessions = Math.max(0, sessionsCount - sessionsWithCheckins.size);\n        \n        const avgRevenuePerMember = allData.uniqueMembers.size > 0 ? monthRevenue / allData.uniqueMembers.size : 0;\n        const avgRevenuePerSession = sessionsCount > 0 ? monthRevenue / sessionsCount : 0;\n        \n        return {\n          month,\n          visits: allData.visits,\n          bookings: allData.bookings,\n          checkins: allData.checkins,\n          sessions: sessionsCount,\n          emptySessions,\n          uniqueMembers: allData.uniqueMembers.size,\n          newMembers: allData.newMembers.size,\n          returningMembers: allData.returningMembers.size,\n          revenue: monthRevenue,\n          earnedRevenue: allData.earnedRevenue,\n          unitsSold: monthSaleItemIds.size,\n          classAvg,\n          fillRate,\n          capacity: allData.capacity,\n          lateCancellations: allData.lateCancellations,\n          complementary: allData.complementary,\n          avgRevenuePerMember,\n          avgRevenuePerSession\n        };\n      }),\n      totalVisits: products.reduce((sum, p) => sum + p.totalVisits, 0),\n      totalUniqueMembers: new Set(fd.filter(d => d.checkedIn).map(d => d.memberId)).size\n    };\n\n    return { products, months, totalsRow };\n  }, [deferredFilteredData, groupBy, deferredSalesData]);\n\n  // Get enhanced copy context with filters and metrics (after monthlyProductData is available)\n  const { contextInfo } = useTableCopyContext({\n    selectedMetric: METRICS.find(m => m.id === selectedMetric)?.label,\n    additionalInfo: {\n      groupBy: `${groupBy.charAt(0).toUpperCase() + groupBy.slice(1)}`,\n      totalProducts: monthlyProductData?.products?.length || 0,\n      totalMonths: monthlyProductData?.months?.length || 0\n    }\n  });\n\n  // Custom function to get ALL metric tables data - placed after monthlyProductData\n  const getAllMetricTablesText = React.useCallback(async () => {\n    let allText = '';\n    \n    // For each metric, generate the table data\n    METRICS.forEach((metric) => {\n      allText += `\\n\\n${'='.repeat(80)}\\n`;\n      allText += `${metric.label} by ${groupBy.charAt(0).toUpperCase() + groupBy.slice(1)} - Month on Month\\n`;\n      allText += `${'='.repeat(80)}\\n\\n`;\n      \n      // Headers\n      const headers = [groupBy.charAt(0).toUpperCase() + groupBy.slice(1), ...monthlyProductData.months, 'Total', 'Average'];\n      allText += headers.join('\\t') + '\\n';\n      allText += headers.map(() => '---').join('\\t') + '\\n';\n      \n      // Data rows\n      monthlyProductData.products.forEach(productItem => {\n        const row = [productItem.product];\n        let totalValue = 0;\n        let monthCount = 0;\n        \n        monthlyProductData.months.forEach(month => {\n          const monthData = productItem.monthlyBreakdown.find(m => m.month === month);\n          let value = 0;\n          \n          if (monthData) {\n            switch (metric.id) {\n              case 'visits': value = monthData.visits; break;\n              case 'bookings': value = monthData.bookings; break;\n              case 'checkins': value = monthData.checkins; break;\n              case 'sessions': value = monthData.sessions; break;\n              case 'emptySessions': value = monthData.emptySessions; break;\n              case 'uniqueMembers': value = monthData.uniqueMembers; break;\n              case 'newMembers': value = monthData.newMembers; break;\n              case 'returningMembers': value = monthData.returningMembers; break;\n              case 'revenue': value = monthData.revenue; break;\n              case 'earnedRevenue': value = monthData.earnedRevenue; break;\n              case 'unitsSold': value = monthData.unitsSold; break;\n              case 'classAvg': value = monthData.classAvg; break;\n              case 'fillRate': value = monthData.fillRate; break;\n              case 'capacity': value = monthData.capacity; break;\n              case 'lateCancellations': value = monthData.lateCancellations; break;\n              case 'complementary': value = monthData.complementary; break;\n              case 'avgRevenuePerMember': value = monthData.avgRevenuePerMember; break;\n              case 'avgRevenuePerSession': value = monthData.avgRevenuePerSession; break;\n            }\n            totalValue += value;\n            monthCount++;\n          }\n          \n          // Format value based on metric type\n          let formattedValue = '-';\n          if (value > 0) {\n            switch (metric.format) {\n              case 'currency': formattedValue = formatRevenue(value); break;\n              case 'percentage': formattedValue = `${value.toFixed(1)}%`; break;\n              case 'decimal': formattedValue = value.toFixed(2); break;\n              default: formattedValue = formatNumber(value); break;\n            }\n          }\n          row.push(formattedValue);\n        });\n        \n        // Add total and average\n        const formattedTotal = metric.format === 'currency' ? formatRevenue(totalValue) :\n                              metric.format === 'percentage' ? `${totalValue.toFixed(1)}%` :\n                              metric.format === 'decimal' ? totalValue.toFixed(2) :\n                              formatNumber(totalValue);\n        const avgValue = monthCount > 0 ? totalValue / monthCount : 0;\n        const formattedAvg = metric.format === 'currency' ? formatRevenue(avgValue) :\n                            metric.format === 'percentage' ? `${avgValue.toFixed(1)}%` :\n                            metric.format === 'decimal' ? avgValue.toFixed(2) :\n                            formatNumber(avgValue);\n        \n        row.push(formattedTotal, formattedAvg);\n        allText += row.join('\\t') + '\\n';\n      });\n    });\n    \n    return allText;\n  }, [monthlyProductData, groupBy, METRICS]);\n\n  const toggleProductExpansion = (product: string) => {\n    const newExpanded = new Set(expandedRows);\n    if (newExpanded.has(product)) {\n      newExpanded.delete(product);\n    } else {\n      newExpanded.add(product);\n    }\n    setExpandedRows(newExpanded);\n  };\n\n  // Calculate visit frequency buckets (monthly check-ins per member) - TABULAR FORMAT WITH MONTH FILTER\n  const visitFrequencyData = useMemo(() => {\n    // Group by selected dimension (product, category, teacher, or class) and month\n    const breakdownData: Record<string, Record<string, Record<string, number>>> = {};\n    \n  deferredFilteredData.forEach(item => {\n      if (!item.checkedIn) return;\n      \n      let breakdownKey = '';\n      if (frequencyBreakdownBy === 'product') {\n        breakdownKey = item.cleanedProduct || 'Unknown';\n      } else if (frequencyBreakdownBy === 'category') {\n        breakdownKey = item.cleanedCategory || 'Unknown';\n      } else if (frequencyBreakdownBy === 'teacher') {\n        breakdownKey = item.teacherName || 'Unknown';\n      } else if (frequencyBreakdownBy === 'class') {\n        breakdownKey = item.cleanedClass || 'Unknown';\n      }\n      \n      const monthYear = `${item.month}-${item.year}`;\n      const memberKey = `${item.memberId}_${monthYear}`;\n      \n      if (!breakdownData[breakdownKey]) {\n        breakdownData[breakdownKey] = {};\n      }\n      if (!breakdownData[breakdownKey][monthYear]) {\n        breakdownData[breakdownKey][monthYear] = {};\n      }\n      breakdownData[breakdownKey][monthYear][memberKey] = (breakdownData[breakdownKey][monthYear][memberKey] || 0) + 1;\n    });\n\n    // Calculate buckets for each breakdown item by month\n    const result: Record<string, Record<string, Record<string, number>>> = {};\n    \n    Object.entries(breakdownData).forEach(([key, monthData]) => {\n      result[key] = {};\n      \n      Object.entries(monthData).forEach(([month, memberData]) => {\n        const buckets = {\n          '1 class': 0,\n          '2-5 classes': 0,\n          '6-10 classes': 0,\n          '11-15 classes': 0,\n          '16-20 classes': 0,\n          '21-25 classes': 0,\n          '>25 classes': 0\n        };\n\n        Object.values(memberData).forEach(count => {\n          if (count === 1) buckets['1 class']++;\n          else if (count >= 2 && count <= 5) buckets['2-5 classes']++;\n          else if (count >= 6 && count <= 10) buckets['6-10 classes']++;\n          else if (count >= 11 && count <= 15) buckets['11-15 classes']++;\n          else if (count >= 16 && count <= 20) buckets['16-20 classes']++;\n          else if (count >= 21 && count <= 25) buckets['21-25 classes']++;\n          else if (count > 25) buckets['>25 classes']++;\n        });\n\n        result[key][month] = buckets;\n      });\n    });\n\n    return result;\n  }, [deferredFilteredData, frequencyBreakdownBy]);\n\n  // Calculate late cancellation frequency buckets - TABULAR FORMAT WITH MONTH FILTER\n  const lateCancellationFrequencyData = useMemo(() => {\n    // Group by selected dimension (product, category, teacher, or class) and month\n    const breakdownData: Record<string, Record<string, Record<string, number>>> = {};\n    \n  deferredFilteredData.forEach(item => {\n      if (!item.isLateCancelled) return;\n      \n      let breakdownKey = '';\n      if (cancellationBreakdownBy === 'product') {\n        breakdownKey = item.cleanedProduct || 'Unknown';\n      } else if (cancellationBreakdownBy === 'category') {\n        breakdownKey = item.cleanedCategory || 'Unknown';\n      } else if (cancellationBreakdownBy === 'teacher') {\n        breakdownKey = item.teacherName || 'Unknown';\n      } else if (cancellationBreakdownBy === 'class') {\n        breakdownKey = item.cleanedClass || 'Unknown';\n      }\n      \n      const monthYear = `${item.month}-${item.year}`;\n      const memberKey = `${item.memberId}_${monthYear}`;\n      \n      if (!breakdownData[breakdownKey]) {\n        breakdownData[breakdownKey] = {};\n      }\n      if (!breakdownData[breakdownKey][monthYear]) {\n        breakdownData[breakdownKey][monthYear] = {};\n      }\n      breakdownData[breakdownKey][monthYear][memberKey] = (breakdownData[breakdownKey][monthYear][memberKey] || 0) + 1;\n    });\n\n    // Calculate buckets for each breakdown item by month\n    const result: Record<string, Record<string, Record<string, number>>> = {};\n    \n    Object.entries(breakdownData).forEach(([key, monthData]) => {\n      result[key] = {};\n      \n      Object.entries(monthData).forEach(([month, memberData]) => {\n        const buckets = {\n          '1 cancellation': 0,\n          '2-5 cancellations': 0,\n          '6-10 cancellations': 0,\n          '11-15 cancellations': 0,\n          '16-20 cancellations': 0,\n          '21-25 cancellations': 0,\n          '>25 cancellations': 0\n        };\n\n        Object.values(memberData).forEach(count => {\n          if (count === 1) buckets['1 cancellation']++;\n          else if (count >= 2 && count <= 5) buckets['2-5 cancellations']++;\n          else if (count >= 6 && count <= 10) buckets['6-10 cancellations']++;\n          else if (count >= 11 && count <= 15) buckets['11-15 cancellations']++;\n          else if (count >= 16 && count <= 20) buckets['16-20 cancellations']++;\n          else if (count >= 21 && count <= 25) buckets['21-25 cancellations']++;\n          else if (count > 25) buckets['>25 cancellations']++;\n        });\n\n        result[key][month] = buckets;\n      });\n    });\n\n    return result;\n  }, [deferredFilteredData, cancellationBreakdownBy]);\n\n  // Calculate multiple classes per day\n  const multipleClassesPerDay = useMemo(() => {\n    const dailyCheckins: Record<string, Record<string, number>> = {};\n    \n    filteredData.forEach(item => {\n      if (!item.checkedIn) return;\n      const date = item.dateIST || '';\n      \n      if (!dailyCheckins[item.memberId]) {\n        dailyCheckins[item.memberId] = {};\n      }\n      dailyCheckins[item.memberId][date] = (dailyCheckins[item.memberId][date] || 0) + 1;\n    });\n\n    let membersWithMultipleClasses = 0;\n    let totalMultipleClassDays = 0;\n\n    Object.values(dailyCheckins).forEach(memberDates => {\n      const daysWithMultiple = Object.values(memberDates).filter(count => count > 1).length;\n      if (daysWithMultiple > 0) {\n        membersWithMultipleClasses++;\n        totalMultipleClassDays += daysWithMultiple;\n      }\n    });\n\n    return {\n      membersWithMultipleClasses,\n      totalMultipleClassDays,\n      avgMultipleClassDays: membersWithMultipleClasses > 0 ? (totalMultipleClassDays / membersWithMultipleClasses).toFixed(1) : '0'\n    };\n  }, [filteredData]);\n\n  const getChangePercentage = (current: number, previous: number) => {\n    if (previous === 0) return current > 0 ? 100 : 0;\n    return ((current - previous) / previous) * 100;\n  };\n\n  if (loading) {\n    return null; // Global loader handles this\n  }\n\n  if (error) {\n    return (\n      <GlobalFiltersProvider>\n        <div className=\"min-h-screen bg-white relative overflow-hidden\">\n          <div className=\"absolute inset-0 overflow-hidden\">\n            <div className=\"absolute top-20 left-10 w-96 h-96 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-full floating-animation stagger-1\"></div>\n            <div className=\"absolute bottom-20 right-10 w-80 h-80 bg-gradient-to-r from-indigo-500/10 to-purple-500/10 rounded-full floating-animation stagger-3\"></div>\n          </div>\n          \n          <div className=\"relative z-10\">\n            <div style={{ ['--hero-accent' as any]: heroColor }}>\n              <SalesMotionHero\n                title=\"Patterns & Trends\"\n                subtitle=\"Member behavior and visit analytics across all studio locations\"\n                primaryAction={{ label: 'Back to Dashboard', onClick: () => navigate('/') }}\n                compact\n                onColorChange={setHeroColor}\n              />\n            </div>\n            \n            <div className=\"container mx-auto px-6 py-10\">\n              <div className=\"bg-red-50 border border-red-200 text-red-800 p-6 rounded-2xl shadow-sm\">\n                <div className=\"font-semibold text-lg mb-1\">Failed to load patterns data</div>\n                <div className=\"text-sm opacity-90\">{error}</div>\n              </div>\n            </div>\n          </div>\n          <Footer />\n        </div>\n      </GlobalFiltersProvider>\n    );\n  }\n\n  return (\n    <GlobalFiltersProvider>\n      <div className=\"min-h-screen bg-white relative overflow-hidden\">\n        {/* Enhanced Background Elements */}\n        <div className=\"absolute inset-0 overflow-hidden\">\n          <div className=\"absolute top-20 left-10 w-96 h-96 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-full floating-animation stagger-1\"></div>\n          <div className=\"absolute bottom-20 right-10 w-80 h-80 bg-gradient-to-r from-indigo-500/10 to-purple-500/10 rounded-full floating-animation stagger-3\"></div>\n          <div className=\"absolute top-1/2 left-1/3 w-72 h-72 bg-gradient-to-r from-cyan-500/10 to-teal-500/10 rounded-full morph-shape stagger-2\"></div>\n        </div>\n        \n        <div className=\"relative z-10\">\n          <div className=\"bg-white text-slate-800 slide-in-from-left\">\n            {/* Hero Section */}\n            <div style={{ ['--hero-accent' as any]: heroColor }}>\n              <SalesMotionHero\n                title=\"Patterns & Trends\"\n                subtitle=\"Member behavior and visit analytics across all studio locations\"\n                metrics={[\n                  {\n                    label: 'Total Visits',\n                    value: formatNumber(filteredLocationData?.filter(item => item.checkedIn).length || 0),\n                    change: '+12.5%'\n                  },\n                  {\n                    label: 'Unique Members',\n                    value: formatNumber(new Set(filteredLocationData?.map(item => item.memberId) || []).size),\n                    change: '+8.3%'\n                  },\n                  {\n                    label: 'Sessions Held',\n                    value: formatNumber(new Set(filteredLocationData?.map(item => item.sessionId) || []).size),\n                    change: '+15.2%'\n                  }\n                ]}\n                primaryAction={{ label: 'View Dashboard', onClick: () => navigate('/') }}\n                secondaryAction={{ label: 'Export Data', onClick: () => {} }}\n                compact\n                onColorChange={setHeroColor}\n              />\n            </div>\n\n            <div className=\"container mx-auto px-6 py-8 space-y-8\">\n              {/* Location Tabs */}\n              <StudioLocationTabs \n                activeLocation={selectedLocation === 'All Locations' ? 'all' : \n                  selectedLocation.toLowerCase().includes('kwality') ? 'kwality' : \n                  selectedLocation.toLowerCase().includes('supreme') ? 'supreme' : \n                  selectedLocation.toLowerCase().includes('kenkere') ? 'kenkere' : 'all'}\n                onLocationChange={(locationId) => {\n                  const locationMap: Record<string, string> = {\n                    'all': 'All Locations',\n                    'kwality': 'Kwality House, Kemps Corner',\n                    'supreme': 'Supreme HQ, Bandra',\n                    'kenkere': 'Kenkere House'\n                  };\n                  setSelectedLocation(locationMap[locationId] || 'All Locations');\n                }}\n                showInfoPopover={true}\n                infoPopoverContext=\"patterns-trends-overview\"\n              />\n\n              {/* Filter Section */}\n              <Card className=\"border-0 shadow-lg bg-white/80 backdrop-blur-sm rounded-2xl\">\n                <CardHeader className=\"pb-4 border-b border-slate-100\">\n                  <div className=\"flex items-center justify-between cursor-pointer\" onClick={() => setIsFiltersCollapsed(!isFiltersCollapsed)}>\n                    <CardTitle className=\"text-lg font-semibold text-slate-800 flex items-center gap-2\">\n                      {isFiltersCollapsed ? <ChevronRight className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n                      Filters & Options\n                    </CardTitle>\n                    <div className=\"flex items-center gap-2\">\n                      {(selectedProducts.length + selectedCategories.length + selectedTeachers.length + selectedMemberStatus.length + selectedMonths.length) > 0 && (\n                        <Badge className=\"bg-indigo-600 text-white hover:bg-indigo-700\">\n                          {selectedProducts.length + selectedCategories.length + selectedTeachers.length + selectedMemberStatus.length + selectedMonths.length} active\n                        </Badge>\n                      )}\n                      <Badge variant=\"outline\" className=\"text-xs text-slate-500\">\n                        {isFiltersCollapsed ? 'Click to expand' : 'Click to collapse'}\n                      </Badge>\n                    </div>\n                  </div>\n                </CardHeader>\n          {!isFiltersCollapsed && (\n            <CardContent className=\"space-y-6\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {/* Products Filter */}\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-semibold text-slate-700 flex items-center gap-2\">\n                    <BarChart3 className=\"w-4 h-4 text-indigo-600\" />\n                    Products\n                  </label>\n                  <div className=\"max-h-48 overflow-y-auto border border-slate-200 rounded-lg p-2 bg-white\">\n                    <div className=\"space-y-1\">\n                      {filterOptions.products.map(product => (\n                        <label key={product} className=\"flex items-center gap-2 p-2 hover:bg-slate-50 rounded cursor-pointer\">\n                          <input\n                            type=\"checkbox\"\n                            checked={selectedProducts.includes(product)}\n                            onChange={(e) => {\n                              if (e.target.checked) {\n                                setSelectedProducts([...selectedProducts, product]);\n                              } else {\n                                setSelectedProducts(selectedProducts.filter(p => p !== product));\n                              }\n                            }}\n                            className=\"rounded border-slate-300 text-indigo-600 focus:ring-indigo-500\"\n                          />\n                          <span className=\"text-sm text-slate-700\">{product}</span>\n                        </label>\n                      ))}\n                    </div>\n                  </div>\n                  {selectedProducts.length > 0 && (\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => setSelectedProducts([])}\n                      className=\"text-xs text-slate-600 hover:text-slate-900\"\n                    >\n                      Clear all\n                    </Button>\n                  )}\n                </div>\n\n                {/* Categories Filter */}\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-semibold text-slate-700 flex items-center gap-2\">\n                    <TrendingUp className=\"w-4 h-4 text-purple-600\" />\n                    Categories\n                  </label>\n                  <div className=\"max-h-48 overflow-y-auto border border-slate-200 rounded-lg p-2 bg-white\">\n                    <div className=\"space-y-1\">\n                      {filterOptions.categories.map(category => (\n                        <label key={category} className=\"flex items-center gap-2 p-2 hover:bg-slate-50 rounded cursor-pointer\">\n                          <input\n                            type=\"checkbox\"\n                            checked={selectedCategories.includes(category)}\n                            onChange={(e) => {\n                              if (e.target.checked) {\n                                setSelectedCategories([...selectedCategories, category]);\n                              } else {\n                                setSelectedCategories(selectedCategories.filter(c => c !== category));\n                              }\n                            }}\n                            className=\"rounded border-slate-300 text-purple-600 focus:ring-purple-500\"\n                          />\n                          <span className=\"text-sm text-slate-700\">{category}</span>\n                        </label>\n                      ))}\n                    </div>\n                  </div>\n                  {selectedCategories.length > 0 && (\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => setSelectedCategories([])}\n                      className=\"text-xs text-slate-600 hover:text-slate-900\"\n                    >\n                      Clear all\n                    </Button>\n                  )}\n                </div>\n\n                {/* Teachers Filter */}\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-semibold text-slate-700 flex items-center gap-2\">\n                    <Users className=\"w-4 h-4 text-pink-600\" />\n                    Teachers\n                  </label>\n                  <div className=\"max-h-48 overflow-y-auto border border-slate-200 rounded-lg p-2 bg-white\">\n                    <div className=\"space-y-1\">\n                      {filterOptions.teachers.map(teacher => (\n                        <label key={teacher} className=\"flex items-center gap-2 p-2 hover:bg-slate-50 rounded cursor-pointer\">\n                          <input\n                            type=\"checkbox\"\n                            checked={selectedTeachers.includes(teacher)}\n                            onChange={(e) => {\n                              if (e.target.checked) {\n                                setSelectedTeachers([...selectedTeachers, teacher]);\n                              } else {\n                                setSelectedTeachers(selectedTeachers.filter(t => t !== teacher));\n                              }\n                            }}\n                            className=\"rounded border-slate-300 text-pink-600 focus:ring-pink-500\"\n                          />\n                          <span className=\"text-sm text-slate-700\">{teacher}</span>\n                        </label>\n                      ))}\n                    </div>\n                  </div>\n                  {selectedTeachers.length > 0 && (\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => setSelectedTeachers([])}\n                      className=\"text-xs text-slate-600 hover:text-slate-900\"\n                    >\n                      Clear all\n                    </Button>\n                  )}\n                </div>\n\n                {/* Member Status Filter */}\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-semibold text-slate-700 flex items-center gap-2\">\n                    <Users className=\"w-4 h-4 text-emerald-600\" />\n                    Member Status\n                  </label>\n                  <div className=\"max-h-48 overflow-y-auto border border-slate-200 rounded-lg p-2 bg-white\">\n                    <div className=\"space-y-1\">\n                      {filterOptions.memberStatuses.map(status => (\n                        <label key={status} className=\"flex items-center gap-2 p-2 hover:bg-slate-50 rounded cursor-pointer\">\n                          <input\n                            type=\"checkbox\"\n                            checked={selectedMemberStatus.includes(status)}\n                            onChange={(e) => {\n                              if (e.target.checked) {\n                                setSelectedMemberStatus([...selectedMemberStatus, status]);\n                              } else {\n                                setSelectedMemberStatus(selectedMemberStatus.filter(s => s !== status));\n                              }\n                            }}\n                            className=\"rounded border-slate-300 text-emerald-600 focus:ring-emerald-500\"\n                          />\n                          <span className=\"text-sm text-slate-700\">{status}</span>\n                        </label>\n                      ))}\n                    </div>\n                  </div>\n                  {selectedMemberStatus.length > 0 && (\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => setSelectedMemberStatus([])}\n                      className=\"text-xs text-slate-600 hover:text-slate-900\"\n                    >\n                      Clear all\n                    </Button>\n                  )}\n                </div>\n\n                {/* Months Filter */}\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-semibold text-slate-700 flex items-center gap-2\">\n                    <Calendar className=\"w-4 h-4 text-blue-600\" />\n                    Months\n                  </label>\n                  <div className=\"max-h-48 overflow-y-auto border border-slate-200 rounded-lg p-2 bg-white\">\n                    <div className=\"space-y-1\">\n                      {filterOptions.months.map(month => (\n                        <label key={month} className=\"flex items-center gap-2 p-2 hover:bg-slate-50 rounded cursor-pointer\">\n                          <input\n                            type=\"checkbox\"\n                            checked={selectedMonths.includes(month)}\n                            onChange={(e) => {\n                              if (e.target.checked) {\n                                setSelectedMonths([...selectedMonths, month]);\n                              } else {\n                                setSelectedMonths(selectedMonths.filter(m => m !== month));\n                              }\n                            }}\n                            className=\"rounded border-slate-300 text-blue-600 focus:ring-blue-500\"\n                          />\n                          <span className=\"text-sm text-slate-700\">{month}</span>\n                        </label>\n                      ))}\n                    </div>\n                  </div>\n                  {selectedMonths.length > 0 && (\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => setSelectedMonths([])}\n                      className=\"text-xs text-slate-600 hover:text-slate-900\"\n                    >\n                      Clear all\n                    </Button>\n                  )}\n                </div>\n              </div>\n\n              {/* Clear All Filters */}\n              {(selectedProducts.length + selectedCategories.length + selectedTeachers.length + selectedMemberStatus.length + selectedMonths.length) > 0 && (\n                <div className=\"flex justify-end pt-4 border-t border-slate-200\">\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => {\n                      setSelectedProducts([]);\n                      setSelectedCategories([]);\n                      setSelectedTeachers([]);\n                      setSelectedMemberStatus([]);\n                      setSelectedMonths([]);\n                    }}\n                    className=\"text-slate-700 hover:bg-slate-100\"\n                  >\n                    Clear All Filters\n                  </Button>\n                </div>\n              )}\n            </CardContent>\n          )}\n        </Card>\n\n        {/* Grouping Options */}\n        <Card className=\"glass-card modern-card-hover rounded-2xl\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-lg font-semibold text-slate-800 flex items-center gap-2\">\n              <LayoutGrid className=\"w-5 h-5 text-indigo-600\" />\n              Group Data By\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex gap-2\">\n              <Button\n                variant={groupBy === 'product' ? 'default' : 'outline'}\n                onClick={() => {\n                  setGroupBy('product');\n                  setExpandedRows(new Set());\n                }}\n                className={cn(\n                  \"flex items-center gap-2\",\n                  groupBy === 'product' ? 'bg-indigo-600 hover:bg-indigo-700' : ''\n                )}\n              >\n                <BarChart3 className=\"w-4 h-4\" />\n                Product\n              </Button>\n              <Button\n                variant={groupBy === 'category' ? 'default' : 'outline'}\n                onClick={() => {\n                  setGroupBy('category');\n                  setExpandedRows(new Set());\n                }}\n                className={cn(\n                  \"flex items-center gap-2\",\n                  groupBy === 'category' ? 'bg-purple-600 hover:bg-purple-700' : ''\n                )}\n              >\n                <Grid3x3 className=\"w-4 h-4\" />\n                Category\n              </Button>\n              <Button\n                variant={groupBy === 'teacher' ? 'default' : 'outline'}\n                onClick={() => {\n                  setGroupBy('teacher');\n                  setExpandedRows(new Set());\n                }}\n                className={cn(\n                  \"flex items-center gap-2\",\n                  groupBy === 'teacher' ? 'bg-pink-600 hover:bg-pink-700' : ''\n                )}\n              >\n                <Users className=\"w-4 h-4\" />\n                Teacher\n              </Button>\n              <Button\n                variant={groupBy === 'location' ? 'default' : 'outline'}\n                onClick={() => {\n                  setGroupBy('location');\n                  setExpandedRows(new Set());\n                }}\n                className={cn(\n                  \"flex items-center gap-2\",\n                  groupBy === 'location' ? 'bg-indigo-600 hover:bg-indigo-700' : ''\n                )}\n              >\n                <LayoutGrid className=\"w-4 h-4\" />\n                Location\n              </Button>\n              <Button\n                variant={groupBy === 'memberStatus' ? 'default' : 'outline'}\n                onClick={() => {\n                  setGroupBy('memberStatus');\n                  setExpandedRows(new Set());\n                }}\n                className={cn(\n                  \"flex items-center gap-2\",\n                  groupBy === 'memberStatus' ? 'bg-emerald-600 hover:bg-emerald-700' : ''\n                )}\n              >\n                <UserCheck className=\"w-4 h-4\" />\n                Member Status\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Metric Selector */}\n        <Card className=\"glass-card modern-card-hover rounded-2xl\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-lg font-semibold text-slate-800 flex items-center gap-2\">\n              <Target className=\"w-5 h-5 text-indigo-600\" />\n              Select Metric to Analyze\n            </CardTitle>\n            <p className=\"text-sm text-slate-600 mt-1\">\n              Choose from 17 different metrics to view in the month-on-month breakdown\n            </p>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-2\">\n              {METRICS.map((metric) => {\n                const Icon = metric.icon;\n                const isSelected = selectedMetric === metric.id;\n                return (\n                  <Button\n                    key={metric.id}\n                    variant={isSelected ? 'default' : 'outline'}\n                    onClick={() => setSelectedMetric(metric.id)}\n                    className={cn(\n                      \"flex flex-col items-center gap-1.5 h-auto py-3 px-2 text-center transition-all\",\n                      isSelected \n                        ? `${metric.color.replace('text-', 'bg-')} hover:opacity-90 text-white border-transparent` \n                        : `hover:${metric.color.replace('text-', 'bg-')}/10 ${metric.color} border-slate-200 hover:border-current`\n                    )}\n                    title={metric.description}\n                  >\n                    <Icon className={cn(\"w-5 h-5\", isSelected ? \"text-white\" : metric.color)} />\n                    <span className=\"text-xs font-medium leading-tight\">{metric.label}</span>\n                  </Button>\n                );\n              })}\n            </div>\n            <div className=\"mt-4 p-3 bg-indigo-50 border border-indigo-200 rounded-lg\">\n              <p className=\"text-sm text-indigo-900\">\n                <span className=\"font-semibold\">Currently viewing: </span>\n                {METRICS.find(m => m.id === selectedMetric)?.description}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Analysis Sections - Organized by Tabs */}\n        <Tabs defaultValue=\"month-on-month\" className=\"w-full space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-5 h-auto p-1 bg-gradient-to-r from-indigo-100 via-purple-100 to-indigo-100 rounded-xl shadow-lg\">\n            <TabsTrigger \n              value=\"month-on-month\" \n              className=\"data-[state=active]:bg-gradient-to-r data-[state=active]:from-indigo-600 data-[state=active]:to-purple-600 data-[state=active]:text-white py-3 px-4 font-semibold text-sm transition-all flex items-center justify-center\"\n            >\n              <Calendar className=\"w-4 h-4 mr-2\" />\n              Month Analysis\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"visit-frequency\" \n              className=\"data-[state=active]:bg-gradient-to-r data-[state=active]:from-indigo-600 data-[state=active]:to-purple-600 data-[state=active]:text-white py-3 px-4 font-semibold text-sm transition-all flex items-center justify-center\"\n            >\n              <Activity className=\"w-4 h-4 mr-2\" />\n              Visit Frequency\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"cancellations\" \n              className=\"data-[state=active]:bg-gradient-to-r data-[state=active]:from-indigo-600 data-[state=active]:to-purple-600 data-[state=active]:text-white py-3 px-4 font-semibold text-sm transition-all flex items-center justify-center\"\n            >\n              <AlertCircle className=\"w-4 h-4 mr-2\" />\n              Cancellations\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"multiple-classes\" \n              className=\"data-[state=active]:bg-gradient-to-r data-[state=active]:from-indigo-600 data-[state=active]:to-purple-600 data-[state=active]:text-white py-3 px-4 font-semibold text-sm transition-all flex items-center justify-center\"\n            >\n              <Users className=\"w-4 h-4 mr-2\" />\n              Multiple Classes\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"member-behavior\" \n              className=\"data-[state=active]:bg-gradient-to-r data-[state=active]:from-indigo-600 data-[state=active]:to-purple-600 data-[state=active]:text-white py-3 px-4 font-semibold text-sm transition-all flex items-center justify-center\"\n            >\n              <BarChart3 className=\"w-4 h-4 mr-2\" />\n              Member Behavior\n            </TabsTrigger>\n          </TabsList>\n\n          {/* Month-on-Month Analysis Tab Content */}\n          <TabsContent value=\"month-on-month\" className=\"mt-6 space-y-6\">\n        {/* Month-on-Month Product Breakdown Table */}\n        <Card className=\"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl\">\n          <CardHeader className=\"pb-4 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white rounded-t-lg\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <Calendar className=\"w-6 h-6\" />\n                <CardTitle className=\"text-xl font-bold\">\n                  {METRICS.find(m => m.id === selectedMetric)?.label} by {groupBy.charAt(0).toUpperCase() + groupBy.slice(1)} - Month on Month\n                </CardTitle>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Badge className=\"bg-white/20 text-white border-white/30\">\n                  {monthlyProductData.products.length} {groupBy.charAt(0).toUpperCase() + groupBy.slice(1)}s\n                  {monthlyProductData.products.length === 0 && (\n                    <span className=\"ml-2 text-red-200\">(Debug: {deferredFilteredData.length} raw records)</span>\n                  )}\n                </Badge>\n                <CopyTableButton \n                  tableRef={monthOnMonthTableRef as any}\n                  tableName={`${METRICS.find(m => m.id === selectedMetric)?.label} by ${groupBy.charAt(0).toUpperCase() + groupBy.slice(1)} - Month on Month`}\n                  size=\"sm\"\n                  onCopyAllTabs={getAllMetricTablesText}\n                  contextInfo={contextInfo}\n                />\n              </div>\n            </div>\n            <p className=\"text-indigo-100 text-sm mt-2\">\n              Track member check-in patterns across {groupBy}s and time periods\n            </p>\n          </CardHeader>\n\n          <CardContent className=\"p-0\" ref={monthOnMonthTableRef as any}>\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader className=\"sticky top-0 z-20 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n                  <TableRow className=\"border-none\">\n                    <TableHead className=\"font-bold text-white sticky left-0 bg-slate-800 z-30 min-w-[240px]\">\n                      {groupBy.charAt(0).toUpperCase() + groupBy.slice(1)}\n                    </TableHead>\n                    {monthlyProductData.months.map((month) => (\n                      <TableHead key={month} className=\"text-center font-bold text-white min-w-[140px]\">\n                        <div className=\"flex flex-col\">\n                          <span className=\"text-sm\">{month.split(' ')[0]}</span>\n                          <span className=\"text-slate-300 text-xs\">{month.split(' ')[1]}</span>\n                        </div>\n                      </TableHead>\n                    ))}\n                    <TableHead className=\"text-center font-bold text-white min-w-[120px]\">\n                      <TooltipProvider>\n                        <Tooltip>\n                          <TooltipTrigger className=\"cursor-help\">Total Visits</TooltipTrigger>\n                          <TooltipContent>Sum of all check-ins across all months</TooltipContent>\n                        </Tooltip>\n                      </TooltipProvider>\n                    </TableHead>\n                    <TableHead className=\"text-center font-bold text-white min-w-[120px]\">\n                      <TooltipProvider>\n                        <Tooltip>\n                          <TooltipTrigger className=\"cursor-help\">Unique Members</TooltipTrigger>\n                          <TooltipContent>Total unique members who checked in</TooltipContent>\n                        </Tooltip>\n                      </TooltipProvider>\n                    </TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {monthlyProductData.products.length === 0 ? (\n                    <TableRow>\n                      <TableCell colSpan={monthlyProductData.months.length + 3} className=\"text-center py-8 text-slate-500\">\n                        <div className=\"flex flex-col items-center gap-2\">\n                          <AlertCircle className=\"w-8 h-8 text-slate-400\" />\n                          <div className=\"text-lg font-medium\">No Data Available</div>\n                          <div className=\"text-sm\">\n                            Raw records: {deferredFilteredData.length} | \n                            Selected location: {selectedLocation} | \n                            Group by: {groupBy}\n                          </div>\n                          <div className=\"text-xs mt-2 max-w-md text-center\">\n                            This could be due to restrictive filters, no data for the selected time period, \n                            or missing product/category information in the data.\n                          </div>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ) : (\n                    <>\n                      {monthlyProductData.products.map((productData) => {\n                    const isExpanded = expandedRows.has(productData.product);\n                    const values = productData.monthlyBreakdown.map(m => m[selectedMetric]);\n                    const growth = values.length >= 2 ? getChangePercentage(values[0], values[1]) : 0;\n                    const metricConfig = METRICS.find(m => m.id === selectedMetric);\n                    \n                    // Calculate total for current metric\n                    const metricTotal = productData.monthlyBreakdown.reduce((sum, m) => sum + m[selectedMetric], 0);\n\n                    return (\n                      <React.Fragment key={productData.product}>\n                        <TableRow className=\"hover:bg-slate-50/50 transition-colors border-b\">\n                          <TableCell className=\"font-medium text-slate-800 sticky left-0 bg-white z-10 border-r\">\n                            <div className=\"flex items-center gap-2\">\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => toggleProductExpansion(productData.product)}\n                                className=\"p-1 h-6 w-6\"\n                              >\n                                {isExpanded ? <ChevronDown className=\"w-3 h-3\" /> : <ChevronRight className=\"w-3 h-3\" />}\n                              </Button>\n                              <span className=\"text-sm\">{productData.product}</span>\n                            </div>\n                          </TableCell>\n                          {productData.monthlyBreakdown.map((monthData, index) => {\n                            const value = monthData[selectedMetric];\n                            const formattedValue = metricConfig?.format === 'currency' \n                              ? formatRevenue(value)\n                              : metricConfig?.format === 'percentage'\n                              ? formatPercentage(value)\n                              : metricConfig?.format === 'decimal'\n                              ? value.toFixed(1)\n                              : formatNumber(value);\n                            \n                            return (\n                              <TableCell key={monthData.month} className={cn(\n                                \"text-center text-sm font-medium\",\n                                metricConfig?.color || \"text-slate-800\"\n                              )}>\n                                <TooltipProvider>\n                                  <Tooltip>\n                                    <TooltipTrigger className=\"cursor-help\">{formattedValue}</TooltipTrigger>\n                                    <TooltipContent>\n                                      <div className=\"space-y-1\">\n                                        <p className=\"font-semibold\">{monthData.month}</p>\n                                        <p>{metricConfig?.label}: {formattedValue}</p>\n                                        <p className=\"text-xs text-slate-400\">{monthData.uniqueMembers} unique members</p>\n                                      </div>\n                                    </TooltipContent>\n                                  </Tooltip>\n                                </TooltipProvider>\n                              </TableCell>\n                            );\n                          })}\n                          <TableCell className=\"text-center font-bold text-slate-700\">\n                            {metricConfig?.format === 'currency' \n                              ? formatRevenue(metricTotal)\n                              : metricConfig?.format === 'percentage'\n                              ? formatPercentage(metricTotal / productData.monthlyBreakdown.length)\n                              : metricConfig?.format === 'decimal'\n                              ? (metricTotal / productData.monthlyBreakdown.length).toFixed(1)\n                              : formatNumber(metricTotal)}\n                          </TableCell>\n                          <TableCell className=\"text-center font-bold text-blue-600\">\n                            <div className=\"flex items-center justify-center gap-1\">\n                              <Users className=\"w-3 h-3\" />\n                              {formatNumber(productData.totalUniqueMembers)}\n                            </div>\n                          </TableCell>\n                        </TableRow>\n\n                        {/* Expanded Row Details */}\n                        {isExpanded && (\n                          <TableRow className=\"bg-gradient-to-r from-indigo-50/50 to-purple-50/50 animate-fade-in\">\n                            <TableCell colSpan={monthlyProductData.months.length + 3} className=\"p-6\">\n                              <div className=\"space-y-6\">\n                                {/* Summary Metrics */}\n                                <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                                  <div className=\"bg-white p-4 rounded-lg shadow-sm border\">\n                                    <p className=\"text-slate-600 text-xs font-medium\">Total Check-ins</p>\n                                    <p className=\"font-bold text-slate-800 text-2xl\">{formatNumber(productData.totalVisits)}</p>\n                                  </div>\n                                  <div className=\"bg-white p-4 rounded-lg shadow-sm border\">\n                                    <p className=\"text-slate-600 text-xs font-medium\">Unique Members</p>\n                                    <p className=\"font-bold text-indigo-600 text-2xl\">{formatNumber(productData.totalUniqueMembers)}</p>\n                                  </div>\n                                  <div className=\"bg-white p-4 rounded-lg shadow-sm border\">\n                                    <p className=\"text-slate-600 text-xs font-medium\">Avg Visits/Member</p>\n                                    <p className=\"font-bold text-purple-600 text-2xl\">\n                                      {productData.totalUniqueMembers > 0 ? (productData.totalVisits / productData.totalUniqueMembers).toFixed(1) : '0'}\n                                    </p>\n                                  </div>\n                                  <div className=\"bg-white p-4 rounded-lg shadow-sm border\">\n                                    <p className=\"text-slate-600 text-xs font-medium\">Peak Month</p>\n                                    <p className=\"font-bold text-pink-600 text-lg\">\n                                      {productData.monthlyBreakdown.reduce((max, m) => m.visits > max.visits ? m : max, productData.monthlyBreakdown[0])?.month.split(' ')[0] || '-'}\n                                    </p>\n                                  </div>\n                                </div>\n\n                                {/* Individual Records Table - Shows EVERY individual visit record */}\n                                <div className=\"bg-white rounded-lg border overflow-hidden\">\n                                  <div className=\"bg-gradient-to-r from-slate-100 to-slate-50 px-4 py-2 border-b\">\n                                    <h4 className=\"font-semibold text-slate-700 text-sm flex items-center justify-between\">\n                                      <span>Individual Visit Records - Each Row = One Member Visit for \"{productData.product}\"</span>\n                                      <Badge className=\"bg-indigo-600 text-white\">\n                                        {filteredData.filter(item => {\n                                          // Match the group\n                                          if (groupBy === 'product') return item.cleanedProduct === productData.product;\n                                          if (groupBy === 'category') return item.cleanedCategory === productData.product;\n                                          if (groupBy === 'teacher') return item.teacherName === productData.product;\n                                          if (groupBy === 'location') return item.location === productData.product;\n                                          if (groupBy === 'memberStatus') return item.isNew === productData.product;\n                                          return false;\n                                        }).length} individual visit records\n                                      </Badge>\n                                    </h4>\n                                    <p className=\"text-xs text-slate-600 mt-1 italic\">\n                                      This table shows visit records matching all applied filters (including months). Change filters to see different data.\n                                    </p>\n                                  </div>\n                                  <div className=\"overflow-x-auto max-h-[600px] overflow-y-auto\">\n                                    <Table>\n                                      <TableHeader className=\"sticky top-0 bg-gradient-to-r from-slate-700 via-slate-800 to-slate-700 z-10 shadow-lg\">\n                                        <TableRow className=\"border-b border-slate-600\">\n                                          <TableHead className=\"font-bold text-white bg-transparent\">#</TableHead>\n                                          <TableHead className=\"font-bold text-white bg-transparent\">Visit Date</TableHead>\n                                          <TableHead className=\"font-bold text-white bg-transparent\">Month/Year</TableHead>\n                                          <TableHead className=\"font-bold text-white bg-transparent\">Member Name</TableHead>\n                                          <TableHead className=\"font-bold text-white bg-transparent\">Member ID</TableHead>\n                                          <TableHead className=\"font-bold text-white bg-transparent\">Class Name</TableHead>\n                                          <TableHead className=\"font-bold text-white bg-transparent\">Time</TableHead>\n                                          <TableHead className=\"font-bold text-white bg-transparent\">Product</TableHead>\n                                          <TableHead className=\"font-bold text-white bg-transparent\">Category</TableHead>\n                                          <TableHead className=\"text-center font-bold text-white bg-transparent\">Status</TableHead>\n                                          <TableHead className=\"text-center font-bold text-white bg-transparent\">New/Returning</TableHead>\n                                          <TableHead className=\"text-center font-bold text-white bg-transparent\">Paid</TableHead>\n                                          <TableHead className=\"font-bold text-white bg-transparent\">Teacher</TableHead>\n                                          <TableHead className=\"font-bold text-white bg-transparent\">Location</TableHead>\n                                        </TableRow>\n                                      </TableHeader>\n                                      <TableBody>\n                                        {filteredData\n                                          .filter(item => {\n                                            // Match the group - ALL FILTERS ALREADY APPLIED VIA filteredData\n                                            if (groupBy === 'product') return item.cleanedProduct === productData.product;\n                                            if (groupBy === 'category') return item.cleanedCategory === productData.product;\n                                            if (groupBy === 'teacher') return item.teacherName === productData.product;\n                                            if (groupBy === 'location') return item.location === productData.product;\n                                            if (groupBy === 'memberStatus') return item.isNew === productData.product;\n                                            return false;\n                                          })\n                                          .sort((a, b) => {\n                                            const dateA = new Date(a.dateIST || '');\n                                            const dateB = new Date(b.dateIST || '');\n                                            return dateB.getTime() - dateA.getTime();\n                                          })\n                                          .map((record, idx) => (\n                                            <TableRow key={`${record.memberId}-${record.sessionId}-${idx}`} className=\"hover:bg-indigo-50/30 border-b border-slate-100\">\n                                              <TableCell className=\"text-xs text-slate-500\">\n                                                {idx + 1}\n                                              </TableCell>\n                                              <TableCell className=\"font-medium text-xs whitespace-nowrap\">\n                                                {record.dateIST}\n                                              </TableCell>\n                                              <TableCell className=\"text-xs whitespace-nowrap\">\n                                                <Badge variant=\"outline\" className=\"text-xs\">\n                                                  {record.month} {record.year}\n                                                </Badge>\n                                              </TableCell>\n                                              <TableCell className=\"text-xs whitespace-nowrap\">\n                                                {record.firstName} {record.lastName}\n                                              </TableCell>\n                                              <TableCell className=\"text-xs font-mono\">\n                                                {record.memberId}\n                                              </TableCell>\n                                              <TableCell className=\"text-xs max-w-[200px]\">\n                                                {record.sessionName}\n                                              </TableCell>\n                                              <TableCell className=\"text-xs whitespace-nowrap\">\n                                                {record.time}\n                                              </TableCell>\n                                              <TableCell className=\"text-xs\">\n                                                <Badge variant=\"secondary\" className=\"text-xs\">\n                                                  {record.cleanedProduct}\n                                                </Badge>\n                                              </TableCell>\n                                              <TableCell className=\"text-xs\">\n                                                {record.cleanedCategory}\n                                              </TableCell>\n                                              <TableCell className=\"text-center\">\n                                                {record.checkedIn ? (\n                                                  <Badge className=\"bg-green-100 text-green-800 text-xs whitespace-nowrap\">\n                                                    <CheckCircle className=\"w-3 h-3 mr-1\" />\n                                                    Checked In\n                                                  </Badge>\n                                                ) : record.isLateCancelled ? (\n                                                  <Badge className=\"bg-red-100 text-red-800 text-xs whitespace-nowrap\">\n                                                    <XCircle className=\"w-3 h-3 mr-1\" />\n                                                    Late Cancel\n                                                  </Badge>\n                                                ) : (\n                                                  <Badge className=\"bg-amber-100 text-amber-800 text-xs whitespace-nowrap\">\n                                                    Booked Only\n                                                  </Badge>\n                                                )}\n                                              </TableCell>\n                                              <TableCell className=\"text-center\">\n                                                <Badge \n                                                  variant={record.isNew && record.isNew.toLowerCase().includes('new') ? 'default' : 'outline'} \n                                                  className={cn(\n                                                    \"text-xs whitespace-nowrap\",\n                                                    record.isNew && record.isNew.toLowerCase().includes('new') \n                                                      ? 'bg-indigo-100 text-indigo-800' \n                                                      : 'bg-slate-100 text-slate-800'\n                                                  )}\n                                                >\n                                                  {record.isNew && record.isNew.toLowerCase().includes('new') ? 'âœ¨ New' : 'â†©ï¸ Returning'}\n                                                </Badge>\n                                              </TableCell>\n                                              <TableCell className=\"text-center text-xs\">\n                                                <div className=\"flex flex-col items-center\">\n                                                  <span className={cn(\n                                                    \"font-semibold\",\n                                                    record.paid === 0 ? \"text-orange-600\" : \"text-green-700\"\n                                                  )}>\n                                                    {formatRevenue(record.paid || 0)}\n                                                  </span>\n                                                  {record.paid === 0 && (\n                                                    <Badge variant=\"outline\" className=\"text-xs bg-orange-50 text-orange-700 border-orange-300 mt-1\">\n                                                      Complimentary\n                                                    </Badge>\n                                                  )}\n                                                </div>\n                                              </TableCell>\n                                              <TableCell className=\"text-xs\">\n                                                {record.teacherName}\n                                              </TableCell>\n                                              <TableCell className=\"text-xs\">\n                                                {record.location}\n                                              </TableCell>\n                                            </TableRow>\n                                          ))}\n                                        {filteredData.filter(item => {\n                                          if (groupBy === 'product') return item.cleanedProduct === productData.product;\n                                          if (groupBy === 'category') return item.cleanedCategory === productData.product;\n                                          if (groupBy === 'teacher') return item.teacherName === productData.product;\n                                          if (groupBy === 'location') return item.location === productData.product;\n                                          if (groupBy === 'memberStatus') return item.isNew === productData.product;\n                                          return false;\n                                        }).length === 0 && (\n                                          <TableRow>\n                                            <TableCell colSpan={14} className=\"text-center py-8 text-slate-500\">\n                                              No visit records found for this {groupBy} with the current filters applied\n                                            </TableCell>\n                                          </TableRow>\n                                        )}\n                                      </TableBody>\n                                    </Table>\n                                  </div>\n                                </div>\n                              </div>\n                            </TableCell>\n                          </TableRow>\n                        )}\n                      </React.Fragment>\n                    );\n                  })}\n                    </>\n                  )}\n\n                  {/* Totals Row - only show if there are products */}\n                  {monthlyProductData.products.length > 0 && (\n                  <TableRow className=\"bg-gradient-to-r from-emerald-50 to-green-50 border-t-2 border-emerald-600 font-bold\">\n                    <TableCell className=\"sticky left-0 bg-gradient-to-r from-emerald-100 to-green-100 z-10 border-r\">\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"w-6 h-6\" /> {/* Spacer for alignment */}\n                        <span className=\"text-emerald-800 font-bold text-sm\">TOTAL (All {groupBy.charAt(0).toUpperCase() + groupBy.slice(1)}s)</span>\n                      </div>\n                    </TableCell>\n                    {monthlyProductData.totalsRow.monthlyBreakdown.map((monthData) => {\n                      const metricConfig = METRICS.find(m => m.id === selectedMetric);\n                      const value = monthData[selectedMetric];\n                      const formattedValue = metricConfig?.format === 'currency' \n                        ? formatRevenue(value)\n                        : metricConfig?.format === 'percentage'\n                        ? formatPercentage(value)\n                        : metricConfig?.format === 'decimal'\n                        ? value.toFixed(1)\n                        : formatNumber(value);\n                      \n                      return (\n                        <TableCell key={monthData.month} className=\"text-center font-bold text-emerald-800\">\n                          <TooltipProvider>\n                            <Tooltip>\n                              <TooltipTrigger className=\"cursor-help\">{formattedValue}</TooltipTrigger>\n                              <TooltipContent>\n                                <div className=\"space-y-1\">\n                                  <p className=\"font-semibold\">{monthData.month}</p>\n                                  <p>{metricConfig?.label}: {formattedValue}</p>\n                                  <p className=\"text-xs text-slate-400\">{monthData.uniqueMembers} unique members</p>\n                                </div>\n                              </TooltipContent>\n                            </Tooltip>\n                          </TooltipProvider>\n                        </TableCell>\n                      );\n                    })}\n                    <TableCell className=\"text-center font-bold text-emerald-800 text-base\">\n                      {(() => {\n                        const metricConfig = METRICS.find(m => m.id === selectedMetric);\n                        const totalValue = monthlyProductData.totalsRow.monthlyBreakdown.reduce((sum, m) => sum + m[selectedMetric], 0);\n                        \n                        return metricConfig?.format === 'currency' \n                          ? formatRevenue(totalValue)\n                          : metricConfig?.format === 'percentage'\n                          ? formatPercentage(totalValue / monthlyProductData.totalsRow.monthlyBreakdown.length)\n                          : metricConfig?.format === 'decimal'\n                          ? (totalValue / monthlyProductData.totalsRow.monthlyBreakdown.length).toFixed(1)\n                          : formatNumber(totalValue);\n                      })()}\n                    </TableCell>\n                    <TableCell className=\"text-center font-bold text-emerald-800 text-base\">\n                      <div className=\"flex items-center justify-center gap-1\">\n                        <Users className=\"w-4 h-4\" />\n                        {formatNumber(monthlyProductData.totalsRow.totalUniqueMembers)}\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                  )}\n                </TableBody>\n              </Table>\n            </div>\n          </CardContent>\n        </Card>\n          </TabsContent>\n\n          {/* Visit Frequency Analysis Tab Content */}\n          <TabsContent value=\"visit-frequency\" className=\"mt-6 space-y-6\">\n        {/* Visit Frequency Analysis */}\n        <div className=\"grid grid-cols-1 gap-6\">\n          {/* Monthly Visit Frequency */}\n          <Card className=\"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl\">\n            <CardHeader className=\"pb-4 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white rounded-t-lg\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <Activity className=\"w-6 h-6\" />\n                  <CardTitle className=\"text-xl font-bold\">\n                    Monthly Visit Frequency by {frequencyBreakdownBy.charAt(0).toUpperCase() + frequencyBreakdownBy.slice(1)}\n                  </CardTitle>\n                </div>\n                <CopyTableButton \n                  tableRef={frequencyTableRef as any}\n                  tableName=\"Attendance Frequency Breakdown\"\n                  size=\"sm\"\n                  onCopyAllTabs={async () => getFrequencyText()}\n                  contextInfo={{\n                    ...contextInfo,\n                    additionalInfo: {\n                      ...contextInfo.additionalInfo,\n                      breakdownBy: frequencyBreakdownBy.charAt(0).toUpperCase() + frequencyBreakdownBy.slice(1),\n                      quickFilter: frequencyQuickFilterMonth !== 'All' ? frequencyQuickFilterMonth : undefined\n                    }\n                  }}\n                />\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-6 space-y-4\" ref={frequencyTableRef as any}>\n              {/* Breakdown Selector */}\n              <div className=\"flex flex-wrap gap-2 pb-3 border-b border-blue-200\">\n                <Button\n                  size=\"sm\"\n                  variant={frequencyBreakdownBy === 'class' ? 'default' : 'outline'}\n                  onClick={() => {\n                    setFrequencyBreakdownBy('class');\n                    setFrequencyQuickFilterMonth('All');\n                  }}\n                  className={cn(\n                    \"flex items-center gap-1\",\n                    frequencyBreakdownBy === 'class' ? 'bg-indigo-600 hover:bg-indigo-700' : ''\n                  )}\n                >\n                  <Calendar className=\"w-3 h-3\" />\n                  Class\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant={frequencyBreakdownBy === 'product' ? 'default' : 'outline'}\n                  onClick={() => {\n                    setFrequencyBreakdownBy('product');\n                    setFrequencyQuickFilterMonth('All');\n                  }}\n                  className={cn(\n                    \"flex items-center gap-1\",\n                    frequencyBreakdownBy === 'product' ? 'bg-indigo-600 hover:bg-indigo-700' : ''\n                  )}\n                >\n                  <BarChart3 className=\"w-3 h-3\" />\n                  Product\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant={frequencyBreakdownBy === 'category' ? 'default' : 'outline'}\n                  onClick={() => {\n                    setFrequencyBreakdownBy('category');\n                    setFrequencyQuickFilterMonth('All');\n                  }}\n                  className={cn(\n                    \"flex items-center gap-1\",\n                    frequencyBreakdownBy === 'category' ? 'bg-indigo-600 hover:bg-indigo-700' : ''\n                  )}\n                >\n                  <Grid3x3 className=\"w-3 h-3\" />\n                  Category\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant={frequencyBreakdownBy === 'teacher' ? 'default' : 'outline'}\n                  onClick={() => {\n                    setFrequencyBreakdownBy('teacher');\n                    setFrequencyQuickFilterMonth('All');\n                  }}\n                  className={cn(\n                    \"flex items-center gap-1\",\n                    frequencyBreakdownBy === 'teacher' ? 'bg-indigo-600 hover:bg-indigo-700' : ''\n                  )}\n                >\n                  <Users className=\"w-3 h-3\" />\n                  Teacher\n                </Button>\n              </div>\n\n              {/* Month Quick Filter Buttons */}\n              <div className=\"space-y-2\">\n                <label className=\"text-xs font-semibold text-slate-700\">Filter by Month:</label>\n                <div className=\"flex flex-wrap gap-2 max-h-32 overflow-y-auto\">\n                  <Badge\n                    className={cn(\n                      \"cursor-pointer transition-all\",\n                      frequencyQuickFilterMonth === 'All'\n                        ? 'bg-indigo-600 text-white hover:bg-indigo-700'\n                        : 'bg-slate-200 text-slate-700 hover:bg-slate-300'\n                    )}\n                    onClick={() => setFrequencyQuickFilterMonth('All')}\n                  >\n                    All Months\n                  </Badge>\n                  {(() => {\n                    const months = new Set<string>();\n                    Object.values(visitFrequencyData).forEach(monthData => {\n                      Object.keys(monthData).forEach(month => months.add(month));\n                    });\n                    return Array.from(months).sort((a, b) => {\n                      const [monthA, yearA] = a.split('-');\n                      const [monthB, yearB] = b.split('-');\n                      const dateA = new Date(`${monthA} 1, ${yearA}`);\n                      const dateB = new Date(`${monthB} 1, ${yearB}`);\n                      return dateB.getTime() - dateA.getTime();\n                    }).map(month => (\n                      <Badge\n                        key={month}\n                        className={cn(\n                          \"cursor-pointer transition-all\",\n                          frequencyQuickFilterMonth === month\n                            ? 'bg-indigo-600 text-white hover:bg-indigo-700'\n                            : 'bg-slate-200 text-slate-700 hover:bg-slate-300'\n                        )}\n                        onClick={() => setFrequencyQuickFilterMonth(month)}\n                      >\n                        {month}\n                      </Badge>\n                    ));\n                  })()}\n                </div>\n              </div>\n\n              {/* Tabular Frequency Data Display */}\n              <div className=\"overflow-x-auto\">\n                <Table className=\"unified-table\">\n                  <TableHeader className=\"sticky top-0 z-10 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800\">\n                    <TableRow className=\"border-none\">\n                      <TableHead className=\"font-bold text-white sticky left-0 bg-slate-800/95 backdrop-blur-sm z-20 min-w-[200px] border-r border-white/20\">\n                        {frequencyBreakdownBy.charAt(0).toUpperCase() + frequencyBreakdownBy.slice(1)}\n                      </TableHead>\n                      <TableHead className=\"text-center font-bold text-white border-l border-white/20\">1 class</TableHead>\n                      <TableHead className=\"text-center font-bold text-white border-l border-white/20\">2-5 classes</TableHead>\n                      <TableHead className=\"text-center font-bold text-white border-l border-white/20\">6-10 classes</TableHead>\n                      <TableHead className=\"text-center font-bold text-white border-l border-white/20\">11-15 classes</TableHead>\n                      <TableHead className=\"text-center font-bold text-white border-l border-white/20\">16-20 classes</TableHead>\n                      <TableHead className=\"text-center font-bold text-white border-l border-white/20\">21-25 classes</TableHead>\n                      <TableHead className=\"text-center font-bold text-white border-l border-white/20\">&gt;25 classes</TableHead>\n                      <TableHead className=\"text-center font-bold text-white border-l border-white/20\">Total</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {(() => {\n                      // Aggregate data across selected months\n                      const aggregated: Record<string, Record<string, number>> = {};\n                      \n                      Object.entries(visitFrequencyData).forEach(([key, monthData]) => {\n                        aggregated[key] = {\n                          '1 class': 0,\n                          '2-5 classes': 0,\n                          '6-10 classes': 0,\n                          '11-15 classes': 0,\n                          '16-20 classes': 0,\n                          '21-25 classes': 0,\n                          '>25 classes': 0\n                        };\n                        \n                        Object.entries(monthData).forEach(([month, buckets]) => {\n                          if (frequencyQuickFilterMonth === 'All' || month === frequencyQuickFilterMonth) {\n                            Object.entries(buckets).forEach(([bucket, count]) => {\n                              aggregated[key][bucket] += count;\n                            });\n                          }\n                        });\n                      });\n                      \n                      return Object.entries(aggregated)\n                        .sort(([a], [b]) => a.localeCompare(b))\n                        .map(([key, buckets]) => {\n                          const total = Object.values(buckets).reduce((sum, val) => sum + val, 0);\n                          if (total === 0) return null;\n                          \n                          return (\n                            <TableRow key={key} className=\"hover:bg-slate-50/50 transition-colors border-b\">\n                              <TableCell className=\"font-medium text-slate-800 sticky left-0 bg-white z-10 border-r\">\n                                {key}\n                              </TableCell>\n                              <TableCell className=\"text-center text-sm font-medium text-slate-700\">\n                                {formatNumber(buckets['1 class'])}\n                              </TableCell>\n                              <TableCell className=\"text-center text-sm font-medium text-slate-700\">\n                                {formatNumber(buckets['2-5 classes'])}\n                              </TableCell>\n                              <TableCell className=\"text-center text-sm font-medium text-slate-700\">\n                                {formatNumber(buckets['6-10 classes'])}\n                              </TableCell>\n                              <TableCell className=\"text-center text-sm font-medium text-slate-700\">\n                                {formatNumber(buckets['11-15 classes'])}\n                              </TableCell>\n                              <TableCell className=\"text-center text-sm font-medium text-slate-700\">\n                                {formatNumber(buckets['16-20 classes'])}\n                              </TableCell>\n                              <TableCell className=\"text-center text-sm font-medium text-slate-700\">\n                                {formatNumber(buckets['21-25 classes'])}\n                              </TableCell>\n                              <TableCell className=\"text-center text-sm font-medium text-slate-700\">\n                                {formatNumber(buckets['>25 classes'])}\n                              </TableCell>\n                              <TableCell className=\"text-center text-sm font-bold text-indigo-700 bg-indigo-50\">\n                                {formatNumber(total)}\n                              </TableCell>\n                            </TableRow>\n                          );\n                        }).filter(Boolean);\n                    })()}\n                  </TableBody>\n                </Table>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n          </TabsContent>\n\n          {/* Cancellations Tab Content - Moved from visit frequency */}\n          <TabsContent value=\"cancellations\" className=\"mt-6 space-y-6\">\n          {/* Late Cancellation Frequency */}\n          <Card className=\"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl\">\n            <CardHeader className=\"pb-4 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white rounded-t-lg\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <AlertCircle className=\"w-6 h-6\" />\n                  <CardTitle className=\"text-xl font-bold\">\n                    Late Cancellation Frequency by {cancellationBreakdownBy.charAt(0).toUpperCase() + cancellationBreakdownBy.slice(1)}\n                  </CardTitle>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Badge className=\"bg-white/20 text-white border-white/30\">\n                    {Object.keys(lateCancellationFrequencyData).length} {cancellationBreakdownBy.charAt(0).toUpperCase() + cancellationBreakdownBy.slice(1)}s\n                  </Badge>\n                  <CopyTableButton \n                    tableRef={cancellationTableRef as any}\n                    tableName=\"Late Cancellations Breakdown\"\n                    size=\"sm\"\n                    onCopyAllTabs={async () => getCancellationText()}\n                    contextInfo={{\n                      ...contextInfo,\n                      additionalInfo: {\n                        ...contextInfo.additionalInfo,\n                        breakdownBy: cancellationBreakdownBy.charAt(0).toUpperCase() + cancellationBreakdownBy.slice(1),\n                        quickFilter: cancellationQuickFilterMonth !== 'All' ? cancellationQuickFilterMonth : undefined\n                      }\n                    }}\n                  />\n                </div>\n              </div>\n              <p className=\"text-indigo-100 text-sm mt-2\">\n                Distribution of members by late cancellations per month\n              </p>\n            </CardHeader>\n            <CardContent className=\"p-6 space-y-4\" ref={cancellationTableRef as any}>\n              {/* Breakdown Selector */}\n              <div className=\"flex flex-wrap gap-2 pb-3 border-b border-red-200\">\n                <Button\n                  size=\"sm\"\n                  variant={cancellationBreakdownBy === 'class' ? 'default' : 'outline'}\n                  onClick={() => {\n                    setCancellationBreakdownBy('class');\n                    setCancellationQuickFilterMonth('All');\n                  }}\n                  className={cn(\n                    \"flex items-center gap-1\",\n                    cancellationBreakdownBy === 'class' ? 'bg-indigo-600 hover:bg-indigo-700' : ''\n                  )}\n                >\n                  <Calendar className=\"w-3 h-3\" />\n                  Class\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant={cancellationBreakdownBy === 'product' ? 'default' : 'outline'}\n                  onClick={() => {\n                    setCancellationBreakdownBy('product');\n                    setCancellationQuickFilterMonth('All');\n                  }}\n                  className={cn(\n                    \"flex items-center gap-1\",\n                    cancellationBreakdownBy === 'product' ? 'bg-indigo-600 hover:bg-indigo-700' : ''\n                  )}\n                >\n                  <BarChart3 className=\"w-3 h-3\" />\n                  Product\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant={cancellationBreakdownBy === 'category' ? 'default' : 'outline'}\n                  onClick={() => {\n                    setCancellationBreakdownBy('category');\n                    setCancellationQuickFilterMonth('All');\n                  }}\n                  className={cn(\n                    \"flex items-center gap-1\",\n                    cancellationBreakdownBy === 'category' ? 'bg-indigo-600 hover:bg-indigo-700' : ''\n                  )}\n                >\n                  <Grid3x3 className=\"w-3 h-3\" />\n                  Category\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant={cancellationBreakdownBy === 'teacher' ? 'default' : 'outline'}\n                  onClick={() => {\n                    setCancellationBreakdownBy('teacher');\n                    setCancellationQuickFilterMonth('All');\n                  }}\n                  className={cn(\n                    \"flex items-center gap-1\",\n                    cancellationBreakdownBy === 'teacher' ? 'bg-indigo-600 hover:bg-indigo-700' : ''\n                  )}\n                >\n                  <Users className=\"w-3 h-3\" />\n                  Teacher\n                </Button>\n              </div>\n\n              {/* Month Quick Filter Buttons */}\n              <div className=\"space-y-2\">\n                <label className=\"text-xs font-semibold text-slate-700\">Filter by Month:</label>\n                <div className=\"flex flex-wrap gap-2 max-h-32 overflow-y-auto\">\n                  <Badge\n                    className={cn(\n                      \"cursor-pointer transition-all\",\n                      cancellationQuickFilterMonth === 'All'\n                        ? 'bg-indigo-600 text-white hover:bg-indigo-700'\n                        : 'bg-slate-200 text-slate-700 hover:bg-slate-300'\n                    )}\n                    onClick={() => setCancellationQuickFilterMonth('All')}\n                  >\n                    All Months\n                  </Badge>\n                  {(() => {\n                    const months = new Set<string>();\n                    Object.values(lateCancellationFrequencyData).forEach(monthData => {\n                      Object.keys(monthData).forEach(month => months.add(month));\n                    });\n                    return Array.from(months).sort((a, b) => {\n                      const [monthA, yearA] = a.split('-');\n                      const [monthB, yearB] = b.split('-');\n                      const dateA = new Date(`${monthA} 1, ${yearA}`);\n                      const dateB = new Date(`${monthB} 1, ${yearB}`);\n                      return dateB.getTime() - dateA.getTime();\n                    }).map(month => (\n                      <Badge\n                        key={month}\n                        className={cn(\n                          \"cursor-pointer transition-all\",\n                          cancellationQuickFilterMonth === month\n                            ? 'bg-indigo-600 text-white hover:bg-indigo-700'\n                            : 'bg-slate-200 text-slate-700 hover:bg-slate-300'\n                        )}\n                        onClick={() => setCancellationQuickFilterMonth(month)}\n                      >\n                        {month}\n                      </Badge>\n                    ));\n                  })()}\n                </div>\n              </div>\n\n              {/* Tabular Frequency Data Display */}\n              <div className=\"overflow-x-auto\">\n                <Table>\n                  <TableHeader className=\"sticky top-0 z-10 bg-gradient-to-r from-red-700 via-red-800 to-red-700\">\n                    <TableRow className=\"border-none\">\n                      <TableHead className=\"font-bold text-white sticky left-0 bg-red-800/95 backdrop-blur-sm z-20 min-w-[200px]\">\n                        {cancellationBreakdownBy.charAt(0).toUpperCase() + cancellationBreakdownBy.slice(1)}\n                      </TableHead>\n                      <TableHead className=\"text-center font-bold text-white\">1 cancellation</TableHead>\n                      <TableHead className=\"text-center font-bold text-white\">2-5 cancellations</TableHead>\n                      <TableHead className=\"text-center font-bold text-white\">6-10 cancellations</TableHead>\n                      <TableHead className=\"text-center font-bold text-white\">11-15 cancellations</TableHead>\n                      <TableHead className=\"text-center font-bold text-white\">16-20 cancellations</TableHead>\n                      <TableHead className=\"text-center font-bold text-white\">21-25 cancellations</TableHead>\n                      <TableHead className=\"text-center font-bold text-white\">&gt;25 cancellations</TableHead>\n                      <TableHead className=\"text-center font-bold text-white\">Total</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {(() => {\n                      // Aggregate data across selected months\n                      const aggregated: Record<string, Record<string, number>> = {};\n                      \n                      Object.entries(lateCancellationFrequencyData).forEach(([key, monthData]) => {\n                        aggregated[key] = {\n                          '1 cancellation': 0,\n                          '2-5 cancellations': 0,\n                          '6-10 cancellations': 0,\n                          '11-15 cancellations': 0,\n                          '16-20 cancellations': 0,\n                          '21-25 cancellations': 0,\n                          '>25 cancellations': 0\n                        };\n                        \n                        Object.entries(monthData).forEach(([month, buckets]) => {\n                          if (cancellationQuickFilterMonth === 'All' || month === cancellationQuickFilterMonth) {\n                            Object.entries(buckets).forEach(([bucket, count]) => {\n                              aggregated[key][bucket] += count;\n                            });\n                          }\n                        });\n                      });\n                      \n                      return Object.entries(aggregated)\n                        .sort(([a], [b]) => a.localeCompare(b))\n                        .map(([key, buckets]) => {\n                          const total = Object.values(buckets).reduce((sum, val) => sum + val, 0);\n                          if (total === 0) return null;\n                          \n                          return (\n                            <TableRow key={key} className=\"hover:bg-slate-50/50 transition-colors border-b\">\n                              <TableCell className=\"font-medium text-slate-800 sticky left-0 bg-white z-10 border-r\">\n                                {key}\n                              </TableCell>\n                              <TableCell className=\"text-center text-sm font-medium text-slate-700\">\n                                {formatNumber(buckets['1 cancellation'])}\n                              </TableCell>\n                              <TableCell className=\"text-center text-sm font-medium text-slate-700\">\n                                {formatNumber(buckets['2-5 cancellations'])}\n                              </TableCell>\n                              <TableCell className=\"text-center text-sm font-medium text-slate-700\">\n                                {formatNumber(buckets['6-10 cancellations'])}\n                              </TableCell>\n                              <TableCell className=\"text-center text-sm font-medium text-slate-700\">\n                                {formatNumber(buckets['11-15 cancellations'])}\n                              </TableCell>\n                              <TableCell className=\"text-center text-sm font-medium text-slate-700\">\n                                {formatNumber(buckets['16-20 cancellations'])}\n                              </TableCell>\n                              <TableCell className=\"text-center text-sm font-medium text-slate-700\">\n                                {formatNumber(buckets['21-25 cancellations'])}\n                              </TableCell>\n                              <TableCell className=\"text-center text-sm font-medium text-slate-700\">\n                                {formatNumber(buckets['>25 cancellations'])}\n                              </TableCell>\n                              <TableCell className=\"text-center text-sm font-bold text-indigo-700 bg-indigo-50\">\n                                {formatNumber(total)}\n                              </TableCell>\n                            </TableRow>\n                          );\n                        }).filter(Boolean);\n                    })()}\n                  </TableBody>\n                </Table>\n              </div>\n            </CardContent>\n          </Card>\n          </TabsContent>\n\n          {/* Multiple Classes Per Day Tab Content */}\n          <TabsContent value=\"multiple-classes\" className=\"mt-6 space-y-6\">\n        {/* Multiple Classes Per Day */}\n        <Card className=\"border-0 shadow-lg bg-white/80 backdrop-blur-sm rounded-2xl\">\n          <CardHeader className=\"pb-4 border-b border-slate-100\">\n            <CardTitle className=\"text-xl font-semibold text-slate-800 flex items-center gap-3\">\n              <Users className=\"w-6 h-6 text-purple-600\" />\n              Multiple Classes Per Day Analysis\n            </CardTitle>\n            <p className=\"text-slate-600 text-sm mt-2\">\n              Members attending more than one class on the same day\n            </p>\n          </CardHeader>\n          <CardContent className=\"p-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n              <div className=\"bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200 hover:shadow-lg transition-shadow\">\n                <p className=\"text-slate-600 text-sm font-medium mb-2\">Members with Multiple Classes/Day</p>\n                <p className=\"font-bold text-blue-800 text-3xl\">\n                  {formatNumber(multipleClassesPerDay.membersWithMultipleClasses)}\n                </p>\n              </div>\n              <div className=\"bg-gradient-to-br from-indigo-50 to-purple-50 p-6 rounded-xl border border-indigo-200 hover:shadow-lg transition-shadow\">\n                <p className=\"text-slate-600 text-sm font-medium mb-2\">Total Days with Multiple Classes</p>\n                <p className=\"font-bold text-indigo-800 text-3xl\">\n                  {formatNumber(multipleClassesPerDay.totalMultipleClassDays)}\n                </p>\n              </div>\n              <div className=\"bg-gradient-to-br from-purple-50 to-pink-50 p-6 rounded-xl border border-purple-200 hover:shadow-lg transition-shadow\">\n                <p className=\"text-slate-600 text-sm font-medium mb-2\">Avg Multiple Class Days/Member</p>\n                <p className=\"font-bold text-purple-800 text-3xl\">\n                  {multipleClassesPerDay.avgMultipleClassDays}\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n          </TabsContent>\n\n          {/* Member Behavior Patterns Tab Content */}\n          <TabsContent value=\"member-behavior\" className=\"mt-6 space-y-6\">\n            <MemberBehaviorPatterns />\n          </TabsContent>\n        </Tabs>\n            </div>\n          </div>\n        </div>\n        <Footer />\n      </div>\n    </GlobalFiltersProvider>\n  );\n};\n\nexport default PatternsAndTrends;\n\n"],"names":["Grid3x3","createLucideIcon","logger","createLogger","SPREADSHEET_ID","VC_SHEET_NAME","useVCMemberData","data","setData","useState","loading","setLoading","error","setError","parseMonthlyMetrics","row","headers","monthlyData","monthPattern","months","header","monthYear","bookedIdx","h","visitsIdx","cancellationsIdx","paidIdx","unpaidIdx","fetchData","rows","fetchGoogleSheet","memberData","i","memberId","firstName","lastName","email","phone","err","errorMessage","useEffect","useMemberBehaviorAnalytics","useMemo","performanceMetrics","member","totalBookings","totalVisits","totalCancellations","totalPaidAmount","totalUnpaidAmount","metrics","cancellationRate","showUpRate","totalAmount","paymentCompliance","averageTransactionValue","monthlyTrendsMap","month","monthlyTrends","b","dateA","memberSegments","metric","m","lastActivityMonth","a","segment","totalRevenue","sum","totalOutstanding","collectionEfficiency","revenuePerVisit","monthlyRevenueData","trend","financialInsights","overallCancellationRate","appointmentUtilizationRate","bookingToPaymentConversion","operationalMetrics","churnRiskMembers","recent3Months","previous3Months","recentVisits","previousVisits","declineRate","churnScore","lastActiveMonth","recentMonths","avgRevenue","revenueForecasts","paymentRiskMembers","predictiveInsights","declining","increasing","recentBookings","previousBookings","recentCancellations","previousCancellations","fullName","changeRate","calculateCorrelation","x","y","n","meanX","val","meanY","numerator","sumXSquared","sumYSquared","diffX","diffY","denominator","bookingsData","cancellationsData","visitsData","bookingCancellationCorrelation","bookingVisitCorrelation","overallPattern","highRiskPatterns","highCancellationMembers","lowShowUpMembers","decliningBookingMembers","d","trendAnalysis","activeMembers","atRiskMembers","avgCancellationRate","avgShowUpRate","topTrend","p","keyInsight","recommendation","summaryInsights","COLORS","MemberBehaviorPatterns","analytics","activeTab","setActiveTab","jsx","Card","jsxs","CardContent","AlertCircle","segmentCounts","acc","segmentData","count","w","CardHeader","CardTitle","Users","formatNumber","motion","DollarSign","Badge","formatCurrency","Activity","formatPercentage","Target","XCircle","Tabs","TabsList","TabsTrigger","BarChart3","Award","TrendingUp","AlertTriangle","TabsContent","Calendar","ResponsiveContainer","LineChart","CartesianGrid","XAxis","YAxis","Tooltip","value","Legend","Line","PieChart","Pie","entry","index","Cell","idx","pattern","ArrowDownRight","ArrowUpRight","BarChart","Bar","segmentMembers","config","CheckCircle","Icon","forecast","PatternsAndTrends","checkinsData","checkinsLoading","checkinsError","useCheckinsData","salesData","salesLoading","salesError","useSalesData","useGlobalLoading","navigate","useNavigate","selectedLocation","setSelectedLocation","heroColor","setHeroColor","isFiltersCollapsed","setIsFiltersCollapsed","expandedRows","setExpandedRows","groupBy","setGroupBy","selectedMetric","setSelectedMetric","METRICS","UserPlus","UserCheck","Package","Percent","Info","selectedProducts","setSelectedProducts","selectedCategories","setSelectedCategories","selectedTeachers","setSelectedTeachers","selectedMemberStatus","setSelectedMemberStatus","selectedMonths","setSelectedMonths","frequencyBreakdownBy","setFrequencyBreakdownBy","frequencyQuickFilterMonth","setFrequencyQuickFilterMonth","cancellationBreakdownBy","setCancellationBreakdownBy","cancellationQuickFilterMonth","setCancellationQuickFilterMonth","monthOnMonthTableRef","useRef","frequencyTableRef","cancellationTableRef","useRegisterTableForCopy","getFrequencyText","getCancellationText","filterOptions","products","categories","teachers","memberStatuses","item","filteredData","location","filteredLocationData","deferredFilteredData","useDeferredValue","deferredSalesData","isPending","startTransition","useTransition","monthlyProductData","fd","sd","grouped","monthsSet","groupKey","monthData","salesByMonth","sale","date","saleMonth","saleYear","parseMonth","str","year","monthNames","product","monthlyBreakdown","salesForMonth","sessionsCount","classAvg","fillRate","sessionsWithCheckins","emptySessions","avgRevenuePerMember","avgRevenuePerSession","totalSessions","totalCapacity","totalCheckins","allUniqueMembers","id","totalsRow","allData","monthRevenue","monthSaleItemIds","contextInfo","useTableCopyContext","getAllMetricTablesText","React","allText","productItem","totalValue","monthCount","formattedValue","formatRevenue","formattedTotal","avgValue","formattedAvg","toggleProductExpansion","newExpanded","visitFrequencyData","breakdownData","breakdownKey","memberKey","result","key","buckets","lateCancellationFrequencyData","multipleClassesPerDay","dailyCheckins","membersWithMultipleClasses","totalMultipleClassDays","memberDates","daysWithMultiple","getChangePercentage","current","previous","GlobalFiltersProvider","SalesMotionHero","Footer","StudioLocationTabs","locationId","ChevronRight","ChevronDown","e","Button","category","c","teacher","t","status","s","LayoutGrid","cn","isSelected","CopyTableButton","Table","TableHeader","TableRow","TableHead","TooltipProvider","TooltipTrigger","TooltipContent","TableBody","TableCell","Fragment","productData","isExpanded","values","metricConfig","metricTotal","max","record","monthA","yearA","monthB","yearB","aggregated","bucket","total"],"mappings":"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","x_google_ignoreList":[0]}