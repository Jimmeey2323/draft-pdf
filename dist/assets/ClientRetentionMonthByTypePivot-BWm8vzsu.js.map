{"version":3,"file":"ClientRetentionMonthByTypePivot-BWm8vzsu.js","sources":["../../node_modules/lucide-react/dist/esm/icons/calendar-days.js","../../node_modules/lucide-react/dist/esm/icons/repeat.js","../../src/hooks/useClientConversionMetrics.ts","../../src/components/dashboard/ClientConversionMetricCards.tsx","../../src/components/dashboard/ClientRetentionMonthByTypePivot.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst CalendarDays = createLucideIcon(\"CalendarDays\", [\n  [\"path\", { d: \"M8 2v4\", key: \"1cmpym\" }],\n  [\"path\", { d: \"M16 2v4\", key: \"4m81vk\" }],\n  [\"rect\", { width: \"18\", height: \"18\", x: \"3\", y: \"4\", rx: \"2\", key: \"1hopcy\" }],\n  [\"path\", { d: \"M3 10h18\", key: \"8toen8\" }],\n  [\"path\", { d: \"M8 14h.01\", key: \"6423bh\" }],\n  [\"path\", { d: \"M12 14h.01\", key: \"1etili\" }],\n  [\"path\", { d: \"M16 14h.01\", key: \"1gbofw\" }],\n  [\"path\", { d: \"M8 18h.01\", key: \"lrp35t\" }],\n  [\"path\", { d: \"M12 18h.01\", key: \"mhygvu\" }],\n  [\"path\", { d: \"M16 18h.01\", key: \"kzsmim\" }]\n]);\n\nexport { CalendarDays as default };\n//# sourceMappingURL=calendar-days.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Repeat = createLucideIcon(\"Repeat\", [\n  [\"path\", { d: \"m17 2 4 4-4 4\", key: \"nntrym\" }],\n  [\"path\", { d: \"M3 11v-1a4 4 0 0 1 4-4h14\", key: \"84bu3i\" }],\n  [\"path\", { d: \"m7 22-4-4 4-4\", key: \"1wqhfi\" }],\n  [\"path\", { d: \"M21 13v1a4 4 0 0 1-4 4H3\", key: \"1rx37r\" }]\n]);\n\nexport { Repeat as default };\n//# sourceMappingURL=repeat.js.map\n","import { useMemo } from 'react';\nimport { NewClientData } from '@/types/dashboard';\nimport { parseDate } from '@/utils/dateUtils';\nimport { formatCurrency, formatNumber, formatPercentage } from '@/utils/formatters';\n\ntype Trend = 'strong' | 'moderate' | 'weak';\n\nexport interface ClientMetric {\n  title: string;\n  value: string;\n  rawValue: number;\n  change: number;\n  changeDetails: { rate: number; isSignificant: boolean; trend: Trend };\n  previousValue: string;\n  previousRawValue: number;\n  periodLabel?: string;\n  icon: string;\n  description: string;\n}\n\nexport interface ClientMetricWithYoY extends ClientMetric {\n  yoyPreviousValue?: string;\n  yoyPreviousRawValue?: number;\n  yoyChange?: number;\n  comparison?: { current: number; previous: number; difference: number };\n  filterData?: () => NewClientData[];\n  metricType?: string;\n  rawValue?: number;\n  previousRawValue?: number;\n  icon?: React.ComponentType<{ className?: string }>;\n}\n\ninterface Options {\n  dateRange?: { start?: string | Date; end?: string | Date };\n}\n\nconst calcGrowth = (current: number, previous: number) => {\n  if (previous === 0) return { rate: current > 0 ? 100 : 0, isSignificant: current > 0, trend: current > 0 ? 'moderate' as Trend : 'weak' as Trend };\n  const rate = ((current - previous) / previous) * 100;\n  const mag = Math.abs(rate);\n  \n  // Trend should consider direction of change\n  let trend: Trend;\n  if (rate > 0) {\n    // Positive growth\n    trend = mag > 20 ? 'strong' : mag > 5 ? 'moderate' : 'weak';\n  } else {\n    // Negative growth (decline) - should always be weak or moderate at best\n    trend = mag > 20 ? 'weak' : mag > 5 ? 'moderate' : 'weak';\n  }\n  \n  return { rate, isSignificant: mag > 2, trend };\n};\n\nexport function useClientConversionMetrics(\n  data: NewClientData[] = [],\n  historicalData?: NewClientData[],\n  options?: Options\n) {\n  return useMemo(() => {\n    // Use historicalData as the base dataset that contains data across multiple periods\n    // This should have location/trainer filters applied but NOT date filters\n    const base = (historicalData && historicalData.length > 0 ? historicalData : data) as NewClientData[];\n    \n    const compareEnd = options?.dateRange?.end\n      ? (typeof options.dateRange.end === 'string' ? new Date(options.dateRange.end) : (options.dateRange.end as Date))\n      : new Date();\n    const monthStart = (d: Date) => new Date(d.getFullYear(), d.getMonth(), 1);\n    const monthEnd = (d: Date) => new Date(d.getFullYear(), d.getMonth() + 1, 0, 23, 59, 59, 999);\n    const currentStart = monthStart(compareEnd);\n    const currentEnd = monthEnd(compareEnd);\n    const prevAnchor = new Date(currentStart.getFullYear(), currentStart.getMonth() - 1, 15);\n    const prevStart = monthStart(prevAnchor);\n    const prevEnd = monthEnd(prevAnchor);\n    const fmt = (d: Date) => d.toLocaleDateString(undefined, { month: 'short', year: 'numeric' });\n    const periodLabel = `${fmt(currentStart)} vs ${fmt(prevStart)}`;\n\n    const within = (d?: Date | null, start?: Date, end?: Date) => !!(d && start && end && d >= start && d <= end);\n\n    // Filter base data for current period by the selected date range\n    const current = base.filter((it) => within(parseDate((it as any).firstVisitDate), currentStart, currentEnd));\n    \n    // Filter base data for previous period by previous month date range\n    const previous = base.filter((it) => within(parseDate((it as any).firstVisitDate), prevStart, prevEnd));\n\n    const isNew = (c: NewClientData) => String(c.isNew || '').toLowerCase().includes('new');\n    const isConverted = (c: NewClientData) => c.conversionStatus === 'Converted';\n    const isRetained = (c: NewClientData) => c.retentionStatus === 'Retained';\n\n    // Calculate current period metrics\n    const curNew = current.filter(isNew).length;\n    const curConverted = current.filter(isConverted).length;\n    const curRetained = current.filter(isRetained).length;\n\n    // Calculate previous period metrics\n    const prevNew = previous.filter(isNew).length;\n    const prevConverted = previous.filter(isConverted).length;\n    const prevRetained = previous.filter(isRetained).length;\n\n    const overallConvCur = curNew > 0 ? (curConverted / curNew) * 100 : 0;\n    const overallConvPrev = prevNew > 0 ? (prevConverted / prevNew) * 100 : 0;\n\n    const retentionCur = curNew > 0 ? (curRetained / curNew) * 100 : 0;\n    const retentionPrev = prevNew > 0 ? (prevRetained / prevNew) * 100 : 0;\n\n    const totalLTVCur = current.reduce((s, c) => s + (c.ltv || 0), 0);\n    const totalLTVPrev = previous.reduce((s, c) => s + (c.ltv || 0), 0);\n    const avgLTVCur = current.length > 0 ? totalLTVCur / current.length : 0;\n    const avgLTVPrev = previous.length > 0 ? totalLTVPrev / previous.length : 0;\n\n    // Year-over-year: same month last year\n    const prevYearAnchor = new Date(currentStart.getFullYear() - 1, currentStart.getMonth(), 15);\n    const prevYearStart = monthStart(prevYearAnchor);\n    const prevYearEnd = monthEnd(prevYearAnchor);\n\n    const previousYear = base.filter((it) => within(parseDate((it as any).firstVisitDate), prevYearStart, prevYearEnd));\n\n    const metrics = [\n      {\n        title: 'New Members',\n        value: formatNumber(curNew),\n        rawValue: curNew,\n        change: calcGrowth(curNew, prevNew).rate,\n        changeDetails: calcGrowth(curNew, prevNew),\n        previousValue: formatNumber(prevNew),\n        previousRawValue: prevNew,\n        yoyPreviousValue: formatNumber(previousYear.filter(isNew).length),\n        yoyPreviousRawValue: previousYear.filter(isNew).length,\n        yoyChange: calcGrowth(curNew, previousYear.filter(isNew).length).rate,\n        comparison: { current: curNew, previous: previousYear.filter(isNew).length, difference: curNew - previousYear.filter(isNew).length },\n        periodLabel,\n        icon: 'UserPlus',\n        description: 'Recently acquired clients',\n      },\n      {\n        title: 'Converted Members',\n        value: formatNumber(curConverted),\n        rawValue: curConverted,\n        change: calcGrowth(curConverted, prevConverted).rate,\n        changeDetails: calcGrowth(curConverted, prevConverted),\n        previousValue: formatNumber(prevConverted),\n        previousRawValue: prevConverted,\n        yoyPreviousValue: formatNumber(previousYear.filter(isConverted).length),\n        yoyPreviousRawValue: previousYear.filter(isConverted).length,\n        yoyChange: calcGrowth(curConverted, previousYear.filter(isConverted).length).rate,\n        comparison: { current: curConverted, previous: previousYear.filter(isConverted).length, difference: curConverted - previousYear.filter(isConverted).length },\n        periodLabel,\n        icon: 'Award',\n        description: 'Trial to paid conversions',\n      },\n      {\n        title: 'Retained Members',\n        value: formatNumber(curRetained),\n        rawValue: curRetained,\n        change: calcGrowth(curRetained, prevRetained).rate,\n        changeDetails: calcGrowth(curRetained, prevRetained),\n        previousValue: formatNumber(prevRetained),\n        previousRawValue: prevRetained,\n        yoyPreviousValue: formatNumber(previousYear.filter(isRetained).length),\n        yoyPreviousRawValue: previousYear.filter(isRetained).length,\n        yoyChange: calcGrowth(curRetained, previousYear.filter(isRetained).length).rate,\n        comparison: { current: curRetained, previous: previousYear.filter(isRetained).length, difference: curRetained - previousYear.filter(isRetained).length },\n        periodLabel,\n        icon: 'UserCheck',\n        description: 'Active retained clients',\n      },\n      {\n        title: 'Conversion Rate',\n        value: formatPercentage(overallConvCur),\n        rawValue: overallConvCur,\n        change: calcGrowth(overallConvCur, overallConvPrev).rate,\n        changeDetails: calcGrowth(overallConvCur, overallConvPrev),\n        previousValue: formatPercentage(overallConvPrev),\n        previousRawValue: overallConvPrev,\n        yoyPreviousValue: formatPercentage(previousYear.length > 0 ? (previousYear.filter(isConverted).length / previousYear.filter(isNew).length) * 100 : 0),\n        yoyPreviousRawValue: previousYear.length > 0 ? (previousYear.filter(isConverted).length / previousYear.filter(isNew).length) * 100 : 0,\n        yoyChange: calcGrowth(overallConvCur, previousYear.length > 0 ? (previousYear.filter(isConverted).length / previousYear.filter(isNew).length) * 100 : 0).rate,\n        comparison: { current: overallConvCur, previous: previousYear.length > 0 ? (previousYear.filter(isConverted).length / previousYear.filter(isNew).length) * 100 : 0, difference: overallConvCur - (previousYear.length > 0 ? (previousYear.filter(isConverted).length / previousYear.filter(isNew).length) * 100 : 0) },\n        periodLabel,\n        icon: 'TrendingUp',\n        description: 'New to converted rate',\n      },\n      {\n        title: 'Retention Rate',\n        value: formatPercentage(retentionCur),\n        rawValue: retentionCur,\n        change: calcGrowth(retentionCur, retentionPrev).rate,\n        changeDetails: calcGrowth(retentionCur, retentionPrev),\n        previousValue: formatPercentage(retentionPrev),\n        previousRawValue: retentionPrev,\n        yoyPreviousValue: formatPercentage(previousYear.length > 0 ? (previousYear.filter(isRetained).length / previousYear.filter(isNew).length) * 100 : 0),\n        yoyPreviousRawValue: previousYear.length > 0 ? (previousYear.filter(isRetained).length / previousYear.filter(isNew).length) * 100 : 0,\n        yoyChange: calcGrowth(retentionCur, previousYear.length > 0 ? (previousYear.filter(isRetained).length / previousYear.filter(isNew).length) * 100 : 0).rate,\n        comparison: { current: retentionCur, previous: previousYear.length > 0 ? (previousYear.filter(isRetained).length / previousYear.filter(isNew).length) * 100 : 0, difference: retentionCur - (previousYear.length > 0 ? (previousYear.filter(isRetained).length / previousYear.filter(isNew).length) * 100 : 0) },\n        periodLabel,\n        icon: 'Target',\n        description: 'Member retention rate',\n      },\n      {\n        title: 'Avg LTV',\n        value: formatCurrency(avgLTVCur),\n        rawValue: avgLTVCur,\n        change: calcGrowth(avgLTVCur, avgLTVPrev).rate,\n        changeDetails: calcGrowth(avgLTVCur, avgLTVPrev),\n        previousValue: formatCurrency(avgLTVPrev),\n        previousRawValue: avgLTVPrev,\n        yoyPreviousValue: formatCurrency(previousYear.length > 0 ? (previousYear.reduce((s, c) => s + (c.ltv || 0), 0) / previousYear.length) : 0),\n        yoyPreviousRawValue: previousYear.length > 0 ? (previousYear.reduce((s, c) => s + (c.ltv || 0), 0) / previousYear.length) : 0,\n        yoyChange: calcGrowth(avgLTVCur, previousYear.length > 0 ? (previousYear.reduce((s, c) => s + (c.ltv || 0), 0) / previousYear.length) : 0).rate,\n        comparison: { current: avgLTVCur, previous: previousYear.length > 0 ? (previousYear.reduce((s, c) => s + (c.ltv || 0), 0) / previousYear.length) : 0, difference: avgLTVCur - (previousYear.length > 0 ? (previousYear.reduce((s, c) => s + (c.ltv || 0), 0) / previousYear.length) : 0) },\n        periodLabel,\n        icon: 'DollarSign',\n        description: `Average lifetime value`,\n      },\n    ];\n\n    // Debug: log computed metrics and YoY values\n    // eslint-disable-next-line no-console\n    console.debug('useClientConversionMetrics -> metrics', metrics.map(m => ({ title: m.title, previous: (m as any).previousValue, yoyPrevious: (m as any).yoyPreviousValue, comparison: (m as any).comparison })));\n    return { metrics };\n  }, [data, historicalData, options?.dateRange?.start, options?.dateRange?.end]);\n}\n","import React from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Users, Target, TrendingUp, DollarSign, Clock, UserCheck, Award, UserPlus, ArrowRight, CalendarDays, Repeat, TrendingDown } from 'lucide-react';\nimport { formatCurrency, formatNumber, formatPercentage } from '@/utils/formatters';\nimport { NewClientData } from '@/types/dashboard';\nimport { useClientConversionMetrics, ClientMetricWithYoY } from '@/hooks/useClientConversionMetrics';\nimport { cn } from '@/lib/utils';\nimport { parseDate } from '@/hooks/useLeadsData';\n\ninterface ClientConversionMetricCardsProps {\n  data: NewClientData[];\n  historicalData?: NewClientData[];\n  dateRange?: { start?: string | Date; end?: string | Date };\n  onCardClick?: (title: string, data: NewClientData[], metricType: string) => void;\n}\n\nconst ClientConversionMetricCardsComponent: React.FC<ClientConversionMetricCardsProps> = ({ data, historicalData, dateRange, onCardClick }) => {\n  const { metrics } = useClientConversionMetrics(data, historicalData, { dateRange });\n  React.useEffect(() => {\n    console.debug('ClientConversion metrics:', metrics.slice(0, 6));\n  }, [metrics]);\n\n  const [showDebug, setShowDebug] = React.useState(false);\n  \n  // Calculate additional metrics\n  const avgConversionTime = React.useMemo(() => {\n    const withSpan = data.filter(c => c.conversionSpan && c.conversionSpan > 0);\n    if (withSpan.length === 0) return 0;\n    return withSpan.reduce((sum, c) => sum + (c.conversionSpan || 0), 0) / withSpan.length;\n  }, [data]);\n\n  const avgVisitsPostTrial = React.useMemo(() => {\n    const withVisits = data.filter(c => c.visitsPostTrial && c.visitsPostTrial > 0);\n    if (withVisits.length === 0) return 0;\n    return withVisits.reduce((sum, c) => sum + (c.visitsPostTrial || 0), 0) / withVisits.length;\n  }, [data]);\n\n  // For the two special metrics, compute previous period and YoY values using `historicalData` (which should be the filtered historical set)\n  const computeAvgForRange = (arr: typeof data, field: 'conversionSpan' | 'visitsPostTrial') => {\n    const filteredData = arr.filter(c => (c as any)[field] !== undefined && (c as any)[field] !== null && (c as any)[field] >= 0);\n    if (filteredData.length === 0) return 0;\n    const sum = filteredData.reduce((s, c) => s + ((c as any)[field] || 0), 0);\n    return sum / filteredData.length;\n  };\n\n  const getRangeAnchors = () => {\n    const compareEnd = dateRange?.end ? (typeof dateRange.end === 'string' ? new Date(dateRange.end) : dateRange.end as Date) : new Date();\n    const monthStart = (d: Date) => new Date(d.getFullYear(), d.getMonth(), 1);\n    const monthEnd = (d: Date) => new Date(d.getFullYear(), d.getMonth() + 1, 0, 23, 59, 59, 999);\n    const currentStart = monthStart(compareEnd);\n    const prevAnchor = new Date(currentStart.getFullYear(), currentStart.getMonth() - 1, 15);\n    const prevStart = monthStart(prevAnchor);\n    const prevEnd = monthEnd(prevAnchor);\n    const prevYearAnchor = new Date(currentStart.getFullYear() - 1, currentStart.getMonth(), 15);\n    const prevYearStart = monthStart(prevYearAnchor);\n    const prevYearEnd = monthEnd(prevYearAnchor);\n    return { prevStart, prevEnd, prevYearStart, prevYearEnd };\n  };\n\n  const { prevStart, prevEnd, prevYearStart, prevYearEnd } = getRangeAnchors();\n\n  const prevPeriodData = React.useMemo(() => {\n    if (!historicalData) return [] as typeof data;\n    return historicalData.filter(it => {\n      const d = parseDate((it as any).firstVisitDate);\n      return d && d >= prevStart && d <= prevEnd;\n    });\n  }, [historicalData, prevStart, prevEnd]);\n\n  const prevYearData = React.useMemo(() => {\n    if (!historicalData) return [] as typeof data;\n    return historicalData.filter(it => {\n      const d = parseDate((it as any).firstVisitDate);\n      return d && d >= prevYearStart && d <= prevYearEnd;\n    });\n  }, [historicalData, prevYearStart, prevYearEnd]);\n\n  const avgConversionTimePrev = React.useMemo(() => computeAvgForRange(prevPeriodData, 'conversionSpan'), [prevPeriodData]);\n  const avgConversionTimeYoY = React.useMemo(() => computeAvgForRange(prevYearData, 'conversionSpan'), [prevYearData]);\n\n  const avgVisitsPostTrialPrev = React.useMemo(() => computeAvgForRange(prevPeriodData, 'visitsPostTrial'), [prevPeriodData]);\n  const avgVisitsPostTrialYoY = React.useMemo(() => computeAvgForRange(prevYearData, 'visitsPostTrial'), [prevYearData]);\n  \n  React.useEffect(() => {\n    console.debug('YoY Debug:', {\n      prevYearDataLength: prevYearData.length,\n      avgConversionTimeYoY,\n      avgVisitsPostTrialYoY,\n      avgConversionTime,\n      avgVisitsPostTrial\n    });\n  }, [prevYearData, avgConversionTimeYoY, avgVisitsPostTrialYoY, avgConversionTime, avgVisitsPostTrial]);\n  \n  const iconMap: Record<string, any> = {\n    'New Members': UserPlus,\n    'Converted Members': Award,\n    'Retained Members': UserCheck,\n    'Conversion Rate': TrendingUp,\n    'Retention Rate': Target,\n    'Avg LTV': DollarSign,\n    'Avg Conversion Time': CalendarDays,\n    'Avg Visits Post-Trial': Repeat,\n  };\n  \n  const metricCards: ClientMetricWithYoY[] = [\n    ...metrics.map(m => ({\n      title: m.title,\n      value: m.value,\n      icon: iconMap[m.title] || Users,\n      gradient: 'from-slate-700 to-slate-800',\n      description: m.description,\n      change: m.change,\n      previousValue: m.previousValue,\n      period: m.periodLabel || 'vs previous month',\n      metricType: m.title.toLowerCase().replace(/\\s+/g, '_'),\n      // Include YoY fields from the underlying metrics so cards can render them\n      yoyPreviousValue: (m as any).yoyPreviousValue,\n      yoyPreviousRawValue: (m as any).yoyPreviousRawValue,\n      yoyChange: (m as any).yoyChange,\n      comparison: (m as any).comparison,\n      changeDetails: m.changeDetails,\n      filterData: () => {\n        switch (m.title) {\n          case 'New Members':\n            return data.filter(client => String(client.isNew || '').toLowerCase().includes('new'));\n          case 'Converted Members':\n            return data.filter(client => client.conversionStatus === 'Converted');\n          case 'Retained Members':\n            return data.filter(client => client.retentionStatus === 'Retained');\n          default:\n            return data;\n        }\n      }\n    } as ClientMetricWithYoY)),\n    {\n      title: 'Avg Conversion Time',\n      value: `${Math.round(avgConversionTime)} days`,\n      rawValue: avgConversionTime,\n      icon: CalendarDays,\n      gradient: 'from-slate-700 to-slate-800',\n      description: 'Average days to convert',\n      change: avgConversionTimePrev > 0 ? Math.round(((avgConversionTime - avgConversionTimePrev) / (avgConversionTimePrev || 1)) * 100) : 0,\n      previousValue: `${Math.round(avgConversionTimePrev)} days`,\n      period: '',\n      metricType: 'avg_conversion_time',\n      yoyPreviousValue: prevYearData.length > 0 ? `${Math.round(avgConversionTimeYoY)} days` : undefined,\n      yoyPreviousRawValue: avgConversionTimeYoY,\n      yoyChange: prevYearData.length > 0 ? (avgConversionTimeYoY === 0 ? (avgConversionTime > 0 ? 100 : 0) : Math.round(((avgConversionTime - avgConversionTimeYoY) / (avgConversionTimeYoY || 1)) * 100)) : undefined,\n      comparison: { current: avgConversionTime, previous: avgConversionTimeYoY || 0, difference: avgConversionTime - (avgConversionTimeYoY || 0) },\n      changeDetails: {\n        rate: avgConversionTimePrev > 0 ? Math.round(((avgConversionTime - avgConversionTimePrev) / (avgConversionTimePrev || 1)) * 100) : 0,\n        isSignificant: Math.abs(avgConversionTime - avgConversionTimePrev) > 1,\n        trend: avgConversionTime > avgConversionTimePrev ? 'moderate' : 'weak'\n      },\n      filterData: () => data.filter(c => c.conversionSpan && c.conversionSpan > 0)\n    } as ClientMetricWithYoY,\n    {\n      title: 'Avg Visits Post-Trial',\n      value: avgVisitsPostTrial.toFixed(1),\n      rawValue: avgVisitsPostTrial,\n      icon: Repeat,\n      gradient: 'from-slate-700 to-slate-800',\n      description: 'Average visits after trial',\n      change: avgVisitsPostTrialPrev > 0 ? Math.round(((avgVisitsPostTrial - avgVisitsPostTrialPrev) / (avgVisitsPostTrialPrev || 1)) * 100) : 0,\n      previousValue: avgVisitsPostTrialPrev.toFixed(1),\n      yoyPreviousValue: prevYearData.length > 0 ? avgVisitsPostTrialYoY.toFixed(1) : undefined,\n      yoyPreviousRawValue: avgVisitsPostTrialYoY,\n      yoyChange: prevYearData.length > 0 ? (avgVisitsPostTrialYoY === 0 ? (avgVisitsPostTrial > 0 ? 100 : 0) : Math.round(((avgVisitsPostTrial - avgVisitsPostTrialYoY) / (avgVisitsPostTrialYoY || 1)) * 100)) : undefined,\n      comparison: { current: avgVisitsPostTrial, previous: avgVisitsPostTrialYoY || 0, difference: avgVisitsPostTrial - (avgVisitsPostTrialYoY || 0) },\n      changeDetails: {\n        rate: avgVisitsPostTrialPrev > 0 ? Math.round(((avgVisitsPostTrial - avgVisitsPostTrialPrev) / (avgVisitsPostTrialPrev || 1)) * 100) : 0,\n        isSignificant: Math.abs(avgVisitsPostTrial - avgVisitsPostTrialPrev) > 0.1,\n        trend: avgVisitsPostTrial > avgVisitsPostTrialPrev ? 'moderate' : 'weak'\n      },\n      filterData: () => data.filter(c => c.visitsPostTrial && c.visitsPostTrial > 0)\n    } as ClientMetricWithYoY\n  ];\n\n  return (\n    <div className=\"container mx-auto px-6 py-8\">\n      <div className=\"flex justify-end mb-3\">\n        <button onClick={() => setShowDebug(s => !s)} className=\"text-xs text-slate-500 hover:text-slate-800\">{showDebug ? 'Hide' : 'Show'} metrics JSON</button>\n      </div>\n      {showDebug && (\n        <pre className=\"p-4 bg-slate-50 rounded mb-4 text-xs text-slate-700 overflow-auto max-h-80\">{JSON.stringify(metrics, null, 2)}</pre>\n      )}\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6\">\n        {metricCards.map((metric, index) => {\n          const Icon = metric.icon;\n          const change = typeof metric.change === 'number' ? metric.change : 0;\n          const isPositive = change > 0;\n          const isSignificant = Math.abs(change) >= 5;\n          \n          return (\n            <Card\n              key={index}\n              className={cn(\n                \"group relative overflow-hidden cursor-pointer transition-all duration-500 h-full flex flex-col\",\n                \"bg-white hover:bg-gradient-to-br hover:from-slate-900 hover:via-slate-900 hover:to-slate-950\",\n                \"border border-slate-200 hover:border-slate-800 border-t-4\",\n                \"shadow-md hover:shadow-2xl hover:shadow-slate-950/60\",\n                \"hover:-translate-y-1 hover:scale-[1.01]\",\n                index % 4 === 0 && \"border-t-emerald-500\",\n                index % 4 === 1 && \"border-t-blue-500\",\n                index % 4 === 2 && \"border-t-purple-500\",\n                index % 4 === 3 && \"border-t-rose-500\",\n                onCardClick && \"hover:cursor-pointer\"\n              )}\n              onClick={() => onCardClick?.(metric.title, metric.filterData(), metric.metricType)}\n            >\n              <CardContent className=\"p-5 relative flex-1 flex flex-col\">\n                <div className={cn(\n                  \"absolute inset-0 opacity-[0.03] group-hover:opacity-[0.08] transition-all duration-500\",\n                  index % 4 === 0 && \"bg-gradient-to-br from-emerald-500 to-teal-500\",\n                  index % 4 === 1 && \"bg-gradient-to-br from-blue-500 to-cyan-500\",\n                  index % 4 === 2 && \"bg-gradient-to-br from-purple-500 to-pink-500\",\n                  index % 4 === 3 && \"bg-gradient-to-br from-rose-500 to-orange-500\"\n                )} />\n\n                <div className=\"absolute top-3 right-3 opacity-[0.08] group-hover:opacity-[0.15] transition-all duration-700 ease-out group-hover:scale-110 group-hover:rotate-6\">\n                  <Icon className=\"w-20 h-20 text-slate-900 group-hover:text-white\" />\n                </div>\n\n                <div className=\"absolute inset-0 opacity-[0.02] group-hover:opacity-[0.04] transition-opacity duration-500\" \n                     style={{backgroundImage: 'radial-gradient(circle at 2px 2px, currentColor 1px, transparent 0)', backgroundSize: '24px 24px'}} />\n\n                <div className=\"relative z-10 space-y-2.5\">\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex items-center gap-2.5\">\n                      <div className={cn(\n                        \"p-2.5 rounded-xl shadow-sm transition-all duration-500 group-hover:scale-110 group-hover:shadow-md\",\n                        index % 4 === 0 && \"bg-gradient-to-br from-emerald-500/15 to-emerald-600/10 text-emerald-700 group-hover:from-emerald-500/25 group-hover:to-emerald-600/20 group-hover:text-emerald-400 group-hover:shadow-emerald-500/20\",\n                        index % 4 === 1 && \"bg-gradient-to-br from-blue-500/15 to-blue-600/10 text-blue-700 group-hover:from-blue-500/25 group-hover:to-blue-600/20 group-hover:text-blue-400 group-hover:shadow-blue-500/20\",\n                        index % 4 === 2 && \"bg-gradient-to-br from-purple-500/15 to-purple-600/10 text-purple-700 group-hover:from-purple-500/25 group-hover:to-purple-600/20 group-hover:text-purple-400 group-hover:shadow-purple-500/20\",\n                        index % 4 === 3 && \"bg-gradient-to-br from-rose-500/15 to-rose-600/10 text-rose-700 group-hover:from-rose-500/25 group-hover:to-rose-600/20 group-hover:text-rose-400 group-hover:shadow-rose-500/20\"\n                      )}>\n                        <Icon className=\"w-5 h-5\" />\n                      </div>\n                      <div>\n                        <h3 className={cn(\n                          \"font-bold text-sm text-slate-700 transition-all duration-500 leading-tight\",\n                          \"group-hover:text-white group-hover:underline group-hover:underline-offset-4 group-hover:decoration-2\",\n                          index % 4 === 0 && \"group-hover:decoration-emerald-400\",\n                          index % 4 === 1 && \"group-hover:decoration-blue-400\",\n                          index % 4 === 2 && \"group-hover:decoration-purple-400\",\n                          index % 4 === 3 && \"group-hover:decoration-rose-400\"\n                        )}>\n                          {metric.title}\n                        </h3>\n                        <p className=\"text-[9px] text-slate-500 group-hover:text-slate-400 transition-colors duration-500 mt-0.5 uppercase tracking-wide font-semibold\">\n                          Current Period\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className={cn(\n                    \"p-2.5 rounded-lg transition-all duration-500\",\n                    \"bg-slate-50 group-hover:bg-slate-800/30\",\n                    \"border border-slate-100 group-hover:border-slate-700/50\"\n                  )}>\n                    <p className=\"text-3xl font-bold text-slate-900 group-hover:text-white transition-colors duration-500 tracking-tight\">\n                      {metric.value}\n                    </p>\n                    <div className=\"flex items-center gap-2 mt-1\">\n                      <div className={cn(\n                        \"h-0.5 flex-1 rounded-full transition-all duration-500\",\n                        metric.change > 0 && \"bg-emerald-200 group-hover:bg-emerald-500/40\",\n                        metric.change < 0 && \"bg-rose-200 group-hover:bg-rose-500/40\",\n                        metric.change === 0 && \"bg-slate-200 group-hover:bg-slate-500/40\"\n                      )} />\n                      <div className=\"flex items-center gap-1\">\n                        {metric.change > 0 && <TrendingUp className=\"w-3 h-3 text-emerald-600 group-hover:text-emerald-400\" />}\n                        {metric.change < 0 && <TrendingDown className=\"w-3 h-3 text-rose-600 group-hover:text-rose-400\" />}\n                        {metric.change === 0 && <TrendingDown className=\"w-3 h-3 text-slate-600 group-hover:text-slate-400\" />}\n                        <span className={cn(\n                          \"text-[10px] font-bold transition-colors duration-500\",\n                          metric.change > 0 && \"text-emerald-600 group-hover:text-emerald-400\",\n                          metric.change < 0 && \"text-rose-600 group-hover:text-rose-400\",\n                          metric.change === 0 && \"text-slate-600 group-hover:text-slate-400\"\n                        )}>\n                          {metric.changeDetails?.trend || (metric.change > 0 ? 'up' : metric.change < 0 ? 'down' : 'stable')}\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-2 mt-auto\">\n                    <div className={cn(\n                      \"p-2.5 rounded-lg border transition-all duration-500 min-h-[100px] flex flex-col justify-between\",\n                      \"bg-white/50 group-hover:bg-slate-800/20\",\n                      \"border-slate-200 group-hover:border-slate-700/50\"\n                    )}>\n                      <div className=\"text-[9px] font-bold text-slate-500 group-hover:text-slate-400 uppercase tracking-wider mb-1 transition-colors duration-500\">\n                        Month over Month\n                      </div>\n                      <div className=\"flex items-baseline gap-1.5 mb-1.5\">\n                        <span className=\"text-sm font-bold text-slate-700 group-hover:text-white transition-colors duration-500 tabular-nums\">\n                          {metric.previousValue}\n                        </span>\n                        <span className=\"text-[8px] text-slate-400 group-hover:text-slate-500 transition-colors duration-500\">prev</span>\n                      </div>\n                      <div className={cn(\n                        \"inline-flex items-center justify-center gap-1 px-3 py-1.5 rounded-lg font-bold text-[11px] tabular-nums transition-all duration-500 min-w-[65px]\",\n                        metric.change > 0 && \"bg-emerald-900/90 text-white group-hover:bg-emerald-800 group-hover:shadow-lg group-hover:shadow-emerald-900/40\",\n                        metric.change < 0 && \"bg-rose-900/90 text-white group-hover:bg-rose-800 group-hover:shadow-lg group-hover:shadow-rose-900/40\",\n                        metric.change === 0 && \"bg-slate-700/90 text-white group-hover:bg-slate-600 group-hover:shadow-lg\"\n                      )}>\n                        {metric.change > 0 && <TrendingUp className=\"w-3.5 h-3.5 flex-shrink-0\" />}\n                        {metric.change < 0 && <TrendingDown className=\"w-3.5 h-3.5 flex-shrink-0\" />}\n                        <span>{metric.change > 0 ? '+' : ''}{Math.round(metric.change || 0)}%</span>\n                      </div>\n                    </div>\n\n                    <div className={cn(\n                      \"p-2.5 rounded-lg border transition-all duration-500 min-h-[100px] flex flex-col justify-between\",\n                      metric.yoyChange !== undefined \n                        ? \"bg-white/50 group-hover:bg-slate-800/20 border-slate-200 group-hover:border-slate-700/50\"\n                        : \"bg-slate-50/50 group-hover:bg-slate-800/10 border-slate-200 group-hover:border-slate-700/30\"\n                    )}>\n                      {(metric.yoyPreviousValue !== undefined || metric.comparison?.previous !== undefined) ? (\n                        <>\n                          <div className=\"text-[9px] font-bold text-slate-500 group-hover:text-slate-400 uppercase tracking-wider mb-1 transition-colors duration-500\">\n                            Year over Year\n                          </div>\n                          <div className=\"flex items-baseline gap-1.5 mb-1.5\">\n                            <span className=\"text-sm font-bold text-slate-700 group-hover:text-white transition-colors duration-500 tabular-nums\">\n                              {metric.yoyPreviousValue ?? (\n                                metric.comparison?.previous !== undefined ? (\n                                  // Fallback formatting based on metric type\n                                  (metric.title.toLowerCase().includes('rate') || metric.title.toLowerCase().includes('conversion'))\n                                    ? formatPercentage(metric.comparison.previous)\n                                    : metric.title.toLowerCase().includes('ltv') || metric.title.toLowerCase().includes('revenue')\n                                      ? formatCurrency(metric.comparison.previous)\n                                      : formatNumber(metric.comparison.previous)\n                                ) : '—'\n                              )}\n                            </span>\n                            <span className=\"text-[8px] text-slate-400 group-hover:text-slate-500 transition-colors duration-500\">last year</span>\n                          </div>\n                          <div className={cn(\n                            \"inline-flex items-center justify-center gap-1 px-3 py-1.5 rounded-lg font-bold text-[11px] tabular-nums transition-all duration-500 min-w-[65px]\",\n                            metric.yoyChange > 0 && \"bg-emerald-900/90 text-white group-hover:bg-emerald-800 group-hover:shadow-lg group-hover:shadow-emerald-900/40\",\n                            metric.yoyChange < 0 && \"bg-rose-900/90 text-white group-hover:bg-rose-800 group-hover:shadow-lg group-hover:shadow-rose-900/40\",\n                            metric.yoyChange === 0 && \"bg-slate-700/90 text-white group-hover:bg-slate-600 group-hover:shadow-lg\"\n                          )}>\n                            {metric.yoyChange > 0 && <TrendingUp className=\"w-3.5 h-3.5 flex-shrink-0\" />}\n                            {metric.yoyChange < 0 && <TrendingDown className=\"w-3.5 h-3.5 flex-shrink-0\" />}\n                            <span>{metric.yoyChange > 0 ? '+' : ''}{Math.round(metric.yoyChange || 0)}%</span>\n                          </div>\n                        </>\n                      ) : (\n                        <span className=\"text-[9px] text-slate-400 group-hover:text-slate-500 transition-colors duration-500 font-semibold\">\n                          No YoY Data\n                        </span>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className={cn(\n                    \"relative pt-1.5 border-l-3 pl-3 transition-all duration-500\",\n                    \"before:absolute before:left-0 before:top-0 before:w-1 before:h-full before:rounded-r-full before:transition-all before:duration-500\",\n                    index % 4 === 0 && \"border-l-emerald-500/50 group-hover:border-l-emerald-400 before:bg-emerald-500/20 group-hover:before:bg-emerald-400/30\",\n                    index % 4 === 1 && \"border-l-blue-500/50 group-hover:border-l-blue-400 before:bg-blue-500/20 group-hover:before:bg-blue-400/30\",\n                    index % 4 === 2 && \"border-l-purple-500/50 group-hover:border-l-purple-400 before:bg-purple-500/20 group-hover:before:bg-purple-400/30\",\n                    index % 4 === 3 && \"border-l-rose-500/50 group-hover:border-l-rose-400 before:bg-rose-500/20 group-hover:before:bg-rose-400/30\"\n                  )}>\n                    <p className=\"text-xs text-slate-600 group-hover:text-slate-300 leading-snug transition-colors duration-500 line-clamp-2 font-medium\">\n                      {metric.description}\n                    </p>\n                  </div>\n\n                  <div className={cn(\n                    \"pt-2 space-y-2 border-t transition-all duration-500 overflow-hidden\",\n                    \"max-h-0 opacity-0 group-hover:max-h-40 group-hover:opacity-100\",\n                    index % 4 === 0 && \"border-emerald-200 group-hover:border-emerald-500/30\",\n                    index % 4 === 1 && \"border-blue-200 group-hover:border-blue-500/30\",\n                    index % 4 === 2 && \"border-purple-200 group-hover:border-purple-500/30\",\n                    index % 4 === 3 && \"border-rose-200 group-hover:border-rose-500/30\"\n                  )}>\n                    <div className=\"text-xs space-y-1\">\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-slate-400 font-medium\">Trend:</span>\n                        <span className=\"text-white font-semibold\">{metric.changeDetails?.trend || ''}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-slate-400 font-medium\">Difference:</span>\n                        <span className=\"text-white font-semibold\">{Math.abs(metric.comparison?.difference || 0)}</span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\n// Memoize to prevent unnecessary re-renders\nexport const ClientConversionMetricCards = React.memo(ClientConversionMetricCardsComponent);\n\n// Temporary fix for Icon component type\nconst Icon = ({ className }: { className?: string }) => <svg className={className}></svg>; // Updated to accept optional className","import React, { useMemo, useState, useRef, useEffect, useCallback } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Calendar, TrendingUp, ArrowUpDown } from 'lucide-react';\nimport CopyTableButton from '@/components/ui/CopyTableButton';\nimport { useMetricsTablesRegistry } from '@/contexts/MetricsTablesRegistryContext';\nimport { NewClientData } from '@/types/dashboard';\nimport { parseDate } from '@/utils/dateUtils';\nimport { formatCurrency, formatNumber } from '@/utils/formatters';\n\ntype MetricKey =\n  | 'trials'\n  | 'newMembers'\n  | 'converted'\n  | 'retained'\n  | 'retentionRate'\n  | 'conversionRate'\n  | 'avgLTV'\n  | 'totalLTV'\n  | 'avgConversionDays'\n  | 'avgVisits';\n\nconst METRIC_LABELS: Record<MetricKey, string> = {\n  trials: 'Trials',\n  newMembers: 'New Members',\n  converted: 'Converted',\n  retained: 'Retained',\n  retentionRate: 'Retention %',\n  conversionRate: 'Conversion %',\n  avgLTV: 'Avg LTV',\n  totalLTV: 'Total LTV',\n  avgConversionDays: 'Avg Conv Days',\n  avgVisits: 'Avg Visits',\n};\n\ninterface ClientRetentionMonthByTypePivotProps {\n  data: NewClientData[];\n  visitsSummary?: Record<string, number>;\n  onRowClick?: (data: any) => void;\n}\n\nexport const ClientRetentionMonthByTypePivot: React.FC<ClientRetentionMonthByTypePivotProps> = ({ data, visitsSummary, onRowClick }) => {\n  const [metric, setMetric] = useState<MetricKey>('trials');\n  const [displayMode, setDisplayMode] = useState<'values' | 'growth'>('values');\n  const [sortColumn, setSortColumn] = useState<string | null>(null);\n  const [sortDir, setSortDir] = useState<'asc' | 'desc'>('desc');\n  const containerRef = useRef<HTMLDivElement>(null);\n  const registry = useMetricsTablesRegistry();\n  const tableId = 'Client Retention MoM by Type Pivot';\n\n  const months = useMemo(() => {\n    const arr: { key: string; label: string; year: number; month: number }[] = [];\n    const startDate = new Date(2024, 0, 1); // Jan 2024\n    const now = new Date();\n    const currentMonth = now.getMonth();\n    const currentYear = now.getFullYear();\n    \n    // Calculate number of months from Jan 2024 to current month\n    const monthsDiff = (currentYear - 2024) * 12 + currentMonth;\n    \n    for (let i = 0; i <= monthsDiff; i++) {\n      const d = new Date(2024, i, 1);\n      const key = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;\n      const label = d.toLocaleDateString('en-US', { month: 'short', year: '2-digit' });\n      arr.push({ key, label, year: d.getFullYear(), month: d.getMonth() + 1 });\n    }\n    return arr; // Jan 2024 first, current month last\n  }, []);\n\n  const clientTypes = useMemo(() => {\n    const set = new Set<string>();\n    data.forEach(c => set.add(c.isNew || 'Unknown'));\n    return Array.from(set).sort((a, b) => {\n      const an = a.toLowerCase();\n      const bn = b.toLowerCase();\n      if (an.includes('new') && !bn.includes('new')) return -1;\n      if (!an.includes('new') && bn.includes('new')) return 1;\n      return a.localeCompare(b);\n    });\n  }, [data]);\n\n  const pivot = useMemo(() => {\n    // Build a nested map: type -> monthKey -> stats\n    const map: Record<string, Record<string, any>> = {};\n    // Pre-initialize\n    clientTypes.forEach(t => {\n      map[t] = {};\n      months.forEach((m, idx) => {\n        // visitsSummary comes as 'Jan 2024'\n        const dt = new Date(m.year, m.month - 1, 1);\n        const summaryKey = dt.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });\n        map[t][m.key] = {\n          trials: 0,\n          newMembers: 0,\n          converted: 0,\n          retained: 0,\n          totalLTV: 0,\n          conversionIntervals: [] as number[],\n          visitsPostTrial: [] as number[],\n          visits: visitsSummary?.[summaryKey] || 0,\n          previous: idx < months.length - 1 ? null : undefined, // will link to prev month\n          clients: [] as NewClientData[], // Store actual client data for drill-down\n        };\n      });\n    });\n\n    data.forEach(c => {\n      const d = parseDate(c.firstVisitDate || '');\n      if (!d) return;\n      const key = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;\n      if (!months.find(m => m.key === key)) return; // restrict to the 22 months window\n      const type = c.isNew || 'Unknown';\n      const cell = map[type]?.[key];\n      if (!cell) return;\n\n      cell.trials += 1;\n      if ((c.isNew || '').toLowerCase().includes('new')) cell.newMembers += 1;\n      if (c.conversionStatus === 'Converted') cell.converted += 1;\n      if (c.retentionStatus === 'Retained') cell.retained += 1;\n      cell.totalLTV += c.ltv || 0;\n      if (c.conversionSpan && c.conversionSpan > 0) cell.conversionIntervals.push(c.conversionSpan);\n      if (c.visitsPostTrial && c.visitsPostTrial > 0) cell.visitsPostTrial.push(c.visitsPostTrial);\n      cell.clients.push(c); // Add client to the cell's client array\n    });\n\n    // Compute derived metrics and link previous\n    clientTypes.forEach(t => {\n      months.forEach((m, idx) => {\n        const cell = map[t][m.key];\n        const avgLTV = cell.trials > 0 ? cell.totalLTV / cell.trials : 0;\n        const avgConversionDays = cell.conversionIntervals.length > 0\n          ? cell.conversionIntervals.reduce((a: number, b: number) => a + b, 0) / cell.conversionIntervals.length\n          : 0;\n        const avgVisits = cell.visitsPostTrial.length > 0\n          ? cell.visitsPostTrial.reduce((a: number, b: number) => a + b, 0) / cell.visitsPostTrial.length\n          : 0;\n        const conversionRate = cell.newMembers > 0 ? (cell.converted / cell.newMembers) * 100 : 0;\n        const retentionRate = cell.newMembers > 0 ? (cell.retained / cell.newMembers) * 100 : 0;\n        \n        // Link to previous month (next in array since newest first)\n        const prevMonthKey = months[idx + 1]?.key;\n        const previous = prevMonthKey ? map[t][prevMonthKey] : null;\n        \n        map[t][m.key] = {\n          ...cell,\n          avgLTV,\n          avgConversionDays,\n          avgVisits,\n          conversionRate,\n          retentionRate,\n          previous,\n        };\n      });\n    });\n\n    return map;\n  }, [data, clientTypes, months, visitsSummary]);\n\n  const renderValue = (cell: any, monthIdx: number) => {\n    let value: string;\n    switch (metric) {\n      case 'trials': value = formatNumber(cell.trials || 0); break;\n      case 'newMembers': value = formatNumber(cell.newMembers || 0); break;\n      case 'converted': value = formatNumber(cell.converted || 0); break;\n      case 'retained': value = formatNumber(cell.retained || 0); break;\n      case 'retentionRate': value = `${(cell.retentionRate || 0).toFixed(1)}%`; break;\n      case 'conversionRate': value = `${(cell.conversionRate || 0).toFixed(1)}%`; break;\n      case 'avgLTV': value = formatCurrency(cell.avgLTV || 0); break;\n      case 'totalLTV': value = formatCurrency(cell.totalLTV || 0); break;\n      case 'avgConversionDays': value = `${Math.round(cell.avgConversionDays || 0)}`; break;\n      case 'avgVisits': value = (cell.avgVisits || 0).toFixed(1); break;\n      default: value = '0';\n    }\n\n    if (displayMode === 'growth' && monthIdx < months.length - 1) {\n      const prevCell = cell.previous;\n      if (!prevCell) return <span className=\"text-slate-400 text-xs\">—</span>;\n      \n      let current = 0, previous = 0;\n      switch (metric) {\n        case 'trials': current = cell.trials || 0; previous = prevCell.trials || 0; break;\n        case 'newMembers': current = cell.newMembers || 0; previous = prevCell.newMembers || 0; break;\n        case 'converted': current = cell.converted || 0; previous = prevCell.converted || 0; break;\n        case 'retained': current = cell.retained || 0; previous = prevCell.retained || 0; break;\n        case 'retentionRate': current = cell.retentionRate || 0; previous = prevCell.retentionRate || 0; break;\n        case 'conversionRate': current = cell.conversionRate || 0; previous = prevCell.conversionRate || 0; break;\n        case 'avgLTV': current = cell.avgLTV || 0; previous = prevCell.avgLTV || 0; break;\n        case 'totalLTV': current = cell.totalLTV || 0; previous = prevCell.totalLTV || 0; break;\n        case 'avgConversionDays': current = cell.avgConversionDays || 0; previous = prevCell.avgConversionDays || 0; break;\n        case 'avgVisits': current = cell.avgVisits || 0; previous = prevCell.avgVisits || 0; break;\n      }\n\n      const growth = previous !== 0 ? ((current - previous) / previous) * 100 : 0;\n      const isPositive = growth >= 0;\n      \n      return (\n        <span className={`text-xs font-semibold ${isPositive ? 'text-emerald-600' : 'text-rose-600'}`}>\n          {isPositive ? '▲' : '▼'} {Math.abs(growth).toFixed(1)}%\n        </span>\n      );\n    }\n\n    return <span className=\"text-sm font-medium text-slate-800\">{value}</span>;\n  };\n\n  // Render value with white text for totals row\n  const renderValueWhite = (cell: any, monthIdx: number) => {\n    let value: string;\n    switch (metric) {\n      case 'trials': value = formatNumber(cell.trials || 0); break;\n      case 'newMembers': value = formatNumber(cell.newMembers || 0); break;\n      case 'converted': value = formatNumber(cell.converted || 0); break;\n      case 'retained': value = formatNumber(cell.retained || 0); break;\n      case 'retentionRate': value = `${(cell.retentionRate || 0).toFixed(1)}%`; break;\n      case 'conversionRate': value = `${(cell.conversionRate || 0).toFixed(1)}%`; break;\n      case 'avgLTV': value = formatCurrency(cell.avgLTV || 0); break;\n      case 'totalLTV': value = formatCurrency(cell.totalLTV || 0); break;\n      case 'avgConversionDays': value = `${Math.round(cell.avgConversionDays || 0)}`; break;\n      case 'avgVisits': value = (cell.avgVisits || 0).toFixed(1); break;\n      default: value = '0';\n    }\n\n    if (displayMode === 'growth' && monthIdx < months.length - 1) {\n      const prevCell = cell.previous;\n      if (!prevCell) return <span className=\"text-white/60 text-xs\">—</span>;\n      \n      let current = 0, previous = 0;\n      switch (metric) {\n        case 'trials': current = cell.trials || 0; previous = prevCell.trials || 0; break;\n        case 'newMembers': current = cell.newMembers || 0; previous = prevCell.newMembers || 0; break;\n        case 'converted': current = cell.converted || 0; previous = prevCell.converted || 0; break;\n        case 'retained': current = cell.retained || 0; previous = prevCell.retained || 0; break;\n        case 'retentionRate': current = cell.retentionRate || 0; previous = prevCell.retentionRate || 0; break;\n        case 'conversionRate': current = cell.conversionRate || 0; previous = prevCell.conversionRate || 0; break;\n        case 'avgLTV': current = cell.avgLTV || 0; previous = prevCell.avgLTV || 0; break;\n        case 'totalLTV': current = cell.totalLTV || 0; previous = prevCell.totalLTV || 0; break;\n        case 'avgConversionDays': current = cell.avgConversionDays || 0; previous = prevCell.avgConversionDays || 0; break;\n        case 'avgVisits': current = cell.avgVisits || 0; previous = prevCell.avgVisits || 0; break;\n      }\n\n      const growth = previous !== 0 ? ((current - previous) / previous) * 100 : 0;\n      const isPositive = growth >= 0;\n      \n      return (\n        <span className=\"text-xs font-semibold text-white\">\n          {isPositive ? '▲' : '▼'} {Math.abs(growth).toFixed(1)}%\n        </span>\n      );\n    }\n\n    return <span className=\"text-sm font-medium text-white\">{value}</span>;\n  };\n\n  // Build sortable data\n  const sortedTypes = useMemo(() => {\n    if (!sortColumn) return clientTypes;\n    \n    const sorted = [...clientTypes].sort((a, b) => {\n      if (sortColumn === 'type') return a.localeCompare(b);\n      \n      const aCell = pivot[a]?.[sortColumn];\n      const bCell = pivot[b]?.[sortColumn];\n      if (!aCell || !bCell) return 0;\n      \n      let aVal = 0, bVal = 0;\n      switch (metric) {\n        case 'trials': aVal = aCell.trials || 0; bVal = bCell.trials || 0; break;\n        case 'newMembers': aVal = aCell.newMembers || 0; bVal = bCell.newMembers || 0; break;\n        case 'converted': aVal = aCell.converted || 0; bVal = bCell.converted || 0; break;\n        case 'retained': aVal = aCell.retained || 0; bVal = bCell.retained || 0; break;\n        case 'retentionRate': aVal = aCell.retentionRate || 0; bVal = bCell.retentionRate || 0; break;\n        case 'conversionRate': aVal = aCell.conversionRate || 0; bVal = bCell.conversionRate || 0; break;\n        case 'avgLTV': aVal = aCell.avgLTV || 0; bVal = bCell.avgLTV || 0; break;\n        case 'totalLTV': aVal = aCell.totalLTV || 0; bVal = bCell.totalLTV || 0; break;\n        case 'avgConversionDays': aVal = aCell.avgConversionDays || 0; bVal = bCell.avgConversionDays || 0; break;\n        case 'avgVisits': aVal = aCell.avgVisits || 0; bVal = bCell.avgVisits || 0; break;\n      }\n      \n      return sortDir === 'desc' ? bVal - aVal : aVal - bVal;\n    });\n    \n    return sorted;\n  }, [clientTypes, sortColumn, sortDir, pivot, metric]);\n\n  const handleSort = (col: string) => {\n    if (sortColumn === col) {\n      setSortDir(d => d === 'desc' ? 'asc' : 'desc');\n    } else {\n      setSortColumn(col);\n      setSortDir('desc');\n    }\n  };\n\n  // Calculate totals row\n  const totalsRow = useMemo(() => {\n    const totals: Record<string, any> = {};\n    months.forEach(m => {\n      const aggregated = {\n        trials: 0,\n        newMembers: 0,\n        converted: 0,\n        retained: 0,\n        totalLTV: 0,\n        conversionIntervals: [] as number[],\n        visitsPostTrial: [] as number[],\n        clients: [] as NewClientData[], // Aggregate clients for drill-down\n      };\n      \n      clientTypes.forEach(t => {\n        const cell = pivot[t]?.[m.key];\n        if (!cell) return;\n        aggregated.trials += cell.trials || 0;\n        aggregated.newMembers += cell.newMembers || 0;\n        aggregated.converted += cell.converted || 0;\n        aggregated.retained += cell.retained || 0;\n        aggregated.totalLTV += cell.totalLTV || 0;\n        aggregated.conversionIntervals.push(...(cell.conversionIntervals || []));\n        aggregated.visitsPostTrial.push(...(cell.visitsPostTrial || []));\n        aggregated.clients.push(...(cell.clients || [])); // Add all clients from this cell\n      });\n\n      const avgLTV = aggregated.trials > 0 ? aggregated.totalLTV / aggregated.trials : 0;\n      const avgConversionDays = aggregated.conversionIntervals.length > 0\n        ? aggregated.conversionIntervals.reduce((a: number, b: number) => a + b, 0) / aggregated.conversionIntervals.length\n        : 0;\n      const avgVisits = aggregated.visitsPostTrial.length > 0\n        ? aggregated.visitsPostTrial.reduce((a: number, b: number) => a + b, 0) / aggregated.visitsPostTrial.length\n        : 0;\n      const conversionRate = aggregated.newMembers > 0 ? (aggregated.converted / aggregated.newMembers) * 100 : 0;\n      const retentionRate = aggregated.newMembers > 0 ? (aggregated.retained / aggregated.newMembers) * 100 : 0;\n\n      totals[m.key] = {\n        ...aggregated,\n        avgLTV,\n        avgConversionDays,\n        avgVisits,\n        conversionRate,\n        retentionRate,\n      };\n    });\n    return totals;\n  }, [pivot, clientTypes, months]);\n\n  // Copy-all: include ALL metrics across ALL months and types (values mode)\n  const generateAllTabsContent = useCallback(() => {\n    const sections: string[] = [];\n    sections.push(`${tableId} - All Metrics Export`);\n    sections.push(`Exported on ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}`);\n    sections.push('');\n\n    const metricKeys = Object.keys(METRIC_LABELS) as MetricKey[];\n\n    const formatVal = (metricKey: MetricKey, cell: any) => {\n      switch (metricKey) {\n        case 'trials': return formatNumber(cell?.trials || 0);\n        case 'newMembers': return formatNumber(cell?.newMembers || 0);\n        case 'converted': return formatNumber(cell?.converted || 0);\n        case 'retained': return formatNumber(cell?.retained || 0);\n        case 'retentionRate': return `${(cell?.retentionRate || 0).toFixed(1)}%`;\n        case 'conversionRate': return `${(cell?.conversionRate || 0).toFixed(1)}%`;\n        case 'avgLTV': return formatCurrency(cell?.avgLTV || 0);\n        case 'totalLTV': return formatCurrency(cell?.totalLTV || 0);\n        case 'avgConversionDays': return `${Math.round(cell?.avgConversionDays || 0)}`;\n        case 'avgVisits': return `${(cell?.avgVisits || 0).toFixed(1)}`;\n      }\n    };\n\n    metricKeys.forEach(mk => {\n      sections.push(`\\n${METRIC_LABELS[mk].toUpperCase()}`);\n      const headers = ['Client Type', ...months.map(m => m.label)];\n      sections.push(headers.join('\\t'));\n      sections.push(headers.map(() => '---').join('\\t'));\n\n      clientTypes.forEach(t => {\n        const row: string[] = [t];\n        months.forEach(m => {\n          const cell = pivot[t]?.[m.key];\n          row.push(formatVal(mk, cell) as string);\n        });\n        sections.push(row.join('\\t'));\n      });\n\n      // Totals row\n      const totalRow: string[] = ['TOTALS'];\n      months.forEach(m => {\n        const cell = totalsRow[m.key];\n        totalRow.push(formatVal(mk, cell) as string);\n      });\n      sections.push(totalRow.join('\\t'));\n    });\n\n    return sections.join('\\n');\n  }, [clientTypes, months, pivot, totalsRow, tableId]);\n\n  useEffect(() => {\n    if (!registry) return;\n    const el = containerRef.current;\n    if (!el) return;\n    const getTextContent = () => {\n      const table = el.querySelector('table');\n      if (!table) return `${tableId} (No Data)`;\n      let text = `${tableId}\\nMetric: ${METRIC_LABELS[metric]} | Mode: ${displayMode}\\n`;\n      // Build header row\n      const headerCells = table.querySelectorAll('thead th');\n      const headers: string[] = [];\n      headerCells.forEach(h => headers.push((h.textContent || '').trim().replace(/Prev \\| Curr/i, '').trim()));\n      if (headers.length) {\n        text += headers.join('\\t') + '\\n';\n        text += headers.map(() => '---').join('\\t') + '\\n';\n      }\n      // Body rows\n      const rows = table.querySelectorAll('tbody tr');\n      rows.forEach(r => {\n        const cells = r.querySelectorAll('td');\n        const rowData: string[] = [];\n        cells.forEach(c => rowData.push((c.textContent || '').trim()));\n        if (rowData.length) text += rowData.join('\\t') + '\\n';\n      });\n      return text.trim();\n    };\n    registry.register({ id: tableId, getTextContent });\n    return () => registry.unregister(tableId);\n  }, [registry, metric, displayMode, pivot, sortedTypes]);\n\n  return (\n    <Card ref={containerRef} className=\"bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-shadow duration-300\">\n      <div className=\"absolute inset-x-0 top-0 h-1.5 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500\" />\n      <CardHeader className=\"border-b border-gray-100 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white pt-4\">\n        <div className=\"flex flex-col gap-3\">\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"flex items-center gap-2\">\n              <Calendar className=\"w-5 h-5\" />\n              Month-on-Month by Client Type\n              <Badge variant=\"secondary\" className=\"bg-white/20 text-white\">Last 22 months</Badge>\n              <div className=\"ml-4\">\n                <CopyTableButton\n                  tableRef={containerRef as any}\n                  tableName={tableId}\n                  size=\"sm\"\n                  onCopyAllTabs={async () => generateAllTabsContent()}\n                />\n              </div>\n            </CardTitle>\n            <div className=\"flex items-center gap-2\">\n              <Button\n                size=\"sm\"\n                variant={displayMode === 'values' ? 'default' : 'outline'}\n                onClick={() => setDisplayMode('values')}\n                className={displayMode === 'values' ? 'bg-gradient-to-r from-slate-700 to-slate-800 text-white hover:from-slate-600 hover:to-slate-700' : 'bg-white/10 text-white hover:bg-white/20 border-white/30'}\n              >\n                Values\n              </Button>\n              <Button\n                size=\"sm\"\n                variant={displayMode === 'growth' ? 'default' : 'outline'}\n                onClick={() => setDisplayMode('growth')}\n                className={displayMode === 'growth' ? 'bg-gradient-to-r from-slate-700 to-slate-800 text-white hover:from-slate-600 hover:to-slate-700' : 'bg-white/10 text-white hover:bg-white/20 border-white/30'}\n              >\n                Growth %\n              </Button>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            {(Object.keys(METRIC_LABELS) as MetricKey[]).map(k => (\n              <button\n                key={k}\n                onClick={() => setMetric(k)}\n                className={`px-3 py-1.5 rounded-md text-xs font-semibold transition-all min-w-[90px] ${metric === k ? 'bg-white text-indigo-700 shadow-md' : 'bg-white/10 text-white hover:bg-white/20'}`}\n                title={METRIC_LABELS[k]}\n              >\n                {METRIC_LABELS[k]}\n              </button>\n            ))}\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent className=\"p-0\">\n  <div className=\"overflow-x-auto max-h-[900px] relative\">\n          <table className=\"min-w-full relative\">\n            <thead>\n              <tr className=\"bg-gradient-to-r from-purple-900 via-purple-950 to-purple-900 text-white sticky top-0 z-10\" style={{ maxHeight: '35px' }}>\n                <th \n                  className=\"px-4 py-3 text-left sticky left-0 z-30 font-bold text-xs uppercase tracking-wide cursor-pointer select-none border-r border-white/20 bg-purple-900\"\n                  onClick={() => handleSort('type')}\n                  style={{ width: '300px', minWidth: '300px', maxHeight: '35px' }}\n                >\n                  <div className=\"flex items-center gap-1\">\n                    Client Type\n                    <ArrowUpDown className=\"w-3 h-3\" />\n                  </div>\n                </th>\n                {months.map(m => (\n                  <th \n                    key={m.key} \n                    className=\"px-3 py-3 text-center font-bold text-xs uppercase tracking-wide border-l border-white/20 cursor-pointer hover:bg-purple-800/50 select-none sticky top-0\"\n                    onClick={() => handleSort(m.key)}\n                    style={{ width: '100px', minWidth: '100px', maxHeight: '35px' }}\n                  >\n                    <div className=\"flex flex-col items-center gap-0.5\">\n                      <div className=\"flex items-center gap-1\">\n                        <span className=\"text-xs font-bold whitespace-nowrap\">{m.label.split(' ')[0]}</span>\n                        <ArrowUpDown className=\"w-3 h-3\" />\n                      </div>\n                      <span className=\"text-white/80 text-[10px]\">{m.label.split(' ')[1]}</span>\n                    </div>\n                  </th>\n                ))}\n              </tr>\n            </thead>\n            <tbody>\n              {sortedTypes.map((t) => (\n                <tr \n                  key={t} \n                  className=\"border-b border-slate-100 hover:bg-slate-50 cursor-pointer transition-colors\"\n                  style={{ maxHeight: '35px' }}\n                  onClick={() => {\n                    // Aggregate all clients for this type across all months\n                    const allMonthsData = months.map(m => pivot[t]?.[m.key]).filter(Boolean);\n                    const allClients = allMonthsData.flatMap(cell => cell.clients || []);\n                    onRowClick?.({ type: t, data: pivot[t], metric, clients: allClients });\n                  }}\n                >\n                  <td className=\"px-4 py-2 text-sm font-semibold text-slate-800 sticky left-0 bg-white z-20 border-r\" style={{ maxHeight: '35px' }}>{t}</td>\n                  {months.map((m, idx) => {\n                    const cell = pivot[t]?.[m.key] || {};\n                    return (\n                      <td \n                        key={m.key} \n                        className=\"px-2 py-2 text-center border-l\"\n                        style={{ maxHeight: '35px' }}\n                        onClick={(e) => {\n                          // Allow clicking individual cells for month-specific drill-down\n                          e.stopPropagation();\n                          onRowClick?.({ \n                            type: t, \n                            month: m.label, \n                            data: cell, \n                            metric,\n                            clients: cell.clients || []\n                          });\n                        }}\n                      >\n                        {renderValue(cell, idx)}\n                      </td>\n                    );\n                  })}\n                </tr>\n              ))}\n              {/* Totals Row */}\n              <tr className=\"bg-slate-800 font-bold border-t-4 border-slate-600\" style={{ maxHeight: '35px' }}>\n                <td className=\"px-4 py-2 text-sm text-white sticky left-0 bg-slate-800 z-20 border-r\" style={{ maxHeight: '35px' }}>TOTALS</td>\n                {months.map((m, idx) => {\n                  const cell = totalsRow[m.key] || {};\n                  return (\n                    <td \n                      key={m.key}\n                      style={{ maxHeight: '35px' }} \n                      className=\"px-2 py-2 text-center border-l cursor-pointer hover:bg-slate-700\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        onRowClick?.({ \n                          type: 'TOTALS', \n                          month: m.label, \n                          data: cell, \n                          metric,\n                          clients: cell.clients || []\n                        });\n                      }}\n                    >\n                      {renderValueWhite(cell, idx)}\n                    </td>\n                  );\n                })}\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n\nexport default ClientRetentionMonthByTypePivot;\n"],"names":["CalendarDays","createLucideIcon","Repeat","calcGrowth","current","previous","rate","mag","trend","useClientConversionMetrics","data","historicalData","options","useMemo","base","compareEnd","monthStart","d","monthEnd","currentStart","currentEnd","prevAnchor","prevStart","prevEnd","fmt","periodLabel","within","start","end","it","parseDate","isNew","isConverted","isRetained","curNew","curConverted","curRetained","prevNew","prevConverted","prevRetained","overallConvCur","overallConvPrev","retentionCur","retentionPrev","totalLTVCur","s","c","totalLTVPrev","avgLTVCur","avgLTVPrev","prevYearAnchor","prevYearStart","prevYearEnd","previousYear","formatNumber","formatPercentage","formatCurrency","ClientConversionMetricCardsComponent","dateRange","onCardClick","metrics","React","showDebug","setShowDebug","avgConversionTime","withSpan","sum","avgVisitsPostTrial","withVisits","computeAvgForRange","arr","field","filteredData","getRangeAnchors","prevPeriodData","prevYearData","avgConversionTimePrev","avgConversionTimeYoY","avgVisitsPostTrialPrev","avgVisitsPostTrialYoY","iconMap","UserPlus","Award","UserCheck","TrendingUp","Target","DollarSign","metricCards","m","Users","client","jsxs","jsx","metric","index","Icon","Card","cn","CardContent","TrendingDown","Fragment","ClientConversionMetricCards","METRIC_LABELS","ClientRetentionMonthByTypePivot","visitsSummary","onRowClick","setMetric","useState","displayMode","setDisplayMode","sortColumn","setSortColumn","sortDir","setSortDir","containerRef","useRef","registry","useMetricsTablesRegistry","tableId","months","now","currentMonth","monthsDiff","i","key","label","clientTypes","set","a","b","an","bn","pivot","map","idx","summaryKey","type","cell","avgLTV","avgConversionDays","avgVisits","conversionRate","retentionRate","prevMonthKey","renderValue","monthIdx","value","prevCell","growth","isPositive","renderValueWhite","sortedTypes","aCell","bCell","aVal","bVal","handleSort","col","totalsRow","totals","aggregated","t","generateAllTabsContent","useCallback","sections","metricKeys","formatVal","metricKey","mk","headers","row","totalRow","useEffect","el","getTextContent","table","text","headerCells","h","r","cells","rowData","CardHeader","CardTitle","Calendar","Badge","CopyTableButton","Button","k","ArrowUpDown","allClients","e"],"mappings":"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","x_google_ignoreList":[0,1]}