import{r as x,j as e,D as I,n as L,o as V,q,B as o,X as E,C as u,c as p}from"./index-Bm67KBkU.js";import{f,a as k,B as U}from"./index-DkD_C-d1.js";import{T as A,a as H,b as T,c as _,d as $,e as O}from"./table-DhXofKdS.js";import{C as F,D as X}from"./dollar-sign-CKqx8kbC.js";import{E as G,D as J}from"./SalesMotionHero-sGphstF2.js";import{U as K}from"./users-7Ku-1TDB.js";import{T as Q}from"./target-BmxdxojS.js";import{i as W}from"./select-CM-Birqk.js";import{a as Y}from"./chevron-right-CbIMR3DA.js";import"./googleAuth-BGo8ElRc.js";import"./index-BdQq_4o_.js";const de=({isOpen:D,onClose:v,data:t,relatedData:n,type:y,title:w})=>{const[i,c]=x.useState(1),[h,R]=x.useState(50),l=x.useMemo(()=>{if(t?.filteredTransactionData&&t.filteredTransactionData.length>0)return t.filteredTransactionData;if(t?.rawData&&t.rawData.length>0)return t.rawData;if(!t||!n)return[];let s=[];switch(y){case"product":s=n.filter(a=>a.paymentItem===t.name||a.cleanedProduct===t.name||a.product===t.name);break;case"category":s=n.filter(a=>a.paymentCategory===t.name||a.cleanedCategory===t.name||a.category===t.name);break;case"member":s=n.filter(a=>a.memberId===t.memberId||a.customerName===t.name||a.memberName===t.name);break;case"seller":s=n.filter(a=>a.soldBy===t.name||a.soldBy===t.soldBy);break;default:s=n}return s},[t,n,y]),d=Math.ceil(l.length/h),j=(i-1)*h,C=j+h,M=l.slice(j,C),m=x.useMemo(()=>{if(!l.length)return null;const s={totalRecords:l.length,totalRevenue:0,totalTransactions:0,uniqueCustomers:new Set,avgValue:0};return l.forEach(a=>{a.paymentValue&&(s.totalRevenue+=a.paymentValue,s.totalTransactions+=1),a.memberId&&s.uniqueCustomers.add(a.memberId),a.ltv&&(s.totalRevenue+=a.ltv)}),s.avgValue=s.totalTransactions>0?s.totalRevenue/s.totalTransactions:0,{...s,uniqueCustomers:s.uniqueCustomers.size}},[l]),g=x.useMemo(()=>{if(!l.length)return[];const s=l[0],a=[];return s.paymentDate&&a.push({key:"paymentDate",header:"Date",align:"center"},{key:"customerName",header:"Customer",align:"left"},{key:"paymentItem",header:"Product",align:"left"},{key:"paymentValue",header:"Amount",align:"right",render:r=>f(r)},{key:"paymentMethod",header:"Payment Method",align:"center"},{key:"calculatedLocation",header:"Location",align:"center"}),s.source&&a.push({key:"createdAt",header:"Created",align:"center"},{key:"customerName",header:"Lead Name",align:"left"},{key:"source",header:"Source",align:"left"},{key:"stage",header:"Stage",align:"center"},{key:"ltv",header:"LTV",align:"right",render:r=>f(r||0)}),a},[l]),S=()=>{const s=l.map(N=>g.map(B=>N[B.key]||"").join(",")).join(`
`),r=g.map(N=>N.header).join(",")+`
`+s,z=new Blob([r],{type:"text/csv"}),P=window.URL.createObjectURL(z),b=document.createElement("a");b.href=P,b.download=`${w.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_drill_down.csv`,b.click()};return e.jsx(I,{open:D,onOpenChange:v,children:e.jsxs(L,{className:"max-w-[95vw] w-full h-[90vh] p-0",children:[e.jsx(V,{className:"bg-gradient-to-r from-blue-700 to-blue-900 text-white p-6 rounded-t-lg",children:e.jsxs(q,{className:"text-xl font-bold flex items-center gap-3",children:[e.jsx(F,{className:"w-6 h-6 animate-pulse"}),w,e.jsx(o,{variant:"ghost",size:"sm",onClick:v,className:"ml-auto text-white hover:bg-white/20 rounded-full",children:e.jsx(E,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"flex-1 overflow-hidden p-6",children:[m&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(u,{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-0 shadow-lg",children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-600 rounded-lg",children:e.jsx(G,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-700",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:k(m.totalRecords)})]})]})})}),e.jsx(u,{className:"bg-gradient-to-r from-green-50 to-green-100 border-0 shadow-lg",children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-600 rounded-lg",children:e.jsx(X,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-700",children:"Total Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:f(m.totalRevenue)})]})]})})}),e.jsx(u,{className:"bg-gradient-to-r from-purple-50 to-purple-100 border-0 shadow-lg",children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-600 rounded-lg",children:e.jsx(K,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-700",children:"Unique Customers"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:k(m.uniqueCustomers)})]})]})})}),e.jsx(u,{className:"bg-gradient-to-r from-orange-50 to-orange-100 border-0 shadow-lg",children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-600 rounded-lg",children:e.jsx(Q,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-700",children:"Avg Value"}),e.jsx("p",{className:"text-2xl font-bold text-orange-900",children:f(m.avgValue)})]})]})})})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(o,{variant:"outline",onClick:S,className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Export Data"]}),e.jsxs(U,{variant:"outline",className:"text-sm",children:["Showing ",j+1,"-",Math.min(C,l.length)," of ",l.length," records"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Rows per page:"}),e.jsxs("select",{value:h,onChange:s=>{R(Number(s.target.value)),c(1)},className:"border rounded px-2 py-1 text-sm",children:[e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto border border-gray-200 rounded-lg bg-white shadow-sm",children:e.jsxs(A,{children:[e.jsx(H,{className:"sticky top-0 z-20 bg-gradient-to-r from-gray-700 to-gray-900 text-white",children:e.jsx(T,{children:g.map(s=>e.jsx(_,{className:`
                        font-bold text-white py-3 px-4 text-sm max-h-[35px] h-[35px]
                        ${s.align==="center"?"text-center":s.align==="right"?"text-right":"text-left"}
                      `,children:s.header},String(s.key)))})}),e.jsx($,{children:M.map((s,a)=>e.jsx(T,{className:"hover:bg-gray-50/80 transition-colors duration-150 border-b border-gray-200 max-h-[35px] h-[35px]",children:g.map(r=>e.jsx(O,{className:`
                          py-2 px-4 align-middle font-medium text-sm max-h-[35px] h-[35px] overflow-hidden text-ellipsis whitespace-nowrap
                          ${r.align==="center"?"text-center":r.align==="right"?"text-right":"text-left"}
                        `,children:r.render?r.render(s[r.key]):s[r.key]},String(r.key)))},a))})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",i," of ",d]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>c(1),disabled:i===1,children:"First"}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>c(s=>Math.max(1,s-1)),disabled:i===1,children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>c(s=>Math.min(d,s+1)),disabled:i===d,children:e.jsx(Y,{className:"w-4 h-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>c(d),disabled:i===d,children:"Last"})]})]})]})]})})};export{de as PaginatedDrillDownModal};
//# sourceMappingURL=PaginatedDrillDownModal-D947znfA.js.map
