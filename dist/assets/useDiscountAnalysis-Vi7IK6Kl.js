import{r as m}from"./index-Bm67KBkU.js";import{u as f}from"./useGoogleSheets-BPVLuLVa.js";const T=()=>{const{data:d,loading:g,error:P}=f(),[s,y]=m.useState([]);m.useEffect(()=>{if(d&&d.length>0)try{const r=t=>{if(t==null||t==="")return 0;const o=t.toString().replace(/[â‚¹,]/g,"").trim(),u=parseFloat(o);return isNaN(u)?0:u},i=t=>{if(!t)return"";try{if(t.includes("/")){const o=t.split(",")[0].trim(),[u,l,p]=o.split("/");if(u&&l&&p){const e=`${p}-${l.padStart(2,"0")}-${u.padStart(2,"0")}`;return new Date(e).toISOString().split("T")[0]}}if(t.includes("-")){const o=new Date(t);if(!isNaN(o.getTime()))return o.toISOString().split("T")[0]}return""}catch{return""}},c=d.map(t=>{const o=r(t.discountAmount||t["Discount Amount -Mrp- Payment Value"]||0),u=r(t.discountPercentage||t["Discount Percentage - discount amount/mrp*100"]||0);return{memberId:t.memberId||t["Member ID"]?.toString()||"",customerName:t.customerName||t["Customer Name"]||"",customerEmail:t.customerEmail||t["Customer Email"]||"",saleItemId:t.saleItemId||t["Sale Item ID"]?.toString()||"",paymentCategory:t.paymentCategory||t["Payment Category"]||"",paymentDate:i(t.paymentDate||t["Payment Date"]||""),paymentValue:r(t.paymentValue||t["Payment Value"]||0),paidInMoneyCredits:r(t.paidInMoneyCredits||t["Paid In Money Credits"]||0),paymentVat:r(t.paymentVat||t["Payment VAT"]||0),paymentItem:t.paymentItem||t["Payment Item"]||"",paymentMethod:t.paymentMethod||t["Payment Method"]||"",paymentStatus:t.paymentStatus||t["Payment Status"]||"",paymentTransactionId:t.paymentTransactionId||t["Payment Transaction ID"]?.toString()||"",stripeToken:t.stripeToken||t["Stripe Token"]||"",saleReference:t.saleReference||t["Sale Reference"]?.toString()||"",soldBy:t.soldBy==="-"?"Online/System":t.soldBy||t["Sold By"]||"Unknown",location:t.calculatedLocation||t["Calculated Location"]||"",cleanedProduct:t.cleanedProduct||t["Cleaned Product"]||"",cleanedCategory:t.cleanedCategory||t["Cleaned Category"]||"",hostId:t.hostId||t["Host Id"]?.toString()||"",mrpPreTax:r(t.mrpPreTax||t["Mrp - Pre Tax"]||0),mrpPostTax:r(t.mrpPostTax||t["Mrp - Post Tax"]||0),discountAmount:o,discountPercentage:u,membershipType:t.membershipType||t["Membership Type"]?.trim()||""}});y(c)}catch{y([])}else y([])},[d]);const D=m.useMemo(()=>{if(!s.length)return{totalDiscountAmount:0,totalRevenueLost:0,totalTransactions:0,avgDiscountPercentage:0,totalPotentialRevenue:0,totalActualRevenue:0,discountEffectiveness:0,productBreakdown:[],monthlyBreakdown:[]};const r=s.reduce((e,n)=>e+(n.discountAmount||0),0),i=s.length,c=s.reduce((e,n)=>e+(n.mrpPostTax||n.paymentValue||0),0),t=s.reduce((e,n)=>e+(n.paymentValue||0),0),o=s.filter(e=>(e.discountAmount||0)>0),u=o.length>0?o.reduce((e,n)=>e+(n.discountPercentage||0),0)/o.length:0,l=s.reduce((e,n)=>{const a=n.cleanedProduct||"Unknown Product";return e[a]||(e[a]={product:a,transactions:0,totalDiscount:0,avgDiscountPercentage:0,revenue:0,totalMrp:0}),e[a].transactions+=1,e[a].totalDiscount+=n.discountAmount||0,e[a].revenue+=n.paymentValue||0,e[a].totalMrp+=n.mrpPostTax||n.paymentValue||0,e},{});Object.values(l).forEach(e=>{e.avgDiscountPercentage=e.totalMrp>0?e.totalDiscount/e.totalMrp*100:0});const p=s.reduce((e,n)=>{if(!n.paymentDate)return e;const a=n.paymentDate.substring(0,7);return e[a]||(e[a]={month:a,transactions:0,totalDiscount:0,revenue:0}),e[a].transactions+=1,e[a].totalDiscount+=n.discountAmount||0,e[a].revenue+=n.paymentValue||0,e},{});return{totalDiscountAmount:r,totalRevenueLost:r,totalTransactions:i,avgDiscountPercentage:u,totalPotentialRevenue:c,totalActualRevenue:t,discountEffectiveness:c>0?t/c*100:0,productBreakdown:Object.values(l),monthlyBreakdown:Object.values(p)}},[s]);return{data:s,metrics:D,loading:g,error:P}};export{T as u};
//# sourceMappingURL=useDiscountAnalysis-Vi7IK6Kl.js.map
