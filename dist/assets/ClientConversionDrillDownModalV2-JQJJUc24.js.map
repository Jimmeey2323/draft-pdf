{"version":3,"file":"ClientConversionDrillDownModalV2-JQJJUc24.js","sources":["../../src/components/dashboard/ClientConversionDrillDownModalV2.tsx"],"sourcesContent":["import React from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Badge } from '@/components/ui/badge';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { X, Users, TrendingUp, Calendar, Award } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { formatCurrency, formatNumber } from '@/utils/formatters';\nimport { ModernDataTable } from '@/components/ui/ModernDataTable';\nimport { NewClientData } from '@/types/dashboard';\n\ninterface ClientConversionDrillDownModalV2Props {\n  isOpen: boolean;\n  onClose: () => void;\n  title: string;\n  data: any;\n  type: 'month' | 'year' | 'class' | 'membership';\n}\n\nexport const ClientConversionDrillDownModalV2: React.FC<ClientConversionDrillDownModalV2Props> = ({\n  isOpen,\n  onClose,\n  title,\n  data,\n  type\n}) => {\n  // Extract targeted client data based on type and drill-down context\n  const clients: NewClientData[] = React.useMemo(() => {\n    if (!data) return [];\n    \n    // For month/year type, use the specific clients from the clicked row\n    if ((type === 'month' || type === 'year') && data.clients) {\n      console.log('Drill-down: Using targeted clients from clicked row:', data.clients.length);\n      return data.clients;\n    }\n    \n    // For other types, ensure we return the array format\n    if (Array.isArray(data)) {\n      return data;\n    }\n    \n    // Fallback to empty array\n    console.log('Drill-down: No targeted clients found, showing empty');\n    return [];\n  }, [data, type]);\n\n  const columns = [\n    {\n      key: 'firstName',\n      header: 'First Name',\n      className: 'min-w-[120px]',\n      render: (value: string, row: NewClientData) => (\n        <div className=\"font-medium text-gray-900\">\n          {value} {row.lastName}\n        </div>\n      )\n    },\n    {\n      key: 'email',\n      header: 'Email',\n      className: 'min-w-[200px]',\n      render: (value: string) => (\n        <div className=\"text-sm text-gray-600 truncate\" title={value}>\n          {value}\n        </div>\n      )\n    },\n    {\n      key: 'firstVisitDate',\n      header: 'First Visit',\n      align: 'center' as const,\n      render: (value: string) => (\n        <div className=\"text-sm text-gray-700\">\n          {new Date(value).toLocaleDateString()}\n        </div>\n      )\n    },\n    {\n      key: 'isNew',\n      header: 'Status',\n      align: 'center' as const,\n      render: (value: string) => (\n        <Badge variant={value?.toLowerCase().includes('new') ? 'default' : 'secondary'}>\n          {value || 'Unknown'}\n        </Badge>\n      )\n    },\n    {\n      key: 'conversionStatus',\n      header: 'Conversion',\n      align: 'center' as const,\n      render: (value: string) => (\n        <Badge \n          variant={value?.toLowerCase().includes('converted') ? 'default' : 'secondary'}\n          className={value?.toLowerCase().includes('converted') ? 'bg-green-100 text-green-800' : ''}\n        >\n          {value || 'Pending'}\n        </Badge>\n      )\n    },\n    {\n      key: 'retentionStatus',\n      header: 'Retention',\n      align: 'center' as const,\n      render: (value: string) => (\n        <Badge \n          variant={value?.toLowerCase().includes('retained') ? 'default' : 'secondary'}\n          className={value?.toLowerCase().includes('retained') ? 'bg-purple-100 text-purple-800' : ''}\n        >\n          {value || 'Pending'}\n        </Badge>\n      )\n    },\n    {\n      key: 'ltv',\n      header: 'LTV',\n      align: 'right' as const,\n      render: (value: number) => (\n        <span className=\"font-semibold text-emerald-600\">\n          {formatCurrency(value || 0)}\n        </span>\n      )\n    },\n    {\n      key: 'firstVisitLocation',\n      header: 'Location',\n      className: 'min-w-[150px]',\n      render: (value: string) => (\n        <div className=\"text-sm text-gray-600 truncate\" title={value}>\n          {value || 'Unknown'}\n        </div>\n      )\n    }\n  ];\n\n  // Calculate summary metrics\n  const summary = React.useMemo(() => {\n    const totalMembers = clients.length;\n    const newMembers = clients.filter(c => (c.isNew || '').toLowerCase().includes('new')).length;\n    const convertedMembers = clients.filter(c => (c.conversionStatus || '').toLowerCase().includes('converted')).length;\n    const retainedMembers = clients.filter(c => (c.retentionStatus || '').toLowerCase().includes('retained')).length;\n    const totalLTV = clients.reduce((sum, c) => sum + (c.ltv || 0), 0);\n    \n    return {\n      totalMembers,\n      newMembers,\n      convertedMembers,\n      retainedMembers,\n      conversionRate: newMembers > 0 ? (convertedMembers / newMembers) * 100 : 0,\n      retentionRate: totalMembers > 0 ? (retainedMembers / totalMembers) * 100 : 0,\n      avgLTV: totalMembers > 0 ? totalLTV / totalMembers : 0,\n      totalLTV\n    };\n  }, [clients]);\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-7xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader className=\"pb-4 border-b\">\n          <div className=\"flex items-center justify-between\">\n            <DialogTitle className=\"text-xl font-bold text-gray-900 flex items-center gap-2\">\n              <Users className=\"w-5 h-5\" />\n              {title} - Detailed Analysis\n            </DialogTitle>\n            <Button \n              variant=\"ghost\" \n              size=\"sm\" \n              onClick={onClose}\n              className=\"hover:bg-gray-100\"\n            >\n              <X className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        </DialogHeader>\n\n        {/* Summary Cards */}\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2\">\n                <Users className=\"w-4 h-4 text-blue-500\" />\n                <div>\n                  <div className=\"text-2xl font-bold text-blue-600\">\n                    {formatNumber(summary.totalMembers)}\n                  </div>\n                  <div className=\"text-xs text-gray-500\">Total Members</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2\">\n                <TrendingUp className=\"w-4 h-4 text-green-500\" />\n                <div>\n                  <div className=\"text-2xl font-bold text-green-600\">\n                    {formatNumber(summary.newMembers)}\n                  </div>\n                  <div className=\"text-xs text-gray-500\">New Members</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2\">\n                <Award className=\"w-4 h-4 text-purple-500\" />\n                <div>\n                  <div className=\"text-2xl font-bold text-purple-600\">\n                    {summary.conversionRate.toFixed(1)}%\n                  </div>\n                  <div className=\"text-xs text-gray-500\">Conversion Rate</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2\">\n                <Calendar className=\"w-4 h-4 text-emerald-500\" />\n                <div>\n                  <div className=\"text-2xl font-bold text-emerald-600\">\n                    {formatCurrency(summary.avgLTV)}\n                  </div>\n                  <div className=\"text-xs text-gray-500\">Avg LTV</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Client Data Table */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">\n              Client Details ({formatNumber(clients.length)} members)\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"p-0\">\n            <ModernDataTable\n              data={clients}\n              columns={columns}\n              headerGradient=\"from-slate-800 via-slate-900 to-slate-800\"\n              maxHeight=\"400px\"\n            />\n          </CardContent>\n        </Card>\n      </DialogContent>\n    </Dialog>\n  );\n};"],"names":["ClientConversionDrillDownModalV2","isOpen","onClose","title","data","type","clients","React","columns","value","row","jsxs","jsx","Badge","formatCurrency","summary","totalMembers","newMembers","c","convertedMembers","retainedMembers","totalLTV","sum","Dialog","DialogContent","DialogHeader","DialogTitle","Users","Button","X","Card","CardContent","formatNumber","TrendingUp","Award","Calendar","CardHeader","CardTitle","ModernDataTable"],"mappings":"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"}