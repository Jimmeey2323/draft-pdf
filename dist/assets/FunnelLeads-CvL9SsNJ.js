import{i as de,j as e,C as O,a as K,b as W,B as _,X as ge,c as E,r as j,T as ze,f as H,m as ae,w as xe,h as he,d as Pe,u as Oe,R as Ee}from"./index-Bm67KBkU.js";import{T as me,a as ue,b as B,c as Q}from"./tabs-BTrhdLSC.js";import{D as Ie}from"./DashboardMotionHero-C2yuh4RF.js";import{u as Ye}from"./useLeadsData-nt_JwR0P.js";import{B as I,f as Y,a as P}from"./index-DkD_C-d1.js";import{F as Ve,S as He,d as _e,e as Ge,g as Be,h as Ue,I as ve,C as be}from"./select-CM-Birqk.js";import{D as Ke}from"./date-picker-CiBjbuX1.js";import{M as se,S as We}from"./StudioLocationTabs-BSKYatd_.js";import{T as Qe}from"./tag-DzcNcJZD.js";import{A as ce}from"./activity-CeUP9h5f.js";import{C as ee}from"./clock-BP1BFskn.js";import{U as le}from"./users-7Ku-1TDB.js";import{P as Ze}from"./phone-Eid_XCcT.js";import{T as Z}from"./target-BmxdxojS.js";import{U as Xe}from"./user-check-CLHYCjic.js";import{T as oe,C as Je}from"./googleAuth-BGo8ElRc.js";import{D as te,C as X}from"./dollar-sign-CKqx8kbC.js";import{C as re}from"./circle-check-big-y8tZauB3.js";import{Z as qe}from"./zap-IfyovFNW.js";import{E as et,M as tt,D as we,a as st}from"./SalesMotionHero-sGphstF2.js";import{R as fe}from"./rotate-ccw-DYMOD-zv.js";import{R as je,a as ye,X as Ne,Y as Le,T as ie,B as at,b as rt,C as lt,L as ot}from"./BarChart-o5Oeg9Jb.js";import{A as nt,a as it}from"./AreaChart-DQtaPzLK.js";import{P as ct,a as dt}from"./PieChart-slnvMcDg.js";import{M as xt}from"./ModernDataTable-Qj0casC7.js";import{a as pe}from"./ModernTableWrapper-bhf1DsXx.js";import{u as ht}from"./useTableCopyContext-DkJKZq95.js";import{P as Me}from"./PersistentTableFooter-DyingoeQ.js";import{S as G}from"./star-qy423-d6.js";import{C as Se}from"./crown-Bf6tWe5C.js";import{T as Ce}from"./trophy-ChiyFqMe.js";import{A as mt}from"./award-D0x2LQSI.js";import{T as ke}from"./trending-down-B5K1omnR.js";import{M as ut}from"./medal-BdYY0bn6.js";import{C as pt,T as gt}from"./thumbs-down-5G9TMNL9.js";import{C as vt}from"./circle-alert-bpasmovd.js";import{C as q}from"./CopyTableButton-Blm2CDq4.js";import{M as bt,a as wt}from"./ModalSuspense-C3SPWsdX.js";import{C as Te}from"./chevron-right-CbIMR3DA.js";import"./index-BdQq_4o_.js";import"./table-DhXofKdS.js";import"./tableStyles-BJWvDwDQ.js";import"./percent-BAS2Szsf.js";import"./package-C0br8ACw.js";import"./dropdown-menu-B9zQ9u84.js";import"./file-text-DChZNHsM.js";import"./loader-circle-Bc3-I9bA.js";const ft=de("HeartHandshake",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}],["path",{d:"M12 5 9.04 7.96a2.17 2.17 0 0 0 0 3.08c.82.82 2.13.85 3 .07l2.07-1.9a2.82 2.82 0 0 1 3.79 0l2.96 2.66",key:"4oyue0"}],["path",{d:"m18 15-2-2",key:"60u0ii"}],["path",{d:"m15 18-2-2",key:"6p76be"}]]);const jt=de("IndianRupee",[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]]);const yt=de("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Nt=({filters:r,onFiltersChange:T,uniqueValues:m})=>{const C=(h,M)=>{const f=[...r[h]],l=f.includes(M)?f.filter(v=>v!==M):[...f,M];T({...r,[h]:l})},y=h=>{T({...r,dateRange:{start:h.from?h.from.toISOString():"",end:h.to?h.to.toISOString():""}})},F=()=>{const h=new Date,M=new Date(h.getFullYear(),h.getMonth()-1,1),f=new Date(h.getFullYear(),h.getMonth(),0),l=i=>{const R=i.getFullYear(),N=String(i.getMonth()+1).padStart(2,"0"),g=String(i.getDate()).padStart(2,"0");return`${R}-${N}-${g}`},v={start:l(M),end:l(f)};T({dateRange:v,location:[],source:[],stage:[],status:[],associate:[],channel:[],trialStatus:[],conversionStatus:[],retentionStatus:[],minLTV:void 0,maxLTV:void 0})},k=(r.location?.length||0)+(r.source?.length||0)+(r.stage?.length||0)+(r.status?.length||0)+(r.associate?.length||0)+(r.channel?.length||0)+(r.trialStatus?.length||0)+(r.conversionStatus?.length||0)+(r.retentionStatus?.length||0)+(r.minLTV?1:0)+(r.maxLTV?1:0),n=[{key:"location",label:"Location",icon:se,options:m.locations,values:r.location},{key:"source",label:"Source",icon:Qe,options:m.sources,values:r.source},{key:"stage",label:"Stage",icon:ce,options:m.stages,values:r.stage},{key:"status",label:"Status",icon:ee,options:m.statuses,values:r.status},{key:"associate",label:"Associate",icon:le,options:m.associates,values:r.associate},{key:"channel",label:"Channel",icon:Ze,options:m.channels,values:r.channel},{key:"trialStatus",label:"Trial Status",icon:Z,options:m.trialStatuses,values:r.trialStatus},{key:"conversionStatus",label:"Conversion",icon:Xe,options:m.conversionStatuses,values:r.conversionStatus},{key:"retentionStatus",label:"Retention",icon:oe,options:m.retentionStatuses,values:r.retentionStatus}];return e.jsxs(O,{className:"bg-white/95 backdrop-blur-sm border border-slate-200 shadow-lg",children:[e.jsx(K,{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(W,{className:"flex items-center gap-2 text-white",children:[e.jsx(Ve,{className:"w-5 h-5"}),"Lead Filters",k>0&&e.jsxs(I,{className:"bg-white/20 text-white border-white/30",children:[k," Active"]})]}),e.jsxs(_,{variant:"outline",size:"sm",onClick:F,disabled:k===0,className:"bg-white/10 border-white/30 text-white hover:bg-white/20",children:[e.jsx(ge,{className:"w-4 h-4 mr-1"}),"Clear All"]})]})}),e.jsxs(E,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4 text-blue-600"}),"Date Range"]}),e.jsx(Ke,{value:{from:r.dateRange.start?new Date(r.dateRange.start):void 0,to:r.dateRange.end?new Date(r.dateRange.end):void 0},onChange:y})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.map(h=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(h.icon,{className:"w-4 h-4 text-blue-600"}),h.label,h.values.length>0&&e.jsx(I,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700",children:h.values.length})]}),e.jsxs(He,{value:"",onValueChange:M=>C(h.key,M),children:[e.jsx(_e,{className:"h-9",children:e.jsx(Ge,{placeholder:`Select ${h.label.toLowerCase()}`})}),e.jsx(Be,{className:"bg-white z-50 max-h-48",children:h.options.map(M=>e.jsx(Ue,{value:M,className:"text-sm",children:M},M))})]}),h.values.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[h.values.slice(0,3).map(M=>e.jsxs(I,{variant:"secondary",className:"text-xs cursor-pointer hover:bg-red-100 bg-slate-100 text-slate-700",onClick:()=>C(h.key,M),children:[M,e.jsx(ge,{className:"w-3 h-3 ml-1"})]},M)),h.values.length>3&&e.jsxs(I,{variant:"outline",className:"text-xs",children:["+",h.values.length-3," more"]})]})]},h.key))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-slate-200",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4 text-blue-600"}),"Min LTV"]}),e.jsx(ve,{type:"number",placeholder:"₹0",value:r.minLTV||"",onChange:h=>T({...r,minLTV:h.target.value?parseFloat(h.target.value):void 0}),className:"h-9"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4 text-blue-600"}),"Max LTV"]}),e.jsx(ve,{type:"number",placeholder:"₹100000",value:r.maxLTV||"",onChange:h=>T({...r,maxLTV:h.target.value?parseFloat(h.target.value):void 0}),className:"h-9"})]})]})]})]})},Lt=({data:r,onCardClick:T})=>{const m=j.useMemo(()=>{if(!r||!r.length)return{leadsReceived:0,trialsCompleted:0,trialsScheduled:0,proximityIssues:0,convertedLeads:0,trialToMemberConversion:0,leadToTrialConversion:0,leadToMemberConversion:0,avgLTV:0,avgVisitsPerLead:0,pipelineHealth:0};const y=r.length,F=r.filter(L=>L.trialStatus==="Trial Completed"||L.stage==="Trial Completed").length,k=r.filter(L=>{const z=(L.trialStatus||"").toLowerCase(),V=(L.stage||"").toLowerCase(),p=z.includes("trial")&&!z.includes("completed"),S=V.includes("trial")&&!V.includes("completed");return p||S}).length,n=r.filter(L=>L.stage?.includes("Proximity")||L.remarks?.toLowerCase().includes("proximity")).length,h=r.filter(L=>L.conversionStatus==="Converted").length,M=F>0?h/F*100:0,f=y>0?k/y*100:0,l=y>0?h/y*100:0,v=r.reduce((L,z)=>L+(z.ltv||0),0),i=y>0?v/y:0,R=r.reduce((L,z)=>L+(z.visits||0),0),N=y>0?R/y:0,g=Math.min(100,Math.round(f*.3+M*.4+N*10*.2+(y-n)/y*100*.1));return{leadsReceived:y,trialsCompleted:F,trialsScheduled:k,proximityIssues:n,convertedLeads:h,trialToMemberConversion:M,leadToTrialConversion:f,leadToMemberConversion:l,avgLTV:i,avgVisitsPerLead:N,pipelineHealth:g}},[r]),C=({id:y,title:F,value:k,icon:n,colorIndex:h,subtitle:M,format:f="number",description:l})=>{const v=i=>{switch(f){case"currency":return Y(i);case"percentage":return`${i.toFixed(1)}%`;default:return i.toLocaleString("en-IN")}};return e.jsx(O,{className:H("group relative overflow-hidden cursor-pointer transition-all duration-700","bg-white hover:bg-gradient-to-br hover:from-gray-900 hover:via-slate-900 hover:to-slate-900",h%4===0&&"border-t-4 border-green-700 hover:border-green-700 shadow-lg",h%4===1&&"border-t-4 border-blue-700 hover:border-blue-700 shadow-lg",h%4===2&&"border-t-4 border-pink-700 hover:border-pink-700 shadow-lg",h%4===3&&"border-t-4 border-red-700 hover:border-red-700 shadow-lg","hover:shadow-2xl hover:shadow-slate-900/30","hover:-translate-y-2 hover:scale-[1.02]"),onClick:()=>T?.(F,r,y),children:e.jsxs(E,{className:"p-6 relative",children:[e.jsx("div",{className:"absolute top-4 right-4 opacity-10 group-hover:opacity-20 transition-all duration-700",children:e.jsx(n,{className:H("w-12 h-12 transition-all duration-700",h%4===0&&"text-green-700",h%4===1&&"text-blue-700",h%4===2&&"text-pink-700",h%4===3&&"text-red-700","group-hover:text-white/40")})}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:H("p-4 rounded-2xl transition-all duration-700 border-1 shadow-md",h%4===0&&"bg-gradient-to-br from-green-700 to-green-600 border-green-900 text-white shadow-green-200",h%4===1&&"bg-gradient-to-br from-blue-700 to-blue-600 border-blue-900 text-white shadow-blue-200",h%4===2&&"bg-gradient-to-br from-pink-700 to-pink-600 border-pink-900 text-white shadow-pink-200",h%4===3&&"bg-gradient-to-br from-red-700 to-red-600 border-red-900 text-white shadow-red-200","group-hover:bg-white/20 group-hover:border-white/40 group-hover:text-white group-hover:shadow-white/20"),children:e.jsx(n,{className:"w-6 h-6 drop-shadow-sm"})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h3",{className:"font-semibold text-lg text-slate-900 group-hover:text-white/95 transition-colors duration-700",children:F})})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:H("text-4xl font-bold transition-all duration-700 text-slate-900 group-hover:text-white"),children:v(k)}),e.jsx("p",{className:H("text-xs text-slate-500 group-hover:text-slate-200 transition-colors"),children:M})]})]}),e.jsx("div",{className:H("mt-4 p-3 border-t border-l-4 transition-all duration-700","bg-slate-50 group-hover:bg-slate-800/50 border-t-slate-200 group-hover:border-t-white/10",h%4===0&&"border-l-green-700",h%4===1&&"border-l-blue-700",h%4===2&&"border-l-pink-700",h%4===3&&"border-l-red-700"),children:e.jsx("p",{className:"text-xs text-slate-900 group-hover:text-white transition-colors duration-700",children:l})})]})})};return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(C,{id:"leadsReceived",title:"Leads Received",value:m.leadsReceived,icon:le,colorIndex:0,subtitle:"Total incoming leads",description:"Total number of leads received in the selected period"}),e.jsx(C,{id:"trialsCompleted",title:"Trials Completed",value:m.trialsCompleted,icon:re,colorIndex:1,subtitle:"Successful trial sessions",description:"Number of trial sessions that were successfully completed"}),e.jsx(C,{id:"convertedLeads",title:"Converted Leads",value:m.convertedLeads,icon:Z,colorIndex:2,subtitle:"Successfully converted",description:"Number of leads successfully converted to paying members"}),e.jsx(C,{id:"trialToMemberRate",title:"Trial → Member %",value:m.trialToMemberConversion,icon:oe,colorIndex:3,subtitle:"Trial conversion efficiency",format:"percentage",description:"Percentage of completed trials that converted to memberships"}),e.jsx(C,{id:"leadToMemberRate",title:"Lead → Member %",value:m.leadToMemberConversion,icon:qe,colorIndex:0,subtitle:"Overall conversion rate",format:"percentage",description:"Overall percentage of leads converted to paying members"}),e.jsx(C,{id:"avgLTV",title:"Average LTV",value:m.avgLTV,icon:te,colorIndex:1,subtitle:"Lifetime value per lead",format:"currency",description:"Average lifetime value generated per lead"}),e.jsx(C,{id:"avgVisitsPerLead",title:"Avg Visits/Lead",value:m.avgVisitsPerLead,icon:et,colorIndex:2,subtitle:"Engagement frequency",description:"Average number of visits per lead during the funnel process"}),e.jsx(C,{id:"pipelineHealth",title:"Pipeline Health",value:m.pipelineHealth,icon:m.pipelineHealth>=70?re:m.pipelineHealth>=50?ee:ze,colorIndex:3,subtitle:"Overall funnel performance",format:"percentage",description:"Composite score based on conversion rates, engagement, and lead quality"})]})},St=({data:r})=>{const[T,m]=j.useState("source"),[C,y]=j.useState("volume"),F=j.useMemo(()=>{if(!r||!r.length)return[];switch(T){case"source":{const f=r.reduce((l,v)=>{const i=v.source||"Unknown";return l[i]||(l[i]={name:i,leads:0,converted:0,totalLTV:0}),l[i].leads+=1,v.conversionStatus==="Converted"&&(l[i].converted+=1),l[i].totalLTV+=v.ltv||0,l},{});return Object.values(f).map(l=>({name:l.name,volume:l.leads,conversion:l.leads>0?l.converted/l.leads*100:0,ltv:l.leads>0?l.totalLTV/l.leads:0})).sort((l,v)=>v.volume-l.volume).slice(0,10)}case"stage":{const f=r.reduce((l,v)=>{const i=v.stage||"Unknown";return l[i]||(l[i]={name:i,leads:0,converted:0,totalLTV:0}),l[i].leads+=1,v.conversionStatus==="Converted"&&(l[i].converted+=1),l[i].totalLTV+=v.ltv||0,l},{});return Object.values(f).map(l=>({name:l.name,volume:l.leads,conversion:l.leads>0?l.converted/l.leads*100:0,ltv:l.leads>0?l.totalLTV/l.leads:0})).sort((l,v)=>v.volume-l.volume)}case"timeline":{const f=r.reduce((l,v)=>{if(!v.createdAt)return l;const i=new Date(v.createdAt);if(isNaN(i.getTime()))return l;const R=`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}`;return l[R]||(l[R]={name:R,leads:0,converted:0,totalLTV:0}),l[R].leads+=1,v.conversionStatus==="Converted"&&(l[R].converted+=1),l[R].totalLTV+=v.ltv||0,l},{});return Object.values(f).map(l=>({name:l.name,volume:l.leads,conversion:l.leads>0?l.converted/l.leads*100:0,ltv:l.leads>0?l.totalLTV/l.leads:0})).sort((l,v)=>l.name.localeCompare(v.name)).slice(-12)}default:return[]}},[r,T]),k=j.useMemo(()=>{if(!r||!r.length)return[];const f=r.reduce((v,i)=>{const R=i.conversionStatus||"Unknown";return v[R]=(v[R]||0)+1,v},{}),l=["#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4"];return Object.entries(f).map(([v,i],R)=>({name:v,value:i,percentage:(i/r.length*100).toFixed(1),color:l[R%l.length]})).sort((v,i)=>i.value-v.value)},[r]),n=()=>{switch(C){case"volume":return"Lead Volume";case"conversion":return"Conversion Rate (%)";case"ltv":return"Average LTV (₹)";default:return"Lead Volume"}},h=({active:f,payload:l,label:v})=>f&&l&&l.length?e.jsxs("div",{className:"bg-white p-4 border border-slate-200 rounded-lg shadow-xl backdrop-blur-sm",children:[e.jsx("p",{className:"font-semibold text-slate-800 mb-2",children:v}),e.jsxs("p",{className:"text-sm text-slate-600",children:[n(),": ",C==="ltv"?Y(l[0].value):C==="conversion"?`${l[0].value.toFixed(1)}%`:l[0].value.toLocaleString("en-IN")]})]}):null,M=({active:f,payload:l})=>{if(f&&l&&l.length){const v=l[0].payload;return e.jsxs("div",{className:"bg-white p-4 border border-slate-200 rounded-lg shadow-xl backdrop-blur-sm",children:[e.jsx("p",{className:"font-semibold text-slate-800 mb-2",children:v.name}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Count: ",v.value.toLocaleString("en-IN")," (",v.percentage,"%)"]})]})}return null};return!r||!r.length?e.jsx(O,{className:"w-full bg-white/90 backdrop-blur-sm border-0 shadow-xl",children:e.jsx(E,{className:"p-12",children:e.jsxs("div",{className:"text-center py-8 text-slate-500",children:[e.jsx(X,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No data available for charts"}),e.jsx("p",{className:"text-sm",children:"Adjust your filters to see analytics"})]})})}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(O,{className:"w-full bg-white/95 backdrop-blur-sm border-0 shadow-2xl overflow-hidden relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-600/5 to-purple-600/5 rounded-xl transform translate-x-1 translate-y-1 -z-10 group-hover:translate-x-2 group-hover:translate-y-2 transition-transform duration-300"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-slate-800/5 to-slate-900/5 rounded-xl transform translate-x-0.5 translate-y-0.5 -z-10"}),e.jsxs(K,{className:"bg-gradient-to-r from-red-700 via-red-800 to-red-900 text-white border-0 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-white/30 to-transparent"}),e.jsxs("div",{className:"flex flex-col gap-4 relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(W,{className:"flex items-center gap-3 text-white text-lg font-bold",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-xl backdrop-blur-sm shadow-lg border border-white/20",children:e.jsx(X,{className:"w-5 h-5 text-white drop-shadow-lg"})}),T==="source"?"Lead Source Analytics":T==="stage"?"Funnel Stage Analytics":"Timeline Trend Analysis"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{size:"sm",variant:"ghost",className:"text-white hover:bg-white/10 border border-white/20 backdrop-blur-sm",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx(_,{size:"sm",variant:"ghost",className:"text-white hover:bg-white/10 border border-white/20 backdrop-blur-sm",children:e.jsx(yt,{className:"w-4 h-4"})}),e.jsx(_,{size:"sm",variant:"ghost",className:"text-white hover:bg-white/10 border border-white/20 backdrop-blur-sm",children:e.jsx(tt,{className:"w-4 h-4"})}),e.jsx(_,{size:"sm",variant:"ghost",className:"text-white hover:bg-white/10 border border-white/20 backdrop-blur-sm",children:e.jsx(we,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex gap-2 bg-black/20 rounded-xl p-2 border border-white/10 backdrop-blur-sm",children:[e.jsxs(_,{size:"sm",variant:T==="source"?"default":"ghost",onClick:()=>m("source"),className:`transition-all duration-300 shadow-lg ${T==="source"?"bg-white text-red-900 hover:bg-white/90 shadow-xl border border-white/20":"text-white hover:bg-white/10 border border-white/20"}`,children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Source"]}),e.jsxs(_,{size:"sm",variant:T==="stage"?"default":"ghost",onClick:()=>m("stage"),className:`transition-all duration-300 shadow-lg ${T==="stage"?"bg-white text-red-900 hover:bg-white/90 shadow-xl border border-white/20":"text-white hover:bg-white/10 border border-white/20"}`,children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Stage"]}),e.jsxs(_,{size:"sm",variant:T==="timeline"?"default":"ghost",onClick:()=>m("timeline"),className:`transition-all duration-300 shadow-lg ${T==="timeline"?"bg-white text-red-900 hover:bg-white/90 shadow-xl border border-white/20":"text-white hover:bg-white/10 border border-white/20"}`,children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Timeline"]})]})]})]}),e.jsx("div",{className:"px-6 pt-4 bg-gradient-to-r from-slate-50 to-white border-b border-slate-200",children:e.jsxs("div",{className:"flex flex-wrap gap-2 pb-4",children:[e.jsxs(I,{variant:C==="volume"?"secondary":"outline",className:H("cursor-pointer transition-all duration-300 hover:scale-105 shadow-sm",C==="volume"?"bg-red-700 text-white border-red-600 shadow-red-200":"bg-white text-slate-600 border-slate-300 hover:bg-red-50 hover:border-red-300"),onClick:()=>y("volume"),children:[e.jsx(oe,{className:"w-3 h-3 mr-1"}),"Volume"]}),e.jsxs(I,{variant:C==="conversion"?"secondary":"outline",className:H("cursor-pointer transition-all duration-300 hover:scale-105 shadow-sm",C==="conversion"?"bg-red-700 text-white border-red-600 shadow-red-200":"bg-white text-slate-600 border-slate-300 hover:bg-red-50 hover:border-red-300"),onClick:()=>y("conversion"),children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"Conversion"]}),e.jsxs(I,{variant:C==="ltv"?"secondary":"outline",className:H("cursor-pointer transition-all duration-300 hover:scale-105 shadow-sm",C==="ltv"?"bg-red-700 text-white border-red-600 shadow-red-200":"bg-white text-slate-600 border-slate-300 hover:bg-red-50 hover:border-red-300"),onClick:()=>y("ltv"),children:[e.jsx(jt,{className:"w-3 h-3 mr-1"}),"LTV"]})]})}),e.jsxs(E,{className:"p-6 bg-gradient-to-br from-slate-50 to-white relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-600/5 to-purple-600/10 pointer-events-none"}),e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-bl from-red-500/10 to-transparent rounded-full blur-xl"}),e.jsxs("div",{className:"h-80 relative z-10",children:[e.jsx("div",{className:"absolute top-0 right-0 text-xs text-slate-500 font-medium bg-white/80 px-2 py-1 rounded-md backdrop-blur-sm shadow-sm",children:n()}),e.jsx(je,{width:"100%",height:"100%",children:T==="timeline"?e.jsxs(nt,{data:F,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"areaGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#dc2626",stopOpacity:.8}),e.jsx("stop",{offset:"50%",stopColor:"#ea580c",stopOpacity:.4}),e.jsx("stop",{offset:"95%",stopColor:"#f97316",stopOpacity:.1})]}),e.jsxs("linearGradient",{id:"lineGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#b91c1c",stopOpacity:1}),e.jsx("stop",{offset:"100%",stopColor:"#dc2626",stopOpacity:1})]}),e.jsx("filter",{id:"shadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"2",dy:"2",stdDeviation:"3",floodColor:"#dc2626",floodOpacity:"0.3"})})]}),e.jsx(ye,{strokeDasharray:"3 3",stroke:"#e2e8f0",opacity:.6}),e.jsx(Ne,{dataKey:"name",stroke:"#475569",fontSize:11,fontWeight:600,tickFormatter:f=>String(f).slice(-5)}),e.jsx(Le,{stroke:"#475569",fontSize:11,fontWeight:600}),e.jsx(ie,{content:e.jsx(h,{})}),e.jsx(it,{type:"monotone",dataKey:C,stroke:"url(#lineGradient)",strokeWidth:4,fill:"url(#areaGradient)",filter:"url(#shadow)",dot:{fill:"#dc2626",strokeWidth:3,r:6,filter:"url(#shadow)"},activeDot:{r:8,fill:"#b91c1c",stroke:"#ffffff",strokeWidth:4}})]}):e.jsxs(at,{data:F,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"barGradient3D",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#dc2626",stopOpacity:1}),e.jsx("stop",{offset:"50%",stopColor:"#b91c1c",stopOpacity:.9}),e.jsx("stop",{offset:"100%",stopColor:"#991b1b",stopOpacity:.8})]}),e.jsx("filter",{id:"barShadow",x:"-20%",y:"-20%",width:"140%",height:"140%",children:e.jsx("feDropShadow",{dx:"3",dy:"3",stdDeviation:"4",floodColor:"#dc2626",floodOpacity:"0.4"})})]}),e.jsx(ye,{strokeDasharray:"3 3",stroke:"#e2e8f0",opacity:.6}),e.jsx(Ne,{dataKey:"name",stroke:"#475569",fontSize:11,fontWeight:600,angle:-45,textAnchor:"end",height:80}),e.jsx(Le,{stroke:"#475569",fontSize:11,fontWeight:600}),e.jsx(ie,{content:e.jsx(h,{})}),e.jsx(rt,{dataKey:C,fill:"url(#barGradient3D)",radius:[6,6,0,0],filter:"url(#barShadow)"})]})})]})]})]}),e.jsxs(O,{className:"w-full bg-white/95 backdrop-blur-sm border-0 shadow-2xl overflow-hidden relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-600/5 to-red-600/5 rounded-xl transform translate-x-1 translate-y-1 -z-10 group-hover:translate-x-2 group-hover:translate-y-2 transition-transform duration-300"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-slate-800/5 to-slate-900/5 rounded-xl transform translate-x-0.5 translate-y-0.5 -z-10"}),e.jsxs(K,{className:"bg-gradient-to-r from-orange-700 via-red-700 to-red-800 text-white border-0 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-white/30 to-transparent"}),e.jsxs("div",{className:"flex items-center justify-between relative z-10",children:[e.jsxs(W,{className:"flex items-center gap-3 text-white text-lg font-bold",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-xl backdrop-blur-sm shadow-lg border border-white/20",children:e.jsx(st,{className:"w-5 h-5 text-white drop-shadow-lg"})}),"Conversion Status Distribution"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{size:"sm",variant:"ghost",className:"text-white hover:bg-white/10 border border-white/20 backdrop-blur-sm",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx(_,{size:"sm",variant:"ghost",className:"text-white hover:bg-white/10 border border-white/20 backdrop-blur-sm",children:e.jsx(we,{className:"w-4 h-4"})})]})]})]}),e.jsxs(E,{className:"p-6 bg-gradient-to-br from-slate-50 to-white relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-600/5 to-red-600/10 pointer-events-none"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-tr from-orange-500/10 to-transparent rounded-full blur-xl"}),e.jsx("div",{className:"h-80 relative z-10",children:e.jsx(je,{width:"100%",height:"100%",children:e.jsxs(ct,{children:[e.jsxs("defs",{children:[e.jsx("filter",{id:"pieShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"4",dy:"4",stdDeviation:"6",floodColor:"#000000",floodOpacity:"0.3"})}),e.jsx("filter",{id:"pieInnerShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("feDropShadow",{dx:"2",dy:"2",stdDeviation:"3",floodColor:"#000000",floodOpacity:"0.2"})})]}),e.jsx(dt,{data:k,cx:"50%",cy:"50%",labelLine:!1,outerRadius:100,innerRadius:40,fill:"#8884d8",dataKey:"value",filter:"url(#pieShadow)",label:({name:f,percentage:l})=>`${f} (${l}%)`,children:k.map((f,l)=>e.jsx(lt,{fill:f.color,stroke:"#ffffff",strokeWidth:3,filter:"url(#pieInnerShadow)"},`cell-${l}`))}),e.jsx(ie,{content:e.jsx(M,{})}),e.jsx(ot,{verticalAlign:"bottom",height:36,iconType:"circle",wrapperStyle:{paddingTop:"20px",fontSize:"12px",fontWeight:"600"}})]})})}),e.jsx("div",{className:"mt-6 pt-4 border-t border-slate-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl border border-green-200",children:[e.jsx("div",{className:"text-2xl font-bold text-green-700",children:k.find(f=>f.name.toLowerCase().includes("converted"))?.value||0}),e.jsx("div",{className:"text-xs text-green-600 font-medium",children:"Converted"})]}),e.jsxs("div",{className:"text-center p-3 bg-gradient-to-br from-red-50 to-rose-50 rounded-xl border border-red-200",children:[e.jsx("div",{className:"text-2xl font-bold text-red-700",children:k.find(f=>!f.name.toLowerCase().includes("converted"))?.value||0}),e.jsx("div",{className:"text-xs text-red-600 font-medium",children:"Pending"})]})]})})]})]})]})},Ct=({data:r,onDrillDown:T})=>{const[m,C]=j.useState("source"),[y,F]=j.useState("totalLeads"),[k,n]=j.useState("values"),[h,M]=j.useState("total"),[f,l]=j.useState("desc"),v=ht(),i=V=>new Intl.NumberFormat("en-IN").format(V),R=j.useMemo(()=>{const V=new Date(2024,0,1),p=new Date,S=[],u=new Date(p.getFullYear(),p.getMonth(),1);for(let w=new Date(V.getFullYear(),V.getMonth(),1);w<=u;w.setMonth(w.getMonth()+1))S.push(`${w.getFullYear()}-${String(w.getMonth()+1).padStart(2,"0")}`);return S},[]),N=R,g=j.useMemo(()=>{const V=()=>({totalLeads:0,trialsCompleted:0,trialsScheduled:0,convertedLeads:0,totalLTV:0,totalVisits:0}),p=new Map,S=(d,c)=>{d.totalLeads+=1,(c.trialStatus==="Trial Completed"||c.stage==="Trial Completed")&&(d.trialsCompleted+=1);const a=(c.trialStatus||"").toLowerCase(),t=(c.stage||"").toLowerCase();(a.includes("trial")&&!a.includes("completed")||t.includes("trial")&&!t.includes("completed"))&&(d.trialsScheduled+=1),c.conversionStatus==="Converted"&&(d.convertedLeads+=1),d.totalLTV+=c.ltv||0,d.totalVisits+=c.visits||0};r.forEach(d=>{if(!d.createdAt)return;const c=new Date(d.createdAt);if(isNaN(c.getTime()))return;const a=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`,t=d[m]||"Unknown";p.has(t)||p.set(t,{group:t,months:new Map,totals:V()});const s=p.get(t);s.months.has(a)||s.months.set(a,V()),S(s.months.get(a),d),S(s.totals,d)});const u=d=>{switch(y){case"totalLeads":return d.totalLeads;case"trialsCompleted":return d.trialsCompleted;case"trialsScheduled":return d.trialsScheduled;case"convertedLeads":return d.convertedLeads;case"ltv":return d.totalLeads>0?d.totalLTV/d.totalLeads:0;case"avgVisits":return d.totalLeads>0?d.totalVisits/d.totalLeads:0}};return Array.from(p.values()).map(d=>{const c=u(d.totals);return{group:d.group,months:d.months,totalVal:c}}).sort((d,c)=>{if(h==="group")return f==="asc"?d.group.localeCompare(c.group):c.group.localeCompare(d.group);if(h==="total")return f==="asc"?d.totalVal-c.totalVal:c.totalVal-d.totalVal})},[r,m,y,R,h,f]),L={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6}}},z=j.useRef(null);return e.jsx(ae.div,{variants:L,initial:"hidden",animate:"visible",className:"w-full",children:e.jsx(pe,{title:"Month-on-Month Performance",description:`Historical trends by ${m} and ${y}`,icon:e.jsx(X,{className:"w-5 h-5 text-white"}),totalItems:g.length,showDisplayToggle:!0,displayMode:k,onDisplayModeChange:V=>n(V),showCollapseControls:!1,tableRef:z,contextInfo:{selectedMetric:y,dateRange:v.dateRange,filters:v.filters,additionalInfo:{groupKey:m,metric:y,viewMode:k,sortBy:h,sortOrder:f,totalItems:g.length}},headerControls:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{className:"border border-white/30 bg-white/10 text-white rounded-md px-2 py-1 text-xs",value:m,onChange:V=>C(V.target.value),children:[e.jsx("option",{value:"source",className:"text-slate-900",children:"Group: Source"}),e.jsx("option",{value:"stage",className:"text-slate-900",children:"Group: Stage"}),e.jsx("option",{value:"center",className:"text-slate-900",children:"Group: Center"}),e.jsx("option",{value:"channel",className:"text-slate-900",children:"Group: Channel"}),e.jsx("option",{value:"associate",className:"text-slate-900",children:"Group: Associate"})]}),e.jsxs("select",{className:"border border-white/30 bg-white/10 text-white rounded-md px-2 py-1 text-xs",value:y,onChange:V=>F(V.target.value),children:[e.jsx("option",{value:"totalLeads",className:"text-slate-900",children:"Metric: Total Leads"}),e.jsx("option",{value:"trialsCompleted",className:"text-slate-900",children:"Metric: Trials Completed"}),e.jsx("option",{value:"trialsScheduled",className:"text-slate-900",children:"Metric: Trials Scheduled"}),e.jsx("option",{value:"convertedLeads",className:"text-slate-900",children:"Metric: Converted Leads"}),e.jsx("option",{value:"ltv",className:"text-slate-900",children:"Metric: Avg LTV"}),e.jsx("option",{value:"avgVisits",className:"text-slate-900",children:"Metric: Avg Visits"})]})]}),children:e.jsx("div",{className:"pt-0",children:e.jsx(ae.div,{className:"overflow-x-auto",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:(()=>{const V=c=>{if(!c)return 0;switch(y){case"totalLeads":return c.totalLeads;case"trialsCompleted":return c.trialsCompleted;case"trialsScheduled":return c.trialsScheduled;case"convertedLeads":return c.convertedLeads;case"ltv":return c.totalLeads>0?c.totalLTV/c.totalLeads:0;case"avgVisits":return c.totalLeads>0?c.totalVisits/c.totalLeads:0}},p=[{key:"group",header:"Group",align:"left",className:"min-w-[160px] sticky left-0 bg-white",render:c=>e.jsx("div",{className:"font-semibold text-slate-700 truncate",children:c})},...N.map((c,a)=>({key:c,header:new Date(c+"-01").toLocaleDateString("en-US",{month:"short",year:"numeric"}),align:"center",className:"min-w-[90px]",render:(t,s)=>{if(k==="values"){const $=V(s.months.get(c));return e.jsx("div",{className:"text-xs font-medium text-slate-700",children:y==="ltv"||y==="avgVisits"?$.toFixed(1):i($)})}const o=N[a-1];if(!o)return e.jsx("span",{className:"text-slate-400 text-xs",children:"-"});const b=V(s.months.get(c)),x=V(s.months.get(o)),A=x>0?(b-x)/x*100:0;return e.jsx("div",{className:H("text-xs font-semibold",A>0?"text-green-600":A<0?"text-red-600":"text-slate-500"),children:A===0?"0.0%":`${A>0?"+":""}${A.toFixed(1)}%`})}}))],S=new Map;g.forEach(c=>{N.forEach(a=>{const t=c.months.get(a);S.has(a)||S.set(a,{totalLeads:0,trialsCompleted:0,trialsScheduled:0,convertedLeads:0,totalLTV:0,totalVisits:0});const s=S.get(a);t&&(s.totalLeads+=t.totalLeads,s.trialsCompleted+=t.trialsCompleted,s.trialsScheduled+=t.trialsScheduled,s.convertedLeads+=t.convertedLeads,s.totalLTV+=t.totalLTV,s.totalVisits+=t.totalVisits)})});const u={group:"TOTALS"};N.forEach((c,a)=>{const t=S.get(c);if(k==="values"){const s=V(t);u[c]=y==="ltv"||y==="avgVisits"?s.toFixed(1):i(s)}else{const s=N[a-1];if(!s)u[c]="-";else{const o=V(t),b=S.get(s),x=V(b),A=x>0?(o-x)/x*100:0;u[c]=A===0?"0.0%":`${A>0?"+":""}${A.toFixed(1)}%`}}});const w=e.jsx(xt,{data:g,columns:p,loading:!1,stickyHeader:!0,showFooter:!0,footerData:u,maxHeight:"480px",className:"rounded-lg",headerGradient:"from-slate-800 via-slate-900 to-slate-800",onRowClick:T?c=>{const a=r.filter(t=>(t[m]||"Unknown")===c.group);T(`${m}: ${c.group}`,a,"month-on-month")}:void 0}),d=[];if(g.length>0){const c=N[N.length-1],a=[...g].map(t=>({name:t.group,v:V(t.months.get(c))})).sort((t,s)=>s.v-t.v)[0];if(a&&a.v>0&&d.push(`Top ${m} in the latest month: ${a.name} (${y==="ltv"||y==="avgVisits"?a.v.toFixed(1):i(a.v)})`),k==="growth"){const t=N.length-1,s=N[t-1];if(s){const b=[...g.map(x=>{const A=V(x.months.get(c)),$=V(x.months.get(s));return{name:x.group,g:$>0?(A-$)/$*100:0}})].sort((x,A)=>A.g-x.g)[0];b&&b.g!==0&&d.push(`Strongest MoM growth: ${b.name} (${b.g>0?"+":""}${b.g.toFixed(1)}%)`)}}}return e.jsxs("div",{children:[w,e.jsxs("div",{className:"border-t border-slate-200 p-4 bg-slate-50 mt-2 rounded-b-xl",children:[e.jsx("div",{className:"text-sm font-bold text-slate-700 mb-2",children:"AI Notes"}),d.length?e.jsx("ul",{className:"list-disc pl-5 text-sm text-slate-600 space-y-1",children:d.map((c,a)=>e.jsx("li",{children:c},a))}):e.jsx("div",{className:"text-xs text-slate-500",children:"No notable anomalies detected in the selected view."})]})]})})()})})})})},kt=({allData:r,onDrillDown:T})=>{const[m,C]=j.useState("totalLeads"),[y,F]=j.useState("values"),[k,n]=j.useState("total"),[h,M]=j.useState("desc"),f=j.useRef(null),l=xe();he.useEffect(()=>(f.current&&l.registerTable("funnel-year-on-year-analysis",f.current),()=>l.unregisterTable("funnel-year-on-year-analysis")),[l]);const v={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6}}},i=j.useMemo(()=>{if(!r.length)return[];const u=r.reduce((t,s)=>{const o=s.source||"Unknown";if(t[o]||(t[o]={}),s.createdAt){const b=new Date(s.createdAt),x=b.getFullYear(),A=b.getMonth()+1,$=`${x}-${String(A).padStart(2,"0")}`;t[o][$]||(t[o][$]={totalLeads:0,trialsCompleted:0,trialsScheduled:0,proximityIssues:0,convertedLeads:0,totalLTV:0,totalVisits:0});const U=t[o][$];U.totalLeads+=1;const J=(s.trialStatus||"").toLowerCase(),D=(s.stage||"").toLowerCase();(s.trialStatus==="Trial Completed"||s.stage==="Trial Completed")&&(U.trialsCompleted+=1),(J.includes("trial")&&!J.includes("completed")||D.includes("trial")&&!D.includes("completed"))&&(U.trialsScheduled+=1),(D.includes("proximity")||(s.remarks||"").toLowerCase().includes("proximity"))&&(U.proximityIssues+=1),s.conversionStatus==="Converted"&&(U.convertedLeads+=1),U.totalLTV+=s.ltv||0,U.totalVisits+=s.visits||0}return t},{}),w=new Date,d=w.getFullYear(),c=w.getMonth()+1,a=[];for(let t=1;t<=c;t++){const s=new Date(d,t-1).toLocaleString("default",{month:"short"});a.push({month:t,name:s,current:`${d}-${String(t).padStart(2,"0")}`,previous:`${d-1}-${String(t).padStart(2,"0")}`})}return Object.keys(u).map(t=>{const s=u[t],o={source:t};return a.forEach(b=>{const x=s[b.current]||{totalLeads:0,trialsCompleted:0,trialsScheduled:0,proximityIssues:0,convertedLeads:0,totalLTV:0,totalVisits:0},A=s[b.previous]||{totalLeads:0,trialsCompleted:0,trialsScheduled:0,proximityIssues:0,convertedLeads:0,totalLTV:0,totalVisits:0},$=D=>{const ne=D.trialsCompleted>0?D.convertedLeads/D.trialsCompleted*100:0,Re=D.totalLeads>0?D.trialsCompleted/D.totalLeads*100:0,$e=D.totalLeads>0?D.convertedLeads/D.totalLeads*100:0,De=D.totalLeads>0?D.totalLTV/D.totalLeads:0,Ae=D.totalLeads>0?D.totalVisits/D.totalLeads:0,Fe=D.totalLeads>0?(D.totalLeads-D.proximityIssues)/D.totalLeads*100:0;return{totalLeads:D.totalLeads,trialsCompleted:D.trialsCompleted,trialsScheduled:D.trialsScheduled,proximityIssues:D.proximityIssues,convertedLeads:D.convertedLeads,trialToMemberRate:ne,leadToTrialRate:Re,leadToMemberRate:$e,ltv:De,avgVisits:Ae,pipelineHealth:Fe}},U=$(x),J=$(A);o[`${b.name}_${d}`]=U,o[`${b.name}_${d-1}`]=J}),o}).filter(t=>a.some(s=>t[`${s.name}_${d}`]?.totalLeads>0||t[`${s.name}_${d-1}`]?.totalLeads>0))},[r]),R=j.useMemo(()=>{const u=new Date,w=u.getFullYear(),d=u.getMonth()+1,c=[];for(let t=1;t<=d;t++){const s=new Date(w,t-1).toLocaleString("default",{month:"short"});c.push({month:t,name:s})}const a={source:"TOTALS"};return c.forEach(t=>{const s=i.reduce((x,A)=>{const $=A[`${t.name}_${w}`]||{};return x.totalLeads+=$.totalLeads||0,x.trialsCompleted+=$.trialsCompleted||0,x.trialsScheduled+=$.trialsScheduled||0,x.proximityIssues+=$.proximityIssues||0,x.convertedLeads+=$.convertedLeads||0,x.totalLTV+=($.ltv||0)*($.totalLeads||0),x.totalVisits+=($.avgVisits||0)*($.totalLeads||0),x},{totalLeads:0,trialsCompleted:0,trialsScheduled:0,proximityIssues:0,convertedLeads:0,totalLTV:0,totalVisits:0}),o=i.reduce((x,A)=>{const $=A[`${t.name}_${w-1}`]||{};return x.totalLeads+=$.totalLeads||0,x.trialsCompleted+=$.trialsCompleted||0,x.trialsScheduled+=$.trialsScheduled||0,x.proximityIssues+=$.proximityIssues||0,x.convertedLeads+=$.convertedLeads||0,x.totalLTV+=($.ltv||0)*($.totalLeads||0),x.totalVisits+=($.avgVisits||0)*($.totalLeads||0),x},{totalLeads:0,trialsCompleted:0,trialsScheduled:0,proximityIssues:0,convertedLeads:0,totalLTV:0,totalVisits:0}),b=x=>{const A=x.trialsCompleted>0?x.convertedLeads/x.trialsCompleted*100:0,$=x.totalLeads>0?x.trialsCompleted/x.totalLeads*100:0,U=x.totalLeads>0?x.convertedLeads/x.totalLeads*100:0,J=x.totalLeads>0?x.totalLTV/x.totalLeads:0,D=x.totalLeads>0?x.totalVisits/x.totalLeads:0,ne=x.totalLeads>0?(x.totalLeads-x.proximityIssues)/x.totalLeads*100:0;return{totalLeads:x.totalLeads,trialsCompleted:x.trialsCompleted,trialsScheduled:x.trialsScheduled,proximityIssues:x.proximityIssues,convertedLeads:x.convertedLeads,trialToMemberRate:A,leadToTrialRate:$,leadToMemberRate:U,ltv:J,avgVisits:D,pipelineHealth:ne}};a[`${t.name}_${w}`]=b(s),a[`${t.name}_${w-1}`]=b(o)}),a},[i]),N=(u,w)=>{if(typeof u!="object"||!u)return"-";const d=u[w];if(d===void 0||d===0)return"-";switch(w){case"ltv":return d<1e3?`₹${Math.round(d)}`:Y(d);case"trialToMemberRate":case"leadToTrialRate":case"leadToMemberRate":case"pipelineHealth":return`${d.toFixed(1)}%`;case"avgVisits":return d.toFixed(1);default:return d.toLocaleString("en-IN")}},g=j.useMemo(()=>{const u=new Date,w=u.getFullYear(),d=u.getMonth()+1,c=[];for(let t=1;t<=d;t++){const s=new Date(w,t-1).toLocaleString("default",{month:"short"});c.push({month:t,name:s})}const a={source:"TOTALS"};return c.forEach(t=>{const s=R[`${t.name}_${w}`],o=R[`${t.name}_${w-1}`];if(y==="growth"){const b=s?.[m]||0,x=o?.[m]||0;if(x>0){const A=(b-x)/x*100;a[`${t.name}_${w}`]=A>0?`+${A.toFixed(1)}%`:`${A.toFixed(1)}%`}else a[`${t.name}_${w}`]="-";a[`${t.name}_${w-1}`]="—"}else a[`${t.name}_${w}`]=N(s,m),a[`${t.name}_${w-1}`]=N(o,m)}),a},[R,m,y]),L=[{value:"totalLeads",label:"Total Leads"},{value:"trialsCompleted",label:"Trials Completed"},{value:"trialsScheduled",label:"Trials Scheduled"},{value:"proximityIssues",label:"Proximity Issues"},{value:"convertedLeads",label:"Converted Leads"},{value:"trialToMemberRate",label:"Trial → Member Rate"},{value:"leadToTrialRate",label:"Lead → Trial Rate"},{value:"leadToMemberRate",label:"Lead → Member Rate"},{value:"ltv",label:"Average LTV"},{value:"avgVisits",label:"Avg Visits/Lead"},{value:"pipelineHealth",label:"Pipeline Health"}],z=new Date,V=z.getFullYear(),p=z.getMonth()+1,S=[];for(let u=1;u<=p;u++){const w=new Date(V,u-1).toLocaleString("default",{month:"short"});S.push({month:u,name:w})}return[...S.flatMap(u=>[{key:`${u.name}_${V}`,header:`${u.name} ${V}`,render:(w,d)=>{if(y==="growth"){const c=w,a=d[`${u.name}_${V-1}`];let t=null,s="";if(c&&a&&typeof c=="object"&&typeof a=="object"){const o=c[m],b=a[m];o!==void 0&&b!==void 0&&b!==0&&(t=(o-b)/b*100,Math.abs(t)>.1?s=t>0?`+${t.toFixed(1)}%`:`${t.toFixed(1)}%`:s="0.0%")}return e.jsx("div",{className:"text-center text-xs font-semibold",children:s?e.jsx("span",{className:H(t&&t>0?"text-green-600":"text-red-600"),children:s}):e.jsx("span",{className:"text-slate-400",children:"-"})})}return e.jsx("div",{className:"text-center font-medium text-xs text-slate-700",children:N(w,m)})},align:"center",className:"min-w-[90px]"},{key:`${u.name}_${V-1}`,header:`${u.name} ${V-1}`,render:(w,d)=>{const c=d[`${u.name}_${V}`],a=w;if(y==="growth"){let t=null;if(c&&a&&typeof c=="object"&&typeof a=="object"){const s=c[m],o=a[m];s!==void 0&&o!==void 0&&o!==0&&(t=(s-o)/o*100,Math.abs(t)>.1&&(t>0?`${t.toFixed(1)}`:`${t.toFixed(1)}`))}return e.jsx("div",{className:"text-center text-xs text-slate-400",children:"—"})}return e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"font-medium text-slate-700 text-xs",children:N(w,m)})})},align:"center",className:"min-w-[90px]"}])],e.jsx(ae.div,{variants:v,initial:"hidden",animate:"visible",className:"w-full",children:e.jsx(pe,{title:"Year-on-Year Source Performance",description:`Historical comparison across years by source - ${L.find(u=>u.value===m)?.label||m}`,icon:e.jsx(X,{className:"w-5 h-5 text-white"}),totalItems:i.length,showDisplayToggle:!0,displayMode:y,onDisplayModeChange:u=>F(u),showCollapseControls:!1,tableRef:f,headerControls:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("select",{className:"border border-white/30 bg-white/10 text-white rounded-md px-2 py-1 text-xs",value:m,onChange:u=>C(u.target.value),children:L.map(u=>e.jsx("option",{value:u.value,className:"text-slate-900",children:u.label},u.value))})}),children:e.jsxs("div",{className:"pt-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 p-4 bg-white rounded-lg border mb-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Metric"}),e.jsx("select",{value:m,onChange:u=>C(u.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:L.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"View Mode"}),e.jsxs("select",{value:y,onChange:u=>F(u.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"values",children:"Values"}),e.jsx("option",{value:"growth",children:"Growth %"})]})]})]}),e.jsxs(ae.div,{className:"overflow-auto rounded-lg",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:[e.jsx("div",{className:"overflow-x-auto","data-table":"funnel-year-on-year-analysis",children:e.jsxs("table",{ref:f,className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:[e.jsx("th",{className:"px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide sticky left-0 z-40 border-r border-white/20 cursor-pointer select-none",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4 text-white"}),e.jsx("span",{children:"Source"})]})}),S.map(u=>{const w=new Date().getFullYear();return[e.jsx("th",{className:"px-3 py-3 text-center font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[90px] cursor-pointer select-none text-white",onClick:()=>{const d=`${u.name}_${w}`;k!==d?(n(d),M("desc")):M(c=>c==="desc"?"asc":"desc")},title:`Sort by ${u.name} ${w} (${h})`,children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(G,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-bold whitespace-nowrap",children:u.name})]}),e.jsx("span",{className:"text-slate-300 text-xs",children:w})]})},`${u.name}_${w}`),e.jsx("th",{className:"px-3 py-3 text-center font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[90px] cursor-pointer select-none text-white",onClick:()=>{const d=`${u.name}_${w-1}`;k!==d?(n(d),M("desc")):M(c=>c==="desc"?"asc":"desc")},title:`Sort by ${u.name} ${w-1} (${h})`,children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs font-bold whitespace-nowrap",children:u.name}),e.jsx("span",{className:"text-slate-300 text-xs",children:w-1})]})},`${u.name}_${w-1}`)]})]})}),e.jsxs("tbody",{children:[i.map((u,w)=>e.jsxs("tr",{className:"bg-white hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 border-b border-gray-200 transition-all duration-300 hover:shadow-lg animate-in slide-in-from-left-2 fade-in duration-300 cursor-pointer h-9 max-h-9",onClick:()=>{if(T){const d=r.filter(c=>c.source===u.source);T(`Source: ${u.source} - Year Analysis`,d,"year-source")}},children:[e.jsx("td",{className:"px-6 py-2 text-left sticky left-0 bg-white border-r border-gray-200 z-10 transition-all duration-300 whitespace-nowrap overflow-hidden text-ellipsis",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-slate-400 text-xs",children:"•"}),e.jsx("span",{className:"text-slate-700 font-medium text-xs",children:u.source})]})}),S.map(d=>{const c=new Date().getFullYear(),a=u[`${d.name}_${c}`],t=u[`${d.name}_${c-1}`];return[e.jsx("td",{className:"px-2 py-2 text-center text-sm font-mono text-slate-700 border-l border-gray-200 hover:bg-blue-100/60 cursor-pointer transition-all duration-200 whitespace-nowrap",children:e.jsx("div",{className:"space-y-1",children:e.jsx("div",{className:"font-bold",children:y==="values"?N(a,m):(()=>{let s=null;if(a&&t&&typeof a=="object"&&typeof t=="object"){const o=a[m],b=t[m];o!==void 0&&b!==void 0&&b!==0&&(s=(o-b)/b*100)}return s===null?"—":e.jsxs("span",{className:s>0?"text-emerald-600":s<0?"text-red-500":"text-gray-500",children:[s>0?"+":"",s.toFixed(1),"%"]})})()})})},`${d.name}_${c}`),e.jsx("td",{className:"px-2 py-2 text-center text-sm font-mono text-slate-700 border-l border-gray-200 hover:bg-blue-100/60 cursor-pointer transition-all duration-200 whitespace-nowrap",children:e.jsx("div",{className:"space-y-1",children:e.jsx("div",{className:"font-bold",children:y==="values"?N(t,m):e.jsx("span",{className:"text-slate-400 text-xs",children:"—"})})})},`${d.name}_${c-1}`)]})]},u.source)),e.jsxs("tr",{className:"bg-slate-800 text-white font-bold border-t-2 border-slate-400",children:[e.jsx("td",{className:"px-6 py-3 text-left sticky left-0 bg-slate-800 border-r border-slate-400 z-20 cursor-pointer hover:underline whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"text-cyan-100 font-bold text-sm",children:"TOTALS"})]})}),S.map(u=>{const w=new Date().getFullYear(),d=g[`${u.name}_${w}`],c=g[`${u.name}_${w-1}`];return[e.jsx("td",{className:"px-2 py-2 text-center text-sm font-bold text-white border-l border-slate-400 hover:bg-slate-700 cursor-pointer transition-all duration-200",children:e.jsx("div",{className:"flex flex-col items-center space-y-0.5 min-h-6 justify-center",children:e.jsx("span",{className:"font-mono text-xs whitespace-nowrap",children:N(d,m)})})},`totals_${u.name}_${w}`),e.jsx("td",{className:"px-2 py-2 text-center text-sm font-bold text-white border-l border-slate-400 hover:bg-slate-700 cursor-pointer transition-all duration-200",children:e.jsx("div",{className:"flex flex-col items-center space-y-0.5 min-h-6 justify-center",children:e.jsx("span",{className:"font-mono text-xs whitespace-nowrap",children:N(c,m)})})},`totals_${u.name}_${w-1}`)]})]})]})]})}),e.jsx("div",{className:"border-t border-slate-200 p-4 bg-slate-50 rounded-b-xl mt-2",children:(()=>{const w=new Date().getFullYear(),d=S[S.length-1]?.name;if(!d)return e.jsx("div",{className:"text-xs text-slate-500",children:"No data available."});const c=`${d}_${w}`,a=`${d}_${w-1}`,t=i.filter(b=>b[c]?.[m]>0);if(!t.length)return e.jsx("div",{className:"text-xs text-slate-500",children:"No notable points for the latest month."});const s=[...t].sort((b,x)=>(x[c]?.[m]||0)-(b[c]?.[m]||0))[0];if(!s)return e.jsx("div",{className:"text-xs text-slate-500",children:"No data available."});const o=s[c]&&s[a]&&s[a][m]?(s[c][m]-s[a][m])/s[a][m]*100:0;return e.jsxs("ul",{className:"list-disc pl-5 text-sm text-slate-600 space-y-1",children:[e.jsxs("li",{children:["Top source in ",d," ",w,": ",e.jsx("span",{className:"font-semibold",children:s.source})]}),e.jsxs("li",{children:[m," YoY change: ",o>0?"+":"",o.toFixed(1),"%"]})]})})()})]}),e.jsx(Me,{tableRef:f,filename:"funnel-year-on-year-analysis",sheetName:"Funnel YoY Analysis"})]})})})},Tt=({data:r})=>{const[T,m]=j.useState("source"),[C,y]=j.useState(!1),F=j.useMemo(()=>{if(!r||r.length===0)return{sources:[],stages:[]};const v=new Map;r.forEach(g=>{const L=g.source||"Unknown";v.has(L)||v.set(L,{name:L,count:0,converted:0,revenue:0,conversionRate:0});const z=v.get(L);z.count+=1,g.conversionStatus==="Converted"&&(z.converted+=1),z.revenue+=g.ltv||0});const i=Array.from(v.values()).map(g=>({...g,conversionRate:g.count>0?g.converted/g.count*100:0,avgRevenue:g.count>0?g.revenue/g.count:0})).sort((g,L)=>L.count-g.count),R=new Map;r.forEach(g=>{const L=g.stage||"Unknown";R.has(L)||R.set(L,{name:L,count:0,converted:0,revenue:0,conversionRate:0});const z=R.get(L);z.count+=1,g.conversionStatus==="Converted"&&(z.converted+=1),z.revenue+=g.ltv||0});const N=Array.from(R.values()).map(g=>({...g,conversionRate:g.count>0?g.converted/g.count*100:0,avgRevenue:g.count>0?g.revenue/g.count:0,percentage:g.count>0?g.count/r.length*100:0})).sort((g,L)=>L.count-g.count);return{sources:i,stages:N}},[r]);r?.length;const k=C?10:5,n=T==="source"?F.sources:F.stages,h=n.slice(0,k),M=n.slice(-k).reverse(),f=v=>v==="source"?{icon:le,label:"Sources",description:"Lead source performance"}:{icon:Z,label:"Stages",description:"Funnel stage performance"},l=(v,i,R)=>{const N=f(R);return e.jsxs(O,{className:"bg-gradient-to-br from-white via-slate-50/50 to-white border-0 shadow-xl hover:shadow-2xl transition-all duration-500",children:[e.jsx(K,{className:"pb-4",children:e.jsx(W,{className:"flex items-center gap-3 text-xl",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500",children:e.jsx(mt,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsxs("span",{className:"bg-gradient-to-r from-yellow-600 to-orange-600 bg-clip-text text-transparent",children:["Top ",k," ",N.label]}),e.jsx("p",{className:"text-sm text-slate-600 font-normal",children:N.description})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-r from-red-500 to-rose-600",children:e.jsx(ke,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsxs("span",{className:"bg-gradient-to-r from-red-600 to-rose-600 bg-clip-text text-transparent",children:["Bottom ",k," ",N.label]}),e.jsx("p",{className:"text-sm text-slate-600 font-normal",children:"Areas for improvement"})]})]})})}),e.jsxs(E,{className:"space-y-4",children:[v.map((g,L)=>e.jsxs("div",{className:`group flex items-center justify-between p-4 rounded-xl bg-white shadow-sm border hover:shadow-md transition-all duration-300 ${i?"hover:border-emerald-200/70":"hover:border-rose-200/70"}`,children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:H("w-12 h-12 rounded-full flex items-center justify-center shadow-lg",i?"bg-gradient-to-br from-yellow-400 via-amber-500 to-orange-500 text-white":"bg-gradient-to-br from-red-500 via-rose-600 to-red-700 text-white"),children:i?L===0?e.jsx(Se,{className:"w-6 h-6"}):L===1?e.jsx(Ce,{className:"w-6 h-6"}):L===2?e.jsx(ut,{className:"w-5 h-5"}):L===3?e.jsx(G,{className:"w-5 h-5"}):e.jsx("span",{className:"text-sm font-bold",children:L+1}):L===0?e.jsx(pt,{className:"w-6 h-6"}):L===1?e.jsx(ke,{className:"w-6 h-6"}):L===2?e.jsx(gt,{className:"w-5 h-5"}):e.jsx("span",{className:"text-sm font-bold",children:L+1})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-slate-900 whitespace-normal break-words group-hover:text-blue-600 transition-colors",children:g.name}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsxs(I,{variant:"secondary",className:"text-xs bg-blue-50 text-blue-700 border-blue-200",children:[P(g.count)," leads"]}),e.jsxs(I,{variant:"outline",className:"text-xs border-green-200 text-green-700",children:[g.conversionRate.toFixed(1),"% conv."]}),e.jsxs(I,{variant:"outline",className:"text-xs border-purple-200 text-purple-700",children:["Avg: ",Y(g.avgRevenue)]}),R==="stage"&&e.jsxs(I,{variant:"outline",className:"text-xs border-orange-200 text-orange-700",children:[g.percentage.toFixed(1),"% of funnel"]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-xl text-slate-900 group-hover:text-blue-600 transition-colors",children:P(g.count)}),e.jsxs("p",{className:"text-sm text-slate-500",children:[P(g.converted)," converted"]}),e.jsxs("p",{className:"text-xs text-slate-400",children:[Y(g.revenue)," revenue"]})]})]},g.name)),e.jsxs("div",{className:"mt-6 p-4 bg-gradient-to-r from-slate-50 to-slate-100 rounded-lg border",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h4",{className:"font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"Performance Summary"]}),e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>y(!C),className:"text-xs",children:["Show ",C?"Less":"More"]})]}),e.jsxs("ul",{className:"text-sm text-slate-600 space-y-1",children:[e.jsxs("li",{children:["• Average leads: ",P(v.reduce((g,L)=>g+L.count,0)/v.length)]}),e.jsxs("li",{children:["• Total converted: ",P(v.reduce((g,L)=>g+L.converted,0))]}),e.jsxs("li",{children:["• Combined revenue: ",Y(v.reduce((g,L)=>g+L.revenue,0))]}),e.jsxs("li",{children:["• Performance spread: ",((v[0]?.count/v[v.length-1]?.count||1)-1).toFixed(1),"x variance"]})]})]})]})]})};return e.jsx("div",{className:"space-y-6",children:e.jsxs(O,{className:"bg-gradient-to-br from-white via-slate-50/20 to-white border-0 shadow-xl",children:[e.jsx(K,{className:"pb-4",children:e.jsx(W,{className:"text-2xl font-bold bg-gradient-to-r from-slate-700 via-slate-800 to-slate-900 bg-clip-text text-transparent",children:"Lead Performance Rankings"})}),e.jsx(E,{children:e.jsxs(me,{value:T,onValueChange:v=>m(v),className:"w-full",children:[e.jsxs(ue,{className:"bg-white/90 backdrop-blur-sm p-1.5 rounded-2xl shadow-xl border border-slate-200 w-full max-w-2xl mx-auto overflow-visible grid grid-cols-2 gap-0.5",children:[e.jsxs(B,{value:"source",className:"relative text-center px-3 py-3 font-semibold text-sm min-h-[60px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-700 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-10 data-[state=active]:scale-105 hover:bg-gray-50 rounded-lg transition-all duration-200 flex items-center justify-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{className:"text-sm leading-tight whitespace-nowrap",children:"Lead Sources"})]}),e.jsxs(B,{value:"stage",className:"relative text-center px-3 py-3 font-semibold text-sm min-h-[60px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-700 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-10 data-[state=active]:scale-105 hover:bg-gray-50 rounded-lg transition-all duration-200 flex items-center justify-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{className:"text-sm leading-tight whitespace-nowrap",children:"Funnel Stages"})]})]}),e.jsx(Q,{value:T,className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[l(h,!0,T),l(M,!1,T)]})})]})})]})})},Vt=({data:r})=>{const T=j.useRef(null),m=xe();he.useEffect(()=>(T.current&&m.registerTable("funnel-health-metrics",T.current),()=>m.unregisterTable("funnel-health-metrics")),[m]);const C=j.useMemo(()=>{if(!r.length)return[];const n=r.length,h=r.filter(N=>N.stage?.includes("Trial")).length,M=r.filter(N=>N.stage==="Trial Completed").length,f=r.filter(N=>N.conversionStatus==="Converted").length;r.filter(N=>N.status==="Lost").length;const l=r.filter(N=>N.stage==="Proximity Issues").length,v=r.filter(N=>N.followUp1Date||N.followUp2Date||N.followUp3Date).length,i=r.reduce((N,g)=>N+(g.ltv||0),0),R=r.reduce((N,g)=>N+(g.visits||0),0);return[{metric:"Lead Volume Health",value:n,benchmark:1e3,status:n>=1e3?"Excellent":n>=500?"Good":"Needs Attention",description:"Total leads generated in period"},{metric:"Trial Scheduling Rate",value:n>0?h/n*100:0,benchmark:60,status:h/n*100>=60?"Excellent":h/n*100>=40?"Good":"Needs Attention",description:"Percentage of leads scheduling trials"},{metric:"Trial Completion Rate",value:h>0?M/h*100:0,benchmark:80,status:M/h*100>=80?"Excellent":M/h*100>=60?"Good":"Needs Attention",description:"Trials completed vs scheduled"},{metric:"Conversion Efficiency",value:n>0?f/n*100:0,benchmark:25,status:f/n*100>=25?"Excellent":f/n*100>=15?"Good":"Needs Attention",description:"Overall lead to member conversion"},{metric:"Proximity Issue Rate",value:n>0?l/n*100:0,benchmark:10,status:l/n*100<=10?"Excellent":l/n*100<=20?"Good":"Needs Attention",description:"Leads lost due to location issues"},{metric:"Follow-up Coverage",value:n>0?v/n*100:0,benchmark:70,status:v/n*100>=70?"Excellent":v/n*100>=50?"Good":"Needs Attention",description:"Leads receiving follow-up actions"},{metric:"Average LTV",value:n>0?i/n:0,benchmark:5e3,status:i/n>=5e3?"Excellent":i/n>=3e3?"Good":"Needs Attention",description:"Revenue quality per lead"},{metric:"Engagement Level",value:n>0?R/n:0,benchmark:3,status:R/n>=3?"Excellent":R/n>=2?"Good":"Needs Attention",description:"Average visits per lead"}]},[r]),y=n=>n.metric.includes("Rate")||n.metric.includes("Coverage")||n.metric.includes("Efficiency")?`${n.value.toFixed(1)}%`:n.metric.includes("LTV")?Y(n.value):n.metric.includes("Volume")?P(n.value):n.value.toFixed(1),F=n=>{switch(n){case"Excellent":return e.jsx(I,{className:"w-24 justify-center bg-green-600 text-white hover:bg-green-700 font-bold",children:"Excellent"});case"Good":return e.jsx(I,{className:"w-24 justify-center bg-yellow-500 text-white hover:bg-yellow-600 font-bold",children:"Good"});default:return e.jsx(I,{className:"w-24 justify-center bg-red-600 text-white hover:bg-red-700 font-bold",children:"Needs Fix"})}},k=j.useMemo(()=>{const n=C.map(h=>{switch(h.status){case"Excellent":return 100;case"Good":return 70;default:return 30}});return n.length>0?Math.round(n.reduce((h,M)=>h+M,0)/n.length):0},[C]);return e.jsxs(pe,{title:"Funnel Health Metrics",description:"Key performance indicators for lead funnel health",icon:e.jsx(ft,{className:"w-6 h-6 text-white"}),totalItems:C.length,className:"animate-in slide-in-from-bottom-8 fade-in duration-1000",showCopyButton:!0,headerControls:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-slate-300",children:"Overall Health:"}),e.jsxs(I,{className:H("text-lg px-4 py-2 font-black",k>=85?"bg-green-600 text-white":k>=70?"bg-yellow-500 text-white":"bg-red-600 text-white"),children:[k,"%"]})]}),children:[e.jsx("div",{className:"overflow-x-auto","data-table":"funnel-health-metrics",children:e.jsxs("table",{ref:T,className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:[e.jsx("th",{className:"px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide border-r border-white/20",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4 text-white"}),e.jsx("span",{children:"Health Metric"})]})}),e.jsx("th",{className:"px-3 py-3 text-center font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[120px] text-white",children:"Current Value"}),e.jsx("th",{className:"px-3 py-3 text-center font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[120px] text-white",children:"Benchmark"}),e.jsx("th",{className:"px-3 py-3 text-center font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[120px] text-white",children:"Status"}),e.jsx("th",{className:"px-3 py-3 text-left font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[200px] text-white",children:"Description"})]})}),e.jsxs("tbody",{children:[C.map((n,h)=>e.jsxs("tr",{className:"bg-white hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 border-b border-gray-200 transition-all duration-300 hover:shadow-lg h-9 max-h-9",children:[e.jsx("td",{className:"px-6 py-2 text-left bg-white border-r border-gray-200 transition-all duration-300 whitespace-nowrap overflow-hidden text-ellipsis",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-slate-400 text-xs",children:"•"}),e.jsx("span",{className:"text-slate-700 font-semibold text-xs",children:n.metric})]})}),e.jsx("td",{className:"px-2 py-2 text-center text-sm font-mono text-slate-700 border-l border-gray-200 whitespace-nowrap",children:e.jsx("span",{className:"font-bold text-xs",children:y(n)})}),e.jsx("td",{className:"px-2 py-2 text-center text-sm font-mono text-slate-700 border-l border-gray-200 whitespace-nowrap",children:e.jsx("span",{className:"font-medium text-xs",children:n.metric.includes("Rate")||n.metric.includes("Coverage")||n.metric.includes("Efficiency")?`${n.benchmark}%`:n.metric.includes("LTV")?Y(n.benchmark):P(n.benchmark)})}),e.jsx("td",{className:"px-2 py-2 text-center border-l border-gray-200 whitespace-nowrap",children:F(n.status)}),e.jsx("td",{className:"px-3 py-2 text-left text-xs text-slate-600 border-l border-gray-200 whitespace-nowrap overflow-hidden text-ellipsis",children:n.description})]},n.metric)),e.jsxs("tr",{className:"bg-slate-800 text-white font-bold border-t-2 border-slate-400",children:[e.jsx("td",{className:"px-6 py-3 text-left bg-slate-800 border-r border-slate-400 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"text-cyan-100 font-bold text-sm",children:"OVERALL HEALTH"})]})}),e.jsx("td",{className:"px-2 py-2 text-center text-sm font-bold text-white border-l border-slate-400",children:e.jsxs("span",{className:"font-mono text-xs",children:[k,"%"]})}),e.jsx("td",{className:"px-2 py-2 text-center text-sm font-bold text-white border-l border-slate-400",children:e.jsx("span",{className:"font-mono text-xs",children:"85%"})}),e.jsx("td",{className:"px-2 py-2 text-center border-l border-slate-400",children:e.jsx(I,{className:H("text-xs px-2 py-1 font-bold",k>=85?"bg-green-600 text-white":k>=70?"bg-yellow-500 text-white":"bg-red-600 text-white"),children:k>=85?"Excellent":k>=70?"Good":"Needs Attention"})}),e.jsx("td",{className:"px-3 py-2 text-left text-xs text-slate-300 border-l border-slate-400",children:"Composite funnel health score"})]})]})]})}),e.jsxs("div",{className:"p-6 bg-slate-50 border-t mt-4 rounded-b-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(re,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"font-semibold text-slate-800",children:"Health Assessment"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(re,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"font-semibold text-green-800",children:"Strengths"})]}),e.jsxs("div",{className:"text-sm text-green-600",children:[C.filter(n=>n.status==="Excellent").length," metrics excellent"]})]}),e.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(oe,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{className:"font-semibold text-yellow-800",children:"Opportunities"})]}),e.jsxs("div",{className:"text-sm text-yellow-600",children:[C.filter(n=>n.status==="Good").length," metrics good"]})]}),e.jsxs("div",{className:"p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(vt,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"font-semibold text-red-800",children:"Action Needed"})]}),e.jsxs("div",{className:"text-sm text-red-600",children:[C.filter(n=>n.status==="Needs Attention").length," metrics need attention"]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-white rounded-lg border",children:[e.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Quick Recommendations:"}),e.jsxs("ul",{className:"text-sm text-slate-600 space-y-1",children:[k<70&&e.jsx("li",{children:"• Focus on improving trial completion rates"}),C.find(n=>n.metric==="Proximity Issue Rate"&&n.status==="Needs Attention")&&e.jsx("li",{children:"• Address location accessibility concerns"}),C.find(n=>n.metric==="Follow-up Coverage"&&n.status==="Needs Attention")&&e.jsx("li",{children:"• Implement systematic follow-up processes"}),k>=85&&e.jsx("li",{children:"• Excellent funnel health - maintain current strategies"})]})]})]}),e.jsx(Me,{tableRef:T,filename:"funnel-health-metrics",sheetName:"Health Metrics"})]})},Mt=({data:r,onDrillDown:T})=>{const[m,C]=j.useState({key:"totalLeads",direction:"desc",table:"source"}),y=j.useRef(null),F=j.useRef(null),k=j.useRef(null),n=j.useRef(null),h=j.useRef(null),M=j.useRef(null),f=xe(),l=(a,t)=>{C(s=>({key:a,table:t,direction:s.key===a&&s.table===t&&s.direction==="desc"?"asc":"desc"}))},v=(a,t)=>m.table!==t?a:[...a].sort((s,o)=>{const b=s[m.key],x=o[m.key];return typeof b=="string"&&typeof x=="string"?m.direction==="desc"?x.localeCompare(b):b.localeCompare(x):m.direction==="desc"?x-b:b-x}),i=(a,t)=>{if(T){let s=[],o="";switch(a){case"source":s=r.filter(b=>(b.source||"Unknown")===t.source),o=`${t.source} - Source Analysis`;break;case"stage":s=r.filter(b=>(b.stage||"Unknown")===t.stage),o=`${t.stage} - Stage Analysis`;break;case"ltv":o=`${t.ltvRange} - LTV Analysis`;break;case"proximity":s=r.filter(b=>b.stage?.includes("Proximity")),o=`Proximity Issues - ${t.location}`;break;default:return}T(o,s,a)}};he.useEffect(()=>(y.current&&f.registerTable("funnel-source-analytics",y.current),F.current&&f.registerTable("funnel-stage-analytics",F.current),()=>{f.unregisterTable("funnel-source-analytics"),f.unregisterTable("funnel-stage-analytics")}),[f]);const R=j.useMemo(()=>{const a=r.reduce((t,s)=>{const o=s.source||"Unknown";t[o]||(t[o]={totalLeads:0,trialsScheduled:0,trialsCompleted:0,converted:0,totalLTV:0,totalVisits:0,proximityIssues:0}),t[o].totalLeads+=1;const b=(s.trialStatus||"").toLowerCase(),x=(s.stage||"").toLowerCase();return(b.includes("trial")&&!b.includes("completed")||x.includes("trial")&&!x.includes("completed"))&&(t[o].trialsScheduled+=1),(s.trialStatus==="Trial Completed"||s.stage==="Trial Completed")&&(t[o].trialsCompleted+=1),s.conversionStatus==="Converted"&&(t[o].converted+=1),s.stage?.includes("Proximity")&&(t[o].proximityIssues+=1),t[o].totalLTV+=s.ltv||0,t[o].totalVisits+=s.visits||0,t},{});return Object.entries(a).map(([t,s])=>({source:t,totalLeads:s.totalLeads,trialsScheduled:s.trialsScheduled,trialsCompleted:s.trialsCompleted,converted:s.converted,conversionRate:s.totalLeads>0?s.converted/s.totalLeads*100:0,trialToMemberRate:s.trialsCompleted>0?s.converted/s.trialsCompleted*100:0,avgLTV:s.totalLeads>0?s.totalLTV/s.totalLeads:0,avgVisits:s.totalLeads>0?s.totalVisits/s.totalLeads:0,proximityIssues:s.proximityIssues,leadQuality:(s.converted*.4+s.trialsCompleted*.3+(s.totalLeads-s.proximityIssues)*.3)/s.totalLeads*100})).sort((t,s)=>s.totalLeads-t.totalLeads)},[r]),N=j.useMemo(()=>{const a=r.reduce((t,s)=>{const o=s.stage||"Unknown";return t[o]||(t[o]={totalLeads:0,converted:0,totalLTV:0,avgDaysInStage:0,retained:0}),t[o].totalLeads+=1,s.conversionStatus==="Converted"&&(t[o].converted+=1),s.retentionStatus==="Retained"&&(t[o].retained+=1),t[o].totalLTV+=s.ltv||0,t},{});return Object.entries(a).map(([t,s])=>({stage:t,totalLeads:s.totalLeads,converted:s.converted,conversionRate:s.totalLeads>0?s.converted/s.totalLeads*100:0,retentionRate:s.totalLeads>0?s.retained/s.totalLeads*100:0,avgLTV:s.totalLeads>0?s.totalLTV/s.totalLeads:0,stageEfficiency:(s.converted*.5+s.retained*.3+s.totalLeads*.2)/s.totalLeads*100})).sort((t,s)=>s.totalLeads-t.totalLeads)},[r]),g=j.useMemo(()=>[{label:"0-7 days",min:0,max:7},{label:"8-14 days",min:8,max:14},{label:"15-30 days",min:15,max:30},{label:"31-60 days",min:31,max:60},{label:"60+ days",min:61,max:1/0}].map(t=>{const s=r.filter(b=>{if(!b.createdAt||!b.convertedToCustomerAt)return!1;const x=new Date(b.createdAt),A=new Date(b.convertedToCustomerAt),$=Math.ceil((A.getTime()-x.getTime())/(1e3*60*60*24));return $>=t.min&&$<=t.max}),o=s.filter(b=>b.conversionStatus==="Converted");return{timeRange:t.label,totalLeads:s.length,converted:o.length,conversionRate:s.length>0?o.length/s.length*100:0,avgLTV:o.length>0?o.reduce((b,x)=>b+(x.ltv||0),0)/o.length:0,efficiency:s.length>0?(o.length*.6+s.length*.4)/s.length*100:0}}),[r]),L=j.useMemo(()=>[{label:"₹0",min:0,max:0},{label:"₹1-5k",min:1,max:5e3},{label:"₹5k-15k",min:5001,max:15e3},{label:"₹15k-30k",min:15001,max:3e4},{label:"₹30k+",min:30001,max:1/0}].map(t=>{const s=r.filter(b=>{const x=b.ltv||0;return x>=t.min&&x<=t.max}),o=s.filter(b=>b.conversionStatus==="Converted");return{ltvRange:t.label,totalLeads:s.length,converted:o.length,conversionRate:s.length>0?o.length/s.length*100:0,avgVisits:s.length>0?s.reduce((b,x)=>b+(x.visits||0),0)/s.length:0,totalRevenue:s.reduce((b,x)=>b+(x.ltv||0),0),valueScore:o.length>0?o.reduce((b,x)=>b+(x.ltv||0),0)/o.length*(o.length/s.length):0}}),[r]),z=j.useMemo(()=>{const a=r.length||1,t=r.reduce((s,o)=>{const b=o.stage||"Unknown";return s[b]||(s[b]={count:0,converted:0,totalLTV:0}),s[b].count+=1,o.conversionStatus==="Converted"&&(s[b].converted+=1),s[b].totalLTV+=o.ltv||0,s},{});return Object.entries(t).map(([s,o])=>({stage:s,leadCount:o.count,percentage:o.count/a*100,converted:o.converted,conversionRate:o.count>0?o.converted/o.count*100:0,avgLTV:o.count>0?o.totalLTV/o.count:0,stagePopularity:o.count/a*100})).sort((s,o)=>o.leadCount-s.leadCount).slice(0,10)},[r]),V=j.useMemo(()=>{const a=r.reduce((t,s)=>{const o=s.center||"Unknown";return t[o]||(t[o]={totalLeads:0,proximityIssues:0}),t[o].totalLeads+=1,s.stage?.includes("Proximity")&&(t[o].proximityIssues+=1),t},{});return Object.entries(a).map(([t,s])=>({location:t,totalLeads:s.totalLeads,proximityIssues:s.proximityIssues,proximityRate:s.totalLeads>0?s.proximityIssues/s.totalLeads*100:0,impactScore:s.proximityIssues*(s.proximityIssues/s.totalLeads)*100})).sort((t,s)=>s.totalLeads-t.totalLeads)},[r]),p=j.useMemo(()=>v(R,"source"),[R,m]),S=j.useMemo(()=>v(N,"stage"),[N,m]),u=j.useMemo(()=>v(g,"timespan"),[g,m]),w=j.useMemo(()=>v(L,"ltv"),[L,m]),d=j.useMemo(()=>v(z,"topstages"),[z,m]),c=j.useMemo(()=>v(V,"proximity"),[V,m]);return e.jsx("div",{className:"space-y-6",children:e.jsxs(me,{defaultValue:"source",className:"w-full",children:[e.jsxs(ue,{className:"grid w-full grid-cols-6 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 p-1 rounded-lg border border-slate-600",children:[e.jsxs(B,{value:"source",className:"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-300 hover:text-white hover:bg-slate-600/50 data-[state=active]:bg-gradient-to-r data-[state=active]:from-slate-900 data-[state=active]:to-slate-800 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border data-[state=active]:border-slate-500",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Source"]}),e.jsxs(B,{value:"stage",className:"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-300 hover:text-white hover:bg-slate-600/50 data-[state=active]:bg-gradient-to-r data-[state=active]:from-slate-900 data-[state=active]:to-slate-800 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border data-[state=active]:border-slate-500",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Stage"]}),e.jsxs(B,{value:"timespan",className:"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-300 hover:text-white hover:bg-slate-600/50 data-[state=active]:bg-gradient-to-r data-[state=active]:from-slate-900 data-[state=active]:to-slate-800 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border data-[state=active]:border-slate-500",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Time Span"]}),e.jsxs(B,{value:"ltv",className:"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-300 hover:text-white hover:bg-slate-600/50 data-[state=active]:bg-gradient-to-r data-[state=active]:from-slate-900 data-[state=active]:to-slate-800 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border data-[state=active]:border-slate-500",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"LTV"]}),e.jsxs(B,{value:"topstages",className:"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-300 hover:text-white hover:bg-slate-600/50 data-[state=active]:bg-gradient-to-r data-[state=active]:from-slate-900 data-[state=active]:to-slate-800 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border data-[state=active]:border-slate-500",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Top Stages"]}),e.jsxs(B,{value:"proximity",className:"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-300 hover:text-white hover:bg-slate-600/50 data-[state=active]:bg-gradient-to-r data-[state=active]:from-slate-900 data-[state=active]:to-slate-800 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border data-[state=active]:border-slate-500",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Proximity"]})]}),e.jsx(Q,{value:"source",className:"mt-6",children:e.jsxs(O,{className:"bg-white/95 backdrop-blur-sm border-0 shadow-xl relative",children:[e.jsx(K,{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(W,{className:"text-white flex items-center gap-2 text-lg font-bold",children:[e.jsx(Z,{className:"w-5 h-5"}),"Conversion by Source"]}),e.jsx(q,{tableRef:y,tableName:"Conversion by Source",size:"sm",className:"text-white hover:bg-white/20"})]})}),e.jsx(E,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto","data-table":"funnel-source-analytics",children:e.jsxs("table",{ref:y,className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:[e.jsx("th",{className:"px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide h-9 max-h-9 sticky left-0 z-40 border-r border-white/20",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4 text-white"}),e.jsx("span",{children:"Source"})]})}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px] cursor-pointer select-none",onClick:()=>l("totalLeads","source"),title:"Sort by Total Leads",children:"Total Leads"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px] cursor-pointer select-none",onClick:()=>l("converted","source"),title:"Sort by Converted",children:"Converted"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px] cursor-pointer select-none",onClick:()=>l("conversionRate","source"),title:"Sort by Conversion Rate",children:"Conv. Rate"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px] cursor-pointer select-none",onClick:()=>l("avgLTV","source"),title:"Sort by Average LTV",children:"Avg LTV"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px] cursor-pointer select-none",onClick:()=>l("leadQuality","source"),title:"Sort by Quality Score",children:"Quality Score"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:p.map((a,t)=>e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer h-9 max-h-9",onClick:()=>i("source",a),children:[e.jsx("td",{className:"px-6 py-2 font-semibold text-gray-800 h-9 max-h-9 sticky left-0 z-30 bg-white border-r border-gray-200",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:a.source})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:P(a.totalLeads)})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:P(a.converted)})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsxs("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:[a.conversionRate.toFixed(1),"%"]})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:Y(a.avgLTV)})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:a.leadQuality.toFixed(1)})})]},a.source))}),e.jsx("tfoot",{className:"bg-gray-50 border-t-2 border-gray-300",children:e.jsxs("tr",{className:"font-bold h-9 max-h-9",children:[e.jsx("td",{className:"px-6 py-2 text-gray-800 h-9 max-h-9 sticky left-0 z-30 bg-gray-50 border-r border-gray-300",children:e.jsxs("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:"TOTALS"})]})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-800 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:P(p.reduce((a,t)=>a+t.totalLeads,0))})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-800 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:P(p.reduce((a,t)=>a+t.converted,0))})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-800 h-9 max-h-9",children:e.jsxs("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:[p.length>0?(p.reduce((a,t)=>a+t.converted,0)/p.reduce((a,t)=>a+t.totalLeads,0)*100).toFixed(1):"0.0","%"]})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-800 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:Y(p.length>0?p.reduce((a,t)=>a+t.avgLTV*t.totalLeads,0)/p.reduce((a,t)=>a+t.totalLeads,0):0)})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-800 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:p.length>0?(p.reduce((a,t)=>a+t.leadQuality*t.totalLeads,0)/p.reduce((a,t)=>a+t.totalLeads,0)).toFixed(1):"0.0"})})]})})]})})})]})}),e.jsx(Q,{value:"stage",className:"mt-6",children:e.jsxs(O,{className:"bg-white/95 backdrop-blur-sm border-0 shadow-xl relative",children:[e.jsx(K,{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(W,{className:"text-white flex items-center gap-2 text-lg font-bold",children:[e.jsx(ce,{className:"w-5 h-5"}),"Conversion by Stage"]}),e.jsx(q,{tableRef:F,tableName:"Conversion by Stage",size:"sm",className:"text-white hover:bg-white/20"})]})}),e.jsx(E,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto","data-table":"funnel-stage-analytics",children:e.jsxs("table",{ref:F,className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:[e.jsx("th",{className:"px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide h-9 max-h-9 sticky left-0 z-40 border-r border-white/20",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4 text-white"}),e.jsx("span",{children:"Stage"})]})}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Total Leads"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Converted"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Conv. Rate"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Avg LTV"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Efficiency"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:S.map((a,t)=>e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer h-9 max-h-9",onClick:()=>i("stage",a),children:[e.jsx("td",{className:"px-6 py-2 font-semibold text-gray-800 h-9 max-h-9 sticky left-0 z-30 bg-white border-r border-gray-200",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:a.stage})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:P(a.totalLeads)})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:P(a.converted)})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsxs("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:[a.conversionRate.toFixed(1),"%"]})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:Y(a.avgLTV)})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:a.stageEfficiency.toFixed(1)})})]},a.stage))}),e.jsx("tfoot",{className:"bg-gray-50 border-t-2 border-gray-300",children:e.jsxs("tr",{className:"font-bold h-9 max-h-9",children:[e.jsx("td",{className:"px-6 py-2 text-gray-800 h-9 max-h-9 sticky left-0 z-30 bg-gray-50 border-r border-gray-300",children:e.jsxs("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:"TOTALS"})]})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-800 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:P(S.reduce((a,t)=>a+t.totalLeads,0))})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-800 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:P(S.reduce((a,t)=>a+t.converted,0))})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-800 h-9 max-h-9",children:e.jsxs("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:[S.length>0?(S.reduce((a,t)=>a+t.converted,0)/S.reduce((a,t)=>a+t.totalLeads,0)*100).toFixed(1):"0.0","%"]})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-800 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:Y(S.length>0?S.reduce((a,t)=>a+t.avgLTV*t.totalLeads,0)/S.reduce((a,t)=>a+t.totalLeads,0):0)})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-800 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:S.length>0?(S.reduce((a,t)=>a+t.stageEfficiency*t.totalLeads,0)/S.reduce((a,t)=>a+t.totalLeads,0)).toFixed(1):"0.0"})})]})})]})})})]})}),e.jsx(Q,{value:"timespan",className:"mt-6",children:e.jsxs(O,{className:"bg-white/95 backdrop-blur-sm border-0 shadow-xl relative",children:[e.jsx(K,{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(W,{className:"text-white flex items-center gap-2 text-lg font-bold",children:[e.jsx(ee,{className:"w-5 h-5"}),"Conversion by Time Span"]}),e.jsx(q,{tableRef:k,tableName:"Conversion by Time Span",size:"sm",className:"text-white hover:bg-white/20"})]})}),e.jsx(E,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto","data-table":"funnel-timespan-analytics",children:e.jsxs("table",{ref:k,className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:[e.jsx("th",{className:"px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide h-9 max-h-9 sticky left-0 z-40 border-r border-white/20",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4 text-white"}),e.jsx("span",{children:"Time Range"})]})}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Total Leads"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Converted"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Conv. Rate"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Avg LTV"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Efficiency"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:u.map((a,t)=>e.jsxs("tr",{className:"hover:bg-gray-50 h-9 max-h-9",children:[e.jsx("td",{className:"px-6 py-2 font-semibold text-gray-800 h-9 max-h-9 sticky left-0 z-30 bg-white border-r border-gray-200",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:a.timeRange})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:P(a.totalLeads)})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:P(a.converted)})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsxs("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:[a.conversionRate.toFixed(1),"%"]})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:Y(a.avgLTV)})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:a.efficiency.toFixed(1)})})]},a.timeRange))})]})})})]})}),e.jsx(Q,{value:"ltv",className:"mt-6",children:e.jsxs(O,{className:"bg-white/95 backdrop-blur-sm border-0 shadow-xl relative",children:[e.jsx(K,{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(W,{className:"text-white flex items-center gap-2 text-lg font-bold",children:[e.jsx(te,{className:"w-5 h-5"}),"LTV Analysis"]}),e.jsx(q,{tableRef:n,tableName:"LTV Analysis",size:"sm",className:"text-white hover:bg-white/20"})]})}),e.jsx(E,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto","data-table":"funnel-ltv-analytics",children:e.jsxs("table",{ref:n,className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:[e.jsx("th",{className:"px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide h-9 max-h-9 sticky left-0 z-40 border-r border-white/20",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4 text-white"}),e.jsx("span",{children:"LTV Range"})]})}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Total Leads"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Converted"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Conv. Rate"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Total Revenue"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Avg Visits"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:w.map((a,t)=>e.jsxs("tr",{className:"hover:bg-gray-50 h-9 max-h-9",children:[e.jsx("td",{className:"px-6 py-2 font-semibold text-gray-800 h-9 max-h-9 sticky left-0 z-30 bg-white border-r border-gray-200",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:a.ltvRange})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:P(a.totalLeads)})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:P(a.converted)})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsxs("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:[a.conversionRate.toFixed(1),"%"]})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:Y(a.totalRevenue)})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:a.avgVisits.toFixed(1)})})]},a.ltvRange))})]})})})]})}),e.jsx(Q,{value:"topstages",className:"mt-6",children:e.jsxs(O,{className:"bg-white/95 backdrop-blur-sm border-0 shadow-xl relative",children:[e.jsx(K,{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(W,{className:"text-white flex items-center gap-2 text-lg font-bold",children:[e.jsx(X,{className:"w-5 h-5"}),"Top Performing Stages"]}),e.jsx(q,{tableRef:h,tableName:"Top Performing Stages",size:"sm",className:"text-white hover:bg-white/20"})]})}),e.jsx(E,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto","data-table":"funnel-topstages-analytics",children:e.jsxs("table",{ref:h,className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:[e.jsx("th",{className:"px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide h-9 max-h-9 sticky left-0 z-40 border-r border-white/20",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4 text-white"}),e.jsx("span",{children:"Stage"})]})}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Lead Count"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Percentage"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Converted"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Conv. Rate"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Avg LTV"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:d.map((a,t)=>e.jsxs("tr",{className:"hover:bg-gray-50 h-9 max-h-9",children:[e.jsx("td",{className:"px-6 py-2 font-semibold text-gray-800 h-9 max-h-9 sticky left-0 z-30 bg-white border-r border-gray-200",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:a.stage})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:P(a.leadCount)})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsxs("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:[a.percentage.toFixed(1),"%"]})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:P(a.converted)})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsxs("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:[a.conversionRate.toFixed(1),"%"]})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:Y(a.avgLTV)})})]},a.stage))})]})})})]})}),e.jsx(Q,{value:"proximity",className:"mt-6",children:e.jsxs(O,{className:"bg-white/95 backdrop-blur-sm border-0 shadow-xl relative",children:[e.jsx(K,{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(W,{className:"text-white flex items-center gap-2 text-lg font-bold",children:[e.jsx(se,{className:"w-5 h-5"}),"Proximity Issue Analysis"]}),e.jsx(q,{tableRef:M,tableName:"Proximity Issue Analysis",size:"sm",className:"text-white hover:bg-white/20"})]})}),e.jsx(E,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto","data-table":"funnel-proximity-analytics",children:e.jsxs("table",{ref:M,className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:[e.jsx("th",{className:"px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide h-9 max-h-9 sticky left-0 z-40 border-r border-white/20",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4 text-white"}),e.jsx("span",{children:"Location"})]})}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Total Leads"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Proximity Issues"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Proximity Rate"}),e.jsx("th",{className:"px-3 py-3 text-center text-white font-bold text-xs uppercase tracking-wider h-9 max-h-9 border-l border-white/20 min-w-[90px]",children:"Impact Score"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:c.map((a,t)=>e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer h-9 max-h-9",onClick:()=>i("proximity",a),children:[e.jsx("td",{className:"px-6 py-2 font-semibold text-gray-800 h-9 max-h-9 sticky left-0 z-30 bg-white border-r border-gray-200",children:e.jsxs("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis flex items-center space-x-2",children:[e.jsx(se,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:a.location})]})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:P(a.totalLeads)})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:P(a.proximityIssues)})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsxs("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:[a.proximityRate.toFixed(1),"%"]})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-700 h-9 max-h-9",children:e.jsx("div",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:a.impactScore.toFixed(1)})})]},a.location))})]})})})]})})]})})};function Ls(){const{data:r,loading:T,error:m}=Ye(),{setLoading:C}=Pe();Oe(),j.useEffect(()=>{C(T,"Loading funnel and lead conversion data...")},[T,C]);const[y,F]=j.useState("kwality"),[k,n]=j.useState(!0),[h,M]=j.useState(!0),[f,l]=j.useState({isOpen:!1,title:"",data:[],type:""}),v=()=>{const p=new Date,S=new Date(p.getFullYear(),p.getMonth()-1,1),u=new Date(p.getFullYear(),p.getMonth(),0),w=d=>{const c=d.getFullYear(),a=String(d.getMonth()+1).padStart(2,"0"),t=String(d.getDate()).padStart(2,"0");return`${c}-${a}-${t}`};return{start:w(S),end:w(u)}},[i,R]=j.useState(()=>({dateRange:v(),location:[],source:[],stage:[],status:[],associate:[],channel:[],trialStatus:[],conversionStatus:[],retentionStatus:[],minLTV:void 0,maxLTV:void 0}));j.useMemo(()=>[{id:"all",name:"All Locations",fullName:"All Locations"},{id:"kwality",name:"Kwality House",fullName:"Kwality House, Kemps Corner"},{id:"supreme",name:"Supreme HQ",fullName:"Supreme HQ, Bandra"},{id:"kenkere",name:"Kenkere House",fullName:"Kenkere House"},{id:"popup",name:"Pop-up",fullName:"Pop-up"}],[]);const N=j.useMemo(()=>!r||y==="all"?r||[]:r.filter(p=>{const S=p.center?.toLowerCase()||"";switch(y){case"kwality":return S.includes("kwality")||S.includes("kemps");case"supreme":return S.includes("supreme")||S.includes("bandra");case"kenkere":return S.includes("kenkere");case"popup":return S.includes("pop")||S.includes("popup")||S.includes("pop-up");default:return!0}}),[r,y]),g=j.useMemo(()=>N?N.filter(p=>{if(i.dateRange.start||i.dateRange.end){const S=new Date(p.createdAt);if(i.dateRange.start&&S<new Date(i.dateRange.start)||i.dateRange.end&&S>new Date(i.dateRange.end))return!1}return!(i.location.length>0&&!i.location.some(S=>p.center?.toLowerCase().includes(S.toLowerCase()))||i.source.length>0&&!i.source.includes(p.source)||i.stage.length>0&&!i.stage.includes(p.stage)||i.status.length>0&&!i.status.includes(p.status)||i.associate.length>0&&!i.associate.includes(p.associate)||i.channel.length>0&&!i.channel.includes(p.channel)||i.trialStatus.length>0&&!i.trialStatus.includes(p.trialStatus)||i.conversionStatus.length>0&&!i.conversionStatus.includes(p.conversionStatus)||i.retentionStatus.length>0&&!i.retentionStatus.includes(p.retentionStatus)||i.minLTV&&p.ltv<i.minLTV||i.maxLTV&&p.ltv>i.maxLTV)}):[],[N,i]),L=j.useMemo(()=>r?{locations:[...new Set(r.map(p=>p.center).filter(Boolean))],sources:[...new Set(r.map(p=>p.source).filter(Boolean))],stages:[...new Set(r.map(p=>p.stage).filter(Boolean))],statuses:[...new Set(r.map(p=>p.status).filter(Boolean))],associates:[...new Set(r.map(p=>p.associate).filter(Boolean))],channels:[...new Set(r.map(p=>p.channel).filter(Boolean))],trialStatuses:[...new Set(r.map(p=>p.trialStatus).filter(Boolean))],conversionStatuses:[...new Set(r.map(p=>p.conversionStatus).filter(Boolean))],retentionStatuses:[...new Set(r.map(p=>p.retentionStatus).filter(Boolean))]}:{locations:[],sources:[],stages:[],statuses:[],associates:[],channels:[],trialStatuses:[],conversionStatuses:[],retentionStatuses:[]},[r]);j.useMemo(()=>{const p={all:0,kwality:0,supreme:0,kenkere:0,popup:0};return(g||r||[]).forEach(u=>{p.all++;const w=u.center?.toLowerCase()||"";w.includes("kwality")||w.includes("kemps")?p.kwality++:w.includes("supreme")||w.includes("bandra")?p.supreme++:w.includes("kenkere")?p.kenkere++:(w.includes("pop")||w.includes("popup")||w.includes("pop-up"))&&p.popup++}),p},[g,r]);const z=p=>{R(p)},V=(p,S,u)=>{l({isOpen:!0,title:p,data:S,type:u})};return m?e.jsx("div",{className:"min-h-screen bg-gray-50/30 flex items-center justify-center p-4",children:e.jsx(O,{className:"p-8 bg-white shadow-lg max-w-md",children:e.jsxs(E,{className:"text-center space-y-4",children:[e.jsx(Ee,{className:"w-12 h-12 text-red-600 mx-auto"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold text-gray-800",children:"Connection Error"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:m?.toString()})]})]})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/30 to-purple-50/20",children:[e.jsx(Ie,{title:"Funnel & Leads Analytics",subtitle:"Analyze your marketing funnel, lead quality, source effectiveness, and conversion patterns to improve acquisition and retention.",metrics:[{label:"Total Leads",value:g.length.toLocaleString()},{label:"Converted",value:g.filter(p=>p.conversionStatus==="Converted").length.toString()},{label:"Conversion Rate",value:`${(g.length?g.filter(p=>p.conversionStatus==="Converted").length/g.length*100:0).toFixed(1)}%`}]}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8 space-y-8",children:[e.jsx(We,{activeLocation:y,onLocationChange:F,showInfoPopover:!0,infoPopoverContext:"funnel-leads-overview"}),e.jsxs("div",{className:"space-y-8",children:[e.jsx(O,{className:"bg-white/90 backdrop-blur-sm shadow-sm border border-gray-200 w-full",children:e.jsxs(E,{className:"p-6 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Advanced Filters"}),e.jsxs(_,{variant:"ghost",size:"sm",onClick:()=>n(!k),className:"gap-2",children:[k?e.jsx(Te,{className:"w-4 h-4"}):e.jsx(be,{className:"w-4 h-4"}),k?"Show Filters":"Hide Filters"]})]}),!k&&e.jsx("div",{className:"w-full",children:e.jsx(Nt,{filters:i,onFiltersChange:z,uniqueValues:L})})]})}),e.jsx(Lt,{data:g,onCardClick:V}),e.jsx(O,{className:"bg-white/90 backdrop-blur-sm shadow-sm border border-gray-200 w-full",children:e.jsxs(E,{className:"p-6 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Interactive Charts"}),e.jsxs(_,{variant:"ghost",size:"sm",onClick:()=>M(!h),className:"gap-2",children:[h?e.jsx(Te,{className:"w-4 h-4"}):e.jsx(be,{className:"w-4 h-4"}),h?"Show Charts":"Hide Charts"]})]}),!h&&e.jsx("div",{className:"w-full",children:e.jsx(St,{data:g})})]})}),e.jsx(Tt,{data:g}),e.jsx(O,{className:"bg-white/90 backdrop-blur-sm shadow-sm border border-gray-200 w-full",children:e.jsx(E,{className:"p-4 w-full",children:e.jsxs(me,{defaultValue:"analytics",className:"w-full",children:[e.jsxs(ue,{className:"grid w-full grid-cols-4 bg-gradient-to-r from-slate-800 to-slate-700 p-1.5 rounded-xl shadow-lg border border-slate-600",children:[e.jsx(B,{value:"analytics",className:"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-300 hover:text-white hover:bg-slate-600/50 data-[state=active]:bg-gradient-to-r data-[state=active]:from-slate-900 data-[state=active]:to-slate-800 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border data-[state=active]:border-slate-500",children:"Analytics"}),e.jsx(B,{value:"mom",className:"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-300 hover:text-white hover:bg-slate-600/50 data-[state=active]:bg-gradient-to-r data-[state=active]:from-slate-900 data-[state=active]:to-slate-800 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border data-[state=active]:border-slate-500",children:"Month-on-Month"}),e.jsx(B,{value:"yoy",className:"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-300 hover:text-white hover:bg-slate-600/50 data-[state=active]:bg-gradient-to-r data-[state=active]:from-slate-900 data-[state=active]:to-slate-800 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border data-[state=active]:border-slate-500",children:"Year-on-Year"}),e.jsx(B,{value:"health",className:"rounded-lg px-4 py-2.5 font-semibold transition-all duration-300 text-slate-300 hover:text-white hover:bg-slate-600/50 data-[state=active]:bg-gradient-to-r data-[state=active]:from-slate-900 data-[state=active]:to-slate-800 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border data-[state=active]:border-slate-500",children:"Health Metrics"})]}),e.jsx(Q,{value:"analytics",className:"mt-4",children:e.jsx(Mt,{data:g,onDrillDown:V})}),e.jsx(Q,{value:"mom",className:"mt-4",children:e.jsx(Ct,{data:N,onDrillDown:V})}),e.jsx(Q,{value:"yoy",className:"mt-4",children:e.jsx(kt,{allData:N,onDrillDown:V})}),e.jsx(Q,{value:"health",className:"mt-4",children:e.jsx(Vt,{data:g})})]})})})]})]}),e.jsx(bt,{children:f.isOpen&&e.jsx(wt,{isOpen:f.isOpen,onClose:()=>l(p=>({...p,isOpen:!1})),title:f.title,data:f.data,type:f.type})})]})}export{Ls as default};
//# sourceMappingURL=FunnelLeads-CvL9SsNJ.js.map
