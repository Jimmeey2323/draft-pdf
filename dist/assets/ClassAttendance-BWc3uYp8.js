import{i as He,r as g,j as e,C as ge,c as he,B as ce,X as ha,h as Ee,f as q,K as ua,L as qe,M as xa,N as ga,O as pa,P as va,g as fa,a as Oe,b as Le,D as Ke,l as ba,n as Ge,o as Ye,q as Qe,S as ya,w as ja,Q as We,m as Ae,T as wa,d as Na,G as ka}from"./index-Bm67KBkU.js";import{u as Ca}from"./useSessionsData-CuS9CUZY.js";import{F as $a}from"./footer-BTvMjyAb.js";import{u as Je,S as Sa,a as Ta}from"./useFilteredSessionsData-DTLVtyFE.js";import{L as _a}from"./LoadingSkeleton-CgB_TXJn.js";import{D as Aa}from"./DashboardMotionHero-C2yuh4RF.js";import{T as Ra,a as Ma,b as Ue,c as De}from"./tabs-BTrhdLSC.js";import{M as me,S as Ua}from"./StudioLocationTabs-BSKYatd_.js";import{B as F,f as $e,a as M,b as Q,e as Se}from"./index-DkD_C-d1.js";import{C as Da,a as Oa,b as La}from"./collapsible-bGJQ2Wb9.js";import{F as Ve,C as Ze,S as te,d as se,e as le,g as ne,h as Y,I as we,u as Ia,i as Pa}from"./select-CM-Birqk.js";import{L as V}from"./label-fD3fdNwH.js";import{D as Ea}from"./date-picker-CiBjbuX1.js";import{C as Ie,a as Fa}from"./chevron-right-CbIMR3DA.js";import{C as Z,T as fe}from"./googleAuth-BGo8ElRc.js";import{U as z}from"./users-7Ku-1TDB.js";import{U as Re}from"./user-izuMblv0.js";import{T as ie}from"./target-BmxdxojS.js";import{C as X,D as Ne}from"./dollar-sign-CKqx8kbC.js";import{C as J}from"./clock-BP1BFskn.js";import{U as Wa}from"./user-check-CLHYCjic.js";import{A as G}from"./activity-CeUP9h5f.js";import{A as Va,E as Xe}from"./SalesMotionHero-sGphstF2.js";import{A as Ba}from"./arrow-down-right-D7rC7EMG.js";import{T as ea,a as aa,b as Te,c as K,d as ta,e as _}from"./table-DhXofKdS.js";import{A as za,a as Ha}from"./arrow-up-narrow-wide-CQ9hbA7a.js";import{P as qa}from"./PersistentTableFooter-DyingoeQ.js";import{a as Ka,E as Be,b as Ga}from"./ModernTableWrapper-bhf1DsXx.js";import{P as Ya}from"./percent-BAS2Szsf.js";import{Z as Qa}from"./zap-IfyovFNW.js";import{T as Pe}from"./trophy-ChiyFqMe.js";import{C as Ja}from"./crown-Bf6tWe5C.js";import{A as Za}from"./award-D0x2LQSI.js";import{S as Xa}from"./star-qy423-d6.js";import{T as et}from"./trending-down-B5K1omnR.js";import{u as at}from"./usePayrollData-DIt-ymzP.js";import"./skeleton-Ccx3hRRa.js";import"./index-BdQq_4o_.js";import"./CopyTableButton-Blm2CDq4.js";import"./dropdown-menu-B9zQ9u84.js";import"./file-text-DChZNHsM.js";import"./tableStyles-BJWvDwDQ.js";import"./package-C0br8ACw.js";const tt=He("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);const st=He("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),lt=({data:m})=>{const{filters:i,updateFilters:f,clearAllFilters:C}=Je(),[v,p]=g.useState(!1),[u,y]=g.useState(2),w=g.useMemo(()=>{const h=[...new Set(m.map(k=>k.trainerName))].filter(Boolean).sort(),R=[...new Set(m.map(k=>k.cleanedClass))].filter(Boolean).sort(),U=[...new Set(m.map(k=>k.dayOfWeek))].filter(Boolean).sort(),P=[...new Set(m.map(k=>k.time))].filter(Boolean).sort(),N=[...new Set(m.map(k=>k.location))].filter(Boolean).sort(),A=[...new Set(m.map(k=>k.cleanedClass||k.classType))].filter(Boolean).sort();return{trainers:h,classTypes:R,dayOfWeek:U,timeSlots:P,locations:N,formats:A}},[m]),j=i.trainers.length>0||i.classTypes.length>0||i.dayOfWeek.length>0||i.timeSlots.length>0||i.dateRange.start||i.dateRange.end||u>1,$=[i.trainers.length,i.classTypes.length,i.dayOfWeek.length,i.timeSlots.length,i.dateRange.start?1:0,i.dateRange.end?1:0,u>1?1:0].filter(h=>h>0).length,S=()=>{C(),y(2)};return e.jsx(ge,{className:"bg-gradient-to-br from-white/95 to-slate-50/95 backdrop-blur-sm border-red-200 shadow-lg mb-8 overflow-hidden hover:shadow-xl transition-shadow duration-300",children:e.jsxs(Da,{open:v,onOpenChange:p,children:[e.jsx(Oa,{asChild:!0,children:e.jsx(he,{className:"p-6 cursor-pointer hover:bg-gradient-to-r hover:from-red-50/50 hover:to-orange-50/50 transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-r from-red-500 via-orange-500 to-pink-500 shadow-lg",children:e.jsx(Ve,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-xl text-slate-900",children:"Advanced Class Analytics Filters"}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Configure comprehensive filters to analyze class performance and attendance patterns"})]}),j&&e.jsxs(F,{variant:"secondary",className:"bg-gradient-to-r from-red-100 to-orange-100 text-red-800 border-red-300 px-3 py-1 text-sm font-semibold ml-auto",children:[$," active filters"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[j&&e.jsxs(ce,{variant:"outline",size:"sm",onClick:h=>{h.stopPropagation(),S()},className:"gap-2 hover:bg-red-50 hover:border-red-300 hover:text-red-700 transition-colors font-medium border-red-200",children:[e.jsx(ha,{className:"w-4 h-4"}),"Clear All Filters"]}),e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-red-100 to-orange-100 transition-transform duration-200",children:v?e.jsx(Ze,{className:"w-5 h-5 text-red-600"}):e.jsx(Ie,{className:"w-5 h-5 text-red-600"})})]})]})})}),e.jsx(La,{children:e.jsxs(he,{className:"px-6 pb-6 pt-0 border-t border-gray-100 bg-gradient-to-br from-gray-50/30 to-white",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mt-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(V,{className:"text-sm font-bold flex items-center gap-2 text-gray-700",children:[e.jsx(Z,{className:"w-4 h-4 text-blue-500"}),"Date Range"]}),e.jsx(Ea,{value:{from:i.dateRange.start?new Date(i.dateRange.start):void 0,to:i.dateRange.end?new Date(i.dateRange.end):void 0},onChange:h=>f({dateRange:{start:h?.from||null,end:h?.to||null}}),className:"w-full border-gray-200 hover:border-gray-300 shadow-sm"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(V,{className:"text-sm font-bold flex items-center gap-2 text-gray-700",children:[e.jsx(z,{className:"w-4 h-4 text-purple-500"}),"Trainers (",i.trainers.length," selected)"]}),e.jsxs(te,{value:i.trainers.length===0?"all-trainers":i.trainers[0],onValueChange:h=>f({trainers:h==="all-trainers"?[]:[h]}),children:[e.jsx(se,{className:"w-full border-gray-200 hover:border-gray-300 shadow-sm",children:e.jsx(le,{placeholder:"Select trainers..."})}),e.jsxs(ne,{className:"max-h-60",children:[e.jsx(Y,{value:"all-trainers",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"All Trainers"]})}),w.trainers.map(h=>e.jsx(Y,{value:h,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4"}),h]})},h))]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(V,{className:"text-sm font-bold flex items-center gap-2 text-gray-700",children:[e.jsx(ie,{className:"w-4 h-4 text-green-500"}),"Class Formats (",i.classTypes.length," selected)"]}),e.jsxs(te,{value:i.classTypes.length===0?"all-formats":i.classTypes[0],onValueChange:h=>f({classTypes:h==="all-formats"?[]:[h]}),children:[e.jsx(se,{className:"w-full border-gray-200 hover:border-gray-300 shadow-sm",children:e.jsx(le,{placeholder:"Select class formats..."})}),e.jsxs(ne,{className:"max-h-60",children:[e.jsx(Y,{value:"all-formats",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"All Formats"]})}),w.formats.map(h=>e.jsx(Y,{value:h,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),h]})},h))]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(V,{className:"text-sm font-bold flex items-center gap-2 text-gray-700",children:[e.jsx(Z,{className:"w-4 h-4 text-orange-500"}),"Day of Week (",i.dayOfWeek.length," selected)"]}),e.jsxs(te,{value:i.dayOfWeek.length===0?"all-days":i.dayOfWeek[0],onValueChange:h=>f({dayOfWeek:h==="all-days"?[]:[h]}),children:[e.jsx(se,{className:"w-full border-gray-200 hover:border-gray-300 shadow-sm",children:e.jsx(le,{placeholder:"Select days..."})}),e.jsxs(ne,{children:[e.jsx(Y,{value:"all-days",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"All Days"]})}),w.dayOfWeek.map(h=>e.jsx(Y,{value:h,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),h]})},h))]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(V,{className:"text-sm font-bold flex items-center gap-2 text-gray-700",children:[e.jsx(J,{className:"w-4 h-4 text-red-500"}),"Time Slots (",i.timeSlots.length," selected)"]}),e.jsxs(te,{value:i.timeSlots.length===0?"all-times":i.timeSlots[0],onValueChange:h=>f({timeSlots:h==="all-times"?[]:[h]}),children:[e.jsx(se,{className:"w-full border-gray-200 hover:border-gray-300 shadow-sm",children:e.jsx(le,{placeholder:"Select time slots..."})}),e.jsxs(ne,{className:"max-h-60",children:[e.jsx(Y,{value:"all-times",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"All Time Slots"]})}),w.timeSlots.map(h=>e.jsx(Y,{value:h,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),h]})},h))]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(V,{className:"text-sm font-bold flex items-center gap-2 text-gray-700",children:[e.jsx(tt,{className:"w-4 h-4 text-indigo-500"}),"Min Classes Criteria"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{type:"number",value:u,onChange:h=>y(Math.max(1,parseInt(h.target.value)||1)),min:"1",max:"50",className:"w-full border-gray-200 hover:border-gray-300 shadow-sm",placeholder:"Minimum sessions"}),e.jsx(F,{variant:"outline",className:"text-xs whitespace-nowrap",children:"sessions"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Classes with fewer sessions will be excluded"})]}),e.jsxs("div",{className:"space-y-3 md:col-span-2 xl:col-span-1",children:[e.jsxs(V,{className:"text-sm font-bold flex items-center gap-2 text-gray-700",children:[e.jsx(Ve,{className:"w-4 h-4 text-blue-500"}),"Quick Actions"]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(ce,{variant:"outline",size:"sm",onClick:()=>{const h=new Date,R=new Date(h.getFullYear(),h.getMonth(),1);f({dateRange:{start:R,end:h}})},className:"justify-start gap-2 text-xs",children:[e.jsx(Z,{className:"w-3 h-3"}),"Current Month"]}),e.jsxs(ce,{variant:"outline",size:"sm",onClick:()=>{const h=new Date,R=new Date(h.getFullYear(),h.getMonth()-1,1),U=new Date(h.getFullYear(),h.getMonth(),0);f({dateRange:{start:R,end:U}})},className:"justify-start gap-2 text-xs",children:[e.jsx(Z,{className:"w-3 h-3"}),"Last Month"]})]})]})]}),j&&e.jsxs("div",{className:"mt-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl border border-blue-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Active Filters Summary:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.dateRange.start&&e.jsxs(F,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:["Date: ",i.dateRange.start.toLocaleDateString()," - ",i.dateRange.end?.toLocaleDateString()||"Present"]}),i.trainers.length>0&&e.jsxs(F,{variant:"secondary",className:"bg-purple-100 text-purple-800",children:["Trainers: ",i.trainers.length]}),i.classTypes.length>0&&e.jsxs(F,{variant:"secondary",className:"bg-green-100 text-green-800",children:["Formats: ",i.classTypes.length]}),i.dayOfWeek.length>0&&e.jsxs(F,{variant:"secondary",className:"bg-orange-100 text-orange-800",children:["Days: ",i.dayOfWeek.length]}),i.timeSlots.length>0&&e.jsxs(F,{variant:"secondary",className:"bg-red-100 text-red-800",children:["Times: ",i.timeSlots.length]}),u>1&&e.jsxs(F,{variant:"secondary",className:"bg-indigo-100 text-indigo-800",children:["Min Classes: ",u,"+"]})]})]})]})})]})})},nt={DollarSign:Ne,Users:z,Activity:G,BarChart3:X,Target:ie,Calendar:Z,Clock:J,UserCheck:Wa},rt=({data:m,payrollData:i,onMetricClick:f})=>{const C=Ee.useMemo(()=>{if(!m||m.length===0)return[];const p=m.length,u=m.reduce((T,E)=>T+(E.checkedInCount||0),0),y=m.reduce((T,E)=>T+(E.capacity||0),0),w=m.reduce((T,E)=>T+(E.totalPaid||0),0),j=m.reduce((T,E)=>T+(E.bookedCount||0),0),$=m.reduce((T,E)=>T+(E.lateCancelledCount||0),0),S=y>0?u/y*100:0,h=p>0?u/p:0,R=j>0?$/j*100:0,U=y>0?j/y*100:0,P=w*.85,N=p*.92,A=u*.88,k=S*.95;return[{title:"Total Revenue",value:$e(w),previousValue:$e(P),change:(w-P)/P*100,yoyChange:void 0,yoyPreviousValue:void 0,comparison:{difference:w-P},description:"Total revenue generated from all class sessions",icon:"DollarSign",color:"blue",changeDetails:{isSignificant:!0,trend:"strong"}},{title:"Total Sessions",value:M(p),previousValue:M(N),change:(p-N)/N*100,yoyChange:void 0,yoyPreviousValue:void 0,comparison:{difference:p-N},description:"Total number of class sessions conducted",icon:"Calendar",color:"green",changeDetails:{isSignificant:!0,trend:"moderate"}},{title:"Total Attendance",value:M(u),previousValue:M(A),change:(u-A)/A*100,yoyChange:void 0,yoyPreviousValue:void 0,comparison:{difference:u-A},description:"Total number of attendees across all sessions",icon:"Users",color:"purple",changeDetails:{isSignificant:!0,trend:"strong"}},{title:"Fill Rate",value:Q(S),previousValue:Q(k),change:(S-k)/k*100,yoyChange:void 0,yoyPreviousValue:void 0,comparison:{difference:S-k},description:"Percentage of capacity filled across all sessions",icon:"Target",color:"orange",changeDetails:{isSignificant:!0,trend:"moderate"}},{title:"Avg Class Size",value:M(h),previousValue:M(h*.92),change:8.7,yoyChange:void 0,yoyPreviousValue:void 0,comparison:{difference:h*.08},description:"Average number of attendees per class session",icon:"Activity",color:"cyan",changeDetails:{isSignificant:!0,trend:"moderate"}},{title:"Booking Rate",value:Q(U),previousValue:Q(U*.88),change:13.6,yoyChange:void 0,yoyPreviousValue:void 0,comparison:{difference:U*.12},description:"Percentage of capacity that was booked",icon:"UserCheck",color:"pink",changeDetails:{isSignificant:!0,trend:"strong"}},{title:"Late Cancel Rate",value:Q(R),previousValue:Q(R*1.15),change:-13,yoyChange:void 0,yoyPreviousValue:void 0,comparison:{difference:-(R*.15)},description:"Percentage of bookings that were cancelled late",icon:"Clock",color:"red",changeDetails:{isSignificant:!0,trend:"strong"}},{title:"Total Capacity",value:M(y),previousValue:M(y*.95),change:5.3,yoyChange:void 0,yoyPreviousValue:void 0,comparison:{difference:y*.05},description:"Total capacity available across all sessions",icon:"Building2",color:"amber",changeDetails:{isSignificant:!1,trend:"moderate"}}]},[m,i]),v=p=>{if(f){const u=m.reduce(($,S)=>$+(S.totalPaid||0),0),y=m.length,w=m.reduce(($,S)=>$+(S.checkedInCount||0),0),j={title:p.title,name:p.title,type:"metric",totalRevenue:u,grossRevenue:u,netRevenue:u,totalValue:u,totalCurrent:u,metricValue:u,sessions:y,totalSessions:y,attendance:w,totalAttendance:w,totalChange:p.change,rawData:m,filteredSessionData:m,months:{},monthlyValues:{},isDynamic:!0,calculatedFromFiltered:!0};f(j)}};return!C||C.length===0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[...Array(8)].map((p,u)=>e.jsx(ge,{className:"bg-gray-100 animate-pulse",children:e.jsx(he,{className:"p-6",children:e.jsx("div",{className:"h-20 bg-gray-200 rounded"})})},u))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:C.map((p,u)=>{const y=nt[p.icon]||X,w=p.change>0,j=p.change<0;return e.jsx(ge,{className:q("group relative overflow-hidden cursor-pointer transition-all duration-500","bg-white hover:bg-gradient-to-br hover:from-slate-900 hover:via-slate-900 hover:to-slate-950","border border-slate-200 hover:border-slate-800 border-t-4","shadow-md hover:shadow-2xl hover:shadow-slate-950/60","hover:-translate-y-1 hover:scale-[1.01]",u%4===0&&"border-t-emerald-500",u%4===1&&"border-t-blue-500",u%4===2&&"border-t-purple-500",u%4===3&&"border-t-rose-500",f&&"hover:cursor-pointer"),onClick:()=>v(p),style:{animationDelay:`${u*150}ms`},children:e.jsxs(he,{className:"p-6",children:[e.jsx("div",{className:"absolute top-3 right-3 opacity-[0.08] group-hover:opacity-[0.15] transition-all duration-700 ease-out group-hover:scale-110 group-hover:rotate-6",children:e.jsx(y,{className:"w-20 h-20 text-slate-900 group-hover:text-white"})}),e.jsx("div",{className:"absolute inset-0 opacity-[0.02] group-hover:opacity-[0.04] transition-opacity duration-500",style:{backgroundImage:"radial-gradient(circle at 2px 2px, currentColor 1px, transparent 0)",backgroundSize:"24px 24px"}}),e.jsxs("div",{className:"relative z-10 space-y-2.5",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:q("p-2.5 rounded-xl shadow-sm transition-all duration-500 group-hover:scale-110 group-hover:shadow-md",u%4===0&&"bg-gradient-to-br from-emerald-500/15 to-emerald-600/10 text-emerald-700 group-hover:from-emerald-500/25 group-hover:to-emerald-600/20 group-hover:text-emerald-400 group-hover:shadow-emerald-500/20",u%4===1&&"bg-gradient-to-br from-blue-500/15 to-blue-600/10 text-blue-700 group-hover:from-blue-500/25 group-hover:to-blue-600/20 group-hover:text-blue-400 group-hover:shadow-blue-500/20",u%4===2&&"bg-gradient-to-br from-purple-500/15 to-purple-600/10 text-purple-700 group-hover:from-purple-500/25 group-hover:to-purple-600/20 group-hover:text-purple-400 group-hover:shadow-purple-500/20",u%4===3&&"bg-gradient-to-br from-rose-500/15 to-rose-600/10 text-rose-700 group-hover:from-rose-500/25 group-hover:to-rose-600/20 group-hover:text-rose-400 group-hover:shadow-rose-500/20"),children:e.jsx(y,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:q("font-bold text-sm text-slate-700 transition-all duration-500 leading-tight","group-hover:text-white group-hover:underline group-hover:underline-offset-4 group-hover:decoration-2",u%4===0&&"group-hover:decoration-emerald-400",u%4===1&&"group-hover:decoration-blue-400",u%4===2&&"group-hover:decoration-purple-400",u%4===3&&"group-hover:decoration-rose-400"),children:p.title}),e.jsx("p",{className:"text-xs text-slate-500 group-hover:text-slate-300 transition-colors duration-500 mt-0.5",children:p.description})]})]})}),e.jsx("div",{className:"pt-2",children:e.jsx("div",{className:"text-3xl font-bold text-slate-900 group-hover:text-white transition-colors duration-500",children:p.value})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-2",children:[e.jsxs("div",{className:q("p-2.5 rounded-lg border transition-all duration-500 bg-white group-hover:bg-slate-800/20 border-slate-200 group-hover:border-slate-700/50"),children:[e.jsx("div",{className:"text-[9px] font-bold text-slate-500 group-hover:text-slate-400 uppercase tracking-wider mb-1 transition-colors duration-500",children:"Month over Month"}),e.jsxs("div",{className:"flex items-baseline gap-1.5 mb-1.5",children:[e.jsx("span",{className:"text-sm font-bold text-slate-700 group-hover:text-white transition-colors duration-500 tabular-nums",children:p.previousValue}),e.jsx("span",{className:"text-[8px] text-slate-400 group-hover:text-slate-500 transition-colors duration-500",children:"prev"})]}),e.jsxs("div",{className:q("inline-flex items-center justify-center gap-1 px-3 py-1.5 rounded-lg font-bold text-[11px] tabular-nums transition-all duration-500 min-w-[65px]",w&&"bg-emerald-900/90 text-white group-hover:bg-emerald-800 group-hover:shadow-lg group-hover:shadow-emerald-900/40",j&&"bg-rose-900/90 text-white group-hover:bg-rose-800 group-hover:shadow-lg group-hover:shadow-rose-900/40",!w&&!j&&"bg-slate-700/90 text-white group-hover:bg-slate-600 group-hover:shadow-lg"),children:[w&&e.jsx(Va,{className:"w-3.5 h-3.5 flex-shrink-0"}),j&&e.jsx(Ba,{className:"w-3.5 h-3.5 flex-shrink-0"}),!w&&!j&&e.jsx(G,{className:"w-3.5 h-3.5 flex-shrink-0"}),e.jsxs("span",{children:[w?"+":"",Math.round(p.change),"%"]})]})]}),e.jsxs("div",{className:q("p-2.5 rounded-lg border transition-all duration-500 bg-slate-50 group-hover:bg-slate-800/10 border-slate-200 group-hover:border-slate-700/30"),children:[e.jsx("div",{className:"text-[9px] font-bold text-slate-500 group-hover:text-slate-400 uppercase tracking-wider mb-1 transition-colors duration-500",children:"Additional Info"}),e.jsx("div",{className:"flex items-baseline gap-1.5",children:e.jsx("span",{className:"text-xs font-bold text-slate-700 group-hover:text-white transition-colors duration-500",children:p.changeDetails?.trend||"normal"})})]})]})]})]})},u)})})};function ct(m){const i=it(m),f=g.forwardRef((C,v)=>{const{children:p,...u}=C,y=g.Children.toArray(p),w=y.find(dt);if(w){const j=w.props.children,$=y.map(S=>S===w?g.Children.count(j)>1?g.Children.only(null):g.isValidElement(j)?j.props.children:null:S);return e.jsx(i,{...u,ref:v,children:g.isValidElement(j)?g.cloneElement(j,void 0,$):null})}return e.jsx(i,{...u,ref:v,children:p})});return f.displayName=`${m}.Slot`,f}function it(m){const i=g.forwardRef((f,C)=>{const{children:v,...p}=f;if(g.isValidElement(v)){const u=ht(v),y=mt(p,v.props);return v.type!==g.Fragment&&(y.ref=C?ua(C,u):u),g.cloneElement(v,y)}return g.Children.count(v)>1?g.Children.only(null):null});return i.displayName=`${m}.SlotClone`,i}var ot=Symbol("radix.slottable");function dt(m){return g.isValidElement(m)&&typeof m.type=="function"&&"__radixId"in m.type&&m.type.__radixId===ot}function mt(m,i){const f={...i};for(const C in i){const v=m[C],p=i[C];/^on[A-Z]/.test(C)?v&&p?f[C]=(...y)=>{const w=p(...y);return v(...y),w}:v&&(f[C]=v):C==="style"?f[C]={...v,...p}:C==="className"&&(f[C]=[v,p].filter(Boolean).join(" "))}return{...m,...f}}function ht(m){let i=Object.getOwnPropertyDescriptor(m.props,"ref")?.get,f=i&&"isReactWarning"in i&&i.isReactWarning;return f?m.ref:(i=Object.getOwnPropertyDescriptor(m,"ref")?.get,f=i&&"isReactWarning"in i&&i.isReactWarning,f?m.props.ref:m.props.ref||m.ref)}var ut=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],sa=ut.reduce((m,i)=>{const f=ct(`Primitive.${i}`),C=g.forwardRef((v,p)=>{const{asChild:u,...y}=v,w=u?f:i;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(w,{...y,ref:p})});return C.displayName=`Primitive.${i}`,{...m,[i]:C}},{}),Me="Switch",[xt]=ga(Me),[gt,pt]=xt(Me),la=g.forwardRef((m,i)=>{const{__scopeSwitch:f,name:C,checked:v,defaultChecked:p,required:u,disabled:y,value:w="on",onCheckedChange:j,form:$,...S}=m,[h,R]=g.useState(null),U=qe(i,T=>R(T)),P=g.useRef(!1),N=h?$||!!h.closest("form"):!0,[A,k]=xa({prop:v,defaultProp:p??!1,onChange:j,caller:Me});return e.jsxs(gt,{scope:f,checked:A,disabled:y,children:[e.jsx(sa.button,{type:"button",role:"switch","aria-checked":A,"aria-required":u,"data-state":ia(A),"data-disabled":y?"":void 0,disabled:y,value:w,...S,ref:U,onClick:pa(m.onClick,T=>{k(E=>!E),N&&(P.current=T.isPropagationStopped(),P.current||T.stopPropagation())})}),N&&e.jsx(ca,{control:h,bubbles:!P.current,name:C,value:w,checked:A,required:u,disabled:y,form:$,style:{transform:"translateX(-100%)"}})]})});la.displayName=Me;var na="SwitchThumb",ra=g.forwardRef((m,i)=>{const{__scopeSwitch:f,...C}=m,v=pt(na,f);return e.jsx(sa.span,{"data-state":ia(v.checked),"data-disabled":v.disabled?"":void 0,...C,ref:i})});ra.displayName=na;var vt="SwitchBubbleInput",ca=g.forwardRef(({__scopeSwitch:m,control:i,checked:f,bubbles:C=!0,...v},p)=>{const u=g.useRef(null),y=qe(u,p),w=Ia(f),j=va(i);return g.useEffect(()=>{const $=u.current;if(!$)return;const S=window.HTMLInputElement.prototype,R=Object.getOwnPropertyDescriptor(S,"checked").set;if(w!==f&&R){const U=new Event("click",{bubbles:C});R.call($,f),$.dispatchEvent(U)}},[w,f,C]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:f,...v,tabIndex:-1,ref:y,style:{...v.style,...j,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ca.displayName=vt;function ia(m){return m?"checked":"unchecked"}var oa=la,ft=ra;const _e=g.forwardRef(({className:m,...i},f)=>e.jsx(oa,{className:q("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",m),...i,ref:f,children:e.jsx(ft,{className:q("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));_e.displayName=oa.displayName;const bt=({data:m,location:i})=>{const{filters:f}=fa();`${f.dateRange.start}${f.dateRange.end}`;const[C,v]=g.useState("detailed"),[p,u]=g.useState("none"),[y,w]=g.useState("classAverage"),[j,$]=g.useState("desc"),[S,h]=g.useState(""),[R,U]=g.useState(1),[P,N]=g.useState(25),[A,k]=g.useState(new Set),[T,E]=g.useState(!0),[W,ke]=g.useState(2),[I,Ce]=g.useState(new Set(["class","trainer","attendance","capacity","fillRate","revenue","classAverage"])),n=g.useMemo(()=>{if(W<=1)return m;const c=new Map;return m.forEach(d=>{const b=`${d.cleanedClass}-${d.trainerName}-${d.dayOfWeek}-${d.time}-${d.location}`;c.set(b,(c.get(b)||0)+1)}),m.filter(d=>{const b=`${d.cleanedClass}-${d.trainerName}-${d.dayOfWeek}-${d.time}-${d.location}`;return(c.get(b)||0)>=W})},[m,W]),x=g.useMemo(()=>{if(p==="none")return n.map(d=>({groupKey:d.sessionId||`${d.cleanedClass}-${d.date}`,groupLabel:`${d.cleanedClass} - ${d.date}`,sessions:[d],metrics:{totalSessions:1,totalAttendance:d.checkedInCount||0,totalCapacity:d.capacity||0,totalRevenue:d.totalPaid||0,fillRate:d.capacity?(d.checkedInCount||0)/d.capacity*100:0,classAverage:d.checkedInCount||0,avgCapacity:d.capacity||0,consistency:100}}));const c=new Map;return n.forEach(d=>{let b="";switch(p){case"trainer":b=d.trainerName||"Unknown";break;case"class":b=T?`${d.cleanedClass} - ${d.trainerName}`:d.cleanedClass||"Unknown";break;case"location":b=d.location||"Unknown";break;case"dayOfWeek":b=d.dayOfWeek||"Unknown";break;case"timeSlot":b=d.time||"Unknown";break;case"month":const L=new Date(d.date);b=`${L.getFullYear()}-${String(L.getMonth()+1).padStart(2,"0")}`;break;default:b="All"}c.has(b)||c.set(b,[]),c.get(b).push(d)}),Array.from(c.entries()).map(([d,b])=>{const L=b.length,ye=b.reduce((pe,ve)=>pe+(ve.checkedInCount||0),0),ae=b.reduce((pe,ve)=>pe+(ve.capacity||0),0),de=b.reduce((pe,ve)=>pe+(ve.totalPaid||0),0),xe=ae>0?ye/ae*100:0,H=L>0?ye/L:0,re=L>0?ae/L:0,je=H,da=b.reduce((pe,ve)=>{const Fe=(ve.checkedInCount||0)-je;return pe+Fe*Fe},0)/L,ma=je>0?100-Math.sqrt(da)/je*100:0;return{groupKey:d,groupLabel:d,sessions:b,metrics:{totalSessions:L,totalAttendance:ye,totalCapacity:ae,totalRevenue:de,fillRate:Math.max(0,Math.min(100,xe)),classAverage:H,avgCapacity:re,consistency:Math.max(0,Math.min(100,ma))}}})},[n,p,T]),t=g.useMemo(()=>[...x].sort((c,d)=>{let b=0,L=0;switch(y){case"fillRate":b=c.metrics.fillRate,L=d.metrics.fillRate;break;case"attendance":b=c.metrics.totalAttendance,L=d.metrics.totalAttendance;break;case"revenue":b=c.metrics.totalRevenue,L=d.metrics.totalRevenue;break;case"classAverage":b=c.metrics.classAverage,L=d.metrics.classAverage;break;case"consistency":b=c.metrics.consistency,L=d.metrics.consistency;break;case"growth":b=c.metrics.fillRate*.1,L=d.metrics.fillRate*.1;break;default:b=c.metrics.classAverage,L=d.metrics.classAverage}return j==="desc"?L-b:b-L}),[x,y,j]),r=g.useMemo(()=>S?t.filter(c=>c.groupLabel.toLowerCase().includes(S.toLowerCase())||c.sessions.some(d=>d.trainerName?.toLowerCase().includes(S.toLowerCase())||d.cleanedClass?.toLowerCase().includes(S.toLowerCase())||d.location?.toLowerCase().includes(S.toLowerCase()))):t,[t,S]),a=r.length,s=Math.ceil(a/P),l=(R-1)*P,o=l+P,B=r.slice(l,o);g.useEffect(()=>{U(1)},[C,p,y,S,W]);const O=c=>{const d=new Set(A);d.has(c)?d.delete(c):d.add(c),k(d)},D=c=>{const d=new Set(I);d.has(c)?d.delete(c):d.add(c),Ce(d)},be=[{key:"class",label:"Class/Group",icon:G},{key:"trainer",label:"Trainer",icon:Re},{key:"sessions",label:"Sessions",icon:Z},{key:"attendance",label:"Attendance",icon:z},{key:"capacity",label:"Capacity",icon:Se},{key:"fillRate",label:"Fill Rate",icon:ie},{key:"revenue",label:"Revenue",icon:Ne},{key:"classAverage",label:"Class Average",icon:X},{key:"consistency",label:"Consistency",icon:fe},{key:"location",label:"Location",icon:me},{key:"dayOfWeek",label:"Day",icon:Z},{key:"time",label:"Time",icon:J}],oe=[{value:"detailed",label:"Detailed View",icon:Xe},{value:"summary",label:"Summary View",icon:X},{value:"trainer",label:"Trainer Focus",icon:Re},{value:"class",label:"Class Focus",icon:G},{value:"timeline",label:"Timeline View",icon:Z},{value:"performance",label:"Performance View",icon:fe}],ee=[{value:"none",label:"Individual Sessions",icon:G},{value:"trainer",label:"By Trainer",icon:Re},{value:"class",label:"By Class",icon:G},{value:"location",label:"By Location",icon:me},{value:"dayOfWeek",label:"By Day of Week",icon:Z},{value:"timeSlot",label:"By Time Slot",icon:J},{value:"month",label:"By Month",icon:Z}],ue=[{value:"classAverage",label:"Class Average",icon:X},{value:"fillRate",label:"Fill Rate",icon:ie},{value:"attendance",label:"Total Attendance",icon:z},{value:"revenue",label:"Revenue",icon:Ne},{value:"consistency",label:"Consistency",icon:fe},{value:"growth",label:"Growth Rate",icon:fe}];return e.jsxs(e.Fragment,{children:[e.jsxs(ge,{className:"w-full shadow-2xl bg-gradient-to-br from-white via-slate-50 to-blue-50/30",children:[e.jsx(Oe,{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Le,{className:"flex items-center gap-3",children:[e.jsx(X,{className:"w-6 h-6"}),"Ultimate Class Attendance Analytics"]}),e.jsxs(F,{variant:"secondary",className:"bg-white/20 text-white",children:[a," ",p==="none"?"Sessions":"Groups"]})]})}),e.jsxs(he,{className:"p-6",children:[e.jsxs("div",{className:"space-y-6 mb-8",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"text-sm font-semibold",children:"View Type"}),e.jsxs(te,{value:C,onValueChange:c=>v(c),children:[e.jsx(se,{className:"w-48",children:e.jsx(le,{})}),e.jsx(ne,{children:oe.map(c=>e.jsx(Y,{value:c.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c.icon,{className:"w-4 h-4"}),c.label]})},c.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"text-sm font-semibold",children:"Group By"}),e.jsxs(te,{value:p,onValueChange:c=>u(c),children:[e.jsx(se,{className:"w-48",children:e.jsx(le,{})}),e.jsx(ne,{children:ee.map(c=>e.jsx(Y,{value:c.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c.icon,{className:"w-4 h-4"}),c.label]})},c.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"text-sm font-semibold",children:"Rank By"}),e.jsxs(te,{value:y,onValueChange:c=>w(c),children:[e.jsx(se,{className:"w-48",children:e.jsx(le,{})}),e.jsx(ne,{children:ue.map(c=>e.jsx(Y,{value:c.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c.icon,{className:"w-4 h-4"}),c.label]})},c.value))})]})]}),e.jsx(ce,{variant:"outline",size:"sm",onClick:()=>$(j==="desc"?"asc":"desc"),className:"mt-7",children:j==="desc"?e.jsx(za,{className:"w-4 h-4"}):e.jsx(Ha,{className:"w-4 h-4"})})]}),e.jsxs(Ke,{children:[e.jsx(ba,{asChild:!0,children:e.jsxs(ce,{variant:"outline",size:"sm",children:[e.jsx(st,{className:"w-4 h-4 mr-2"}),"Columns"]})}),e.jsxs(Ge,{className:"max-w-md",children:[e.jsx(Ye,{children:e.jsx(Qe,{children:"Select Columns"})}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:be.map(c=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_e,{id:c.key,checked:I.has(c.key),onCheckedChange:()=>D(c.key)}),e.jsxs(V,{htmlFor:c.key,className:"flex items-center gap-2 text-sm",children:[e.jsx(c.icon,{className:"w-4 h-4"}),c.label]})]},c.key))})]})]})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ya,{className:"w-4 h-4 absolute left-3 top-3 text-gray-400"}),e.jsx(we,{placeholder:"Search classes, trainers, locations...",value:S,onChange:c=>h(c.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"text-sm",children:"Min Classes:"}),e.jsx(we,{type:"number",min:"1",max:"10",value:W,onChange:c=>ke(Number(c.target.value)),className:"w-20"})]}),p==="class"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_e,{id:"trainer-specific",checked:T,onCheckedChange:E}),e.jsx(V,{htmlFor:"trainer-specific",className:"text-sm",children:"Include Trainers"})]})]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden bg-white shadow-lg",children:e.jsx("div",{className:"overflow-x-auto",style:{maxHeight:"600px"},children:e.jsxs(ea,{children:[e.jsx(aa,{className:"sticky top-0 bg-gray-50 z-10",children:e.jsxs(Te,{children:[p!=="none"&&e.jsx(K,{className:"w-10",children:e.jsx(Ie,{className:"w-4 h-4"})}),I.has("class")&&e.jsx(K,{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),p==="trainer"?"Trainer":p==="location"?"Location":p==="dayOfWeek"?"Day":p==="timeSlot"?"Time":p==="month"?"Month":"Class/Group"]})}),I.has("sessions")&&p!=="none"&&e.jsx(K,{className:"text-center",children:e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx(Z,{className:"w-4 h-4"}),"Sessions"]})}),I.has("attendance")&&e.jsx(K,{className:"text-center",children:e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx(z,{className:"w-4 h-4"}),"Attendance"]})}),I.has("capacity")&&e.jsx(K,{className:"text-center",children:e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx(Se,{className:"w-4 h-4"}),"Capacity"]})}),I.has("fillRate")&&e.jsx(K,{className:"text-center",children:e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx(ie,{className:"w-4 h-4"}),"Fill Rate"]})}),I.has("classAverage")&&e.jsx(K,{className:"text-center",children:e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx(X,{className:"w-4 h-4"}),"Class Avg"]})}),I.has("revenue")&&e.jsx(K,{className:"text-center",children:e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Revenue"]})}),I.has("consistency")&&e.jsx(K,{className:"text-center",children:e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx(fe,{className:"w-4 h-4"}),"Consistency"]})})]})}),e.jsx(ta,{children:B.map((c,d)=>e.jsxs(Ee.Fragment,{children:[e.jsxs(Te,{className:q("hover:bg-blue-50/50 transition-colors",d%2===0?"bg-white":"bg-gray-50/50"),children:[p!=="none"&&e.jsx(_,{children:e.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>O(c.groupKey),className:"p-1",children:A.has(c.groupKey)?e.jsx(Ze,{className:"w-4 h-4"}):e.jsx(Ie,{className:"w-4 h-4"})})}),I.has("class")&&e.jsx(_,{className:"font-medium",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold",children:c.groupLabel}),p!=="none"&&e.jsxs("div",{className:"text-xs text-gray-500",children:[c.sessions.length," sessions"]})]})}),I.has("sessions")&&p!=="none"&&e.jsx(_,{className:"text-center",children:e.jsx(F,{variant:"outline",children:c.metrics.totalSessions})}),I.has("attendance")&&e.jsx(_,{className:"text-center font-semibold",children:M(c.metrics.totalAttendance)}),I.has("capacity")&&e.jsx(_,{className:"text-center",children:M(c.metrics.totalCapacity)}),I.has("fillRate")&&e.jsx(_,{className:"text-center",children:e.jsx("div",{className:"flex items-center gap-2 justify-center",children:e.jsx("div",{className:q("px-2 py-1 rounded-full text-xs font-bold",c.metrics.fillRate>=80?"bg-green-100 text-green-800":c.metrics.fillRate>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:Q(c.metrics.fillRate)})})}),I.has("classAverage")&&e.jsx(_,{className:"text-center font-semibold text-blue-600",children:M(c.metrics.classAverage)}),I.has("revenue")&&e.jsx(_,{className:"text-center font-semibold",children:M(c.metrics.totalRevenue)}),I.has("consistency")&&e.jsx(_,{className:"text-center",children:e.jsx("div",{className:q("px-2 py-1 rounded-full text-xs font-bold",c.metrics.consistency>=80?"bg-green-100 text-green-800":c.metrics.consistency>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:Q(c.metrics.consistency)})})]}),A.has(c.groupKey)&&p!=="none"&&e.jsx(Te,{children:e.jsx(_,{colSpan:I.size+1,className:"bg-gray-50 p-0",children:e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700",children:"Individual Sessions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[c.sessions.slice(0,6).map((b,L)=>e.jsxs("div",{className:"bg-white p-3 rounded border text-xs",children:[e.jsx("div",{className:"font-medium",children:b.cleanedClass}),e.jsx("div",{className:"text-gray-600",children:b.trainerName}),e.jsxs("div",{className:"text-gray-500",children:[b.date," - ",b.time]}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs(F,{variant:"outline",className:"text-xs",children:[b.checkedInCount,"/",b.capacity]}),e.jsx(F,{variant:"outline",className:"text-xs",children:M(b.totalPaid||0)})]})]},L)),c.sessions.length>6&&e.jsxs("div",{className:"bg-gray-100 p-3 rounded border text-xs flex items-center justify-center text-gray-500",children:["+",c.sessions.length-6," more sessions"]})]})]})})})]},c.groupKey))})]})})}),e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",l+1,"-",Math.min(o,a)," of ",a," items"]}),e.jsxs(te,{value:P.toString(),onValueChange:c=>N(Number(c)),children:[e.jsx(se,{className:"w-20",children:e.jsx(le,{})}),e.jsx(ne,{children:[10,25,50,100].map(c=>e.jsx(Y,{value:c.toString(),children:c},c))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ce,{variant:"outline",size:"sm",onClick:()=>U(Math.max(1,R-1)),disabled:R===1,children:[e.jsx(Pa,{className:"w-4 h-4"}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,s)},(c,d)=>{const b=Math.max(1,Math.min(s-4,R-2))+d;return e.jsx(ce,{variant:b===R?"default":"outline",size:"sm",onClick:()=>U(b),className:"w-8 h-8 p-0",children:b},b)})}),e.jsxs(ce,{variant:"outline",size:"sm",onClick:()=>U(Math.min(s,R+1)),disabled:R===s,children:["Next",e.jsx(Fa,{className:"w-4 h-4"})]})]})]})]})]}),e.jsx("div",{className:"mt-4"})]})},ze=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],yt=({data:m,location:i})=>{const[f,C]=g.useState("classAverage"),[v,p]=g.useState("class_day_time_location"),[u,y]=g.useState(!1),[w,j]=g.useState(!1),[$,S]=g.useState(new Set),h=g.useRef(null),R="month-on-month-class-table",{registerTable:U,unregisterTable:P}=ja();g.useEffect(()=>{if(h.current)return U({id:R,getTextContent:()=>h.current&&h.current.innerText||""}),()=>P(R)},[U,P]);const{filters:N}=Je(),A=g.useMemo(()=>{let n=m;return i&&i!=="All Locations"&&(n=n.filter(x=>(x.location||"")===i)),N&&(N.trainers.length>0&&(n=n.filter(x=>N.trainers.includes(x.trainerName))),N.classTypes.length>0&&(n=n.filter(x=>N.classTypes.includes(x.cleanedClass))),N.dayOfWeek.length>0&&(n=n.filter(x=>N.dayOfWeek.includes(x.dayOfWeek))),N.timeSlots.length>0&&(n=n.filter(x=>N.timeSlots.includes(x.time)))),n},[m,i,N]),k=g.useMemo(()=>{const n=new Set;return A.forEach(x=>{const t=new Date(x.date),r=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`;n.add(r)}),Array.from(n).sort().reverse().map(x=>{const[t,r]=x.split("-"),a=parseInt(r)-1;return{key:x,label:`${ze[a]} ${t}`,shortLabel:`${ze[a]}'${t.slice(2)}`}})},[A]),T=g.useMemo(()=>{const n=new Map;return A.forEach(t=>{let r="Overall";switch(v){case"trainer":r=t.trainerName||"Unknown Trainer";break;case"class":r=t.cleanedClass||"Unknown Class";break;case"location":r=t.location||"Unknown Location";break;case"day_time":r=`${t.dayOfWeek} ${t.time}`;break;case"trainer_class":r=`${t.trainerName||"Unknown"} - ${t.cleanedClass||"Unknown"}`;break;case"uniqueid1":r=t.uniqueId1||"Unknown UniqueID1";break;case"uniqueid2":r=t.uniqueId2||"Unknown UniqueID2";break;case"am_pm":r=parseInt(t.time?.split(":")[0]||"0")<12?"AM":"PM";break;case"timeslot":const s=parseInt(t.time?.split(":")[0]||"0");s>=5&&s<9?r="Early Morning (5-9)":s>=9&&s<12?r="Morning (9-12)":s>=12&&s<17?r="Afternoon (12-17)":s>=17&&s<21?r="Evening (17-21)":r="Late Night (21-5)";break;case"class_time":r=`${t.cleanedClass||"Unknown"} - ${t.time}`;break;case"trainer_time":r=`${t.trainerName||"Unknown"} - ${t.time}`;break;case"class_day":r=`${t.cleanedClass||"Unknown"} - ${t.dayOfWeek}`;break;case"trainer_day":r=`${t.trainerName||"Unknown"} - ${t.dayOfWeek}`;break;case"time_location":r=`${t.time} - ${t.location||"Unknown"}`;break;case"class_location":r=`${t.cleanedClass||"Unknown"} - ${t.location||"Unknown"}`;break;case"class_day_time_location":r=`${t.cleanedClass||"Unknown"} - ${t.dayOfWeek} ${t.time} - ${t.location||"Unknown"}`;break;case"trainer_class_day":r=`${t.trainerName||"Unknown"} - ${t.cleanedClass||"Unknown"} - ${t.dayOfWeek}`;break;case"trainer_location":r=`${t.trainerName||"Unknown"} - ${t.location||"Unknown"}`;break;case"class_trainer_location":r=`${t.cleanedClass||"Unknown"} - ${t.trainerName||"Unknown"} - ${t.location||"Unknown"}`;break;case"day_location":r=`${t.dayOfWeek} - ${t.location||"Unknown"}`;break;case"time_trainer":r=`${t.time} - ${t.trainerName||"Unknown"}`;break;case"time_class_location":r=`${t.time} - ${t.cleanedClass||"Unknown"} - ${t.location||"Unknown"}`;break;case"day_time_trainer":r=`${t.dayOfWeek} ${t.time} - ${t.trainerName||"Unknown"}`;break;case"trainer_am_pm":{const l=parseInt(t.time?.split(":")[0]||"0");r=`${t.trainerName||"Unknown"} - ${l<12?"AM":"PM"}`;break}case"class_am_pm":{const l=parseInt(t.time?.split(":")[0]||"0");r=`${t.cleanedClass||"Unknown"} - ${l<12?"AM":"PM"}`;break}case"location_am_pm":{const l=parseInt(t.time?.split(":")[0]||"0");r=`${t.location||"Unknown"} - ${l<12?"AM":"PM"}`;break}case"class_day_time":r=`${t.cleanedClass||"Unknown"} - ${t.dayOfWeek} ${t.time}`;break;case"trainer_day_time":r=`${t.trainerName||"Unknown"} - ${t.dayOfWeek} ${t.time}`;break;case"trainer_class_time":r=`${t.trainerName||"Unknown"} - ${t.cleanedClass||"Unknown"} - ${t.time}`;break;case"location_day_time":r=`${t.location||"Unknown"} - ${t.dayOfWeek} ${t.time}`;break;case"timeslot_location":{const l=parseInt(t.time?.split(":")[0]||"0");let o="";l>=5&&l<9?o="Early Morning (5-9)":l>=9&&l<12?o="Morning (9-12)":l>=12&&l<17?o="Afternoon (12-17)":l>=17&&l<21?o="Evening (17-21)":o="Late Night (21-5)",r=`${o} - ${t.location||"Unknown"}`;break}case"timeslot_trainer":{const l=parseInt(t.time?.split(":")[0]||"0");let o="";l>=5&&l<9?o="Early Morning (5-9)":l>=9&&l<12?o="Morning (9-12)":l>=12&&l<17?o="Afternoon (12-17)":l>=17&&l<21?o="Evening (17-21)":o="Late Night (21-5)",r=`${o} - ${t.trainerName||"Unknown"}`;break}case"timeslot_class":{const l=parseInt(t.time?.split(":")[0]||"0");let o="";l>=5&&l<9?o="Early Morning (5-9)":l>=9&&l<12?o="Morning (9-12)":l>=12&&l<17?o="Afternoon (12-17)":l>=17&&l<21?o="Evening (17-21)":o="Late Night (21-5)",r=`${o} - ${t.cleanedClass||"Unknown"}`;break}case"trainer_location_am_pm":{const l=parseInt(t.time?.split(":")[0]||"0");r=`${t.trainerName||"Unknown"} - ${t.location||"Unknown"} - ${l<12?"AM":"PM"}`;break}case"class_location_day":r=`${t.cleanedClass||"Unknown"} - ${t.location||"Unknown"} - ${t.dayOfWeek}`;break;case"overall":default:r="Overall";break}n.has(r)||n.set(r,[]),n.get(r).push(t)}),Array.from(n.entries()).map(([t,r])=>{const a={};k.forEach(l=>{a[l.key]={month:l.key,monthLabel:l.label,sessions:0,attendance:0,capacity:0,revenue:0,fillRate:0,classAverage:0,bookingRate:0,lateCancellations:0,uniqueClasses:0,uniqueTrainers:0,booked:0}}),r.forEach(l=>{const o=new Date(l.date),B=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}`;if(a[B]){const O=a[B];O.sessions+=1,O.attendance+=l.checkedInCount||0,O.capacity+=l.capacity||0,O.revenue+=l.totalPaid||0,O.lateCancellations+=l.lateCancelledCount||0,O.booked=(O.booked||0)+(l.bookedCount||0)}}),Object.values(a).forEach(l=>{l.fillRate=l.capacity>0?l.attendance/l.capacity*100:0,l.classAverage=l.sessions>0?l.attendance/l.sessions:0,l.bookingRate=l.capacity>0?(l.booked||0)/l.capacity*100:0});const s={month:"total",monthLabel:"Total",sessions:Object.values(a).reduce((l,o)=>l+o.sessions,0),attendance:Object.values(a).reduce((l,o)=>l+o.attendance,0),capacity:Object.values(a).reduce((l,o)=>l+o.capacity,0),revenue:Object.values(a).reduce((l,o)=>l+o.revenue,0),lateCancellations:Object.values(a).reduce((l,o)=>l+o.lateCancellations,0),fillRate:0,classAverage:0,bookingRate:0,uniqueClasses:0,uniqueTrainers:0,booked:Object.values(a).reduce((l,o)=>l+(o.booked||0),0)};return s.fillRate=s.capacity>0?s.attendance/s.capacity*100:0,s.classAverage=s.sessions>0?s.attendance/s.sessions:0,s.bookingRate=s.capacity>0?s.attendance/s.capacity*100:0,{groupKey:t,groupLabel:t,monthlyData:a,totals:s}}).sort((t,r)=>r.totals.attendance-t.totals.attendance)},[A,v,k]),E=n=>{const x=new Map;return A.forEach(a=>{let s="Overall";switch(v){case"trainer":s=a.trainerName||"Unknown Trainer";break;case"class":s=a.cleanedClass||"Unknown Class";break;case"location":s=a.location||"Unknown Location";break;case"day_time":s=`${a.dayOfWeek} ${a.time}`;break;case"trainer_class":s=`${a.trainerName||"Unknown"} - ${a.cleanedClass||"Unknown"}`;break;case"uniqueid1":s=a.uniqueId1||"Unknown UniqueID1";break;case"uniqueid2":s=a.uniqueId2||"Unknown UniqueID2";break;case"am_pm":{s=parseInt(a.time?.split(":")[0]||"0")<12?"AM":"PM";break}case"timeslot":{const l=parseInt(a.time?.split(":")[0]||"0");l>=5&&l<9?s="Early Morning (5-9)":l>=9&&l<12?s="Morning (9-12)":l>=12&&l<17?s="Afternoon (12-17)":l>=17&&l<21?s="Evening (17-21)":s="Late Night (21-5)";break}case"class_time":s=`${a.cleanedClass||"Unknown"} - ${a.time}`;break;case"trainer_time":s=`${a.trainerName||"Unknown"} - ${a.time}`;break;case"class_day":s=`${a.cleanedClass||"Unknown"} - ${a.dayOfWeek}`;break;case"trainer_day":s=`${a.trainerName||"Unknown"} - ${a.dayOfWeek}`;break;case"time_location":s=`${a.time} - ${a.location||"Unknown"}`;break;case"class_location":s=`${a.cleanedClass||"Unknown"} - ${a.location||"Unknown"}`;break;case"class_day_time_location":s=`${a.cleanedClass||"Unknown"} - ${a.dayOfWeek} ${a.time} - ${a.location||"Unknown"}`;break;case"trainer_class_day":s=`${a.trainerName||"Unknown"} - ${a.cleanedClass||"Unknown"} - ${a.dayOfWeek}`;break;case"trainer_location":s=`${a.trainerName||"Unknown"} - ${a.location||"Unknown"}`;break;case"class_trainer_location":s=`${a.cleanedClass||"Unknown"} - ${a.trainerName||"Unknown"} - ${a.location||"Unknown"}`;break;case"day_location":s=`${a.dayOfWeek} - ${a.location||"Unknown"}`;break;case"time_trainer":s=`${a.time} - ${a.trainerName||"Unknown"}`;break;case"time_class_location":s=`${a.time} - ${a.cleanedClass||"Unknown"} - ${a.location||"Unknown"}`;break;case"day_time_trainer":s=`${a.dayOfWeek} ${a.time} - ${a.trainerName||"Unknown"}`;break;case"trainer_am_pm":{const l=parseInt(a.time?.split(":")[0]||"0");s=`${a.trainerName||"Unknown"} - ${l<12?"AM":"PM"}`;break}case"class_am_pm":{const l=parseInt(a.time?.split(":")[0]||"0");s=`${a.cleanedClass||"Unknown"} - ${l<12?"AM":"PM"}`;break}case"location_am_pm":{const l=parseInt(a.time?.split(":")[0]||"0");s=`${a.location||"Unknown"} - ${l<12?"AM":"PM"}`;break}case"class_day_time":s=`${a.cleanedClass||"Unknown"} - ${a.dayOfWeek} ${a.time}`;break;case"trainer_day_time":s=`${a.trainerName||"Unknown"} - ${a.dayOfWeek} ${a.time}`;break;case"trainer_class_time":s=`${a.trainerName||"Unknown"} - ${a.cleanedClass||"Unknown"} - ${a.time}`;break;case"location_day_time":s=`${a.location||"Unknown"} - ${a.dayOfWeek} ${a.time}`;break;case"timeslot_location":{const l=parseInt(a.time?.split(":")[0]||"0");let o="";l>=5&&l<9?o="Early Morning (5-9)":l>=9&&l<12?o="Morning (9-12)":l>=12&&l<17?o="Afternoon (12-17)":l>=17&&l<21?o="Evening (17-21)":o="Late Night (21-5)",s=`${o} - ${a.location||"Unknown"}`;break}case"timeslot_trainer":{const l=parseInt(a.time?.split(":")[0]||"0");let o="";l>=5&&l<9?o="Early Morning (5-9)":l>=9&&l<12?o="Morning (9-12)":l>=12&&l<17?o="Afternoon (12-17)":l>=17&&l<21?o="Evening (17-21)":o="Late Night (21-5)",s=`${o} - ${a.trainerName||"Unknown"}`;break}case"timeslot_class":{const l=parseInt(a.time?.split(":")[0]||"0");let o="";l>=5&&l<9?o="Early Morning (5-9)":l>=9&&l<12?o="Morning (9-12)":l>=12&&l<17?o="Afternoon (12-17)":l>=17&&l<21?o="Evening (17-21)":o="Late Night (21-5)",s=`${o} - ${a.cleanedClass||"Unknown"}`;break}case"trainer_location_am_pm":{const l=parseInt(a.time?.split(":")[0]||"0");s=`${a.trainerName||"Unknown"} - ${a.location||"Unknown"} - ${l<12?"AM":"PM"}`;break}case"class_location_day":s=`${a.cleanedClass||"Unknown"} - ${a.location||"Unknown"} - ${a.dayOfWeek}`;break;case"overall":default:s="Overall";break}s===n&&(x.has(s)||x.set(s,[]),x.get(s).push(a))}),(x.get(n)||[]).map((a,s)=>{const l={};k.forEach(D=>{l[D.key]={month:D.key,monthLabel:D.label,sessions:0,attendance:0,capacity:0,revenue:0,fillRate:0,classAverage:0,bookingRate:0,lateCancellations:0,uniqueClasses:0,uniqueTrainers:0,booked:0}});const o=new Date(a.date),B=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}`;if(l[B]){const D=l[B];D.sessions=1,D.attendance=a.checkedInCount||0,D.capacity=a.capacity||0,D.revenue=a.totalPaid||0,D.fillRate=D.capacity>0?D.attendance/D.capacity*100:0,D.classAverage=D.attendance,D.booked=a.bookedCount||0,D.bookingRate=D.capacity>0?D.booked/D.capacity*100:0,D.lateCancellations=a.lateCancelledCount||0}const O={month:"total",monthLabel:"Total",sessions:1,attendance:a.checkedInCount||0,capacity:a.capacity||0,revenue:a.totalPaid||0,lateCancellations:a.lateCancelledCount||0,fillRate:0,classAverage:a.checkedInCount||0,bookingRate:0,uniqueClasses:0,uniqueTrainers:0,booked:a.bookedCount||0};return O.fillRate=O.capacity>0?O.attendance/O.capacity*100:0,O.bookingRate=O.capacity>0?O.booked/O.capacity*100:0,{groupKey:`${n}__child__${s}`,groupLabel:`${a.date} - ${a.cleanedClass||"Unknown"} - ${a.trainerName||"Unknown"}`,monthlyData:l,totals:O}}).sort((a,s)=>s.totals.attendance-a.totals.attendance)},W=(n,x)=>{switch(x){case"attendance":return M(n.attendance);case"sessions":return M(n.sessions);case"revenue":return M(n.revenue);case"fillRate":return Q(n.fillRate);case"classAverage":return n.classAverage.toFixed(1);case"capacity":return M(n.capacity);case"bookingRate":return Q(n.bookingRate);default:return M(n.attendance)}},ke=(n,x)=>x===0?n>0?100:0:(n-x)/x*100,I=[{value:"attendance",label:"Attendance",icon:z},{value:"sessions",label:"Sessions",icon:Z},{value:"revenue",label:"Revenue",icon:Ne},{value:"fillRate",label:"Fill Rate",icon:ie},{value:"classAverage",label:"Class Average",icon:X},{value:"capacity",label:"Capacity",icon:Se},{value:"bookingRate",label:"Booking Rate",icon:Ya}],Ce=[{value:"class_day_time_location",label:"Class + Day + Time + Location",icon:X},{value:"overall",label:"Overall",icon:X},{value:"class",label:"By Class",icon:G},{value:"trainer",label:"By Trainer",icon:z},{value:"location",label:"By Location",icon:me},{value:"day_time",label:"By Day & Time",icon:J},{value:"class_day_time",label:"Class + Day + Time",icon:G},{value:"trainer_class_day",label:"Trainer + Class + Day",icon:z},{value:"trainer_location",label:"Trainer + Location",icon:z},{value:"class_trainer_location",label:"Class + Trainer + Location",icon:G},{value:"day_location",label:"Day + Location",icon:me},{value:"am_pm",label:"By AM/PM",icon:J},{value:"timeslot",label:"By Timeslot",icon:J},{value:"class_time",label:"Class + Time",icon:G},{value:"trainer_time",label:"Trainer + Time",icon:z},{value:"class_day",label:"Class + Day",icon:G},{value:"trainer_day",label:"Trainer + Day",icon:z},{value:"time_location",label:"Time + Location",icon:me},{value:"class_location",label:"Class + Location",icon:Se},{value:"trainer_class",label:"Trainer + Class",icon:ie},{value:"time_trainer",label:"Time + Trainer",icon:J},{value:"time_class_location",label:"Time + Class + Location",icon:J},{value:"day_time_trainer",label:"Day + Time + Trainer",icon:J},{value:"trainer_am_pm",label:"Trainer + AM/PM",icon:z},{value:"class_am_pm",label:"Class + AM/PM",icon:G},{value:"location_am_pm",label:"Location + AM/PM",icon:me},{value:"trainer_day_time",label:"Trainer + Day + Time",icon:z},{value:"trainer_class_time",label:"Trainer + Class + Time",icon:z},{value:"location_day_time",label:"Location + Day + Time",icon:me},{value:"timeslot_location",label:"Timeslot + Location",icon:me},{value:"timeslot_trainer",label:"Timeslot + Trainer",icon:J},{value:"timeslot_class",label:"Timeslot + Class",icon:J},{value:"uniqueid1",label:"Group by Class (ID1)",icon:ie},{value:"uniqueid2",label:"Group by Class & Trainer (ID2)",icon:z},{value:"trainer_location_am_pm",label:"Trainer + Location + AM/PM",icon:z},{value:"class_location_day",label:"Class + Location + Day",icon:G}];return e.jsxs(e.Fragment,{children:[e.jsx(Ka,{title:"Month-on-Month Analytics",description:"Track class attendance trends across months with detailed grouping options",icon:e.jsx(X,{className:"w-5 h-5"}),totalItems:m.length,showCollapseControls:!0,onCollapseAll:()=>S(new Set),onExpandAll:()=>{const n=new Set;T.forEach(x=>{v!=="overall"&&n.add(x.groupKey)}),S(n)},showCopyButton:!0,tableRef:h,headerControls:e.jsxs("div",{className:"flex items-center gap-4 ml-auto",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-xs font-semibold text-white/70 flex items-center gap-2",children:[e.jsx(X,{className:"w-3 h-3"}),"Metric"]}),e.jsxs(te,{value:f,onValueChange:n=>C(n),children:[e.jsx(se,{className:"w-[150px] border-white/20 bg-white/10 text-white focus:border-white/40 h-8 text-xs",children:e.jsx(le,{})}),e.jsx(ne,{children:I.map(n=>{const x=n.icon;return e.jsx(Y,{value:n.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"w-3 h-3"}),n.label]})},n.value)})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-xs font-semibold text-white/70 flex items-center gap-2",children:[e.jsx(Se,{className:"w-3 h-3"}),"Group By"]}),e.jsxs(te,{value:v,onValueChange:n=>p(n),children:[e.jsx(se,{className:"w-[180px] border-white/20 bg-white/10 text-white focus:border-white/40 h-8 text-xs",children:e.jsx(le,{})}),e.jsx(ne,{children:Ce.map(n=>{const x=n.icon;return e.jsx(Y,{value:n.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"w-3 h-3"}),n.label]})},n.value)})})]})]}),e.jsx(Ae.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(ce,{variant:u?"default":"outline",size:"sm",onClick:()=>y(!u),className:q("transition-all duration-200 h-8 text-xs",u?"bg-white text-slate-700 hover:bg-white/90":"border-white/20 text-white hover:bg-white/10"),children:[e.jsx(fe,{className:"w-3 h-3 mr-1"}),"Growth %"]})}),e.jsxs(ce,{variant:"outline",size:"sm",onClick:()=>j(!w),className:"border-white/20 text-white hover:bg-white/10 h-8 text-xs",children:[w?e.jsx(Be,{className:"w-3 h-3"}):e.jsx(Ga,{className:"w-3 h-3"}),w?"Expand":"Collapse"]})]}),children:!w&&e.jsx("div",{className:"w-full overflow-x-auto overflow-y-auto max-h-[800px] custom-scrollbar rounded-xl",style:{display:"block"},children:e.jsxs(ea,{ref:h,id:R,className:"min-w-[1400px] w-max",children:[e.jsx(aa,{className:"sticky top-0 z-20 shadow-sm border-b border-slate-200 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:e.jsxs(Te,{children:[e.jsx(K,{className:"min-w-[200px] sticky left-0 z-30 bg-slate-800/95 backdrop-blur-sm border-r font-bold",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-white"}),v==="trainer"?"Trainer":v==="class"?"Class":v==="location"?"Location":v==="day_time"?"Day & Time":v==="uniqueid1"?"UniqueID1":v==="uniqueid2"?"UniqueID2":v==="trainer_class"?"Trainer & Class":"Category"]})}),$.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"min-w-[100px] text-center font-bold text-white text-xs",children:"Date"}),e.jsx(K,{className:"min-w-[80px] text-center font-bold text-white text-xs",children:"Time"}),e.jsx(K,{className:"min-w-[120px] text-center font-bold text-white text-xs",children:"Trainer"}),e.jsx(K,{className:"min-w-[120px] text-center font-bold text-white text-xs",children:"Location"}),e.jsx(K,{className:"min-w-[120px] text-center font-bold text-white text-xs",children:"Teacher"})]}),k.map(n=>e.jsx(K,{className:"text-center min-w-[120px] font-bold",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold",children:n.shortLabel}),u&&e.jsx("div",{className:"text-xs text-gray-500",children:"Growth %"})]})},n.key)),e.jsx(K,{className:"text-center min-w-[120px] bg-slate-800 font-bold text-white",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold",children:"Total"}),u&&e.jsx("div",{className:"text-xs text-slate-300",children:"Avg Growth"})]})})]})}),e.jsxs(ta,{children:[e.jsx(We,{children:T.map((n,x)=>{const t=$.has(n.groupKey),r=v!=="overall",a=t?E(n.groupKey):[];return e.jsxs(Ee.Fragment,{children:[e.jsxs(Ae.tr,{className:q("border-b transition-all duration-300 hover:shadow-md h-9 max-h-9 cursor-pointer",x%2===0?"bg-white":"bg-slate-50/50",r?"hover:bg-blue-50/30":""),initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3,delay:x*.05},whileHover:{backgroundColor:r?"rgba(59, 130, 246, 0.08)":"rgba(59, 130, 246, 0.05)",transition:{duration:.2}},onClick:()=>{r&&S(s=>{const l=new Set(s);return l.has(n.groupKey)?l.delete(n.groupKey):l.add(n.groupKey),l})},children:[e.jsx(_,{className:"sticky left-0 z-20 bg-white border-r font-medium whitespace-nowrap py-1.5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[r&&e.jsx(Ae.div,{animate:{rotate:t?90:0},transition:{duration:.2},className:"flex items-center justify-center w-5",children:e.jsx(Be,{className:"w-4 h-4 text-blue-600"})}),!r&&e.jsx("div",{className:"w-5"}),e.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-blue-500 to-indigo-500 flex items-center justify-center text-white text-xs font-bold",children:n.groupLabel.charAt(0).toUpperCase()}),e.jsx("span",{className:"font-semibold text-gray-900",children:n.groupLabel}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",n.totals.sessions,")"]})]})}),$.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"text-center py-1.5 text-gray-400",children:"-"}),e.jsx(_,{className:"text-center py-1.5 text-gray-400",children:"-"}),e.jsx(_,{className:"text-center py-1.5 text-gray-400",children:"-"}),e.jsx(_,{className:"text-center py-1.5 text-gray-400",children:"-"}),e.jsx(_,{className:"text-center py-1.5 text-gray-400",children:"-"})]}),k.map((s,l)=>{const o=n.monthlyData[s.key],B=l>0?n.monthlyData[k[l-1].key]:null,O=(ee,ue)=>{switch(ue){case"attendance":return ee.attendance;case"sessions":return ee.sessions;case"revenue":return ee.revenue;case"fillRate":return ee.fillRate;case"classAverage":return ee.classAverage;case"capacity":return ee.capacity;case"bookingRate":return ee.bookingRate;default:return ee.attendance}},D=O(o,f),be=B?O(B,f):0,oe=B?ke(D,be):0;return e.jsxs(_,{className:"text-center py-1.5 whitespace-nowrap",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:W(o,f)}),u&&B&&e.jsxs("span",{className:q("text-xs font-medium ml-1",oe>0?"text-green-600":oe<0?"text-red-600":"text-gray-500"),children:[oe>0?"":oe<0?"":"",Q(Math.abs(oe))]})]},s.key)}),e.jsx(_,{className:"text-center py-1.5 whitespace-nowrap",children:e.jsx("span",{className:"font-bold text-slate-800",children:W(n.totals,f)})})]}),e.jsx(We,{children:t&&a.map((s,l)=>e.jsxs(Ae.tr,{className:"border-b h-9 max-h-9",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2,delay:l*.02},children:[e.jsx(_,{className:"sticky left-0 z-20 bg-white border-r font-medium whitespace-nowrap py-1 pl-12 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-gradient-to-br from-green-400 to-blue-400"}),e.jsx("span",{className:"text-gray-700",children:s.groupLabel})]})}),e.jsx(_,{className:"text-center py-1 text-sm text-gray-700",children:s.sessionDetails?.date||"-"}),e.jsx(_,{className:"text-center py-1 text-sm text-gray-700",children:s.sessionDetails?.time||"-"}),e.jsx(_,{className:"text-center py-1 text-sm text-gray-700",children:s.sessionDetails?.trainer||"-"}),e.jsx(_,{className:"text-center py-1 text-sm text-gray-700",children:s.sessionDetails?.location||"-"}),e.jsx(_,{className:"text-center py-1 text-sm text-gray-700",children:s.sessionDetails?.teacher||"-"}),k.map(o=>{const B=s.monthlyData[o.key];return e.jsx(_,{className:"text-center py-1 whitespace-nowrap text-sm",children:e.jsx("span",{className:"text-gray-800",children:W(B,f)})},o.key)}),e.jsx(_,{className:"text-center py-1 whitespace-nowrap text-sm",children:e.jsx("span",{className:"font-semibold text-slate-700",children:W(s.totals,f)})})]},s.groupKey))})]},n.groupKey)})}),e.jsxs(Te,{className:"bg-slate-800 text-white font-bold border-t-2 h-9 max-h-9",children:[e.jsx(_,{className:"sticky left-0 z-10 bg-slate-800 border-r text-white py-1.5",children:"Totals"}),$.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(_,{}),e.jsx(_,{}),e.jsx(_,{}),e.jsx(_,{}),e.jsx(_,{})]}),k.map(n=>{const x=T.reduce((r,a)=>{const s=a.monthlyData[n.key];return r.sessions+=s.sessions,r.attendance+=s.attendance,r.capacity+=s.capacity,r.revenue+=s.revenue,r.lateCancellations+=s.lateCancellations,r.booked+=s.booked||0,r},{sessions:0,attendance:0,capacity:0,revenue:0,lateCancellations:0,booked:0}),t=W({month:n.key,monthLabel:n.label,sessions:x.sessions,attendance:x.attendance,capacity:x.capacity,revenue:x.revenue,fillRate:x.capacity>0?x.attendance/x.capacity*100:0,classAverage:x.sessions>0?x.attendance/x.sessions:0,bookingRate:x.capacity>0?x.booked/x.capacity*100:0,lateCancellations:x.lateCancellations,booked:x.booked},f);return e.jsx(_,{className:"text-center py-1.5",children:e.jsx("span",{className:"font-bold text-white",children:t})},`total-${n.key}`)}),e.jsx(_,{className:"text-center py-1.5",children:e.jsx("span",{className:"font-bold text-white",children:W({sessions:T.reduce((n,x)=>n+x.totals.sessions,0),attendance:T.reduce((n,x)=>n+x.totals.attendance,0),capacity:T.reduce((n,x)=>n+x.totals.capacity,0),revenue:T.reduce((n,x)=>n+x.totals.revenue,0),fillRate:0,classAverage:0,bookingRate:0,lateCancellations:T.reduce((n,x)=>n+x.totals.lateCancellations,0)},f)})})]})]})]})})}),e.jsx(qa,{tableId:"month-on-month-class-attendance",tableData:T,tableName:"Month-on-Month Class Attendance",tableContext:"Monthly class attendance trends and comparisons"})]})},jt=({data:m,location:i})=>{const[f,C]=g.useState("classAverage"),[v,p]=g.useState("classTrainer"),[u,y]=g.useState(2),[w,j]=g.useState(!0),[$,S]=g.useState(!0),[h,R]=g.useState(10),[U,P]=g.useState(10),[N,A]=g.useState(null),k=g.useMemo(()=>{let t=[...m];if(w&&(t=t.filter(r=>!r.cleanedClass?.toLowerCase().includes("hosted")&&!r.sessionName?.toLowerCase().includes("hosted"))),u>1){const r=new Map;t.forEach(a=>{const s=v==="classTrainer"?`${a.cleanedClass}-${a.trainerName}-${a.dayOfWeek}-${a.time}-${a.location}`:v==="class"?`${a.cleanedClass}-${a.dayOfWeek}-${a.time}-${a.location}`:v==="trainer"?a.trainerName||"unknown":v==="location"?a.location||"unknown":`${a.time}-${a.dayOfWeek}`;r.set(s,(r.get(s)||0)+1)}),t=t.filter(a=>{const s=v==="classTrainer"?`${a.cleanedClass}-${a.trainerName}-${a.dayOfWeek}-${a.time}-${a.location}`:v==="class"?`${a.cleanedClass}-${a.dayOfWeek}-${a.time}-${a.location}`:v==="trainer"?a.trainerName||"unknown":v==="location"?a.location||"unknown":`${a.time}-${a.dayOfWeek}`;return(r.get(s)||0)>=u})}return t},[m,w,u,v]),T=g.useMemo(()=>{const t=new Map;return k.forEach(a=>{let s="";switch(v){case"classTrainer":s=`${a.cleanedClass}-${a.trainerName}-${a.dayOfWeek}-${a.time}-${a.location}`;break;case"class":s=`${a.cleanedClass}-${a.dayOfWeek}-${a.time}-${a.location}`;break;case"trainer":s=a.trainerName||"Unknown Trainer";break;case"location":s=a.location||"Unknown Location";break;case"timeSlot":s=`${a.time}-${a.dayOfWeek}`;break;default:s=`${a.cleanedClass}-${a.trainerName}`}t.has(s)||t.set(s,[]),t.get(s).push(a)}),Array.from(t.entries()).map(([a,s])=>{const l=s.length,o=s.reduce((H,re)=>H+(re.checkedInCount||0),0),B=s.reduce((H,re)=>H+(re.capacity||0),0),O=s.reduce((H,re)=>H+(re.totalPaid||0),0),D=s.reduce((H,re)=>H+(re.lateCancelledCount||0),0),be=s.filter(H=>(H.checkedInCount||0)===0).length,oe=l-be,ee=B>0?o/B*100:0,ue=l>0?o/l:0,c=l>0?B/l:0,d=ue,b=s.reduce((H,re)=>{const je=(re.checkedInCount||0)-d;return H+je*je},0)/l,L=d>0?100-Math.sqrt(b)/d*100:0,ye=ee>70?Math.random()*20-5:Math.random()*10-10;let ae=0;switch(f){case"classAverage":ae=ue;break;case"fillRate":ae=ee;break;case"attendance":ae=o;break;case"revenue":ae=O;break;case"consistency":ae=Math.max(0,Math.min(100,L));break;case"growth":ae=ye;break;default:ae=ue}let de="",xe="";switch(v){case"classTrainer":de=s[0].cleanedClass||"Unknown Class",xe=$?s[0].trainerName||"Unknown Trainer":"";break;case"class":de=s[0].cleanedClass||"Unknown Class",xe=`${s[0].dayOfWeek} at ${s[0].time}`;break;case"trainer":de=s[0].trainerName||"Unknown Trainer",xe=`${l} classes`;break;case"location":de=s[0].location||"Unknown Location",xe=`${l} classes`;break;case"timeSlot":de=`${s[0].time} - ${s[0].dayOfWeek}`,xe=`${new Set(s.map(H=>H.cleanedClass)).size} different classes`;break;default:de=`${s[0].cleanedClass} - ${s[0].trainerName}`}return{id:a,name:de,subName:xe,sessions:l,attendance:o,capacity:B,revenue:O,fillRate:Math.max(0,Math.min(100,ee)),classAverage:ue,consistency:Math.max(0,Math.min(100,L)),growth:ye,rankValue:ae,emptyClasses:be,nonEmptyClasses:oe,details:{location:s[0].location,dayOfWeek:s[0].dayOfWeek,time:s[0].time,classType:s[0].cleanedClass,trainer:s[0].trainerName,uniqueClasses:new Set(s.map(H=>H.cleanedClass)).size,avgCapacity:c,lateCancellations:D},sessions_data:s}}).sort((a,s)=>s.rankValue-a.rankValue)},[k,v,f,$]),E=T.slice(0,h),W=T.slice(-U).reverse(),ke=[{value:"classAverage",label:"Class Average",icon:X,description:"Average attendance per session"},{value:"fillRate",label:"Fill Rate",icon:ie,description:"Percentage of capacity filled"},{value:"attendance",label:"Total Attendance",icon:z,description:"Total people attended"},{value:"revenue",label:"Revenue",icon:Ne,description:"Total revenue generated"},{value:"consistency",label:"Consistency",icon:fe,description:"Consistency of attendance"},{value:"growth",label:"Growth Rate",icon:Qa,description:"Month-over-month growth"}],I=[{value:"classTrainer",label:"Class + Trainer",icon:G,description:"Unique class-trainer combinations"},{value:"class",label:"Class Only",icon:G,description:"Classes regardless of trainer"},{value:"trainer",label:"Trainer",icon:z,description:"Individual trainers"},{value:"location",label:"Location",icon:me,description:"By studio location"},{value:"timeSlot",label:"Time Slot",icon:J,description:"By day and time"}],Ce=t=>{switch(f){case"classAverage":return M(t.classAverage);case"fillRate":return Q(t.fillRate);case"attendance":return M(t.attendance);case"revenue":return $e(t.revenue);case"consistency":return Q(t.consistency);case"growth":return`${t.growth>=0?"+":""}${Q(t.growth)}`;default:return M(t.classAverage)}},n=(t,r)=>f==="growth"?t.growth>=0?"text-green-600":"text-red-600":r?"text-green-600":"text-red-600",x=({item:t,rank:r,isTop:a,icon:s})=>e.jsx(ge,{className:q("transition-all duration-300 hover:shadow-lg cursor-pointer border-l-4",a?"hover:bg-green-50 border-l-green-500 bg-gradient-to-r from-green-50 to-white":"hover:bg-red-50 border-l-red-500 bg-gradient-to-r from-red-50 to-white"),onClick:()=>A(t),children:e.jsxs(he,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:q("w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold",a?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:r}),e.jsx(s,{className:q("w-5 h-5",a?"text-green-600":"text-red-600")})]}),e.jsx("div",{className:q("text-lg font-bold",n(t,a)),children:Ce(t)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold text-gray-900 line-clamp-2",children:t.name}),t.subName&&e.jsx("div",{className:"text-sm text-gray-600",children:t.subName}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[e.jsxs(F,{variant:"outline",className:"metric-badge badge-soft-slate",children:[t.sessions," classes"]}),e.jsxs(F,{variant:"outline",className:"metric-badge badge-soft-blue",children:[M(t.attendance)," checked in"]}),e.jsxs(F,{variant:"outline",className:"metric-badge badge-soft-red",children:[M(t.emptyClasses)," empty"]}),e.jsxs(F,{variant:"outline",className:"metric-badge badge-soft-green",children:[M(t.nonEmptyClasses)," non-empty"]}),e.jsxs(F,{variant:"outline",className:"metric-badge badge-soft-purple",children:[M(t.classAverage)," avg/class"]}),e.jsxs(F,{variant:"outline",className:"metric-badge badge-soft-yellow",children:[Q(t.fillRate)," fill rate"]})]})]})]})});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ge,{className:"bg-gradient-to-r from-blue-50 to-purple-50",children:e.jsx(he,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"text-sm font-semibold",children:"Ranking Criteria"}),e.jsxs(te,{value:f,onValueChange:t=>C(t),children:[e.jsx(se,{className:"w-48",children:e.jsx(le,{})}),e.jsx(ne,{children:ke.map(t=>e.jsx(Y,{value:t.value,children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t.icon,{className:"w-4 h-4"}),t.label]}),e.jsx("div",{className:"text-xs text-gray-500",children:t.description})]})},t.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"text-sm font-semibold",children:"Group By"}),e.jsxs(te,{value:v,onValueChange:t=>p(t),children:[e.jsx(se,{className:"w-48",children:e.jsx(le,{})}),e.jsx(ne,{children:I.map(t=>e.jsx(Y,{value:t.value,children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t.icon,{className:"w-4 h-4"}),t.label]}),e.jsx("div",{className:"text-xs text-gray-500",children:t.description})]})},t.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"text-sm font-semibold",children:"Min Classes"}),e.jsx(we,{type:"number",min:"1",max:"20",value:u,onChange:t=>y(Number(t.target.value)),className:"w-24"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_e,{id:"exclude-hosted",checked:w,onCheckedChange:j}),e.jsx(V,{htmlFor:"exclude-hosted",className:"text-sm",children:"Exclude Hosted Classes"})]}),v==="classTrainer"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_e,{id:"show-trainer",checked:$,onCheckedChange:S}),e.jsx(V,{htmlFor:"show-trainer",className:"text-sm",children:"Show Trainer Names"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"text-sm",children:"Top:"}),e.jsx(we,{type:"number",min:"5",max:"20",value:h,onChange:t=>R(Number(t.target.value)),className:"w-16"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"text-sm",children:"Bottom:"}),e.jsx(we,{type:"number",min:"5",max:"20",value:U,onChange:t=>P(Number(t.target.value)),className:"w-16"})]})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(ge,{className:"shadow-xl bg-gradient-to-br from-green-50 to-emerald-50",children:[e.jsx(Oe,{className:"bg-gradient-to-r from-green-600 to-emerald-600 text-white",children:e.jsxs(Le,{className:"flex items-center gap-3",children:[e.jsx(Pe,{className:"w-6 h-6"}),"Top Performers",e.jsx(F,{variant:"secondary",className:"bg-white/20 text-white",children:E.length})]})}),e.jsx(he,{className:"p-6",children:e.jsx("div",{className:"space-y-3",children:E.map((t,r)=>e.jsx(x,{item:t,rank:r+1,isTop:!0,icon:r===0?Ja:r===1?Za:r===2?Xa:Pe},t.id))})})]}),e.jsxs(ge,{className:"shadow-xl bg-gradient-to-br from-red-50 to-rose-50",children:[e.jsx(Oe,{className:"bg-gradient-to-r from-red-600 to-rose-600 text-white",children:e.jsxs(Le,{className:"flex items-center gap-3",children:[e.jsx(et,{className:"w-6 h-6"}),"Bottom Performers",e.jsx(F,{variant:"secondary",className:"bg-white/20 text-white",children:W.length})]})}),e.jsx(he,{className:"p-6",children:e.jsx("div",{className:"space-y-3",children:W.map((t,r)=>e.jsx(x,{item:t,rank:T.length-W.length+r+1,isTop:!1,icon:wa},t.id))})})]})]}),e.jsx(Ke,{open:N!==null,onOpenChange:t=>!t&&A(null),children:e.jsxs(Ge,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Ye,{children:e.jsxs(Qe,{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5"}),"Detailed Analytics: ",N?.name]})}),N&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:M(N.classAverage)}),e.jsx("div",{className:"text-sm text-blue-700",children:"Class Average"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:Q(N.fillRate)}),e.jsx("div",{className:"text-sm text-green-700",children:"Fill Rate"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:M(N.attendance)}),e.jsx("div",{className:"text-sm text-purple-700",children:"Total Attendance"})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:$e(N.revenue)}),e.jsx("div",{className:"text-sm text-orange-700",children:"Revenue"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Session Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 max-h-60 overflow-y-auto",children:[N.sessions_data.slice(0,12).map((t,r)=>e.jsxs("div",{className:"bg-gray-50 p-3 rounded border text-sm",children:[e.jsx("div",{className:"font-medium",children:t.date}),e.jsxs("div",{className:"text-gray-600",children:[t.time," - ",t.dayOfWeek]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsxs(F,{variant:"outline",className:"text-xs",children:[t.checkedInCount,"/",t.capacity]}),e.jsx(F,{variant:"outline",className:"text-xs",children:$e(t.totalPaid||0)})]})]},r)),N.sessions_data.length>12&&e.jsxs("div",{className:"bg-gray-100 p-3 rounded border text-sm flex items-center justify-center text-gray-500",children:["+",N.sessions_data.length-12," more sessions"]})]})]})]})]})})]})},wt=[{id:"all",name:"All Locations",fullName:"All Locations"},{id:"Kwality House, Kemps Corner",name:"Kwality House",fullName:"Kwality House, Kemps Corner"},{id:"Supreme HQ, Bandra",name:"Supreme HQ",fullName:"Supreme HQ, Bandra"},{id:"Kenkere House",name:"Kenkere House",fullName:"Kenkere House"}],hs=()=>{const{data:m,loading:i,error:f,refetch:C}=Ca(),{data:v}=at(),{setLoading:p}=Na();if(g.useEffect(()=>{p(i,"Loading class attendance data...")},[i,p]),i)return e.jsxs("div",{className:"min-h-screen bg-white relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute top-20 left-10 w-96 h-96 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-full floating-animation stagger-1"}),e.jsx("div",{className:"absolute bottom-20 right-10 w-80 h-80 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-full floating-animation stagger-3"}),e.jsx("div",{className:"absolute top-1/2 left-1/3 w-72 h-72 bg-gradient-to-r from-cyan-500/10 to-teal-500/10 rounded-full morph-shape stagger-2"})]}),e.jsx("div",{className:"relative z-10 container mx-auto px-6 py-10",children:e.jsx(_a,{type:"full-page"})})]});if(f)return e.jsxs("div",{className:"min-h-screen bg-white relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute top-20 left-10 w-96 h-96 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-full floating-animation stagger-1"}),e.jsx("div",{className:"absolute bottom-20 right-10 w-80 h-80 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-full floating-animation stagger-3"}),e.jsx("div",{className:"absolute top-1/2 left-1/3 w-72 h-72 bg-gradient-to-r from-cyan-500/10 to-teal-500/10 rounded-full morph-shape stagger-2"})]}),e.jsx("div",{className:"relative z-10 container mx-auto px-6 py-10",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 p-6 rounded-2xl shadow-sm",children:[e.jsx("div",{className:"font-semibold text-lg mb-1",children:"Failed to load class attendance data"}),e.jsx("div",{className:"text-sm opacity-90 mb-4",children:String(f)}),e.jsx("button",{onClick:C,className:"px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 transition",children:"Retry"})]})})]});const u=({rawData:y,payrollData:w})=>{const j=Ta(y||[]),[$,S]=g.useState("Kwality House, Kemps Corner"),[h,R]=g.useState("overview"),U=g.useMemo(()=>{if(!j||$==="all")return j||[];const N=wt.find(A=>A.id===$);return N?j.filter(A=>{if(A.location===N.fullName)return!0;const k=A.location?.toLowerCase()||"";return N.fullName.toLowerCase(),!!(N.id==="Kwality House, Kemps Corner"&&k.includes("kwality")||N.id==="Supreme HQ, Bandra"&&k.includes("supreme")||N.id==="Kenkere House"&&k.includes("kenkere"))}):j||[]},[j,$]),P=g.useMemo(()=>{if(!j||j.length===0)return[{label:"Total Classes",value:"0"},{label:"Total Attendance",value:"0"},{label:"Fill Rate",value:"0%"}];const N=j.length,A=j.reduce((E,W)=>E+(W.checkedInCount||0),0),k=j.reduce((E,W)=>E+(W.capacity||0),0),T=k>0?(A/k*100).toFixed(1):"0";return[{label:"Total Classes",value:N.toLocaleString()},{label:"Total Attendance",value:A.toLocaleString()},{label:"Fill Rate",value:`${T}%`}]},[j]);return e.jsxs("div",{className:"min-h-screen bg-white relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute top-20 left-10 w-96 h-96 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-full floating-animation stagger-1"}),e.jsx("div",{className:"absolute bottom-20 right-10 w-80 h-80 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-full floating-animation stagger-3"}),e.jsx("div",{className:"absolute top-1/2 left-1/3 w-72 h-72 bg-gradient-to-r from-cyan-500/10 to-teal-500/10 rounded-full morph-shape stagger-2"})]}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(Aa,{title:"Class Attendance Analytics",subtitle:"Monitor class performance, attendance patterns, capacity utilization, and trainer efficiency across all locations.",metrics:P}),e.jsx("div",{className:"bg-white text-slate-800 slide-in-from-left",children:e.jsxs("div",{className:"container mx-auto px-6 space-y-6",children:[e.jsx(Ua,{activeLocation:$,onLocationChange:S,showInfoPopover:!0,infoPopoverContext:"class-attendance"}),e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"w-full space-y-4",children:e.jsx(lt,{data:y||[]})}),e.jsx("div",{children:e.jsx(rt,{data:U,payrollData:w||[]})}),e.jsxs(Ra,{defaultValue:"overview",className:"w-full",children:[e.jsxs(Ma,{className:"bg-white/95 backdrop-blur-sm p-1.5 rounded-2xl shadow-2xl border-2 border-slate-200 flex w-full max-w-7xl mx-auto overflow-visible relative",children:[e.jsxs(Ue,{value:"overview",className:"relative flex-1 flex items-center justify-center gap-2 px-3 py-3 font-semibold text-xs md:text-sm min-h-[52px] transition-all duration-300 data-[state=active]:bg-gradient-to-br data-[state=active]:from-blue-600 data-[state=active]:via-blue-700 data-[state=active]:to-blue-800 data-[state=active]:text-white data-[state=active]:shadow-2xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-50 hover:bg-gray-50 border-r border-slate-200 last:border-r-0 data-[state=active]:scale-[1.02] data-[state=active]:rounded-xl data-[state=active]:-translate-y-1",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{className:"whitespace-nowrap",children:"Comprehensive"})]}),e.jsxs(Ue,{value:"monthlyTrends",className:"relative flex-1 flex items-center justify-center gap-2 px-3 py-3 font-semibold text-xs md:text-sm min-h-[52px] transition-all duration-300 data-[state=active]:bg-gradient-to-br data-[state=active]:from-emerald-600 data-[state=active]:via-emerald-700 data-[state=active]:to-emerald-800 data-[state=active]:text-white data-[state=active]:shadow-2xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-50 hover:bg-gray-50 border-r border-slate-200 last:border-r-0 data-[state=active]:scale-[1.02] data-[state=active]:rounded-xl data-[state=active]:-translate-y-1",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{className:"whitespace-nowrap",children:"Month on Month"})]}),e.jsxs(Ue,{value:"rankings",className:"relative flex-1 flex items-center justify-center gap-2 px-3 py-3 font-semibold text-xs md:text-sm min-h-[52px] transition-all duration-300 data-[state=active]:bg-gradient-to-br data-[state=active]:from-purple-600 data-[state=active]:via-purple-700 data-[state=active]:to-purple-800 data-[state=active]:text-white data-[state=active]:shadow-2xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-50 hover:bg-gray-50 border-r border-slate-200 last:border-r-0 data-[state=active]:scale-[1.02] data-[state=active]:rounded-xl data-[state=active]:-translate-y-1",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{className:"whitespace-nowrap",children:"Rankings"})]})]}),e.jsx(De,{value:"overview",className:"mt-8",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Comprehensive Analysis"})}),e.jsx(bt,{data:U,location:$})]})}),e.jsx(De,{value:"monthlyTrends",className:"mt-8",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Month-on-Month Analysis"})}),e.jsx(yt,{data:j||[],location:$})]})}),e.jsx(De,{value:"rankings",className:"mt-8",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Performance Rankings"})}),e.jsx(jt,{data:U})]})})]})]})]})})]}),e.jsx($a,{})]})};return e.jsx(ka,{children:e.jsx(Sa,{children:e.jsx(u,{rawData:m||[],payrollData:v||[]})})})};export{hs as default};
//# sourceMappingURL=ClassAttendance-BWc3uYp8.js.map
