import{r as ee,j as e,D as te,n as se,o as ne,q as ae,C as p,a as k,b as g,c as y}from"./index-Bm67KBkU.js";import{T as C,a as R,b as j,c,d as S,e as d}from"./table-DhXofKdS.js";import{f as r,a as m,B as oe,b as re}from"./index-DkD_C-d1.js";import{S as le}from"./scroll-area-BKnEh-kP.js";import{T as ie}from"./trending-down-B5K1omnR.js";import{S as B}from"./SalesMotionHero-sGphstF2.js";import{D as me}from"./dollar-sign-CKqx8kbC.js";import{U as T}from"./users-7Ku-1TDB.js";import{R as N,C as ue,T as v,a as P,X as U,Y as L,L as $,B as ce,b as E}from"./BarChart-o5Oeg9Jb.js";import{P as de,a as xe}from"./PieChart-slnvMcDg.js";import{L as he,a as K}from"./LineChart-BWKGpJsm.js";import{P as w}from"./package-C0br8ACw.js";import{C as pe}from"./googleAuth-BGo8ElRc.js";import{C as ye}from"./credit-card-yR0Iskrq.js";import{M}from"./StudioLocationTabs-BSKYatd_.js";import"./index-BdQq_4o_.js";const F=["#8b5cf6","#06b6d4","#10b981","#f59e0b","#ef4444","#6366f1","#ec4899","#84cc16"],Ue=({isOpen:V,onClose:O,title:H,data:l,type:A})=>{const u=ee.useMemo(()=>{if(!l||l.length===0)return null;const a=l.reduce((t,n)=>t+(n.discountAmount||0),0),i=l.reduce((t,n)=>t+(n.paymentValue||0),0),o=l.length,b=new Set(l.map(t=>t.customerEmail)).size,x=a/l.length,I=l.reduce((t,n)=>t+(n.discountPercentage||0),0)/l.length,X=l.reduce((t,n)=>{const s=n.cleanedCategory||"Unknown";return t[s]||(t[s]={discountAmount:0,revenue:0,units:0,customers:new Set}),t[s].discountAmount+=n.discountAmount||0,t[s].revenue+=n.paymentValue||0,t[s].units+=1,t[s].customers.add(n.customerEmail),t},{}),G=l.reduce((t,n)=>{const s=n.cleanedProduct||"Unknown";return t[s]||(t[s]={discountAmount:0,revenue:0,units:0,customers:new Set}),t[s].discountAmount+=n.discountAmount||0,t[s].revenue+=n.paymentValue||0,t[s].units+=1,t[s].customers.add(n.customerEmail),t},{}),J=l.reduce((t,n)=>{const s=n.calculatedLocation||"Unknown";return t[s]||(t[s]={discountAmount:0,revenue:0,units:0,customers:new Set}),t[s].discountAmount+=n.discountAmount||0,t[s].revenue+=n.paymentValue||0,t[s].units+=1,t[s].customers.add(n.customerEmail),t},{}),Q=l.reduce((t,n)=>{const s=n.paymentMethod||"Unknown";return t[s]||(t[s]={discountAmount:0,revenue:0,units:0,customers:new Set}),t[s].discountAmount+=n.discountAmount||0,t[s].revenue+=n.paymentValue||0,t[s].units+=1,t[s].customers.add(n.customerEmail),t},{}),W=l.reduce((t,n)=>{const s=n.soldBy||"Unknown";return t[s]||(t[s]={discountAmount:0,revenue:0,units:0,customers:new Set}),t[s].discountAmount+=n.discountAmount||0,t[s].revenue+=n.paymentValue||0,t[s].units+=1,t[s].customers.add(n.customerEmail),t},{}),Z=l.reduce((t,n)=>{if(!n.paymentDate)return t;const s=new Date(n.paymentDate),h=`${s.getFullYear()}-${(s.getMonth()+1).toString().padStart(2,"0")}`,_=s.toLocaleDateString("en-US",{month:"short",year:"numeric"});return t[h]||(t[h]={month:_,monthKey:h,discountAmount:0,revenue:0,units:0,customers:new Set}),t[h].discountAmount+=n.discountAmount||0,t[h].revenue+=n.paymentValue||0,t[h].units+=1,t[h].customers.add(n.customerEmail),t},{}),f=t=>Object.entries(t).map(([n,s])=>({name:n,discountAmount:s.discountAmount,revenue:s.revenue,units:s.units,customers:s.customers.size,avgDiscount:s.units>0?s.discountAmount/s.units:0,discountRate:s.revenue>0?s.discountAmount/s.revenue*100:0})).sort((n,s)=>s.discountAmount-n.discountAmount);return{summary:{totalDiscount:a,totalRevenue:i,totalUnits:o,uniqueCustomers:b,avgDiscount:x,avgDiscountPercent:I,discountRate:i>0?a/i*100:0},categoryBreakdown:f(X),productBreakdown:f(G),locationBreakdown:f(J),paymentBreakdown:f(Q),staffBreakdown:f(W),monthlyTrend:Object.values(Z).map(t=>({...t,customers:t.customers.size,avgDiscount:t.units>0?t.discountAmount/t.units:0,discountRate:t.revenue>0?t.discountAmount/t.revenue*100:0})).sort((t,n)=>t.monthKey.localeCompare(n.monthKey))}},[l]);if(!u)return null;const q=()=>e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(p,{className:"bg-gradient-to-br from-red-50 to-rose-50 border-red-200",children:e.jsxs(y,{className:"p-4 text-center",children:[e.jsx(ie,{className:"w-8 h-8 text-red-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-red-700",children:"Total Discount"}),e.jsx("p",{className:"text-xl font-bold text-red-800",children:r(u.summary.totalDiscount)})]})}),e.jsx(p,{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200",children:e.jsxs(y,{className:"p-4 text-center",children:[e.jsx(B,{className:"w-8 h-8 text-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-blue-700",children:"Units Sold"}),e.jsx("p",{className:"text-xl font-bold text-blue-800",children:m(u.summary.totalUnits)})]})}),e.jsx(p,{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-green-200",children:e.jsxs(y,{className:"p-4 text-center",children:[e.jsx(me,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-green-700",children:"Revenue"}),e.jsx("p",{className:"text-xl font-bold text-green-800",children:r(u.summary.totalRevenue)})]})}),e.jsx(p,{className:"bg-gradient-to-br from-purple-50 to-violet-50 border-purple-200",children:e.jsxs(y,{className:"p-4 text-center",children:[e.jsx(T,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-purple-700",children:"Customers"}),e.jsx("p",{className:"text-xl font-bold text-purple-800",children:m(u.summary.uniqueCustomers)})]})})]}),D=()=>{switch(A){case"categories":return e.jsx(N,{width:"100%",height:300,children:e.jsxs(ce,{data:u.categoryBreakdown.slice(0,10),children:[e.jsx(P,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"name"}),e.jsx(L,{}),e.jsx(v,{formatter:a=>r(a)}),e.jsx($,{}),e.jsx(E,{dataKey:"discountAmount",fill:"#ef4444",name:"Discount Amount"}),e.jsx(E,{dataKey:"revenue",fill:"#10b981",name:"Revenue"})]})});case"monthly-trend":return e.jsx(N,{width:"100%",height:300,children:e.jsxs(he,{data:u.monthlyTrend,children:[e.jsx(P,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"month"}),e.jsx(L,{}),e.jsx(v,{formatter:a=>r(a)}),e.jsx($,{}),e.jsx(K,{type:"monotone",dataKey:"discountAmount",stroke:"#ef4444",name:"Discount Amount"}),e.jsx(K,{type:"monotone",dataKey:"revenue",stroke:"#10b981",name:"Revenue"})]})});case"payment-methods":return e.jsx(N,{width:"100%",height:300,children:e.jsxs(de,{children:[e.jsx(xe,{data:u.paymentBreakdown.slice(0,8),cx:"50%",cy:"50%",labelLine:!1,label:({name:a,percent:i})=>`${a} ${(i*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"discountAmount",children:u.paymentBreakdown.slice(0,8).map((a,i)=>e.jsx(ue,{fill:F[i%F.length]},`cell-${i}`))}),e.jsx(v,{formatter:a=>r(a)})]})});default:return null}},z=()=>{let a=[],i=[];switch(A){case"categories":a=u.categoryBreakdown,i=[{key:"name",label:"Category",icon:w},{key:"discountAmount",label:"Discount Amount",format:r},{key:"revenue",label:"Revenue",format:r},{key:"units",label:"Units Sold",format:m},{key:"customers",label:"Customers",format:m},{key:"discountRate",label:"Discount Rate",format:o=>`${o.toFixed(1)}%`}];break;case"product-discount":a=u.productBreakdown,i=[{key:"name",label:"Product",icon:w},{key:"discountAmount",label:"Discount Amount",format:r},{key:"revenue",label:"Revenue",format:r},{key:"units",label:"Units Sold",format:m},{key:"customers",label:"Customers",format:m},{key:"discountRate",label:"Discount Rate",format:o=>`${o.toFixed(1)}%`}];break;case"locations":a=u.locationBreakdown,i=[{key:"name",label:"Location",icon:M},{key:"discountAmount",label:"Discount Amount",format:r},{key:"revenue",label:"Revenue",format:r},{key:"units",label:"Units Sold",format:m},{key:"customers",label:"Customers",format:m},{key:"discountRate",label:"Discount Rate",format:o=>`${o.toFixed(1)}%`}];break;case"location-discount":a=u.locationBreakdown,i=[{key:"name",label:"Location",icon:M},{key:"discountAmount",label:"Discount Amount",format:r},{key:"revenue",label:"Revenue",format:r},{key:"units",label:"Units Sold",format:m},{key:"customers",label:"Customers",format:m},{key:"discountRate",label:"Discount Rate",format:o=>`${o.toFixed(1)}%`}];break;case"payment-methods":a=u.paymentBreakdown,i=[{key:"name",label:"Payment Method",icon:ye},{key:"discountAmount",label:"Discount Amount",format:r},{key:"revenue",label:"Revenue",format:r},{key:"units",label:"Units Sold",format:m},{key:"customers",label:"Customers",format:m},{key:"discountRate",label:"Discount Rate",format:o=>`${o.toFixed(1)}%`}];break;case"staff-discount":a=u.staffBreakdown,i=[{key:"name",label:"Staff",icon:T},{key:"discountAmount",label:"Discount Amount",format:r},{key:"revenue",label:"Revenue",format:r},{key:"units",label:"Units Sold",format:m},{key:"customers",label:"Customers",format:m},{key:"discountRate",label:"Discount Rate",format:o=>`${o.toFixed(1)}%`}];break;case"monthly-trend":a=u.monthlyTrend,i=[{key:"month",label:"Month",icon:pe},{key:"discountAmount",label:"Discount Amount",format:r},{key:"revenue",label:"Revenue",format:r},{key:"units",label:"Units Sold",format:m},{key:"customers",label:"Customers",format:m},{key:"discountRate",label:"Discount Rate",format:o=>`${o.toFixed(1)}%`}];break;default:return null}return e.jsxs(p,{children:[e.jsx(k,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"Detailed Breakdown"]})}),e.jsx(y,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(C,{children:[e.jsx(R,{children:e.jsx(j,{children:i.map(o=>e.jsx(c,{className:"font-semibold",children:e.jsxs("div",{className:"flex items-center gap-2",children:[o.icon&&e.jsx(o.icon,{className:"w-4 h-4"}),o.label]})},o.key))})}),e.jsx(S,{children:a.slice(0,20).map((o,b)=>e.jsx(j,{className:"hover:bg-gray-50 max-h-[35px]",children:i.map(x=>e.jsx(d,{className:"py-2 max-h-[35px]",children:e.jsx("span",{className:"truncate block text-sm",children:x.format?x.format(o[x.key]):o[x.key]})},x.key))},b))})]})})})]})},Y=()=>e.jsxs(p,{children:[e.jsx(k,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"Individual Transactions (",m(Math.min(l.length,50)),")"]})}),e.jsxs(y,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(C,{children:[e.jsx(R,{children:e.jsxs(j,{children:[e.jsx(c,{children:"Date"}),e.jsx(c,{children:"Customer"}),e.jsx(c,{children:"Product"}),e.jsx(c,{className:"text-right",children:"MRP"}),e.jsx(c,{className:"text-right",children:"Discount"}),e.jsx(c,{className:"text-right",children:"Discount %"}),e.jsx(c,{className:"text-right",children:"Paid"}),e.jsx(c,{children:"Location"})]})}),e.jsx(S,{children:l.slice(0,50).map((a,i)=>e.jsxs(j,{className:"hover:bg-gray-50 max-h-[35px]",children:[e.jsx(d,{className:"py-2 max-h-[35px]",children:e.jsx("span",{className:"text-sm truncate block",children:new Date(a.paymentDate).toLocaleDateString()})}),e.jsx(d,{className:"py-2 max-h-[35px]",children:e.jsxs("div",{className:"truncate",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:a.customerName}),e.jsx("div",{className:"text-xs text-slate-500 truncate",children:a.customerEmail})]})}),e.jsx(d,{className:"py-2 max-h-[35px]",children:e.jsxs("div",{className:"truncate",children:[e.jsx("div",{className:"text-sm truncate",children:a.cleanedProduct}),e.jsx("div",{className:"text-xs text-slate-500 truncate",children:a.cleanedCategory})]})}),e.jsx(d,{className:"text-right py-2 max-h-[35px]",children:e.jsx("span",{className:"text-sm truncate block",children:r(a.mrpPostTax||a.mrpPreTax||0)})}),e.jsx(d,{className:"text-right py-2 max-h-[35px]",children:e.jsxs("span",{className:"text-sm font-semibold text-red-600 truncate block",children:["-",r(a.discountAmount||0)]})}),e.jsx(d,{className:"text-right py-2 max-h-[35px]",children:e.jsx(oe,{variant:"outline",className:"text-xs h-6 px-2",children:re(a.discountPercentage||0)})}),e.jsx(d,{className:"text-right py-2 max-h-[35px]",children:e.jsx("span",{className:"text-sm font-semibold text-green-600 truncate block",children:r(a.paymentValue||0)})}),e.jsx(d,{className:"py-2 max-h-[35px]",children:e.jsx("span",{className:"text-xs text-slate-600 truncate block",children:a.calculatedLocation})})]},i))})]})}),l.length>50&&e.jsxs("p",{className:"text-sm text-slate-500 mt-2 text-center",children:["Showing first 50 of ",m(l.length)," transactions"]})]})]});return e.jsx(te,{open:V,onOpenChange:O,children:e.jsxs(se,{className:"max-w-6xl max-h-[90vh]",children:[e.jsx(ne,{children:e.jsxs(ae,{className:"text-xl font-bold text-gray-900",children:[H," - Detailed Analysis"]})}),e.jsx(le,{className:"max-h-[calc(90vh-120px)]",children:e.jsxs("div",{className:"space-y-6 pr-4",children:[q(),D()&&e.jsxs(p,{children:[e.jsx(k,{children:e.jsx(g,{children:"Visual Analysis"})}),e.jsx(y,{children:D()})]}),z(),Y()]})})]})})};export{Ue as DiscountDrillDownModal};
//# sourceMappingURL=DiscountDrillDownModal-CYZm5OsU.js.map
