import{i as He,r as D,j as e,C as X,c as _,B as q,a as ee,b as te,S as Ie,h as H,T as Ce,f as Ue,w as De,p as he,m as ze,D as Ke,n as Be,o as Oe,q as Ye,s as Ge,d as We,u as qe,v as Qe}from"./index-Bm67KBkU.js";import{u as Je}from"./useNewClientData-Dl1VV2C_.js";import{u as Xe}from"./useSessionsData-CuS9CUZY.js";import{u as _e}from"./usePayrollData-DIt-ymzP.js";import{F as Ze}from"./footer-BTvMjyAb.js";import{M as ye,S as et}from"./StudioLocationTabs-BSKYatd_.js";import{A as tt}from"./AdvancedExportButton-kiFhlv4f.js";import{D as st}from"./DashboardMotionHero-C2yuh4RF.js";import{B as K,a as R,f as $,b as ne}from"./index-DkD_C-d1.js";import{F as Te,C as nt,I as be}from"./select-CM-Birqk.js";import{D as rt}from"./date-picker-CiBjbuX1.js";import{U as se}from"./users-7Ku-1TDB.js";import{T as Ae}from"./target-BmxdxojS.js";import{C as at}from"./credit-card-yR0Iskrq.js";import{C as it}from"./chevron-right-CbIMR3DA.js";import{R as ot}from"./rotate-ccw-DYMOD-zv.js";import{C as oe,T as xe}from"./googleAuth-BGo8ElRc.js";import{D as pe,C as we}from"./dollar-sign-CKqx8kbC.js";import{C as lt,a as ct}from"./ClientRetentionMonthByTypePivot-BWm8vzsu.js";import{T as ke}from"./trophy-ChiyFqMe.js";import{C as Se}from"./crown-Bf6tWe5C.js";import{E as dt,D as mt,S as Re}from"./SalesMotionHero-sGphstF2.js";import{A as Pe}from"./activity-CeUP9h5f.js";import{R as re,C as ht,T as ae,a as le,X as ce,Y as de,B as ve,b as me}from"./BarChart-o5Oeg9Jb.js";import{P as xt,a as pt}from"./PieChart-slnvMcDg.js";import{A as ut,a as gt}from"./AreaChart-DQtaPzLK.js";import{L as bt,a as Me}from"./LineChart-BWKGpJsm.js";import{U as $e}from"./user-check-CLHYCjic.js";import{T as vt,a as ft,b as fe,c as Z,d as yt,e as W}from"./table-DhXofKdS.js";import{C as je}from"./CopyTableButton-Blm2CDq4.js";import{A as wt}from"./arrow-up-down-DaenedAL.js";import{M as Ne}from"./ModernDataTable-Qj0casC7.js";import{A as jt}from"./award-D0x2LQSI.js";import{D as Le}from"./dumbbell-reskvc3q.js";import{u as Nt}from"./useRegisterTableForCopy-Dn-WXpBr.js";import Ve from"./html2canvas.esm-B1qvvRu6.js";import{E as Ct}from"./useAdvancedExport-luHYyrc4.js";import{F as Tt}from"./file-text-DChZNHsM.js";import{M as kt,b as St}from"./ModalSuspense-C3SPWsdX.js";import{S as Rt}from"./SectionTimelineNav-aY20sFWr.js";import"./label-fD3fdNwH.js";import"./checkbox-ByePFv7I.js";import"./BrandSpinner-CGFi2e0U.js";import"./index-BdQq_4o_.js";import"./useLeadsData-nt_JwR0P.js";import"./user-plus-B5fZWJk_.js";import"./trending-down-B5K1omnR.js";import"./dropdown-menu-B9zQ9u84.js";import"./tableStyles-BJWvDwDQ.js";import"./loader-circle-Bc3-I9bA.js";const Mt=He("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Lt=({filters:C,onFiltersChange:A,locations:E,trainers:I,membershipTypes:V})=>{const[x,L]=D.useState(!1),[N,P]=D.useState(""),U=(n,l)=>{const u=[...C[n]],i=u.includes(l)?u.filter(t=>t!==l):[...u,l];A({...C,[n]:i})},f=n=>{const l=u=>{const i=u.getFullYear(),t=String(u.getMonth()+1).padStart(2,"0"),s=String(u.getDate()).padStart(2,"0");return`${i}-${t}-${s}`};A({...C,dateRange:{start:n.from?l(n.from):"",end:n.to?l(n.to):""}})},r=()=>{A({dateRange:{start:"",end:""},location:[],homeLocation:[],trainer:[],paymentMethod:[],retentionStatus:[],conversionStatus:[],isNew:[],minLTV:void 0,maxLTV:void 0}),P("")},c=C.location.length+C.trainer.length+C.retentionStatus.length+C.conversionStatus.length+C.paymentMethod.length+C.isNew.length+(C.dateRange.start||C.dateRange.end?1:0)+(C.minLTV?1:0)+(C.maxLTV?1:0),g=["Kwality House, Kemps Corner","Supreme HQ, Bandra","Kenkere House, Bengaluru"],T=E.filter(n=>g.includes(n)),m=[{title:"Location & Geography",icon:ye,filters:[{key:"location",label:"Visit Locations",options:T,values:C.location}]},{title:"Trainer & Service",icon:se,filters:[{key:"trainer",label:"Trainers",options:I.slice(0,12),values:C.trainer}]},{title:"Conversion & Status",icon:Ae,filters:[{key:"conversionStatus",label:"Conversion Status",options:["Converted","Not Converted","Pending"],values:C.conversionStatus},{key:"retentionStatus",label:"Retention Status",options:["Retained","Not Retained","At Risk"],values:C.retentionStatus},{key:"isNew",label:"Client Type",options:["New","Existing","Returning"],values:C.isNew}]},{title:"Payment & Membership",icon:at,filters:[{key:"paymentMethod",label:"Payment Methods",options:["Online","Cash","Card","UPI","Bank Transfer"],values:C.paymentMethod}]}];return x?e.jsxs(X,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-xl overflow-hidden",children:[e.jsx(ee,{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white",children:e.jsxs(te,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Te,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Advanced Client Filters"}),e.jsx("p",{className:"text-blue-100 text-sm",children:"Customize your analysis view"})]}),e.jsxs(K,{className:"bg-white/20 text-white border-white/30",children:[c," Active"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(q,{variant:"outline",size:"sm",onClick:r,disabled:c===0,className:"bg-white/10 border-white/30 text-white hover:bg-white/20",children:[e.jsx(ot,{className:"w-4 h-4 mr-1"}),"Reset"]}),e.jsx(q,{variant:"ghost",size:"sm",onClick:()=>L(!1),className:"text-white hover:bg-white/20",children:e.jsx(nt,{className:"w-4 h-4"})})]})]})}),e.jsxs(_,{className:"p-8 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-blue-600"}),"Date Range"]}),e.jsx(rt,{value:{from:C.dateRange.start?new Date(C.dateRange.start):void 0,to:C.dateRange.end?new Date(C.dateRange.end):void 0},onChange:f})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-blue-600"}),"Quick Search"]}),e.jsx(be,{placeholder:"Search trainers, locations...",value:N,onChange:n=>P(n.target.value),className:"bg-white border-slate-200"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-blue-600"}),"Lifetime Value Range"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(be,{type:"number",placeholder:"Min LTV (₹)",value:C.minLTV||"",onChange:n=>A({...C,minLTV:n.target.value?parseFloat(n.target.value):void 0}),className:"bg-white border-slate-200"}),e.jsx(be,{type:"number",placeholder:"Max LTV (₹)",value:C.maxLTV||"",onChange:n=>A({...C,maxLTV:n.target.value?parseFloat(n.target.value):void 0}),className:"bg-white border-slate-200"})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:m.map(n=>e.jsxs(X,{className:"bg-white/70 border-slate-200 shadow-lg",children:[e.jsx(ee,{className:"pb-4",children:e.jsxs(te,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(n.icon,{className:"w-5 h-5 text-blue-600"}),n.title]})}),e.jsx(_,{className:"space-y-4",children:n.filters.map(l=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-medium text-slate-700",children:[l.label,l.values.length>0&&e.jsxs(K,{variant:"secondary",className:"ml-2 text-xs bg-blue-100 text-blue-700",children:[l.values.length," selected"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto",children:l.options.filter(u=>!N||u.toLowerCase().includes(N.toLowerCase())).map(u=>e.jsx(q,{variant:l.values.includes(u)?"default":"outline",size:"sm",onClick:()=>U(l.key,u),className:`text-xs transition-all duration-200 ${l.values.includes(u)?"bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-md":"hover:bg-blue-50 border-slate-200 hover:border-blue-300"}`,children:u},u))})]},l.key))})]},n.title))})]})]}):e.jsx(X,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-xl",children:e.jsx(_,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg",children:e.jsx(Te,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-800",children:"Advanced Filters"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Refine your client analysis"})]}),c>0&&e.jsxs(K,{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white",children:[c," active"]})]}),e.jsxs(q,{variant:"outline",onClick:()=>L(!0),className:"gap-2 border-blue-200 text-blue-700 hover:bg-blue-50",children:[e.jsx(it,{className:"w-4 h-4"}),"Expand Filters"]})]})})})},Vt=({data:C,payrollData:A,allPayrollData:E,allClientData:I,selectedLocation:V,dateRange:x,selectedMetric:L,onDrillDown:N})=>{const[P,U]=D.useState("trainer-conversion"),f=H.useMemo(()=>{const t=new Map;return A.forEach(s=>{const h=s.teacherName;if(!h||h==="Unknown")return;t.has(h)||t.set(h,{name:h,totalSessions:0,totalEmptySessions:0,totalNonEmptySessions:0,totalCustomers:0,totalConverted:0,totalRetained:0,totalNew:0,totalLTV:0,clientCount:0});const d=t.get(h);d.totalSessions+=s.totalSessions||0,d.totalEmptySessions+=s.totalEmptySessions||0,d.totalNonEmptySessions+=s.totalNonEmptySessions||0,d.totalCustomers+=s.totalCustomers||0,d.totalConverted+=s.converted||0,d.totalRetained+=s.retained||0,d.totalNew+=s.new||0}),C.forEach(s=>{const h=s.trainerName;if(!h||h==="Unknown"||!t.has(h))return;const d=t.get(h);d.totalLTV+=s.ltv||0,d.clientCount++}),Array.from(t.values()).map(s=>{const h=s.totalNew>0?s.totalConverted/s.totalNew*100:0,d=s.totalNew>0?s.totalRetained/s.totalNew*100:0,b=s.totalNonEmptySessions>0?s.totalCustomers/s.totalNonEmptySessions:0,p=s.clientCount>0?s.totalLTV/s.clientCount:0,v=s.totalSessions>0?s.totalEmptySessions/s.totalSessions*100:0;return{...s,conversionRate:h,retentionRate:d,classAverage:b,avgLTV:p,emptyClassRate:v,totalClients:s.clientCount}}).filter(s=>s.totalSessions>0)},[C,A]),r=H.useMemo(()=>{const t=new Map;return A.forEach(s=>{const h=s.location;if(!h||h==="Unknown")return;t.has(h)||t.set(h,{name:h,totalSessions:0,totalEmptySessions:0,totalNonEmptySessions:0,totalCustomers:0,totalConverted:0,totalRetained:0,totalNew:0,totalLTV:0,clientCount:0});const d=t.get(h);d.totalSessions+=s.totalSessions||0,d.totalEmptySessions+=s.totalEmptySessions||0,d.totalNonEmptySessions+=s.totalNonEmptySessions||0,d.totalCustomers+=s.totalCustomers||0,d.totalConverted+=s.converted||0,d.totalRetained+=s.retained||0,d.totalNew+=s.new||0}),C.forEach(s=>{const h=s.firstVisitLocation||s.homeLocation;if(!h||h==="Unknown"||!t.has(h))return;const d=t.get(h);d.totalLTV+=s.ltv||0,d.clientCount++}),Array.from(t.values()).map(s=>{const h=s.totalNew>0?s.totalConverted/s.totalNew*100:0,d=s.totalNew>0?s.totalRetained/s.totalNew*100:0,b=s.totalNonEmptySessions>0?s.totalCustomers/s.totalNonEmptySessions:0,p=s.clientCount>0?s.totalLTV/s.clientCount:0,v=s.totalSessions>0?s.totalEmptySessions/s.totalSessions*100:0;return{...s,conversionRate:h,retentionRate:d,classAverage:b,avgLTV:p,emptyClassRate:v,totalClients:s.clientCount}}).filter(s=>s.totalSessions>0)},[C,A]),c=H.useMemo(()=>{const t=new Map;return C.forEach(s=>{const h=s.membershipUsed||"Unknown Membership";t.has(h)||t.set(h,{name:h,totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,avgVisits:0});const d=t.get(h);d.totalClients++,d.totalLTV+=s.ltv||0,d.avgVisits+=s.visitsPostTrial||0,(s.isNew||"").toLowerCase().includes("new")&&d.newMembers++,s.conversionStatus==="Converted"&&d.converted++,s.retentionStatus==="Retained"&&d.retained++}),Array.from(t.values()).map(s=>{const h=s.newMembers>0?s.converted/s.newMembers*100:0,d=s.newMembers>0?s.retained/s.newMembers*100:0,b=s.totalClients>0?s.totalLTV/s.totalClients:0,p=s.totalClients>0?s.avgVisits/s.totalClients:0;return{...s,conversionRate:h,retentionRate:d,avgLTV:b,avgVisitsPerClient:p}}).filter(s=>s.totalClients>=5)},[C]),g=[{id:"trainer-conversion",label:"Trainer Conversion Rate",icon:ke,type:"trainer",metric:"conversionRate"},{id:"trainer-classes",label:"Classes Taught",icon:oe,type:"trainer",metric:"totalSessions"},{id:"trainer-average",label:"Class Average",icon:se,type:"trainer",metric:"classAverage"},{id:"trainer-empty",label:"Empty Classes %",icon:Ce,type:"trainer",metric:"emptyClassRate"},{id:"location-conversion",label:"Location Conversion",icon:ye,type:"location",metric:"conversionRate"},{id:"location-classes",label:"Location Classes",icon:oe,type:"location",metric:"totalSessions"},{id:"location-average",label:"Location Class Average",icon:se,type:"location",metric:"classAverage"},{id:"membership-conversion",label:"Membership Conversion",icon:Se,type:"membership",metric:"conversionRate"},{id:"membership-ltv",label:"Membership LTV",icon:pe,type:"membership",metric:"avgLTV"}],T=()=>{const t=g.find(p=>p.id===P);if(!t)return{top:[],bottom:[]};let s;switch(t.type){case"trainer":s=f;break;case"location":s=r;break;case"membership":s=c;break;default:s=f}const h=t.type==="trainer"?3:1,b=[...s.filter(p=>t.metric==="totalSessions"||t.metric==="classAverage"||t.metric==="emptyClassRate"?p.totalSessions>=5:t.metric==="conversionRate"||t.metric==="retentionRate"?p.totalNew>=h:p.totalClients>=1||p.clientCount>=1)].sort((p,v)=>{const w=p[t.metric]||0;return(v[t.metric]||0)-w});return{top:b.slice(0,5),bottom:b.slice(-5).reverse()}},{top:m,bottom:n}=T(),l=g.find(t=>t.id===P),u=(t,s)=>s==="avgLTV"?$(t):s==="totalSessions"?R(t):s==="totalClients"||s==="clientCount"?R(t):s==="classAverage"||s==="avgVisitsPerClient"?t.toFixed(1):`${t.toFixed(1)}%`,i=({title:t,data:s,isTop:h=!0})=>e.jsxs(X,{className:"bg-gradient-to-br from-white via-slate-50/50 to-white border-0 shadow-xl hover:shadow-2xl transition-all duration-500",children:[e.jsx(ee,{className:"pb-4",children:e.jsx(te,{className:"flex items-center gap-3 text-xl",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500",children:e.jsx(Se,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("span",{className:"bg-gradient-to-r from-yellow-600 to-orange-600 bg-clip-text text-transparent",children:t}),e.jsx("p",{className:"text-sm text-slate-600 font-normal",children:"Top performers"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-r from-red-400 to-rose-500",children:e.jsx(Ce,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("span",{className:"bg-gradient-to-r from-red-600 to-rose-600 bg-clip-text text-transparent",children:t}),e.jsx("p",{className:"text-sm text-slate-600 font-normal",children:"Areas for improvement"})]})]})})}),e.jsx(_,{className:"space-y-4",children:s.map((d,b)=>e.jsxs("div",{className:"group flex items-center justify-between p-4 rounded-xl bg-white shadow-sm border hover:shadow-md transition-all duration-300 cursor-pointer",onClick:()=>{if(N&&l){const p=l.type==="trainer"?"trainer":l.type==="location"?"location":"membership";N(p,d,l.metric)}},children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:Ue("w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold shadow-sm",h?"bg-gradient-to-r from-green-400 to-emerald-600 text-white":"bg-gradient-to-r from-red-400 to-rose-600 text-white"),children:b+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-slate-900 whitespace-normal break-words group-hover:text-blue-600 transition-colors",children:d.name}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsxs(K,{variant:"secondary",className:"text-xs bg-blue-50 text-blue-700 border-blue-200",children:[R(d.totalClients||d.clientCount||0)," clients"]}),l?.type==="trainer"&&e.jsxs(e.Fragment,{children:[e.jsxs(K,{variant:"outline",className:"text-xs border-purple-200 text-purple-700",children:[R(d.totalSessions||0)," classes"]}),e.jsxs(K,{variant:"outline",className:"text-xs border-slate-200 text-slate-700",children:["Empty: ",R(d.totalEmptySessions||0)]}),e.jsxs(K,{variant:"outline",className:"text-xs border-green-200 text-green-700",children:["Avg: ",(d.classAverage||0).toFixed(1)]}),e.jsxs(K,{variant:"outline",className:"text-xs border-orange-200 text-orange-700",children:["Empty: ",(d.emptyClassRate||0).toFixed(1),"%"]}),e.jsxs(K,{variant:"outline",className:"text-xs border-emerald-200 text-emerald-700",children:["Converted: ",R(d.totalConverted||0)]}),e.jsxs(K,{variant:"outline",className:"text-xs border-violet-200 text-violet-700",children:["Retained: ",R(d.totalRetained||0)]}),e.jsxs(K,{variant:"outline",className:"text-xs border-blue-200 text-blue-700",children:["New: ",R(d.totalNew||0)]})]}),l?.type==="location"&&e.jsxs(e.Fragment,{children:[e.jsxs(K,{variant:"outline",className:"text-xs border-purple-200 text-purple-700",children:[R(d.totalSessions||0)," classes"]}),e.jsxs(K,{variant:"outline",className:"text-xs border-green-200 text-green-700",children:["Avg: ",(d.classAverage||0).toFixed(1)]}),e.jsxs(K,{variant:"outline",className:"text-xs border-slate-200 text-slate-700",children:["Empty: ",R(d.totalEmptySessions||0)]}),e.jsxs(K,{variant:"outline",className:"text-xs border-emerald-200 text-emerald-700",children:["Converted: ",R(d.totalConverted||0)]}),e.jsxs(K,{variant:"outline",className:"text-xs border-violet-200 text-violet-700",children:["Retained: ",R(d.totalRetained||0)]}),e.jsxs(K,{variant:"outline",className:"text-xs border-blue-200 text-blue-700",children:["New: ",R(d.totalNew||0)]})]}),l?.type==="membership"&&e.jsxs(e.Fragment,{children:[e.jsxs(K,{variant:"outline",className:"text-xs border-green-200 text-green-700",children:["Avg LTV: ",$(d.avgLTV||0)]}),e.jsxs(K,{variant:"outline",className:"text-xs border-blue-200 text-blue-700",children:["Total: ",$(d.totalLTV||0)]}),e.jsxs(K,{variant:"outline",className:"text-xs border-orange-200 text-orange-700",children:["Visits: ",(d.avgVisitsPerClient||0).toFixed(1)]})]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-xl text-slate-900 group-hover:text-blue-600 transition-colors",children:u(d[l?.metric||"conversionRate"],l?.metric||"conversionRate")}),e.jsx("p",{className:"text-sm text-slate-500",children:l?.metric==="totalSessions"?"Total Classes":l?.metric==="classAverage"?"Class Average":l?.metric==="emptyClassRate"?"Empty Rate":l?.metric==="avgLTV"?"Avg LTV":"Conversion Rate"}),e.jsx("p",{className:"text-xs text-slate-400",children:l?.type==="trainer"?"Trainer Performance":l?.type==="location"?"Location Performance":"Membership Performance"}),e.jsxs(q,{variant:"ghost",size:"sm",className:"mt-1 opacity-0 group-hover:opacity-100 transition-all duration-300 hover:bg-blue-50 hover:text-blue-600 hover:shadow-sm",onClick:p=>{if(p.stopPropagation(),N&&l){const v=l.type==="trainer"?"trainer":l.type==="location"?"location":"membership";N(v,d,l.metric)}},children:[e.jsx(dt,{className:"w-3 h-3 mr-1"}),"View Analytics"]})]})]},d.name))})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{className:"bg-white shadow-lg border-0",children:[e.jsx(ee,{children:e.jsxs(te,{className:"flex items-center gap-3 text-slate-800",children:[e.jsx(ke,{className:"w-6 h-6 text-yellow-600"}),"Performance Rankings"]})}),e.jsx(_,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3",children:g.map(t=>e.jsxs(q,{variant:P===t.id?"default":"ghost",size:"sm",onClick:()=>U(t.id),className:`flex flex-col items-center gap-2 h-auto py-3 px-2 transition-all duration-300 hover:scale-105 ${P===t.id?"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg":"hover:bg-slate-100"}`,children:[e.jsx(t.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:t.label})]},t.id))})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(i,{title:`Top ${l?.label||"Performance"}`,data:m,isTop:!0}),e.jsx(i,{title:`Bottom ${l?.label||"Performance"}`,data:n,isTop:!1})]})]})},Dt=({data:C})=>{const[A,E]=D.useState("monthly-trends"),I=[{id:"monthly-trends",label:"Monthly Trends",icon:xe,type:"line"},{id:"conversion-funnel",label:"Conversion Funnel",icon:Ae,type:"bar"},{id:"location-performance",label:"Location Performance",icon:ye,type:"bar"},{id:"trainer-performance",label:"Trainer Performance",icon:se,type:"bar"},{id:"retention-analysis",label:"Retention Analysis",icon:Pe,type:"area"},{id:"ltv-distribution",label:"LTV Distribution",icon:pe,type:"pie"}],V=H.useMemo(()=>{const f=new Map;return C.forEach(r=>{if(!r.firstVisitDate)return;let c;if(r.firstVisitDate.includes("/")){const[m,n,l]=r.firstVisitDate.split(" ")[0].split("/");c=new Date(parseInt(l),parseInt(n)-1,parseInt(m))}else c=new Date(r.firstVisitDate);if(isNaN(c.getTime()))return;const g=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`;f.has(g)||f.set(g,{month:g,newMembers:0,converted:0,retained:0,revenue:0});const T=f.get(g);String(r.isNew||"").includes("New")&&T.newMembers++,r.conversionStatus==="Converted"&&T.converted++,r.retentionStatus==="Retained"&&T.retained++,T.revenue+=r.ltv||0}),Array.from(f.values()).sort((r,c)=>r.month.localeCompare(c.month)).map(r=>({...r,conversionRate:r.newMembers>0?r.converted/r.newMembers*100:0,retentionRate:r.converted>0?r.retained/r.converted*100:0}))},[C]),x=H.useMemo(()=>{const f=new Map;return C.forEach(r=>{const c=r.firstVisitLocation||r.homeLocation||"Unknown";f.has(c)||f.set(c,{location:c,newMembers:0,converted:0,retained:0,revenue:0});const g=f.get(c);String(r.isNew||"").includes("New")&&g.newMembers++,r.conversionStatus==="Converted"&&g.converted++,r.retentionStatus==="Retained"&&g.retained++,g.revenue+=r.ltv||0}),Array.from(f.values()).map(r=>({...r,conversionRate:r.newMembers>0?r.converted/r.newMembers*100:0,retentionRate:r.converted>0?r.retained/r.converted*100:0})).sort((r,c)=>c.revenue-r.revenue)},[C]),L=H.useMemo(()=>{const f=new Map;return C.forEach(r=>{const c=r.trainerName||"Unknown";f.has(c)||f.set(c,{trainer:c,newMembers:0,converted:0,retained:0,revenue:0});const g=f.get(c);String(r.isNew||"").includes("New")&&g.newMembers++,r.conversionStatus==="Converted"&&g.converted++,r.retentionStatus==="Retained"&&g.retained++,g.revenue+=r.ltv||0}),Array.from(f.values()).filter(r=>r.newMembers>=3).map(r=>({...r,conversionRate:r.newMembers>0?r.converted/r.newMembers*100:0,retentionRate:r.converted>0?r.retained/r.converted*100:0})).sort((r,c)=>c.conversionRate-r.conversionRate).slice(0,10)},[C]),N=H.useMemo(()=>{const f=[{name:"₹0-5K",min:0,max:5e3,count:0,color:"#ef4444"},{name:"₹5K-15K",min:5e3,max:15e3,count:0,color:"#f97316"},{name:"₹15K-30K",min:15e3,max:3e4,count:0,color:"#eab308"},{name:"₹30K-50K",min:3e4,max:5e4,count:0,color:"#22c55e"},{name:"₹50K+",min:5e4,max:1/0,count:0,color:"#3b82f6"}];return C.forEach(r=>{const c=r.ltv||0,g=f.find(T=>c>=T.min&&c<T.max);g&&g.count++}),f.filter(r=>r.count>0)},[C]),P=()=>{switch(I.find(f=>f.id===A),A){case"monthly-trends":return e.jsx(re,{width:"100%",height:400,children:e.jsxs(bt,{data:V,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(le,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(ce,{dataKey:"month",stroke:"#64748b",fontSize:12,tickFormatter:r=>{const[c,g]=r.split("-");return`${g}/${c.slice(2)}`}}),e.jsx(de,{stroke:"#64748b",fontSize:12}),e.jsx(ae,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(r,c)=>[c.includes("Rate")?`${r.toFixed(1)}%`:R(r),c]}),e.jsx(Me,{type:"monotone",dataKey:"newMembers",stroke:"#3b82f6",strokeWidth:3,dot:{fill:"#3b82f6",strokeWidth:2,r:6},name:"New Members"}),e.jsx(Me,{type:"monotone",dataKey:"conversionRate",stroke:"#22c55e",strokeWidth:3,dot:{fill:"#22c55e",strokeWidth:2,r:6},name:"Conversion Rate"})]})});case"conversion-funnel":const f=[{name:"New Members",value:C.filter(r=>String(r.isNew||"").includes("New")).length,color:"#3b82f6"},{name:"Trials Completed",value:C.filter(r=>(r.visitsPostTrial||0)>0).length,color:"#8b5cf6"},{name:"Converted",value:C.filter(r=>r.conversionStatus==="Converted").length,color:"#22c55e"},{name:"Retained",value:C.filter(r=>r.retentionStatus==="Retained").length,color:"#f97316"}];return e.jsx(re,{width:"100%",height:400,children:e.jsxs(ve,{data:f,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(le,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(ce,{dataKey:"name",stroke:"#64748b",fontSize:12}),e.jsx(de,{stroke:"#64748b",fontSize:12}),e.jsx(ae,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:r=>[R(r),"Count"]}),e.jsx(me,{dataKey:"value",fill:"#3b82f6",radius:[4,4,0,0]})]})});case"location-performance":return e.jsx(re,{width:"100%",height:400,children:e.jsxs(ve,{data:x,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(le,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(ce,{dataKey:"location",stroke:"#64748b",fontSize:12,angle:-45,textAnchor:"end",height:80,tickFormatter:r=>r.length>15?`${r.slice(0,15)}...`:r}),e.jsx(de,{stroke:"#64748b",fontSize:12}),e.jsx(ae,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(r,c)=>[c.includes("Rate")?`${r.toFixed(1)}%`:R(r),c]}),e.jsx(me,{dataKey:"conversionRate",fill:"#22c55e",radius:[4,4,0,0],name:"Conversion Rate"})]})});case"trainer-performance":return e.jsx(re,{width:"100%",height:400,children:e.jsxs(ve,{data:L,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(le,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(ce,{dataKey:"trainer",stroke:"#64748b",fontSize:12,angle:-45,textAnchor:"end",height:80,tickFormatter:r=>r.length>10?`${r.slice(0,10)}...`:r}),e.jsx(de,{stroke:"#64748b",fontSize:12}),e.jsx(ae,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(r,c)=>[c.includes("Rate")?`${r.toFixed(1)}%`:R(r),c]}),e.jsx(me,{dataKey:"conversionRate",fill:"#8b5cf6",radius:[4,4,0,0],name:"Conversion Rate"}),e.jsx(me,{dataKey:"retentionRate",fill:"#06b6d4",radius:[4,4,0,0],name:"Retention Rate"})]})});case"retention-analysis":return e.jsx(re,{width:"100%",height:400,children:e.jsxs(ut,{data:V,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(le,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(ce,{dataKey:"month",stroke:"#64748b",fontSize:12,tickFormatter:r=>{const[c,g]=r.split("-");return`${g}/${c.slice(2)}`}}),e.jsx(de,{stroke:"#64748b",fontSize:12}),e.jsx(ae,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(r,c)=>[c.includes("Rate")?`${r.toFixed(1)}%`:R(r),c]}),e.jsx(gt,{type:"monotone",dataKey:"retentionRate",stackId:"1",stroke:"#f97316",fill:"url(#retentionGradient)",name:"Retention Rate"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"retentionGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#f97316",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#f97316",stopOpacity:.1})]})})]})});case"ltv-distribution":return e.jsx(re,{width:"100%",height:400,children:e.jsxs(xt,{children:[e.jsx(pt,{data:N,cx:"50%",cy:"50%",outerRadius:150,fill:"#8884d8",dataKey:"count",label:({name:r,percent:c})=>`${r} (${(c*100).toFixed(1)}%)`,children:N.map((r,c)=>e.jsx(ht,{fill:r.color},`cell-${c}`))}),e.jsx(ae,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:r=>[R(r),"Clients"]})]})});default:return null}},U=I.find(f=>f.id===A);return e.jsxs(X,{className:"bg-white shadow-lg border-0 overflow-hidden",children:[e.jsx(ee,{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:e.jsxs(te,{className:"flex items-center gap-3",children:[e.jsx(we,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-sm opacity-90",children:"Interactive charts and visualizations"})]})]})}),e.jsxs(_,{className:"p-6",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 mb-6",children:I.map(f=>e.jsxs(q,{variant:A===f.id?"default":"ghost",size:"sm",onClick:()=>E(f.id),className:`flex flex-col items-center gap-2 h-auto py-4 px-3 transition-all duration-300 hover:scale-105 ${A===f.id?"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg":"hover:bg-slate-100"}`,children:[e.jsx(f.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:f.label})]},f.id))}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[U&&e.jsx(U.icon,{className:"w-5 h-5 text-slate-600"}),e.jsx("h4",{className:"text-lg font-semibold text-slate-800",children:U?.label})]}),e.jsxs(K,{className:"bg-blue-100 text-blue-800",children:[C.length," records"]})]}),P()]})]})]})},At=({activeTable:C,onTableChange:A,dataLength:E})=>{const I=[{key:"monthonmonthbytype",label:"By Client Type",description:"Monthly breakdown by client type",icon:se,gradient:"from-purple-500 to-pink-600"},{key:"monthonmonth",label:"Month on Month",description:"Monthly trends and comparisons",icon:oe,gradient:"from-blue-500 to-indigo-600"},{key:"yearonyear",label:"Year on Year",description:"Annual performance comparison",icon:xe,gradient:"from-green-500 to-emerald-600"},{key:"hostedclasses",label:"Hosted Classes",description:"Class performance metrics",icon:se,gradient:"from-purple-500 to-violet-600"},{key:"memberships",label:"Membership Analysis",description:"Membership type breakdown",icon:we,gradient:"from-orange-500 to-red-600"},{key:"teacherperformance",label:"Teacher Performance",description:"Trainer metrics and performance analysis",icon:$e,gradient:"from-teal-500 to-cyan-600"},{key:"newclientpurchases",label:"New Client Purchases",description:"Membership purchases by new clients with conversion metrics",icon:se,gradient:"from-indigo-500 to-purple-600"}];return e.jsxs("div",{className:"bg-gradient-to-r from-slate-50 to-gray-100 p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Data Analysis Tables"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Select a table to view detailed metrics"})]}),e.jsxs(K,{className:"bg-blue-100 text-blue-800 border-blue-200",children:[E," Records"]})]}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:I.map(V=>e.jsxs(q,{variant:C===V.key?"default":"outline",className:`h-16 px-3 py-2 flex items-center justify-center gap-2 transition-all duration-300 ${C===V.key?`bg-gradient-to-r ${V.gradient} text-white shadow-lg hover:shadow-xl`:"bg-white hover:bg-gray-50 border-gray-200 hover:border-gray-300"}`,onClick:()=>A(V.key),children:[e.jsx(V.icon,{className:`w-4 h-4 flex-shrink-0 ${C===V.key?"text-white":"text-gray-600"}`}),e.jsx("span",{className:`font-semibold text-xs text-center leading-tight ${C===V.key?"text-white":"text-gray-900"}`,children:V.label})]},V.key))})]})},Pt=({data:C,checkins:A,visitsSummary:E,onRowClick:I})=>{const V=D.useRef(null),x=De(),L="By Client Type",[N,P]=D.useState(void 0),[U,f]=D.useState("desc"),[r,c]=D.useState("clientType"),g=D.useMemo(()=>{if(!C||C.length===0)return[];const i={};return C.forEach(t=>{const s=he(t.firstVisitDate||"");if(!s)return;const h=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`,d=s.toLocaleDateString("en-US",{month:"short",year:"numeric"});let b;r==="clientType"?b=t.isNew||"Unknown":r==="membership"?b=t.membershipUsed||"Unknown":b=t.trainerName||"Unknown";const p=`${h}-${b}`;if(!i[p]){const[k,j]=h.split("-"),o=`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(j)-1]} ${k}`,y=E?.[o]||0;i[p]={month:d,sortKey:h,type:b,visits:y,totalTrials:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],visitsPostTrial:[],clients:[]}}const v=i[p];v.totalTrials++,v.clients.push(t),(t.isNew||"").toLowerCase().includes("new")&&v.newMembers++,t.conversionStatus==="Converted"&&v.converted++,t.retentionStatus==="Retained"&&v.retained++,v.totalLTV+=t.ltv||0,t.conversionSpan&&t.conversionSpan>0&&v.conversionIntervals.push(t.conversionSpan),t.visitsPostTrial&&t.visitsPostTrial>0&&v.visitsPostTrial.push(t.visitsPostTrial)}),Object.values(i).sort((t,s)=>{const h=t.sortKey.localeCompare(s.sortKey);if(h!==0)return h;if(r==="clientType"){if(t.type.toLowerCase().includes("new")&&!s.type.toLowerCase().includes("new"))return-1;if(!t.type.toLowerCase().includes("new")&&s.type.toLowerCase().includes("new"))return 1}return t.type.localeCompare(s.type)})},[C,A,E,r]),T=D.useMemo(()=>g.map(i=>{const t=i.newMembers>0?i.converted/i.newMembers*100:0,s=i.newMembers>0?i.retained/i.newMembers*100:0,h=i.totalTrials>0?i.totalLTV/i.totalTrials:0,d=i.conversionIntervals.length>0?i.conversionIntervals.reduce((p,v)=>p+v,0)/i.conversionIntervals.length:0,b=i.visitsPostTrial.length>0?i.visitsPostTrial.reduce((p,v)=>p+v,0)/i.visitsPostTrial.length:0;return{...i,conversionRate:t,retentionRate:s,avgLTV:h,avgConversionDays:d,avgVisits:b}}),[g]),m=D.useMemo(()=>N?[...T].sort((t,s)=>{const h=t[N],d=s[N],b=U==="asc"?1:-1;return typeof h=="number"&&typeof d=="number"?(h-d)*b:String(h??"").localeCompare(String(d??""))*b}):T,[T,N,U]),n=i=>{N===i?f(t=>t==="asc"?"desc":"asc"):(P(i),f("desc"))},l=D.useMemo(()=>T.reduce((i,t)=>({visits:i.visits+(t.visits||0),totalTrials:i.totalTrials+t.totalTrials,newMembers:i.newMembers+t.newMembers,converted:i.converted+t.converted,retained:i.retained+t.retained,totalLTV:i.totalLTV+t.totalLTV,conversionIntervals:[...i.conversionIntervals,...t.conversionIntervals],visitsPostTrial:[...i.visitsPostTrial,...t.visitsPostTrial]}),{visits:0,totalTrials:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],visitsPostTrial:[]}),[T]),u=D.useMemo(()=>{const i=l.newMembers>0?l.converted/l.newMembers*100:0,t=l.newMembers>0?l.retained/l.newMembers*100:0,s=l.totalTrials>0?l.totalLTV/l.totalTrials:0,h=l.conversionIntervals.length>0?l.conversionIntervals.reduce((b,p)=>b+p,0)/l.conversionIntervals.length:0,d=l.visitsPostTrial.length>0?l.visitsPostTrial.reduce((b,p)=>b+p,0)/l.visitsPostTrial.length:0;return{month:"TOTALS",type:"All Types",visits:l.visits,totalTrials:l.totalTrials,newMembers:l.newMembers,converted:l.converted,retained:l.retained,conversionRate:i,retentionRate:t,avgLTV:s,totalLTV:l.totalLTV,avgConversionDays:h,avgVisits:d}},[l]);return D.useEffect(()=>{if(!x)return;const i=V.current;if(!i)return;const t=()=>{const s=i.querySelector("table");if(!s)return`${L} (No Data)`;let h=`${L}
`;const d=s.querySelectorAll("thead th"),b=[];return d.forEach(v=>b.push((v.textContent||"").trim())),b.length&&(h+=b.join("	")+`
`,h+=b.map(()=>"---").join("	")+`
`),s.querySelectorAll("tbody tr").forEach(v=>{const w=v.querySelectorAll("td"),k=[];w.forEach(j=>k.push((j.textContent||"").trim())),k.length&&(h+=k.join("	")+`
`)}),h.trim()};return x.register({id:L,getTextContent:t}),()=>x.unregister(L)},[x,T]),e.jsxs(X,{ref:V,className:"bg-white shadow-lg border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx(ee,{className:"bg-gradient-to-r from-purple-900 via-purple-950 to-purple-900 text-white pb-4",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs(te,{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5"}),L,e.jsxs(K,{variant:"secondary",className:"ml-2 bg-white/20 text-white border-white/30",children:[g.length," Entries"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white/10 rounded-lg p-1",children:[e.jsx(q,{size:"sm",variant:"ghost",onClick:()=>c("clientType"),className:`min-w-[100px] ${r==="clientType"?"bg-gradient-to-r from-slate-700 to-slate-800 text-white":"text-white hover:bg-white/20"}`,children:"Client Type"}),e.jsx(q,{size:"sm",variant:"ghost",onClick:()=>c("membership"),className:`min-w-[100px] ${r==="membership"?"bg-gradient-to-r from-slate-700 to-slate-800 text-white":"text-white hover:bg-white/20"}`,children:"Membership"}),e.jsx(q,{size:"sm",variant:"ghost",onClick:()=>c("teacher"),className:`min-w-[100px] ${r==="teacher"?"bg-gradient-to-r from-slate-700 to-slate-800 text-white":"text-white hover:bg-white/20"}`,children:"Teacher"})]}),e.jsx(je,{tableRef:V,tableName:L,size:"sm",onCopyAllTabs:x?async()=>x.getAllTabsContent():void 0})]})]})}),e.jsx(_,{className:"p-0 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto max-h-[600px]",children:e.jsxs(vt,{className:"w-full",children:[e.jsx(ft,{className:"sticky top-0 z-20",children:e.jsxs(fe,{className:"bg-gradient-to-r from-purple-900 via-purple-950 to-purple-900 border-b",style:{maxHeight:"35px"},children:[e.jsx(Z,{onClick:()=>n("month"),className:"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-4 sticky left-0 z-10 bg-purple-950",style:{width:"300px",minWidth:"300px",maxHeight:"35px"},children:"Month"}),e.jsx(Z,{onClick:()=>n("type"),className:"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[200px]",style:{maxHeight:"35px"},children:r==="clientType"?"Type":r==="membership"?"Membership":"Teacher"}),e.jsx(Z,{onClick:()=>n("totalTrials"),className:"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Trials"}),e.jsx(Z,{onClick:()=>n("newMembers"),className:"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[90px]",children:"New Members"}),e.jsx(Z,{onClick:()=>n("retained"),className:"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Retained"}),e.jsx(Z,{onClick:()=>n("retentionRate"),className:"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Retention %"}),e.jsx(Z,{onClick:()=>n("converted"),className:"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Converted"}),e.jsx(Z,{onClick:()=>n("conversionRate"),className:"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Conversion %"}),e.jsx(Z,{onClick:()=>n("avgLTV"),className:"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Avg LTV"}),e.jsx(Z,{onClick:()=>n("totalLTV"),className:"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Total LTV"}),e.jsx(Z,{onClick:()=>n("avgConversionDays"),className:"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Avg Conv Days"}),e.jsx(Z,{onClick:()=>n("avgVisits"),className:"cursor-pointer hover:bg-white/10 transition-colors font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Avg Visits"})]})}),e.jsxs(yt,{children:[m.map(i=>e.jsxs(fe,{className:"hover:bg-gray-50 transition-colors cursor-pointer border-b border-gray-100",style:{maxHeight:"35px"},onClick:()=>I?.(i),children:[e.jsx(W,{className:"text-xs px-4 sticky left-0 bg-white z-10 border-r",style:{width:"300px",minWidth:"300px",maxHeight:"35px"},children:e.jsx("span",{className:"text-sm font-medium text-slate-900",children:i.month})}),e.jsx(W,{className:"text-xs px-3 text-left",children:e.jsx("span",{className:"text-sm font-medium text-slate-900",children:i.type})}),e.jsx(W,{className:"text-xs px-3 text-center font-medium text-slate-900",children:R(i.totalTrials)}),e.jsx(W,{className:"text-xs px-3 text-center font-medium text-slate-900",children:R(i.newMembers)}),e.jsx(W,{className:"text-xs px-3 text-center font-medium text-slate-900",children:R(i.retained)}),e.jsx(W,{className:"text-xs px-3 text-center",children:e.jsxs("span",{className:"text-sm font-medium text-slate-900",children:[i.retentionRate.toFixed(1),"%"]})}),e.jsx(W,{className:"text-xs px-3 text-center font-medium text-slate-900",children:R(i.converted)}),e.jsx(W,{className:"text-xs px-3 text-center",children:e.jsxs("span",{className:"text-sm font-medium text-slate-900",children:[i.conversionRate.toFixed(1),"%"]})}),e.jsx(W,{className:"text-xs px-3 text-right font-medium text-slate-900",children:$(i.avgLTV)}),e.jsx(W,{className:"text-xs px-3 text-right font-medium text-slate-900",children:$(i.totalLTV)}),e.jsxs(W,{className:"text-xs px-3 text-center font-medium text-slate-900",children:[i.avgConversionDays.toFixed(0)," days"]}),e.jsx(W,{className:"text-xs px-3 text-center font-medium text-slate-900",children:i.avgVisits.toFixed(1)})]},`${i.month}-${i.type}`)),e.jsxs(fe,{className:"border-t-4 border-gray-800 text-gray-900",children:[e.jsx(W,{className:"border-t-4 border-gray-800 text-gray-900",children:u.month}),e.jsx(W,{className:"text-xs px-3 text-center",children:e.jsx(K,{variant:"outline",className:"text-xs font-bold",children:u.type})}),e.jsx(W,{className:"text-xs px-3 text-center font-bold",children:R(u.totalTrials)}),e.jsx(W,{className:"text-xs px-3 text-center font-bold",children:R(u.newMembers)}),e.jsx(W,{className:"text-xs px-3 text-center font-bold",children:R(u.retained)}),e.jsx(W,{className:"text-xs px-3 text-center",children:e.jsxs("span",{className:`font-bold ${u.retentionRate>=70?"text-green-600":u.retentionRate>=50?"text-orange-600":"text-red-600"}`,children:[u.retentionRate.toFixed(1),"%"]})}),e.jsx(W,{className:"text-xs px-3 text-center font-bold",children:R(u.converted)}),e.jsx(W,{className:"text-xs px-3 text-center",children:e.jsxs("span",{className:`font-bold ${u.conversionRate>=50?"text-green-600":u.conversionRate>=30?"text-orange-600":"text-red-600"}`,children:[u.conversionRate.toFixed(1),"%"]})}),e.jsx(W,{className:"text-xs px-3 text-right font-bold text-emerald-600",children:$(u.avgLTV)}),e.jsx(W,{className:"text-xs px-3 text-right font-bold text-green-600",children:$(u.totalLTV)}),e.jsxs(W,{className:"text-xs px-3 text-center font-bold",children:[u.avgConversionDays.toFixed(0)," days"]}),e.jsx(W,{className:"text-xs px-3 text-center font-bold",children:u.avgVisits.toFixed(1)})]})]})]})})})]})},ie={trials:"Trials",newMembers:"New Members",converted:"Converted",retained:"Retained",retentionRate:"Retention %",conversionRate:"Conversion %",avgLTV:"Avg LTV",totalLTV:"Total LTV",avgConversionDays:"Avg Conv Days",avgVisits:"Avg Visits"},$t=({data:C,onRowClick:A})=>{const[E,I]=D.useState("trials"),[V,x]=D.useState("clientType"),[L,N]=D.useState("values"),[P,U]=D.useState(null),[f,r]=D.useState("desc"),c=D.useRef(null),g=De(),T="Client Retention YoY Pivot",m=new Date,n=m.getFullYear(),l=n-1,u=D.useMemo(()=>{const p=m.getMonth()+1,v=[];for(let w=1;w<=p;w++){const k=new Date(2024,w-1,1).toLocaleDateString("en-US",{month:"short"});v.push({key:`2024-${String(w).padStart(2,"0")}`,display:`${k} 2024`,year:2024,month:w,monthName:k}),v.push({key:`${n}-${String(w).padStart(2,"0")}`,display:`${k} ${n}`,year:n,month:w,monthName:k})}return v},[n,m]),i=D.useMemo(()=>{const p=new Set;return C.forEach(v=>{const w=V==="clientType"?v.isNew||"Unknown":v.membershipUsed||"Unknown";p.add(w)}),Array.from(p).sort((v,w)=>{if(V==="clientType"){const k=v.toLowerCase(),j=w.toLowerCase();if(k.includes("new")&&!j.includes("new"))return-1;if(!k.includes("new")&&j.includes("new"))return 1}return v.localeCompare(w)})},[C,V]),t=D.useMemo(()=>{const p=()=>({trials:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],visitsPostTrial:[],clients:[]}),v={};return i.forEach(w=>{v[w]={},u.forEach(k=>{v[w][k.key]=p()})}),C.forEach(w=>{const k=he(w.firstVisitDate||"");if(!k)return;const j=k.getFullYear(),a=k.getMonth()+1,o=`${j}-${String(a).padStart(2,"0")}`,y=V==="clientType"?w.isNew||"Unknown":w.membershipUsed||"Unknown";if(!v[y])return;const S=v[y][o];S&&(S.trials+=1,(w.isNew||"").toLowerCase().includes("new")&&(S.newMembers+=1),w.conversionStatus==="Converted"&&(S.converted+=1),w.retentionStatus==="Retained"&&(S.retained+=1),S.totalLTV+=w.ltv||0,S.clients.push(w),w.conversionSpan!==void 0&&w.conversionSpan!==null&&S.conversionIntervals.push(w.conversionSpan),w.visitsPostTrial!==void 0&&w.visitsPostTrial!==null&&S.visitsPostTrial.push(w.visitsPostTrial))}),i.forEach(w=>{u.forEach(k=>{const j=v[w][k.key];j&&(j.avgLTV=j.trials>0?j.totalLTV/j.trials:0,j.conversionRate=j.newMembers>0?j.converted/j.newMembers*100:0,j.retentionRate=j.newMembers>0?j.retained/j.newMembers*100:0,j.avgConversionDays=j.conversionIntervals.length>0?j.conversionIntervals.reduce((a,o)=>a+o,0)/j.conversionIntervals.length:0,j.avgVisits=j.visitsPostTrial.length>0?j.visitsPostTrial.reduce((a,o)=>a+o,0)/j.visitsPostTrial.length:0)})}),v},[C,i,u,n,l,V]),s=D.useMemo(()=>P?[...i].sort((v,w)=>{if(P==="row")return v.localeCompare(w);const k=t[v],j=t[w];if(!k||!j)return 0;const a=k.current[P],o=j.current[P];if(!a||!o)return 0;let y=0,S=0;switch(E){case"trials":y=a.trials||0,S=o.trials||0;break;case"newMembers":y=a.newMembers||0,S=o.newMembers||0;break;case"converted":y=a.converted||0,S=o.converted||0;break;case"retained":y=a.retained||0,S=o.retained||0;break;case"retentionRate":y=a.retentionRate||0,S=o.retentionRate||0;break;case"conversionRate":y=a.conversionRate||0,S=o.conversionRate||0;break;case"avgLTV":y=a.avgLTV||0,S=o.avgLTV||0;break;case"totalLTV":y=a.totalLTV||0,S=o.totalLTV||0;break}return f==="desc"?S-y:y-S}):i,[i,P,f,t,E]),h=p=>{P===p?r(v=>v==="desc"?"asc":"desc"):(U(p),r("desc"))},d=D.useMemo(()=>{const p={};return u.forEach(v=>{p[v.key]={trials:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],visitsPostTrial:[],clients:[]},i.forEach(k=>{const j=t[k]?.[v.key];j&&(p[v.key].trials+=j.trials||0,p[v.key].newMembers+=j.newMembers||0,p[v.key].converted+=j.converted||0,p[v.key].retained+=j.retained||0,p[v.key].totalLTV+=j.totalLTV||0,p[v.key].conversionIntervals.push(...j.conversionIntervals||[]),p[v.key].visitsPostTrial.push(...j.visitsPostTrial||[]),p[v.key].clients.push(...j.clients||[]))});const w=p[v.key];w.avgLTV=w.trials>0?w.totalLTV/w.trials:0,w.conversionRate=w.newMembers>0?w.converted/w.newMembers*100:0,w.retentionRate=w.newMembers>0?w.retained/w.newMembers*100:0,w.avgConversionDays=w.conversionIntervals.length>0?w.conversionIntervals.reduce((k,j)=>k+j,0)/w.conversionIntervals.length:0,w.avgVisits=w.visitsPostTrial.length>0?w.visitsPostTrial.reduce((k,j)=>k+j,0)/w.visitsPostTrial.length:0}),p},[t,i,u]),b=D.useCallback(()=>{const p=[];p.push(`${T} - All Metrics Export`),p.push(`Exported on ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}`),p.push(`Row Mode: ${V}`),p.push("");const v=Object.keys(ie),w=(k,j)=>{switch(k){case"trials":return R(j?.trials||0);case"newMembers":return R(j?.newMembers||0);case"converted":return R(j?.converted||0);case"retained":return R(j?.retained||0);case"retentionRate":return`${(j?.retentionRate||0).toFixed(1)}%`;case"conversionRate":return`${(j?.conversionRate||0).toFixed(1)}%`;case"avgLTV":return $(j?.avgLTV||0);case"totalLTV":return $(j?.totalLTV||0);case"avgConversionDays":return`${Math.round(j?.avgConversionDays||0)}`;case"avgVisits":return`${(j?.avgVisits||0).toFixed(1)}`}};return v.forEach(k=>{p.push(`
${ie[k].toUpperCase()}`);const j=[V==="clientType"?"Client Type":"Membership"];u.forEach(o=>j.push(o.display)),p.push(j.join("	")),p.push(j.map(()=>"---").join("	")),i.forEach(o=>{const y=[o];u.forEach(S=>{const M=t[o]?.[S.key];y.push(w(k,M))}),p.push(y.join("	"))});const a=["TOTALS"];u.forEach(o=>{const y=d[o.key];a.push(w(k,y))}),p.push(a.join("	"))}),p.join(`
`)},[t,i,u,d,V,T]);return D.useEffect(()=>{if(!g)return;const p=c.current;if(!p)return;const v=()=>{const w=p.querySelector("table");if(!w)return`${T} (No Data)`;let k=`${T}
Metric: ${ie[E]} | Mode: ${L} | Rows: ${V}
`;const j=w.querySelectorAll("thead th"),a=[];return j.forEach(y=>a.push((y.textContent||"").trim().replace(/Prev \| Curr/i,"").trim())),a.length&&(k+=a.join("	")+`
`,k+=a.map(()=>"---").join("	")+`
`),w.querySelectorAll("tbody tr").forEach(y=>{const S=y.querySelectorAll("td"),M=[];S.forEach(z=>M.push((z.textContent||"").trim())),M.length&&(k+=M.join("	")+`
`)}),k.trim()};return g.register({id:T,getTextContent:v}),()=>g.unregister(T)},[g,E,L,V,t,s]),e.jsxs(X,{ref:c,className:"bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-shadow duration-300",children:[e.jsx("div",{className:"absolute inset-x-0 top-0 h-1.5 bg-gradient-to-r from-emerald-500 via-teal-500 to-cyan-500"}),e.jsx(ee,{className:"border-b border-gray-100 bg-gradient-to-r from-emerald-700 to-teal-800 text-white pt-4",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5"}),"Year-on-Year Analysis",e.jsxs(K,{variant:"secondary",className:"bg-white/20 text-white",children:[l," vs ",n]}),e.jsx("div",{className:"ml-4",children:e.jsx(je,{tableRef:c,tableName:T,size:"sm",onCopyAllTabs:async()=>b()})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{size:"sm",variant:L==="values"?"default":"outline",onClick:()=>N("values"),className:L==="values"?"bg-white text-emerald-700 hover:bg-white/90":"bg-white/10 text-white hover:bg-white/20 border-white/30",children:"Values"}),e.jsx(q,{size:"sm",variant:L==="growth"?"default":"outline",onClick:()=>N("growth"),className:L==="growth"?"bg-white text-emerald-700 hover:bg-white/90":"bg-white/10 text-white hover:bg-white/20 border-white/30",children:"Growth %"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white/10 rounded-lg p-1",children:[e.jsx(q,{size:"sm",variant:"ghost",onClick:()=>x("clientType"),className:`min-w-[110px] ${V==="clientType"?"bg-white text-emerald-700":"text-white hover:bg-white/20"}`,children:"Client Type"}),e.jsx(q,{size:"sm",variant:"ghost",onClick:()=>x("membership"),className:`min-w-[110px] ${V==="membership"?"bg-white text-emerald-700":"text-white hover:bg-white/20"}`,children:"Membership"})]}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:Object.keys(ie).map(p=>e.jsx("button",{onClick:()=>I(p),className:`px-3 py-1.5 rounded-md text-xs font-semibold transition-all min-w-[90px] ${E===p?"bg-white text-emerald-700 shadow-md":"bg-white/10 text-white hover:bg-white/20"}`,title:ie[p],children:ie[p]},p))})]})]})}),e.jsx(_,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto max-h-[900px] relative",children:e.jsxs("table",{className:"min-w-full relative",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-green-800 via-green-900 to-green-800 text-white sticky top-0 z-10",children:[e.jsx("th",{className:"px-4 py-3 text-left sticky left-0 z-20 font-bold text-xs uppercase tracking-wide cursor-pointer select-none border-r border-white/20 bg-green-900",style:{width:"300px",minWidth:"300px"},onClick:()=>h("row"),children:e.jsxs("div",{className:"flex items-center gap-1",children:[V==="clientType"?"Client Type":"Membership",e.jsx(wt,{className:"w-3 h-3"})]})}),u.map((p,v)=>{const w=v>0?u[v-1]:null,k=v<u.length-1?u[v+1]:null,j=!w||w.month!==p.month,a=!k||k.month!==p.month;return e.jsx("th",{className:`px-3 py-3 text-center font-bold text-xs uppercase tracking-wider min-w-[90px] cursor-pointer hover:bg-green-700/50 select-none sticky top-0 ${j?"border-l-2 border-green-400":""} ${a?"border-r-2 border-green-400":""}`,onClick:()=>h(p.key),children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs font-bold whitespace-nowrap leading-tight",children:p.monthName}),e.jsx("span",{className:"text-green-300 text-xs leading-tight",children:p.year})]})},p.key)})]})}),e.jsxs("tbody",{children:[s.map(p=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50 cursor-pointer transition-colors",style:{maxHeight:"35px"},onClick:()=>{const v=u.flatMap(w=>t[p]?.[w.key]?.clients||[]);A?.({rowKey:p,rowType:V,data:t[p],metric:E,clients:v})},children:[e.jsx("td",{className:"px-4 py-2 text-sm font-semibold text-slate-800 sticky left-0 bg-white hover:bg-slate-50 z-10 border-r",style:{width:"300px",minWidth:"300px",maxHeight:"35px"},children:p}),u.map((v,w)=>{const k=w>0?u[w-1]:null,j=w<u.length-1?u[w+1]:null,a=!k||k.month!==v.month,o=!j||j.month!==v.month,y=t[p]?.[v.key];return e.jsx("td",{className:`px-2 py-2 text-center text-sm font-mono text-slate-800 ${a?"border-l-2 border-slate-300":"border-l"} ${o?"border-r-2 border-slate-300":""}`,style:{maxHeight:"35px"},onClick:S=>{S.stopPropagation();const M=y?.clients||[];A?.({rowKey:p,rowType:V,month:v.month,year:v.year,data:y,metric:E,clients:M})},children:(()=>{const S=y||{};switch(E){case"trials":return R(S.trials||0);case"newMembers":return R(S.newMembers||0);case"converted":return R(S.converted||0);case"retained":return R(S.retained||0);case"conversionRate":return`${(S.conversionRate||0).toFixed(1)}%`;case"retentionRate":return`${(S.retentionRate||0).toFixed(1)}%`;case"avgLTV":return $(S.avgLTV||0);case"totalLTV":return $(S.totalLTV||0);case"avgConversionDays":return`${(S.avgConversionDays||0).toFixed(0)}`;case"avgVisits":return`${(S.avgVisits||0).toFixed(1)}`}})()},v.key)})]},p)),e.jsxs("tr",{className:"bg-slate-800 font-bold border-t-4 border-slate-600",style:{maxHeight:"35px"},children:[e.jsx("td",{className:"px-4 py-2 text-sm text-white sticky left-0 bg-slate-800 z-10 border-r",style:{width:"300px",minWidth:"300px",maxHeight:"35px"},children:"TOTALS"}),u.map((p,v)=>{const w=v>0?u[v-1]:null,k=v<u.length-1?u[v+1]:null,j=!w||w.month!==p.month,a=!k||k.month!==p.month,o=d[p.key];return e.jsx("td",{className:`px-2 py-2 text-center text-sm font-mono text-white cursor-pointer hover:bg-slate-700 ${j?"border-l-2 border-slate-500":"border-l"} ${a?"border-r-2 border-slate-500":""}`,style:{maxHeight:"35px"},onClick:y=>{y.stopPropagation();const S=o?.clients||[];A?.({rowKey:"TOTALS",rowType:V,month:p.month,year:p.year,data:o,metric:E,clients:S})},children:(()=>{const y=o||{};switch(E){case"trials":return R(y.trials||0);case"newMembers":return R(y.newMembers||0);case"converted":return R(y.converted||0);case"retained":return R(y.retained||0);case"conversionRate":return`${(y.conversionRate||0).toFixed(1)}%`;case"retentionRate":return`${(y.retentionRate||0).toFixed(1)}%`;case"avgLTV":return $(y.avgLTV||0);case"totalLTV":return $(y.totalLTV||0);case"avgConversionDays":return`${(y.avgConversionDays||0).toFixed(0)}`;case"avgVisits":return`${(y.avgVisits||0).toFixed(1)}`}})()},p.key)})]})]})]})})})]})},Ft=({data:C})=>{const[A,E]=H.useState(void 0),[I,V]=H.useState("desc"),x=H.useMemo(()=>{const f=C.reduce((r,c)=>{const g=c.membershipUsed||"No Membership";return r[g]||(r[g]={membershipType:g,totalMembers:0,newMembers:0,converted:0,retained:0,totalLTV:0,totalVisits:0,conversionSpans:[]}),r[g].totalMembers++,(c.isNew||"").toLowerCase().includes("new")&&r[g].newMembers++,c.conversionStatus==="Converted"&&r[g].converted++,c.retentionStatus==="Retained"&&r[g].retained++,r[g].totalLTV+=c.ltv||0,r[g].totalVisits+=c.visitsPostTrial||0,c.conversionSpan&&c.conversionSpan>0&&r[g].conversionSpans.push(c.conversionSpan),r},{});return Object.values(f).map(r=>({...r,conversionRate:r.newMembers>0?r.converted/r.newMembers*100:0,retentionRate:r.newMembers>0?r.retained/r.newMembers*100:0,avgLTV:r.totalMembers>0?r.totalLTV/r.totalMembers:0,avgVisits:r.totalMembers>0?r.totalVisits/r.totalMembers:0,avgConversionSpan:r.conversionSpans.length>0?r.conversionSpans.reduce((c,g)=>c+g,0)/r.conversionSpans.length:0})).filter(r=>r.totalMembers>0).sort((r,c)=>c.totalMembers-r.totalMembers)},[C]),L=[{key:"membershipType",header:"Membership Type",className:"font-medium text-xs min-w-[240px]",sortable:!0,render:f=>e.jsx("span",{className:"text-sm font-medium text-slate-700 truncate",title:f,children:f})},{key:"totalMembers",header:"Trials",align:"center",sortable:!0,render:f=>e.jsx("span",{className:"text-sm font-medium text-slate-700",children:R(f)})},{key:"newMembers",header:"New Members",align:"center",sortable:!0,render:f=>e.jsx("span",{className:"text-sm font-medium text-slate-700",children:R(f)})},{key:"retained",header:"Retained",align:"center",sortable:!0,render:f=>e.jsx("span",{className:"text-sm font-medium text-slate-700",children:R(f)})},{key:"retentionRate",header:"Retention %",align:"center",sortable:!0,render:f=>e.jsxs("span",{className:"text-sm font-medium text-slate-700",children:[f.toFixed(1),"%"]})},{key:"converted",header:"Converted",align:"center",sortable:!0,render:f=>e.jsx("span",{className:"text-sm font-medium text-slate-700",children:R(f)})},{key:"conversionRate",header:"Conversion %",align:"center",sortable:!0,render:f=>e.jsxs("span",{className:"text-sm font-medium text-slate-700",children:[f.toFixed(1),"%"]})},{key:"avgLTV",header:"Avg LTV",align:"right",sortable:!0,render:f=>e.jsx("span",{className:"text-sm font-medium text-slate-700",children:$(f)})},{key:"totalLTV",header:"Total LTV",align:"right",sortable:!0,render:f=>e.jsx("span",{className:"text-sm font-medium text-slate-700",children:$(f)})}],N={membershipType:"TOTAL",totalMembers:x.reduce((f,r)=>f+r.totalMembers,0),newMembers:x.reduce((f,r)=>f+r.newMembers,0),converted:x.reduce((f,r)=>f+r.converted,0),conversionRate:0,retained:x.reduce((f,r)=>f+r.retained,0),retentionRate:0,totalLTV:x.reduce((f,r)=>f+r.totalLTV,0),avgLTV:x.reduce((f,r)=>f+r.totalLTV,0)/Math.max(x.reduce((f,r)=>f+r.totalMembers,0),1)};N.conversionRate=N.newMembers>0?N.converted/N.newMembers*100:0,N.retentionRate=N.newMembers>0?N.retained/N.newMembers*100:0;const P=H.useMemo(()=>A?[...x].sort((r,c)=>{const g=r[A],T=c[A],m=I==="asc"?1:-1;return typeof g=="number"&&typeof T=="number"?(g-T)*m:String(g??"").localeCompare(String(T??""))*m}):x,[x,A,I]),U=f=>{A===f?V(r=>r==="asc"?"desc":"asc"):(E(f),V("desc"))};return e.jsxs(X,{className:"bg-white shadow-lg border-0",children:[e.jsx(ee,{className:"border-b border-gray-100 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white",children:e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(jt,{className:"w-5 h-5"}),"Membership Type Performance Analysis",e.jsxs(K,{variant:"secondary",className:"bg-white/20 text-white",children:[x.length," Types"]})]})}),e.jsxs(_,{className:"p-0",children:[e.jsx(Ne,{data:P,columns:L,headerGradient:"from-slate-800 via-slate-900 to-slate-800",showFooter:!0,footerData:N,maxHeight:"500px",onSort:U,sortField:A,sortDirection:I,tableId:"Membership Type Performance Analysis"}),e.jsx("div",{className:"border-t border-slate-200 p-4 bg-slate-50",children:e.jsxs("ul",{className:"list-disc pl-5 text-sm text-slate-600 space-y-1",children:[e.jsxs("li",{children:["Top membership by trials: ",(()=>{if(x.length===0)return"N/A";const f=[...x].sort((r,c)=>c.totalMembers-r.totalMembers)[0];return`${f.membershipType} (${R(f.totalMembers)})`})()]}),e.jsxs("li",{children:["Best conversion: ",(()=>{const f=x.filter(c=>c.newMembers>0);if(f.length===0)return"N/A";const r=[...f].sort((c,g)=>g.conversionRate-c.conversionRate)[0];return`${r.membershipType} at ${r.conversionRate.toFixed(1)}%`})()]}),e.jsxs("li",{children:["Best retention: ",(()=>{const f=x.filter(c=>c.newMembers>0);if(f.length===0)return"N/A";const r=[...f].sort((c,g)=>g.retentionRate-c.retentionRate)[0];return`${r.membershipType} at ${r.retentionRate.toFixed(1)}%`})()]})]})})]})]})},Et=({data:C,onRowClick:A})=>{const[E,I]=H.useState(void 0),[V,x]=H.useState("desc");if(!C||C.length===0)return e.jsxs(X,{className:"bg-white shadow-xl border-0 overflow-hidden",children:[e.jsx(ee,{className:"border-b border-gray-100 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white",children:e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-5 h-5"}),"Hosted Classes Performance Analysis",e.jsx(K,{variant:"secondary",className:"bg-white/20 text-white",children:"0 Classes"})]})}),e.jsx(_,{className:"p-6",children:e.jsx("p",{className:"text-gray-500 text-center",children:"No class data available for analysis."})})]});const L=H.useMemo(()=>{const g=C.filter(T=>{if(!T||!T.firstVisitEntityName)return!1;const m=T.firstVisitEntityName.toLowerCase();return["host","hosted","p57","birthday","rugby","lrs"].some(l=>m.includes(l))}).reduce((T,m)=>{if(!m)return T;const n=m.firstVisitEntityName||"Unknown Class";let l="Unknown";if(m.firstVisitDate)try{let i;if(m.firstVisitDate.includes("/")){const t=m.firstVisitDate.split(",")[0].trim(),[s,h,d]=t.split("/");i=new Date(parseInt(d),parseInt(h)-1,parseInt(s))}else i=new Date(m.firstVisitDate);isNaN(i.getTime())||(l=i.toLocaleDateString("en-US",{month:"short",year:"numeric"}))}catch{}const u=`${l}-${n}`;if(T[u]||(T[u]={month:l,className:n,totalMembers:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],clients:[]}),T[u].totalMembers++,T[u].clients.push(m),(m.isNew||"").toLowerCase().includes("new")&&T[u].newMembers++,m.conversionStatus==="Converted"&&T[u].converted++,m.retentionStatus==="Retained"&&T[u].retained++,T[u].totalLTV+=m.ltv||0,m.firstPurchase&&m.firstVisitDate)try{const i=new Date(m.firstVisitDate),t=new Date(m.firstPurchase);if(!isNaN(i.getTime())&&!isNaN(t.getTime())){const s=Math.ceil((t.getTime()-i.getTime())/864e5);s>=0&&T[u].conversionIntervals.push(s)}}catch{}return T},{});return Object.values(g).map(T=>({...T,conversionRate:T.newMembers>0?T.converted/T.newMembers*100:0,retentionRate:T.newMembers>0?T.retained/T.newMembers*100:0,avgLTV:T.totalMembers>0?T.totalLTV/T.totalMembers:0,avgConversionInterval:T.conversionIntervals.length>0?T.conversionIntervals.reduce((m,n)=>m+n,0)/T.conversionIntervals.length:0})).sort((T,m)=>m.totalMembers-T.totalMembers)},[C]),N=[{key:"month",header:"Month",className:"font-semibold min-w-[120px]",sortable:!0,render:c=>e.jsx("span",{className:"text-sm font-medium text-slate-700 whitespace-nowrap",children:c})},{key:"className",header:"Class Name",className:"font-medium min-w-[360px] max-w-none h-auto whitespace-normal",sortable:!0,render:c=>e.jsx("span",{className:"text-sm font-medium text-slate-700 whitespace-normal break-words",title:c,children:c})},{key:"totalMembers",header:"Trials",align:"center",sortable:!0,render:c=>e.jsx("span",{className:"text-sm font-medium text-slate-700 whitespace-nowrap",children:R(c)})},{key:"newMembers",header:"New Members",align:"center",sortable:!0,render:c=>e.jsx("span",{className:"text-sm font-medium text-slate-700 whitespace-nowrap",children:R(c)})},{key:"retained",header:"Retained",align:"center",sortable:!0,render:c=>e.jsx("span",{className:"text-sm font-medium text-slate-700 whitespace-nowrap",children:R(c)})},{key:"retentionRate",header:"Retention %",align:"center",sortable:!0,render:c=>{const g=c??0;return e.jsxs("span",{className:"text-sm font-medium text-slate-700",children:[g.toFixed(1),"%"]})}},{key:"converted",header:"Converted",align:"center",sortable:!0,render:c=>e.jsx("span",{className:"text-sm font-medium text-slate-700",children:R(c)})},{key:"conversionRate",header:"Conversion %",align:"center",sortable:!0,render:c=>{const g=c??0;return e.jsxs("span",{className:"text-sm font-medium text-slate-700",children:[g.toFixed(1),"%"]})}},{key:"avgLTV",header:"Avg LTV",align:"right",sortable:!0,render:c=>e.jsx("span",{className:"text-sm font-medium text-slate-700",children:$(c)})},{key:"avgConversionInterval",header:"Avg Conv Days",align:"center",sortable:!0,render:c=>{const g=c??0;return e.jsxs("span",{className:"text-sm font-medium text-slate-700",children:[Math.round(g)," days"]})}}],P={month:"TOTAL",className:`${L.length} Classes`,totalMembers:L.reduce((c,g)=>c+g.totalMembers,0),newMembers:L.reduce((c,g)=>c+g.newMembers,0),converted:L.reduce((c,g)=>c+g.converted,0),conversionRate:0,retained:L.reduce((c,g)=>c+g.retained,0),retentionRate:0,avgLTV:L.reduce((c,g)=>c+g.totalLTV,0)/Math.max(L.reduce((c,g)=>c+g.totalMembers,0),1),avgConversionInterval:L.reduce((c,g)=>c+g.avgConversionInterval*g.totalMembers,0)/Math.max(L.reduce((c,g)=>c+g.totalMembers,0),1)};P.conversionRate=P.newMembers>0?P.converted/P.newMembers*100:0,P.retentionRate=P.newMembers>0?P.retained/P.newMembers*100:0;const U=H.useMemo(()=>{const c=[...L];return E?c.sort((g,T)=>{const m=g[E],n=T[E],l=V==="asc"?1:-1;return typeof m=="number"&&typeof n=="number"?(m-n)*l:String(m??"").localeCompare(String(n??""))*l}):c},[L,E,V]),f=c=>{E===c?x(g=>g==="asc"?"desc":"asc"):(I(c),x("desc"))},r=H.useMemo(()=>{if(!L||L.length===0)return[];const c=[...L].sort((n,l)=>l.totalMembers-n.totalMembers)[0],g=[...L.filter(n=>n.newMembers>0)].sort((n,l)=>l.conversionRate-n.conversionRate)[0],T=[...L.filter(n=>n.newMembers>0)].sort((n,l)=>l.retentionRate-n.retentionRate)[0],m=[];return c&&m.push(`${c.className} (${c.month}) drove the most trials (${R(c.totalMembers)}).`),g&&m.push(`${g.className} (${g.month}) has the best conversion ${g.conversionRate.toFixed(1)}% (${g.converted}/${g.newMembers}).`),T&&m.push(`${T.className} (${T.month}) leads retention ${T.retentionRate.toFixed(1)}% (${T.retained}/${T.newMembers}).`),m},[L]);return e.jsx(ze.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(X,{className:"bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-all duration-300",children:[e.jsx(ee,{className:"border-b border-gray-100 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white",children:e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-5 h-5"}),"Hosted Classes Performance Analysis",e.jsxs(K,{variant:"secondary",className:"bg-white/20 text-white",children:[L.length," Classes"]})]})}),e.jsxs(_,{className:"p-0",children:[e.jsx(Ne,{data:U,columns:N,headerGradient:"from-slate-800 via-slate-900 to-slate-800",showFooter:!0,footerData:P,maxHeight:"600px",onRowClick:A,onSort:f,sortField:E,sortDirection:V,tableId:"Hosted Classes Performance Analysis"}),e.jsx("div",{className:"border-t border-slate-200 p-4 bg-slate-50",children:e.jsx("ul",{className:"list-disc pl-5 text-sm text-slate-600 space-y-1",children:r.map((c,g)=>e.jsx("li",{children:c},g))})})]})]})})},Ht=({data:C,onRowClick:A})=>{const E=D.useRef(null),I="Teacher Performance Analysis",{getAllTabsText:V}=Nt(E,I),[x,L]=D.useState("values"),N=D.useMemo(()=>{const t=new Map;return C.forEach(h=>{const d=h.trainerName||"Unknown Trainer";t.has(d)||t.set(d,{newMembers:new Set,sessions:0,converted:new Set,retained:new Set});const b=t.get(d);h.memberId&&b.newMembers.add(h.memberId),b.sessions+=h.classNo||0,h.conversionStatus==="Converted"&&h.memberId&&b.converted.add(h.memberId),h.retentionStatus==="Retained"&&h.memberId&&b.retained.add(h.memberId)}),Array.from(t.entries()).map(([h,d])=>{const b=d.newMembers.size,p=d.converted.size,v=d.retained.size;return{trainerName:h,newMembers:b,sessions:d.sessions,converted:p,conversionRate:b>0?p/b*100:0,retained:v,retentionRate:b>0?v/b*100:0}}).sort((h,d)=>d.newMembers-h.newMembers)},[C]),[P,U]=D.useState("newMembers"),[f,r]=D.useState("desc"),c=D.useMemo(()=>{if(!P)return[...N];const t=[...N];return t.sort((s,h)=>{const d=s[P],b=h[P];if(typeof d=="string"&&typeof b=="string")return f==="asc"?d.localeCompare(b):b.localeCompare(d);const p=Number(d||0),v=Number(b||0);return f==="asc"?p-v:v-p}),t},[N,P,f]),g=t=>{t===P?r(s=>s==="asc"?"desc":"asc"):(U(t),r("desc"))},T=()=>{const t=["Teacher Name","New Members","Sessions","Converted","Conversion Rate","Retained","Retention Rate"],s=c.map(k=>[k.trainerName,k.newMembers,k.sessions,k.converted,`${k.conversionRate.toFixed(1)}%`,k.retained,`${k.retentionRate.toFixed(1)}%`]),h=[l.trainerName,l.newMembers,l.sessions,l.converted,`${l.conversionRate.toFixed(1)}%`,l.retained,`${l.retentionRate.toFixed(1)}%`],d=k=>{if(k==null)return"";const j=String(k);return j.includes(",")||j.includes(`
`)||j.includes('"')?'"'+j.replace(/"/g,'""')+'"':j},b=[t.map(d).join(","),...s.map(k=>k.map(d).join(",")),h.map(d).join(",")].join(`
`),p=new Blob([b],{type:"text/csv"}),v=URL.createObjectURL(p),w=document.createElement("a");w.href=v,w.download="teacher-performance.csv",w.click(),URL.revokeObjectURL(v)},m=async()=>{if(!E.current)return;const t=document.createElement("div");t.style.position="absolute",t.style.left="-99999px",t.style.top="0",t.style.background="#ffffff",t.style.padding="20px",t.style.color="#000",t.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',t.style.fontSize="14px",t.style.width="1200px";const s=document.createElement("h1");s.textContent="Teacher Performance Analysis",s.style.fontSize="24px",s.style.fontWeight="600",s.style.marginBottom="20px",s.style.color="#1f2937",s.style.textAlign="center",t.appendChild(s);const h=document.createElement("table");h.style.borderCollapse="collapse",h.style.width="100%",h.style.background="#ffffff",h.style.color="#000",h.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.1)",h.style.borderRadius="8px",h.style.overflow="hidden";const d=document.createElement("thead");d.style.background="linear-gradient(to right, #334155, #1e293b, #4f46e5)";const b=document.createElement("tr");["Teacher Name","New Members","Sessions","Converted","Conversion Rate","Retained","Retention Rate"].forEach(z=>{const F=document.createElement("th");F.textContent=z,F.style.textAlign="center",F.style.padding="12px 8px",F.style.border="1px solid #e5e7eb",F.style.color="#ffffff",F.style.fontWeight="600",F.style.fontSize="12px",F.style.textTransform="uppercase",F.style.letterSpacing="0.05em",F.style.background="linear-gradient(to right, #334155, #1e293b, #4f46e5)",b.appendChild(F)}),d.appendChild(b),h.appendChild(d);const p=document.createElement("tbody");c.forEach(z=>{const F=document.createElement("tr");[z.trainerName,z.newMembers,z.sessions,z.converted,`${z.conversionRate.toFixed(1)}%`,z.retained,`${z.retentionRate.toFixed(1)}%`].forEach(J=>{const B=document.createElement("td");B.textContent=String(J),B.style.padding="6px 8px",B.style.border="1px solid #e5e7eb",B.style.height="35px",B.style.whiteSpace="nowrap",F.appendChild(B)}),p.appendChild(F)});const v=document.createElement("tr");v.style.backgroundColor="#f3f4f6",v.style.borderTop="2px solid #d1d5db",[l.trainerName,l.newMembers,l.sessions,l.converted,`${l.conversionRate.toFixed(1)}%`,l.retained,`${l.retentionRate.toFixed(1)}%`].forEach((z,F)=>{const J=document.createElement("td");J.textContent=String(z),J.style.padding="12px 8px",J.style.border="1px solid #d1d5db",J.style.fontWeight="700",J.style.height="40px",J.style.color="#111827",J.style.fontSize="14px",J.style.textAlign=F===0?"left":"center",J.style.backgroundColor="#f9fafb",v.appendChild(J)}),p.appendChild(v),h.appendChild(p),t.appendChild(h),document.body.appendChild(t);const w=await Ve(t,{scale:2,backgroundColor:"#ffffff",useCORS:!0}),k=w.toDataURL("image/png"),j=new Ct("l","mm","a4"),a=297,o=210,y=w.height*a/w.width;let S=y,M=0;for(j.addImage(k,"PNG",0,M,a,y),S-=o;S>=0;)M=S-y,j.addPage(),j.addImage(k,"PNG",0,M,a,y),S-=o;j.save("teacher-performance.pdf");try{document.body.removeChild(t)}catch{}},n=async()=>{const t=document.createElement("div");t.style.position="absolute",t.style.left="-99999px",t.style.top="0",t.style.background="#ffffff",t.style.padding="20px",t.style.color="#000",t.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',t.style.fontSize="14px",t.style.width="1200px";const s=document.createElement("h1");s.textContent="Teacher Performance Analysis",s.style.fontSize="24px",s.style.fontWeight="600",s.style.marginBottom="20px",s.style.color="#1f2937",s.style.textAlign="center",t.appendChild(s);const h=document.createElement("table");h.style.borderCollapse="collapse",h.style.width="100%",h.style.background="#ffffff",h.style.color="#000",h.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.1)",h.style.borderRadius="8px",h.style.overflow="hidden";const d=document.createElement("thead");d.style.background="linear-gradient(to right, #334155, #1e293b, #4f46e5)";const b=document.createElement("tr");["Teacher Name","New Members","Sessions","Converted","Conversion Rate","Retained","Retention Rate"].forEach(j=>{const a=document.createElement("th");a.textContent=j,a.style.textAlign="center",a.style.padding="12px 8px",a.style.border="1px solid #e5e7eb",a.style.color="#ffffff",a.style.fontWeight="600",a.style.fontSize="12px",a.style.textTransform="uppercase",a.style.letterSpacing="0.05em",a.style.background="linear-gradient(to right, #334155, #1e293b, #4f46e5)",b.appendChild(a)}),d.appendChild(b),h.appendChild(d);const p=document.createElement("tbody");c.forEach((j,a)=>{const o=document.createElement("tr");o.style.backgroundColor=a%2===0?"#ffffff":"#f9fafb",o.style.borderBottom="1px solid #e5e7eb",[j.trainerName,j.newMembers,j.sessions,j.converted,`${j.conversionRate.toFixed(1)}%`,j.retained,`${j.retentionRate.toFixed(1)}%`].forEach((y,S)=>{const M=document.createElement("td");M.textContent=String(y),M.style.padding="10px 8px",M.style.border="1px solid #e5e7eb",M.style.height="35px",M.style.whiteSpace="nowrap",M.style.color="#374151",M.style.fontSize="13px",M.style.textAlign=S===0?"left":"center",M.style.fontWeight=S===0?"500":"400",o.appendChild(M)}),p.appendChild(o)});const v=document.createElement("tr");v.style.backgroundColor="#f3f4f6",v.style.borderTop="2px solid #d1d5db",[l.trainerName,l.newMembers,l.sessions,l.converted,`${l.conversionRate.toFixed(1)}%`,l.retained,`${l.retentionRate.toFixed(1)}%`].forEach((j,a)=>{const o=document.createElement("td");o.textContent=String(j),o.style.padding="12px 8px",o.style.border="1px solid #d1d5db",o.style.fontWeight="700",o.style.height="40px",o.style.color="#111827",o.style.fontSize="14px",o.style.textAlign=a===0?"left":"center",o.style.backgroundColor="#f9fafb",v.appendChild(o)}),p.appendChild(v),h.appendChild(p),t.appendChild(h),document.body.appendChild(t);const w=await Ve(t,{scale:2,backgroundColor:"#ffffff",useCORS:!0}),k=document.createElement("a");k.download="teacher-performance.png",k.href=w.toDataURL(),k.click();try{document.body.removeChild(t)}catch{}},l=D.useMemo(()=>{const t=N.reduce((b,p)=>b+p.newMembers,0),s=N.reduce((b,p)=>b+p.sessions,0),h=N.reduce((b,p)=>b+p.converted,0),d=N.reduce((b,p)=>b+p.retained,0);return{trainerName:"TOTAL",newMembers:t,sessions:s,converted:h,conversionRate:t>0?h/t*100:0,retained:d,retentionRate:t>0?d/t*100:0}},[N]),i=x==="values"?[{key:"trainerName",header:"Teacher Name",render:t=>e.jsx("div",{className:"truncate text-black font-medium",style:{maxHeight:"35px",lineHeight:"35px"},children:t}),align:"left",sortable:!0},{key:"newMembers",header:"New Members",render:t=>e.jsx("div",{className:"text-center text-black font-medium",style:{maxHeight:"35px",lineHeight:"35px"},children:R(t)}),align:"center",sortable:!0},{key:"sessions",header:"Sessions",render:t=>e.jsx("div",{className:"text-center text-black font-medium",style:{maxHeight:"35px",lineHeight:"35px"},children:R(t)}),align:"center",sortable:!0},{key:"converted",header:"Converted",render:t=>e.jsx("div",{className:"text-center text-black font-medium",style:{maxHeight:"35px",lineHeight:"35px"},children:R(t)}),align:"center",sortable:!0},{key:"conversionRate",header:"Conversion Rate",render:t=>e.jsx("div",{className:"text-center text-black font-medium",style:{maxHeight:"35px",lineHeight:"35px"},children:ne(t)}),align:"center",sortable:!0},{key:"retained",header:"Retained",render:t=>e.jsx("div",{className:"text-center text-black font-medium",style:{maxHeight:"35px",lineHeight:"35px"},children:R(t)}),align:"center",sortable:!0},{key:"retentionRate",header:"Retention Rate",render:t=>e.jsx("div",{className:"text-center text-black font-medium",style:{maxHeight:"35px",lineHeight:"35px"},children:ne(t)}),align:"center",sortable:!0}]:[{key:"trainerName",header:"Teacher Name",render:t=>e.jsx("div",{className:"truncate text-black font-medium",style:{maxHeight:"35px",lineHeight:"35px"},children:t}),align:"left",sortable:!0},{key:"newMembers",header:"New Members Growth",render:t=>e.jsx("div",{className:"text-center text-black font-medium",style:{maxHeight:"35px",lineHeight:"35px"},children:"--% (No historical data)"}),align:"center",sortable:!0},{key:"sessions",header:"Sessions Growth",render:t=>e.jsx("div",{className:"text-center text-black font-medium",style:{maxHeight:"35px",lineHeight:"35px"},children:"--% (No historical data)"}),align:"center",sortable:!0},{key:"converted",header:"Conversions Growth",render:t=>e.jsx("div",{className:"text-center text-black font-medium",style:{maxHeight:"35px",lineHeight:"35px"},children:"--% (No historical data)"}),align:"center",sortable:!0},{key:"conversionRate",header:"Conv. Rate Growth",render:t=>e.jsx("div",{className:"text-center text-black font-medium",style:{maxHeight:"35px",lineHeight:"35px"},children:"--% (No historical data)"}),align:"center",sortable:!0},{key:"retained",header:"Retention Growth",render:t=>e.jsx("div",{className:"text-center text-black font-medium",style:{maxHeight:"35px",lineHeight:"35px"},children:"--% (No historical data)"}),align:"center",sortable:!0},{key:"retentionRate",header:"Ret. Rate Growth",render:t=>e.jsx("div",{className:"text-center text-black font-medium",style:{maxHeight:"35px",lineHeight:"35px"},children:"--% (No historical data)"}),align:"center",sortable:!0}];return e.jsx("div",{ref:E,className:"space-y-6",children:e.jsxs(X,{className:"shadow-xl border-0 bg-gradient-to-br from-slate-50 to-white overflow-hidden",children:[e.jsx(ee,{className:"bg-gradient-to-r from-slate-800 via-blue-900 to-indigo-900 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center backdrop-blur-sm",children:e.jsx($e,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx(te,{className:"text-2xl font-bold text-white mb-1",children:"Teacher Performance Analysis"}),e.jsx("p",{className:"text-blue-200 text-sm",children:"Comprehensive teacher metrics including conversions and retention rates"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(K,{className:"bg-white/20 text-white border-white/30 px-3 py-1",children:[N.length," Teachers"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{size:"sm",variant:x==="values"?"default":"outline",onClick:()=>L("values"),className:"h-8 bg-white/20 text-white border-white/30 hover:bg-white/30",children:"Values"}),e.jsx(q,{size:"sm",variant:x==="growth"?"default":"outline",onClick:()=>L("growth"),className:"h-8 bg-white/20 text-white border-white/30 hover:bg-white/30",children:"Growth"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(q,{size:"sm",onClick:T,className:"h-8 bg-white/20 text-white border-white/30 hover:bg-white/30 gap-1",variant:"outline",children:[e.jsx(Tt,{className:"w-3 h-3"}),"CSV"]}),e.jsxs(q,{size:"sm",onClick:n,className:"h-8 bg-white/20 text-white border-white/30 hover:bg-white/30 gap-1",variant:"outline",children:[e.jsx(Mt,{className:"w-3 h-3"}),"PNG"]}),e.jsxs(q,{size:"sm",onClick:m,className:"h-8 bg-white/20 text-white border-white/30 hover:bg-white/30 gap-1",variant:"outline",children:[e.jsx(mt,{className:"w-3 h-3"}),"PDF"]})]}),e.jsx(je,{tableRef:E,tableName:I,size:"sm",onCopyAllTabs:async()=>V()})]})]})}),e.jsxs(_,{className:"p-0",children:[e.jsx("div",{style:{"--row-height":"35px","--text-color":"#000000","--bg-color":"#ffffff"},children:e.jsx(Ne,{data:c,columns:i,headerGradient:"from-slate-800 via-blue-900 to-indigo-900",showFooter:!0,footerData:l,maxHeight:"600px",stickyHeader:!0,onRowClick:A?t=>A(t):void 0,onSort:g,sortField:P,sortDirection:f,className:"teacher-performance-table"})}),e.jsx("style",{children:`
            .teacher-performance-table tbody tr {
              height: 35px !important;
              max-height: 35px !important;
              background-color: white !important;
            }
            /* Uniform white background for all rows per request */
            .teacher-performance-table tbody tr:nth-child(even) {
              background-color: white !important;
            }
            .teacher-performance-table tbody tr:hover {
              background-color: white !important;
            }
            .teacher-performance-table td {
              height: 35px !important;
              max-height: 35px !important;
              padding: 8px 12px !important;
              white-space: nowrap !important;
              overflow: hidden !important;
              text-overflow: ellipsis !important;
              color: black !important;
            }
            .teacher-performance-table .truncate {
              overflow: hidden !important;
              text-overflow: ellipsis !important;
              white-space: nowrap !important;
            }
          `})]})]})})},It=({data:C})=>{const[A,E]=H.useState(void 0),[I,V]=H.useState("desc"),[x,L]=H.useState(null),[N,P]=H.useState("detailed"),U=H.useMemo(()=>C.filter(n=>String(n.isNew||"").toLowerCase().includes("new")),[C]),f=H.useMemo(()=>{const n={};return U.forEach(l=>{const u=l.membershipsBoughtPostTrial||"No Membership Purchase",i=u.split(",").map(s=>s.trim()).filter(s=>s),t=l.isNew||"Unknown";if(i.length===0||u===""){const s=`No Membership Purchase|${t}`;n[s]||(n[s]=[]),n[s].push(l);return}i.forEach(s=>{const h=`${s}|${t}`;n[h]||(n[h]=[]),n[h].push(l)})}),n},[U]),r=H.useMemo(()=>{const n={};U.forEach(i=>{const t=i.membershipsBoughtPostTrial||"No Membership Purchase",s=t.split(",").map(d=>d.trim()).filter(d=>d),h=i.isNew||"Unknown";if(s.length===0||t===""){const d=`No Membership Purchase|${h}`;n[d]||(n[d]={membershipType:"No Membership Purchase",clientType:h,units:0,clients:new Set,totalRevenue:0,conversionSpans:[],visitsPostTrial:[],ltvs:[],convertedClients:0}),n[d].clients.add(i.memberId),n[d].ltvs.push(i.ltv||0),n[d].visitsPostTrial.push(i.visitsPostTrial||0);return}s.forEach(d=>{const b=`${d}|${h}`;n[b]||(n[b]={membershipType:d,clientType:h,units:0,clients:new Set,totalRevenue:0,conversionSpans:[],visitsPostTrial:[],ltvs:[],convertedClients:0}),n[b].units++,n[b].clients.add(i.memberId),n[b].ltvs.push(i.ltv||0),i.conversionStatus==="Converted"&&(n[b].convertedClients++,i.conversionSpan&&i.conversionSpan>0&&n[b].conversionSpans.push(i.conversionSpan)),i.visitsPostTrial&&n[b].visitsPostTrial.push(i.visitsPostTrial)})});const u=Object.values(n).map(i=>{const t=i.clients.size,s=i.ltvs.reduce((w,k)=>w+k,0),h=t>0?s/t:0,d=s,b=h,p=i.conversionSpans.length>0?i.conversionSpans.reduce((w,k)=>w+k,0)/i.conversionSpans.length:0,v=i.visitsPostTrial.length>0?i.visitsPostTrial.reduce((w,k)=>w+k,0)/i.visitsPostTrial.length:0;return{membershipType:i.membershipType,clientType:i.clientType,units:i.units,newClientsCount:t,totalRevenue:d,avgRevenue:b,avgDaysTaken:p,avgVisitsPostTrial:v,avgLTV:h,totalLTV:s,clientTypes:{[i.clientType]:t}}}).filter(i=>i.newClientsCount>0);if(N==="membership"){const i={};return u.forEach(t=>{i[t.membershipType]||(i[t.membershipType]={membershipType:t.membershipType,clientType:"All Types",units:0,newClientsCount:0,totalRevenue:0,avgRevenue:0,avgDaysTaken:0,avgVisitsPostTrial:0,avgLTV:0,totalLTV:0,clientTypes:{}}),i[t.membershipType].units+=t.units,i[t.membershipType].newClientsCount+=t.newClientsCount,i[t.membershipType].totalRevenue+=t.totalRevenue,i[t.membershipType].clientTypes[t.clientType]=(i[t.membershipType].clientTypes[t.clientType]||0)+t.newClientsCount}),Object.values(i).forEach(t=>{t.avgRevenue=t.newClientsCount>0?t.totalRevenue/t.newClientsCount:0;const s=u.filter(d=>d.membershipType===t.membershipType),h=s.reduce((d,b)=>d+b.newClientsCount,0);t.avgDaysTaken=h>0?s.reduce((d,b)=>d+b.avgDaysTaken*b.newClientsCount,0)/h:0,t.avgVisitsPostTrial=h>0?s.reduce((d,b)=>d+b.avgVisitsPostTrial*b.newClientsCount,0)/h:0}),Object.values(i).sort((t,s)=>s.units-t.units)}else if(N==="clientType"){const i={};return u.forEach(t=>{i[t.clientType]||(i[t.clientType]={membershipType:"All Memberships",clientType:t.clientType,units:0,newClientsCount:0,totalRevenue:0,avgRevenue:0,avgDaysTaken:0,avgVisitsPostTrial:0,avgLTV:0,totalLTV:0,clientTypes:{}}),i[t.clientType].units+=t.units,i[t.clientType].newClientsCount+=t.newClientsCount,i[t.clientType].totalRevenue+=t.totalRevenue,i[t.clientType].clientTypes[t.clientType]=i[t.clientType].newClientsCount}),Object.values(i).forEach(t=>{t.avgRevenue=t.newClientsCount>0?t.totalRevenue/t.newClientsCount:0;const s=u.filter(d=>d.clientType===t.clientType),h=s.reduce((d,b)=>d+b.newClientsCount,0);t.avgDaysTaken=h>0?s.reduce((d,b)=>d+b.avgDaysTaken*b.newClientsCount,0)/h:0,t.avgVisitsPostTrial=h>0?s.reduce((d,b)=>d+b.avgVisitsPostTrial*b.newClientsCount,0)/h:0}),Object.values(i).sort((t,s)=>s.units-t.units)}else return u.sort((i,t)=>i.membershipType!==t.membershipType?i.membershipType.localeCompare(t.membershipType):i.clientType.localeCompare(t.clientType))},[U,N]),c=(n,l,u)=>{let i=[],t="";if(N==="membership")i=Object.entries(f).filter(([s])=>s.startsWith(`${n.membershipType}|`)).flatMap(([,s])=>s),t=`${n.membershipType} (All Client Types)`;else if(N==="clientType")i=Object.entries(f).filter(([s])=>s.endsWith(`|${n.clientType}`)).flatMap(([,s])=>s),t=`All Memberships (${n.clientType})`;else{const s=`${n.membershipType}|${n.clientType}`;i=f[s]||[],t=`${n.membershipType} (${n.clientType})`}L({membershipType:t,clients:i,stats:n,field:l,fieldLabel:u})};H.useMemo(()=>[...[...N!=="clientType"?[{key:"membershipType",header:"Membership Type",className:"font-medium text-xs min-w-[200px]",sortable:!0,render:(l,u)=>e.jsx("span",{className:"text-sm font-medium text-slate-700 truncate cursor-pointer hover:text-indigo-600 hover:underline",title:l,onClick:()=>c(u,"membershipType","Membership Overview"),children:l})}]:[],...N!=="membership"?[{key:"clientType",header:"Client Type",className:"font-medium text-xs min-w-[120px]",sortable:!0,render:(l,u)=>e.jsx("span",{className:"text-sm text-slate-600 cursor-pointer hover:text-indigo-600 hover:underline",title:l,onClick:()=>c(u,"clientType","Client Type Analysis"),children:l})}]:[]],{key:"units",header:"Units Sold",align:"center",sortable:!0,render:(l,u)=>e.jsx("span",{className:"text-sm font-medium text-slate-700 cursor-pointer hover:text-indigo-600 hover:underline",onClick:()=>c(u,"units","Units Sold Analysis"),children:R(l)})},{key:"newClientsCount",header:"Clients",align:"center",sortable:!0,render:(l,u)=>e.jsx("span",{className:"text-sm font-medium text-slate-700 cursor-pointer hover:text-indigo-600 hover:underline",onClick:()=>c(u,"newClientsCount","Client Details"),children:R(l)})},{key:"totalRevenue",header:"Total Value (LTV)",align:"right",sortable:!0,render:(l,u)=>e.jsx("span",{className:"text-sm font-medium text-slate-700 cursor-pointer hover:text-indigo-600 hover:underline",onClick:()=>c(u,"totalRevenue","Revenue Breakdown"),children:$(l)})},{key:"avgRevenue",header:"Avg Value",align:"right",sortable:!0,render:(l,u)=>e.jsx("span",{className:"text-sm font-medium text-slate-700 cursor-pointer hover:text-indigo-600 hover:underline",onClick:()=>c(u,"avgRevenue","Average Value Analysis"),children:$(l)})},{key:"avgDaysTaken",header:"Avg Days to Convert",align:"center",sortable:!0,render:(l,u)=>e.jsx("span",{className:"text-sm font-medium text-slate-700 cursor-pointer hover:text-indigo-600 hover:underline",onClick:()=>c(u,"avgDaysTaken","Conversion Timeline"),children:l>0?`${l.toFixed(1)} days`:"N/A"})},{key:"avgVisitsPostTrial",header:"Avg Visits",align:"center",sortable:!0,render:(l,u)=>e.jsx("span",{className:"text-sm font-medium text-slate-700 cursor-pointer hover:text-indigo-600 hover:underline",onClick:()=>c(u,"avgVisitsPostTrial","Visit Patterns"),children:l.toFixed(1)})}],[N]);const g=H.useMemo(()=>{const n=r.reduce((i,t)=>i+t.newClientsCount,0),l=r.reduce((i,t)=>i+t.totalRevenue,0),u=n>0?l/n:0;return{membershipType:"TOTAL",clientType:"All Types",units:r.reduce((i,t)=>i+t.units,0),newClientsCount:n,clientTypes:{},totalRevenue:l,avgRevenue:u,avgDaysTaken:r.length>0?r.reduce((i,t)=>i+t.avgDaysTaken*t.newClientsCount,0)/n:0,avgVisitsPostTrial:n>0?r.reduce((i,t)=>i+t.avgVisitsPostTrial*t.newClientsCount,0)/n:0,avgLTV:0,totalLTV:0}},[r]),T=H.useMemo(()=>A?[...r].sort((l,u)=>{const i=l[A],t=u[A],s=I==="asc"?1:-1;return typeof i=="number"&&typeof t=="number"?(i-t)*s:String(i??"").localeCompare(String(t??""))*s}):r,[r,A,I]),m=H.useMemo(()=>{if(r.length===0)return null;const n=[...r].sort((t,s)=>s.units-t.units)[0],l=[...r].sort((t,s)=>s.totalRevenue-t.totalRevenue)[0],u=[...r].filter(t=>t.avgDaysTaken>0).sort((t,s)=>t.avgDaysTaken-s.avgDaysTaken)[0];return{topByUnits:n,topByRevenue:l,fastestConversion:u,getLabel:t=>N==="membership"?t.membershipType:N==="clientType"?t.clientType:`${t.membershipType} (${t.clientType})`}},[r,N]);return e.jsxs(X,{className:"bg-white shadow-lg border-0",children:[e.jsx(ee,{className:"border-b border-gray-100 bg-gradient-to-r from-indigo-800 via-indigo-900 to-indigo-800 text-white",children:e.jsxs(te,{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(Re,{className:"w-5 h-5"}),"New Client Membership Purchases",e.jsxs(K,{variant:"secondary",className:"bg-white/20 text-white",children:[U.length," New Clients"]}),e.jsxs(K,{variant:"secondary",className:"bg-white/20 text-white",children:[r.length," ",N==="detailed"?"Rows":N==="membership"?"Memberships":"Client Types"]})]})}),e.jsx(_,{className:"p-0",children:r.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No membership purchase data available for new clients."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-slate-50 border-b border-slate-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Group By:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{size:"sm",variant:N==="detailed"?"default":"outline",onClick:()=>P("detailed"),className:N==="detailed"?"bg-indigo-600 hover:bg-indigo-700":"",children:"Detailed View"}),e.jsx(q,{size:"sm",variant:N==="membership"?"default":"outline",onClick:()=>P("membership"),className:N==="membership"?"bg-indigo-600 hover:bg-indigo-700":"",children:"By Membership"}),e.jsx(q,{size:"sm",variant:N==="clientType"?"default":"outline",onClick:()=>P("clientType"),className:N==="clientType"?"bg-indigo-600 hover:bg-indigo-700":"",children:"By Client Type"})]}),e.jsxs("span",{className:"text-xs text-slate-500 ml-auto",children:[N==="detailed"&&"Showing all membership + client type combinations",N==="membership"&&"Aggregated by membership type across all client types",N==="clientType"&&"Aggregated by client type across all memberships"]})]})}),e.jsx("div",{className:"overflow-auto",style:{maxHeight:"600px"},children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white",children:[N!=="clientType"&&e.jsx("th",{className:"text-left py-2 px-3 text-xs font-semibold uppercase tracking-wider border-r border-slate-700",style:{width:"300px",minWidth:"300px",maxHeight:"35px"},children:"Membership Type"}),N!=="membership"&&e.jsx("th",{className:"text-left py-2 px-3 text-xs font-semibold uppercase tracking-wider border-r border-slate-700",style:{width:"100px",minWidth:"100px",maxHeight:"35px"},children:"Client Type"}),e.jsx("th",{className:"text-center py-2 px-3 text-xs font-semibold uppercase tracking-wider border-r border-slate-700",style:{width:"100px",minWidth:"100px",maxHeight:"35px"},children:"Units"}),e.jsx("th",{className:"text-center py-2 px-3 text-xs font-semibold uppercase tracking-wider border-r border-slate-700",style:{width:"100px",minWidth:"100px",maxHeight:"35px"},children:"Clients"}),e.jsx("th",{className:"text-right py-2 px-3 text-xs font-semibold uppercase tracking-wider border-r border-slate-700",style:{width:"100px",minWidth:"100px",maxHeight:"35px"},children:"Total Value"}),e.jsx("th",{className:"text-right py-2 px-3 text-xs font-semibold uppercase tracking-wider border-r border-slate-700",style:{width:"100px",minWidth:"100px",maxHeight:"35px"},children:"Avg Value"}),e.jsx("th",{className:"text-center py-2 px-3 text-xs font-semibold uppercase tracking-wider border-r border-slate-700",style:{width:"100px",minWidth:"100px",maxHeight:"35px"},children:"Avg Days"}),e.jsx("th",{className:"text-center py-2 px-3 text-xs font-semibold uppercase tracking-wider",style:{width:"100px",minWidth:"100px",maxHeight:"35px"},children:"Avg Visits"})]})}),e.jsxs("tbody",{children:[T.map((n,l)=>e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-slate-50 transition-colors",style:{maxHeight:"35px"},children:[N!=="clientType"&&e.jsx("td",{className:"py-2 px-3 text-sm text-slate-700 font-medium border-r border-gray-200 cursor-pointer hover:text-indigo-600 hover:underline truncate",style:{maxHeight:"35px"},onClick:()=>c(n,"membershipType","Membership Overview"),children:n.membershipType}),N!=="membership"&&e.jsx("td",{className:"py-2 px-3 text-sm text-slate-600 border-r border-gray-200 cursor-pointer hover:text-indigo-600 hover:underline truncate",style:{maxHeight:"35px"},onClick:()=>c(n,"clientType","Client Type Analysis"),children:n.clientType}),e.jsx("td",{className:"py-2 px-3 text-sm text-center text-slate-700 border-r border-gray-200 cursor-pointer hover:text-indigo-600 hover:underline",style:{maxHeight:"35px"},onClick:()=>c(n,"units","Units Sold Analysis"),children:R(n.units)}),e.jsx("td",{className:"py-2 px-3 text-sm text-center text-slate-700 border-r border-gray-200 cursor-pointer hover:text-indigo-600 hover:underline",style:{maxHeight:"35px"},onClick:()=>c(n,"newClientsCount","Client Details"),children:R(n.newClientsCount)}),e.jsx("td",{className:"py-2 px-3 text-sm text-right text-slate-700 font-medium border-r border-gray-200 cursor-pointer hover:text-indigo-600 hover:underline",style:{maxHeight:"35px"},onClick:()=>c(n,"totalRevenue","Revenue Breakdown"),children:$(n.totalRevenue)}),e.jsx("td",{className:"py-2 px-3 text-sm text-right text-slate-700 border-r border-gray-200 cursor-pointer hover:text-indigo-600 hover:underline",style:{maxHeight:"35px"},onClick:()=>c(n,"avgRevenue","Average Value Analysis"),children:$(n.avgRevenue)}),e.jsx("td",{className:"py-2 px-3 text-sm text-center text-slate-700 border-r border-gray-200 cursor-pointer hover:text-indigo-600 hover:underline",style:{maxHeight:"35px"},onClick:()=>c(n,"avgDaysTaken","Conversion Timeline"),children:n.avgDaysTaken>0?`${n.avgDaysTaken.toFixed(1)}`:"N/A"}),e.jsx("td",{className:"py-2 px-3 text-sm text-center text-slate-700 cursor-pointer hover:text-indigo-600 hover:underline",style:{maxHeight:"35px"},onClick:()=>c(n,"avgVisitsPostTrial","Visit Patterns"),children:n.avgVisitsPostTrial.toFixed(1)})]},l)),e.jsxs("tr",{className:"bg-slate-100 font-bold border-t-2 border-slate-300",style:{maxHeight:"35px"},children:[N!=="clientType"&&e.jsx("td",{className:"py-2 px-3 text-sm text-slate-900 border-r border-slate-300",style:{maxHeight:"35px"},children:g.membershipType}),N!=="membership"&&e.jsx("td",{className:"py-2 px-3 text-sm text-slate-900 border-r border-slate-300",style:{maxHeight:"35px"},children:g.clientType}),e.jsx("td",{className:"py-2 px-3 text-sm text-center text-slate-900 border-r border-slate-300",style:{maxHeight:"35px"},children:R(g.units)}),e.jsx("td",{className:"py-2 px-3 text-sm text-center text-slate-900 border-r border-slate-300",style:{maxHeight:"35px"},children:R(g.newClientsCount)}),e.jsx("td",{className:"py-2 px-3 text-sm text-right text-slate-900 font-semibold border-r border-slate-300",style:{maxHeight:"35px"},children:$(g.totalRevenue)}),e.jsx("td",{className:"py-2 px-3 text-sm text-right text-slate-900 border-r border-slate-300",style:{maxHeight:"35px"},children:$(g.avgRevenue)}),e.jsx("td",{className:"py-2 px-3 text-sm text-center text-slate-900 border-r border-slate-300",style:{maxHeight:"35px"},children:g.avgDaysTaken>0?g.avgDaysTaken.toFixed(1):"N/A"}),e.jsx("td",{className:"py-2 px-3 text-sm text-center text-slate-900",style:{maxHeight:"35px"},children:g.avgVisitsPostTrial.toFixed(1)})]})]})]})}),m&&e.jsxs("div",{className:"border-t border-slate-200 p-6 bg-gradient-to-br from-slate-50 to-indigo-50",children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-indigo-600"}),"Key Insights"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Most Popular"}),e.jsx("p",{className:"text-sm font-semibold text-slate-800",children:m.getLabel(m.topByUnits)}),e.jsxs("p",{className:"text-xs text-slate-600 mt-1",children:[R(m.topByUnits.units)," units sold to ",R(m.topByUnits.newClientsCount)," clients"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Highest Revenue"}),e.jsx("p",{className:"text-sm font-semibold text-slate-800",children:m.getLabel(m.topByRevenue)}),e.jsxs("p",{className:"text-xs text-slate-600 mt-1",children:[$(m.topByRevenue.totalRevenue)," total value"]})]}),m.fastestConversion&&e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200 shadow-sm",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Fastest Conversion"}),e.jsx("p",{className:"text-sm font-semibold text-slate-800",children:m.getLabel(m.fastestConversion)}),e.jsxs("p",{className:"text-xs text-slate-600 mt-1",children:["Avg ",m.fastestConversion.avgDaysTaken.toFixed(1)," days to convert"]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-100 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-800",children:[e.jsx("strong",{children:"Note:"}),' This table shows memberships purchased by new clients post-trial. "Units Sold" represents the total number of membership purchases, while "New Clients" shows unique buyers. Values are based on client LTV. Average days to convert is calculated only for clients who completed conversion.']})})]})]})}),e.jsx(Ke,{open:!!x,onOpenChange:()=>L(null),children:e.jsx(Be,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:x&&e.jsxs(e.Fragment,{children:[e.jsxs(Oe,{children:[e.jsxs(Ye,{className:"flex items-center gap-2 text-xl",children:[e.jsx(Re,{className:"w-6 h-6 text-indigo-600"}),x.fieldLabel," - ",x.membershipType]}),e.jsx(Ge,{children:"Detailed analysis and client breakdown for this membership type"})]}),e.jsxs("div",{className:"space-y-6 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(se,{className:"w-4 h-4 text-blue-600"}),e.jsx("p",{className:"text-xs font-medium text-blue-800",children:"Total Clients"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:R(x.stats.newClientsCount)}),e.jsxs("p",{className:"text-xs text-blue-700 mt-1",children:[R(x.stats.units)," units sold"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{className:"w-4 h-4 text-green-600"}),e.jsx("p",{className:"text-xs font-medium text-green-800",children:"Total Value"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:$(x.stats.totalRevenue)}),e.jsxs("p",{className:"text-xs text-green-700 mt-1",children:[$(x.stats.avgRevenue)," avg per client"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(oe,{className:"w-4 h-4 text-purple-600"}),e.jsx("p",{className:"text-xs font-medium text-purple-800",children:"Conversion Time"})]}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:x.stats.avgDaysTaken>0?`${x.stats.avgDaysTaken.toFixed(1)}`:"N/A"}),e.jsx("p",{className:"text-xs text-purple-700 mt-1",children:"days average"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 p-4 rounded-lg border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-orange-600"}),e.jsx("p",{className:"text-xs font-medium text-orange-800",children:"Conversion Rate"})]}),e.jsx("p",{className:"text-2xl font-bold text-orange-900",children:x.stats.avgVisitsPostTrial.toFixed(1)}),e.jsx("p",{className:"text-xs text-orange-700 mt-1",children:"avg visits post-trial"})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-teal-50 to-teal-100 p-4 rounded-lg border border-teal-200",children:[e.jsxs("h4",{className:"text-sm font-semibold text-teal-900 mb-2 flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-teal-600"}),"Client Segment"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-lg text-teal-800 font-bold",children:x.stats.clientType}),e.jsxs("span",{className:"text-sm text-teal-700",children:[x.clients.length," clients (100%)"]})]}),e.jsx("p",{className:"text-xs text-teal-700 mt-2",children:"All clients in this analysis belong to the same type segment for targeted insights."})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-50 to-indigo-50 p-6 rounded-lg border border-slate-200",children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-indigo-600"}),"Contextual Insights"]}),e.jsxs("div",{className:"space-y-3 text-sm text-slate-700",children:[x.field==="membershipType"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["• This membership has been purchased by ",e.jsx("strong",{children:x.clients.length})," unique new clients, generating a total LTV of ",e.jsx("strong",{children:$(x.stats.totalRevenue)}),"."]}),e.jsxs("p",{children:["• On average, clients visit ",e.jsx("strong",{children:x.stats.avgVisitsPostTrial.toFixed(1)})," times post-trial before making their purchase decision."]}),x.stats.avgDaysTaken>0&&e.jsxs("p",{children:["• The conversion timeline averages ",e.jsxs("strong",{children:[x.stats.avgDaysTaken.toFixed(1)," days"]}),", suggesting ",x.stats.avgDaysTaken<=14?"quick decision-making":x.stats.avgDaysTaken<=30?"moderate consideration time":"extended evaluation period","."]})]}),x.field==="units"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["• A total of ",e.jsx("strong",{children:x.stats.units})," units of this membership have been sold to ",e.jsx("strong",{children:x.clients.length})," new clients."]}),e.jsxs("p",{children:["• This represents an average of ",e.jsx("strong",{children:(x.stats.units/x.clients.length).toFixed(2)})," purchases per client, indicating ",x.stats.units/x.clients.length>1?"multiple purchases or renewals":"single purchase behavior","."]}),e.jsxs("p",{children:["• The membership is generating ",e.jsx("strong",{children:$(x.stats.avgRevenue)})," in average value per client."]})]}),x.field==="newClientsCount"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:x.clients.length})," clients of type ",e.jsx("strong",{children:x.stats.clientType})," have chosen this membership since their trial period."]}),e.jsxs("p",{children:["• Client distribution: ",x.clients.filter(n=>n.conversionStatus==="Converted").length," converted, ",x.clients.filter(n=>n.retentionStatus==="Retained").length," retained."]}),e.jsxs("p",{children:["• All clients in this segment are classified as: ",e.jsx("strong",{children:x.stats.clientType})]}),e.jsxs("p",{children:["• Popular locations: ",(()=>{const n=x.clients.reduce((u,i)=>{const t=i.homeLocation||"Unknown";return u[t]=(u[t]||0)+1,u},{}),l=Object.entries(n).sort((u,i)=>i[1]-u[1])[0];return`${l?.[0]} (${l?.[1]} clients)`})()]})]}),x.field==="clientType"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["• This segment represents ",e.jsx("strong",{children:x.stats.clientType})," clients who purchased ",e.jsx("strong",{children:x.stats.membershipType}),"."]}),e.jsxs("p",{children:["• Segment size: ",e.jsx("strong",{children:x.clients.length})," clients generating ",$(x.stats.totalRevenue)," in total value."]}),e.jsxs("p",{children:["• Average value per client: ",e.jsx("strong",{children:$(x.stats.avgRevenue)})," with ",x.stats.avgVisitsPostTrial.toFixed(1)," average visits."]}),e.jsxs("p",{children:["• Engagement status: ",x.clients.filter(n=>n.conversionStatus==="Converted").length," converted clients, ",x.clients.filter(n=>n.retentionStatus==="Retained").length," retained"]}),e.jsxs("p",{children:["• Client type insight: ",(()=>{const n=x.stats.clientType.toLowerCase();return n.includes("new")?"New clients typically show higher engagement and are building their relationship with the studio.":n.includes("return")||n.includes("existing")?"Returning clients demonstrate loyalty and familiarity with the studio offerings.":"This client segment shows unique engagement patterns worth monitoring."})()]})]}),x.field==="totalRevenue"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["• Total lifetime value from this membership: ",e.jsx("strong",{children:$(x.stats.totalRevenue)})]}),e.jsxs("p",{children:["• Revenue distribution: ",$(x.stats.avgRevenue)," average per client with ",x.clients.length," contributing clients."]}),e.jsxs("p",{children:["• Top contributors: ",(()=>{const u=[...x.clients].sort((t,s)=>(s.ltv||0)-(t.ltv||0)).slice(0,3).reduce((t,s)=>t+(s.ltv||0),0),i=x.stats.totalRevenue>0?u/x.stats.totalRevenue*100:0;return`Top 3 clients contribute ${ne(i)}`})()]})]}),x.field==="avgRevenue"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["• Average client value: ",e.jsx("strong",{children:$(x.stats.avgRevenue)})]}),e.jsxs("p",{children:["• Value range: ",$(Math.min(...x.clients.map(n=>n.ltv||0)))," to ",$(Math.max(...x.clients.map(n=>n.ltv||0)))]}),e.jsxs("p",{children:["• Median value: ",e.jsx("strong",{children:$((()=>{const n=[...x.clients].map(l=>l.ltv||0).sort((l,u)=>l-u);return n[Math.floor(n.length/2)]})())}),", indicating ",(()=>{const n=[...x.clients].map(l=>l.ltv||0).sort((l,u)=>l-u)[Math.floor(x.clients.length/2)];return x.stats.avgRevenue>n*1.2?"some high-value outliers":"balanced distribution"})()]})]}),x.field==="avgDaysTaken"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["• Average conversion time: ",e.jsx("strong",{children:x.stats.avgDaysTaken>0?`${x.stats.avgDaysTaken.toFixed(1)} days`:"Not available"})]}),x.stats.avgDaysTaken>0&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["• Fastest conversion: ",Math.min(...x.clients.filter(n=>n.conversionSpan>0).map(n=>n.conversionSpan))," days | Slowest: ",Math.max(...x.clients.filter(n=>n.conversionSpan>0).map(n=>n.conversionSpan))," days"]}),e.jsxs("p",{children:["• ",x.clients.filter(n=>n.conversionSpan>0&&n.conversionSpan<=7).length," clients (",ne(x.clients.filter(n=>n.conversionSpan>0&&n.conversionSpan<=7).length/x.clients.filter(n=>n.conversionSpan>0).length*100),") converted within first week"]}),e.jsxs("p",{children:["• Sales cycle insight: ",x.stats.avgDaysTaken<=14?"Short decision cycle - effective for immediate promotions":x.stats.avgDaysTaken<=30?"Moderate consideration - nurture campaigns recommended":"Long evaluation - focus on building trust and value demonstration"]})]})]}),x.field==="avgVisitsPostTrial"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["• Average visits post-trial: ",e.jsx("strong",{children:x.stats.avgVisitsPostTrial.toFixed(1)})]}),e.jsxs("p",{children:["• Visit distribution: ",x.clients.filter(n=>(n.visitsPostTrial||0)>=x.stats.avgVisitsPostTrial).length," clients above average, ",x.clients.filter(n=>(n.visitsPostTrial||0)<x.stats.avgVisitsPostTrial).length," below"]}),e.jsxs("p",{children:["• Engagement pattern: ",x.stats.avgVisitsPostTrial>=10?"High engagement - clients are actively trying the service before committing":x.stats.avgVisitsPostTrial>=5?"Moderate engagement - healthy trial period utilization":"Quick decision - minimal trial needed before purchase"]})]}),x.field==="clientType"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["• Client type: ",e.jsx("strong",{children:x.stats.clientType})," (",x.clients.length," clients)"]}),e.jsxs("p",{children:["• Conversion status: ",x.clients.filter(n=>n.conversionStatus==="Converted").length," converted clients"]}),e.jsxs("p",{children:["• Retention correlation: ",x.clients.filter(n=>n.retentionStatus==="Retained").length," clients (",ne(x.clients.filter(n=>n.retentionStatus==="Retained").length/x.clients.length*100),") are retained, indicating ",x.clients.filter(n=>n.retentionStatus==="Retained").length/x.clients.length>=.5?"strong long-term engagement":"potential retention challenges"]})]})]})]}),e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg",children:[e.jsx("div",{className:"bg-slate-100 px-4 py-3 border-b border-slate-200",children:e.jsxs("h4",{className:"text-sm font-semibold text-slate-800",children:["Client Details (",x.clients.length," clients)"]})}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-slate-600",children:"Client"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-slate-600",children:"Client Type"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-slate-600",children:"Location"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-slate-600",children:"LTV"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-slate-600",children:"Visits"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-slate-600",children:"Days to Convert"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-slate-600",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200",children:x.clients.map((n,l)=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsxs("td",{className:"px-4 py-2 text-slate-700",children:[e.jsxs("div",{className:"font-medium",children:[n.firstName," ",n.lastName]}),e.jsx("div",{className:"text-xs text-slate-500",children:n.email})]}),e.jsx("td",{className:"px-4 py-2 text-slate-600 text-xs",children:n.isNew||"Unknown"}),e.jsx("td",{className:"px-4 py-2 text-slate-600",children:n.homeLocation||"N/A"}),e.jsx("td",{className:"px-4 py-2 text-center text-slate-700 font-medium",children:$(n.ltv||0)}),e.jsx("td",{className:"px-4 py-2 text-center text-slate-700",children:n.visitsPostTrial||0}),e.jsx("td",{className:"px-4 py-2 text-center text-slate-700",children:n.conversionSpan>0?`${n.conversionSpan} days`:"N/A"}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-slate-600",children:n.conversionStatus}),e.jsx("span",{className:"text-xs text-slate-600",children:n.retentionStatus})]})})]},l))})]})})]})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-slate-200",children:e.jsx(q,{onClick:()=>L(null),variant:"outline",children:"Close"})})]})})})]})},Fs=()=>{const{data:C,loading:A}=Je(),{loading:E}=Xe(),{data:I,isLoading:V}=_e(),{isLoading:x,setLoading:L}=We();qe();const[N,P]=D.useState("Kwality House, Kemps Corner"),[U,f]=D.useState("monthonmonthbytype"),[r,c]=D.useState("conversion"),[g,T]=D.useState({isOpen:!1,client:null,title:"",data:null,type:"month"}),[m,n]=D.useState(()=>{const a=Qe();return{dateRange:{start:a.start,end:a.end},location:[],homeLocation:[],trainer:[],paymentMethod:[],retentionStatus:[],conversionStatus:[],isNew:[],minLTV:void 0,maxLTV:void 0}});D.useEffect(()=>{L(A||E||V,"Analyzing client conversion and retention patterns...")},[A,E,V,L]);const l=D.useMemo(()=>{if(!I||I.length===0)return[];let a=I;if(N!=="All Locations"&&(a=a.filter(o=>{const y=o.location||"";return N==="Kenkere House, Bengaluru"?y.toLowerCase().includes("kenkere")||y.toLowerCase().includes("bengaluru")||y==="Kenkere House":y===N})),m.dateRange.start&&m.dateRange.end){const o=new Date(m.dateRange.start+"T00:00:00"),y=new Date(m.dateRange.end+"T23:59:59");a=a.filter(S=>{if(!S.monthYear)return!1;let M;return S.monthYear.includes("-")?M=new Date(S.monthYear+"-01"):M=new Date(S.monthYear+" 01"),isNaN(M.getTime())?!1:M>=o&&M<=y})}return m.trainer.length>0&&(a=a.filter(o=>m.trainer.includes(o.teacherName||""))),a},[I,N,m]),u=D.useMemo(()=>{if(!l||l.length===0)return{};const a={};return l.forEach(o=>{if(o.monthYear&&o.totalCustomers){const y=o.monthYear;a[y]=(a[y]||0)+o.totalCustomers}}),a},[l]),i=D.useMemo(()=>{if(!I||I.length===0)return[];let a=I;return N!=="All Locations"&&(a=a.filter(o=>{const y=o.location||"";return N==="Kenkere House, Bengaluru"?y.toLowerCase().includes("kenkere")||y.toLowerCase().includes("bengaluru")||y==="Kenkere House":y===N})),m.trainer.length>0&&(a=a.filter(o=>m.trainer.includes(o.teacherName||""))),a},[I,N,m.trainer]),t=D.useMemo(()=>{if(!i||i.length===0)return{};const a={};return i.forEach(o=>{if(o.monthYear&&o.totalCustomers){const y=o.monthYear;a[y]=(a[y]||0)+o.totalCustomers}}),a},[i]),s=H.useMemo(()=>{const a=["Kwality House, Kemps Corner","Supreme HQ, Bandra","Kenkere House, Bengaluru"],o=new Set;return C.forEach(y=>{y.firstVisitLocation&&a.includes(y.firstVisitLocation)&&o.add(y.firstVisitLocation),y.homeLocation&&a.includes(y.homeLocation)&&o.add(y.homeLocation)}),Array.from(o).filter(Boolean)},[C]),h=H.useMemo(()=>{const a=new Set;return C.forEach(o=>{o.trainerName&&a.add(o.trainerName)}),Array.from(a).filter(Boolean)},[C]),d=H.useMemo(()=>{const a=new Set;return C.forEach(o=>{o.membershipUsed&&a.add(o.membershipUsed)}),Array.from(a).filter(Boolean)},[C]),b=H.useMemo(()=>{let a=C;if(m.dateRange.start&&m.dateRange.end){const o=m.dateRange.start?new Date(m.dateRange.start+"T00:00:00"):null,y=m.dateRange.end?new Date(m.dateRange.end+"T23:59:59"):null;a=a.filter(S=>{if(!S.firstVisitDate)return!1;const M=he(S.firstVisitDate);return M?(M.setHours(0,0,0,0),(!o||M>=o)&&(!y||M<=y)):!1})}return N!=="All Locations"&&(a=a.filter(o=>{const y=o.firstVisitLocation||"",S=o.homeLocation||"";if(N==="Kenkere House, Bengaluru"){const M=y.toLowerCase().includes("kenkere")||y.toLowerCase().includes("bengaluru")||y==="Kenkere House",z=S.toLowerCase().includes("kenkere")||S.toLowerCase().includes("bengaluru")||S==="Kenkere House";return M||z}return y===N||S===N})),m.location.length>0&&(a=a.filter(o=>m.location.includes(o.firstVisitLocation||"")||m.location.includes(o.homeLocation||""))),m.trainer.length>0&&(a=a.filter(o=>m.trainer.includes(o.trainerName||""))),m.conversionStatus.length>0&&(a=a.filter(o=>m.conversionStatus.includes(o.conversionStatus||""))),m.retentionStatus.length>0&&(a=a.filter(o=>m.retentionStatus.includes(o.retentionStatus||""))),m.paymentMethod.length>0&&(a=a.filter(o=>m.paymentMethod.includes(o.paymentMethod||""))),m.isNew.length>0&&(a=a.filter(o=>m.isNew.includes(o.isNew||""))),m.minLTV!==void 0&&(a=a.filter(o=>(o.ltv||0)>=m.minLTV)),m.maxLTV!==void 0&&(a=a.filter(o=>(o.ltv||0)<=m.maxLTV)),a},[C,N,m]),p=H.useMemo(()=>{let a=C;if(m.dateRange.start&&m.dateRange.end){const o=m.dateRange.start?new Date(m.dateRange.start+"T00:00:00"):null,y=m.dateRange.end?new Date(m.dateRange.end+"T23:59:59"):null;a=a.filter(S=>{if(!S.firstVisitDate)return!1;const M=he(S.firstVisitDate);return M?(M.setHours(0,0,0,0),(!o||M>=o)&&(!y||M<=y)):!1})}return m.location.length>0&&(a=a.filter(o=>m.location.includes(o.firstVisitLocation||"")||m.location.includes(o.homeLocation||""))),m.trainer.length>0&&(a=a.filter(o=>m.trainer.includes(o.trainerName||""))),m.conversionStatus.length>0&&(a=a.filter(o=>m.conversionStatus.includes(o.conversionStatus||""))),m.retentionStatus.length>0&&(a=a.filter(o=>m.retentionStatus.includes(o.retentionStatus||""))),m.paymentMethod.length>0&&(a=a.filter(o=>m.paymentMethod.includes(o.paymentMethod||""))),m.isNew.length>0&&(a=a.filter(o=>m.isNew.includes(o.isNew||""))),m.minLTV!==void 0&&(a=a.filter(o=>(o.ltv||0)>=m.minLTV)),m.maxLTV!==void 0&&(a=a.filter(o=>(o.ltv||0)<=m.maxLTV)),a},[C,m]);H.useMemo(()=>{const a=F=>F.toLowerCase().includes("kenkere")||F.toLowerCase().includes("bengaluru")||F==="Kenkere House",o=F=>p.filter(F).length,y=p.length,S=o(F=>F.firstVisitLocation==="Kwality House, Kemps Corner"||F.homeLocation==="Kwality House, Kemps Corner"),M=o(F=>F.firstVisitLocation==="Supreme HQ, Bandra"||F.homeLocation==="Supreme HQ, Bandra"),z=o(F=>a(F.firstVisitLocation||"")||a(F.homeLocation||""));return{all:y,kwality:S,supreme:M,kenkere:z}},[p]);const v=H.useMemo(()=>{let a=C;return N!=="All Locations"&&(a=a.filter(o=>{const y=o.firstVisitLocation||"",S=o.homeLocation||"";if(N==="Kenkere House, Bengaluru"){const M=y.toLowerCase().includes("kenkere")||y.toLowerCase().includes("bengaluru")||y==="Kenkere House",z=S.toLowerCase().includes("kenkere")||S.toLowerCase().includes("bengaluru")||S==="Kenkere House";return M||z}return y===N||S===N})),m.location.length>0&&(a=a.filter(o=>m.location.includes(o.firstVisitLocation||"")||m.location.includes(o.homeLocation||""))),m.trainer.length>0&&(a=a.filter(o=>m.trainer.includes(o.trainerName||""))),m.conversionStatus.length>0&&(a=a.filter(o=>m.conversionStatus.includes(o.conversionStatus||""))),m.retentionStatus.length>0&&(a=a.filter(o=>m.retentionStatus.includes(o.retentionStatus||""))),m.paymentMethod.length>0&&(a=a.filter(o=>m.paymentMethod.includes(o.paymentMethod||""))),m.isNew.length>0&&(a=a.filter(o=>m.isNew.includes(o.isNew||""))),m.minLTV!==void 0&&(a=a.filter(o=>(o.ltv||0)>=m.minLTV)),m.maxLTV!==void 0&&(a=a.filter(o=>(o.ltv||0)<=m.maxLTV)),a},[C,N,m]),w=D.useMemo(()=>{if(!b||b.length===0)return[];const a=b.length,o=b.filter(B=>String(B.isNew||"").toLowerCase().includes("new")).length,y=b.filter(B=>B.conversionStatus==="Converted").length,S=b.filter(B=>B.retentionStatus==="Retained").length,M=o>0?y/o*100:0,z=o>0?S/o*100:0,F=b.reduce((B,Y)=>B+(Y.ltv||0),0),J=a>0?F/a:0;return[{location:"Overview",label:"Total Trials",value:R(a),subtext:`${R(o)} new members`},{location:"Conversion",label:"Conversion Rate",value:ne(M),subtext:`${R(y)} converted`},{location:"Retention",label:"Retention Rate",value:ne(z),subtext:`${R(S)} retained`},{location:"LTV",label:"Avg LTV",value:$(J),subtext:`${$(F)} total`}]},[b]),k=H.useMemo(()=>{const a=[],o=[],y=[],S=[],M=[];[...new Set(v.map(Y=>Y.isNew||"Unknown"))].forEach(Y=>{const G=v.filter(O=>(O.isNew||"Unknown")===Y);a.push({"Client Type":Y,"Total Trials":G.length,"New Members":G.filter(O=>String(O.isNew||"").toLowerCase().includes("new")).length,Converted:G.filter(O=>O.conversionStatus==="Converted").length,Retained:G.filter(O=>O.retentionStatus==="Retained").length,"Total LTV":$(G.reduce((O,Q)=>O+(Q.ltv||0),0))})}),[...new Set(v.map(Y=>Y.membershipUsed||"Unknown"))].forEach(Y=>{const G=v.filter(O=>(O.membershipUsed||"Unknown")===Y);o.push({"Membership Type":Y,"Total Trials":G.length,"New Members":G.filter(O=>String(O.isNew||"").toLowerCase().includes("new")).length,Converted:G.filter(O=>O.conversionStatus==="Converted").length,Retained:G.filter(O=>O.retentionStatus==="Retained").length,"Total LTV":$(G.reduce((O,Q)=>O+(Q.ltv||0),0))})});const J=v.filter(Y=>String(Y.isNew||"").toLowerCase().includes("new")),B={};return J.forEach(Y=>{const G=Y.membershipsBoughtPostTrial||"No Membership Purchase",O=G.split(",").map(Q=>Q.trim()).filter(Q=>Q);if(O.length===0||G===""){B["No Membership Purchase"]||(B["No Membership Purchase"]={units:0,clients:new Set,totalLTV:0,conversionSpans:[],visitsPostTrial:[],convertedClients:0}),B["No Membership Purchase"].clients.add(Y.memberId),B["No Membership Purchase"].totalLTV+=Y.ltv||0;return}O.forEach(Q=>{B[Q]||(B[Q]={units:0,clients:new Set,totalLTV:0,conversionSpans:[],visitsPostTrial:[],convertedClients:0}),B[Q].units++,B[Q].clients.add(Y.memberId),B[Q].totalLTV+=Y.ltv||0,Y.conversionStatus==="Converted"&&(B[Q].convertedClients++,Y.conversionSpan&&Y.conversionSpan>0&&B[Q].conversionSpans.push(Y.conversionSpan)),Y.visitsPostTrial&&B[Q].visitsPostTrial.push(Y.visitsPostTrial)})}),Object.entries(B).forEach(([Y,G])=>{const O=G.clients.size,Q=G.conversionSpans.length>0?G.conversionSpans.reduce((ue,ge)=>ue+ge,0)/G.conversionSpans.length:0,Fe=G.visitsPostTrial.length>0?G.visitsPostTrial.reduce((ue,ge)=>ue+ge,0)/G.visitsPostTrial.length:0,Ee=O>0?G.convertedClients/O*100:0;M.push({"Membership Type":Y,"Units Sold":G.units,"New Clients":O,"Total Value (LTV)":$(G.totalLTV),"Avg Value":$(O>0?G.totalLTV/O:0),"Avg Days to Convert":Q>0?`${Q.toFixed(1)} days`:"N/A","Avg Visits":Fe.toFixed(1),"Conversion %":`${Ee.toFixed(1)}%`})}),{"Client Retention • Month on Month by Type":a,"Client Retention • Year on Year":o,"Client Retention • Memberships":y,"Client Retention • Hosted Classes":S,"Client Retention • New Client Purchases":M}},[v]),j=e.jsx(tt,{additionalData:k,defaultFileName:`client-retention-${N.replace(/\s+/g,"-").toLowerCase()}`,size:"sm",variant:"ghost",buttonClassName:"rounded-xl border border-white/30 text-white hover:border-white/50"});return e.jsxs("div",{className:"min-h-screen bg-white relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute top-20 left-10 w-96 h-96 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-full floating-animation stagger-1"}),e.jsx("div",{className:"absolute bottom-20 right-10 w-80 h-80 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-full floating-animation stagger-3"}),e.jsx("div",{className:"absolute top-1/2 left-1/3 w-72 h-72 bg-gradient-to-r from-cyan-500/10 to-teal-500/10 rounded-full morph-shape stagger-2"})]}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"bg-white text-slate-800 slide-in-from-left",children:e.jsx(st,{title:"Client Conversion & Retention",subtitle:"Comprehensive client acquisition and retention analysis across all customer touchpoints",metrics:w,extra:j})}),e.jsxs("div",{className:"container mx-auto px-6 py-8 bg-white min-h-screen",children:[e.jsxs("main",{className:"space-y-8 slide-in-from-right stagger-1",children:[e.jsx(Rt,{}),e.jsx(et,{activeLocation:N==="All Locations"?"all":N.toLowerCase().includes("kwality")?"kwality":N.toLowerCase().includes("supreme")?"supreme":N.toLowerCase().includes("kenkere")?"kenkere":"all",onLocationChange:a=>{P({all:"All Locations",kwality:"Kwality House, Kemps Corner",supreme:"Supreme HQ, Bandra",kenkere:"Kenkere House, Bengaluru"}[a]||"All Locations")},showInfoPopover:!0,infoPopoverContext:"client-retention-overview"}),e.jsx("div",{className:"glass-card modern-card-hover p-6 rounded-2xl",id:"filters",children:e.jsx(Lt,{filters:m,onFiltersChange:n,locations:s,trainers:h,membershipTypes:d})}),e.jsx("div",{id:"metrics",className:"rounded-2xl p-0",children:e.jsx(lt,{data:b,historicalData:v,dateRange:m.dateRange,onCardClick:(a,o,y)=>T({isOpen:!0,client:null,title:`${a} - Detailed Analysis`,data:{clients:o,metricType:y},type:"metric"})})}),e.jsx("div",{className:"glass-card modern-card-hover rounded-2xl p-6 slide-in-right stagger-3",id:"rankings",children:e.jsx(Vt,{data:b,payrollData:l,allPayrollData:I,allClientData:C,selectedLocation:N,dateRange:m.dateRange,selectedMetric:r,onDrillDown:(a,o,y)=>{const S=b.filter(z=>{let F=!1;return a==="trainer"?F=z.trainerName===o.name:a==="location"?F=z.firstVisitLocation===o.name||z.homeLocation===o.name:a==="membership"&&(F=z.membershipUsed===o.name),F}),M=l.filter(z=>a==="trainer"?z.teacherName===o.name:a==="location"?z.location===o.name:!1);T({isOpen:!0,client:null,title:`${o.name} - ${y} Analysis`,data:{type:a,item:o,metric:y,relatedClients:S,relatedPayroll:M},type:"ranking"})}})}),e.jsx("div",{className:"space-y-4 slide-in-left stagger-4",id:"charts",children:e.jsx("div",{className:"glass-card rounded-2xl border-0 shadow-lg",children:e.jsxs("details",{className:"group",children:[e.jsx("summary",{className:"cursor-pointer p-6 font-semibold text-slate-800 border-b border-white/20 group-open:bg-gradient-to-r group-open:from-purple-50/50 group-open:to-pink-50/50 rounded-t-2xl transition-all duration-300",children:"📊 Interactive Charts & Visualizations"}),e.jsx("div",{className:"p-6 bg-gradient-to-br from-white to-slate-50/50",children:e.jsx(Dt,{data:b})})]})})}),e.jsx("div",{className:"glass-card modern-card-hover rounded-2xl p-6 slide-in-right stagger-5",id:"table-selector",children:e.jsx(At,{activeTable:U,onTableChange:f,dataLength:b.length})}),e.jsxs("div",{className:"space-y-8",children:[U==="monthonmonthbytype"&&e.jsx(e.Fragment,{children:e.jsx("div",{id:"monthonmonthbytype-table",children:e.jsx(Pt,{data:b,visitsSummary:u,onRowClick:a=>T({isOpen:!0,client:null,title:`${a.month} - ${a.type} Analysis`,data:a,type:"month"})})})}),U==="monthonmonth"&&e.jsx(e.Fragment,{children:e.jsx("div",{id:"monthonmonth-table",children:e.jsx(ct,{data:v,visitsSummary:t,onRowClick:a=>T({isOpen:!0,client:null,title:`${a.type} - Analysis`,data:a,type:"month"})})})}),U==="yearonyear"&&e.jsx(e.Fragment,{children:e.jsx("div",{id:"yearonyear-table",children:e.jsx($t,{data:v,onRowClick:a=>T({isOpen:!0,client:null,title:`${a.rowKey} - Year Comparison`,data:a,type:"year"})})})}),U==="hostedclasses"&&e.jsx(e.Fragment,{children:e.jsx("div",{id:"hostedclasses-table",children:e.jsx(Et,{data:b,onRowClick:a=>T({isOpen:!0,client:null,title:`${a.className} - ${a.month}`,data:a,type:"class"})})})}),U==="memberships"&&e.jsx(e.Fragment,{children:e.jsx("div",{id:"memberships-table",children:e.jsx(Ft,{data:b})})}),U==="teacherperformance"&&e.jsx(e.Fragment,{children:e.jsx("div",{id:"teacherperformance-table",children:e.jsx(Ht,{data:b,onRowClick:a=>T({isOpen:!0,client:null,title:`${a.trainerName} - Teacher Performance Analysis`,data:{type:"trainer",item:{name:a.trainerName},metric:"performance",relatedClients:b.filter(o=>o.trainerName===a.trainerName),relatedPayroll:l.filter(o=>o.teacherName===a.trainerName)},type:"ranking"})})})}),U==="newclientpurchases"&&e.jsx(e.Fragment,{children:e.jsx("div",{id:"newclientpurchases-table",children:e.jsx(It,{data:b})})})]})]}),e.jsx(kt,{children:g.isOpen&&e.jsx(St,{isOpen:g.isOpen,onClose:()=>T({isOpen:!1,client:null,title:"",data:null,type:"month"}),title:g.title,data:g.data,type:g.type})})]})]}),e.jsx(Ze,{}),e.jsx("style",{children:`
        @keyframes fade-in-up {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        .animate-fade-in-up {
          animation: fade-in-up 0.6s ease-out forwards;
        }
        
        .delay-200 {
          animation-delay: 0.2s;
        }
        
        .delay-300 {
          animation-delay: 0.3s;
        }
        
        .delay-500 {
          animation-delay: 0.5s;
        }
      `})]})};export{Fs as default};
//# sourceMappingURL=ClientRetention-1uBV9zRl.js.map
