import{i as ct,r as M,j as e,C as Ve,a as $e,b as Ae,c as ke,f as We,B as oe,h as te,m as it,k as Qe,D as dt,l as ut,n as mt,o as ht,q as pt,s as xt,u as ft,t as Xe,g as yt,v as Oe,d as gt,G as bt}from"./index-Bm67KBkU.js";import{T as et,a as tt,b as de,c as xe}from"./tabs-BTrhdLSC.js";import{A as vt}from"./AutoCloseFilterSection-DJhjGBJF.js";import{B as De,a as ne,f as le}from"./index-DkD_C-d1.js";import{SalesDrillDownModal as wt}from"./SalesDrillDownModal-BGCrQ8FL.js";import{P as Pe}from"./package-C0br8ACw.js";import{T as ze}from"./tag-DzcNcJZD.js";import{U as ge}from"./users-7Ku-1TDB.js";import{U as Le}from"./user-check-CLHYCjic.js";import{A as jt}from"./award-D0x2LQSI.js";import{T as he}from"./trending-down-B5K1omnR.js";import{C as Nt}from"./crown-Bf6tWe5C.js";import{T as Mt}from"./trophy-ChiyFqMe.js";import{M as Ct}from"./medal-BdYY0bn6.js";import{S as ve}from"./star-qy423-d6.js";import{C as Dt,T as St}from"./thumbs-down-5G9TMNL9.js";import{E as Tt,C as Vt,a as $t,D as At,b as kt,S as at}from"./SalesMotionHero-sGphstF2.js";import{C as Se}from"./dollar-sign-CKqx8kbC.js";import{M as Pt,L as It}from"./ModalSuspense-C3SPWsdX.js";import{S as ue,M as we,a as je}from"./ModernTableWrapper-bhf1DsXx.js";import{P as Ne}from"./PersistentTableFooter-DyingoeQ.js";import{s as st,u as Ft,a as Rt,P as Et}from"./SalesAnimatedMetricCards-9SxqinUB.js";import{u as Me}from"./useTableCopyContext-DkJKZq95.js";import{C as be,T as me}from"./googleAuth-BGo8ElRc.js";import{a as nt,C as rt}from"./chevron-right-CbIMR3DA.js";import{L as Lt}from"./layers-QvpSwlwS.js";import{R as Ie,C as Bt,T as Fe,L as Ot,B as zt,a as Ye,X as qe,Y as Ue,b as Yt}from"./BarChart-o5Oeg9Jb.js";import{P as qt,a as Ut}from"./PieChart-slnvMcDg.js";import{A as Kt,a as Gt}from"./AreaChart-DQtaPzLK.js";import{C as Be}from"./credit-card-yR0Iskrq.js";import{L as Ke}from"./label-fD3fdNwH.js";import{C as Ht,F as Ge}from"./checkbox-ByePFv7I.js";import{B as He}from"./BrandSpinner-CGFi2e0U.js";import{S as _t}from"./SectionTimelineNav-aY20sFWr.js";import{A as Te}from"./activity-CeUP9h5f.js";import{C as _e}from"./clock-BP1BFskn.js";import{P as Zt}from"./percent-BAS2Szsf.js";import{S as Jt}from"./StudioLocationTabs-BSKYatd_.js";import{u as Wt}from"./useGoogleSheets-BPVLuLVa.js";import{F as Qt}from"./footer-BTvMjyAb.js";import{L as Xt}from"./LoadingSkeleton-CgB_TXJn.js";import"./select-CM-Birqk.js";import"./index-BdQq_4o_.js";import"./collapsible-bGJQ2Wb9.js";import"./ModernDataTable-Qj0casC7.js";import"./table-DhXofKdS.js";import"./tableStyles-BJWvDwDQ.js";import"./CopyTableButton-Blm2CDq4.js";import"./dropdown-menu-B9zQ9u84.js";import"./file-text-DChZNHsM.js";import"./target-BmxdxojS.js";import"./loader-circle-Bc3-I9bA.js";import"./arrow-down-right-D7rC7EMG.js";import"./minus-BzN8XxOo.js";import"./skeleton-Ccx3hRRa.js";const ot=ct("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]),ea=({data:j,onRowClick:g})=>{const[B,b]=M.useState("product"),[A,Z]=M.useState(!1),[ae,X]=M.useState(null),[E,se]=M.useState(!1),K=R=>{const k=j.reduce((V,z)=>{let C="";switch(R){case"product":C=z.cleanedProduct;break;case"category":C=z.cleanedCategory;break;case"member":C=z.customerName;break;case"seller":C=z.soldBy;break}return V[C]||(V[C]={name:C,totalValue:0,unitsSold:0,transactions:0,uniqueMembers:new Set,atv:0,auv:0,asv:0,upt:0}),V[C].totalValue+=z.paymentValue,V[C].unitsSold+=1,V[C].transactions+=1,V[C].uniqueMembers.add(z.memberId),V},{});return Object.values(k).forEach(V=>{const z=V.uniqueMembers.size;V.uniqueMembers=z,V.atv=V.transactions>0?V.totalValue/V.transactions:0,V.auv=V.unitsSold>0?V.totalValue/V.unitsSold:0,V.asv=z>0?V.totalValue/z:0,V.upt=V.transactions>0?V.unitsSold/V.transactions:0}),Object.values(k).sort((V,z)=>z.totalValue-V.totalValue)},L=R=>{switch(R){case"product":return{icon:Pe,label:"Products",description:"Individual product performance"};case"category":return{icon:ze,label:"Categories",description:"Category-wise performance"};case"member":return{icon:ge,label:"Members",description:"Customer spending patterns"};case"seller":return{icon:Le,label:"Associates",description:"Sales representative performance"};default:return{icon:Pe,label:"Products",description:"Performance data"}}},Q=(R,k,V)=>{const z=L(V);return z.icon,e.jsxs(Ve,{className:"bg-gradient-to-br from-white via-slate-50/50 to-white border-0 shadow-xl hover:shadow-2xl transition-all duration-500",children:[e.jsx($e,{className:"pb-4",children:e.jsx(Ae,{className:"flex items-center gap-3 text-xl",children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-r from-green-400 to-emerald-500",children:e.jsx(jt,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsxs("span",{className:"bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent",children:["Top ",ee," ",z.label]}),e.jsx("p",{className:"text-sm text-slate-600 font-normal",children:z.description})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-r from-red-500 to-rose-600",children:e.jsx(he,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsxs("span",{className:"bg-gradient-to-r from-red-600 to-rose-600 bg-clip-text text-transparent",children:["Bottom ",ee," ",z.label]}),e.jsx("p",{className:"text-sm text-slate-600 font-normal",children:"Areas for improvement"})]})]})})}),e.jsxs(ke,{className:"space-y-4",children:[R.map((C,D)=>e.jsxs("div",{className:`group flex items-center justify-between p-4 rounded-xl bg-white shadow-sm border hover:shadow-md transition-all duration-300 cursor-pointer ${k?"hover:border-emerald-200/70":"hover:border-rose-200/70"}`,onClick:()=>{const G=j.filter(v=>{switch(V){case"product":return v.cleanedProduct===C.name;case"category":return v.cleanedCategory===C.name;case"member":return v.customerName===C.name;case"seller":return v.soldBy===C.name;default:return!1}});g?.({...C,rawData:G,filteredTransactionData:G,type:V,title:C.name,name:C.name,grossRevenue:C.totalValue,totalRevenue:C.totalValue,totalValue:C.totalValue,totalCurrent:C.totalValue,metricValue:C.totalValue,transactions:C.transactions,totalTransactions:C.transactions,uniqueMembers:C.uniqueMembers,totalCustomers:C.uniqueMembers,totalChange:12.5,months:{},monthlyValues:{},isDynamic:!0,calculatedFromFiltered:!0})},children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:We("w-12 h-12 rounded-full flex items-center justify-center shadow-lg",k?"bg-gradient-to-br from-green-400 via-emerald-500 to-green-600 text-white":"bg-gradient-to-br from-red-500 via-rose-600 to-red-700 text-white"),children:k?D===0?e.jsx(Nt,{className:"w-6 h-6"}):D===1?e.jsx(Mt,{className:"w-6 h-6"}):D===2?e.jsx(Ct,{className:"w-5 h-5"}):D===3?e.jsx(ve,{className:"w-5 h-5"}):e.jsx("span",{className:"text-sm font-bold",children:D+1}):D===0?e.jsx(Dt,{className:"w-6 h-6"}):D===1?e.jsx(he,{className:"w-6 h-6"}):D===2?e.jsx(St,{className:"w-5 h-5"}):e.jsx("span",{className:"text-sm font-bold",children:D+1})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-slate-900 whitespace-normal break-words group-hover:text-blue-600 transition-colors",children:C.name}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsxs(De,{variant:"secondary",className:"text-xs bg-blue-50 text-blue-700 border-blue-200",children:[ne(C.transactions)," txns"]}),e.jsxs(De,{variant:"outline",className:"text-xs border-purple-200 text-purple-700",children:["ATV: ",le(C.atv)]}),e.jsxs(De,{variant:"outline",className:"text-xs border-green-200 text-green-700",children:["AUV: ",le(C.auv)]}),e.jsxs(De,{variant:"outline",className:"text-xs border-orange-200 text-orange-700",children:["ASV: ",le(C.asv)]}),e.jsxs(De,{variant:"outline",className:"text-xs border-slate-200 text-slate-700",children:["UPT: ",C.upt.toFixed(1)]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-xl text-slate-900 group-hover:text-blue-600 transition-colors",children:le(C.totalValue)}),e.jsxs("p",{className:"text-sm text-slate-500",children:[ne(C.unitsSold)," units"]}),e.jsxs("p",{className:"text-xs text-slate-400",children:[ne(C.uniqueMembers)," customers"]}),e.jsxs(oe,{variant:"ghost",size:"sm",className:"mt-1 opacity-0 group-hover:opacity-100 transition-all duration-300 hover:bg-blue-50 hover:text-blue-600 hover:shadow-sm",onClick:G=>{G.stopPropagation();const v=j.filter(n=>{switch(V){case"product":return n.cleanedProduct===C.name;case"category":return n.cleanedCategory===C.name;case"member":return n.customerName===C.name;case"seller":return n.soldBy===C.name;default:return!1}}),y={...C,rawData:v,filteredTransactionData:v,type:V,title:C.name,name:C.name,grossRevenue:C.totalValue,totalValue:C.totalValue,totalCurrent:C.totalValue,metricValue:C.totalValue,transactions:C.transactions,totalTransactions:C.transactions,uniqueMembers:C.uniqueMembers,totalCustomers:C.uniqueMembers,totalChange:0,months:{},monthlyValues:{}};X(y),se(!0)},children:[e.jsx(Tt,{className:"w-3 h-3 mr-1"}),"View Analytics"]})]})]},C.name)),e.jsxs("div",{className:"mt-6 p-4 bg-gradient-to-r from-slate-50 to-slate-100 rounded-lg border",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h4",{className:"font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),"Performance Summary"]}),e.jsxs(oe,{variant:"outline",size:"sm",onClick:()=>Z(!A),className:"text-xs",children:["Show ",A?"Less":"More"]})]}),e.jsxs("ul",{className:"text-sm text-slate-600 space-y-1",children:[e.jsxs("li",{children:["• Average revenue: ",le(R.reduce((C,D)=>C+D.totalValue,0)/R.length)]}),e.jsxs("li",{children:["• Total transactions: ",ne(R.reduce((C,D)=>C+D.transactions,0))]}),e.jsxs("li",{children:["• Combined customer reach: ",ne(R.reduce((C,D)=>C+D.uniqueMembers,0))," unique customers"]}),e.jsxs("li",{children:["• Performance spread: ",((R[0]?.totalValue/R[R.length-1]?.totalValue||1)-1).toFixed(1),"x variance"]})]})]})]})]})},Y=K(B),ee=A?10:5,S=Y.slice(0,ee),I=Y.slice(-ee).reverse();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Ve,{className:"bg-gradient-to-br from-white via-slate-50/20 to-white border-0 shadow-xl",children:[e.jsx($e,{className:"pb-4",children:e.jsx(Ae,{className:"text-2xl font-bold bg-gradient-to-r from-slate-700 via-slate-800 to-slate-900 bg-clip-text text-transparent",children:"Performance Analysis"})}),e.jsx(ke,{children:e.jsxs(et,{value:B,onValueChange:b,className:"w-full",children:[e.jsxs(tt,{className:"bg-white/90 backdrop-blur-sm p-1.5 rounded-2xl shadow-xl border border-slate-200 w-full max-w-4xl mx-auto overflow-visible grid grid-cols-4 gap-0.5",children:[e.jsxs(de,{value:"product",className:"relative text-center px-3 py-3 font-semibold text-sm min-h-[60px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-700 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-10 data-[state=active]:scale-105 hover:bg-gray-50 rounded-lg transition-all duration-200 flex items-center justify-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{className:"text-sm leading-tight whitespace-nowrap",children:"Products"})]}),e.jsxs(de,{value:"category",className:"relative text-center px-3 py-3 font-semibold text-sm min-h-[60px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-700 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-10 data-[state=active]:scale-105 hover:bg-gray-50 rounded-lg transition-all duration-200 flex items-center justify-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{className:"text-sm leading-tight whitespace-nowrap",children:"Categories"})]}),e.jsxs(de,{value:"member",className:"relative text-center px-3 py-3 font-semibold text-sm min-h-[60px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-700 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-10 data-[state=active]:scale-105 hover:bg-gray-50 rounded-lg transition-all duration-200 flex items-center justify-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{className:"text-sm leading-tight whitespace-nowrap",children:"Members"})]}),e.jsxs(de,{value:"seller",className:"relative text-center px-3 py-3 font-semibold text-sm min-h-[60px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-blue-700 data-[state=active]:text-white data-[state=active]:shadow-xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-10 data-[state=active]:scale-105 hover:bg-gray-50 rounded-lg transition-all duration-200 flex items-center justify-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{className:"text-sm leading-tight whitespace-nowrap",children:"Associates"})]})]}),e.jsx(xe,{value:B,className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[Q(S,!0,B),Q(I,!1,B)]})})]})})]}),e.jsx(wt,{isOpen:E,onClose:()=>se(!1),data:ae})]})},Ze=j=>j.reduce((g,B)=>{const b=B.cleanedCategory||"Uncategorized",A=B.cleanedProduct||"Unspecified";return g[b]||(g[b]={}),g[b][A]||(g[b][A]=[]),g[b][A].push(B),g},{}),ta=({data:j,filters:g={dateRange:{start:"",end:""},location:[],category:[],product:[],soldBy:[],paymentMethod:[]},onRowClick:B,collapsedGroups:b=new Set,onGroupToggle:A=()=>{},selectedMetric:Z="revenue",onReady:ae})=>{const X=M.useRef(null),[E,se]=M.useState(Z),[K,L]=M.useState(new Set),[Q,Y]=M.useState(!1),[ee,S]=M.useState("values"),[I,R]=M.useState("total"),[k,V]=M.useState("desc"),z=Me(),C=r=>{if(!r)return null;const x=r.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(x){const[,c,m,f]=x;return new Date(parseInt(f),parseInt(m)-1,parseInt(c))}const t=new Date(r);return isNaN(t.getTime())?null:t},D=(r,x)=>{if(!r.length)return 0;const t=r.reduce((U,_)=>{const J=_.paymentValue||0,W=_.paymentVAT||_.vat||0;return U+(J-W)},0),c=new Set(r.map(U=>U.paymentTransactionId||U.transactionId).filter(Boolean)),m=c.size>0?c.size:r.length,f=new Set(r.map(U=>U.memberId).filter(Boolean)).size,N=new Set(r.map(U=>U.salesItemId||U.itemId||U.saleItemId).filter(Boolean)),w=N.size>0?N.size:r.length,T=r.reduce((U,_)=>U+(_.paymentVAT||_.vat||0),0),P=r.reduce((U,_)=>U+(_.discountAmount||0),0),F=r.reduce((U,_)=>U+(_.paymentValue||0),0),O=F>0?P/F*100:0,q=r.map(U=>{const _=U.paymentDate;if(!_)return null;const J=_.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(J){const[,W,re,ce]=J;return new Date(parseInt(ce),parseInt(re)-1,parseInt(W))}return new Date(_)}).filter(U=>U!==null&&!isNaN(U.getTime())).sort((U,_)=>U.getTime()-_.getTime());let H=0;switch(q.length>1&&(H=(q[q.length-1].getTime()-q[0].getTime())/864e5/(q.length-1)),x){case"revenue":return t;case"transactions":return m;case"members":return f;case"units":return w;case"atv":return m>0?t/m:0;case"auv":return f>0?t/f:0;case"asv":return f>0?t/f:0;case"upt":return m>0?w/m:0;case"vat":return T;case"discountAmount":return P;case"discountValue":return P;case"discountPercentage":return O;case"purchaseFrequency":return H;default:return 0}},G=(r,x)=>{switch(x){case"revenue":case"auv":case"atv":case"asv":case"vat":case"discountAmount":case"discountValue":return le(r);case"transactions":case"members":case"units":return ne(r);case"upt":return r.toFixed(1);case"discountPercentage":return`${r.toFixed(1)}%`;case"purchaseFrequency":return`${r.toFixed(1)} days`;default:return ne(r)}},y=(()=>{const r=new Date,x=new Date(r.getFullYear(),r.getMonth()-1,1);return`${x.getFullYear()}-${String(x.getMonth()+1).padStart(2,"0")}`})(),n=(r,x)=>x===0&&r===0?null:x===0?"+100":((r-x)/x*100).toFixed(1),d=M.useMemo(()=>Array.isArray(j)?j.filter(r=>!(g?.location?.length>0&&!g.location.includes(r.calculatedLocation)||g?.category?.length>0&&!g.category.includes(r.cleanedCategory)||g?.product?.length>0&&!g.product.includes(r.cleanedProduct)||g?.soldBy?.length>0&&!g.soldBy.includes(r.soldBy)||g?.paymentMethod?.length>0&&!g.paymentMethod.includes(r.paymentMethod)||g?.minAmount!==void 0&&r.paymentValue<g.minAmount||g?.maxAmount!==void 0&&r.paymentValue>g.maxAmount)):[],[j,g]),u=M.useMemo(()=>{const r=[],x=new Date,t=x.getMonth()+1,c=x.getFullYear();for(let m=1;m<=12;m++){const f=new Date(2024,m-1,1).toLocaleDateString("en-US",{month:"short"});m>t&&c===x.getFullYear()||(r.push({key:`2024-${String(m).padStart(2,"0")}`,display:`${f} 2024`,year:2024,month:m}),m<=t&&r.push({key:`${c}-${String(m).padStart(2,"0")}`,display:`${f} ${c}`,year:c,month:m}))}return r},[]),i=M.useMemo(()=>u,[u]),s=M.useMemo(()=>{const r=Ze(d),x=Object.entries(r).map(([c,m])=>{const f={category:c,products:Object.entries(m).map(([w,T])=>{const P={};return u.forEach(({key:F,year:O,month:q})=>{const H=T.filter(U=>{const _=C(U.paymentDate);return _&&_.getFullYear()===O&&_.getMonth()+1===q});P[F]=D(H,E)}),{product:w,monthlyValues:P,rawData:T,totalValue:D(T,E)}})},N={};return u.forEach(({key:w,year:T,month:P})=>{const F=f.products.flatMap(O=>O.rawData).filter(O=>{const q=C(O.paymentDate);return q&&q.getFullYear()===T&&q.getMonth()+1===P});N[w]=D(F,E)}),{...f,monthlyValues:N,products:f.products.sort((w,T)=>T.totalValue-w.totalValue)}});!Q&&x.length>0&&(L(new Set),Y(!0));const t=(c,m)=>{const f=(T,P)=>T.monthlyValues?.[P]||0;let N,w;if(I==="total"){const T=P=>Object.values(P?.monthlyValues??{}).reduce((O,q)=>{const H=typeof q=="number"?q:Number(q||0);return O+(isNaN(H)?0:H)},0);N=T(c),w=T(m)}else N=f(c,I),w=f(m,I);return k==="desc"?w-N:N-w};return x.sort(t)},[d,E,u,Q,I,k]),a=M.useCallback(r=>{L(x=>{const t=new Set(x);return t.has(r)?t.delete(r):t.add(r),t})},[]),o=M.useCallback(()=>{const r=new Set(s.map(x=>x.category));L(r)},[s]),l=M.useCallback(()=>{L(new Set)},[]);te.useEffect(()=>{if(s.length>0&&!Q){const r=new Set(s.map(x=>x.category));L(r),Y(!0)}},[s,Q]);const h=M.useCallback(async()=>{let r=`Year-on-Year Analysis - All Metrics
`;r+=`Exported on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
`,r+=`
${"=".repeat(80)}

`;for(const x of ue){const t=x.key;r+=`
${x.label.toUpperCase()}
`,r+=`${"-".repeat(x.label.length+10)}

`;const c=["Category / Product","Total"];i.forEach(N=>c.push(N.display)),r+=c.join("	")+`
`,r+=c.map(()=>"---").join("	")+`
`;const m=Ze(d);Object.entries(m).map(([N,w])=>{const T=Object.entries(w).map(([F,O])=>{const q={};return u.forEach(({key:H,year:U,month:_})=>{const J=O.filter(W=>{const re=C(W.paymentDate);return re&&re.getFullYear()===U&&re.getMonth()+1===_});q[H]=D(J,t)}),{product:F,monthlyValues:q,totalValue:D(O,t)}}),P={};return u.forEach(({key:F})=>{P[F]=T.reduce((O,q)=>O+(q.monthlyValues[F]||0),0)}),{category:N,products:T,monthlyValues:P,totalValue:T.reduce((F,O)=>F+O.totalValue,0)}}).forEach(N=>{const w=N.totalValue,T=[N.category,G(w,t)];i.forEach(P=>{const F=N.monthlyValues[P.key]||0;T.push(G(F,t))}),r+=T.join("	")+`
`,N.products.forEach(P=>{const F=P.totalValue,O=[`  ${P.product}`,G(F,t)];i.forEach(q=>{const H=P.monthlyValues[q.key]||0;O.push(G(H,t))}),r+=O.join("	")+`
`})}),r+=`
`}return r},[d,i,u]),[p,$]=te.useState(!1);return te.useEffect(()=>{!p&&s.length>0&&u.length>0&&($(!0),ae?.())},[p,s,u,ae]),e.jsxs("div",{className:"space-y-6",children:[e.jsx(we,{metrics:ue,selectedMetric:E,onMetricChange:r=>se(r)}),e.jsx(je,{title:"Year-on-Year Analysis",description:"Comprehensive year-over-year performance comparison across all metrics",icon:e.jsx(be,{className:"w-6 h-6 text-white"}),totalItems:s.length,collapsedGroups:K,onCollapseAll:o,onExpandAll:l,showDisplayToggle:!0,displayMode:ee,onDisplayModeChange:S,className:"animate-in slide-in-from-bottom-8 fade-in duration-1000",tableRef:X,showCopyButton:!0,onCopyAllTabs:h,contextInfo:{selectedMetric:E,dateRange:z.dateRange,filters:z.filters,additionalInfo:{displayMode:ee,totalItems:s.length,collapsedGroups:Array.from(K),sortBy:I,sortDirection:k}},children:e.jsx("div",{className:"overflow-x-auto","data-table":"year-on-year-analysis",children:e.jsxs("table",{ref:X,className:"min-w-full bg-white",children:[e.jsx("thead",{className:"sticky top-0 z-30",children:e.jsxs("tr",{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:[e.jsx("th",{className:"w-[30rem] px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide sticky left-0 bg-gradient-to-r from-slate-800 to-slate-900 z-40 border-r border-white/20 cursor-pointer select-none",onClick:()=>{I!=="total"?(R("total"),V("desc")):V(r=>r==="desc"?"asc":"desc")},title:`Sort by total (${k})`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(be,{className:"w-4 h-4 text-white"}),e.jsx("span",{children:"Category / Product"})]})}),i.map(({key:r,display:x,year:t,month:c},m)=>{const f=m>0?i[m-1]:null,N=m<i.length-1?i[m+1]:null,w=!f||f.month!==c,T=!N||N.month!==c,P=r===y;return e.jsx("th",{className:`px-3 py-3 text-center font-bold text-xs uppercase tracking-wider min-w-[90px] cursor-pointer select-none ${w?"border-l-2 border-slate-400":""} ${T?"border-r-2 border-slate-400":""} ${P?"bg-blue-800 text-white":"text-white"}`,onClick:()=>{I!==r?(R(r),V("desc")):V(F=>F==="desc"?"asc":"desc")},title:`Sort by ${x} (${k})${P?" - Main Month":""}`,children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[P&&e.jsx(ve,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-bold whitespace-nowrap leading-tight",children:x.split(" ")[0]})]}),e.jsx("span",{className:"text-slate-300 text-xs leading-tight",children:x.split(" ")[1]})]})},r)})]})}),e.jsxs("tbody",{children:[s.map((r,x)=>e.jsxs(te.Fragment,{children:[e.jsxs("tr",{className:"group bg-slate-100 border-b border-slate-400 font-semibold hover:bg-slate-200 transition-all duration-200 h-9 max-h-9 cursor-pointer",onClick:()=>B?.({drillDownContext:"yoy-category-total",filterCriteria:{category:r.category},name:`${r.category} (YoY Total)`,category:r.category,rawData:r.products.flatMap(t=>t.rawData),isGroup:!0}),children:[e.jsx("td",{className:"w-[30rem] px-4 py-2 text-left sticky left-0 bg-gradient-to-r from-slate-100 via-blue-50 to-indigo-50 group-hover:from-slate-200 group-hover:via-blue-100 group-hover:to-indigo-100 border-r border-slate-200 z-20 transition-all duration-300 shadow-sm whitespace-nowrap overflow-hidden text-ellipsis",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{variant:"ghost",size:"sm",onClick:t=>{t.stopPropagation(),a(r.category)},className:"p-1 h-5 w-5 rounded text-slate-600 hover:text-slate-800 hover:bg-white/50 transition-all duration-200",children:K.has(r.category)?e.jsx(nt,{className:"w-5 h-5"}):e.jsx(rt,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-bold text-xs text-slate-800",children:r.category})]})}),i.map(({key:t},c)=>{const m=c>0?i[c-1]:null,f=c<i.length-1?i[c+1]:null,N=i[c].month,w=!m||m.month!==N,T=!f||f.month!==N,P=r.monthlyValues[t]||0,[F,O]=t.split("-"),H=`${String(Number(F)-1)}-${O}`,U=r.monthlyValues[H]||0,_=n(P,U);return e.jsx("td",{className:`px-2 py-2 text-center text-sm font-bold text-slate-800 hover:bg-blue-100/50 cursor-pointer transition-all duration-200 h-12 ${w?"border-l-2 border-slate-400":""} ${T?"border-r-2 border-slate-400":""}`,onClick:J=>{J.stopPropagation();const W=r.products.flatMap(re=>re.rawData).filter(re=>{const ce=C(re.paymentDate);return ce&&`${ce.getFullYear()}-${String(ce.getMonth()+1).padStart(2,"0")}`===t});B?.({drillDownContext:"yoy-category-month",filterCriteria:{category:r.category,month:t},name:`${r.category} (${t})`,category:r.category,month:t,rawData:W})},title:_?`${_}% vs same month last year`:"",children:e.jsx("div",{className:"flex flex-col items-center space-y-0.5 min-h-6 justify-center",children:ee==="values"?e.jsx("span",{className:"font-mono text-xs whitespace-nowrap",children:G(P,E)}):_&&e.jsxs("div",{className:`flex items-center justify-center space-x-1 text-xs leading-none ${parseFloat(_)>0?"text-emerald-600":"text-red-500"}`,children:[parseFloat(_)>0?e.jsx(me,{className:"w-3 h-3 shrink-0"}):e.jsx(he,{className:"w-3 h-3 shrink-0"}),e.jsxs("span",{className:"font-mono text-xs whitespace-nowrap",children:[parseFloat(_)>0?"+":"",_,"%"]})]})})},t)})]}),!K.has(r.category)&&r.products.map((t,c)=>e.jsxs("tr",{className:"bg-white hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 border-b border-gray-200 transition-all duration-300 hover:shadow-lg animate-in slide-in-from-left-2 fade-in duration-300 cursor-pointer h-9 max-h-9",onClick:()=>B?.({drillDownContext:"yoy-product-total",filterCriteria:{product:t.product},name:`${t.product} (YoY Total)`,product:t.product,rawData:t.rawData}),children:[e.jsx("td",{className:"w-[30rem] px-12 py-3 text-left sticky left-0 bg-white hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 border-r border-slate-100 z-10 cursor-pointer transition-all duration-300 whitespace-nowrap overflow-hidden text-ellipsis",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-slate-400 text-xs",children:"→"}),e.jsx("span",{className:"text-slate-700 font-medium text-xs",children:t.product})]})}),i.map(({key:m},f)=>{const N=f>0?i[f-1]:null,w=f<i.length-1?i[f+1]:null,T=i[f].month,P=!N||N.month!==T,F=!w||w.month!==T,O=t.monthlyValues[m]||0,[q,H]=m.split("-"),_=`${String(Number(q)-1)}-${H}`,J=t.monthlyValues[_]||0,W=n(O,J);return e.jsx("td",{className:`px-2 py-2 text-center text-sm font-mono text-slate-700 border-gray-200 hover:bg-blue-100/50 cursor-pointer transition-all duration-200 ${P?"border-l-2 border-slate-400":"border-l"} ${F?"border-r-2 border-slate-400":""}`,onClick:re=>{re.stopPropagation();const ce=t.rawData.filter(fe=>{const Ce=C(fe.paymentDate);return Ce&&`${Ce.getFullYear()}-${String(Ce.getMonth()+1).padStart(2,"0")}`===m});B?.({drillDownContext:"yoy-product-month",filterCriteria:{product:t.product,month:m},name:`${t.product} (${m})`,product:t.product,month:m,rawData:ce})},title:W?`${W}% vs same month last year`:"",children:e.jsx("div",{className:"flex flex-col items-center space-y-0.5 min-h-6 justify-center",children:ee==="values"?e.jsx("span",{className:"text-xs whitespace-nowrap",children:G(O,E)}):W&&e.jsxs("div",{className:`flex items-center justify-center space-x-1 text-xs leading-none ${parseFloat(W)>0?"text-emerald-600":"text-red-500"}`,children:[parseFloat(W)>0?e.jsx(me,{className:"w-3 h-3 shrink-0"}):e.jsx(he,{className:"w-3 h-3 shrink-0"}),e.jsxs("span",{className:"font-mono text-xs whitespace-nowrap",children:[parseFloat(W)>0?"+":"",W,"%"]})]})})},m)})]},`${r.category}-${t.product}`))]},r.category)),e.jsxs("tr",{className:"bg-slate-800 text-white font-bold border-t-2 border-slate-400 h-10 max-h-10 cursor-pointer hover:bg-slate-700",onClick:()=>B?.({drillDownContext:"yoy-grand-total",filterCriteria:{},name:"Grand Total (YoY)",rawData:d,isGroup:!0}),children:[e.jsx("td",{className:"w-96 px-4 py-2 text-left sticky left-0 bg-slate-800 group-hover:bg-slate-700 border-r border-slate-400 z-20",children:e.jsx("div",{className:"flex items-center space-x-2 min-h-6",children:e.jsx("span",{className:"font-bold text-sm text-white",children:"TOTALS"})})}),i.map(({key:r,year:x,month:t},c)=>{const m=c>0?i[c-1]:null,f=c<i.length-1?i[c+1]:null,N=!m||m.month!==t,w=!f||f.month!==t,T=d.filter(F=>{const O=C(F.paymentDate);return O&&O.getFullYear()===x&&O.getMonth()+1===t}),P=D(T,E);return e.jsx("td",{className:`px-2 py-2 text-center text-sm font-bold text-white border-slate-400 group-hover:bg-slate-700 ${N?"border-l-2":"border-l"} ${w?"border-r-2":""}`,onClick:F=>{F.stopPropagation();const O=d.filter(q=>{const H=C(q.paymentDate);return H&&`${H.getFullYear()}-${String(H.getMonth()+1).padStart(2,"0")}`===r});B?.({drillDownContext:"yoy-total-month",filterCriteria:{month:r},name:`Grand Total (${r})`,month:r,rawData:O})},children:e.jsx("div",{className:"flex flex-col items-center space-y-0.5 min-h-6 justify-center",children:e.jsx("span",{className:"font-mono text-xs whitespace-nowrap",children:G(P,E)})})},r)})]})]})]})})}),e.jsx(Ne,{tableId:"year-on-year-analysis",initialText:"• Year-on-year analysis reveals growth patterns and seasonal trends\\n• Strong quarterly performance indicators with year-over-year improvements\\n• Key growth drivers identified across product categories",className:"animate-in slide-in-from-bottom-4 fade-in duration-1000 delay-300"})]})},aa=te.memo(ta,(j,g)=>j.data===g.data&&j.selectedMetric===g.selectedMetric&&st(j.filters,g.filters)&&j.collapsedGroups===g.collapsedGroups&&j.onRowClick===g.onRowClick&&j.onGroupToggle===g.onGroupToggle&&j.onReady===g.onReady),Je=j=>j.reduce((g,B)=>{const b=B.cleanedCategory||"Uncategorized",A=B.cleanedProduct||"Unspecified";return g[b]||(g[b]={}),g[b][A]||(g[b][A]=[]),g[b][A].push(B),g},{}),sa=({data:j,onRowClick:g,filters:B={dateRange:{start:"",end:""},location:[],category:[],product:[],soldBy:[],paymentMethod:[]},collapsedGroups:b=new Set,onGroupToggle:A=()=>{},selectedMetric:Z="revenue",onReady:ae,contextInfo:X})=>{const[E,se]=M.useState(Z),K=M.useRef(null),[L,Q]=M.useState(new Set),[Y,ee]=M.useState("values"),[S,I]=M.useState("total"),[R,k]=M.useState("desc"),[V,z]=M.useState(!1),C=Me();te.useEffect(()=>{if(!b)return;((c,m)=>{if(c.size!==m.size)return!1;for(const f of c)if(!m.has(f))return!1;return!0})(L,b)||Q(new Set(b))},[b]);const G=(()=>{const t=new Date,c=new Date(t.getFullYear(),t.getMonth()-1,1);return`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`})(),v=t=>{if(!t)return null;const c=t.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(c){const[,f,N,w]=c;return new Date(parseInt(w),parseInt(N)-1,parseInt(f))}const m=new Date(t);return isNaN(m.getTime())?null:m},y=(t,c)=>{if(!t.length)return 0;const m=t.reduce((J,W)=>{const re=W.paymentValue||0,ce=W.paymentVAT||W.vat||0;return J+(re-ce)},0),f=new Set(t.map(J=>J.paymentTransactionId||J.transactionId).filter(Boolean)),N=f.size>0?f.size:t.length,w=new Set(t.map(J=>J.memberId).filter(Boolean)).size,T=new Set(t.map(J=>J.salesItemId||J.itemId||J.saleItemId).filter(Boolean)),P=T.size>0?T.size:t.length,F=t.reduce((J,W)=>J+(W.discountAmount||0),0),O=t.reduce((J,W)=>J+(W.paymentVAT||W.vat||0),0),q=t.reduce((J,W)=>J+(W.paymentValue||0),0),H=q>0?F/q*100:0,U=t.map(J=>{const W=J.paymentDate;if(!W)return null;const re=W.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(re){const[,ce,fe,Ce]=re;return new Date(parseInt(Ce),parseInt(fe)-1,parseInt(ce))}return new Date(W)}).filter(J=>J!==null&&!isNaN(J.getTime())).sort((J,W)=>J.getTime()-W.getTime());let _=0;switch(U.length>1&&(_=(U[U.length-1].getTime()-U[0].getTime())/864e5/(U.length-1)),c){case"revenue":return m;case"transactions":return N;case"members":return w;case"units":return P;case"atv":return N>0?m/N:0;case"auv":return w>0?m/w:0;case"asv":return w>0?m/w:0;case"upt":return N>0?P/N:0;case"vat":return O;case"discountValue":return F;case"discountAmount":return F;case"discountPercentage":return H;case"purchaseFrequency":return _;default:return 0}},n=(t,c)=>{switch(c){case"revenue":case"auv":case"atv":case"asv":case"vat":case"discountValue":case"discountAmount":return le(t);case"transactions":case"members":case"units":return ne(t);case"upt":return t.toFixed(1);case"discountPercentage":return`${t.toFixed(1)}%`;case"purchaseFrequency":return`${t.toFixed(1)} days`;default:return ne(t)}},d=M.useMemo(()=>{const t=[],c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],m=new Date,f=m.getFullYear(),N=m.getMonth(),w=new Date(2024,0,1),T=new Date(f,N,1);let P=new Date(w);for(;P<=T;){const F=P.getFullYear(),O=P.getMonth()+1,q=c[P.getMonth()];t.push({key:`${F}-${String(O).padStart(2,"0")}`,display:`${q} ${F}`,year:F,month:O,quarter:Math.ceil(O/3)}),P=new Date(F,P.getMonth()+1,1)}return t},[]),u=M.useMemo(()=>{const t=Je(j),c=Object.entries(t).map(([f,N])=>{const w={category:f,products:Object.entries(N).map(([P,F])=>{const O={};return d.forEach(({key:q,year:H,month:U})=>{const _=F.filter(J=>{const W=v(J.paymentDate);return W&&W.getFullYear()===H&&W.getMonth()+1===U});O[q]=y(_,E)}),{product:P,monthlyValues:O,rawData:F,totalValue:y(F,E)}})},T={};return d.forEach(({key:P,year:F,month:O})=>{const q=w.products.flatMap(H=>H.rawData).filter(H=>{const U=v(H.paymentDate);return U&&U.getFullYear()===F&&U.getMonth()+1===O});T[P]=y(q,E)}),{...w,monthlyValues:T,products:w.products.sort((P,F)=>F.totalValue-P.totalValue)}}),m=(f,N)=>{const w=(F,O)=>F.monthlyValues?.[O]||0;let T,P;if(S==="total"){const F=O=>Object.values(O?.monthlyValues??{}).reduce((H,U)=>H+(typeof U=="number"?U:Number(U||0)),0);T=F(f),P=F(N)}else T=w(f,S),P=w(N,S);return R==="desc"?P-T:T-P};return c.sort(m)},[j,E,d,S,R]);te.useEffect(()=>{if(u.length>0&&!V){const t=new Set(u.map(c=>c.category));Q(t),z(!0)}},[u,V]);const i=M.useCallback(t=>{Q(c=>{const m=new Set(c);return m.has(t)?m.delete(t):m.add(t),A?.(m),m})},[A]),s=M.useCallback(()=>{const t=new Set(u.map(c=>c.category));Q(t),A?.(t)},[u,A]),a=M.useMemo(()=>d,[d]),[o,l]=te.useState(!1);te.useEffect(()=>{!o&&u.length>0&&a.length>0&&(l(!0),ae?.())},[o,u,a,ae]);const h=M.useMemo(()=>{const t=[];return u.forEach(c=>{c.products.forEach(m=>{const f=Object.fromEntries(a.map(({key:N})=>[`month_${N}`,m.monthlyValues[N]||0]));t.push({category:c.category,product:m.product,totalValue:m.totalValue,totalItems:m.rawData.length,totalRevenue:m.rawData.reduce((N,w)=>N+(w.paymentValue||0),0),uniqueMembers:new Set(m.rawData.map(N=>N.memberId)).size,...f})})}),t},[u,d,a]),p=M.useMemo(()=>{const t=[{key:"category",header:"Category",type:"text"},{key:"product",header:"Product",type:"text"},{key:"totalValue",header:`Total ${E}`,type:E==="revenue"||E==="atv"||E==="auv"?"currency":"number"},{key:"totalItems",header:"Total Items",type:"number"},{key:"totalRevenue",header:"Total Revenue",type:"currency"},{key:"uniqueMembers",header:"Unique Members",type:"number"}],c=a.map(({key:m,display:f})=>({key:`month_${m}`,header:f,type:E==="revenue"||E==="atv"||E==="auv"?"currency":"number"}));return[...t,...c]},[d,E,a]),$=M.useCallback(()=>{const t=new Set;Q(t),A?.(t)},[A]),r=(t,c)=>c===0&&t===0?null:c===0?"+100":((t-c)/c*100).toFixed(1),x=M.useCallback(async()=>{let t=`Month-on-Month Analysis - All Metrics
`;t+=`Exported on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
`,t+=`
${"=".repeat(80)}

`;for(const c of ue){const m=c.key;t+=`
${c.label.toUpperCase()}
`,t+=`${"-".repeat(c.label.length+10)}

`;const f=["Category / Product","Total"];a.forEach(T=>f.push(T.display)),t+=f.join("	")+`
`,t+=f.map(()=>"---").join("	")+`
`;const N=Je(j);Object.entries(N).map(([T,P])=>{const F=Object.entries(P).map(([q,H])=>{const U={};return d.forEach(({key:_,year:J,month:W})=>{const re=H.filter(ce=>{const fe=v(ce.paymentDate);return fe&&fe.getFullYear()===J&&fe.getMonth()+1===W});U[_]=y(re,m)}),{product:q,monthlyValues:U,totalValue:y(H,m)}}),O={};return d.forEach(({key:q})=>{O[q]=F.reduce((H,U)=>H+(U.monthlyValues[q]||0),0)}),{category:T,products:F,monthlyValues:O,totalValue:F.reduce((q,H)=>q+H.totalValue,0)}}).forEach(T=>{const P=T.totalValue,F=[T.category,n(P,m)];a.forEach(O=>{const q=T.monthlyValues[O.key]||0;F.push(n(q,m))}),t+=F.join("	")+`
`,T.products.forEach(O=>{const q=O.totalValue,H=[`  ${O.product}`,n(q,m)];a.forEach(U=>{const _=O.monthlyValues[U.key]||0;H.push(n(_,m))}),t+=H.join("	")+`
`})}),t+=`
`}return t},[j,a,d]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx(we,{metrics:ue,selectedMetric:E,onMetricChange:t=>se(t),className:"mb-4"}),e.jsx(je,{title:"Month-on-Month Analysis",description:"Comprehensive monthly performance comparison across categories and products",icon:e.jsx(be,{className:"w-5 h-5 text-white"}),totalItems:u.reduce((t,c)=>t+c.products.length,0),collapsedGroups:L,onCollapseAll:s,onExpandAll:$,showDisplayToggle:!0,displayMode:Y,onDisplayModeChange:ee,tableRef:K,showCopyButton:!0,onCopyAllTabs:x,contextInfo:{selectedMetric:X?.selectedMetric||E,dateRange:X?.dateRange||C.dateRange,location:X?.location,filters:X?.filters||C.filters,additionalInfo:{...X?.additionalInfo,displayMode:Y,totalItems:u.reduce((t,c)=>t+c.products.length,0),collapsedGroups:Array.from(L),sortBy:S,sortDirection:R}},children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{ref:K,className:"min-w-full bg-white",children:[e.jsx("thead",{className:"sticky top-0 z-30",children:e.jsxs("tr",{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:[e.jsx("th",{className:"w-96 px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide sticky left-0 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 z-40 border-r border-white/20 cursor-pointer select-none",onClick:()=>{S!=="total"?(I("total"),k("desc")):k(t=>t==="desc"?"asc":"desc")},title:`Sort by total (${R})`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(be,{className:"w-4 h-4 text-white"}),e.jsx("span",{children:"Category / Product"})]})}),a.map(({key:t,display:c})=>{const m=t===G;return e.jsx("th",{className:`px-3 py-3 text-center font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[90px] cursor-pointer select-none ${m?"bg-blue-800 text-white":"text-white"}`,onClick:()=>{S!==t?(I(t),k("desc")):k(f=>f==="desc"?"asc":"desc")},title:`Sort by ${c} (${R})${m?" - Main Month":""}`,children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[m&&e.jsx(ve,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-bold whitespace-nowrap",children:c.split(" ")[0]})]}),e.jsx("span",{className:"text-slate-300 text-xs",children:c.split(" ")[1]})]})},t)})]})}),e.jsxs("tbody",{children:[u.map((t,c)=>{const m=Object.values(t.monthlyValues).reduce((f,N)=>f+N,0);return e.jsxs(te.Fragment,{children:[e.jsxs("tr",{className:"group bg-slate-100 border-b border-slate-400 font-semibold hover:bg-slate-200 transition-all duration-200 h-12",children:[e.jsx("td",{className:"w-96 px-4 py-2 text-left sticky left-0 bg-slate-100 group-hover:bg-slate-200 border-r border-slate-300 z-20 cursor-pointer transition-all duration-200",onClick:f=>{f.target.closest("button")||g?.({type:"category",category:t.category,data:t.products,metric:E,value:m})},children:e.jsxs("div",{className:"flex items-center space-x-2 min-h-8",children:[e.jsx(oe,{variant:"ghost",size:"sm",onClick:f=>{f.stopPropagation(),i(t.category)},className:"p-1 h-5 w-5 rounded text-slate-600 hover:text-slate-800 hover:bg-white/50 transition-all duration-200 shrink-0",children:L.has(t.category)?e.jsx(nt,{className:"w-3 h-3"}):e.jsx(rt,{className:"w-3 h-3"})}),e.jsx("div",{className:"flex items-center space-x-2 flex-1",children:e.jsx("span",{className:"font-bold text-sm text-slate-800 truncate",children:t.category})})]})}),a.map(({key:f},N)=>{const w=t.monthlyValues[f]||0,T=N>0?a[N-1]?.key:null,P=T&&t.monthlyValues[T]||0,F=N>0?r(w,P):null;return e.jsx("td",{className:"px-2 py-2 text-center text-sm font-bold border-l transition-all duration-200 cursor-pointer text-slate-800 border-slate-300 hover:bg-slate-100",onClick:O=>{O.stopPropagation(),g?.({drillDownContext:"mom-category-month",filterCriteria:{category:t.category,month:f},name:`${t.category} (${f})`,category:t.category,month:f})},title:F?`${F}% vs previous month`:"",children:e.jsx("div",{className:"flex flex-col items-center space-y-0.5 min-h-6 justify-center",children:Y==="values"?e.jsx("span",{className:"font-mono text-xs whitespace-nowrap",children:n(w,E)}):F&&e.jsxs("div",{className:`flex items-center space-x-1 text-xs ${parseFloat(F)>0?"text-emerald-600":"text-red-500"}`,children:[parseFloat(F)>0?e.jsx(me,{className:"w-2 h-2"}):e.jsx(he,{className:"w-2 h-2"}),e.jsxs("span",{className:"font-mono",children:[Math.abs(parseFloat(F)),"%"]})]})})},f)})]}),!L.has(t.category)&&t.products.map((f,N)=>e.jsxs("tr",{className:"bg-white hover:bg-slate-50 border-b border-gray-200 transition-all duration-200 h-12",children:[e.jsx("td",{className:"w-96 px-8 py-2 text-left sticky left-0 bg-white hover:bg-slate-50 border-r border-gray-200 z-10 cursor-pointer transition-all duration-200",onClick:()=>{g?.({drillDownContext:"mom-product-all",filterCriteria:{product:f.product,category:t.category},name:f.product,product:f.product,category:t.category})},children:e.jsxs("div",{className:"flex items-center space-x-2 min-h-8",children:[e.jsx("span",{className:"text-slate-400 text-xs",children:"→"}),e.jsx("span",{className:"text-slate-700 font-medium text-sm truncate",children:f.product})]})}),a.map(({key:w},T)=>{const P=f.monthlyValues[w]||0,F=T>0?a[T-1]?.key:null,O=F&&f.monthlyValues[F]||0,q=T>0?r(P,O):null;return e.jsx("td",{className:"px-2 py-2 text-center text-sm font-mono border-l border-gray-200 cursor-pointer transition-all duration-200 text-slate-700 hover:bg-slate-100",onClick:H=>{H.stopPropagation(),g?.({drillDownContext:"mom-product-month",filterCriteria:{product:f.product,category:t.category,month:w},name:`${f.product} (${w})`,product:f.product,category:t.category,month:w})},title:q?`${q}% vs previous month`:"",children:e.jsx("div",{className:"flex flex-col items-center space-y-0.5 min-h-6 justify-center",children:Y==="values"?e.jsx("span",{className:"text-xs whitespace-nowrap",children:n(P,E)}):q&&e.jsxs("div",{className:`flex items-center space-x-1 text-xs ${parseFloat(q)>0?"text-emerald-500":"text-red-400"}`,children:[parseFloat(q)>0?e.jsx(me,{className:"w-2 h-2"}):e.jsx(he,{className:"w-2 h-2"}),e.jsxs("span",{className:"font-mono",children:[Math.abs(parseFloat(q)),"%"]})]})})},w)})]},`${t.category}-${f.product}`))]},t.category)}),e.jsxs("tr",{className:"bg-slate-800 text-white font-bold border-t-2 border-slate-400 h-10 max-h-10",children:[e.jsx("td",{className:"w-96 px-4 py-2 text-left sticky left-0 bg-slate-800 border-r border-slate-400 z-20",children:e.jsx("div",{className:"flex items-center space-x-2 min-h-6",children:e.jsx("span",{className:"font-bold text-sm text-white",children:"TOTALS"})})}),a.map(({key:t,year:c,month:m})=>{const f=j.filter(w=>{const T=v(w.paymentDate);return T&&T.getFullYear()===c&&T.getMonth()+1===m}),N=y(f,E);return e.jsx("td",{className:"px-2 py-2 text-center text-sm font-bold text-white border-l border-slate-400 hover:bg-slate-700 cursor-pointer transition-all duration-200",onClick:w=>{w.stopPropagation(),g?.({drillDownContext:"mom-total-month",filterCriteria:{month:t},name:`All Products (${t})`,month:t})},children:e.jsx("div",{className:"flex flex-col items-center space-y-0.5 min-h-6 justify-center",children:e.jsx("span",{className:"font-mono text-xs whitespace-nowrap",children:n(N,E)})})},t)})]})]})]})})}),e.jsx(Ne,{tableId:"month-on-month-analysis",initialText:"• Monthly performance trends across all product categories • Growth patterns and seasonal variations • Key performance indicators by category and product",tableData:h,tableColumns:p,tableName:"Month-on-Month Performance Analysis",tableContext:`Detailed monthly performance tracking by category and product showing ${E} trends over ${a.length} months`})]})},na=te.memo(sa,(j,g)=>j.data===g.data&&j.selectedMetric===g.selectedMetric&&j.onRowClick===g.onRowClick&&j.onReady===g.onReady&&st(j.filters,g.filters)&&j.collapsedGroups===g.collapsedGroups&&j.onGroupToggle===g.onGroupToggle),ra=({data:j,onRowClick:g,selectedMetric:B="revenue",onReady:b})=>{const[A,Z]=M.useState(B),ae=M.useRef(null),[X,E]=M.useState(new Set),[se,K]=M.useState("values"),[L,Q]=M.useState("total"),[Y,ee]=M.useState("desc"),S=Me(),R=(()=>{const s=new Date,a=new Date(s.getFullYear(),s.getMonth()-1,1);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`})(),k=s=>{if(!s)return null;const a=s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(a){const[,l,h,p]=a;return new Date(parseInt(p),parseInt(h)-1,parseInt(l))}const o=new Date(s);return isNaN(o.getTime())?null:o},V=(s,a)=>{if(!s.length)return 0;const o=s.reduce((w,T)=>{const P=T.paymentValue||0,F=T.paymentVAT||T.vat||0;return w+(P-F)},0),l=new Set(s.map(w=>w.paymentTransactionId||w.transactionId).filter(Boolean)),h=l.size>0?l.size:s.length,p=new Set(s.map(w=>w.memberId).filter(Boolean)).size,$=new Set(s.map(w=>w.salesItemId||w.itemId).filter(Boolean)),r=$.size>0?$.size:s.length,x=s.reduce((w,T)=>w+(T.paymentVAT||T.vat||0),0),t=s.reduce((w,T)=>w+(T.discountAmount||0),0),c=s.reduce((w,T)=>w+(T.paymentValue||0),0),m=c>0?t/c*100:0,f=s.map(w=>{const T=w.paymentDate;if(!T)return null;const P=T.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(P){const[,F,O,q]=P;return new Date(parseInt(q),parseInt(O)-1,parseInt(F))}return new Date(T)}).filter(w=>w!==null&&!isNaN(w.getTime())).sort((w,T)=>w.getTime()-T.getTime());let N=0;switch(f.length>1&&(N=(f[f.length-1].getTime()-f[0].getTime())/864e5/(f.length-1)),a){case"revenue":return o;case"transactions":return h;case"members":return p;case"units":return r;case"atv":return h>0?o/h:0;case"auv":return p>0?o/p:0;case"asv":return p>0?o/p:0;case"upt":return h>0?r/h:0;case"vat":return x;case"discountAmount":return t;case"discountPercentage":return m;case"purchaseFrequency":return N;default:return 0}},z=(s,a)=>{switch(a){case"revenue":case"auv":case"atv":case"asv":case"vat":case"discountAmount":return le(s);case"transactions":case"members":case"units":return ne(s);case"upt":return s.toFixed(1);case"discountPercentage":return`${s.toFixed(1)}%`;case"purchaseFrequency":return`${s.toFixed(1)} days`;default:return ne(s)}},C=M.useMemo(()=>{const s=[],a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=new Date,l=o.getFullYear(),h=o.getMonth(),p=new Date(2024,0,1),$=new Date(l,h,1);let r=new Date(p);for(;r<=$;){const x=r.getFullYear(),t=r.getMonth()+1,c=a[r.getMonth()];s.push({key:`${x}-${String(t).padStart(2,"0")}`,display:`${c} ${x}`,year:x,month:t,quarter:Math.ceil(t/3)}),r=new Date(x,r.getMonth()+1,1)}return s},[]),D=M.useMemo(()=>{const s=j.reduce((l,h)=>{const p=h.cleanedCategory||"Uncategorized";return l[p]||(l[p]=[]),l[p].push(h),l},{}),a=Object.entries(s).map(([l,h])=>{const p={};C.forEach(({key:r,year:x,month:t})=>{const c=h.filter(m=>{const f=k(m.paymentDate);return f&&f.getFullYear()===x&&f.getMonth()+1===t});p[r]=V(c,A)});const $=new Set(h.map(r=>r.cleanedProduct||"Unknown")).size;return{category:l,monthlyValues:p,totalValue:V(h,A),totalRevenue:h.reduce((r,x)=>{const t=x.paymentValue||0,c=x.paymentVAT||x.vat||0;return r+(t-c)},0),totalTransactions:h.length,uniqueMembers:new Set(h.map(r=>r.memberId)).size,uniqueProducts:$,rawData:h}}),o=(l,h)=>{const p=(x,t)=>x.monthlyValues?.[t]||0;let $,r;return L==="total"?($=l.totalValue,r=h.totalValue):($=p(l,L),r=p(h,L)),Y==="desc"?r-$:$-r};return a.sort(o)},[j,A,C,L,Y]),G=M.useMemo(()=>C,[C]),[v,y]=te.useState(!1);te.useEffect(()=>{!v&&D.length>0&&G.length>0&&(y(!0),b?.())},[v,D,G,b]);const n=(s,a)=>a===0&&s===0?null:a===0?"+100":((s-a)/a*100).toFixed(1),d=M.useCallback(async()=>{let s=`Category Performance Analysis - All Metrics
`;s+=`Exported on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
`,s+=`
${"=".repeat(80)}

`;for(const a of ue){const o=a.key;s+=`
${a.label.toUpperCase()}
`,s+=`${"-".repeat(a.label.length+10)}

`;const l=["Category","Total"];G.forEach($=>l.push($.display)),s+=l.join("	")+`
`,s+=l.map(()=>"---").join("	")+`
`;const h=j.reduce(($,r)=>{const x=r.cleanedCategory||"Uncategorized";return $[x]||($[x]=[]),$[x].push(r),$},{});Object.entries(h).map(([$,r])=>{const x={};return C.forEach(({key:t,year:c,month:m})=>{const f=r.filter(N=>{const w=k(N.paymentDate);return w&&w.getFullYear()===c&&w.getMonth()+1===m});x[t]=V(f,o)}),{category:$,monthlyValues:x,totalValue:V(r,o)}}).forEach($=>{const r=[$.category,z($.totalValue,o)];G.forEach(x=>{const t=$.monthlyValues[x.key]||0;r.push(z(t,o))}),s+=r.join("	")+`
`}),s+=`
`}return s},[j,G,C]),u=M.useMemo(()=>D.map(s=>({category:s.category,totalRevenue:s.totalRevenue,totalTransactions:s.totalTransactions,uniqueMembers:s.uniqueMembers,uniqueProducts:s.uniqueProducts,avgTransactionValue:s.totalTransactions>0?s.totalRevenue/s.totalTransactions:0,avgRevenuePerMember:s.uniqueMembers>0?s.totalRevenue/s.uniqueMembers:0,...Object.fromEntries(G.map(({key:a})=>[`month_${a}`,s.monthlyValues[a]||0]))})),[D,C,G]),i=M.useMemo(()=>{const s=[{key:"category",header:"Category",type:"text"},{key:"totalRevenue",header:"Total Revenue",type:"currency"},{key:"totalTransactions",header:"Total Transactions",type:"number"},{key:"uniqueMembers",header:"Unique Members",type:"number"},{key:"uniqueProducts",header:"Unique Products",type:"number"},{key:"avgTransactionValue",header:"Avg Transaction Value",type:"currency"},{key:"avgRevenuePerMember",header:"Avg Revenue per Member",type:"currency"}],a=G.map(({key:o,display:l})=>({key:`month_${o}`,header:`${l}`,type:A==="revenue"||A==="atv"||A==="auv"?"currency":"number"}));return[...s,...a]},[C,A,G]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(we,{metrics:ue,selectedMetric:A,onMetricChange:s=>Z(s)}),e.jsx(je,{title:"Category Performance Analysis",description:"High-level category performance overview with comprehensive metrics and trends",icon:e.jsx(Lt,{className:"w-6 h-6 text-white"}),totalItems:D.length,showDisplayToggle:!0,displayMode:se,onDisplayModeChange:K,className:"animate-in slide-in-from-bottom-8 fade-in duration-1000",tableRef:ae,showCopyButton:!0,onCopyAllTabs:d,contextInfo:{selectedMetric:A,dateRange:S.dateRange,filters:S.filters,additionalInfo:{displayMode:se,totalItems:D.length,sortBy:L,sortDirection:Y}},children:e.jsx("div",{className:"overflow-x-auto","data-table":"category-performance-analysis",children:e.jsxs("table",{ref:ae,className:"min-w-full bg-white",children:[e.jsx("thead",{className:"sticky top-0 z-30",children:e.jsxs("tr",{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:[e.jsx("th",{className:"w-[30rem] px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide sticky left-0 z-40 border-r border-white/20 cursor-pointer select-none",onClick:()=>{L!=="total"?(Q("total"),ee("desc")):ee(s=>s==="desc"?"asc":"desc")},title:`Sort by total (${Y})`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ot,{className:"w-4 h-4 text-white"}),e.jsx("span",{children:"Category"})]})}),G.map(({key:s,display:a})=>{const o=s===R;return e.jsx("th",{className:`px-3 py-3 text-center font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[90px] cursor-pointer select-none ${o?"bg-blue-800 text-white":"text-white"}`,onClick:()=>{L!==s?(Q(s),ee("desc")):ee(l=>l==="desc"?"asc":"desc")},title:`Sort by ${a} (${Y})${o?" - Main Month":""}`,children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[o&&e.jsx(ve,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-bold whitespace-nowrap",children:a.split(" ")[0]})]}),e.jsx("span",{className:"text-slate-300 text-xs",children:a.split(" ")[1]})]})},s)})]})}),e.jsxs("tbody",{children:[D.map((s,a)=>e.jsxs("tr",{className:"bg-white hover:bg-slate-50 border-b border-gray-200 transition-all duration-200 h-9 max-h-9",onClick:()=>g?.({...s,contextType:"category",drillDownContext:"category-performance",filterCriteria:{category:s.category},clickedItemName:s.category,contextDescription:`Complete performance analysis for ${s.category} category`}),children:[e.jsx("td",{className:"w-[30rem] px-4 py-2 text-left sticky left-0 bg-white hover:bg-slate-50 border-r border-gray-200 z-20 cursor-pointer transition-all duration-200 whitespace-nowrap overflow-hidden text-ellipsis",children:e.jsx("div",{className:"flex items-center space-x-2 min-h-8",children:e.jsx("div",{className:"flex items-center space-x-2 flex-1",children:e.jsx("span",{className:"text-slate-700 font-medium text-sm whitespace-nowrap",children:s.category})})})}),G.map(({key:o},l)=>{const h=s.monthlyValues[o]||0,p=G[l+1]?.key,$=p&&s.monthlyValues[p]||0,r=l<G.length-1?n(h,$):null;return e.jsx("td",{className:"px-2 py-2 text-center text-sm font-mono text-slate-700 border-l border-gray-200 hover:bg-slate-100 cursor-pointer transition-all duration-200",title:r?`${r}% vs previous month`:"",onClick:x=>{x.stopPropagation(),g?.({...s,contextType:"category-month",filterCriteria:{category:s.category,month:o,specificValue:h},drillDownContext:{type:"category-month",itemName:s.category,month:o,value:h,metric:A},clickedItemName:s.category,contextDescription:`${s.category} performance in ${o}: ${z(h,A)}`})},children:e.jsx("div",{className:"flex flex-col items-center space-y-0.5 min-h-6 justify-center",children:se==="values"?e.jsx("span",{className:"text-xs whitespace-nowrap",children:z(h,A)}):r&&e.jsxs("div",{className:`flex items-center space-x-1 text-xs ${parseFloat(r)>0?"text-emerald-500":"text-red-400"}`,children:[parseFloat(r)>0?e.jsx(me,{className:"w-2 h-2"}):e.jsx(he,{className:"w-2 h-2"}),e.jsxs("span",{className:"font-mono",children:[Math.abs(parseFloat(r)),"%"]})]})})},o)})]},s.category)),e.jsxs("tr",{className:"bg-slate-800 text-white font-bold border-t-2 border-slate-400 h-10 max-h-10 cursor-pointer hover:bg-slate-700",onClick:()=>g?.({drillDownContext:"category-grand-total",filterCriteria:{},name:"Grand Total (All Categories)",rawData:j,isGroup:!0}),children:[e.jsx("td",{className:"w-80 px-4 py-2 text-left sticky left-0 bg-slate-800 group-hover:bg-slate-700 border-r border-slate-400 z-20",children:e.jsx("div",{className:"flex items-center space-x-2 min-h-6",children:e.jsx("span",{className:"font-bold text-sm text-white",children:"TOTALS"})})}),G.map(({key:s})=>{const a=D.reduce((o,l)=>o+(l.monthlyValues[s]||0),0);return e.jsx("td",{className:"px-2 py-2 text-center text-sm font-bold text-white border-l border-slate-400 group-hover:bg-slate-700",onClick:o=>{o.stopPropagation(),g?.({drillDownContext:"category-total-month",filterCriteria:{month:s},name:`Grand Total (${s})`,month:s})},children:e.jsx("div",{className:"flex flex-col items-center space-y-0.5 min-h-6 justify-center",children:e.jsx("span",{className:"font-mono text-xs whitespace-nowrap",children:z(a,A)})})},s)})]})]})]})})}),e.jsx(Ne,{tableId:"category-performance-analysis",initialText:"• Category-level performance insights across all product lines\\n• Revenue distribution and market share analysis by category\\n• Growth trends and seasonal patterns identification",className:"animate-in slide-in-from-bottom-4 fade-in duration-1000 delay-300",tableData:u,tableColumns:i,tableName:"Category Performance Analysis",tableContext:`Performance analysis by product category showing ${A} trends across ${G.length} months`})]})},oa=te.memo(ra,(j,g)=>j.data===g.data&&j.selectedMetric===g.selectedMetric&&j.onRowClick===g.onRowClick&&j.onReady===g.onReady),pe=["#1e3a8a","#1e40af","#1d4ed8","#2563eb","#312e81","#3730a3","#4338ca","#0f172a"],Re=({active:j,payload:g,label:B})=>j&&g&&g.length?e.jsxs("div",{className:"p-3 bg-slate-900/90 text-white backdrop-blur-xl rounded-lg shadow-xl border border-slate-700/70",children:[e.jsx("p",{className:"label font-semibold text-white/90 mb-1",children:`${B}`}),g.map((b,A)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{style:{width:10,height:10,backgroundColor:b.color,borderRadius:"50%"}}),e.jsx("span",{className:"font-medium text-white/80",children:`${b.name}: `}),e.jsx("span",{className:"font-mono font-semibold text-white",children:["revenue","value"].includes(String(b.name))?le(b.value):ne(b.value)})]},A))]}):null,la=j=>{const{fill:g,x:B,y:b,width:A,height:Z}=j;return e.jsxs("g",{children:[e.jsx("rect",{x:B,y:b,width:A,height:Z,fill:g}),e.jsx("path",{d:`M${B},${b} L${B+8},${b-5} L${B+A+8},${b-5} L${B+A},${b} Z`,fill:"#ffffff",fillOpacity:.08}),e.jsx("path",{d:`M${B+A},${b} L${B+A+8},${b-5} L${B+A+8},${b+Z-5} L${B+A},${b+Z} Z`,fill:"#000000",fillOpacity:.15})]})},lt=te.memo(({data:j})=>{const[g,B]=M.useState("6m"),[b,A]=M.useState("revenue"),[Z,ae]=M.useState("revenue"),X=M.useMemo(()=>{if(!j||j.length===0)return[];const S=new Date;let I=new Date;switch(g){case"1m":I.setMonth(S.getMonth()-1);break;case"3m":I.setMonth(S.getMonth()-3);break;case"6m":I.setMonth(S.getMonth()-6);break;case"1y":I.setFullYear(S.getFullYear()-1);break;default:return j}return j.filter(R=>{if(!R.paymentDate)return!1;const k=new Date(R.paymentDate);return k>=I&&k<=S})},[j,g]),E=M.useMemo(()=>{if(!X.length)return[];const S=X.reduce((I,R)=>{if(!R.paymentDate)return I;const k=new Date(R.paymentDate),V=`${k.getFullYear()}-${String(k.getMonth()+1).padStart(2,"0")}`;return I[V]||(I[V]={month:k.toLocaleDateString("en",{month:"short",year:"numeric"}),revenue:0,transactions:0,customers:new Set}),I[V].revenue+=R.paymentValue||0,I[V].transactions+=1,I[V].customers.add(R.memberId),I},{});return Object.values(S).map(I=>({...I,customers:I.customers.size})).sort((I,R)=>new Date(I.month).getTime()-new Date(R.month).getTime())},[X]),se=M.useMemo(()=>{if(!X.length)return[];const S=X.reduce((k,V)=>{const z=V.cleanedProduct||"Unknown Product";return k[z]||(k[z]={name:z,revenue:0,transactions:0,customers:new Set,units:0}),k[z].revenue+=V.paymentValue||0,k[z].transactions+=1,k[z].customers.add(V.memberId),k[z].units+=1,k},{}),I=Object.values(S).map(k=>({...k,customers:k.customers.size}));let R;switch(Z){case"transactions":R=I.sort((k,V)=>V.transactions-k.transactions);break;case"customers":R=I.sort((k,V)=>V.customers-k.customers);break;case"units":R=I.sort((k,V)=>V.units-k.units);break;default:R=I.sort((k,V)=>V.revenue-k.revenue)}return R.slice(0,10)},[X,Z]),K=M.useMemo(()=>{if(!X.length)return[];const S=X.reduce((I,R)=>{const k=R.cleanedCategory||"Uncategorized";return I[k]||(I[k]=0),I[k]+=R.paymentValue||0,I},{});return Object.entries(S).map(([I,R])=>({name:I,value:R})).sort((I,R)=>R.value-I.value)},[X]),L=M.useCallback(S=>{B(S)},[]),Q=M.useCallback(S=>{A(S)},[]),Y=M.useCallback(S=>{ae(S)},[]);if(!j||j.length===0)return e.jsxs(Ve,{className:"bg-white/70 backdrop-blur-lg border-gray-200/80 shadow-lg rounded-2xl",children:[e.jsx($e,{children:e.jsxs(Ae,{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5 text-blue-500"}),"Interactive Sales Charts"]})}),e.jsx(ke,{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-gray-500",children:"No data available for charts"})})]});const ee=()=>{switch(b){case"revenue":return e.jsx(Ie,{width:"100%",height:400,children:e.jsxs(Kt,{data:E,margin:{top:10,right:30,left:20,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:pe[1],stopOpacity:.55}),e.jsx("stop",{offset:"95%",stopColor:pe[1],stopOpacity:0})]})}),e.jsx(Ye,{strokeDasharray:"3 3",stroke:"#e5e7eb",vertical:!1}),e.jsx(qe,{dataKey:"month",tick:{fill:"#334155",fontSize:12},axisLine:!1,tickLine:!1}),e.jsx(Ue,{tickFormatter:S=>le(S),tick:{fill:"#334155",fontSize:12},axisLine:!1,tickLine:!1}),e.jsx(Fe,{content:e.jsx(Re,{})}),e.jsx(Gt,{type:"monotone",dataKey:"revenue",stroke:pe[0],strokeWidth:3,fillOpacity:1,fill:"url(#colorRevenue)",dot:{stroke:pe[0],strokeWidth:2,r:4,fill:"white"},activeDot:{r:8,fill:pe[0],stroke:"white",strokeWidth:2}})]})});case"products":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(oe,{variant:Z==="revenue"?"default":"outline",size:"sm",onClick:()=>Y("revenue"),children:"Revenue"}),e.jsx(oe,{variant:Z==="transactions"?"default":"outline",size:"sm",onClick:()=>Y("transactions"),children:"Transactions"}),e.jsx(oe,{variant:Z==="customers"?"default":"outline",size:"sm",onClick:()=>Y("customers"),children:"Customers"}),e.jsx(oe,{variant:Z==="units"?"default":"outline",size:"sm",onClick:()=>Y("units"),children:"Units Sold"})]}),e.jsx(Ie,{width:"100%",height:400,children:e.jsxs(zt,{data:se,margin:{left:20,right:30,top:20,bottom:60},children:[e.jsx(Ye,{strokeDasharray:"3 3",vertical:!1,stroke:"#e5e7eb"}),e.jsx(qe,{dataKey:"name",angle:-45,textAnchor:"end",height:100,interval:0,tick:{fill:"#334155",fontSize:12},axisLine:!1,tickLine:!1}),e.jsx(Ue,{tickFormatter:S=>Z==="revenue"?le(S):ne(S),tick:{fill:"#334155",fontSize:12},axisLine:!1,tickLine:!1}),e.jsx(Fe,{content:e.jsx(Re,{}),cursor:{fill:"rgba(230, 230, 230, 0.4)"}}),e.jsx(Yt,{dataKey:Z,shape:e.jsx(la,{}),fill:pe[1]})]})})]});case"categories":return e.jsx(Ie,{width:"100%",height:400,children:e.jsxs(qt,{children:[e.jsx(Ut,{data:K,cx:"50%",cy:"50%",labelLine:!1,label:({name:S,percent:I})=>`${S} ${(I*100).toFixed(0)}%`,outerRadius:150,innerRadius:80,paddingAngle:3,dataKey:"value",cornerRadius:8,children:K.map((S,I)=>e.jsx(Bt,{fill:pe[I%pe.length],stroke:"#ffffff",strokeWidth:2},`cell-${I}`))}),e.jsx(Fe,{content:e.jsx(Re,{})}),e.jsx(Ot,{iconType:"circle",wrapperStyle:{color:"#334155"}})]})});default:return null}};return e.jsxs(Ve,{className:"bg-white/70 backdrop-blur-lg border-gray-200/80 shadow-lg rounded-2xl overflow-hidden",children:[e.jsx($e,{className:"pb-4 border-b border-gray-200/80",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs(Ae,{className:"text-xl font-semibold text-gray-800 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg border border-gray-200",children:e.jsx(Se,{className:"w-5 h-5 text-gray-600"})}),"Interactive Sales Charts"]})}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600 flex items-center gap-1",children:[e.jsx(be,{className:"w-4 h-4"}),"Time Range:"]}),[{key:"1m",label:"Last Month"},{key:"3m",label:"Last 3 Months"},{key:"6m",label:"Last 6 Months"},{key:"1y",label:"Last Year"}].map(({key:S,label:I})=>e.jsx(oe,{variant:g===S?"default":"outline",size:"sm",onClick:()=>L(S),className:"transition-all duration-300 rounded-full",children:I},S))]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600 flex items-center gap-1",children:[e.jsx(me,{className:"w-4 h-4"}),"Chart Type:"]}),e.jsxs(oe,{variant:b==="revenue"?"default":"outline",size:"sm",onClick:()=>Q("revenue"),className:"flex items-center gap-1 transition-all duration-300 rounded-full",children:[e.jsx(Vt,{className:"w-4 h-4"}),"Revenue Trend"]}),e.jsxs(oe,{variant:b==="products"?"default":"outline",size:"sm",onClick:()=>Q("products"),className:"flex items-center gap-1 transition-all duration-300 rounded-full",children:[e.jsx(Se,{className:"w-4 h-4"}),"Top 10 Products"]}),e.jsxs(oe,{variant:b==="categories"?"default":"outline",size:"sm",onClick:()=>Q("categories"),className:"flex items-center gap-1 transition-all duration-300 rounded-full",children:[e.jsx($t,{className:"w-4 h-4"}),"Categories"]})]})]})}),e.jsx(ke,{className:"p-6",children:e.jsx(it.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},children:ee()},b+Z+g)})]})});lt.displayName="SalesInteractiveCharts";const ca=({data:j,onRowClick:g,selectedMetric:B="revenue",onReady:b})=>{const[A,Z]=M.useState(B),[ae,X]=M.useState("values"),[E,se]=M.useState("total"),[K,L]=M.useState("desc"),Q=M.useRef(null),Y=Me(),ee=n=>{if(!n)return null;const d=n.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(d){const[,i,s,a]=d;return new Date(parseInt(a),parseInt(s)-1,parseInt(i))}const u=new Date(n);return isNaN(u.getTime())?null:u},S=(n,d)=>{if(!n.length)return 0;const u=n.reduce((r,x)=>{const t=x.paymentValue||0,c=x.paymentVAT||x.vat||0;return r+(t-c)},0),i=n.length,s=new Set(n.map(r=>r.memberId)).size,a=n.length,o=n.reduce((r,x)=>r+(x.paymentVAT||x.vat||0),0),l=n.reduce((r,x)=>r+(x.discountAmount||0),0),h=n.reduce((r,x)=>r+(x.paymentValue||0),0),p=h>0?l/h*100:0,$=()=>{if(s<=1)return 0;const r={};n.forEach(c=>{const m=ee(c.paymentDate);m&&c.memberId&&(r[c.memberId]||(r[c.memberId]=[]),r[c.memberId].push(m))});let x=0,t=0;return Object.values(r).forEach(c=>{if(c.length>1){c.sort((m,f)=>m.getTime()-f.getTime());for(let m=1;m<c.length;m++){const f=(c[m].getTime()-c[m-1].getTime())/864e5;x+=f,t++}}}),t>0?x/t:0};switch(d){case"revenue":return u;case"transactions":return i;case"members":return s;case"units":return a;case"atv":return i>0?u/i:0;case"auv":return s>0?u/s:0;case"upt":return i>0?a/i:0;case"asv":return i>0?u/i:0;case"vat":return o;case"discountValue":return l;case"discountPercentage":return p;case"purchaseFrequency":return $();default:return 0}},I=(n,d)=>{switch(d){case"revenue":case"auv":case"atv":case"asv":case"vat":case"discountValue":return le(n);case"transactions":case"members":case"units":return ne(n);case"upt":return n.toFixed(1);case"discountPercentage":return`${n.toFixed(1)}%`;case"purchaseFrequency":return`${n.toFixed(1)} days`;default:return ne(n)}},R=M.useMemo(()=>Qe(),[]),k=M.useMemo(()=>R,[R]),z=(()=>{const n=new Date,d=new Date(n.getFullYear(),n.getMonth()-1,1);return`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`})(),C=M.useMemo(()=>{const n=j.reduce((i,s)=>{const a=s.soldBy||"Unknown";return i[a]||(i[a]=[]),i[a].push(s),i},{}),d=Object.entries(n).map(([i,s])=>{const a={};return k.forEach(({key:o,year:l,month:h})=>{const p=s.filter($=>{const r=ee($.paymentDate);return r&&r.getFullYear()===l&&r.getMonth()+1===h});a[o]=S(p,A)}),{seller:i,monthlyValues:a,totalValue:S(s,A),totalRevenue:s.reduce((o,l)=>{const h=l.paymentValue||0,p=l.paymentVAT||l.vat||0;return o+(h-p)},0),totalTransactions:s.length,uniqueMembers:new Set(s.map(o=>o.memberId)).size,rawData:s}}),u=(i,s)=>{const a=(h,p)=>h.monthlyValues?.[p]||0;let o,l;return E==="total"?(o=i.totalValue,l=s.totalValue):(o=a(i,E),l=a(s,E)),K==="desc"?l-o:o-l};return d.sort(u)},[j,A,k,E,K]),[D,G]=te.useState(!1);te.useEffect(()=>{!D&&C.length>0&&k.length>0&&(G(!0),b?.())},[D,C,k,b]);const v=(n,d)=>d===0&&n===0?null:d===0?"+100":((n-d)/d*100).toFixed(1),y=M.useCallback(async()=>{let n=`Sales Team Performance - All Metrics
`;n+=`Exported on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
`,n+=`
${"=".repeat(80)}

`;for(const d of ue){const u=d.key;n+=`
${d.label.toUpperCase()}
`,n+=`${"-".repeat(d.label.length+10)}

`;const i=["Sold By","Total"];k.forEach(o=>i.push(o.display)),n+=i.join("	")+`
`,n+=i.map(()=>"---").join("	")+`
`;const s=j.reduce((o,l)=>{const h=l.soldBy||"Unknown";return o[h]||(o[h]=[]),o[h].push(l),o},{});Object.entries(s).map(([o,l])=>{const h={};return R.forEach(({key:p,year:$,month:r})=>{const x=l.filter(t=>{const c=ee(t.paymentDate);return c&&c.getFullYear()===$&&c.getMonth()+1===r});h[p]=S(x,u)}),{soldBy:o,monthlyValues:h,totalValue:S(l,u)}}).forEach(o=>{const l=[o.soldBy,I(o.totalValue,u)];k.forEach(h=>{const p=o.monthlyValues[h.key]||0;l.push(I(p,u))}),n+=l.join("	")+`
`}),n+=`
`}return n},[j,k,R]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx(we,{metrics:ue,selectedMetric:A,onMetricChange:n=>Z(n)}),e.jsx(je,{title:"Sales Team Performance",description:"Individual seller performance analysis across all metrics and timeframes",icon:e.jsx(ge,{className:"w-5 h-5 text-white"}),totalItems:C.length,showDisplayToggle:!0,displayMode:ae,onDisplayModeChange:X,showCollapseControls:!1,tableRef:Q,showCopyButton:!0,onCopyAllTabs:y,contextInfo:{...Y.contextInfo,selectedMetric:A,additionalInfo:{displayMode:ae,totalItems:C.length,sortBy:E,sortDirection:K}},children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{ref:Q,className:"min-w-full bg-white",children:[e.jsx("thead",{className:"sticky top-0 z-30",children:e.jsxs("tr",{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:[e.jsx("th",{className:"w-80 px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide sticky left-0 bg-gradient-to-r from-slate-800 to-slate-900 z-40 border-r border-white/20 cursor-pointer select-none",onClick:()=>{E!=="total"?(se("total"),L("desc")):L(n=>n==="desc"?"asc":"desc")},title:`Sort by total (${K})`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ge,{className:"w-4 h-4 text-white"}),e.jsx("span",{children:"Sales Representative"})]})}),k.map(({key:n,display:d})=>{const u=n===z;return e.jsx("th",{className:`px-3 py-3 text-center font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[90px] cursor-pointer select-none ${u?"bg-blue-800 text-white":"text-white"}`,onClick:()=>{E!==n?(se(n),L("desc")):L(i=>i==="desc"?"asc":"desc")},title:`Sort by ${d} (${K})${u?" - Main Month":""}`,children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[u&&e.jsx(ve,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-bold whitespace-nowrap",children:d.split(" ")[0]})]}),e.jsx("span",{className:"text-slate-300 text-xs",children:d.split(" ")[1]})]})},n)})]})}),e.jsxs("tbody",{children:[C.map((n,d)=>e.jsxs("tr",{className:"bg-white hover:bg-slate-50 border-b border-gray-200 transition-all duration-200 h-10 max-h-10",onClick:()=>g?.({...n,contextType:"soldBy",drillDownContext:"soldby-analysis",filterCriteria:{soldBy:n.seller}}),children:[e.jsx("td",{className:"w-80 px-4 py-2 text-left sticky left-0 bg-white hover:bg-slate-50 border-r border-gray-200 z-20 cursor-pointer transition-all duration-200",children:e.jsx("div",{className:"flex items-center space-x-2 min-h-6",children:e.jsx("div",{className:"flex items-center space-x-2 flex-1",children:e.jsx("span",{className:"text-slate-700 font-medium text-sm truncate",children:n.seller})})})}),k.map(({key:u},i)=>{const s=n.monthlyValues[u]||0,a=u===z,o=k[i+1]?.key,l=o&&n.monthlyValues[o]||0,h=i<k.length-1?v(s,l):null;return e.jsx("td",{className:"px-2 py-2 text-center text-sm font-mono text-slate-700 border-l border-gray-200 hover:bg-slate-100 cursor-pointer transition-all duration-200",title:h?`${h}% vs previous month${a?" - Main Month":""}`:a?"Main Month":"",onClick:p=>{p.stopPropagation(),g?.({...n,contextType:"soldBy-month",filterCriteria:{soldBy:n.seller,month:u,specificValue:s},drillDownContext:{type:"soldBy-month",itemName:n.seller,month:u,value:s,metric:A},clickedItemName:n.seller,contextDescription:`${n.seller} performance in ${u}: ${I(s,A)}`})},children:e.jsx("div",{className:"flex flex-col items-center space-y-0.5 min-h-6 justify-center",children:ae==="values"?e.jsx("span",{className:"text-xs whitespace-nowrap",children:I(s,A)}):h&&e.jsxs("div",{className:`flex items-center space-x-1 text-xs ${parseFloat(h)>0?"text-emerald-500":"text-red-400"}`,children:[parseFloat(h)>0?e.jsx(me,{className:"w-2 h-2"}):e.jsx(he,{className:"w-2 h-2"}),e.jsxs("span",{className:"font-mono",children:[Math.abs(parseFloat(h)),"%"]})]})})},u)})]},n.seller)),e.jsxs("tr",{className:"bg-slate-800 text-white font-bold border-t-2 border-slate-400 h-10 max-h-10 cursor-pointer hover:bg-slate-700",onClick:()=>g?.({drillDownContext:"soldby-grand-total",filterCriteria:{},name:"Grand Total (All Sellers)",rawData:j,isGroup:!0}),children:[e.jsx("td",{className:"w-80 px-4 py-2 text-left sticky left-0 bg-slate-800 group-hover:bg-slate-700 border-r border-slate-400 z-20",children:e.jsx("div",{className:"flex items-center space-x-2 min-h-6",children:e.jsx("span",{className:"font-bold text-sm text-white",children:"TOTALS"})})}),k.map(({key:n,year:d,month:u})=>{const i=j.filter(o=>{const l=ee(o.paymentDate);return l&&l.getFullYear()===d&&l.getMonth()+1===u}),s=S(i,A),a=n===z;return e.jsx("td",{className:"px-2 py-2 text-center text-sm font-bold text-white border-l border-slate-400 group-hover:bg-slate-700 cursor-pointer transition-all duration-200",title:a?"Main Month - Grand Total":"",onClick:o=>{o.stopPropagation(),g?.({drillDownContext:"soldby-total-month",filterCriteria:{month:n},name:`Grand Total (${n})`,month:n})},children:e.jsx("div",{className:"flex flex-col items-center space-y-0.5 min-h-6 justify-center",children:e.jsx("span",{className:"font-mono text-xs whitespace-nowrap",children:I(s,A)})})},n)})]})]})]})})}),e.jsx(Ne,{tableId:"sales-team-performance",initialText:"• Sales team performance analysis by individual seller • Consistent performers identified for recognition • Training opportunities highlighted for underperformers"})]})},ia=te.memo(ca,(j,g)=>j.data===g.data&&j.selectedMetric===g.selectedMetric&&j.onRowClick===g.onRowClick&&j.onReady===g.onReady),da=({data:j,onRowClick:g,selectedMetric:B="revenue",onReady:b})=>{const[A,Z]=M.useState(B),[ae,X]=M.useState("values"),[E,se]=M.useState("total"),[K,L]=M.useState("desc"),Q=M.useRef(null),Y=Me(),S=(()=>{const n=new Date,d=new Date(n.getFullYear(),n.getMonth()-1,1);return`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`})(),I=n=>{if(!n)return null;const d=n.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(d){const[,i,s,a]=d;return new Date(parseInt(a),parseInt(s)-1,parseInt(i))}const u=new Date(n);return isNaN(u.getTime())?null:u},R=(n,d)=>{if(!n.length)return 0;const u=n.reduce((x,t)=>{const c=t.paymentValue||0,m=t.paymentVAT||t.vat||0;return x+(c-m)},0),i=n.length,s=new Set(n.map(x=>x.memberId)).size,a=n.length,o=n.reduce((x,t)=>x+(t.paymentVAT||t.vat||0),0),l=n.reduce((x,t)=>x+(t.discountAmount||0),0),h=n.reduce((x,t)=>x+(t.paymentValue||0),0),p=h>0?l/h*100:0,$=n.map(x=>{const t=x.paymentDate;if(!t)return null;const c=t.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(c){const[,m,f,N]=c;return new Date(parseInt(N),parseInt(f)-1,parseInt(m))}return new Date(t)}).filter(x=>x!==null&&!isNaN(x.getTime())).sort((x,t)=>x.getTime()-t.getTime());let r=0;switch($.length>1&&(r=($[$.length-1].getTime()-$[0].getTime())/864e5/($.length-1)),d){case"revenue":return u;case"transactions":return i;case"members":return s;case"units":return a;case"atv":return i>0?u/i:0;case"auv":return s>0?u/s:0;case"upt":return i>0?a/i:0;case"asv":return i>0?u/i:0;case"vat":return o;case"discountValue":return l;case"discountPercentage":return p;case"purchaseFrequency":return r;default:return 0}},k=(n,d)=>{switch(d){case"revenue":case"auv":case"atv":case"asv":case"vat":case"discountValue":return le(n);case"transactions":case"members":case"units":return ne(n);case"upt":return n.toFixed(1);case"discountPercentage":return`${n.toFixed(1)}%`;case"purchaseFrequency":return`${n.toFixed(1)} days`;default:return ne(n)}},V=M.useMemo(()=>Qe(),[]),z=M.useMemo(()=>V,[V]),C=M.useMemo(()=>{const n=j.reduce((i,s)=>{const a=s.paymentMethod||"Unknown";return i[a]||(i[a]=[]),i[a].push(s),i},{}),d=Object.entries(n).map(([i,s])=>{const a={};return V.forEach(({key:o,year:l,month:h})=>{const p=s.filter($=>{const r=I($.paymentDate);return r&&r.getFullYear()===l&&r.getMonth()+1===h});a[o]=R(p,A)}),{method:i,monthlyValues:a,totalValue:R(s,A),totalRevenue:s.reduce((o,l)=>{const h=l.paymentValue||0,p=l.paymentVAT||l.vat||0;return o+(h-p)},0),totalTransactions:s.length,uniqueMembers:new Set(s.map(o=>o.memberId)).size,rawData:s}}),u=(i,s)=>{const a=(h,p)=>h.monthlyValues?.[p]||0;let o,l;return E==="total"?(o=i.totalValue,l=s.totalValue):(o=a(i,E),l=a(s,E)),K==="desc"?l-o:o-l};return d.sort(u)},[j,A,V,E,K]),[D,G]=te.useState(!1);te.useEffect(()=>{!D&&C.length>0&&z.length>0&&(G(!0),b?.())},[D,C,z,b]);const v=(n,d)=>d===0&&n===0?null:d===0?"+100":((n-d)/d*100).toFixed(1),y=M.useCallback(async()=>{let n=`Payment Method Analysis - All Metrics
`;n+=`Exported on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
`,n+=`
${"=".repeat(80)}

`;for(const d of ue){const u=d.key;n+=`
${d.label.toUpperCase()}
`,n+=`${"-".repeat(d.label.length+10)}

`;const i=["Payment Method","Total"];z.forEach(o=>i.push(o.display)),n+=i.join("	")+`
`,n+=i.map(()=>"---").join("	")+`
`;const s=j.reduce((o,l)=>{const h=l.paymentMethod||"Unknown";return o[h]||(o[h]=[]),o[h].push(l),o},{});Object.entries(s).map(([o,l])=>{const h={};return V.forEach(({key:p,year:$,month:r})=>{const x=l.filter(t=>{const c=I(t.paymentDate);return c&&c.getFullYear()===$&&c.getMonth()+1===r});h[p]=R(x,u)}),{method:o,monthlyValues:h,totalValue:R(l,u)}}).forEach(o=>{const l=[o.method,k(o.totalValue,u)];z.forEach(h=>{const p=o.monthlyValues[h.key]||0;l.push(k(p,u))}),n+=l.join("	")+`
`}),n+=`
`}return n},[j,z,V]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx(we,{metrics:ue,selectedMetric:A,onMetricChange:n=>Z(n)}),e.jsx(je,{title:"Payment Method Analysis",description:"Performance breakdown by payment method across all metrics and timeframes",icon:e.jsx(Be,{className:"w-5 h-5 text-white"}),totalItems:C.length,showDisplayToggle:!0,displayMode:ae,onDisplayModeChange:X,showCollapseControls:!1,tableRef:Q,showCopyButton:!0,onCopyAllTabs:y,contextInfo:{selectedMetric:A,dateRange:Y.dateRange,filters:Y.filters,additionalInfo:{displayMode:ae,totalItems:C.length,sortBy:E,sortDirection:K}},children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{ref:Q,className:"min-w-full bg-white",children:[e.jsx("thead",{className:"sticky top-0 z-30",children:e.jsxs("tr",{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:[e.jsx("th",{className:"w-80 px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide sticky left-0 bg-gradient-to-r from-slate-800 to-slate-900 z-40 border-r border-white/20 cursor-pointer select-none",onClick:()=>{E!=="total"?(se("total"),L("desc")):L(n=>n==="desc"?"asc":"desc")},title:`Sort by total (${K})`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Be,{className:"w-4 h-4 text-white"}),e.jsx("span",{children:"Payment Method"})]})}),z.map(({key:n,display:d})=>{const u=n===S;return e.jsx("th",{className:`px-3 py-3 text-center font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[90px] cursor-pointer select-none ${u?"bg-blue-800 text-white":"text-white"}`,onClick:()=>{E!==n?(se(n),L("desc")):L(i=>i==="desc"?"asc":"desc")},title:`Sort by ${d} (${K})${u?" - Main Month":""}`,children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[u&&e.jsx(ve,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-bold whitespace-nowrap",children:d.split(" ")[0]})]}),e.jsx("span",{className:"text-slate-300 text-xs",children:d.split(" ")[1]})]})},n)})]})}),e.jsxs("tbody",{children:[C.map((n,d)=>e.jsxs("tr",{className:"bg-white hover:bg-slate-50 border-b border-gray-200 transition-all duration-200 h-12",onClick:()=>g?.({...n,contextType:"paymentMethod",drillDownContext:"payment-method-analysis",filterCriteria:{paymentMethod:n.method}}),children:[e.jsx("td",{className:"w-80 px-4 py-2 text-left sticky left-0 bg-white hover:bg-slate-50 border-r border-gray-200 z-20 cursor-pointer transition-all duration-200",children:e.jsxs("div",{className:"flex items-center space-x-2 min-h-8",children:[e.jsx("span",{className:"text-slate-400 text-xs",children:"→"}),e.jsx("span",{className:"text-slate-700 font-medium text-sm truncate",children:n.method})]})}),z.map(({key:u},i)=>{const s=n.monthlyValues[u]||0,a=z[i+1]?.key,o=a&&n.monthlyValues[a]||0,l=i<z.length-1?v(s,o):null;return e.jsx("td",{className:"px-2 py-2 text-center text-sm font-mono text-slate-700 border-l border-gray-200 hover:bg-slate-100 cursor-pointer transition-all duration-200",title:l?`${l}% vs previous month`:"",onClick:h=>{h.stopPropagation(),g?.({...n,contextType:"paymentMethod-month",filterCriteria:{paymentMethod:n.method,month:u,specificValue:s},drillDownContext:{type:"paymentMethod-month",itemName:n.method,month:u,value:s,metric:A},clickedItemName:n.method,contextDescription:`${n.method} performance in ${u}: ${k(s,A)}`})},children:e.jsx("div",{className:"flex flex-col items-center space-y-0.5 min-h-6 justify-center",children:ae==="values"?e.jsx("span",{className:"text-xs whitespace-nowrap",children:k(s,A)}):l&&e.jsxs("div",{className:`flex items-center space-x-1 text-xs ${parseFloat(l)>0?"text-emerald-500":"text-red-400"}`,children:[parseFloat(l)>0?e.jsx(me,{className:"w-2 h-2"}):e.jsx(he,{className:"w-2 h-2"}),e.jsxs("span",{className:"font-mono",children:[Math.abs(parseFloat(l)),"%"]})]})})},u)})]},n.method)),e.jsxs("tr",{className:"bg-slate-800 text-white font-bold border-t-2 border-slate-400 h-10 max-h-10 cursor-pointer hover:bg-slate-700",onClick:()=>g?.({drillDownContext:"payment-method-grand-total",filterCriteria:{},name:"Grand Total (All Payment Methods)",rawData:j,isGroup:!0}),children:[e.jsx("td",{className:"w-80 px-4 py-2 text-left sticky left-0 bg-slate-800 group-hover:bg-slate-700 border-r border-slate-400 z-20",children:e.jsx("div",{className:"flex items-center space-x-2 min-h-6",children:e.jsx("span",{className:"font-bold text-sm text-white",children:"TOTALS"})})}),z.map(({key:n})=>{const d=C.reduce((u,i)=>u+(i.monthlyValues[n]||0),0);return e.jsx("td",{className:"px-2 py-2 text-center text-sm font-bold text-white border-l border-slate-400 group-hover:bg-slate-700",onClick:u=>{u.stopPropagation(),g?.({drillDownContext:"payment-method-total-month",filterCriteria:{month:n},name:`Grand Total (${n})`,month:n})},children:e.jsx("div",{className:"flex flex-col items-center space-y-0.5 min-h-6 justify-center",children:e.jsx("span",{className:"font-mono text-xs whitespace-nowrap",children:k(d,A)})})},n)})]})]})]})})}),e.jsx(Ne,{tableId:"payment-method-analysis",initialText:"• Payment method preference analysis across customer base • Transaction distribution and processing efficiency metrics • Revenue optimization opportunities by payment channel"})]})},ua=te.memo(da,(j,g)=>j.data===g.data&&j.selectedMetric===g.selectedMetric&&j.onRowClick===g.onRowClick&&j.onReady===g.onReady),ma={all:"All Locations",kwality:"Kwality House, Kemps Corner",supreme:"Supreme HQ, Bandra",kenkere:"Kenkere House"},ha=({data:j,currentLocation:g,locationName:B,buttonVariant:b="outline",buttonSize:A="sm",buttonClassName:Z,buttonLabel:ae,openRef:X,renderTrigger:E=!0})=>{const[se,K]=M.useState(!1);M.useEffect(()=>{X&&(X.current={open:()=>K(!0)})},[X]);const[L,Q]=M.useState(!1),[Y,ee]=M.useState({currentView:!0,monthOnMonth:!0,yearOnYear:!0,productPerformance:!0,categoryPerformance:!0,soldByAnalysis:!0,paymentMethodAnalysis:!0,allTabs:!0}),S=()=>{const n=document.querySelector('[role="tab"][data-state="active"]'),d=n?.getAttribute("data-value")||"current-view",u=n?.textContent?.trim()||"Current View";return{tabValue:d,tabText:u}},I=(n,d)=>{const u=[],i=[];let s=n.querySelector("thead tr");return s||(s=n.querySelector("tr:has(th)")),s||(s=n.querySelector("tr")),s&&s.querySelectorAll("th, td").forEach(l=>{let h=l.textContent?.trim()||"";h=h.replace(/[↑↓▲▼]/g,"").trim(),u.push(h)}),n.querySelectorAll("tr").forEach(o=>{if(s&&o===s)return;const l=o.querySelectorAll("td, th");if(l.length===0)return;const h=[];l.forEach(p=>{let $=p.textContent?.trim()||"";p.querySelector("button")&&($=p.querySelector("button")?.textContent?.trim()||$),$=$.replace(/[↑↓▲▼]/g,"").trim(),h.push($)}),h.some(p=>p.length>0&&p!=="—"&&p!=="-")&&i.push(h)}),{name:d,headers:u,rows:i}},R=()=>{const n=[],d=document.querySelectorAll('[role="tabpanel"][data-state="active"]'),u=[];return d.forEach(i=>{i.querySelectorAll("table").forEach(a=>{const o=a,l=window.getComputedStyle(o);o.offsetParent!==null&&l.display!=="none"&&l.visibility!=="hidden"&&l.opacity!=="0"&&u.push(o)})}),u.length===0&&document.querySelectorAll("table").forEach(i=>{const s=i,a=window.getComputedStyle(s);s.offsetParent!==null&&a.display!=="none"&&a.visibility!=="hidden"&&a.opacity!=="0"&&u.push(s)}),u.forEach((i,s)=>{const a=`Data Table ${s+1}`,o=I(i,a);o.rows.length>0&&n.push(o)}),n},k=["Revenue","Units Sold","Transactions","Members","AUV","ATV","ASV","UPT","VAT","Discount ₹","Discount %","Purchase Freq."],V=async(n,d=300)=>{if(n instanceof HTMLElement)try{n.scrollIntoView({block:"center"}),n.click(),await new Promise(u=>setTimeout(u,d))}catch{}},z=async(n,d,u)=>{const i=document.querySelector('[role="tabpanel"][data-state="active"], [data-state="active"][role="tabpanel"], [data-state="active"]');if(!i)return;const s=[];if(k.forEach(a=>{const o=Array.from(i.querySelectorAll("button")).find(l=>(l.textContent||"").trim()===a);o&&!s.includes(o)&&s.push(o)}),s.length!==0)for(const a of s){const o=(a.textContent||"").trim();await V(a,350);const l=R();for(const h of l){let p="";p+=`# Sales Analytics Export
`,p+=`# Section: ${u}
`,p+=`# Metric: ${o}
`,p+=`# Location: ${n}
`,p+=`# Export Time: ${new Date().toLocaleString()}
`,p+=`# Table: ${h.name}

`,h.headers.length>0&&(p+=h.headers.map(N=>`"${N.replace(/"/g,'""')}"`).join(",")+`
`),h.rows.forEach(N=>{p+=N.map(w=>`"${w.replace(/"/g,'""')}"`).join(",")+`
`});const $=u.replace(/[^a-zA-Z0-9\-]/g,"-"),r=o.replace(/[^a-zA-Z0-9\-]/g,"-"),x=h.name.replace(/[^a-zA-Z0-9\-\s]/g,"").replace(/\s+/g,"-"),t=`${$}-${r}-${x}-${n}-${d}.csv`,c=new Blob([p],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a"),f=URL.createObjectURL(c);m.setAttribute("href",f),m.setAttribute("download",t),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m),await new Promise(N=>setTimeout(N,250))}}},C=async()=>{Q(!0);try{const n=new Date().toISOString().slice(0,19).replace(/:/g,"-"),d=g==="all"?"All-Locations":ma[g]||g,u=R();if(u.length===0){alert("No table data found to export. Please ensure tables are loaded and visible.");return}for(const a of u){let o="";a.headers.length>0&&(o+=a.headers.join(",")+`
`),a.rows.forEach(r=>{o+=r.map(x=>`"${x.replace(/"/g,'""')}"`).join(",")+`
`});const l=`${a.name.replace(/\s+/g,"-")}-${d}-${n}.csv`,h=new Blob([o],{type:"text/csv;charset=utf-8;"}),p=document.createElement("a"),$=URL.createObjectURL(h);p.setAttribute("href",$),p.setAttribute("download",l),p.style.visibility="hidden",document.body.appendChild(p),p.click(),document.body.removeChild(p),await new Promise(r=>setTimeout(r,200))}const s=(document.querySelector('[role="tab"][data-state="active"]')?.textContent||"").trim()||"current-view";await z(d,n,s),(Y.yearOnYear||Y.monthOnMonth||Y.productPerformance||Y.categoryPerformance||Y.soldByAnalysis||Y.paymentMethodAnalysis||Y.allTabs)&&await v(d,n),K(!1)}catch{alert("Export failed. Please try again.")}finally{Q(!1)}},D=(n,d)=>{let i=`<!doctype html><html><head><meta charset="utf-8" />
      <style>
        body { font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif; padding: 24px; color: #0f172a; }
        h1 { font-size: 20px; margin: 0 0 16px; }
        h2 { font-size: 16px; margin: 24px 0 8px; color: #334155; }
        h3 { font-size: 14px; margin: 12px 0 8px; color: #475569; }
        .meta { font-size: 12px; color: #64748b; margin-bottom: 16px; }
        table { border-collapse: collapse; width: 100%; margin: 8px 0 24px; font-size: 12px; }
        th, td { border: 1px solid #e2e8f0; padding: 6px 8px; text-align: left; }
        thead th { background: #0f172a; color: white; position: sticky; top: 0; }
        .page-break { page-break-after: always; height: 0; }
      </style>
    <title>${n}</title></head><body>`;return i+=`<h1>${n}</h1>`,i+=`<div class="meta">Generated: ${new Date().toLocaleString()} | Location: ${B}</div>`,d.forEach((s,a)=>{i+=`<h2>${s.heading}</h2>`,s.subtitle&&(i+=`<div class="meta">${s.subtitle}</div>`),s.tables.forEach((o,l)=>{i+=`<h3>${o.name}</h3>`,(o.headers.length||o.rows.length)&&(i+="<table><thead><tr>"+o.headers.map(h=>`<th>${h}</th>`).join("")+"</tr></thead><tbody>",o.rows.forEach(h=>{i+="<tr>"+h.map(p=>`<td>${p}</td>`).join("")+"</tr>"}),i+="</tbody></table>")}),a<d.length-1&&(i+='<div class="page-break"></div>')}),i+="</body></html>",i},G=async()=>{Q(!0);try{const n=[];if(Y.currentView){const s=R();if(s.length>0){const{tabText:a}=S();n.push({heading:`Current View – ${a}`,subtitle:"Filtered tables as displayed",tables:s})}}if(Y.allTabs||Y.monthOnMonth||Y.yearOnYear||Y.productPerformance||Y.categoryPerformance||Y.soldByAnalysis||Y.paymentMethodAnalysis){const s=document.querySelectorAll('[role="tab"]'),a=document.querySelector('[role="tab"][data-state="active"]'),o={currentView:[],monthOnMonth:["monthOnMonth","month-on-month"],yearOnYear:["yearOnYear","year-on-year"],productPerformance:["productPerformance","product-performance"],categoryPerformance:["categoryPerformance","category-performance"],soldByAnalysis:["soldByAnalysis","sold-by","soldBy"],paymentMethodAnalysis:["paymentMethodAnalysis","payment-method","paymentMethod"],allTabs:[]};for(const l of s){if(!(l instanceof HTMLElement))continue;const h=l.textContent?.trim()||"",p=h.replace(/\s+/g,"-").toLowerCase(),r=l.getAttribute("data-value")||""||p||"unknown";let x=Y.allTabs;if(!x){for(const[m,f]of Object.entries(Y))if(f&&m!=="currentView"&&m!=="allTabs"&&(o[m]||[]).some(w=>r.includes(w)||w.includes(r)||p.includes(w))){x=!0;break}}if(!x)continue;l.click(),await new Promise(m=>setTimeout(m,800));const t=R();t.length>0&&n.push({heading:`Tab – ${h||r}`,subtitle:"Base metric",tables:t});const c=document.querySelector('[role="tabpanel"][data-state="active"]');if(c){const m=[];k.forEach(f=>{const N=Array.from(c.querySelectorAll("button")).find(w=>(w.textContent||"").trim()===f);N&&!m.includes(N)&&m.push(N)});for(const f of m){const N=(f.textContent||"").trim();f.click(),await new Promise(T=>setTimeout(T,400));const w=R();w.length>0&&n.push({heading:`Tab – ${h||r} (${N})`,tables:w})}}}a instanceof HTMLElement&&(a.click(),await new Promise(l=>setTimeout(l,300)))}if(n.length===0){alert("No table data found to export for PDF. Please ensure tables are loaded and visible.");return}const d=`Sales Analytics – ${B}`,u=D(d,n),i=window.open("","_blank");if(!i){alert("Popup blocked. Please allow popups to view the PDF.");return}i.document.open(),i.document.write(u),i.document.close(),setTimeout(()=>{i.focus(),i.print()},300)}catch{alert("PDF export failed. Please try again.")}finally{Q(!1)}},v=async(n,d)=>{const u=document.querySelectorAll('[role="tab"]'),i=document.querySelector('[role="tab"][data-state="active"]'),s={currentView:[],monthOnMonth:["monthOnMonth","month-on-month"],yearOnYear:["yearOnYear","year-on-year"],productPerformance:["productPerformance","product-performance"],categoryPerformance:["categoryPerformance","category-performance"],soldByAnalysis:["soldByAnalysis","sold-by","soldBy"],paymentMethodAnalysis:["paymentMethodAnalysis","payment-method","paymentMethod"],allTabs:[]};for(const a of u)if(a instanceof HTMLElement){const o=a.textContent?.trim()||"",l=o.replace(/\s+/g,"-").toLowerCase(),p=a.getAttribute("data-value")||""||l||"unknown";let $=Y.allTabs;if(!$){for(const[x,t]of Object.entries(Y))if(t&&x!=="currentView"&&x!=="allTabs"&&(s[x]||[]).some(m=>p.includes(m)||m.includes(p)||p.toLowerCase().includes(m.toLowerCase())||l.includes(m))){$=!0;break}}if(!$)continue;a.click(),await new Promise(x=>setTimeout(x,800));const r=R();if(r.length===0){await z(n,d,o||p);continue}for(const x of r){let t="";t+=`# Sales Analytics Export
`,t+=`# Tab: ${o||p}
`,t+=`# Location: ${n}
`,t+=`# Export Time: ${new Date().toLocaleString()}
`,t+=`# Table: ${x.name}

`,x.headers.length>0&&(t+=x.headers.map(P=>`"${P.replace(/"/g,'""')}"`).join(",")+`
`),x.rows.forEach(P=>{t+=P.map(F=>`"${F.replace(/"/g,'""')}"`).join(",")+`
`});const c=(o||p).replace(/[^a-zA-Z0-9\-]/g,"-"),m=x.name.replace(/[^a-zA-Z0-9\-\s]/g,"").replace(/\s+/g,"-"),f=`${c}-${m}-${n}-${d}.csv`,N=new Blob([t],{type:"text/csv;charset=utf-8;"}),w=document.createElement("a"),T=URL.createObjectURL(N);w.setAttribute("href",T),w.setAttribute("download",f),w.style.visibility="hidden",document.body.appendChild(w),w.click(),document.body.removeChild(w),await new Promise(P=>setTimeout(P,400))}await z(n,d,o||p)}i instanceof HTMLElement&&(i.click(),await new Promise(a=>setTimeout(a,300)))},y=n=>{ee(d=>({...d,[n]:!d[n]}))};return e.jsxs(dt,{open:se,onOpenChange:K,children:[E!==!1&&e.jsx(ut,{asChild:!0,children:e.jsxs(oe,{variant:b,size:A,className:We("gap-2",Z),style:{borderColor:"var(--hero-accent, rgba(255,255,255,0.3))"},children:[e.jsx(At,{className:"h-4 w-4"}),ae??"Export All Sales Data"]})}),e.jsxs(mt,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(ht,{children:[e.jsxs(pt,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5"}),"Comprehensive Sales Export"]}),e.jsxs(xt,{children:["Export all sales analytics tables and metrics for ",B,". Each metric will be exported as separate CSV files for detailed analysis."]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Ke,{className:"text-sm font-medium",children:"Export Options"}),e.jsx("div",{className:"grid grid-cols-2 gap-3 mt-2",children:Object.entries(Y).map(([n,d])=>{const u={currentView:"Current View Only",monthOnMonth:"Month-on-Month Tab",yearOnYear:"Year-on-Year Tab",productPerformance:"Product Performance Tab",categoryPerformance:"Category Performance Tab",soldByAnalysis:"Sold By Analysis Tab",paymentMethodAnalysis:"Payment Methods Tab",allTabs:"All Tabs (Comprehensive)"};return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ht,{id:n,checked:d,onCheckedChange:()=>y(n)}),e.jsx(Ke,{htmlFor:n,className:"text-sm",children:u[n]||n})]},n)})})]}),e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("h4",{className:"font-medium text-green-900 mb-2",children:"Current View"}),e.jsxs("p",{className:"text-sm text-green-700",children:["Active Tab: ",e.jsx("span",{className:"font-medium",children:(()=>{const{tabText:n}=S();return n})()}),e.jsx("br",{}),"Location: ",e.jsx("span",{className:"font-medium",children:B}),e.jsx("br",{}),"Data Source: ",e.jsx("span",{className:"font-medium",children:"Live table data as displayed in UI"})]})]}),e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Export Summary"}),e.jsxs("p",{className:"text-sm text-blue-700",children:[Y.currentView&&e.jsxs(e.Fragment,{children:["Current view will be exported as displayed.",e.jsx("br",{})]}),(Y.allTabs||Object.entries(Y).filter(([n,d])=>n!=="currentView"&&n!=="allTabs"&&d).length>0)&&e.jsxs(e.Fragment,{children:["Additional tabs will be exported by switching between them.",e.jsx("br",{})]}),"Export format: ",e.jsx("span",{className:"font-medium",children:"CSV files"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(oe,{variant:"outline",onClick:()=>K(!1),disabled:L,children:"Cancel"}),e.jsx(oe,{onClick:G,disabled:L,variant:"secondary",className:"gap-2",children:L?e.jsxs(e.Fragment,{children:[e.jsx(He,{size:"xs"}),"Building PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"h-4 w-4"}),"Export PDF"]})}),e.jsx(oe,{onClick:C,disabled:L,className:"gap-2",children:L?e.jsxs(e.Fragment,{children:[e.jsx(He,{size:"xs"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"h-4 w-4"}),"Export CSV Files"]})})]})]})]})]})},pa=({data:j,historicalData:g,dateRange:B,currentLocation:b,locationName:A})=>{const{metrics:Z}=Ft(j,g,{dateRange:B}),[ae,X]=te.useState("#3b82f6"),E=te.useRef(0),se=te.useRef("#3b82f6"),K=ft(),L=te.useRef(null),Q=te.useCallback(S=>{const I=Date.now();I-E.current>200&&S!==se.current&&(E.current=I,se.current=S,X(S))},[]);te.useEffect(()=>{const S=document.documentElement,I=S.style.getPropertyValue("--hero-accent");return ae!==I&&S.style.setProperty("--hero-accent",ae),()=>{S.style.removeProperty("--hero-accent")}},[ae]);const ee=["Transactions","Sales Revenue","Unique Members"].map(S=>Z.find(I=>I.title===S)).filter(Boolean).map(S=>({location:S.title,label:S.description,value:S.value,icon:S.icon,change:S.change,trend:S.changeDetails.trend,previousValue:S.previousValue}));return e.jsx("div",{style:{"--hero-accent":ae},children:e.jsx(kt,{title:"Sales & Revenue Analytics",subtitle:"Track all transactional and payment metrics in one place with real-time, location-aware analytics",metrics:ee.map(S=>({label:S.location,value:S.value,change:S.change!=null?`${S.change>0?"+":""}${S.change.toFixed(1)}%`:void 0})),primaryAction:{label:"View Dashboard",onClick:()=>K("/")},secondaryAction:{label:"Export All Sales Data",onClick:()=>L.current?.open()},compact:!0,onColorChange:Q,extra:e.jsx(ha,{data:j,currentLocation:b,locationName:A,renderTrigger:!1,openRef:L})})})};function ie({id:j,label:g,activate:B,children:b,className:A}){const{addSection:Z,removeSection:ae}=Xe();return M.useEffect(()=>(Z({id:j,label:g,activate:B||(()=>{}),getElement:()=>document.getElementById(j)}),()=>ae(j)),[j,g]),e.jsx("section",{id:j,className:"scroll-mt-24 "+(A??""),children:b})}const Ee=[{key:"purchaseFrequency",label:"Purchase Frequency (days)",icon:e.jsx(_e,{className:"w-4 h-4"})},{key:"avgSpend",label:"Avg Spend per Member",icon:e.jsx(Te,{className:"w-4 h-4"})},{key:"transactions",label:"Transactions",icon:e.jsx(at,{className:"w-4 h-4"})},{key:"discountedTx",label:"Discounted Transactions",icon:e.jsx(Te,{className:"w-4 h-4"})},{key:"undiscountedTx",label:"Undiscounted Transactions",icon:e.jsx(Te,{className:"w-4 h-4"})},{key:"percentDiscounted",label:"% Discounted Transactions",icon:e.jsx(Zt,{className:"w-4 h-4"})},{key:"usedSessions",label:"Used Sessions",icon:e.jsx(ge,{className:"w-4 h-4"})},{key:"avgSessionsPerMember",label:"Avg Sessions per Member",icon:e.jsx(ge,{className:"w-4 h-4"})},{key:"avgCustomerLifespan",label:"Avg Customer Lifespan (days)",icon:e.jsx(be,{className:"w-4 h-4"})},{key:"avgDaysToSecondPurchase",label:"Avg Days to Second Purchase",icon:e.jsx(_e,{className:"w-4 h-4"})}],xa=({data:j,onRowClick:g,onReady:B})=>{const[b,A]=M.useState("purchaseFrequency"),[Z,ae]=M.useState("values"),[X,E]=M.useState(new Set),se=Me(),K=v=>{if(!v)return null;const y=v.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(y){const[,d,u,i]=y;return new Date(parseInt(i),parseInt(u)-1,parseInt(d))}const n=new Date(v);return isNaN(n.getTime())?null:n},L=M.useMemo(()=>{const v=[],y=new Date,n=y.getFullYear(),d=y.getMonth(),u=new Date(2024,0,1),i=new Date(n,d,1);let s=new Date(u);for(;s<=i;){const a=s.getFullYear(),o=s.getMonth()+1;v.push({key:`${a}-${String(o).padStart(2,"0")}`,display:s.toLocaleDateString("en-US",{month:"short",year:"numeric"}),year:a,month:o}),s=new Date(a,s.getMonth()+1,1)}return v},[]),Y=(()=>{const v=new Date,y=new Date(v.getFullYear(),v.getMonth()-1,1);return`${y.getFullYear()}-${String(y.getMonth()+1).padStart(2,"0")}`})(),ee=M.useMemo(()=>{const v=new Map;return j.forEach(y=>{const n=y.cleanedCategory||"Uncategorized",d=y.cleanedProduct||"Unspecified";v.has(n)||v.set(n,new Map);const u=v.get(n);u.has(d)||u.set(d,[]),u.get(d).push(y)}),v},[j]),S=v=>{const y=new Map;return v.forEach(n=>{const d=n.memberId||n.customerEmail||"unknown";y.has(d)||y.set(d,[]),y.get(d).push(n)}),y},I=(v,y)=>{if(v.length===0)return 0;if(y==="transactions")return v.length;if(y==="discountedTx")return v.filter(d=>(d.discountAmount||0)>0).length;if(y==="undiscountedTx")return v.filter(d=>(d.discountAmount||0)<=0).length;if(y==="percentDiscounted"){const d=v.filter(u=>(u.discountAmount||0)>0).length;return v.length>0?d/v.length*100:0}if(y==="usedSessions")return v.reduce((d,u)=>d+(u.secMembershipUsedSessions||0),0);const n=S(v);if(y==="avgSpend"){const d=Array.from(n.values()).map(u=>u.reduce((i,s)=>i+(s.paymentValue||0),0));return d.length?d.reduce((u,i)=>u+i,0)/d.length:0}if(y==="avgSessionsPerMember"){const d=Array.from(n.values()).map(u=>u.reduce((i,s)=>i+(s.secMembershipUsedSessions||0),0));return d.length?d.reduce((u,i)=>u+i,0)/d.length:0}if(y==="purchaseFrequency"){const d=[];return n.forEach(u=>{const i=u.map(s=>K(s.paymentDate)).filter(s=>!!s).sort((s,a)=>s.getTime()-a.getTime());if(i.length>1){const s=(i[i.length-1].getTime()-i[0].getTime())/864e5;d.push(s/(i.length-1))}}),d.length?d.reduce((u,i)=>u+i,0)/d.length:0}if(y==="avgCustomerLifespan"){const d=[];return n.forEach(u=>{const i=u.map(s=>K(s.paymentDate)).filter(s=>!!s).sort((s,a)=>s.getTime()-a.getTime());if(i.length>0){const s=(i[i.length-1].getTime()-i[0].getTime())/864e5;d.push(s)}}),d.length?d.reduce((u,i)=>u+i,0)/d.length:0}if(y==="avgDaysToSecondPurchase"){const d=[];return n.forEach(u=>{const i=u.map(s=>K(s.paymentDate)).filter(s=>!!s).sort((s,a)=>s.getTime()-a.getTime());if(i.length>1){const s=(i[1].getTime()-i[0].getTime())/864e5;d.push(s)}}),d.length?d.reduce((u,i)=>u+i,0)/d.length:0}return 0},R=(v,y)=>y==="avgSpend"?le(v):["purchaseFrequency","avgCustomerLifespan","avgDaysToSecondPurchase"].includes(y)||y==="avgSessionsPerMember"||y==="percentDiscounted"?v.toFixed(1):ne(v),k=M.useMemo(()=>{const v=[];return ee.forEach((y,n)=>{const d=[];y.forEach((i,s)=>{const a={};L.forEach(({key:o,year:l,month:h})=>{const p=i.filter($=>{const r=K($.paymentDate);return r&&r.getFullYear()===l&&r.getMonth()+1===h});a[o]=I(p,b)}),d.push({product:s,monthlyValues:a,rawData:i,totalValue:I(i,b)})});const u={};L.forEach(({key:i,year:s,month:a})=>{const o=Array.from(y.values()).flat().filter(l=>{const h=K(l.paymentDate);return h&&h.getFullYear()===s&&h.getMonth()+1===a});u[i]=I(o,b)}),v.push({category:n,products:d.sort((i,s)=>s.totalValue-i.totalValue),monthlyValues:u})}),v.sort((y,n)=>{const d=Object.values(y.monthlyValues).reduce((i,s)=>i+s,0);return Object.values(n.monthlyValues).reduce((i,s)=>i+s,0)-d})},[ee,L,b]);te.useEffect(()=>{k.length&&B?.()},[k,B]);const V=(v,y)=>y===0?null:`${((v-y)/y*100).toFixed(1)}%`,z=M.useCallback(async()=>{let v=`Customer Purchase Behavior - All Metrics
`;v+=`Exported on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
`,v+=`
${"=".repeat(80)}

`;for(const y of Ee){const n=y.key;v+=`
${y.label.toUpperCase()}
`,v+=`${"-".repeat(y.label.length+10)}

`;const d=["Category / Product","Total"];L.forEach(s=>d.push(s.display)),v+=d.join("	")+`
`,v+=d.map(()=>"---").join("	")+`
`;const u={};j.forEach(s=>{const a=s.cleanedCategory||"Uncategorized",o=s.cleanedProduct||"Unknown";u[a]||(u[a]={}),u[a][o]||(u[a][o]=[]),u[a][o].push(s)}),Object.entries(u).map(([s,a])=>{const o=Object.entries(a).map(([h,p])=>{const $={};return L.forEach(({key:r,year:x,month:t})=>{const c=p.filter(m=>{const f=K(m.paymentDate);return f&&f.getFullYear()===x&&f.getMonth()+1===t});$[r]=I(c,n)}),{product:h,monthlyValues:$,totalValue:I(p,n)}}),l={};return L.forEach(({key:h})=>{l[h]=o.reduce((p,$)=>p+($.monthlyValues[h]||0),0)}),{category:s,products:o,monthlyValues:l,totalValue:o.reduce((h,p)=>h+p.totalValue,0)}}).forEach(s=>{const a=[s.category,C(s.totalValue,n)];L.forEach(o=>{const l=s.monthlyValues[o.key]||0;a.push(C(l,n))}),v+=a.join("	")+`
`,s.products.forEach(o=>{const l=[`  ${o.product}`,C(o.totalValue,n)];L.forEach(h=>{const p=o.monthlyValues[h.key]||0;l.push(C(p,n))}),v+=l.join("	")+`
`})}),v+=`
`}return v},[j,L]),C=(v,y)=>y==="avgSpend"?le(v):y==="percentDiscounted"?`${v.toFixed(1)}%`:y.includes("Frequency")||y.includes("Lifespan")||y.includes("Days")?`${v.toFixed(1)} days`:ne(v),D=[{header:"Category",key:"category",type:"text"},{header:"Product",key:"product",type:"text"},{header:"Month",key:"month",type:"text"},{header:"Value",key:"value",type:"number"}],G=M.useMemo(()=>{const v=[];return k.forEach(y=>{y.products.forEach(n=>{Object.entries(n.monthlyValues).forEach(([d,u])=>{v.push({category:y.category,product:n.product,month:d,value:u})})})}),v},[k]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx(we,{metrics:Ee,selectedMetric:b,onMetricChange:A}),e.jsx(je,{title:"Customer Purchase Behavior (All Dates)",description:"Month-on-month behavior metrics by category and product (ignores date filters)",icon:e.jsx(Te,{className:"w-5 h-5 text-white"}),showCollapseControls:!0,onCollapseAll:()=>{const v=new Set;k.forEach(y=>v.add(y.category)),E(v)},onExpandAll:()=>E(new Set),showDisplayToggle:!0,displayMode:Z,onDisplayModeChange:ae,onCopyAllTabs:z,contextInfo:{selectedMetric:b,dateRange:se.dateRange,filters:se.filters,additionalInfo:{displayMode:Z,behaviorMetric:b,collapsedCategories:Array.from(X)}},children:e.jsx("div",{className:"overflow-x-auto","data-table":"customer-behavior-analysis",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{className:"sticky top-0 z-30",children:e.jsxs("tr",{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:[e.jsx("th",{className:"w-[30rem] px-6 py-3 text-left text-white font-bold text-sm uppercase tracking-wide sticky left-0 bg-gradient-to-r from-slate-800 to-slate-900 z-40 border-r border-white/20",children:"Category / Product"}),L.map(({key:v,display:y})=>{const n=v===Y;return e.jsx("th",{className:`px-3 py-3 text-center font-bold text-xs uppercase tracking-wider border-l border-white/20 min-w-[90px] ${n?"bg-blue-800 text-white":"text-white"}`,children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[n&&e.jsx(ve,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-bold whitespace-nowrap",children:y.split(" ")[0]})]}),e.jsx("span",{className:"text-slate-300 text-xs",children:y.split(" ")[1]})]})},v)})]})}),e.jsxs("tbody",{children:[k.map(v=>e.jsxs(te.Fragment,{children:[e.jsxs("tr",{className:"bg-slate-100 border-b border-slate-300 font-semibold h-9 max-h-9",children:[e.jsx("td",{className:"w-[30rem] px-6 py-3 text-left sticky left-0 bg-gradient-to-r from-slate-100 via-blue-50 to-indigo-50 border-r border-slate-300 z-20 cursor-pointer hover:underline whitespace-nowrap overflow-hidden text-ellipsis",onClick:()=>g?.({category:v.category,name:v.category,filterCriteria:{category:v.category},drillDownContext:{source:"customerBehavior",level:"category",metric:b,category:v.category}}),title:`View all transactions for ${v.category}`,children:e.jsx("span",{className:"text-slate-800 font-bold",children:v.category})}),L.map(({key:y},n)=>{const d=v.monthlyValues[y]||0,u=L[n+1]?.key,i=u&&v.monthlyValues[u]||0,s=u?V(d,i):null;return e.jsx("td",{className:"px-2 py-3 text-center text-sm font-bold text-slate-800 border-l border-slate-300 cursor-pointer hover:bg-blue-100/60 whitespace-nowrap",onClick:()=>g?.({category:v.category,name:v.category,filterCriteria:{month:y,category:v.category},drillDownContext:{source:"customerBehavior",level:"category",metric:b,category:v.category,month:y}}),title:`View ${v.category} transactions for ${y}`,children:Z==="values"?R(d,b):e.jsx("span",{className:s?parseFloat(s)>0?"text-emerald-600":"text-red-500":"",children:s??"—"})},y)})]}),!X.has(v.category)&&v.products.map(y=>e.jsxs("tr",{className:"bg-white hover:bg-blue-50 border-b border-gray-200 transition-all h-9 max-h-9",children:[e.jsx("td",{className:"w-[30rem] px-10 py-3 text-left sticky left-0 bg-white border-r border-gray-200 z-10 cursor-pointer hover:underline whitespace-nowrap overflow-hidden text-ellipsis",onClick:()=>g?.({product:y.product,name:y.product,filterCriteria:{product:y.product},drillDownContext:{source:"customerBehavior",level:"product",metric:b,category:v.category,product:y.product}}),title:`View all transactions for ${y.product}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-slate-400 text-xs",children:"→"}),e.jsx("span",{className:"text-slate-700 font-medium text-xs",children:y.product})]})}),L.map(({key:n},d)=>{const u=y.monthlyValues[n]||0,i=L[d+1]?.key,s=i&&y.monthlyValues[i]||0,a=i?V(u,s):null;return e.jsx("td",{className:"px-2 py-3 text-center text-sm font-mono text-slate-700 border-l border-gray-200 cursor-pointer hover:bg-blue-100/60 whitespace-nowrap",onClick:()=>g?.({product:y.product,name:y.product,filterCriteria:{month:n,product:y.product},drillDownContext:{source:"customerBehavior",level:"product",metric:b,category:v.category,product:y.product,month:n}}),title:`View ${y.product} transactions for ${n}`,children:Z==="values"?R(u,b):e.jsx("span",{className:a?parseFloat(a)>0?"text-emerald-600":"text-red-500":"",children:a??"—"})},n)})]},`${v.category}-${y.product}`))]},v.category)),e.jsxs("tr",{className:"bg-slate-800 text-white font-bold border-t-2 border-slate-400 h-9 max-h-9",children:[e.jsx("td",{className:"w-[30rem] px-6 py-3 text-left sticky left-0 bg-slate-800 border-r border-slate-400 z-20 cursor-pointer hover:underline whitespace-nowrap",onClick:()=>g?.({name:"TOTALS",filterCriteria:{},drillDownContext:{source:"customerBehavior",level:"total",metric:b}}),title:"View all transactions across all months",children:"TOTALS"}),L.map(({key:v,year:y,month:n},d)=>{const u=j.filter(o=>{const l=K(o.paymentDate);return l&&l.getFullYear()===y&&l.getMonth()+1===n}),i=I(u,b),s=L[d+1];let a=null;if(s){const o=j.filter(h=>{const p=K(h.paymentDate);return p&&p.getFullYear()===s.year&&p.getMonth()+1===s.month}),l=I(o,b);a=V(i,l)}return e.jsx("td",{className:"px-2 py-3 text-center text-sm font-bold text-white border-l border-slate-400 cursor-pointer hover:bg-slate-700/60 whitespace-nowrap",onClick:()=>g?.({name:"TOTALS",filterCriteria:{month:v},drillDownContext:{source:"customerBehavior",level:"total",metric:b,month:v}}),title:`View all transactions for ${v}`,children:Z==="values"?R(i,b):e.jsx("span",{className:a?parseFloat(a)>0?"text-emerald-300":"text-red-300":"",children:a??"—"})},v)})]})]})]})})}),e.jsx(Ne,{tableId:"customer-behavior-mom",initialText:"• Behavior insights across all dates (location context may still apply)\\n• Metrics include purchase frequency, spends, sessions usage, and discount patterns\\n• Use the export for AI-driven summaries and trends",tableName:"Customer Behavior (MoM)",tableContext:`Behavior metric: ${Ee.find(v=>v.key===b)?.label}`,tableData:G,tableColumns:D})]})},ye=[{id:"all",name:"All Locations, ",fullName:"All Studio Locations"},{id:"kwality",name:"Kwality House, Kemps Corner",fullName:"Kwality House, Kemps Corner"},{id:"supreme",name:"Supreme HQ, Bandra",fullName:"Supreme HQ, Bandra"},{id:"kenkere",name:"Kenkere House, Bengaluru",fullName:"Kenkere House, Bengaluru"},{id:"popup",name:"Pop-up",fullName:"Pop-up"}],fa=({data:j,onReady:g})=>{const{filters:B}=yt();B?.dateRange&&`${B.dateRange.start}${B.dateRange.end}`;const[b,A]=M.useState("kwality"),[Z,ae]=M.useState("classic"),[X,E]=M.useState(!1),[se,K]=M.useState(null),[L,Q]=M.useState("metric"),[Y,ee]=M.useState(new Set),[S,I]=M.useState("revenue");te.useEffect(()=>{const a=document.documentElement;a.style.getPropertyValue("--hero-accent")||getComputedStyle(a).getPropertyValue("--hero-accent")},[b]);const[R,k]=M.useState(!1),V=te.useCallback(()=>k(!0),[]),{addSection:z,removeSection:C}=Xe();te.useEffect(()=>{R&&g?.()},[R,g]);const[D,G]=M.useState(()=>({dateRange:Oe(),location:[],category:[],product:[],soldBy:[],paymentMethod:[]})),v=(a,o=!1)=>{let l=[...a];if(b!=="all"&&(l=l.filter(h=>{const p=(h.calculatedLocation||"").toString().toLowerCase();return b==="kwality"?p.includes("kwality")||p.includes("kemps"):b==="supreme"?p.includes("supreme")||p.includes("bandra"):b==="kenkere"?p.includes("kenkere")||p.includes("bengaluru"):b==="popup"?p.includes("pop")||p.includes("popup")||p.includes("pop-up"):!1})),!o&&(D.dateRange.start||D.dateRange.end)){const h=D.dateRange.start?new Date(D.dateRange.start):null,p=D.dateRange.end?(()=>{const $=new Date(D.dateRange.end);return $.setHours(23,59,59,999),$})():null;l=l.filter($=>{if(!$.paymentDate)return!1;let r=null;const x=$.paymentDate.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(x){const[,t,c,m]=x;r=new Date(parseInt(m),parseInt(c)-1,parseInt(t))}else{const t=[new Date($.paymentDate),new Date($.paymentDate.replace(/(\d{2})\/(\d{2})\/(\d{4})/,"$3-$2-$1")),new Date($.paymentDate.replace(/(\d{2})\/(\d{2})\/(\d{4})/,"$2/$1/$3"))];for(const c of t)if(!isNaN(c.getTime())&&c.getFullYear()>1900&&c.getFullYear()<2100){r=c;break}}return!(!r||isNaN(r.getTime())||h&&r<h||p&&r>p)})}return D.category?.length&&(l=l.filter(h=>D.category.some(p=>h.cleanedCategory?.toLowerCase().includes(p.toLowerCase())))),D.paymentMethod?.length&&(l=l.filter(h=>D.paymentMethod.some(p=>h.paymentMethod?.toLowerCase().includes(p.toLowerCase())))),D.soldBy?.length&&(l=l.filter(h=>D.soldBy.some(p=>h.soldBy?.toLowerCase().includes(p.toLowerCase())))),D.minAmount&&(l=l.filter(h=>(h.paymentValue||0)>=D.minAmount)),D.maxAmount&&(l=l.filter(h=>(h.paymentValue||0)<=D.maxAmount)),l},y=M.useMemo(()=>v(j),[j,D,b]),n=M.useMemo(()=>v(j,!0),[j,b]),d=M.useMemo(()=>{let a=[...j];return b!=="all"&&(a=a.filter(o=>{const l=(o.calculatedLocation||"").toString().toLowerCase();return b==="kwality"?l.includes("kwality")||l.includes("kemps"):b==="supreme"?l.includes("supreme")||l.includes("bandra"):b==="kenkere"?l.includes("kenkere")||l.includes("bengaluru"):b==="popup"?l.includes("pop")||l.includes("popup")||l.includes("pop-up"):!1})),a},[j,b]),u=M.useCallback(a=>{let o=j;b!=="all"&&(o=j.filter(t=>{const c=(t.calculatedLocation||"").toString().toLowerCase();return b==="kwality"?c.includes("kwality")||c.includes("kemps"):b==="supreme"?c.includes("supreme")||c.includes("bandra"):b==="kenkere"?c.includes("kenkere")||c.includes("bengaluru"):b==="popup"?c.includes("pop")||c.includes("popup")||c.includes("pop-up"):!1}));let l=o,h="product";if(a.filterCriteria&&a.drillDownContext){const t=a.filterCriteria;t.month&&t.product?(l=o.filter(c=>{if(!c.paymentDate)return!1;const m=new Date(c.paymentDate),f=m.getFullYear(),N=m.getMonth()+1,w=`${f}-${String(N).padStart(2,"0")}`,T=c.cleanedProduct?.toLowerCase()===t.product?.toLowerCase()||c.paymentItem?.toLowerCase()===t.product?.toLowerCase()||c.paymentItem?.toLowerCase().includes(t.product?.toLowerCase()||""),P=w===t.month;return T&&P}),l.length>0&&l.reduce((c,m)=>c+(m.paymentValue||0),0),h="product"):t.month&&t.category?(l=o.filter(c=>{if(!c.paymentDate)return!1;const m=new Date(c.paymentDate),f=m.getFullYear(),N=m.getMonth()+1,w=`${f}-${String(N).padStart(2,"0")}`,T=c.cleanedCategory?.toLowerCase()===t.category?.toLowerCase(),P=w===t.month;return T&&P}),h="category"):t.month&&t.soldBy?(l=o.filter(c=>{if(!c.paymentDate)return!1;const m=new Date(c.paymentDate),f=m.getFullYear(),N=m.getMonth()+1,w=`${f}-${String(N).padStart(2,"0")}`,T=c.soldBy?.toLowerCase()===t.soldBy?.toLowerCase(),P=w===t.month;return T&&P}),h="soldBy"):t.month&&t.paymentMethod?(l=o.filter(c=>{if(!c.paymentDate)return!1;const m=new Date(c.paymentDate),f=m.getFullYear(),N=m.getMonth()+1,w=`${f}-${String(N).padStart(2,"0")}`,T=c.paymentMethod?.toLowerCase()===t.paymentMethod?.toLowerCase(),P=w===t.month;return T&&P}),h="paymentMethod"):t.month?l=o.filter(c=>{if(!c.paymentDate)return!1;const m=new Date(c.paymentDate),f=m.getFullYear(),N=m.getMonth()+1;return`${f}-${String(N).padStart(2,"0")}`===t.month}):t.product?(l=o.filter(c=>c.cleanedProduct?.toLowerCase()===t.product?.toLowerCase()||c.paymentItem?.toLowerCase()===t.product?.toLowerCase()),h="product"):t.category?(l=o.filter(c=>c.cleanedCategory?.toLowerCase()===t.category?.toLowerCase()),h="category"):t.soldBy?(l=o.filter(c=>c.soldBy?.toLowerCase()===t.soldBy?.toLowerCase()),h="soldBy"):t.paymentMethod&&(l=o.filter(c=>c.paymentMethod?.toLowerCase()===t.paymentMethod?.toLowerCase()),h="paymentMethod")}else a.rawData&&Array.isArray(a.rawData)&&a.rawData.length>0?l=a.rawData:Array.isArray(a)&&a.length>0?l=a:a.transactionData&&Array.isArray(a.transactionData)&&a.transactionData.length>0?l=a.transactionData:a.currentYearRawData&&a.lastYearRawData?l=[...a.currentYearRawData,...a.lastYearRawData]:l=y.filter(t=>{let c=!1;const m=[a.name,a.product,a.productName,a.paymentItem,a.cleanedProduct,a.membership,a.membershipType,a.item].filter(Boolean),f=[a.category,a.cleanedCategory,a.paymentCategory].filter(Boolean);for(const N of m)if(t.cleanedProduct===N||t.paymentItem===N||t.membershipType===N||t.paymentItem&&t.paymentItem.includes(N)||t.cleanedProduct&&t.cleanedProduct.includes(N)){c=!0;break}if(!c){for(const N of f)if(t.cleanedCategory===N||t.paymentCategory===N||t.cleanedCategory&&t.cleanedCategory.includes(N)){c=!0,h="category";break}}return a.soldBy&&t.soldBy===a.soldBy&&(c=!0,h="member"),a.paymentMethod&&t.paymentMethod===a.paymentMethod&&(c=!0,h="product"),c});if(l.length===0)if(a.product||a.name){const t=a.product||a.name;l=y.filter(c=>c.cleanedProduct?.includes(t)||c.paymentItem?.includes(t)||c.cleanedProduct===t||c.paymentItem===t)}else a.category?l=y.filter(t=>t.cleanedCategory?.includes(a.category)||t.cleanedCategory===a.category):l=y.slice(0,100);const p=l.reduce((t,c)=>t+(c.paymentValue||0),0),$=l.length,r=new Set(l.map(t=>t.memberId||t.customerEmail)).size,x={...a,rawData:l,filteredTransactionData:l,transactionData:l,totalRevenue:p,grossRevenue:p,netRevenue:p,totalValue:p,totalCurrent:p,metricValue:p,revenue:p,transactions:$,totalTransactions:$,transactionCount:$,uniqueMembers:r,totalCustomers:r,customerCount:r,specificRevenue:p,specificTransactions:$,specificCustomers:r,specificProducts:new Set(l.map(t=>t.cleanedProduct||t.paymentItem)).size,isDynamic:!0,calculatedFromFiltered:!0,useCalculatedMetrics:!0,clickedItemName:a.product||a.name||a.category||"Selected Item",contextDescription:a.filterCriteria?`Showing data for ${Object.entries(a.filterCriteria).map(([t,c])=>`${t}: ${c}`).join(", ")}`:`Showing transactions for ${a.product||a.name||a.category||"selected item"}`};K(x),Q(h)},[j,b,y]),i=M.useCallback(a=>{let o=y;if(a.metricType)switch(a.metricType){case"sales-revenue":case"total-revenue":o=y.filter(r=>(r.paymentValue||0)>0);break;case"units-sold":case"total-transactions":o=y;break;case"unique-members":new Set(y.map(r=>r.memberId||r.customerEmail)),o=y.filter(r=>r.memberId||r.customerEmail);break;case"avg-transaction-value":case"avg-spend-per-member":o=y.filter(r=>(r.paymentValue||0)>0&&(r.memberId||r.customerEmail));break;default:o=y}const l=o.reduce((r,x)=>r+(x.paymentValue||0),0),h=o.length,p=new Set(o.map(r=>r.memberId||r.customerEmail)).size,$={...a,rawData:o,filteredTransactionData:o,totalRevenue:l,grossRevenue:l,netRevenue:l,totalValue:l,totalCurrent:l,metricValue:l,transactions:h,totalTransactions:h,uniqueMembers:p,totalCustomers:p,specificRevenue:l,specificTransactions:h,specificCustomers:p,focusMetric:a.title,metricContext:a.metricType,isDynamic:!0,calculatedFromFiltered:!0,isMetricSpecific:!0};K($),Q("metric")},[y]);M.useCallback(a=>{const o=new Set(Y);o.has(a)?o.delete(a):o.add(a),ee(o)},[Y]);const s=M.useCallback(()=>{const a=Oe();G({dateRange:a,location:[],category:[],product:[],soldBy:[],paymentMethod:[]})},[]);return M.useMemo(()=>{const a={all:0,kwality:0,supreme:0,kenkere:0};return y.forEach(o=>{a.all++;const l=(o.calculatedLocation||"").toString().toLowerCase();l.includes("kwality")?a.kwality++:l.includes("supreme")?a.supreme++:(l.includes("kenkere")||l.includes("bengaluru"))&&a.kenkere++}),a},[y]),e.jsxs("div",{className:"space-y-8",children:[e.jsx(ie,{id:"sales-overview",label:"Overview",children:e.jsx(pa,{data:y,historicalData:d,dateRange:D.dateRange,currentLocation:b,locationName:ye.find(a=>a.id===b)?.fullName||"All Locations"})}),e.jsx(_t,{position:"right",title:"Sales sections"}),e.jsxs("div",{className:"container mx-auto px-6 space-y-6",children:[e.jsx(Jt,{activeLocation:b,onLocationChange:A,showInfoPopover:!0,infoPopoverContext:"sales-overview"}),e.jsxs("div",{className:"space-y-8",children:[e.jsx(ie,{id:"sales-filters",label:"Filters",className:"w-full space-y-4",children:e.jsx(vt,{filters:D,onFiltersChange:G,onReset:s})}),e.jsx(ie,{id:"sales-metrics",label:"Metrics",children:e.jsx(Rt,{data:y,historicalData:d,dateRange:D.dateRange,onMetricClick:i,locationId:b})}),e.jsx(ie,{id:"sales-charts",label:"Charts",children:e.jsx(lt,{data:n})}),e.jsxs(ie,{id:"sales-sellers",label:"Top & Bottom Sellers",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Top & Bottom Sellers"})}),e.jsx(ea,{data:y})]}),e.jsxs(et,{defaultValue:"monthOnMonth",className:"w-full",children:[e.jsxs(tt,{className:"bg-white/95 backdrop-blur-sm p-1.5 rounded-2xl shadow-2xl border-2 border-slate-200 flex w-full max-w-7xl mx-auto overflow-visible relative",children:[e.jsxs(de,{value:"monthOnMonth",className:"relative flex-1 flex items-center justify-center gap-2 px-3 py-3 font-semibold text-xs md:text-sm min-h-[52px] transition-all duration-300 data-[state=active]:bg-gradient-to-br data-[state=active]:from-blue-600 data-[state=active]:via-blue-700 data-[state=active]:to-blue-800 data-[state=active]:text-white data-[state=active]:shadow-2xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-50 hover:bg-gray-50 border-r border-slate-200 last:border-r-0 data-[state=active]:scale-[1.02] data-[state=active]:rounded-xl data-[state=active]:-translate-y-1",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{className:"whitespace-nowrap",children:"Month on Month"})]}),e.jsxs(de,{value:"yearOnYear",className:"relative flex-1 flex items-center justify-center gap-2 px-3 py-3 font-semibold text-xs md:text-sm min-h-[52px] transition-all duration-300 data-[state=active]:bg-gradient-to-br data-[state=active]:from-emerald-600 data-[state=active]:via-emerald-700 data-[state=active]:to-emerald-800 data-[state=active]:text-white data-[state=active]:shadow-2xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-50 hover:bg-gray-50 border-r border-slate-200 last:border-r-0 data-[state=active]:scale-[1.02] data-[state=active]:rounded-xl data-[state=active]:-translate-y-1",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsx("span",{className:"whitespace-nowrap",children:"Year on Year"})]}),e.jsxs(de,{value:"productPerformance",className:"relative flex-1 flex items-center justify-center gap-2 px-3 py-3 font-semibold text-xs md:text-sm min-h-[52px] transition-all duration-300 data-[state=active]:bg-gradient-to-br data-[state=active]:from-purple-600 data-[state=active]:via-purple-700 data-[state=active]:to-purple-800 data-[state=active]:text-white data-[state=active]:shadow-2xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-50 hover:bg-gray-50 border-r border-slate-200 last:border-r-0 data-[state=active]:scale-[1.02] data-[state=active]:rounded-xl data-[state=active]:-translate-y-1",children:[e.jsx(at,{className:"w-4 h-4"}),e.jsx("span",{className:"whitespace-nowrap",children:"Products"})]}),e.jsxs(de,{value:"categoryPerformance",className:"relative flex-1 flex items-center justify-center gap-2 px-3 py-3 font-semibold text-xs md:text-sm min-h-[52px] transition-all duration-300 data-[state=active]:bg-gradient-to-br data-[state=active]:from-orange-600 data-[state=active]:via-orange-700 data-[state=active]:to-orange-800 data-[state=active]:text-white data-[state=active]:shadow-2xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-50 hover:bg-gray-50 border-r border-slate-200 last:border-r-0 data-[state=active]:scale-[1.02] data-[state=active]:rounded-xl data-[state=active]:-translate-y-1",children:[e.jsx(ot,{className:"w-4 h-4"}),e.jsx("span",{className:"whitespace-nowrap",children:"Categories"})]}),e.jsxs(de,{value:"soldByAnalysis",className:"relative flex-1 flex items-center justify-center gap-2 px-3 py-3 font-semibold text-xs md:text-sm min-h-[52px] transition-all duration-300 data-[state=active]:bg-gradient-to-br data-[state=active]:from-indigo-600 data-[state=active]:via-indigo-700 data-[state=active]:to-indigo-800 data-[state=active]:text-white data-[state=active]:shadow-2xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-50 hover:bg-gray-50 border-r border-slate-200 last:border-r-0 data-[state=active]:scale-[1.02] data-[state=active]:rounded-xl data-[state=active]:-translate-y-1",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"whitespace-nowrap",children:"Sales Team"})]}),e.jsxs(de,{value:"paymentMethodAnalysis",className:"relative flex-1 flex items-center justify-center gap-2 px-3 py-3 font-semibold text-xs md:text-sm min-h-[52px] transition-all duration-300 data-[state=active]:bg-gradient-to-br data-[state=active]:from-teal-600 data-[state=active]:via-teal-700 data-[state=active]:to-teal-800 data-[state=active]:text-white data-[state=active]:shadow-2xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-50 hover:bg-gray-50 border-r border-slate-200 last:border-r-0 data-[state=active]:scale-[1.02] data-[state=active]:rounded-xl data-[state=active]:-translate-y-1",children:[e.jsx(Be,{className:"w-4 h-4"}),e.jsx("span",{className:"whitespace-nowrap",children:"Payments"})]}),e.jsxs(de,{value:"customerBehavior",className:"relative flex-1 flex items-center justify-center gap-2 px-3 py-3 font-semibold text-xs md:text-sm min-h-[52px] transition-all duration-300 data-[state=active]:bg-gradient-to-br data-[state=active]:from-pink-600 data-[state=active]:via-pink-700 data-[state=active]:to-pink-800 data-[state=active]:text-white data-[state=active]:shadow-2xl data-[state=active]:border-2 data-[state=active]:border-white data-[state=active]:z-50 hover:bg-gray-50 border-r border-slate-200 last:border-r-0 data-[state=active]:scale-[1.02] data-[state=active]:rounded-xl data-[state=active]:-translate-y-1",children:[e.jsx(Le,{className:"w-4 h-4"}),e.jsx("span",{className:"whitespace-nowrap",children:"Behavior"})]})]}),e.jsx(xe,{value:"monthOnMonth",className:"mt-8",children:e.jsxs(ie,{id:"sales-mom",label:"Month-on-Month",activate:()=>{document.querySelector("[role='tab'][data-state='active'][data-value='monthOnMonth']")||Array.from(document.querySelectorAll("[role='tab']")).find(l=>l.getAttribute("data-value")==="monthOnMonth")?.click()},className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Month-on-Month Analysis"})}),e.jsx(na,{data:n,onRowClick:u,collapsedGroups:Y,onGroupToggle:te.useCallback(a=>ee(new Set(a)),[]),selectedMetric:S,onReady:V,contextInfo:{selectedMetric:S,dateRange:D.dateRange,location:ye.find(a=>a.id===b)?.fullName||"All Locations",filters:{location:[b],category:D.category,product:D.product,soldBy:D.soldBy,paymentMethod:D.paymentMethod}}})]})}),e.jsx(xe,{value:"yearOnYear",className:"mt-8",children:e.jsxs(ie,{id:"sales-yoy",label:"Year-on-Year",activate:()=>{document.querySelector("[role='tab'][data-state='active'][data-value='yearOnYear']")||Array.from(document.querySelectorAll("[role='tab']")).find(l=>l.getAttribute("data-value")==="yearOnYear")?.click()},className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Year-on-Year Analysis"})}),e.jsx(aa,{data:n,onRowClick:u,selectedMetric:S,onReady:V,contextInfo:{selectedMetric:S,dateRange:D.dateRange,location:ye.find(a=>a.id===b)?.fullName||"All Locations",filters:{location:[b],category:D.category,product:D.product,soldBy:D.soldBy,paymentMethod:D.paymentMethod}}})]})}),e.jsx(xe,{value:"productPerformance",className:"mt-8",children:e.jsxs(ie,{id:"sales-product",label:"Products",activate:()=>{Array.from(document.querySelectorAll("[role='tab']")).find(o=>o.getAttribute("data-value")==="productPerformance")?.click()},className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Product & Category Metrics"})}),e.jsx(Et,{data:y,filters:D,onReady:V})]})}),e.jsx(xe,{value:"categoryPerformance",className:"mt-8",children:e.jsxs(ie,{id:"sales-category",label:"Categories",activate:()=>{Array.from(document.querySelectorAll("[role='tab']")).find(o=>o.getAttribute("data-value")==="categoryPerformance")?.click()},className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Category Performance Analysis"})}),e.jsx(oa,{data:n,onRowClick:u,selectedMetric:S,onReady:V,contextInfo:{selectedMetric:S,dateRange:D.dateRange,location:ye.find(a=>a.id===b)?.fullName||"All Locations",filters:{location:[b],category:D.category,product:D.product,soldBy:D.soldBy,paymentMethod:D.paymentMethod}}})]})}),e.jsx(xe,{value:"soldByAnalysis",className:"mt-8",children:e.jsxs(ie,{id:"sales-soldby",label:"Sold By",activate:()=>{Array.from(document.querySelectorAll("[role='tab']")).find(o=>o.getAttribute("data-value")==="soldByAnalysis")?.click()},className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Sold By Analysis"})}),e.jsx(ia,{data:n,onRowClick:u,selectedMetric:S,onReady:V,contextInfo:{selectedMetric:S,dateRange:D.dateRange,location:ye.find(a=>a.id===b)?.fullName||"All Locations",filters:{location:[b],category:D.category,product:D.product,soldBy:D.soldBy,paymentMethod:D.paymentMethod}}})]})}),e.jsx(xe,{value:"paymentMethodAnalysis",className:"mt-8",children:e.jsxs(ie,{id:"sales-payment",label:"Payment Methods",activate:()=>{Array.from(document.querySelectorAll("[role='tab']")).find(o=>o.getAttribute("data-value")==="paymentMethodAnalysis")?.click()},className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Payment Method Analysis"})}),e.jsx(ua,{data:n,onRowClick:u,selectedMetric:S,onReady:V,contextInfo:{selectedMetric:S,dateRange:D.dateRange,location:ye.find(a=>a.id===b)?.fullName||"All Locations",filters:{location:[b],category:D.category,product:D.product,soldBy:D.soldBy,paymentMethod:D.paymentMethod}}})]})}),e.jsx(xe,{value:"customerBehavior",className:"space-y-6",children:e.jsxs(ie,{id:"sales-customer",label:"Customer Behavior",activate:()=>{Array.from(document.querySelectorAll("[role='tab']")).find(o=>o.getAttribute("data-value")==="customerBehavior")?.click()},children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Customer Behavior"})}),e.jsx(xa,{data:n,onReady:V,onRowClick:u,contextInfo:{selectedMetric:S,dateRange:D.dateRange,location:ye.find(a=>a.id===b)?.fullName||"All Locations",filters:{location:[b],category:D.category,product:D.product,soldBy:D.soldBy,paymentMethod:D.paymentMethod}}})]})})]})]})]}),e.jsx(Pt,{children:se&&e.jsx(It,{isOpen:!!se,onClose:()=>K(null),data:se,type:L})})]})},gs=()=>{const{data:j,loading:g,error:B,refetch:b}=Wt(),{setLoading:A}=gt(),Z=te.useCallback(()=>{A(!1)},[A]);return M.useEffect(()=>{A(g,"Loading sales analytics data...")},[g,A]),e.jsx(bt,{children:e.jsxs("div",{className:"min-h-screen bg-white relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute top-20 left-10 w-96 h-96 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-full floating-animation stagger-1"}),e.jsx("div",{className:"absolute bottom-20 right-10 w-80 h-80 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-full floating-animation stagger-3"}),e.jsx("div",{className:"absolute top-1/2 left-1/3 w-72 h-72 bg-gradient-to-r from-cyan-500/10 to-teal-500/10 rounded-full morph-shape stagger-2"})]}),e.jsx("div",{className:"relative z-10",children:g?e.jsx("div",{className:"container mx-auto px-6 py-10",children:e.jsx(Xt,{type:"full-page"})}):B?e.jsx("div",{className:"container mx-auto px-6 py-10",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 p-6 rounded-2xl shadow-sm",children:[e.jsx("div",{className:"font-semibold text-lg mb-1",children:"Failed to load sales data"}),e.jsx("div",{className:"text-sm opacity-90 mb-4",children:String(B)}),e.jsx("button",{onClick:b,className:"px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 transition",children:"Retry"})]})}):e.jsx("div",{className:"bg-white text-slate-800 slide-in-from-left",children:e.jsx(fa,{data:j,onReady:Z})})}),e.jsx(Qt,{})]})})};export{gs as default};
//# sourceMappingURL=SalesAnalytics-DsF2rMef.js.map
