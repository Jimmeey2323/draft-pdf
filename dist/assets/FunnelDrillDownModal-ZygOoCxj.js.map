{"version":3,"file":"FunnelDrillDownModal-ZygOoCxj.js","sources":["../../src/components/dashboard/FunnelDrillDownModal.tsx"],"sourcesContent":["import React from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Badge } from '@/components/ui/badge';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { X, Users, TrendingUp, Calendar, Award, Target, Clock, UserCheck, AlertTriangle, MapPin, Phone } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { formatCurrency, formatNumber } from '@/utils/formatters';\nimport { ModernDataTable } from '@/components/ui/ModernDataTable';\nimport { LeadsData } from '@/types/leads';\n\ninterface FunnelDrillDownModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  title: string;\n  data: LeadsData[];\n  type: string;\n}\n\nexport const FunnelDrillDownModal: React.FC<FunnelDrillDownModalProps> = ({\n  isOpen,\n  onClose,\n  title,\n  data,\n  type\n}) => {\n  const columns = [\n    {\n      key: 'fullName',\n      header: 'Name',\n      className: 'min-w-[150px]',\n      render: (value: string, row: LeadsData) => (\n        <div className=\"font-medium text-gray-900\">\n          <div className=\"text-sm font-semibold\">{value}</div>\n          <div className=\"text-xs text-gray-500 flex items-center gap-1\">\n            <Phone className=\"w-3 h-3\" />\n            {row.phone}\n          </div>\n        </div>\n      )\n    },\n    {\n      key: 'email',\n      header: 'Email',\n      className: 'min-w-[200px]',\n      render: (value: string) => (\n        <div className=\"text-sm text-gray-600 truncate\" title={value}>\n          {value}\n        </div>\n      )\n    },\n    {\n      key: 'source',\n      header: 'Source',\n      align: 'center' as const,\n      render: (value: string) => (\n        <Badge variant=\"outline\" className=\"text-blue-600 border-blue-200 bg-blue-50\">\n          {value || 'Unknown'}\n        </Badge>\n      )\n    },\n    {\n      key: 'stage',\n      header: 'Stage',\n      align: 'center' as const,\n      render: (value: string) => (\n        <Badge \n          variant=\"outline\"\n          className={`${\n            value?.includes('Trial') \n              ? 'text-purple-600 border-purple-200 bg-purple-50' \n              : value?.includes('Proximity')\n              ? 'text-red-600 border-red-200 bg-red-50'\n              : 'text-gray-600 border-gray-200 bg-gray-50'\n          }`}\n        >\n          {value || 'Unknown'}\n        </Badge>\n      )\n    },\n    {\n      key: 'conversionStatus',\n      header: 'Conversion',\n      align: 'center' as const,\n      render: (value: string) => (\n        <Badge \n          variant={value?.toLowerCase().includes('converted') ? 'default' : 'secondary'}\n          className={value?.toLowerCase().includes('converted') ? 'bg-green-100 text-green-800' : ''}\n        >\n          {value || 'Pending'}\n        </Badge>\n      )\n    },\n    {\n      key: 'ltv',\n      header: 'LTV',\n      align: 'right' as const,\n      render: (value: number) => (\n        <span className=\"font-semibold text-emerald-600\">\n          {formatCurrency(value || 0)}\n        </span>\n      )\n    },\n    {\n      key: 'visits',\n      header: 'Visits',\n      align: 'center' as const,\n      render: (value: number) => (\n        <div className=\"text-sm font-medium text-gray-700\">\n          {formatNumber(value || 0)}\n        </div>\n      )\n    },\n    {\n      key: 'center',\n      header: 'Location',\n      className: 'min-w-[150px]',\n      render: (value: string) => (\n        <div className=\"text-sm text-gray-600 truncate flex items-center gap-1\" title={value}>\n          <MapPin className=\"w-3 h-3 text-gray-400\" />\n          {value || 'Unknown'}\n        </div>\n      )\n    }\n  ];\n\n  // Calculate summary metrics\n  const summary = React.useMemo(() => {\n    const totalLeads = data.length;\n    const trialsCompleted = data.filter(d => d.stage === 'Trial Completed').length;\n    const trialsScheduled = data.filter(d => d.stage?.includes('Trial')).length;\n    const convertedLeads = data.filter(d => d.conversionStatus === 'Converted').length;\n    const proximityIssues = data.filter(d => d.stage?.includes('Proximity') || d.remarks?.toLowerCase().includes('proximity')).length;\n    const totalLTV = data.reduce((sum, d) => sum + (d.ltv || 0), 0);\n    const totalVisits = data.reduce((sum, d) => sum + (d.visits || 0), 0);\n    \n    return {\n      totalLeads,\n      trialsCompleted,\n      trialsScheduled,\n      convertedLeads,\n      proximityIssues,\n      conversionRate: totalLeads > 0 ? (convertedLeads / totalLeads) * 100 : 0,\n      trialConversionRate: trialsCompleted > 0 ? (convertedLeads / trialsCompleted) * 100 : 0,\n      avgLTV: totalLeads > 0 ? totalLTV / totalLeads : 0,\n      avgVisits: totalLeads > 0 ? totalVisits / totalLeads : 0,\n      totalLTV\n    };\n  }, [data]);\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"w-[90vw] max-w-[1400px] max-h-[90vh] overflow-hidden p-0 bg-white border-slate-200 shadow-2xl\">\n        <DialogHeader className=\"pb-6 border-b border-slate-700 bg-gradient-to-r from-slate-900 via-blue-950 to-slate-900 text-white -m-6 mb-6 p-6 shadow-xl\">\n          <div className=\"flex items-center justify-between\">\n            <DialogTitle className=\"text-2xl font-bold text-white flex items-center gap-3\">\n              <div className=\"p-2 bg-white/10 rounded-lg backdrop-blur-sm\">\n                <Users className=\"w-5 h-5 text-white\" />\n              </div>\n              {title} - Detailed Analysis\n            </DialogTitle>\n            <Button \n              variant=\"ghost\" \n              size=\"sm\" \n              onClick={onClose}\n              className=\"text-white hover:bg-white/20\"\n            >\n              <X className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        </DialogHeader>\n\n        <div className=\"overflow-y-auto px-8 py-6 space-y-8\" style={{ maxHeight: 'calc(90vh - 140px)' }}>\n          \n          {/* Summary Cards */}\n          <div className=\"p-6 bg-white border-2 border-blue-400 rounded-xl shadow-lg\">\n            <h3 className=\"text-lg font-semibold text-blue-700 mb-6 flex items-center gap-2 pb-4 border-b border-blue-200\">\n              <Target className=\"w-5 h-5 text-blue-600\" />\n              Key Performance Metrics\n            </h3>\n            <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4\">\n          <Card className=\"bg-white border-2 border-blue-500 shadow-md hover:shadow-xl transition-all duration-300\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2\">\n                <Users className=\"w-5 h-5 text-blue-600\" />\n                <div>\n                  <div className=\"text-2xl font-bold text-blue-700\">\n                    {formatNumber(summary.totalLeads)}\n                  </div>\n                  <div className=\"text-xs text-slate-600 font-medium\">Total Leads</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-white border-2 border-emerald-500 shadow-md hover:shadow-xl transition-all duration-300\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2\">\n                <UserCheck className=\"w-5 h-5 text-emerald-600\" />\n                <div>\n                  <div className=\"text-2xl font-bold text-emerald-700\">\n                    {formatNumber(summary.convertedLeads)}\n                  </div>\n                  <div className=\"text-xs text-slate-600 font-medium\">Converted</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-white border-2 border-purple-500 shadow-md hover:shadow-xl transition-all duration-300\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2\">\n                <Target className=\"w-5 h-5 text-purple-600\" />\n                <div>\n                  <div className=\"text-2xl font-bold text-purple-700\">\n                    {summary.conversionRate.toFixed(1)}%\n                  </div>\n                  <div className=\"text-xs text-slate-600 font-medium\">Conv. Rate</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-white border-2 border-rose-500 shadow-md hover:shadow-xl transition-all duration-300\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2\">\n                <Calendar className=\"w-5 h-5 text-rose-600\" />\n                <div>\n                  <div className=\"text-2xl font-bold text-rose-700\">\n                    {formatCurrency(summary.avgLTV)}\n                  </div>\n                  <div className=\"text-xs text-slate-600 font-medium\">Avg LTV</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-white border-2 border-amber-500 shadow-md hover:shadow-xl transition-all duration-300\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2\">\n                <TrendingUp className=\"w-5 h-5 text-amber-600\" />\n                <div>\n                  <div className=\"text-2xl font-bold text-amber-700\">\n                    {summary.avgVisits.toFixed(1)}\n                  </div>\n                  <div className=\"text-xs text-slate-600 font-medium\">Avg Visits</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n          </div>\n\n          {/* Lead Data Table */}\n          <div className=\"p-6 bg-white border-2 border-emerald-400 rounded-xl shadow-lg\">\n            <h3 className=\"text-lg font-semibold text-emerald-700 mb-6 flex items-center gap-2 pb-4 border-b border-emerald-200\">\n              <Award className=\"w-5 h-5 text-emerald-600\" />\n              Lead Details ({formatNumber(data.length)} leads)\n            </h3>\n            <ModernDataTable\n              data={data}\n              columns={columns}\n              headerGradient=\"from-slate-900 via-blue-950 to-slate-900\"\n              maxHeight=\"450px\"\n              stickyHeader={true}\n            />\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};"],"names":["FunnelDrillDownModal","isOpen","onClose","title","data","type","columns","value","row","jsxs","jsx","Phone","Badge","formatCurrency","formatNumber","MapPin","summary","React","totalLeads","trialsCompleted","d","trialsScheduled","convertedLeads","proximityIssues","totalLTV","sum","totalVisits","Dialog","DialogContent","DialogHeader","DialogTitle","Users","Button","X","Target","Card","CardContent","UserCheck","Calendar","TrendingUp","Award","ModernDataTable"],"mappings":"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"}