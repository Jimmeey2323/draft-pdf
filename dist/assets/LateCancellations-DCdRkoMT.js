import{r as x,j as e,C as pe,a as we,b as ke,c as be,B as H,h as he,w as Ve,T as Le,X as He,d as Ge,u as Ye}from"./index-Bm67KBkU.js";import{u as Xe}from"./useLateCancellationsData-CGb6iEHP.js";import{L as _e,a as Qe}from"./LateCancellationsMonthOnMonthTable-ChB4z8WR.js";import{a as M,B as v,f as ge,d as Je}from"./index-DkD_C-d1.js";import{C as Me}from"./dollar-sign-CKqx8kbC.js";import{C as oe,T as $e}from"./googleAuth-BGo8ElRc.js";import{C as Ze,a as es}from"./SalesMotionHero-sGphstF2.js";import{R as Te,B as Ue,a as Ie,X as Ae,Y as Fe,T as Se,b as Re,C as ss}from"./BarChart-o5Oeg9Jb.js";import{P as as,a as ts}from"./PieChart-slnvMcDg.js";import{L as ns,a as ls}from"./LineChart-BWKGpJsm.js";import{T as Ee,a as We,b as G,c as Q}from"./tabs-BTrhdLSC.js";import{U as Y}from"./users-7Ku-1TDB.js";import{M as ue,S as rs}from"./StudioLocationTabs-BSKYatd_.js";import{U as Pe}from"./user-izuMblv0.js";import{P as xe}from"./package-C0br8ACw.js";import{T as Oe}from"./trending-down-B5K1omnR.js";import{C as is}from"./crown-Bf6tWe5C.js";import{T as cs}from"./trophy-ChiyFqMe.js";import{M as os}from"./medal-BdYY0bn6.js";import{S as ms}from"./star-qy423-d6.js";import{C as ds,T as us}from"./thumbs-down-5G9TMNL9.js";import{C as hs}from"./circle-alert-bpasmovd.js";import{T as ae,a as te,b as $,c as u,d as ne,e as h}from"./table-DhXofKdS.js";import{P as le}from"./PersistentTableFooter-DyingoeQ.js";import{C as xs}from"./CopyTableButton-Blm2CDq4.js";import{i as ps,F as ze,C as bs,S as je,d as fe,e as ye,g as Ne,h as re,I as Be}from"./select-CM-Birqk.js";import{a as js,C as fs}from"./chevron-right-CbIMR3DA.js";import{L as de}from"./label-fD3fdNwH.js";import{C as ys}from"./clock-BP1BFskn.js";import{F as Ns}from"./footer-BTvMjyAb.js";import{A as gs}from"./AdvancedExportButton-kiFhlv4f.js";import{LateCancellationsDrillDownModal as vs}from"./LateCancellationsDrillDownModal-CFbK8n_k.js";import{D as ws}from"./DashboardMotionHero-C2yuh4RF.js";import"./circle-x-DIh1Phs9.js";import"./credit-card-yR0Iskrq.js";import"./minus-BzN8XxOo.js";import"./dropdown-menu-B9zQ9u84.js";import"./file-text-DChZNHsM.js";import"./index-BdQq_4o_.js";import"./checkbox-ByePFv7I.js";import"./BrandSpinner-CGFi2e0U.js";import"./useAdvancedExport-luHYyrc4.js";import"./scroll-area-BKnEh-kP.js";const ks=({data:m})=>{const[k,B]=x.useState("6m"),[K,_]=x.useState("monthly"),[g,X]=x.useState("count"),P=x.useMemo(()=>{if(!m||m.length===0)return[];const C=new Date;let b=new Date;switch(k){case"1m":b.setMonth(C.getMonth()-1);break;case"3m":b.setMonth(C.getMonth()-3);break;case"6m":b.setMonth(C.getMonth()-6);break;case"1y":b.setFullYear(C.getFullYear()-1);break;default:return m}return m.filter(y=>{if(!y.dateIST)return!1;const I=new Date(y.dateIST);return I>=b&&I<=C})},[m,k]),U=x.useMemo(()=>{if(!P.length)return[];const C=P.reduce((b,y)=>{if(!y.dateIST)return b;const I=new Date(y.dateIST),A=`${I.getFullYear()}-${String(I.getMonth()+1).padStart(2,"0")}`;return b[A]||(b[A]={month:I.toLocaleDateString("en",{month:"short",year:"numeric"}),count:0,members:new Set,locations:new Set}),b[A].count+=1,b[A].members.add(y.memberId),b[A].locations.add(y.location),b},{});return Object.values(C).map(b=>({...b,members:b.members.size,locations:b.locations.size})).sort((b,y)=>b.month.localeCompare(y.month))},[P]),j=x.useMemo(()=>{if(!P.length)return[];const C=P.reduce((y,I)=>{const A=I.location||"Unknown Location";return y[A]||(y[A]={name:A,count:0,members:new Set,classes:new Set}),y[A].count+=1,y[A].members.add(I.memberId),y[A].classes.add(I.cleanedClass),y},{});return Object.values(C).map(y=>({...y,members:y.members.size,classes:y.classes.size})).sort((y,I)=>I.count-y.count).slice(0,10)},[P]),N=x.useMemo(()=>{if(!P.length)return[];const C=P.reduce((b,y)=>{const I=y.cleanedClass||"Unknown Class";return b[I]||(b[I]=0),b[I]+=1,b},{});return Object.entries(C).map(([b,y])=>({name:b,value:y})).sort((b,y)=>y.value-b.value).slice(0,8)},[P]),q=x.useMemo(()=>{if(!P.length)return[];const C=P.reduce((y,I)=>{const A=I.dayOfWeek||"Unknown";return y[A]||(y[A]=0),y[A]+=1,y},{});return["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(y=>({day:y,count:C[y]||0}))},[P]),L=["#dc2626","#ea580c","#d97706","#ca8a04","#65a30d","#16a34a","#059669","#0891b2"],f=(C,b)=>M(Number(C)),R=x.useCallback(C=>{B(C)},[]),E=x.useCallback(C=>{_(C)},[]),J=x.useCallback(C=>{X(C)},[]);if(!m||m.length===0)return e.jsxs(pe,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(we,{children:e.jsxs(ke,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5 text-red-600"}),"Interactive Late Cancellations Charts"]})}),e.jsx(be,{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-slate-600",children:"No data available for charts"})})]});const O=()=>{switch(K){case"monthly":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(H,{variant:g==="count"?"default":"outline",size:"sm",onClick:()=>J("count"),children:"Cancellations"}),e.jsx(H,{variant:g==="members"?"default":"outline",size:"sm",onClick:()=>J("members"),children:"Unique Members"}),e.jsx(H,{variant:g==="locations"?"default":"outline",size:"sm",onClick:()=>J("locations"),children:"Locations"})]}),e.jsx(Te,{width:"100%",height:400,children:e.jsxs(ns,{data:U,children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx(Ae,{dataKey:"month"}),e.jsx(Fe,{tickFormatter:M}),e.jsx(Se,{formatter:f}),e.jsx(ls,{type:"monotone",dataKey:g,stroke:"#dc2626",strokeWidth:3,dot:{fill:"#dc2626",strokeWidth:2,r:4}})]})})]});case"locations":return e.jsx(Te,{width:"100%",height:400,children:e.jsxs(Ue,{data:j,margin:{left:20,right:20,top:20,bottom:60},children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx(Ae,{dataKey:"name",angle:-45,textAnchor:"end",height:100,interval:0}),e.jsx(Fe,{tickFormatter:M}),e.jsx(Se,{formatter:f}),e.jsx(Re,{dataKey:"count",fill:"#dc2626"})]})});case"classes":return e.jsx(Te,{width:"100%",height:400,children:e.jsxs(as,{children:[e.jsx(ts,{data:N,cx:"50%",cy:"50%",labelLine:!1,label:({name:C,percent:b})=>`${C} ${(b*100).toFixed(0)}%`,outerRadius:120,fill:"#8884d8",dataKey:"value",children:N.map((C,b)=>e.jsx(ss,{fill:L[b%L.length]},`cell-${b}`))}),e.jsx(Se,{formatter:f})]})});case"dayofweek":return e.jsx(Te,{width:"100%",height:400,children:e.jsxs(Ue,{data:q,children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx(Ae,{dataKey:"day"}),e.jsx(Fe,{tickFormatter:M}),e.jsx(Se,{formatter:f}),e.jsx(Re,{dataKey:"count",fill:"#ea580c"})]})});default:return null}};return e.jsxs(pe,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(we,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs(ke,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5 text-red-600"}),"Interactive Late Cancellations Charts"]})}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 flex items-center gap-1",children:[e.jsx(oe,{className:"w-4 h-4"}),"Time Range:"]}),[{key:"1m",label:"Last Month"},{key:"3m",label:"Last 3 Months"},{key:"6m",label:"Last 6 Months"},{key:"1y",label:"Last Year"}].map(({key:C,label:b})=>e.jsx(H,{variant:k===C?"default":"outline",size:"sm",onClick:()=>R(C),children:b},C))]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 flex items-center gap-1",children:[e.jsx($e,{className:"w-4 h-4"}),"Chart Type:"]}),e.jsxs(H,{variant:K==="monthly"?"default":"outline",size:"sm",onClick:()=>E("monthly"),className:"flex items-center gap-1",children:[e.jsx(Ze,{className:"w-4 h-4"}),"Monthly Trend"]}),e.jsxs(H,{variant:K==="locations"?"default":"outline",size:"sm",onClick:()=>E("locations"),className:"flex items-center gap-1",children:[e.jsx(Me,{className:"w-4 h-4"}),"By Location"]}),e.jsxs(H,{variant:K==="classes"?"default":"outline",size:"sm",onClick:()=>E("classes"),className:"flex items-center gap-1",children:[e.jsx(es,{className:"w-4 h-4"}),"By Class Type"]}),e.jsxs(H,{variant:K==="dayofweek"?"default":"outline",size:"sm",onClick:()=>E("dayofweek"),className:"flex items-center gap-1",children:[e.jsx(Me,{className:"w-4 h-4"}),"By Day of Week"]})]})]})}),e.jsx(be,{children:O()})]})},Cs=({data:m})=>{const[k,B]=x.useState("members"),[K,_]=x.useState(!1),g=x.useMemo(()=>{if(!m||m.length===0)return[];const U=m.reduce((j,N)=>{let q="",L="";switch(k){case"members":q=N.memberId,L=`${N.firstName||""} ${N.lastName||""}`.trim()||"Unknown";break;case"locations":q=N.location||"Unknown",L=N.location||"Unknown";break;case"classes":q=N.cleanedClass||"Unknown",L=N.cleanedClass||"Unknown";break;case"trainers":q=N.teacherName||"Unknown",L=N.teacherName||"Unknown";break;case"memberships":q=N.cleanedProduct||"Unknown",L=N.cleanedProduct||"Unknown";break}return j[q]||(j[q]={name:L,totalCancellations:0,uniqueMembers:new Set,uniqueLocations:new Set,uniqueClasses:new Set,uniqueTrainers:new Set}),j[q].totalCancellations+=1,j[q].uniqueMembers.add(N.memberId),j[q].uniqueLocations.add(N.location),j[q].uniqueClasses.add(N.cleanedClass),j[q].uniqueTrainers.add(N.teacherName),j},{});return Object.values(U).forEach(j=>{j.uniqueMembersCount=j.uniqueMembers.size,j.uniqueLocationsCount=j.uniqueLocations.size,j.uniqueClassesCount=j.uniqueClasses.size,j.uniqueTrainersCount=j.uniqueTrainers.size,delete j.uniqueMembers,delete j.uniqueLocations,delete j.uniqueClasses,delete j.uniqueTrainers}),Object.values(U).sort((j,N)=>N.totalCancellations-j.totalCancellations)},[m,k]),X=U=>{switch(U){case"members":return{icon:Y,label:"Members",description:"Individual member cancellation patterns"};case"locations":return{icon:ue,label:"Locations",description:"Studio location cancellation rates"};case"classes":return{icon:oe,label:"Classes",description:"Class type cancellation trends"};case"trainers":return{icon:Pe,label:"Trainers",description:"Trainer-specific cancellation data"};case"memberships":return{icon:xe,label:"Memberships",description:"Membership type cancellation rates"};default:return{icon:Y,label:"Members",description:"Cancellation data"}}},P=()=>{const U=X(k),j=K?10:5,N=g.slice(0,j),q=g.slice(-j).reverse(),L=(f,R)=>R?f===0?e.jsx(is,{className:"w-5 h-5 text-white"}):f===1?e.jsx(cs,{className:"w-5 h-5 text-white"}):f===2?e.jsx(os,{className:"w-5 h-5 text-white"}):f===3?e.jsx(ms,{className:"w-5 h-5 text-white"}):e.jsx("span",{className:"text-white font-bold text-sm",children:f+1}):f===0?e.jsx(ds,{className:"w-5 h-5 text-white"}):f===1?e.jsx(Oe,{className:"w-5 h-5 text-white"}):f===2?e.jsx(us,{className:"w-5 h-5 text-white"}):e.jsx(hs,{className:"w-5 h-5 text-white"});return e.jsxs(pe,{className:"bg-gradient-to-br from-white via-slate-50/50 to-white border-0 shadow-xl hover:shadow-2xl transition-all duration-500",children:[e.jsx(we,{className:"pb-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(ke,{className:"text-xl font-bold text-slate-800 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-r from-purple-500 to-pink-500",children:he.createElement(U.icon,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsxs("span",{className:"bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:[U.label," Cancellation Analysis"]}),e.jsx("p",{className:"text-sm text-slate-600 font-normal mt-1",children:U.description})]})]})})}),e.jsxs(be,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-r from-red-500 to-rose-600",children:e.jsx($e,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold bg-gradient-to-r from-red-600 to-rose-600 bg-clip-text text-transparent",children:"Most Cancellations"}),e.jsx("p",{className:"text-xs text-slate-500",children:"High cancellation rate - needs attention"})]})]}),e.jsx("div",{className:"space-y-2",children:N.map((f,R)=>e.jsxs("div",{className:"group flex items-center justify-between p-4 rounded-xl bg-white shadow-sm border hover:shadow-md transition-all duration-300 cursor-pointer hover:border-red-200/70",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-gradient-to-r from-red-500 to-rose-600 text-white shadow-md shrink-0",children:L(R,!0)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-semibold text-slate-900 truncate",title:f.name,children:f.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[e.jsxs(v,{variant:"secondary",className:"bg-blue-50 text-blue-700 text-xs",children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),M(f.uniqueMembersCount)," members"]}),k!=="locations"&&e.jsxs(v,{variant:"secondary",className:"bg-purple-50 text-purple-700 text-xs",children:[e.jsx(ue,{className:"w-3 h-3 mr-1"}),M(f.uniqueLocationsCount)," locations"]})]})]})]}),e.jsxs("div",{className:"ml-3 text-right shrink-0",children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:M(f.totalCancellations)}),e.jsx("p",{className:"text-xs text-slate-500",children:"cancellations"})]})]},f.name))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-r from-emerald-500 to-teal-600",children:e.jsx(Oe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent",children:"Least Cancellations"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Low cancellation rate - performing well"})]})]}),e.jsx("div",{className:"space-y-2",children:q.map((f,R)=>e.jsxs("div",{className:"group flex items-center justify-between p-4 rounded-xl bg-white shadow-sm border hover:shadow-md transition-all duration-300 cursor-pointer hover:border-emerald-200/70",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-gradient-to-r from-emerald-500 to-teal-600 text-white shadow-md shrink-0",children:L(R,!1)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-semibold text-slate-900 truncate",title:f.name,children:f.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[e.jsxs(v,{variant:"secondary",className:"bg-blue-50 text-blue-700 text-xs",children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),M(f.uniqueMembersCount)," members"]}),k!=="locations"&&e.jsxs(v,{variant:"secondary",className:"bg-purple-50 text-purple-700 text-xs",children:[e.jsx(ue,{className:"w-3 h-3 mr-1"}),M(f.uniqueLocationsCount)," locations"]})]})]})]}),e.jsxs("div",{className:"ml-3 text-right shrink-0",children:[e.jsx("p",{className:"text-2xl font-bold text-emerald-600",children:M(f.totalCancellations)}),e.jsx("p",{className:"text-xs text-slate-500",children:"cancellations"})]})]},f.name))})]})]}),g.length>5&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(H,{variant:"outline",size:"sm",onClick:()=>_(!K),className:"text-slate-700 hover:bg-slate-50",children:K?"Show Less":"Show More"})})]})]})};return!m||m.length===0?e.jsx(pe,{className:"bg-gradient-to-br from-white via-slate-50/50 to-white border-0 shadow-xl",children:e.jsx(be,{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-slate-600",children:"No cancellation data available"})})}):e.jsx("div",{className:"space-y-6",children:e.jsxs(Ee,{value:k,onValueChange:U=>B(U),className:"w-full",children:[e.jsxs(We,{className:"bg-white/90 backdrop-blur-sm p-2 rounded-2xl shadow-xl border-0 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 w-full max-w-5xl mx-auto",children:[e.jsxs(G,{value:"members",className:"relative rounded-xl px-4 py-3 font-semibold text-sm w-full justify-center min-h-[48px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-purple-600 data-[state=active]:to-pink-600 data-[state=active]:text-white data-[state=active]:shadow-lg hover:bg-gray-50",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Members"]}),e.jsxs(G,{value:"locations",className:"relative rounded-xl px-4 py-3 font-semibold text-sm w-full justify-center min-h-[48px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-purple-600 data-[state=active]:to-pink-600 data-[state=active]:text-white data-[state=active]:shadow-lg hover:bg-gray-50",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Locations"]}),e.jsxs(G,{value:"classes",className:"relative rounded-xl px-4 py-3 font-semibold text-sm w-full justify-center min-h-[48px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-purple-600 data-[state=active]:to-pink-600 data-[state=active]:text-white data-[state=active]:shadow-lg hover:bg-gray-50",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Classes"]}),e.jsxs(G,{value:"trainers",className:"relative rounded-xl px-4 py-3 font-semibold text-sm w-full justify-center min-h-[48px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-purple-600 data-[state=active]:to-pink-600 data-[state=active]:text-white data-[state=active]:shadow-lg hover:bg-gray-50",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Trainers"]}),e.jsxs(G,{value:"memberships",className:"relative rounded-xl px-4 py-3 font-semibold text-sm w-full justify-center min-h-[48px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-purple-600 data-[state=active]:to-pink-600 data-[state=active]:text-white data-[state=active]:shadow-lg hover:bg-gray-50",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Memberships"]})]}),e.jsx(Q,{value:k,className:"mt-6",children:P()})]})})},ve=100,Ms=({data:m,allCheckins:k=[],onDrillDown:B})=>{const K=Ve(),_=x.useRef(null);x.useRef(null),x.useRef(null),x.useRef(null),x.useRef(null),x.useRef(null),x.useRef(null),x.useRef(null),x.useRef(null);const g=({children:i,tableRef:l})=>e.jsx("div",{ref:l,className:"bg-white/90 backdrop-blur-sm border border-slate-200 rounded-2xl shadow-sm overflow-hidden",children:i}),[X,P]=x.useState("multiple-day"),[U,j]=x.useState(1),[N,q]=x.useState(!0),L=x.useMemo(()=>{if(!m||m.length===0)return[];const i=m.reduce((a,s)=>{if(!s.dateIST||!s.memberId)return a;const t=`${s.memberId}-${s.dateIST}`;return a[t]||(a[t]={memberId:s.memberId,memberName:`${s.firstName||""} ${s.lastName||""}`.trim(),email:s.email,date:s.dateIST,cancellations:[],count:0,locations:new Set,classes:new Set,specificClasses:new Set,trainers:new Set}),a[t].cancellations.push({sessionName:s.sessionName,time:s.time,location:s.location,teacherName:s.teacherName,cleanedClass:s.cleanedClass,cleanedProduct:s.cleanedProduct}),a[t].count+=1,a[t].locations.add(s.location),a[t].classes.add(s.cleanedClass),a[t].specificClasses.add(`${s.cleanedClass||"Unknown"}|${s.dayOfWeek||"Unknown"}|${s.time||"Unknown"}`),a[t].trainers.add(s.teacherName),a},{});return Object.values(i).filter(a=>a.count>1).map(a=>({...a,uniqueLocations:a.locations.size,uniqueClasses:a.classes.size,uniqueTrainers:a.trainers.size,uniqueSpecificClasses:a.specificClasses.size})).sort((a,s)=>N?s.count-a.count:a.count-s.count)},[m,N]),f=x.useMemo(()=>{if(!k||k.length===0)return[];const i=k.reduce((a,s)=>{if(!s.dateIST||!s.memberId||!((s.checkedIn||"").toString().toUpperCase()==="TRUE"))return a;const o=`${s.memberId}-${s.dateIST}`;return a[o]||(a[o]={memberId:s.memberId,memberName:`${s.firstName||""} ${s.lastName||""}`.trim(),email:s.email,date:s.dateIST,totalSessions:0,cancellations:0,sessionDetails:[]}),a[o].totalSessions+=1,a[o].sessionDetails.push({sessionName:s.sessionName,time:s.time,location:s.location,teacherName:s.teacherName,status:"checked-in"}),a},{});return Object.values(i).filter(a=>a.totalSessions>1).sort((a,s)=>N?s.totalSessions-a.totalSessions:a.totalSessions-s.totalSessions)},[k,N]),R=x.useMemo(()=>{if(!k||k.length===0)return[];const i=k.reduce((a,s)=>{if(!s.dateIST||!s.memberId)return a;const t=`${s.memberId}-${s.dateIST}`;return a[t]||(a[t]={memberId:s.memberId,memberName:`${s.firstName||""} ${s.lastName||""}`.trim(),email:s.email,date:s.dateIST,totalBookings:0,sessionDetails:[]}),a[t].totalBookings+=1,a[t].sessionDetails.push({sessionName:s.sessionName,time:s.time,location:s.location,teacherName:s.teacherName,status:(s.checkedIn||"").toString().toUpperCase()==="TRUE"?"checked-in":"booked"}),a},{});return Object.values(i).filter(a=>a.totalBookings>1).sort((a,s)=>N?s.totalBookings-a.totalBookings:a.totalBookings-s.totalBookings)},[k,N]),E=x.useMemo(()=>{if(!k||k.length===0)return[];const i=k.reduce((l,a)=>{if(!((a.checkedIn||"").toString().toUpperCase()==="TRUE"))return l;const t=a.dateIST?new Date(a.dateIST).toISOString().slice(0,10):"Unknown";return l[t]||(l[t]={date:t,count:0,members:new Set,locations:new Set,formats:new Set,revenue:0}),l[t].count+=1,a.memberId&&l[t].members.add(a.memberId),a.location&&l[t].locations.add(a.location),a.cleanedClass&&l[t].formats.add(a.cleanedClass),l[t].revenue+=a.paidAmount||0,l},{});return Object.values(i).map(l=>({...l,uniqueMembers:l.members.size,uniqueLocations:l.locations.size,uniqueFormats:l.formats.size})).sort((l,a)=>l.date<a.date?1:-1)},[k]),J=x.useMemo(()=>{if(!k||k.length===0)return[];const i=k.reduce((l,a)=>{const s=a.dateIST?new Date(a.dateIST).toISOString().slice(0,10):"Unknown";return l[s]||(l[s]={date:s,count:0,members:new Set,locations:new Set,formats:new Set,revenue:0}),l[s].count+=1,a.memberId&&l[s].members.add(a.memberId),a.location&&l[s].locations.add(a.location),a.cleanedClass&&l[s].formats.add(a.cleanedClass),l[s].revenue+=a.paidAmount||0,l},{});return Object.values(i).map(l=>({...l,uniqueMembers:l.members.size,uniqueLocations:l.locations.size,uniqueFormats:l.formats.size})).sort((l,a)=>l.date<a.date?1:-1)},[k]),O=(i,l,a)=>{const s=A(i);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-slate-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:l}),e.jsxs(v,{variant:"outline",className:"bg-slate-50 text-slate-700 min-w-[120px] justify-center",children:[M(i.length)," days"]})]})}),s.length>0?e.jsxs(e.Fragment,{children:[e.jsx(g,{children:e.jsxs(ae,{children:[e.jsx(te,{className:"bg-gradient-to-r from-red-600 to-orange-600 text-white",children:e.jsxs($,{className:"h-[35px]",children:[e.jsx(u,{className:"text-white font-bold",children:"Date"}),e.jsx(u,{className:"text-white font-bold",children:"Sessions"}),e.jsx(u,{className:"text-white font-bold",children:"Members"}),e.jsx(u,{className:"text-white font-bold",children:"Locations"}),e.jsx(u,{className:"text-white font-bold",children:"Formats"}),e.jsx(u,{className:"text-white font-bold",children:"Revenue"})]})}),e.jsx(ne,{children:s.map((t,o)=>e.jsxs($,{className:"h-[35px] hover:bg-red-50/30 transition-colors",children:[e.jsx(h,{className:"font-medium",children:(()=>{const n=new Date(t.date);return isNaN(n.getTime())?"—":n.toLocaleDateString()})()}),e.jsx(h,{children:e.jsx(v,{variant:"outline",className:"min-w-[70px] justify-center bg-red-50 text-red-700 border-red-200",children:M(t.count)})}),e.jsx(h,{children:e.jsx(v,{variant:"outline",className:"min-w-[70px] justify-center bg-orange-50 text-orange-700 border-orange-200",children:M(t.uniqueMembers)})}),e.jsx(h,{children:e.jsx(v,{variant:"outline",className:"min-w-[70px] justify-center bg-red-50 text-red-700 border-red-200",children:M(t.uniqueLocations)})}),e.jsx(h,{children:e.jsx(v,{variant:"outline",className:"min-w-[70px] justify-center bg-orange-50 text-orange-700 border-orange-200",children:M(t.uniqueFormats)})}),e.jsx(h,{className:"text-slate-700 font-semibold",children:ge(t.revenue)})]},o))})]})}),e.jsx(se,{}),e.jsx(le,{tableId:a,tableName:l,tableContext:`${l} within selected filters`,tableData:s,tableColumns:[{header:"Date",key:"date",type:"date"},{header:"Sessions",key:"count",type:"number"},{header:"Members",key:"uniqueMembers",type:"number"},{header:"Locations",key:"uniqueLocations",type:"number"},{header:"Formats",key:"uniqueFormats",type:"number"},{header:"Revenue",key:"revenue",type:"currency"}]})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No data available"})]})},C=x.useMemo(()=>{if(!m||m.length===0)return{byFormat:[],byMembership:[]};const i=m.reduce((o,n)=>{const w=n.memberId||n.email||"unknown";return o[w]=(o[w]||0)+1,o},{}),l=[{label:"1",min:1,max:1},{label:"2–3",min:2,max:3},{label:"4–7",min:4,max:7},{label:"8–15",min:8,max:15},{label:"16+",min:16,max:1/0}],a={},s={};Object.entries(i).forEach(([o,n])=>{const w=m.filter(F=>(F.memberId||F.email||"unknown")===o),D=new Set(w.map(F=>F.cleanedClass||"Unknown")),V=new Set(w.map(F=>F.cleanedProduct||"Unknown")),ce=w.reduce((F,Ke)=>F+(Ke.paidAmount||0),0),Ce=l.find(F=>n>=F.min&&n<=F.max)?.label||"1";D.forEach(F=>{a[F]=a[F]||{format:F,buckets:{},members:0,revenue:0},a[F].buckets[Ce]=(a[F].buckets[Ce]||0)+1,a[F].members+=1,a[F].revenue+=ce}),V.forEach(F=>{s[F]=s[F]||{membership:F,buckets:{},members:0,revenue:0},s[F].buckets[Ce]=(s[F].buckets[Ce]||0)+1,s[F].members+=1,s[F].revenue+=ce})});const t=(o,n)=>Object.values(o).map(w=>({[n]:w[n],members:w.members,revenue:w.revenue,...l.reduce((D,V)=>({...D,[V.label]:w.buckets[V.label]||0}),{})}));return{byFormat:t(a,"format"),byMembership:t(s,"membership"),buckets:l}},[m]),b=x.useMemo(()=>{if(!m||m.length===0)return[];const i=m.reduce((a,s)=>{const t=s.cleanedClass||"Unknown Class";if(a[t]||(a[t]={className:t,category:s.cleanedCategory||"Unknown",count:0,members:new Set,locations:new Set,trainers:new Set,totalDuration:0,totalRevenue:0,peakTimes:{},daysOfWeek:{}}),a[t].count+=1,a[t].members.add(s.memberId),a[t].locations.add(s.location),a[t].trainers.add(s.teacherName),a[t].totalDuration+=s.duration||0,a[t].totalRevenue+=s.paidAmount||0,s.time){const o=parseInt(s.time.split(":")[0]),n=o<12?"Morning":o<17?"Afternoon":"Evening";a[t].peakTimes[n]=(a[t].peakTimes[n]||0)+1}return s.dayOfWeek&&(a[t].daysOfWeek[s.dayOfWeek]=(a[t].daysOfWeek[s.dayOfWeek]||0)+1),a},{});return Object.values(i).map(a=>{const s=Object.entries(a.peakTimes).reduce((o,n)=>a.peakTimes[o[0]]>a.peakTimes[n[0]]?o:n,["N/A",0])[0],t=Object.entries(a.daysOfWeek).reduce((o,n)=>a.daysOfWeek[o[0]]>a.daysOfWeek[n[0]]?o:n,["N/A",0])[0];return{...a,uniqueMembers:a.members.size,uniqueLocations:a.locations.size,uniqueTrainers:a.trainers.size,avgDuration:a.count>0?Math.round(a.totalDuration/a.count):0,avgRevenue:a.count>0?a.totalRevenue/a.count:0,peakTime:s,peakDay:t}}).sort((a,s)=>N?s.count-a.count:a.count-s.count)},[m,N]),y=x.useMemo(()=>{if(!m||m.length===0)return[];const i=m.reduce((a,s)=>{const t=s.cleanedProduct||"Unknown Membership";return a[t]||(a[t]={membershipType:t,category:s.cleanedCategory||"Unknown",count:0,members:new Set,revenue:0,locations:new Set,classes:new Set,avgCancellationsPerMember:0}),a[t].count+=1,a[t].members.add(s.memberId),a[t].revenue+=s.paidAmount||0,a[t].locations.add(s.location),a[t].classes.add(s.cleanedClass),a},{});return Object.values(i).map(a=>({...a,uniqueMembers:a.members.size,uniqueLocations:a.locations.size,uniqueClasses:a.classes.size,avgRevenuePerCancellation:a.count>0?a.revenue/a.count:0,avgCancellationsPerMember:a.uniqueMembers>0?a.count/a.uniqueMembers:0})).sort((a,s)=>N?s.count-a.count:a.count-s.count)},[m,N]),I=x.useMemo(()=>{if(!m||m.length===0)return[];const i=m.reduce((a,s)=>{const t=s.memberId||s.email||"unknown";return a[t]||(a[t]={memberId:s.memberId,memberName:`${s.firstName||""} ${s.lastName||""}`.trim(),email:s.email,date:"Multiple",count:0,cancellations:[],locations:new Set,classes:new Set,trainers:new Set}),a[t].count+=1,a[t].cancellations.length<10&&a[t].cancellations.push({sessionName:s.sessionName,time:s.time,location:s.location,teacherName:s.teacherName,cleanedClass:s.cleanedClass,cleanedProduct:s.cleanedProduct}),a[t].locations.add(s.location||""),a[t].classes.add(s.cleanedClass||""),a[t].trainers.add(s.teacherName||""),a},{});return Object.values(i).map(a=>({...a,uniqueLocations:a.locations.size,uniqueClasses:a.classes.size,uniqueTrainers:a.trainers.size})).sort((a,s)=>N?s.count-a.count:a.count-s.count)},[m,N]),A=i=>{const l=(U-1)*ve,a=l+ve;return i.slice(l,a)},Z=i=>Math.ceil(i.length/ve),p=(()=>{switch(X){case"multiple-day":return L;case"multiple-checkins":return f;case"multiple-bookings":return R;case"by-class":return b;case"by-membership":return y;case"top-cancellers":return I;default:return[]}})(),ee=A(p),ie=Z(p);he.useEffect(()=>{j(1)},[X]);const se=()=>e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-gray-200",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:e.jsxs("span",{children:["Showing ",(U-1)*ve+1," to ",Math.min(U*ve,p.length)," of ",p.length," results"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(H,{variant:"outline",size:"sm",onClick:()=>j(i=>Math.max(1,i-1)),disabled:U===1,className:"gap-1",children:[e.jsx(ps,{className:"w-4 h-4"}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-1",children:[...Array(Math.min(5,ie))].map((i,l)=>{const a=Math.max(1,Math.min(ie-4,U-2))+l;return a>ie?null:e.jsx(H,{variant:a===U?"default":"outline",size:"sm",onClick:()=>j(a),className:"w-8 h-8 p-0",children:a},a)})}),e.jsxs(H,{variant:"outline",size:"sm",onClick:()=>j(i=>Math.min(ie,i+1)),disabled:U===ie,className:"gap-1",children:["Next",e.jsx(js,{className:"w-4 h-4"})]})]})]}),me=(i,l,a)=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 justify-between px-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-5 h-5 text-orange-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:l}),e.jsxs(v,{variant:"outline",className:"bg-orange-50 text-orange-700 min-w-[90px] justify-center",children:[p.length," total members"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Sort by count"}),e.jsx(H,{size:"sm",variant:"outline",onClick:()=>q(s=>!s),children:N?"Desc":"Asc"})]})]}),Array.isArray(i)&&i.length>0?e.jsxs(e.Fragment,{children:[e.jsx(g,{children:e.jsxs(ae,{children:[e.jsx(te,{children:e.jsxs($,{children:[e.jsx(u,{children:"Member"}),e.jsx(u,{children:"Email"}),e.jsx(u,{children:"Date"}),e.jsx(u,{children:"Count"}),e.jsx(u,{children:"Details"}),e.jsx(u,{children:"Sessions"})]})}),e.jsx(ne,{children:i.map((s,t)=>e.jsxs($,{className:"h-[35px] max-h-[35px] hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>{try{if(B&&s){const o=m.filter(n=>{const w=s.memberName||`${s.firstName||""} ${s.lastName||""}`.trim(),D=n.memberName||`${n.firstName||""} ${n.lastName||""}`.trim();return n.memberName&&s.memberName&&n.memberName===s.memberName||n.memberId&&s.memberId&&n.memberId===s.memberId||n.email&&s.email&&n.email===s.email||w&&D&&w===D});B({type:"member",title:`Member: ${s.memberName||`${s.firstName||""} ${s.lastName||""}`.trim()||"Unknown"} (${o.length} cancellations)`,data:s,rawData:o})}}catch{}},children:[e.jsx(h,{className:"font-medium h-[35px] py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-red-500 to-pink-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:s.memberName?s.memberName.charAt(0).toUpperCase():"U"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm truncate max-w-[150px]",children:s.memberName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",s.memberId]})]})]})}),e.jsx(h,{className:"h-[35px] py-2",children:e.jsx("span",{className:"text-sm truncate max-w-[200px] block",children:s.email})}),e.jsx(h,{className:"h-[35px] py-2",children:e.jsx(v,{variant:"outline",className:"text-xs min-w-[90px] justify-center",children:(()=>{const o=new Date(s.date);return isNaN(o.getTime())?"—":o.toLocaleDateString()})()})}),e.jsx(h,{className:"h-[35px] py-2",children:e.jsxs(v,{variant:"destructive",className:"text-xs min-w-[70px] justify-center",children:[a==="multiple-day"?s.count:a==="multiple-checkins"?s.totalSessions:s.totalBookings," ",a==="multiple-day"?"cancellations":"sessions"]})}),e.jsx(h,{className:"h-[35px] py-2",children:e.jsxs("div",{className:"flex gap-1",children:[s.uniqueLocations&&e.jsxs(v,{variant:"outline",className:"text-xs min-w-[60px] justify-center",children:[s.uniqueLocations," loc"]}),s.uniqueClasses&&e.jsxs(v,{variant:"outline",className:"text-xs min-w-[80px] justify-center",children:[s.uniqueClasses," formats"]}),s.uniqueSpecificClasses&&e.jsxs(v,{variant:"outline",className:"text-xs min-w-[100px] justify-center",children:[s.uniqueSpecificClasses," classes"]})]})}),e.jsx(h,{className:"h-[35px] py-2",children:e.jsx("div",{className:"text-xs text-gray-600 max-w-[200px]",children:Array.isArray(a==="multiple-day"?s.cancellations:s.sessionDetails)?`${(a==="multiple-day"?s.cancellations:s.sessionDetails).length} sessions`:"No data"})})]},t))})]})}),e.jsx(se,{}),e.jsx(le,{tableId:`late-cancel-${a}`,tableName:l,tableContext:a==="multiple-day"?"Members with multiple same-day late cancellations":a==="multiple-checkins"?"Members with multiple same-day check-ins":"Members with multiple same-day bookings",tableData:i,tableColumns:[{header:"Member",key:"memberName",type:"text"},{header:"Email",key:"email",type:"text"},{header:"Date",key:"date",type:"date"},{header:"Count",key:a==="multiple-day"?"count":a==="multiple-checkins"?"totalSessions":"totalBookings",type:"number"}]})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No data available"})]}),De=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cancellations by Format"}),e.jsxs(v,{variant:"outline",className:"bg-blue-50 text-blue-700 min-w-[90px] justify-center",children:[p.length," class types"]})]})}),ee.length>0?e.jsxs(e.Fragment,{children:[e.jsx(g,{children:e.jsxs(ae,{children:[e.jsx(te,{children:e.jsxs($,{className:"h-[35px]",children:[e.jsx(u,{children:"Format"}),e.jsx(u,{children:"Category"}),e.jsx(u,{children:"Cancellations"}),e.jsx(u,{children:"Members"}),e.jsx(u,{children:"Locations"}),e.jsx(u,{children:"Peak Time"}),e.jsx(u,{children:"Peak Day"}),e.jsx(u,{children:"Avg Duration"})]})}),e.jsx(ne,{children:ee.map((i,l)=>e.jsxs($,{className:"h-[35px] max-h-[35px] hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>{try{B&&i&&B({type:"class",title:`Format: ${i.className||"Unknown"}`,data:i,rawData:m.filter(a=>a.cleanedClass===i.className)||[]})}catch{}},children:[e.jsx(h,{className:"font-medium h-[35px] py-2",children:e.jsx("span",{className:"truncate max-w-[150px] block",children:i.className})}),e.jsx(h,{className:"h-[35px] py-2",children:e.jsx(v,{variant:"secondary",children:i.category})}),e.jsx(h,{className:"h-[35px] py-2",children:e.jsx(v,{variant:"destructive",className:"min-w-[70px] justify-center",children:M(i.count)})}),e.jsx(h,{className:"h-[35px] py-2",children:M(i.uniqueMembers)}),e.jsx(h,{className:"h-[35px] py-2",children:M(i.uniqueLocations)}),e.jsx(h,{className:"h-[35px] py-2",children:e.jsx(v,{variant:"outline",className:"min-w-[70px] justify-center",children:i.peakTime})}),e.jsx(h,{className:"h-[35px] py-2",children:e.jsx(v,{variant:"outline",className:"min-w-[70px] justify-center",children:i.peakDay})}),e.jsxs(h,{className:"h-[35px] py-2",children:[i.avgDuration," min"]})]},l))})]})}),e.jsx(se,{}),e.jsx(le,{tableId:"late-cancel-by-class",tableName:"Cancellations by Class Type",tableContext:"Late cancellations grouped by class type and category",tableData:ee,tableColumns:[{header:"Class Type",key:"className",type:"text"},{header:"Category",key:"category",type:"text"},{header:"Cancellations",key:"count",type:"number"},{header:"Members",key:"uniqueMembers",type:"number"},{header:"Locations",key:"uniqueLocations",type:"number"},{header:"Peak Time",key:"peakTime",type:"text"},{header:"Peak Day",key:"peakDay",type:"text"},{header:"Avg Duration",key:"avgDuration",type:"number"}]})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No class type data available"})]}),qe=()=>{const i=x.useMemo(()=>{if(!m||m.length===0)return[];const a=m.reduce((s,t)=>{const o=`${t.cleanedClass||"Unknown"}|${t.dayOfWeek||"Unknown"}|${t.time||"Unknown"}`;return s[o]||(s[o]={classKey:o,className:t.cleanedClass||"Unknown",dayOfWeek:t.dayOfWeek||"Unknown",time:t.time||"Unknown",count:0,locations:new Set,trainers:new Set}),s[o].count+=1,t.location&&s[o].locations.add(t.location),t.teacherName&&s[o].trainers.add(t.teacherName),s},{});return Object.values(a).map(s=>({...s,uniqueLocations:s.locations.size,uniqueTrainers:s.trainers.size})).sort((s,t)=>N?t.count-s.count:s.count-t.count)},[m,N]),l=A(i);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-slate-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cancellations by Class (Specific)"}),e.jsxs(v,{variant:"outline",className:"bg-slate-50 text-slate-700 min-w-[90px] justify-center",children:[i.length," classes"]})]})}),l.length>0?e.jsxs(e.Fragment,{children:[e.jsx(g,{children:e.jsxs(ae,{children:[e.jsx(te,{children:e.jsxs($,{className:"h-[35px]",children:[e.jsx(u,{children:"Class"}),e.jsx(u,{children:"Day"}),e.jsx(u,{children:"Time"}),e.jsx(u,{children:"Cancellations"}),e.jsx(u,{children:"Locations"}),e.jsx(u,{children:"Trainers"})]})}),e.jsx(ne,{children:l.map((a,s)=>e.jsxs($,{className:"h-[35px] hover:bg-gray-50",children:[e.jsx(h,{className:"font-medium",children:a.className}),e.jsx(h,{children:a.dayOfWeek}),e.jsx(h,{children:a.time}),e.jsx(h,{children:e.jsx(v,{variant:"destructive",className:"min-w-[70px] justify-center",children:M(a.count)})}),e.jsx(h,{children:e.jsx(v,{variant:"outline",className:"min-w-[60px] justify-center",children:a.uniqueLocations})}),e.jsx(h,{children:e.jsx(v,{variant:"outline",className:"min-w-[60px] justify-center",children:a.uniqueTrainers})})]},s))})]})}),e.jsx(se,{}),e.jsx(le,{tableId:"late-cancel-by-specific-class",tableName:"Cancellations by Specific Class",tableContext:"Late cancellations grouped by specific class (class + day + time)",tableData:l,tableColumns:[{header:"Class",key:"className",type:"text"},{header:"Day",key:"dayOfWeek",type:"text"},{header:"Time",key:"time",type:"text"},{header:"Cancellations",key:"count",type:"number"},{header:"Locations",key:"uniqueLocations",type:"number"},{header:"Trainers",key:"uniqueTrainers",type:"number"}]})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No specific class data"})]})},d=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-purple-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cancellations by Membership Type"}),e.jsxs(v,{variant:"outline",className:"bg-purple-50 text-purple-700",children:[p.length," membership types"]})]})}),ee.length>0?e.jsxs(e.Fragment,{children:[e.jsx(g,{children:e.jsxs(ae,{children:[e.jsx(te,{children:e.jsxs($,{className:"h-[35px]",children:[e.jsx(u,{children:"Membership Type"}),e.jsx(u,{children:"Category"}),e.jsx(u,{children:"Cancellations"}),e.jsx(u,{children:"Members"}),e.jsx(u,{children:"Locations"}),e.jsx(u,{children:"Avg per Member"}),e.jsx(u,{children:"Revenue Impact"})]})}),e.jsx(ne,{children:ee.map((i,l)=>e.jsxs($,{className:"h-[35px] max-h-[35px] hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>{try{B&&i&&B({type:"membership",title:`Membership: ${i.membershipType||"Unknown"}`,data:i,rawData:m.filter(a=>a.cleanedProduct===i.membershipType)||[]})}catch{}},children:[e.jsx(h,{className:"font-medium h-[35px] py-2",children:e.jsx("span",{className:"truncate max-w-[200px] block",children:i.membershipType})}),e.jsx(h,{className:"h-[35px] py-2",children:e.jsx(v,{variant:"secondary",children:i.category})}),e.jsx(h,{className:"h-[35px] py-2",children:e.jsx(v,{variant:"destructive",children:M(i.count)})}),e.jsx(h,{className:"h-[35px] py-2",children:M(i.uniqueMembers)}),e.jsx(h,{className:"h-[35px] py-2",children:M(i.uniqueLocations)}),e.jsx(h,{className:"h-[35px] py-2",children:e.jsx(v,{variant:"outline",children:(i.avgCancellationsPerMember||0).toFixed(1)})}),e.jsx(h,{className:"h-[35px] py-2",children:ge(i.revenue||0)})]},l))})]})}),e.jsx(se,{}),e.jsx(le,{tableId:"late-cancel-by-membership",tableName:"Cancellations by Membership Type",tableContext:"Late cancellations grouped by membership type",tableData:ee,tableColumns:[{header:"Membership Type",key:"membershipType",type:"text"},{header:"Category",key:"category",type:"text"},{header:"Cancellations",key:"count",type:"number"},{header:"Members",key:"uniqueMembers",type:"number"},{header:"Locations",key:"uniqueLocations",type:"number"},{header:"Avg per Member",key:"avgCancellationsPerMember",type:"number"},{header:"Revenue Impact",key:"revenue",type:"currency"}]})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No membership type data available"})]}),c=()=>{const i=x.useMemo(()=>{if(!m||m.length===0)return[];const a=m.reduce((s,t)=>{const o=t.teacherName||"Unknown Trainer";return s[o]||(s[o]={trainerName:o,count:0,members:new Set,locations:new Set,classes:new Set,revenue:0,avgCancellationsPerSession:0,totalSessions:0}),s[o].count+=1,s[o].members.add(t.memberId),s[o].locations.add(t.location),s[o].classes.add(t.cleanedClass),s[o].revenue+=t.paidAmount||0,s[o].totalSessions+=1,s},{});return Object.values(a).map(s=>({...s,uniqueMembers:s.members.size,uniqueLocations:s.locations.size,uniqueClasses:s.classes.size,avgCancellationsPerSession:s.totalSessions>0?s.count/s.totalSessions:0})).sort((s,t)=>t.count-s.count)},[m]),l=A(i);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-green-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cancellations by Trainer"}),e.jsxs(v,{variant:"outline",className:"bg-green-50 text-green-700",children:[i.length," trainers"]})]})}),l.length>0?e.jsxs(e.Fragment,{children:[e.jsx(g,{children:e.jsxs(ae,{children:[e.jsx(te,{children:e.jsxs($,{className:"h-[35px]",children:[e.jsx(u,{children:"Trainer Name"}),e.jsx(u,{children:"Cancellations"}),e.jsx(u,{children:"Affected Members"}),e.jsx(u,{children:"Classes"}),e.jsx(u,{children:"Locations"}),e.jsx(u,{children:"Revenue Impact"}),e.jsx(u,{children:"Avg per Session"})]})}),e.jsx(ne,{children:l.map((a,s)=>e.jsxs($,{className:"h-[35px] max-h-[35px] hover:bg-gray-50 cursor-pointer",onClick:()=>{try{B&&a&&B({type:"trainer",title:`Trainer: ${a.trainerName}`,data:a,rawData:m.filter(t=>t.teacherName===a.trainerName)||[]})}catch{}},children:[e.jsx(h,{className:"font-medium h-[35px] py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:a.trainerName.split(" ").map(t=>t[0]).join("").slice(0,2)}),e.jsx("span",{className:"truncate max-w-[120px]",children:a.trainerName})]})}),e.jsx(h,{className:"h-[35px] py-2",children:e.jsx(v,{variant:"destructive",children:M(a.count)})}),e.jsx(h,{className:"h-[35px] py-2",children:M(a.uniqueMembers)}),e.jsx(h,{className:"h-[35px] py-2",children:M(a.uniqueClasses)}),e.jsx(h,{className:"h-[35px] py-2",children:M(a.uniqueLocations)}),e.jsx(h,{className:"h-[35px] py-2",children:Je(a.revenue||0)}),e.jsx(h,{className:"h-[35px] py-2",children:e.jsx("span",{className:"font-medium text-slate-700",children:a.avgCancellationsPerSession.toFixed(1)})})]},s))})]})}),e.jsx(se,{}),e.jsx(le,{tableId:"late-cancel-by-trainer",tableName:"Cancellations by Trainer",tableContext:"Late cancellations grouped by trainer with member and class counts",tableData:l,tableColumns:[{header:"Trainer",key:"trainerName",type:"text"},{header:"Cancellations",key:"count",type:"number"},{header:"Members",key:"uniqueMembers",type:"number"},{header:"Classes",key:"uniqueClasses",type:"number"},{header:"Locations",key:"uniqueLocations",type:"number"},{header:"Revenue Impact",key:"revenue",type:"currency"},{header:"Avg per Session",key:"avgCancellationsPerSession",type:"number"}]})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No trainer data available"})]})},r=()=>{const i=x.useMemo(()=>{if(!m||m.length===0)return[];const a=m.reduce((s,t)=>{const o=t.location||"Unknown Location";if(s[o]||(s[o]={locationName:o,count:0,members:new Set,trainers:new Set,classes:new Set,revenue:0,peakDays:{},peakTimes:{}}),s[o].count+=1,s[o].members.add(t.memberId),s[o].trainers.add(t.teacherName),s[o].classes.add(t.cleanedClass),s[o].revenue+=t.paidAmount||0,t.dayOfWeek&&(s[o].peakDays[t.dayOfWeek]=(s[o].peakDays[t.dayOfWeek]||0)+1),t.time){const n=parseInt(t.time.split(":")[0]),w=n<12?"Morning":n<17?"Afternoon":"Evening";s[o].peakTimes[w]=(s[o].peakTimes[w]||0)+1}return s},{});return Object.values(a).map(s=>{const t=Object.entries(s.peakDays).reduce((n,w)=>s.peakDays[n[0]]>s.peakDays[w[0]]?n:w,["N/A",0])[0],o=Object.entries(s.peakTimes).reduce((n,w)=>s.peakTimes[n[0]]>s.peakTimes[w[0]]?n:w,["N/A",0])[0];return{...s,uniqueMembers:s.members.size,uniqueTrainers:s.trainers.size,uniqueClasses:s.classes.size,peakDay:t,peakTime:o,avgRevenuePerCancellation:s.count>0?s.revenue/s.count:0}}).sort((s,t)=>t.count-s.count)},[m]),l=A(i);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-indigo-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cancellations by Location"}),e.jsxs(v,{variant:"outline",className:"bg-indigo-50 text-indigo-700",children:[i.length," locations"]})]})}),l.length>0?e.jsxs(e.Fragment,{children:[e.jsx(g,{children:e.jsxs(ae,{children:[e.jsx(te,{children:e.jsxs($,{className:"h-[35px]",children:[e.jsx(u,{children:"Location"}),e.jsx(u,{children:"Cancellations"}),e.jsx(u,{children:"Members"}),e.jsx(u,{children:"Trainers"}),e.jsx(u,{children:"Classes"}),e.jsx(u,{children:"Peak Day"}),e.jsx(u,{children:"Peak Time"}),e.jsx(u,{children:"Revenue Impact"})]})}),e.jsx(ne,{children:l.map((a,s)=>e.jsxs($,{className:"h-[35px] max-h-[35px] hover:bg-gray-50 cursor-pointer",onClick:()=>{try{B&&a&&B({type:"location",title:`Location: ${a.locationName}`,data:a,rawData:m.filter(t=>t.location===a.locationName)||[]})}catch{}},children:[e.jsx(h,{className:"font-medium h-[35px] py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4 text-indigo-600"}),e.jsx("span",{className:"truncate max-w-[150px]",children:a.locationName})]})}),e.jsx(h,{className:"h-[35px] py-2",children:e.jsx(v,{variant:"destructive",children:M(a.count)})}),e.jsx(h,{className:"h-[35px] py-2",children:M(a.uniqueMembers)}),e.jsx(h,{className:"h-[35px] py-2",children:M(a.uniqueTrainers)}),e.jsx(h,{className:"h-[35px] py-2",children:M(a.uniqueClasses)}),e.jsx(h,{className:"h-[35px] py-2",children:e.jsx(v,{variant:"outline",children:a.peakDay})}),e.jsx(h,{className:"h-[35px] py-2",children:e.jsx(v,{variant:"outline",children:a.peakTime})}),e.jsx(h,{className:"h-[35px] py-2",children:ge(a.revenue||0)})]},s))})]})}),e.jsx(se,{}),e.jsx(le,{tableId:"late-cancel-by-location",tableName:"Cancellations by Location",tableContext:"Late cancellations grouped by studio location",tableData:l,tableColumns:[{header:"Location",key:"locationName",type:"text"},{header:"Cancellations",key:"count",type:"number"},{header:"Members",key:"uniqueMembers",type:"number"},{header:"Trainers",key:"uniqueTrainers",type:"number"},{header:"Classes",key:"uniqueClasses",type:"number"},{header:"Peak Day",key:"peakDay",type:"text"},{header:"Peak Time",key:"peakTime",type:"text"},{header:"Revenue Impact",key:"revenue",type:"currency"}]})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No location data available"})]})},S=x.useMemo(()=>{const i=m.reduce((l,a)=>{const s=a.teacherName||"Unknown Trainer";return l[s]||(l[s]={trainerName:s,count:0,members:new Set,locations:new Set,classes:new Set,revenue:0}),l[s].count+=1,l[s].members.add(a.memberId),l[s].locations.add(a.location),l[s].classes.add(a.cleanedClass),l[s].revenue+=a.paidAmount||0,l},{});return Object.values(i).map(l=>({trainerName:l.trainerName,count:l.count,uniqueMembers:l.members.size,uniqueLocations:l.locations.size,uniqueClasses:l.classes.size,revenue:l.revenue})).sort((l,a)=>a.count-l.count)},[m]),W=x.useMemo(()=>{const i=m.reduce((l,a)=>{const s=a.location||"Unknown Location";if(l[s]||(l[s]={locationName:s,count:0,members:new Set,trainers:new Set,classes:new Set,revenue:0,peakDays:{},peakTimes:{}}),l[s].count+=1,l[s].members.add(a.memberId),l[s].trainers.add(a.teacherName),l[s].classes.add(a.cleanedClass),l[s].revenue+=a.paidAmount||0,a.dayOfWeek&&(l[s].peakDays[a.dayOfWeek]=(l[s].peakDays[a.dayOfWeek]||0)+1),a.time){const t=parseInt(a.time.split(":")[0]),o=t<12?"Morning":t<17?"Afternoon":"Evening";l[s].peakTimes[o]=(l[s].peakTimes[o]||0)+1}return l},{});return Object.values(i).map(l=>{const a=Object.entries(l.peakDays).reduce((t,o)=>l.peakDays[t[0]]>l.peakDays[o[0]]?t:o,["N/A",0])[0],s=Object.entries(l.peakTimes).reduce((t,o)=>l.peakTimes[t[0]]>l.peakTimes[o[0]]?t:o,["N/A",0])[0];return{locationName:l.locationName,count:l.count,uniqueMembers:l.members.size,uniqueTrainers:l.trainers.size,uniqueClasses:l.classes.size,peakDay:a,peakTime:s,revenue:l.revenue}}).sort((l,a)=>a.count-l.count)},[m]),z=x.useCallback(()=>{const i=[],l=new Date().toLocaleString();i.push(`Enhanced Late Cancellations Analysis - All Tabs Export
Exported: ${l}`),i.push("=".repeat(80));const a=(n,w,D)=>{i.push(`
=== ${n} ===`),i.push(w.join("	")),i.push(w.map(()=>"---").join("	")),D.forEach(V=>i.push(V.map(ce=>ce==null?"":String(ce)).join("	")))};L.length&&a("Members with Multiple Same-Day Late Cancellations",["Member","Email","Date","Cancellation Count","Unique Locations","Unique Formats","Unique Specific Classes","Unique Trainers"],L.map(n=>[n.memberName,n.email,n.date,n.count,n.uniqueLocations,n.uniqueClasses,n.uniqueSpecificClasses,n.uniqueTrainers])),f.length&&a("Members with Multiple Same-Day Check-ins",["Member","Email","Date","Check-ins"],f.map(n=>[n.memberName,n.email,n.date,n.totalSessions])),R.length&&a("Members with Multiple Same-Day Bookings",["Member","Email","Date","Bookings"],R.map(n=>[n.memberName,n.email,n.date,n.totalBookings])),b.length&&a("Cancellations by Class Format",["Class","Category","Cancellations","Unique Members","Unique Locations","Unique Trainers","Avg Duration","Avg Revenue","Peak Day","Peak Time"],b.map(n=>[n.className,n.category,n.count,n.uniqueMembers,n.uniqueLocations,n.uniqueTrainers,n.avgDuration,n.avgRevenue?.toFixed?.(2)??n.avgRevenue,n.peakDay,n.peakTime])),y.length&&a("Cancellations by Membership Type",["Membership","Category","Cancellations","Unique Members","Unique Locations","Unique Classes","Revenue Impact","Avg Revenue/Cancellation","Avg Cancellations/Member"],y.map(n=>[n.membershipType,n.category,n.count,n.uniqueMembers,n.uniqueLocations,n.uniqueClasses,n.revenue?.toFixed?.(2)??n.revenue,n.avgRevenuePerCancellation?.toFixed?.(2)??n.avgRevenuePerCancellation,n.avgCancellationsPerMember?.toFixed?.(2)??n.avgCancellationsPerMember])),S.length&&a("Cancellations by Trainer",["Trainer","Cancellations","Unique Members","Unique Locations","Unique Classes","Revenue Impact"],S.map(n=>[n.trainerName,n.count,n.uniqueMembers,n.uniqueLocations,n.uniqueClasses,n.revenue?.toFixed?.(2)??n.revenue])),W.length&&a("Cancellations by Location",["Location","Cancellations","Unique Members","Unique Trainers","Unique Classes","Peak Day","Peak Time","Revenue Impact"],W.map(n=>[n.locationName,n.count,n.uniqueMembers,n.uniqueTrainers,n.uniqueClasses,n.peakDay,n.peakTime,n.revenue?.toFixed?.(2)??n.revenue])),I.length&&a("Top Repeat Cancellers (Members)",["Member","Email","Cancellations","Unique Locations","Unique Classes","Unique Trainers"],I.map(n=>[n.memberName,n.email,n.count,n.uniqueLocations,n.uniqueClasses,n.uniqueTrainers]));const{buckets:s=[],byFormat:t=[],byMembership:o=[]}=C||{};if(s.length){const n=m.reduce((D,V)=>{const ce=V.memberId||V.email||"unknown";return D[ce]=(D[ce]||0)+1,D},{}),w=s.map(D=>[D.label,Object.values(n).filter(V=>V>=D.min&&V<=D.max).length]);a("Visit Frequency Buckets (Overall)",["Bucket","Members"],w),t.length&&a("Visit Frequency by Format",["Format","Members","Revenue",...s.map(D=>D.label)],t.map(D=>[D.format,D.members,D.revenue?.toFixed?.(2)??D.revenue,...s.map(V=>D[V.label]||0)])),o.length&&a("Visit Frequency by Membership",["Membership","Members","Revenue",...s.map(D=>D.label)],o.map(D=>[D.membership,D.members,D.revenue?.toFixed?.(2)??D.revenue,...s.map(V=>D[V.label]||0)]))}return i.join(`
`)},[L,f,R,b,y,S,W,I,C,m]);return he.useEffect(()=>{if(K)return K.register({id:"Enhanced Late Cancellations Analysis (All Tabs)",getTextContent:z}),()=>K.unregister("Enhanced Late Cancellations Analysis (All Tabs)")},[K,z]),e.jsxs(pe,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(we,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ke,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-red-600"}),"Enhanced Late Cancellations Analysis",e.jsx(v,{variant:"outline",className:"bg-blue-50 text-blue-700 min-w-[180px] justify-center",children:"Multiple analysis views with 35px row height"})]}),e.jsx(xs,{tableRef:_,tableName:"Enhanced Late Cancellations (Active Tab)",size:"sm",onCopyAllTabs:async()=>z()})]})}),e.jsx(be,{className:"p-0",children:e.jsxs(Ee,{value:X,onValueChange:P,children:[e.jsx("div",{className:"px-6",children:e.jsxs(We,{className:"bg-white/90 backdrop-blur-sm p-2 rounded-2xl shadow-xl border-0 grid grid-cols-9 w-full max-w-7xl min-h-16 overflow-hidden mb-6",children:[e.jsxs(G,{value:"multiple-day",className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),"Multiple/Day"]}),e.jsxs(G,{value:"multiple-checkins",className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Check-ins/Day"]}),e.jsxs(G,{value:"multiple-bookings",className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Bookings/Day"]}),e.jsxs(G,{value:"by-class",className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"By Format"]}),e.jsxs(G,{value:"by-membership",className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),"By Membership"]}),e.jsxs(G,{value:"by-trainer",className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"By Trainer"]}),e.jsxs(G,{value:"by-location",className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"By Location"]}),e.jsxs(G,{value:"top-cancellers",className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),"Top Cancellers"]}),e.jsxs(G,{value:"visit-frequency",className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Visit Frequency"]}),e.jsxs(G,{value:"by-specific-class",className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"By Class (Specific)"]})]})}),e.jsx(Q,{value:"multiple-day",className:"mt-0",children:me(ee,"Members with Multiple Late Cancellations per Day","multiple-day")}),e.jsx(Q,{value:"multiple-checkins",className:"mt-0",children:O(E,"Check-ins per Day","late-cancel-checkins-per-day")}),e.jsx(Q,{value:"multiple-bookings",className:"mt-0",children:O(J,"Bookings per Day","late-cancel-bookings-per-day")}),e.jsx(Q,{value:"by-class",className:"mt-0",children:De()}),e.jsx(Q,{value:"by-membership",className:"mt-0",children:d()}),e.jsx(Q,{value:"by-trainer",className:"mt-0",children:c()}),e.jsx(Q,{value:"by-location",className:"mt-0",children:r()}),e.jsx(Q,{value:"top-cancellers",className:"mt-0",children:me(ee,"Top Repeat Cancellers (Members)","top-cancellers")}),e.jsx(Q,{value:"visit-frequency",className:"mt-0",children:(()=>{const{buckets:i=[],byFormat:l=[],byMembership:a=[]}=C||{},s=t=>t.reduce((o,n)=>o+n.members,0);return e.jsxs("div",{className:"space-y-10",children:[(()=>{const t=m.reduce((n,w)=>{const D=w.memberId||w.email||"unknown";return n[D]=(n[D]||0)+1,n},{}),o=i.map(n=>({bucket:n.label,members:Object.values(t).filter(w=>w>=n.min&&w<=n.max).length}));return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-slate-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Visit Frequency Buckets"}),e.jsxs(v,{variant:"outline",className:"bg-slate-50 text-slate-700 min-w-[140px] justify-center",children:[o.reduce((n,w)=>n+w.members,0)," members"]})]})}),e.jsx(g,{children:e.jsxs(ae,{children:[e.jsx(te,{children:e.jsxs($,{children:[e.jsx(u,{children:"Visits (per period)"}),e.jsx(u,{children:"Members"})]})}),e.jsx(ne,{children:o.map((n,w)=>e.jsxs($,{children:[e.jsx(h,{className:"font-medium",children:n.bucket}),e.jsx(h,{children:M(n.members)})]},w))})]})}),e.jsx(le,{tableId:"late-cancel-visit-frequency",tableName:"Visit Frequency Buckets",tableContext:"Distribution of member late cancellations by visit count within the selected timeframe",tableData:o,tableColumns:[{header:"Bucket",key:"bucket",type:"text"},{header:"Members",key:"members",type:"number"}]})]})})(),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Visit Frequency by Format"}),e.jsxs(v,{variant:"outline",className:"bg-blue-50 text-blue-700 min-w-[140px] justify-center",children:[s(l)," members"]})]})}),e.jsx(g,{children:e.jsxs(ae,{children:[e.jsx(te,{children:e.jsxs($,{children:[e.jsx(u,{children:"Format"}),i.map(t=>e.jsx(u,{children:t.label},t.label)),e.jsx(u,{children:"Total Members"}),e.jsx(u,{children:"Total Revenue"})]})}),e.jsx(ne,{children:l.map((t,o)=>e.jsxs($,{children:[e.jsx(h,{className:"font-medium",children:t.format}),i.map(n=>e.jsx(h,{children:M(t[n.label]||0)},n.label)),e.jsx(h,{children:M(t.members)}),e.jsx(h,{children:ge(t.revenue||0)})]},o))})]})}),e.jsx(le,{tableId:"late-cancel-visit-frequency-format",tableName:"Visit Frequency by Format",tableContext:"Members bucketed by visit frequency grouped by class format",tableData:l,tableColumns:[{header:"Format",key:"format",type:"text"},...i.map(t=>({header:t.label,key:t.label,type:"number"})),{header:"Members",key:"members",type:"number"},{header:"Revenue",key:"revenue",type:"currency"}]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-purple-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Visit Frequency by Membership"}),e.jsxs(v,{variant:"outline",className:"bg-purple-50 text-purple-700 min-w-[140px] justify-center",children:[s(a)," members"]})]})}),e.jsx(g,{children:e.jsxs(ae,{children:[e.jsx(te,{children:e.jsxs($,{children:[e.jsx(u,{children:"Membership"}),i.map(t=>e.jsx(u,{children:t.label},t.label)),e.jsx(u,{children:"Total Members"}),e.jsx(u,{children:"Total Revenue"})]})}),e.jsx(ne,{children:a.map((t,o)=>e.jsxs($,{children:[e.jsx(h,{className:"font-medium",children:t.membership}),i.map(n=>e.jsx(h,{children:M(t[n.label]||0)},n.label)),e.jsx(h,{children:M(t.members)}),e.jsx(h,{children:ge(t.revenue||0)})]},o))})]})}),e.jsx(le,{tableId:"late-cancel-visit-frequency-membership",tableName:"Visit Frequency by Membership",tableContext:"Members bucketed by visit frequency grouped by membership type",tableData:a,tableColumns:[{header:"Membership",key:"membership",type:"text"},...i.map(t=>({header:t.label,key:t.label,type:"number"})),{header:"Members",key:"members",type:"number"},{header:"Revenue",key:"revenue",type:"currency"}]})]})]})})()}),e.jsx(Q,{value:"by-specific-class",className:"mt-0",children:qe()})]})})]})};function Ts({selectedLocation:m,onLocationChange:k,selectedTimeframe:B,onTimeframeChange:K,selectedTrainer:_,onTrainerChange:g,selectedClass:X,onClassChange:P,selectedProduct:U,onProductChange:j,selectedTimeSlot:N,onTimeSlotChange:q,dateRange:L,onDateRangeChange:f,data:R,onClearFilters:E}){const[J,O]=x.useState(!1),C=he.useMemo(()=>Array.from(new Set(R.map(p=>p.location).filter(Boolean))),[R]),b=he.useMemo(()=>Array.from(new Set(R.map(p=>p.teacherName).filter(Boolean))),[R]),y=he.useMemo(()=>Array.from(new Set(R.map(p=>p.cleanedClass).filter(Boolean))),[R]),I=he.useMemo(()=>Array.from(new Set(R.map(p=>p.cleanedProduct).filter(Boolean))),[R]),A=[{value:"all",label:"All Time"},{value:"prev-month",label:"Previous Month"},{value:"1w",label:"Last Week"},{value:"2w",label:"Last 2 Weeks"},{value:"1m",label:"Last Month"},{value:"3m",label:"Last 3 Months"},{value:"6m",label:"Last 6 Months"},{value:"1y",label:"Last 12 Months"},{value:"custom",label:"Custom Range"}],Z=[{value:"all",label:"All Time Slots"},{value:"morning",label:"Morning (6-12)"},{value:"afternoon",label:"Afternoon (12-17)"},{value:"evening",label:"Evening (17-22)"},{value:"late",label:"Late Night (22+)"}],T=[m!=="all",B!=="all",_!=="all",X!=="all",U!=="all",N!=="all",L.start||L.end].filter(Boolean).length;return J?e.jsxs(pe,{className:"bg-gradient-to-br from-white via-red-50/30 to-white border-0 shadow-xl overflow-hidden",children:[e.jsx(we,{className:"bg-gradient-to-r from-red-600 to-orange-600 text-white",children:e.jsxs(ke,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ze,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Advanced Filters"}),e.jsx("p",{className:"text-red-100 text-sm",children:"Customize your late cancellations analysis"})]}),e.jsxs(v,{className:"bg-white/20 text-white border-white/30",children:[T," Active"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(H,{variant:"outline",size:"sm",onClick:E,disabled:T===0,className:"bg-white/10 border-white/30 text-white hover:bg-white/20",children:[e.jsx(He,{className:"w-4 h-4 mr-1"}),"Reset"]}),e.jsx(H,{variant:"ghost",size:"sm",onClick:()=>O(!1),className:"text-white hover:bg-white/20",children:e.jsx(bs,{className:"w-4 h-4"})})]})]})}),e.jsxs(be,{className:"p-8 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsx("h4",{className:"text-lg font-semibold text-slate-800",children:"Filter Options"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(de,{htmlFor:"location-select",className:"text-slate-700 flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),"Location"]}),e.jsxs(je,{value:m,onValueChange:k,children:[e.jsx(fe,{id:"location-select",className:"bg-white border-slate-200",children:e.jsx(ye,{placeholder:"Select location"})}),e.jsxs(Ne,{className:"bg-white border-slate-200",children:[e.jsx(re,{value:"all",children:"All Locations"}),C.map(p=>e.jsx(re,{value:p,children:p},p))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(de,{htmlFor:"timeframe-select",className:"text-slate-700 flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Timeframe"]}),e.jsxs(je,{value:B,onValueChange:K,children:[e.jsx(fe,{id:"timeframe-select",className:"bg-white border-slate-200",children:e.jsx(ye,{placeholder:"Select timeframe"})}),e.jsx(Ne,{className:"bg-white border-slate-200",children:A.map(p=>e.jsx(re,{value:p.value,children:p.label},p.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(de,{htmlFor:"trainer-select",className:"text-slate-700 flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Trainer"]}),e.jsxs(je,{value:_,onValueChange:g,children:[e.jsx(fe,{id:"trainer-select",className:"bg-white border-slate-200",children:e.jsx(ye,{placeholder:"Select trainer"})}),e.jsxs(Ne,{className:"bg-white border-slate-200",children:[e.jsx(re,{value:"all",children:"All Trainers"}),b.map(p=>e.jsx(re,{value:p,children:p},p))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(de,{htmlFor:"class-select",className:"text-slate-700 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"Class Type"]}),e.jsxs(je,{value:X,onValueChange:P,children:[e.jsx(fe,{id:"class-select",className:"bg-white border-slate-200",children:e.jsx(ye,{placeholder:"Select class"})}),e.jsxs(Ne,{className:"bg-white border-slate-200",children:[e.jsx(re,{value:"all",children:"All Classes"}),y.map(p=>e.jsx(re,{value:p,children:p},p))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(de,{htmlFor:"product-select",className:"text-slate-300 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"Product Type"]}),e.jsxs(je,{value:U,onValueChange:j,children:[e.jsx(fe,{id:"product-select",className:"bg-slate-800 border-slate-600 text-white",children:e.jsx(ye,{placeholder:"Select product"})}),e.jsxs(Ne,{className:"bg-slate-800 border-slate-600",children:[e.jsx(re,{value:"all",className:"text-white hover:bg-slate-700",children:"All Products"}),I.map(p=>e.jsx(re,{value:p,className:"text-white hover:bg-slate-700",children:p},p))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(de,{htmlFor:"timeslot-select",className:"text-slate-300 flex items-center gap-2",children:[e.jsx(ys,{className:"w-4 h-4"}),"Time Slot"]}),e.jsxs(je,{value:N,onValueChange:q,children:[e.jsx(fe,{id:"timeslot-select",className:"bg-slate-800 border-slate-600 text-white",children:e.jsx(ye,{placeholder:"Select time slot"})}),e.jsx(Ne,{className:"bg-slate-800 border-slate-600",children:Z.map(p=>e.jsx(re,{value:p.value,className:"text-white hover:bg-slate-700",children:p.label},p.value))})]})]}),B==="custom"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(de,{htmlFor:"start-date",className:"text-slate-700",children:"Start Date"}),e.jsx(Be,{id:"start-date",type:"date",value:L.start,onChange:p=>f({...L,start:p.target.value}),className:"bg-white border-slate-200"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(de,{htmlFor:"end-date",className:"text-slate-700",children:"End Date"}),e.jsx(Be,{id:"end-date",type:"date",value:L.end,onChange:p=>f({...L,end:p.target.value}),className:"bg-white border-slate-200"})]})]})]})]})]}):e.jsx(pe,{className:"bg-gradient-to-br from-white via-red-50/30 to-white border-0 shadow-xl",children:e.jsx(be,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-red-500 to-orange-500 rounded-lg",children:e.jsx(ze,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-800",children:"Advanced Filters"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Refine your late cancellations analysis"})]}),T>0&&e.jsxs(v,{className:"bg-gradient-to-r from-red-600 to-orange-600 text-white",children:[T," active"]})]}),e.jsxs(H,{variant:"outline",onClick:()=>O(!0),className:"gap-2 border-red-200 text-red-700 hover:bg-red-50",children:[e.jsx(fs,{className:"w-4 h-4"}),"Expand Filters"]})]})})})}const ja=()=>{const{data:m,allCheckins:k,loading:B}=Xe(),{isLoading:K,setLoading:_}=Ge();Ye();const[g,X]=x.useState("kwality"),[P,U]=x.useState("prev-month"),[j,N]=x.useState("all"),[q,L]=x.useState("all"),[f,R]=x.useState("all"),[E,J]=x.useState("all"),[O,C]=x.useState({start:"",end:""}),[b,y]=x.useState(null),[I,A]=x.useState(!1);x.useMemo(()=>{const d=Array.isArray(m)&&m.length>0?m:Array.isArray(k)?k:[];if(d.length===0)return[{id:"all",name:"All Locations"},{id:"kwality",name:"Kwality House"},{id:"supreme",name:"Supreme HQ"},{id:"kenkere",name:"Kenkere House"}];const c=Array.from(new Set(d.map(r=>r?.location).filter(Boolean)));return[{id:"all",name:"All Locations"},{id:"kwality",name:"Kwality House"},{id:"supreme",name:"Supreme HQ"},{id:"kenkere",name:"Kenkere House"},{id:"popup",name:"Pop-up"}].filter(r=>r.id==="all"||c.some(S=>r.id==="kwality"?S.includes("Kwality"):r.id==="supreme"?S.includes("Supreme"):r.id==="kenkere"?S.includes("Kenkere"):r.id==="popup"?S.includes("Pop")||S.includes("Pop-up")||S.includes("Popup"):!1))},[m,k]);const Z=d=>{if(!d)return null;let c;if(d.includes("-"))c=new Date(d);else if(d.includes("/")){const r=d.split("/");if(r.length===3)c=new Date(parseInt(r[2]),parseInt(r[1])-1,parseInt(r[0]));else return null}else return null;return c.setHours(0,0,0,0),c},T=d=>{const c=new Date(d);return c.setHours(0,0,0,0),c},p=x.useMemo(()=>{if(!Array.isArray(m))return[];let d=m;if(g!=="all"&&(d=d.filter(c=>{const r=(c?.location||"").toString().toLowerCase();return g==="kwality"?r.includes("kwality")||r.includes("kemps"):g==="supreme"?r.includes("supreme")||r.includes("bandra"):g==="kenkere"?r.includes("kenkere"):g==="popup"?r.includes("pop")||r.includes("popup")||r.includes("pop-up"):!0})),j!=="all"&&(d=d.filter(c=>c?.teacherName===j)),q!=="all"&&(d=d.filter(c=>c?.cleanedClass===q)),f!=="all"&&(d=d.filter(c=>c?.cleanedProduct===f)),E!=="all"&&(d=d.filter(c=>{if(!c?.time)return!1;const r=parseInt(c.time.split(":")[0]);switch(E){case"morning":return r>=6&&r<12;case"afternoon":return r>=12&&r<17;case"evening":return r>=17&&r<22;case"late":return r>=22||r<6;default:return!0}})),P!=="all"){const c=new Date;let r=new Date,S=new Date;switch(P){case"1w":r.setDate(c.getDate()-7),r=T(r),S=T(c);break;case"2w":r.setDate(c.getDate()-14),r=T(r),S=T(c);break;case"1m":r.setMonth(c.getMonth()-1),r=T(r),S=T(c);break;case"prev-month":return r=new Date(c.getFullYear(),c.getMonth()-1,1),r.setHours(0,0,0,0),S=new Date(c.getFullYear(),c.getMonth(),0),S.setHours(0,0,0,0),d=d.filter(W=>{const z=Z(W?.dateIST);return z?z>=r&&z<=S:!1}),d;case"3m":r.setMonth(c.getMonth()-3),r=T(r),S=T(c);break;case"6m":r.setMonth(c.getMonth()-6),r=T(r),S=T(c);break;case"1y":r.setFullYear(c.getFullYear()-1),r=T(r),S=T(c);break;case"custom":if(O.start||O.end){const W=O.start?T(new Date(O.start)):new Date("2020-01-01"),z=O.end?T(new Date(O.end)):T(c);d=d.filter(i=>{const l=Z(i?.dateIST);return l?l>=W&&l<=z:!1})}return d;default:return d}d=d.filter(W=>{const z=Z(W?.dateIST);return z?z>=r&&z<=S:!1})}return d},[m,g,P,j,q,f,E,O]),ee=()=>{U("prev-month"),N("all"),L("all"),R("all"),J("all"),C({start:"",end:""})},ie=d=>{y(d),A(!0)},se=x.useMemo(()=>{if(!Array.isArray(m))return[];let d=m;return g!=="all"&&(d=d.filter(c=>{const r=(c?.location||"").toString().toLowerCase();return g==="kwality"?r.includes("kwality")||r.includes("kemps"):g==="supreme"?r.includes("supreme")||r.includes("bandra"):g==="kenkere"?r.includes("kenkere"):g==="popup"?r.includes("pop")||r.includes("popup")||r.includes("pop-up"):!0})),j!=="all"&&(d=d.filter(c=>c?.teacherName===j)),q!=="all"&&(d=d.filter(c=>c?.cleanedClass===q)),f!=="all"&&(d=d.filter(c=>c?.cleanedProduct===f)),E!=="all"&&(d=d.filter(c=>{if(!c?.time)return!1;const r=parseInt(c.time.split(":")[0]);switch(E){case"morning":return r>=6&&r<12;case"afternoon":return r>=12&&r<17;case"evening":return r>=17&&r<22;case"late":return r>=22||r<6;default:return!0}})),d},[m,g,j,q,f,E]),me=x.useMemo(()=>{if(!Array.isArray(k))return[];let d=k;if(g!=="all"&&(d=d.filter(c=>{const r=c?.location||"";return g==="kwality"?r.includes("Kwality"):g==="supreme"?r.includes("Supreme"):g==="kenkere"?r.includes("Kenkere"):!0})),j!=="all"&&(d=d.filter(c=>c?.teacherName===j)),q!=="all"&&(d=d.filter(c=>c?.cleanedClass===q)),f!=="all"&&(d=d.filter(c=>c?.cleanedProduct===f)),E!=="all"&&(d=d.filter(c=>{if(!c?.time)return!1;const r=parseInt(c.time.split(":")[0]);switch(E){case"morning":return r>=6&&r<12;case"afternoon":return r>=12&&r<17;case"evening":return r>=17&&r<22;case"late":return r>=22||r<6;default:return!0}})),P!=="all"){const c=new Date;let r=new Date,S=new Date;switch(P){case"1w":r.setDate(c.getDate()-7),r=T(r),S=T(c);break;case"2w":r.setDate(c.getDate()-14),r=T(r),S=T(c);break;case"1m":r.setMonth(c.getMonth()-1),r=T(r),S=T(c);break;case"prev-month":return r=new Date(c.getFullYear(),c.getMonth()-1,1),r.setHours(0,0,0,0),S=new Date(c.getFullYear(),c.getMonth(),0),S.setHours(0,0,0,0),d=d.filter(W=>{const z=Z(W?.dateIST);return z?z>=r&&z<=S:!1}),d;case"3m":r.setMonth(c.getMonth()-3),r=T(r),S=T(c);break;case"6m":r.setMonth(c.getMonth()-6),r=T(r),S=T(c);break;case"1y":r.setFullYear(c.getFullYear()-1),r=T(r),S=T(c);break;case"custom":{if(O.start||O.end){const W=O.start?T(new Date(O.start)):new Date("2020-01-01"),z=O.end?T(new Date(O.end)):T(c);d=d.filter(i=>{const l=Z(i?.dateIST);return l?l>=W&&l<=z:!1})}return d}}d=d.filter(W=>{const z=Z(W?.dateIST);return z?z>=r&&z<=S:!1})}return d},[k,g,j,q,f,E,P,O]),De=x.useMemo(()=>!p||p.length===0?!me||me.length===0?[{location:"No Data",label:"Available",value:"—"}]:[{key:"Kwality",name:"Kwality"},{key:"Supreme",name:"Supreme"},{key:"Kenkere",name:"Kenkere"}].map(r=>{const S=me.filter(W=>W.location?.includes(r.key));return{location:r.name,label:"Total Checkins",value:M(S.length)}}):[{key:"Kwality",name:"Kwality"},{key:"Supreme",name:"Supreme"},{key:"Kenkere",name:"Kenkere"}].map(c=>{const S=p.filter(W=>W.location?.includes(c.key)).length;return{location:c.name,label:"Late Cancellations",value:M(S)}}),[p,me]);x.useEffect(()=>{_(B,"Loading late cancellations data...")},[B,_]);const qe=e.jsx(gs,{lateCancellationsData:p,defaultFileName:`late-cancellations-${g}`,size:"sm",variant:"ghost",buttonClassName:"rounded-xl border border-white/30 text-white hover:border-white/50"});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-purple-50/30 to-pink-50/20",children:[e.jsx(ws,{title:"Late Cancellations",subtitle:"Comprehensive analysis of late cancellation patterns across locations, classes, trainers, and products",metrics:De,extra:qe}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"container mx-auto px-6 py-8",children:[e.jsx(rs,{activeLocation:g,onLocationChange:X,className:"mb-8"}),e.jsxs("div",{className:"space-y-8",children:[m.length===0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 text-center",children:[e.jsx("p",{className:"text-blue-900 font-medium",children:"No late cancellations recorded in the selected period."}),e.jsx("p",{className:"text-blue-700 text-sm mt-2",children:"Showing all checkins for reference. Adjust filters to view different date ranges."})]}),e.jsx(Ts,{selectedLocation:"all",onLocationChange:()=>{},selectedTimeframe:P,onTimeframeChange:U,selectedTrainer:j,onTrainerChange:N,selectedClass:q,onClassChange:L,selectedProduct:f,onProductChange:R,selectedTimeSlot:E,onTimeSlotChange:J,dateRange:O,onDateRangeChange:C,data:m,onClearFilters:ee}),e.jsx(_e,{data:p,onMetricClick:ie}),e.jsx(ks,{data:se}),e.jsx(Cs,{data:p}),e.jsx(Qe,{data:se,onRowClick:ie}),e.jsx(Ms,{data:p,allCheckins:me,onDrillDown:ie})]})]})}),e.jsx(vs,{isOpen:I,onClose:()=>A(!1),data:b}),e.jsx(Ns,{})]})};export{ja as default};
//# sourceMappingURL=LateCancellations-DCdRkoMT.js.map
