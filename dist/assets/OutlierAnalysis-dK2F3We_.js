import{r as q,j as e,D as He,n as qe,o as Ue,q as Be,X as rt,C as x,c as h,a as P,b as E,m as B,R as Ee,B as nt,s as it,G as lt,d as ct,h as dt}from"./index-Bm67KBkU.js";import{F as ot}from"./footer-BTvMjyAb.js";import{D as mt}from"./DashboardMotionHero-C2yuh4RF.js";import{u as xt}from"./useGoogleSheets-BPVLuLVa.js";import{u as ht}from"./useSessionsData-CuS9CUZY.js";import{u as ut}from"./useCheckinsData-DGPJRptq.js";import{u as gt}from"./useExpirationsData-CHlNy1D0.js";import{u as pt}from"./useLeadsData-nt_JwR0P.js";import{u as jt}from"./useNewClientData-Dl1VV2C_.js";import{f as n,a as m,B as C,b as f,e as ke}from"./index-DkD_C-d1.js";import{T as J,a as Q,b as O,c as H}from"./tabs-BTrhdLSC.js";import{T as ge,a as pe,b as W,c as S,d as je,e as A}from"./table-DhXofKdS.js";import{S as Ne}from"./scroll-area-BKnEh-kP.js";import{T as Nt,C as X}from"./googleAuth-BGo8ElRc.js";import{T as vt}from"./tag-DzcNcJZD.js";import{S as Ce,a as bt,I as Ie}from"./SalesMotionHero-sGphstF2.js";import{D as ft,C as yt}from"./dollar-sign-CKqx8kbC.js";import{U as le}from"./user-plus-B5fZWJk_.js";import{U as ce}from"./user-check-CLHYCjic.js";import{A as wt}from"./activity-CeUP9h5f.js";import{P as ve}from"./percent-BAS2Szsf.js";import{C as z}from"./circle-alert-bpasmovd.js";import{L as be}from"./layers-QvpSwlwS.js";import{S as oe}from"./sparkles-C_y1-6_w.js";import{R as fe,C as Dt,T as ye,L as we,B as Le,a as Ve,X as Fe,Y as ze,b as De}from"./BarChart-o5Oeg9Jb.js";import{P as Ct,a as Tt}from"./PieChart-slnvMcDg.js";import{A as Mt}from"./award-D0x2LQSI.js";import{T as St}from"./trending-down-B5K1omnR.js";import{L as At}from"./LoadingSkeleton-CgB_TXJn.js";import"./index-BdQq_4o_.js";import"./skeleton-Ccx3hRRa.js";const de=(a,R,y,V,F)=>q.useMemo(()=>{const p=V==="april"?{year:2025,monthIndex:3}:{year:2025,monthIndex:7},L=new Date;L.setHours(0,0,0,0);const b=a.filter(s=>{if(!s.paymentDate)return!1;const r=new Date(s.paymentDate),l=r.getFullYear()===p.year&&r.getMonth()===p.monthIndex,o=!F||s.calculatedLocation===F;return l&&o&&s.paymentStatus==="succeeded"}),i=new Map;a.forEach(s=>{const r=s.memberId||s.customerEmail;if(!r||!s.paymentDate||s.paymentStatus!=="succeeded")return;const l=new Date(s.paymentDate),o=i.get(r);(!o||l<o)&&i.set(r,l)});const d=(s,r)=>{const l=i.get(s);if(!l)return!0;const o=l.getMonth(),g=l.getFullYear();return r.getMonth(),r.getFullYear(),o===p.monthIndex&&g===p.year?!0:l.getTime()===r.getTime()||l.toDateString()===r.toDateString()},I=s=>{if(!s.secMembershipEndDate||!s.paymentDate)return!1;const r=new Date(s.secMembershipEndDate),l=new Date(s.paymentDate);return r.setHours(0,0,0,0),l.setHours(0,0,0,0),r>=l},k=new Map;b.forEach(s=>{const r=s.memberId||s.customerEmail;r&&(k.has(r)||k.set(r,[]),k.get(r).push(s))});const u=b.reduce((s,r)=>s+(r.paymentValue||0),0);let N=0,D=0,t=0;const c=new Set,Z=new Set,Y=new Set;b.forEach(s=>{const r=s.memberId||s.customerEmail;if(!r)return;const l=new Date(s.paymentDate);d(r,l)?(N+=s.paymentValue||0,c.add(r)):(D+=s.paymentValue||0,Z.add(r)),I(s)&&(t+=s.paymentValue||0,Y.add(r))});const w={revenue:0,unitsSold:0,transactions:0,uniqueMembers:new Set,atv:0,discountedRevenue:0,nonDiscountedRevenue:0,discountedTransactions:0,nonDiscountedTransactions:0,totalDiscountAmount:0,totalDiscountPercentage:0,discountCount:0,avgDiscountPercentage:0},T={revenue:0,unitsSold:0,transactions:0,uniqueMembers:new Set,atv:0,discountedRevenue:0,nonDiscountedRevenue:0,discountedTransactions:0,nonDiscountedTransactions:0,totalDiscountAmount:0,totalDiscountPercentage:0,discountCount:0,avgDiscountPercentage:0};b.forEach(s=>{const r=s.memberId||s.customerEmail;if(!r)return;const l=new Date(s.paymentDate),o=d(r,l),g=s.discountAmount&&s.discountAmount>0||s.discountPercentage&&s.discountPercentage>0,j=o?w:T;j.revenue+=s.paymentValue||0,j.unitsSold+=1,j.transactions+=1,j.uniqueMembers.add(r),g?(j.discountedRevenue+=s.paymentValue||0,j.discountedTransactions+=1,j.totalDiscountAmount+=s.discountAmount||0,s.discountPercentage&&s.discountPercentage>0&&(j.totalDiscountPercentage+=s.discountPercentage,j.discountCount+=1)):(j.nonDiscountedRevenue+=s.paymentValue||0,j.nonDiscountedTransactions+=1)}),w.atv=w.transactions>0?w.revenue/w.transactions:0,w.avgDiscountPercentage=w.discountCount>0?w.totalDiscountPercentage/w.discountCount:0,T.atv=T.transactions>0?T.revenue/T.transactions:0,T.avgDiscountPercentage=T.discountCount>0?T.totalDiscountPercentage/T.discountCount:0;const G=new Map,me=["studio single class","private class","money-credits"];b.filter(s=>["subscription","pack"].includes(s.paymentCategory)).forEach(s=>{const r=s.memberId||s.customerEmail;if(!r)return;G.has(r)||G.set(r,{memberships:[],prices:[],dates:[]});const l=G.get(r);l.memberships.push(s.cleanedProduct||s.paymentItem),l.prices.push(s.paymentValue||0),l.dates.push(new Date(s.paymentDate))});let te=0,se=0,ae=0;G.forEach((s,r)=>{const l=s.memberships.map((o,g)=>({membership:o,price:s.prices[g],date:s.dates[g]})).sort((o,g)=>o.date.getTime()-g.date.getTime());for(let o=1;o<l.length;o++){const g=l[o-1],j=l[o];g.membership===j.membership?te++:j.price>g.price?se++:j.price<g.price&&ae++}});const v=[];Array.from(G.entries()).forEach(([s,r])=>{if(r.memberships.length>1){const o=b.filter(g=>(g.memberId||g.customerEmail)===s).filter(g=>{const j=(g.cleanedProduct||g.paymentItem||"").toLowerCase(),$=(g.cleanedCategory||"").toLowerCase(),K=me.some(at=>j.includes(at)),st=["product","event","money-credits"].includes($);return!K&&!st});if(o.length>1){const g=o.map(j=>({membershipName:j.cleanedProduct||j.paymentItem||"Unknown",endDate:j.secMembershipEndDate||"",amountPaid:j.paymentValue||0,purchaseDate:j.paymentDate||"",category:j.cleanedCategory||"",discountAmount:j.discountAmount||0}));v.push({memberId:s,customerName:o[0]?.customerName||"Unknown",customerEmail:o[0]?.customerEmail||"",totalMemberships:o.length,totalAmountPaid:o.reduce((j,$)=>j+($.paymentValue||0),0),memberships:g})}}});const M=v.length,U=new Map;b.forEach(s=>{const r=new Date(s.paymentDate).toISOString().split("T")[0];U.has(r)||U.set(r,{revenue:0,newRevenue:0,existingRevenue:0,activeRevenue:0,transactions:0,newClients:new Set,existingClients:new Set,renewals:0,upgrades:0,downgrades:0,stacking:new Set});const l=U.get(r);l.revenue+=s.paymentValue||0,l.transactions++;const o=s.memberId||s.customerEmail;if(o){const g=new Date(s.paymentDate);d(o,g)?(l.newRevenue+=s.paymentValue||0,l.newClients.add(o)):(l.existingRevenue+=s.paymentValue||0,l.existingClients.add(o)),I(s)&&(l.activeRevenue+=s.paymentValue||0),(k.get(o)||[]).length>1&&l.stacking.add(o)}});const _=Array.from(U.entries()).map(([s,r])=>({date:s,revenue:r.revenue,newClientRevenue:r.newRevenue,existingClientRevenue:r.existingRevenue,activeMembershipRevenue:r.activeRevenue,transactions:r.transactions,newClients:r.newClients.size,existingClients:r.existingClients.size,renewals:r.renewals,upgrades:r.upgrades,downgrades:r.downgrades,stacking:r.stacking.size})).sort((s,r)=>new Date(s.date).getTime()-new Date(r.date).getTime()),re=new Map;b.forEach(s=>{const r=s.cleanedProduct||s.paymentItem||"Unknown";re.has(r)||re.set(r,{category:s.cleanedCategory||"Other",revenue:0,count:0,newClients:new Set,existingClients:new Set,renewals:0,upgrades:0,downgrades:0});const l=re.get(r);l.revenue+=s.paymentValue||0,l.count++;const o=s.memberId||s.customerEmail;if(o){const g=new Date(s.paymentDate);d(o,g)?l.newClients.add(o):l.existingClients.add(o)}});const Ge=Array.from(re.entries()).map(([s,r])=>({membershipName:s,cleanedCategory:r.category,revenue:r.revenue,count:r.count,avgPrice:r.count>0?r.revenue/r.count:0,newClients:r.newClients.size,existingClients:r.existingClients.size,renewals:r.renewals,upgrades:r.upgrades,downgrades:r.downgrades})).sort((s,r)=>r.revenue-s.revenue),ne=new Map;b.forEach(s=>{const r=s.memberId||s.customerEmail;if(!r)return;if(!ne.has(r)){const g=new Date(s.paymentDate);ne.set(r,{name:s.customerName,email:s.customerEmail,total:0,transactions:0,firstDate:g,lastDate:g,isNew:d(r,g),rawTransactions:[],totalDiscountReceived:0})}const l=ne.get(r);l.total+=s.paymentValue||0,l.transactions++,l.rawTransactions.push(s),l.totalDiscountReceived+=s.discountAmount||0;const o=new Date(s.paymentDate);if(o<l.firstDate&&(l.firstDate=o),o>l.lastDate&&(l.lastDate=o),s.secMembershipEndDate){const g=new Date(s.secMembershipEndDate);(!l.lastMembershipEndDate||g>l.lastMembershipEndDate)&&(l.lastMembershipName=s.cleanedProduct||s.paymentItem,l.lastMembershipEndDate=g,l.isFrozen=s.secMembershipIsFreezed===!0||s.secMembershipIsFreezed==="TRUE"||s.secMembershipIsFreezed==="true")}});const ie=Array.from(ne.entries()).map(([s,r])=>{let l="None";return r.lastMembershipEndDate&&(r.isFrozen?l="Frozen":r.lastMembershipEndDate>=L?l="Active":l="Expired"),{memberId:s,customerName:r.name,customerEmail:r.email,totalSpent:r.total,transactions:r.transactions,avgTransaction:r.transactions>0?r.total/r.transactions:0,firstPurchaseDate:r.firstDate.toISOString().split("T")[0],lastPurchaseDate:r.lastDate.toISOString().split("T")[0],isNew:r.isNew,lastMembershipName:r.lastMembershipName,lastMembershipEndDate:r.lastMembershipEndDate?.toISOString().split("T")[0],membershipStatus:l,totalDiscountReceived:r.totalDiscountReceived,rawTransactions:r.rawTransactions}}).sort((s,r)=>r.totalSpent-s.totalSpent),Ye=ie.slice(0,20),Ke=ie.filter(s=>s.totalSpent>0).slice(-20).reverse(),Te=ie.filter(s=>s.isNew),Me=ie.filter(s=>!s.isNew),We=Te.slice(0,20),Xe=Me.slice(0,20),Je=Te.filter(s=>s.totalSpent>0).slice(-20).reverse(),Qe=Me.filter(s=>s.totalSpent>0).slice(-20).reverse(),xe=[],he=new Map;a.forEach(s=>{const r=s.memberId||s.customerEmail;if(!r||!s.secMembershipEndDate||s.paymentStatus!=="succeeded")return;const l=new Date(s.secMembershipEndDate);l.setHours(0,0,0,0);const o=he.get(r);if(!o||l>o.endDate){const g=s.secMembershipIsFreezed===!0||s.secMembershipIsFreezed==="TRUE"||s.secMembershipIsFreezed==="true";he.set(r,{endDate:l,membershipType:s.cleanedProduct||s.paymentItem,lastAmount:s.paymentValue||0,isFrozen:g})}}),he.forEach((s,r)=>{if(!s.isFrozen&&s.endDate<L){const l=Math.floor((L.getTime()-s.endDate.getTime())/864e5),o=a.filter($=>($.memberId||$.customerEmail)===r&&$.paymentStatus==="succeeded"),g=o.reduce(($,K)=>$+(K.paymentValue||0),0),j=o[0];j&&xe.push({memberId:r,customerName:j.customerName,customerEmail:j.customerEmail,lastMembershipEndDate:s.endDate.toISOString().split("T")[0],daysSinceLapsed:l,lastMembershipType:s.membershipType,totalLifetimeValue:g,lastPurchaseAmount:s.lastAmount,rawTransactions:o})}}),xe.sort((s,r)=>r.totalLifetimeValue-s.totalLifetimeValue);const ee=b.filter(s=>(s.discountAmount||0)>0),Ze=ee.reduce((s,r)=>s+(r.discountAmount||0),0),_e=ee.length>0?ee.reduce((s,r)=>s+(r.discountPercentage||0),0)/ee.length:0,Se=R.filter(s=>{if(!s.dateIST)return!1;const r=new Date(s.dateIST);return r.getFullYear()===p.year&&r.getMonth()===p.monthIndex&&(!F||s.location===F)&&s.checkedIn}),ue=Se.length,Ae=new Set(Se.map(s=>s.memberId||s.email)).size,et=Ae>0?ue/Ae:0,tt=u>0?ue/(u/1e3):0,Re=[],Pe=[];return b.forEach(s=>{const r=s.memberId||s.customerEmail;if(!r)return;const l=new Date(s.paymentDate),o=d(r,l),g=I(s),j=s.mrpPostTax||s.mrpPreTax||0,$=j>0?j-(s.paymentValue||0):0,K={transactionId:s.saleItemId||s.transactionId||"",memberId:r,customerName:s.customerName||"",customerEmail:s.customerEmail||"",paymentDate:s.paymentDate||"",paymentValue:s.paymentValue||0,product:s.cleanedProduct||s.paymentItem||"",category:s.cleanedCategory||"",isNew:o,isStacked:g,discountAmount:s.discountAmount||0,discountPercentage:s.discountPercentage||0,mrpPreTax:s.mrpPreTax,mrpPostTax:s.mrpPostTax,discountType:s.discountType,savings:$,location:s.calculatedLocation||"",membershipEndDate:s.secMembershipEndDate};o?Re.push(K):Pe.push(K)}),{totalRevenue:u,newClientRevenue:N,existingClientRevenue:D,activeMembershipRevenue:t,newCustomerMetrics:{revenue:w.revenue,unitsSold:w.unitsSold,transactions:w.transactions,uniqueMembers:w.uniqueMembers.size,atv:w.atv,discountedRevenue:w.discountedRevenue,nonDiscountedRevenue:w.nonDiscountedRevenue,discountedTransactions:w.discountedTransactions,nonDiscountedTransactions:w.nonDiscountedTransactions,totalDiscountAmount:w.totalDiscountAmount,avgDiscountPercentage:w.avgDiscountPercentage},repeatCustomerMetrics:{revenue:T.revenue,unitsSold:T.unitsSold,transactions:T.transactions,uniqueMembers:T.uniqueMembers.size,atv:T.atv,discountedRevenue:T.discountedRevenue,nonDiscountedRevenue:T.nonDiscountedRevenue,discountedTransactions:T.discountedTransactions,nonDiscountedTransactions:T.nonDiscountedTransactions,totalDiscountAmount:T.totalDiscountAmount,avgDiscountPercentage:T.avgDiscountPercentage},totalClients:c.size+Z.size,newClients:c.size,existingClients:Z.size,clientsWithActiveMembers:Y.size,clientsWithMultipleMemberships:v.length,renewals:te,upgrades:se,downgrades:ae,stackingMembers:M,stackedMembersDetails:v,dailyAnalytics:_,membershipAnalytics:Ge,topNewSpenders:We,topRepeatSpenders:Xe,bottomNewSpenders:Je,bottomRepeatSpenders:Qe,topSpenders:Ye,bottomSpenders:Ke,lapsedMembers:xe.slice(0,50),totalDiscountGiven:Ze,transactionsWithDiscount:ee.length,avgDiscountPercentage:_e,totalVisits:ue,avgVisitsPerClient:et,visitToRevenueRatio:tt,newTransactions:Re,repeatTransactions:Pe,allTransactions:b}},[a,R,y,V,F]),Rt=({isOpen:a,onClose:R,data:y})=>{const[V,F]=q.useState("overview");if(!y)return null;const p=i=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:n(i.totalSpent)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Spent"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:m(i.transactions)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Transactions"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:n(i.avgTransaction)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Avg Transaction"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:n(i.totalDiscountReceived||0)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Discounts"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(x,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),e.jsx(C,{variant:i.isNew?"default":"secondary",className:"text-sm",children:i.isNew?"New Client":"Repeat Client"})]})})}),e.jsx(x,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Membership Status:"}),e.jsx(C,{variant:i.membershipStatus==="Active"?"default":"outline",className:`text-sm ${i.membershipStatus==="Active"?"bg-green-100 text-green-700":i.membershipStatus==="Frozen"?"bg-blue-100 text-blue-700":i.membershipStatus==="Expired"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`,children:i.membershipStatus||"None"})]})})})]}),i.lastMembershipName&&e.jsx(x,{className:"bg-blue-50 border-blue-200",children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(vt,{className:"w-5 h-5 text-blue-600 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:i.lastMembershipName}),e.jsxs("div",{className:"text-sm text-gray-700 mt-1",children:["End Date: ",i.lastMembershipEndDate?new Date(i.lastMembershipEndDate).toLocaleDateString():"N/A"]})]})]})})}),e.jsxs(x,{children:[e.jsx(P,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-blue-500"}),"Transaction History"]})}),e.jsx(h,{children:e.jsx(Ne,{className:"h-96",children:e.jsxs(ge,{children:[e.jsx(pe,{children:e.jsxs(W,{children:[e.jsx(S,{children:"Date"}),e.jsx(S,{children:"Product"}),e.jsx(S,{children:"MRP"}),e.jsx(S,{children:"Amount"}),e.jsx(S,{children:"Discount"}),e.jsx(S,{children:"Savings"}),e.jsx(S,{children:"Location"})]})}),e.jsx(je,{children:i.rawTransactions?.map((d,I)=>{const k=d.mrpPostTax||d.mrpPreTax||0,u=k>0?k-(d.paymentValue||0):0;return e.jsxs(W,{children:[e.jsx(A,{children:new Date(d.paymentDate).toLocaleDateString()}),e.jsx(A,{className:"max-w-xs truncate",children:d.cleanedProduct||d.paymentItem}),e.jsx(A,{className:"text-gray-500",children:k>0?n(k):"-"}),e.jsx(A,{className:"font-semibold",children:n(d.paymentValue||0)}),e.jsx(A,{children:(d.discountAmount||0)>0?e.jsxs("span",{className:"text-green-600",children:[n(d.discountAmount||0)," (",f(d.discountPercentage||0),")"]}):"-"}),e.jsx(A,{children:u>0?e.jsx("span",{className:"text-emerald-600 font-medium",children:n(u)}):"-"}),e.jsx(A,{children:d.calculatedLocation})]},I)})})]})})})]})]}),L=i=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:i.daysSinceLapsed}),e.jsx("div",{className:"text-sm text-gray-600",children:"Days Lapsed"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:n(i.totalLifetimeValue)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Lifetime Value"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:n(i.lastPurchaseAmount)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Last Purchase"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:i.lastMembershipType}),e.jsx("div",{className:"text-xs text-gray-600",children:"Last Membership"})]})})]}),e.jsx(x,{className:"bg-amber-50 border-amber-200",children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(X,{className:"w-5 h-5 text-amber-600 mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:"Membership Ended"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[new Date(i.lastMembershipEndDate).toLocaleDateString()," - ",i.daysSinceLapsed," days ago"]})]})]})})}),e.jsxs(x,{children:[e.jsx(P,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-blue-500"}),"Purchase History"]})}),e.jsx(h,{children:e.jsx(Ne,{className:"h-96",children:e.jsxs(ge,{children:[e.jsx(pe,{children:e.jsxs(W,{children:[e.jsx(S,{children:"Date"}),e.jsx(S,{children:"Product"}),e.jsx(S,{children:"Amount"}),e.jsx(S,{children:"Membership End"})]})}),e.jsx(je,{children:i.rawTransactions?.map((d,I)=>e.jsxs(W,{children:[e.jsx(A,{children:new Date(d.paymentDate).toLocaleDateString()}),e.jsx(A,{className:"max-w-xs truncate",children:d.cleanedProduct||d.paymentItem}),e.jsx(A,{className:"font-semibold",children:n(d.paymentValue||0)}),e.jsx(A,{children:d.secMembershipEndDate?new Date(d.secMembershipEndDate).toLocaleDateString():"-"})]},I))})]})})})]})]}),b=i=>{const d=i.reduce((N,D)=>N+D.paymentValue,0),I=i.reduce((N,D)=>N+D.discountAmount,0);i.reduce((N,D)=>N+(D.mrpPostTax||D.mrpPreTax||0),0);const k=i.reduce((N,D)=>N+(D.savings||0),0);i.filter(N=>N.isStacked).length;const u=i.length>0?d/i.length:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:n(d)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Revenue"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:m(i.length)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Transactions"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:n(u)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Avg ATV"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:n(I)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Discounts"})]})}),e.jsx(x,{children:e.jsxs(h,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:n(k)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Savings"})]})})]}),e.jsxs(x,{children:[e.jsx(P,{children:e.jsx(E,{children:"Transaction Details"})}),e.jsx(h,{children:e.jsx(Ne,{className:"h-[500px]",children:e.jsxs(ge,{children:[e.jsx(pe,{children:e.jsxs(W,{children:[e.jsx(S,{children:"Date"}),e.jsx(S,{children:"Customer"}),e.jsx(S,{children:"Product"}),e.jsx(S,{children:"MRP"}),e.jsx(S,{children:"Amount"}),e.jsx(S,{children:"Discount"}),e.jsx(S,{children:"Savings"}),e.jsx(S,{children:"Status"})]})}),e.jsx(je,{children:i.map((N,D)=>{const t=N.mrpPostTax||N.mrpPreTax||0,c=N.savings||(t>0?t-N.paymentValue:0);return e.jsxs(W,{children:[e.jsx(A,{children:new Date(N.paymentDate).toLocaleDateString()}),e.jsx(A,{className:"max-w-xs truncate",children:N.customerName}),e.jsx(A,{className:"max-w-xs truncate",children:N.product}),e.jsx(A,{className:"text-gray-500",children:t>0?n(t):"-"}),e.jsx(A,{className:"font-semibold",children:n(N.paymentValue)}),e.jsx(A,{children:N.discountAmount>0?e.jsxs("span",{className:"text-green-600",children:[n(N.discountAmount)," (",f(N.discountPercentage),")"]}):"-"}),e.jsx(A,{children:c>0?e.jsx("span",{className:"text-emerald-600 font-medium",children:n(c)}):"-"}),e.jsx(A,{children:e.jsxs("div",{className:"flex gap-1",children:[N.isNew&&e.jsx(C,{variant:"default",className:"text-xs",children:"New"}),N.isStacked&&e.jsx(C,{variant:"secondary",className:"text-xs",children:"Stacked"})]})})]},D)})})]})})})]})]})};return e.jsx(He,{open:a,onOpenChange:R,children:e.jsxs(qe,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ue,{children:e.jsxs(Be,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Nt,{className:"w-5 h-5"}),y.title]}),e.jsx("button",{onClick:R,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(rt,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"mt-4",children:[y.type==="spender"&&y.spenderData&&p(y.spenderData),y.type==="lapsed"&&y.lapsedData&&L(y.lapsedData),(y.type==="new-transactions"||y.type==="repeat-transactions")&&y.transactions&&b(y.transactions)]})]})})},$e=["#3b82f6","#8b5cf6","#ec4899","#f59e0b","#10b981","#06b6d4","#6366f1"],Oe=({analytics:a,monthName:R,locationName:y})=>{const[V,F]=q.useState("daily"),[p,L]=q.useState(null),[b,i]=q.useState({isOpen:!1,type:"new-transactions",title:""}),d=a.totalRevenue>0?a.newClientRevenue/a.totalRevenue*100:0,I=100-d,k=a.totalRevenue>0?a.activeMembershipRevenue/a.totalRevenue*100:0,u=a.dailyAnalytics.map(t=>({date:new Date(t.date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),"Total Revenue":t.revenue,"New Client Revenue":t.newClientRevenue,"Existing Client Revenue":t.existingClientRevenue,Transactions:t.transactions})),N=a.membershipAnalytics.slice(0,10).map(t=>({name:t.membershipName.length>30?t.membershipName.substring(0,30)+"...":t.membershipName,revenue:t.revenue,count:t.count})),D=[{name:"New Clients",value:a.newClientRevenue},{name:"Existing Clients",value:a.existingClientRevenue}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:e.jsx(x,{className:"bg-gradient-to-br from-blue-50 to-white border-blue-200 hover:shadow-lg transition-shadow",children:e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ft,{className:"w-8 h-8 text-blue-600"}),e.jsx(C,{variant:"secondary",className:"bg-blue-100 text-blue-700",children:"Total"})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:n(a.totalRevenue)}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Total Revenue"}),e.jsx("div",{className:"mt-3 pt-3 border-t border-blue-100",children:e.jsxs("div",{className:"text-xs text-gray-500",children:[m(a.dailyAnalytics.length)," days tracked"]})})]})})}),e.jsx(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.1},onClick:()=>i({isOpen:!0,type:"new-transactions",title:`${R} - New Client Transactions (${y})`,transactions:a.newTransactions}),className:"cursor-pointer",children:e.jsx(x,{className:"bg-gradient-to-br from-emerald-50 to-white border-emerald-200 hover:shadow-lg transition-shadow",children:e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(le,{className:"w-8 h-8 text-emerald-600"}),e.jsx(C,{variant:"secondary",className:"bg-emerald-100 text-emerald-700",children:f(d)})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:n(a.newClientRevenue)}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"New Client Revenue"}),e.jsx("div",{className:"mt-3 pt-3 border-t border-emerald-100",children:e.jsxs("div",{className:"text-xs text-gray-500",children:[m(a.newClients)," new clients • Click for details"]})})]})})}),e.jsx(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.2},onClick:()=>i({isOpen:!0,type:"repeat-transactions",title:`${R} - Repeat Client Transactions (${y})`,transactions:a.repeatTransactions}),className:"cursor-pointer",children:e.jsx(x,{className:"bg-gradient-to-br from-purple-50 to-white border-purple-200 hover:shadow-lg transition-shadow",children:e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ce,{className:"w-8 h-8 text-purple-600"}),e.jsx(C,{variant:"secondary",className:"bg-purple-100 text-purple-700",children:f(I)})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:n(a.existingClientRevenue)}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Existing Client Revenue"}),e.jsx("div",{className:"mt-3 pt-3 border-t border-purple-100",children:e.jsxs("div",{className:"text-xs text-gray-500",children:[m(a.existingClients)," returning clients • Click for details"]})})]})})}),e.jsx(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.3},children:e.jsx(x,{className:"bg-gradient-to-br from-amber-50 to-white border-amber-200 hover:shadow-lg transition-shadow",children:e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(wt,{className:"w-8 h-8 text-amber-600"}),e.jsx(C,{variant:"secondary",className:"bg-amber-100 text-amber-700",children:f(k)})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:n(a.activeMembershipRevenue)}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Active Member Purchases"}),e.jsx("div",{className:"mt-3 pt-3 border-t border-amber-100",children:e.jsxs("div",{className:"text-xs text-gray-500",children:[m(a.clientsWithActiveMembers)," active members"]})})]})})})]}),a.newCustomerMetrics&&a.repeatCustomerMetrics&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(B.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5},children:e.jsxs(x,{className:"border-emerald-200 shadow-lg",children:[e.jsx(P,{className:"bg-gradient-to-r from-emerald-50 to-green-50",children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-emerald-600"}),"New Customer Detailed Metrics"]})}),e.jsxs(h,{className:"pt-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-emerald-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Revenue"}),e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:n(a.newCustomerMetrics.revenue)})]}),e.jsxs("div",{className:"bg-emerald-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Units Sold"}),e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:m(a.newCustomerMetrics.unitsSold)})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Transactions"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:m(a.newCustomerMetrics.transactions)})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Unique Members"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:m(a.newCustomerMetrics.uniqueMembers)})]}),e.jsxs("div",{className:"col-span-2 bg-teal-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Average Transaction Value (ATV)"}),e.jsx("div",{className:"text-2xl font-bold text-teal-600",children:n(a.newCustomerMetrics.atv)})]})]}),e.jsxs("div",{className:"pt-4 border-t border-emerald-100",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4 text-orange-500"}),"Discount Analysis"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg cursor-pointer hover:bg-orange-100 transition-colors",onClick:()=>i({isOpen:!0,type:"new-transactions",title:`${R} - New Customer Discounted Transactions`,transactions:a.newTransactions.filter(t=>t.discountAmount>0)}),children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Discounted Revenue"}),e.jsx("div",{className:"text-lg font-bold text-orange-600",children:n(a.newCustomerMetrics.discountedRevenue)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[m(a.newCustomerMetrics.discountedTransactions)," txns"]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Non-Discounted"}),e.jsx("div",{className:"text-lg font-bold text-gray-700",children:n(a.newCustomerMetrics.nonDiscountedRevenue)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[m(a.newCustomerMetrics.nonDiscountedTransactions)," txns"]})]}),e.jsxs("div",{className:"col-span-2 bg-red-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Total Discounts Given"}),e.jsx("span",{className:"text-lg font-bold text-red-600",children:n(a.newCustomerMetrics.totalDiscountAmount)})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Avg: ",f(a.newCustomerMetrics.avgDiscountPercentage)]})]})]})]})]})]})}),e.jsx(B.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5},children:e.jsxs(x,{className:"border-purple-200 shadow-lg",children:[e.jsx(P,{className:"bg-gradient-to-r from-purple-50 to-indigo-50",children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-purple-600"}),"Repeat Customer Detailed Metrics"]})}),e.jsxs(h,{className:"pt-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Revenue"}),e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:n(a.repeatCustomerMetrics.revenue)})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Units Sold"}),e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:m(a.repeatCustomerMetrics.unitsSold)})]}),e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Transactions"}),e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:m(a.repeatCustomerMetrics.transactions)})]}),e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Unique Members"}),e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:m(a.repeatCustomerMetrics.uniqueMembers)})]}),e.jsxs("div",{className:"col-span-2 bg-violet-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Average Transaction Value (ATV)"}),e.jsx("div",{className:"text-2xl font-bold text-violet-600",children:n(a.repeatCustomerMetrics.atv)})]})]}),e.jsxs("div",{className:"pt-4 border-t border-purple-100",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4 text-orange-500"}),"Discount Analysis"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg cursor-pointer hover:bg-orange-100 transition-colors",onClick:()=>i({isOpen:!0,type:"repeat-transactions",title:`${R} - Repeat Customer Discounted Transactions`,transactions:a.repeatTransactions.filter(t=>t.discountAmount>0)}),children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Discounted Revenue"}),e.jsx("div",{className:"text-lg font-bold text-orange-600",children:n(a.repeatCustomerMetrics.discountedRevenue)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[m(a.repeatCustomerMetrics.discountedTransactions)," txns"]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Non-Discounted"}),e.jsx("div",{className:"text-lg font-bold text-gray-700",children:n(a.repeatCustomerMetrics.nonDiscountedRevenue)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[m(a.repeatCustomerMetrics.nonDiscountedTransactions)," txns"]})]}),e.jsxs("div",{className:"col-span-2 bg-red-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Total Discounts Given"}),e.jsx("span",{className:"text-lg font-bold text-red-600",children:n(a.repeatCustomerMetrics.totalDiscountAmount)})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Avg: ",f(a.repeatCustomerMetrics.avgDiscountPercentage)]})]})]})]})]})]})})]}),e.jsxs(x,{children:[e.jsx(P,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5 text-blue-600"}),"Membership Behavior Analytics"]})}),e.jsxs(h,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:m(a.renewals)}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Renewals"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Same membership repurchased"})]}),e.jsxs("div",{className:"text-center p-4 bg-emerald-50 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-emerald-600",children:m(a.upgrades)}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Upgrades"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Higher value purchase"})]}),e.jsxs("div",{className:"text-center p-4 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-600",children:m(a.downgrades)}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Downgrades"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Lower value purchase"})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-purple-600",children:m(a.stackingMembers)}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Stacking Members"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Multiple memberships"})]})]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Key Insight:"})," ",a.renewals>a.upgrades+a.downgrades?`High renewal rate (${m(a.renewals)}) indicates strong membership satisfaction and loyalty. Members prefer to maintain their current membership level.`:a.upgrades>a.renewals?`Strong upgrade activity (${m(a.upgrades)}) suggests members are expanding their commitment and engagement with higher-tier offerings.`:`Balanced membership behavior with ${m(a.renewals)} renewals and ${m(a.upgrades+a.downgrades)} tier changes indicates a healthy mix of satisfied members and those adjusting their commitments.`,a.stackingMembers>a.totalClients*.1&&` Notable stacking activity (${m(a.stackingMembers)} members) indicates high engagement and willingness to invest in multiple offerings.`]})]})})]})]}),a.stackedMembersDetails&&a.stackedMembersDetails.length>0&&e.jsxs(x,{children:[e.jsx(P,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5 text-purple-600"}),"Stacked Memberships - Detailed Breakdown"]})}),e.jsxs(h,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-purple-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Customer"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"text-center p-3 text-sm font-semibold text-gray-700",children:"Total Memberships"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Total Paid"}),e.jsx("th",{className:"text-center p-3 text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:a.stackedMembersDetails.map((t,c)=>e.jsxs("tr",{className:"border-t hover:bg-purple-50",children:[e.jsx("td",{className:"p-3 text-sm text-gray-900 font-medium",children:t.customerName}),e.jsx("td",{className:"p-3 text-sm text-gray-600",children:t.customerEmail}),e.jsx("td",{className:"p-3 text-sm text-center",children:e.jsxs(C,{className:"bg-purple-100 text-purple-700",children:[t.totalMemberships," Memberships"]})}),e.jsx("td",{className:"p-3 text-sm text-gray-900 text-right font-semibold",children:n(t.totalAmountPaid)}),e.jsx("td",{className:"p-3 text-sm text-center",children:e.jsx(nt,{variant:"outline",size:"sm",onClick:()=>L(t),className:"text-purple-600 hover:text-purple-700 hover:bg-purple-50",children:"View Details"})})]},c))})]})}),e.jsx("div",{className:"mt-4 p-4 bg-purple-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-purple-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Stacking Insight:"})," ",a.stackedMembersDetails.length," members purchased multiple memberships in ",R,". Average stacking value: ",n(a.stackedMembersDetails.reduce((t,c)=>t+c.totalAmountPaid,0)/a.stackedMembersDetails.length),". These highly engaged members represent ",f(a.stackedMembersDetails.length/a.totalClients*100)," of total clients but contribute ",f(a.stackedMembersDetails.reduce((t,c)=>t+c.totalAmountPaid,0)/a.totalRevenue*100)," of total revenue."]})]})})]})]}),e.jsxs(x,{children:[e.jsx(P,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(bt,{className:"w-5 h-5 text-blue-600"}),"Revenue Distribution: New vs Existing Clients"]})})}),e.jsxs(h,{children:[e.jsx("div",{className:"h-80",children:e.jsx(fe,{width:"100%",height:"100%",children:e.jsxs(Ct,{children:[e.jsx(Tt,{data:D,cx:"50%",cy:"50%",labelLine:!1,label:({name:t,percent:c})=>`${t}: ${(c*100).toFixed(1)}%`,outerRadius:120,fill:"#8884d8",dataKey:"value",children:D.map((t,c)=>e.jsx(Dt,{fill:$e[c%$e.length]},`cell-${c}`))}),e.jsx(ye,{formatter:t=>n(t)}),e.jsx(we,{})]})})}),e.jsx("div",{className:"mt-4 p-4 bg-emerald-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-emerald-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Revenue Composition Analysis:"})," ",d>50?`New client revenue dominates at ${f(d)}, indicating strong acquisition momentum but potential dependency on new customer acquisition. Focus on retention strategies to balance revenue sources.`:`Existing client revenue is ${f(I)} of total, demonstrating strong client retention and loyalty. This creates a stable revenue foundation while new client acquisition contributes ${f(d)}.`]})]})})]})]}),e.jsxs(x,{children:[e.jsx(P,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(yt,{className:"w-5 h-5 text-blue-600"}),"Daily Revenue Trends"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>F("daily"),className:`px-3 py-1 rounded-lg text-sm font-medium transition ${V==="daily"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Daily View"}),e.jsx("button",{onClick:()=>F("membership"),className:`px-3 py-1 rounded-lg text-sm font-medium transition ${V==="membership"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"By Membership"})]})]})}),e.jsx(h,{children:V==="daily"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-80",children:e.jsx(fe,{width:"100%",height:"100%",children:e.jsxs(Le,{data:u,children:[e.jsx(Ve,{strokeDasharray:"3 3"}),e.jsx(Fe,{dataKey:"date"}),e.jsx(ze,{}),e.jsx(ye,{formatter:t=>n(t)}),e.jsx(we,{}),e.jsx(De,{dataKey:"New Client Revenue",fill:"#10b981"}),e.jsx(De,{dataKey:"Existing Client Revenue",fill:"#8b5cf6"})]})})}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Daily Performance Pattern:"})," Revenue tracked across ",a.dailyAnalytics.length," days. Average daily revenue: ",n(a.totalRevenue/a.dailyAnalytics.length),". Peak performance days and consistent patterns indicate operational efficiency and strong demand during this period."]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-80",children:e.jsx(fe,{width:"100%",height:"100%",children:e.jsxs(Le,{data:N,layout:"horizontal",children:[e.jsx(Ve,{strokeDasharray:"3 3"}),e.jsx(Fe,{type:"number"}),e.jsx(ze,{dataKey:"name",type:"category",width:150}),e.jsx(ye,{formatter:t=>n(t)}),e.jsx(we,{}),e.jsx(De,{dataKey:"revenue",fill:"#3b82f6",name:"Revenue"})]})})}),e.jsx("div",{className:"mt-4 p-4 bg-purple-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-purple-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Top Performing Memberships:"})," The top membership generated ",n(a.membershipAnalytics[0]?.revenue||0),"with ",m(a.membershipAnalytics[0]?.count||0)," purchases. This concentration indicates clear product-market fit and customer preference for specific offerings."]})]})})]})})]}),e.jsxs(x,{children:[e.jsx(P,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5 text-blue-600"}),"Membership Performance by Product & Category"]})}),e.jsxs(h,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Membership"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Revenue"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Count"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Avg Price"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"New"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Existing"})]})}),e.jsx("tbody",{children:a.membershipAnalytics.map((t,c)=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 text-sm text-gray-900 font-medium",children:t.membershipName}),e.jsx("td",{className:"p-3 text-sm text-gray-600",children:e.jsx(C,{variant:"outline",children:t.cleanedCategory})}),e.jsx("td",{className:"p-3 text-sm text-gray-900 text-right font-semibold",children:n(t.revenue)}),e.jsx("td",{className:"p-3 text-sm text-gray-600 text-right",children:m(t.count)}),e.jsx("td",{className:"p-3 text-sm text-gray-600 text-right",children:n(t.avgPrice)}),e.jsx("td",{className:"p-3 text-sm text-emerald-600 text-right font-medium",children:m(t.newClients)}),e.jsx("td",{className:"p-3 text-sm text-purple-600 text-right font-medium",children:m(t.existingClients)})]},c))})]})}),e.jsx("div",{className:"mt-4 p-4 bg-amber-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Product Performance Insight:"})," Tracking ",a.membershipAnalytics.length," unique products. Top category is ",a.membershipAnalytics[0]?.cleanedCategory||"N/A",". The mix of new vs existing client purchases across products reveals which offerings attract new clients versus those that drive retention among current members."]})]})})]})]}),a.newTransactions&&a.repeatTransactions&&e.jsxs(x,{children:[e.jsx(P,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-indigo-600"}),"Detailed Transaction History"]})}),e.jsx(h,{children:e.jsxs(J,{defaultValue:"new",className:"w-full",children:[e.jsxs(Q,{className:"grid w-full grid-cols-2",children:[e.jsxs(O,{value:"new",className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"New Customer Transactions (",a.newTransactions?.length||0,")"]}),e.jsxs(O,{value:"repeat",className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Repeat Customer Transactions (",a.repeatTransactions?.length||0,")"]})]}),e.jsxs(H,{value:"new",children:[e.jsx("div",{className:"overflow-x-auto max-h-[600px] overflow-y-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-emerald-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Customer"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"MRP"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Paid"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Discount"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Savings"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Location"}),e.jsx("th",{className:"text-center p-3 text-sm font-semibold text-gray-700",children:"Type"})]})}),e.jsx("tbody",{children:a.newTransactions.slice(0,100).map((t,c)=>e.jsxs("tr",{className:"border-t hover:bg-emerald-50 cursor-pointer transition-colors",onClick:()=>i({isOpen:!0,type:"spender",title:`${t.customerName} - Transaction History`,spenderData:{memberId:t.memberId,customerName:t.customerName,customerEmail:t.customerEmail,totalSpent:t.paymentValue,transactions:1,avgTransaction:t.paymentValue,firstPurchaseDate:t.paymentDate,lastPurchaseDate:t.paymentDate,isNew:!0,rawTransactions:[t]}}),children:[e.jsx("td",{className:"p-3 text-sm text-gray-600",children:new Date(t.paymentDate).toLocaleDateString()}),e.jsxs("td",{className:"p-3 text-sm text-gray-900 font-medium",children:[e.jsx("div",{children:t.customerName}),e.jsx("div",{className:"text-xs text-gray-500",children:t.customerEmail})]}),e.jsxs("td",{className:"p-3 text-sm text-gray-900",children:[e.jsx("div",{className:"max-w-xs truncate",title:t.product,children:t.product}),t.membershipEndDate&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Expires: ",new Date(t.membershipEndDate).toLocaleDateString()]})]}),e.jsx("td",{className:"p-3 text-sm",children:e.jsx(C,{variant:"outline",className:"text-xs",children:t.category})}),e.jsx("td",{className:"p-3 text-sm text-gray-900 text-right font-medium",children:t.mrpPostTax?n(t.mrpPostTax):"-"}),e.jsx("td",{className:"p-3 text-sm text-gray-900 text-right font-semibold",children:n(t.paymentValue)}),e.jsx("td",{className:"p-3 text-sm text-right",children:t.discountAmount>0?e.jsxs("span",{className:"text-orange-600 font-medium",children:[n(t.discountAmount),t.discountPercentage>0&&e.jsxs("span",{className:"text-xs block",children:["(",f(t.discountPercentage),")"]})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"p-3 text-sm text-right",children:t.savings&&t.savings>0?e.jsx("span",{className:"text-green-600 font-medium",children:n(t.savings)}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"p-3 text-sm text-gray-600",children:t.location}),e.jsx("td",{className:"p-3 text-sm text-center",children:e.jsxs("div",{className:"flex flex-col gap-1 items-center",children:[t.isStacked&&e.jsx(C,{className:"bg-purple-100 text-purple-700 text-xs",children:"Stacked"}),t.discountType&&e.jsx(C,{variant:"outline",className:"text-xs",children:t.discountType})]})})]},`new-${t.transactionId}-${c}`))})]})}),a.newTransactions.length>100&&e.jsxs("div",{className:"mt-3 text-sm text-gray-500 text-center",children:["Showing first 100 of ",a.newTransactions.length," transactions"]}),e.jsx("div",{className:"mt-4 p-4 bg-emerald-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-emerald-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"New Customer Transaction Insights:"})," ",a.newTransactions.length," transactions from new customers. Avg transaction value: ",n(a.newCustomerMetrics.atv),".",a.newCustomerMetrics.discountedTransactions>0&&e.jsxs(e.Fragment,{children:[" ",f(a.newCustomerMetrics.discountedTransactions/a.newCustomerMetrics.transactions*100)," of transactions included discounts."]})]})]})})]}),e.jsxs(H,{value:"repeat",children:[e.jsx("div",{className:"overflow-x-auto max-h-[600px] overflow-y-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-purple-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Customer"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"MRP"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Paid"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Discount"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Savings"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Location"}),e.jsx("th",{className:"text-center p-3 text-sm font-semibold text-gray-700",children:"Type"})]})}),e.jsx("tbody",{children:a.repeatTransactions.slice(0,100).map((t,c)=>e.jsxs("tr",{className:"border-t hover:bg-purple-50 cursor-pointer transition-colors",onClick:()=>i({isOpen:!0,type:"spender",title:`${t.customerName} - Transaction History`,spenderData:{memberId:t.memberId,customerName:t.customerName,customerEmail:t.customerEmail,totalSpent:t.paymentValue,transactions:1,avgTransaction:t.paymentValue,firstPurchaseDate:t.paymentDate,lastPurchaseDate:t.paymentDate,isNew:!1,rawTransactions:[t]}}),children:[e.jsx("td",{className:"p-3 text-sm text-gray-600",children:new Date(t.paymentDate).toLocaleDateString()}),e.jsxs("td",{className:"p-3 text-sm text-gray-900 font-medium",children:[e.jsx("div",{children:t.customerName}),e.jsx("div",{className:"text-xs text-gray-500",children:t.customerEmail})]}),e.jsxs("td",{className:"p-3 text-sm text-gray-900",children:[e.jsx("div",{className:"max-w-xs truncate",title:t.product,children:t.product}),t.membershipEndDate&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Expires: ",new Date(t.membershipEndDate).toLocaleDateString()]})]}),e.jsx("td",{className:"p-3 text-sm",children:e.jsx(C,{variant:"outline",className:"text-xs",children:t.category})}),e.jsx("td",{className:"p-3 text-sm text-gray-900 text-right font-medium",children:t.mrpPostTax?n(t.mrpPostTax):"-"}),e.jsx("td",{className:"p-3 text-sm text-gray-900 text-right font-semibold",children:n(t.paymentValue)}),e.jsx("td",{className:"p-3 text-sm text-right",children:t.discountAmount>0?e.jsxs("span",{className:"text-orange-600 font-medium",children:[n(t.discountAmount),t.discountPercentage>0&&e.jsxs("span",{className:"text-xs block",children:["(",f(t.discountPercentage),")"]})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"p-3 text-sm text-right",children:t.savings&&t.savings>0?e.jsx("span",{className:"text-green-600 font-medium",children:n(t.savings)}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"p-3 text-sm text-gray-600",children:t.location}),e.jsx("td",{className:"p-3 text-sm text-center",children:e.jsxs("div",{className:"flex flex-col gap-1 items-center",children:[t.isStacked&&e.jsx(C,{className:"bg-purple-100 text-purple-700 text-xs",children:"Stacked"}),t.discountType&&e.jsx(C,{variant:"outline",className:"text-xs",children:t.discountType})]})})]},`repeat-${t.transactionId}-${c}`))})]})}),a.repeatTransactions.length>100&&e.jsxs("div",{className:"mt-3 text-sm text-gray-500 text-center",children:["Showing first 100 of ",a.repeatTransactions.length," transactions"]}),e.jsx("div",{className:"mt-4 p-4 bg-purple-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ee,{className:"w-5 h-5 text-purple-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Repeat Customer Transaction Insights:"})," ",a.repeatTransactions.length," transactions from repeat customers. Avg transaction value: ",n(a.repeatCustomerMetrics.atv),".",a.repeatCustomerMetrics.discountedTransactions>0&&e.jsxs(e.Fragment,{children:[" ",f(a.repeatCustomerMetrics.discountedTransactions/a.repeatCustomerMetrics.transactions*100)," of transactions included discounts."]})]})]})})]})]})})]}),e.jsxs(x,{children:[e.jsx(P,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(Mt,{className:"w-5 h-5 text-amber-600"}),"Top 20 Spenders - New vs Repeat Customers"]})}),e.jsx(h,{children:e.jsxs(J,{defaultValue:"new",className:"w-full",children:[e.jsxs(Q,{className:"grid w-full grid-cols-2",children:[e.jsxs(O,{value:"new",className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"New Customers (",a.topNewSpenders?.length||0,")"]}),e.jsxs(O,{value:"repeat",className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Repeat Customers (",a.topRepeatSpenders?.length||0,")"]})]}),e.jsxs(H,{value:"new",className:"mt-4",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-emerald-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Rank"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Customer"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Total Spent"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Transactions"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Discounts"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Membership"}),e.jsx("th",{className:"text-center p-3 text-sm font-semibold text-gray-700",children:"Status"})]})}),e.jsx("tbody",{children:a.topNewSpenders.map((t,c)=>e.jsxs("tr",{className:"border-t hover:bg-emerald-50 cursor-pointer transition-colors",onClick:()=>i({isOpen:!0,type:"spender",title:`${t.customerName} - Transaction History`,spenderData:t}),children:[e.jsxs("td",{className:"p-3 text-sm text-gray-600",children:["#",c+1]}),e.jsx("td",{className:"p-3 text-sm text-gray-900 font-medium",children:t.customerName}),e.jsx("td",{className:"p-3 text-sm text-gray-600",children:t.customerEmail}),e.jsx("td",{className:"p-3 text-sm text-gray-900 text-right font-semibold",children:n(t.totalSpent)}),e.jsx("td",{className:"p-3 text-sm text-gray-600 text-right",children:m(t.transactions)}),e.jsx("td",{className:"p-3 text-sm text-orange-600 text-right font-medium",children:n(t.totalDiscountReceived||0)}),e.jsx("td",{className:"p-3 text-sm text-gray-600",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium truncate max-w-xs",children:t.lastMembershipName||"N/A"}),t.lastMembershipEndDate&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Ends: ",new Date(t.lastMembershipEndDate).toLocaleDateString()]})]})}),e.jsx("td",{className:"p-3 text-center",children:e.jsx(C,{variant:"default",className:`text-xs ${t.membershipStatus==="Active"?"bg-green-100 text-green-700":t.membershipStatus==="Frozen"?"bg-blue-100 text-blue-700":t.membershipStatus==="Expired"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`,children:t.membershipStatus||"None"})})]},c))})]})}),e.jsx("div",{className:"mt-4 p-4 bg-emerald-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-emerald-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"New Customer High-Value Analysis:"})," Top ",a.topNewSpenders.length," new customer spenders contributed ",n(a.topNewSpenders.reduce((t,c)=>t+c.totalSpent,0)),", demonstrating strong initial engagement. Average spending: ",n(a.topNewSpenders.reduce((t,c)=>t+c.totalSpent,0)/Math.max(a.topNewSpenders.length,1))," per customer. Total discounts given: ",n(a.topNewSpenders.reduce((t,c)=>t+(c.totalDiscountReceived||0),0)),"."]})]})})]}),e.jsxs(H,{value:"repeat",className:"mt-4",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-purple-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Rank"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Customer"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Total Spent"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Transactions"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Discounts"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Membership"}),e.jsx("th",{className:"text-center p-3 text-sm font-semibold text-gray-700",children:"Status"})]})}),e.jsx("tbody",{children:a.topRepeatSpenders.map((t,c)=>e.jsxs("tr",{className:"border-t hover:bg-purple-50 cursor-pointer transition-colors",onClick:()=>i({isOpen:!0,type:"spender",title:`${t.customerName} - Transaction History`,spenderData:t}),children:[e.jsxs("td",{className:"p-3 text-sm text-gray-600",children:["#",c+1]}),e.jsx("td",{className:"p-3 text-sm text-gray-900 font-medium",children:t.customerName}),e.jsx("td",{className:"p-3 text-sm text-gray-600",children:t.customerEmail}),e.jsx("td",{className:"p-3 text-sm text-gray-900 text-right font-semibold",children:n(t.totalSpent)}),e.jsx("td",{className:"p-3 text-sm text-gray-600 text-right",children:m(t.transactions)}),e.jsx("td",{className:"p-3 text-sm text-orange-600 text-right font-medium",children:n(t.totalDiscountReceived||0)}),e.jsx("td",{className:"p-3 text-sm text-gray-600",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium truncate max-w-xs",children:t.lastMembershipName||"N/A"}),t.lastMembershipEndDate&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Ends: ",new Date(t.lastMembershipEndDate).toLocaleDateString()]})]})}),e.jsx("td",{className:"p-3 text-center",children:e.jsx(C,{variant:"default",className:`text-xs ${t.membershipStatus==="Active"?"bg-green-100 text-green-700":t.membershipStatus==="Frozen"?"bg-blue-100 text-blue-700":t.membershipStatus==="Expired"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`,children:t.membershipStatus||"None"})})]},c))})]})}),e.jsx("div",{className:"mt-4 p-4 bg-purple-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-purple-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Repeat Customer High-Value Analysis:"})," Top ",a.topRepeatSpenders.length," repeat customer spenders contributed ",n(a.topRepeatSpenders.reduce((t,c)=>t+c.totalSpent,0)),", representing ",f(a.topRepeatSpenders.reduce((t,c)=>t+c.totalSpent,0)/a.totalRevenue*100)," of total revenue. These loyal customers demonstrate consistent engagement with average: ",n(a.topRepeatSpenders.reduce((t,c)=>t+c.totalSpent,0)/Math.max(a.topRepeatSpenders.length,1))," per customer."]})]})})]})]})})]}),e.jsxs(x,{children:[e.jsx(P,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(St,{className:"w-5 h-5 text-gray-600"}),"Bottom 20 Spenders - New vs Repeat Customers"]})}),e.jsx(h,{children:e.jsxs(J,{defaultValue:"new",className:"w-full",children:[e.jsxs(Q,{className:"grid w-full grid-cols-2",children:[e.jsxs(O,{value:"new",children:["New Customers (",a.bottomNewSpenders?.length||0,")"]}),e.jsxs(O,{value:"repeat",children:["Repeat Customers (",a.bottomRepeatSpenders?.length||0,")"]})]}),e.jsxs(H,{value:"new",className:"mt-4",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Customer"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Total Spent"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Transactions"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Membership"}),e.jsx("th",{className:"text-center p-3 text-sm font-semibold text-gray-700",children:"Status"})]})}),e.jsx("tbody",{children:a.bottomNewSpenders.map((t,c)=>e.jsxs("tr",{className:"border-t hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>i({isOpen:!0,type:"spender",title:`${t.customerName} - Transaction History`,spenderData:t}),children:[e.jsx("td",{className:"p-3 text-sm text-gray-900 font-medium",children:t.customerName}),e.jsx("td",{className:"p-3 text-sm text-gray-600",children:t.customerEmail}),e.jsx("td",{className:"p-3 text-sm text-gray-900 text-right",children:n(t.totalSpent)}),e.jsx("td",{className:"p-3 text-sm text-gray-600 text-right",children:m(t.transactions)}),e.jsx("td",{className:"p-3 text-sm text-gray-600 truncate max-w-xs",children:t.lastMembershipName||"N/A"}),e.jsx("td",{className:"p-3 text-center",children:e.jsx(C,{variant:"default",className:`text-xs ${t.membershipStatus==="Active"?"bg-green-100 text-green-700":t.membershipStatus==="Frozen"?"bg-blue-100 text-blue-700":t.membershipStatus==="Expired"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`,children:t.membershipStatus||"None"})})]},c))})]})}),e.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-gray-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"New Customer Growth Opportunity:"})," These new customers represent upselling potential through targeted engagement. Many may be trial or single-purchase customers discovering your offerings. Nurture campaigns could convert them into higher-value relationships."]})]})})]}),e.jsxs(H,{value:"repeat",className:"mt-4",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Customer"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Total Spent"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Transactions"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Membership"}),e.jsx("th",{className:"text-center p-3 text-sm font-semibold text-gray-700",children:"Status"})]})}),e.jsx("tbody",{children:a.bottomRepeatSpenders.map((t,c)=>e.jsxs("tr",{className:"border-t hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>i({isOpen:!0,type:"spender",title:`${t.customerName} - Transaction History`,spenderData:t}),children:[e.jsx("td",{className:"p-3 text-sm text-gray-900 font-medium",children:t.customerName}),e.jsx("td",{className:"p-3 text-sm text-gray-600",children:t.customerEmail}),e.jsx("td",{className:"p-3 text-sm text-gray-900 text-right",children:n(t.totalSpent)}),e.jsx("td",{className:"p-3 text-sm text-gray-600 text-right",children:m(t.transactions)}),e.jsx("td",{className:"p-3 text-sm text-gray-600 truncate max-w-xs",children:t.lastMembershipName||"N/A"}),e.jsx("td",{className:"p-3 text-center",children:e.jsx(C,{variant:"default",className:`text-xs ${t.membershipStatus==="Active"?"bg-green-100 text-green-700":t.membershipStatus==="Frozen"?"bg-blue-100 text-blue-700":t.membershipStatus==="Expired"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`,children:t.membershipStatus||"None"})})]},c))})]})}),e.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-gray-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Repeat Customer Retention Insight:"})," These lower-value repeat customers show continued loyalty despite modest spending. Re-engagement campaigns and personalized offers could help increase their lifetime value while maintaining the relationship."]})]})})]})]})})]}),e.jsxs(x,{children:[e.jsx(P,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-red-600"}),"Lapsed Members (Top 50 by Lifetime Value)"]})}),e.jsxs(h,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Customer"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Last Membership"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Lapsed Date"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Days Since"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Lifetime Value"})]})}),e.jsx("tbody",{children:a.lapsedMembers.slice(0,50).map((t,c)=>e.jsxs("tr",{className:"border-t hover:bg-red-50 cursor-pointer transition-colors",onClick:()=>i({isOpen:!0,type:"lapsed",title:`${t.customerName} - Lapsed Member Details`,lapsedData:t}),children:[e.jsx("td",{className:"p-3 text-sm text-gray-900 font-medium",children:t.customerName}),e.jsx("td",{className:"p-3 text-sm text-gray-600",children:t.customerEmail}),e.jsx("td",{className:"p-3 text-sm text-gray-600",children:t.lastMembershipType}),e.jsx("td",{className:"p-3 text-sm text-gray-600 text-right",children:t.lastMembershipEndDate}),e.jsx("td",{className:"p-3 text-sm text-red-600 text-right font-medium",children:m(t.daysSinceLapsed)}),e.jsx("td",{className:"p-3 text-sm text-gray-900 text-right font-semibold",children:n(t.totalLifetimeValue)})]},c))})]})}),e.jsx("div",{className:"mt-4 p-4 bg-red-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Critical Churn Risk:"})," ",a.lapsedMembers.length," high-value members have lapsed memberships. Combined lifetime value: ",n(a.lapsedMembers.reduce((t,c)=>t+c.totalLifetimeValue,0)),". These are proven customers with significant historical spend - immediate win-back campaigns targeting these members could recover substantial revenue. Prioritize those lapsed within 30-60 days for highest conversion probability."]})]})})]})]}),e.jsxs(x,{children:[e.jsx(P,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5 text-orange-600"}),"Discount & Promotion Analytics"]})}),e.jsxs(h,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-4 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-600",children:n(a.totalDiscountGiven)}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Total Discounts Given"})]}),e.jsxs("div",{className:"text-center p-4 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-600",children:m(a.transactionsWithDiscount)}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Transactions with Discount"})]}),e.jsxs("div",{className:"text-center p-4 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-600",children:f(a.avgDiscountPercentage)}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Average Discount %"})]})]}),e.jsx("div",{className:"mt-4 p-4 bg-orange-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-orange-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Promotion Impact:"})," ",f(a.transactionsWithDiscount/a.dailyAnalytics.reduce((t,c)=>t+c.transactions,0)*100)," of transactions used discounts, resulting in ",n(a.totalDiscountGiven)," in revenue reduction. Average discount of ",f(a.avgDiscountPercentage)," suggests ",a.avgDiscountPercentage>15?"aggressive":"moderate"," promotional activity. Monitor discount dependency to ensure long-term profitability while maintaining customer acquisition momentum."]})]})})]})]}),e.jsxs(x,{children:[e.jsx(P,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-blue-600"}),"Visit & Engagement Analytics"]})}),e.jsxs(h,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:m(a.totalVisits)}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Total Check-ins"})]}),e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:a.avgVisitsPerClient.toFixed(1)}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Avg Visits per Client"})]}),e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:a.visitToRevenueRatio.toFixed(2)}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Visits per ₹1K Revenue"})]})]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Engagement Pattern:"})," ",a.totalVisits," check-ins demonstrate strong facility utilization. Average of ",a.avgVisitsPerClient.toFixed(1)," visits per client indicates ",a.avgVisitsPerClient>8?"high":a.avgVisitsPerClient>4?"moderate":"low"," engagement levels. The visit-to-revenue ratio of ",a.visitToRevenueRatio.toFixed(2)," helps benchmark operational efficiency and pricing adequacy relative to usage patterns."]})]})})]})]}),e.jsx(Rt,{isOpen:b.isOpen,onClose:()=>i({...b,isOpen:!1}),data:b}),e.jsx(He,{open:!!p,onOpenChange:()=>L(null),children:e.jsxs(qe,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(Ue,{children:[e.jsxs(Be,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5 text-purple-600"}),"Stacked Memberships Details"]}),e.jsx(it,{children:p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-base font-semibold text-gray-900 mt-2",children:p.customerName}),e.jsx("div",{className:"text-sm text-gray-600",children:p.customerEmail})]})})]}),p&&e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 bg-purple-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Memberships"}),e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:p.totalMemberships})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Amount Paid"}),e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:n(p.totalAmountPaid)})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Membership Breakdown"}),e.jsx("div",{className:"space-y-3",children:p.memberships.map((t,c)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-semibold text-gray-900 text-lg",children:t.membershipName}),e.jsx(C,{variant:"outline",className:"mt-1",children:t.category})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:n(t.amountPaid)}),t.discountAmount&&t.discountAmount>0&&e.jsxs("div",{className:"text-sm text-orange-600 font-medium mt-1",children:["Save ",n(t.discountAmount)]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Purchase Date"}),e.jsx("div",{className:"font-medium text-gray-900",children:new Date(t.purchaseDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]}),t.endDate&&e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Expiry Date"}),e.jsx("div",{className:"font-medium text-gray-900",children:new Date(t.endDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]})]})]},c))})]}),e.jsx("div",{className:"p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Member Value:"})," This customer purchased ",p.totalMemberships," memberships for a total of ",n(p.totalAmountPaid),", averaging ",n(p.totalAmountPaid/p.totalMemberships)," per membership.",p.memberships.some(t=>t.discountAmount&&t.discountAmount>0)&&e.jsxs(e.Fragment,{children:[" They saved a total of ",n(p.memberships.reduce((t,c)=>t+(c.discountAmount||0),0))," through discounts."]})]})]})})]})]})})]})},Pt=({salesData:a,checkinsData:R=[],newClientData:y=[]})=>{const[V,F]=q.useState("april"),[p,L]=q.useState("kwality"),b=q.useMemo(()=>{const u=V==="april"?{year:2025,monthIndex:3}:{year:2025,monthIndex:7},N=a.filter(t=>{if(!t.paymentDate)return!1;const c=new Date(t.paymentDate);return c.getFullYear()===u.year&&c.getMonth()===u.monthIndex&&t.paymentStatus==="succeeded"}),D=new Set(N.map(t=>t.calculatedLocation||"Unknown"));return["all",...Array.from(D).sort()]},[a,V]),i=de(a,R,y,"april",void 0),d=de(a,R,y,"august",void 0),I=de(a,R,y,"april",p!=="all"?p:void 0),k=de(a,R,y,"august",p!=="all"?p:void 0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:e.jsxs(x,{className:"bg-gradient-to-br from-blue-50 to-white border-blue-200 hover:shadow-xl transition-shadow",children:[e.jsx(P,{children:e.jsxs(E,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-blue-600"}),"April 2025"]}),e.jsxs(C,{className:"bg-blue-100 text-blue-700",children:[m(i.totalClients)," Clients"]})]})}),e.jsxs(h,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Revenue"}),e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:n(i.totalRevenue)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-emerald-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"New Clients"}),e.jsx("div",{className:"text-lg font-bold text-emerald-600",children:n(i.newClientRevenue)}),e.jsx("div",{className:"text-xs text-gray-500",children:f(i.newClientRevenue/i.totalRevenue*100)})]}),e.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Existing"}),e.jsx("div",{className:"text-lg font-bold text-purple-600",children:n(i.existingClientRevenue)}),e.jsx("div",{className:"text-xs text-gray-500",children:f(i.existingClientRevenue/i.totalRevenue*100)})]})]})]})]})}),e.jsx(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.1},children:e.jsxs(x,{className:"bg-gradient-to-br from-purple-50 to-white border-purple-200 hover:shadow-xl transition-shadow",children:[e.jsx(P,{children:e.jsxs(E,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-purple-600"}),"August 2025"]}),e.jsxs(C,{className:"bg-purple-100 text-purple-700",children:[m(d.totalClients)," Clients"]})]})}),e.jsxs(h,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Revenue"}),e.jsx("span",{className:"text-2xl font-bold text-purple-600",children:n(d.totalRevenue)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-emerald-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"New Clients"}),e.jsx("div",{className:"text-lg font-bold text-emerald-600",children:n(d.newClientRevenue)}),e.jsx("div",{className:"text-xs text-gray-500",children:f(d.newClientRevenue/d.totalRevenue*100)})]}),e.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Existing"}),e.jsx("div",{className:"text-lg font-bold text-purple-600",children:n(d.existingClientRevenue)}),e.jsx("div",{className:"text-xs text-gray-500",children:f(d.existingClientRevenue/d.totalRevenue*100)})]})]})]})]})})]}),e.jsx(x,{className:"bg-gradient-to-br from-amber-50 to-white border-amber-200",children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(oe,{className:"w-6 h-6 text-amber-600 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-lg text-gray-900 mb-2",children:"Month-over-Month Comparison"}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Revenue Difference:"})," ",d.totalRevenue>i.totalRevenue?"August":"April"," generated ",n(Math.abs(d.totalRevenue-i.totalRevenue))," more (",f(Math.abs((d.totalRevenue-i.totalRevenue)/i.totalRevenue)*100)," change)."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Client Acquisition:"})," April brought in ",m(i.newClients)," new clients vs August's ",m(d.newClients),"."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Member Behavior:"})," April saw ",m(i.renewals+i.upgrades)," renewals/upgrades, while August had ",m(d.renewals+d.upgrades),"."]})]})]})]})})}),e.jsxs(J,{value:V,onValueChange:u=>F(u),className:"w-full",children:[e.jsxs(Q,{className:"bg-white/90 backdrop-blur-sm p-2 rounded-2xl shadow-xl border-0 grid grid-cols-2 gap-3 w-full max-w-md mx-auto",children:[e.jsxs(O,{value:"april",className:"relative rounded-xl px-6 py-3 font-semibold text-base w-full justify-center min-h-[48px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-600 data-[state=active]:to-cyan-600 data-[state=active]:text-white data-[state=active]:shadow-lg hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"April 2025"]}),e.jsxs(O,{value:"august",className:"relative rounded-xl px-6 py-3 font-semibold text-base w-full justify-center min-h-[48px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-purple-600 data-[state=active]:to-pink-600 data-[state=active]:text-white data-[state=active]:shadow-lg hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"August 2025"]})]}),e.jsx(H,{value:"april",className:"mt-8 space-y-6",children:e.jsxs(J,{value:p,onValueChange:L,className:"w-full",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Location"})]}),e.jsx(Ie,{context:"outlier-analysis-overview",locationId:p==="all"?"all":p})]}),e.jsx(Q,{className:"bg-gray-100 p-1 rounded-lg inline-flex flex-wrap gap-2",children:b.map(u=>e.jsx(O,{value:u,className:"px-4 py-2 rounded-md text-sm font-medium data-[state=active]:bg-blue-600 data-[state=active]:text-white hover:bg-gray-200",children:u==="all"?"All Locations":u},u))})]}),b.map(u=>e.jsx(H,{value:u,className:"mt-6",children:e.jsx(Oe,{analytics:u==="all"?i:I,monthName:"April 2025",locationName:u==="all"?"All Locations":u})},u))]})}),e.jsx(H,{value:"august",className:"mt-8 space-y-6",children:e.jsxs(J,{value:p,onValueChange:L,className:"w-full",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Location"})]}),e.jsx(Ie,{context:"outlier-analysis-overview",locationId:p==="all"?"all":p})]}),e.jsx(Q,{className:"bg-gray-100 p-1 rounded-lg inline-flex flex-wrap gap-2",children:b.map(u=>e.jsx(O,{value:u,className:"px-4 py-2 rounded-md text-sm font-medium data-[state=active]:bg-purple-600 data-[state=active]:text-white hover:bg-gray-200",children:u==="all"?"All Locations":u},u))})]}),b.map(u=>e.jsx(H,{value:u,className:"mt-6",children:e.jsx(Oe,{analytics:u==="all"?d:k,monthName:"August 2025",locationName:u==="all"?"All Locations":u})},u))]})})]})]})},Et=()=>{const{data:a,loading:R,error:y,refetch:V}=xt(),{data:F,loading:p}=ht(),{data:L,loading:b}=ut(),{data:i,loading:d}=gt(),{data:I,loading:k}=pt(),{data:u,loading:N}=jt(),{setLoading:D}=ct(),t=R||p||b||d||k||N,c=y;dt.useCallback(()=>{D(!1)},[D]),q.useEffect(()=>{D(t,"Loading outlier analysis data...")},[t,D]);const Z=q.useMemo(()=>{if(!a||a.length===0)return[];const Y=a.filter(v=>{if(!v.paymentDate)return!1;const M=new Date(v.paymentDate),U=M.getFullYear(),_=M.getMonth();return U===2025&&_===3}),w=a.filter(v=>{if(!v.paymentDate)return!1;const M=new Date(v.paymentDate),U=M.getFullYear(),_=M.getMonth();return U===2025&&_===7}),T=Y.reduce((v,M)=>v+(M.paymentValue||0),0),G=w.reduce((v,M)=>v+(M.paymentValue||0),0),me=Y.length,te=w.length,se=new Set(Y.filter(v=>{const M=(v.cleanedProduct||v.paymentItem||"").toLowerCase();return M.includes("intro")||M.includes("new client")||M.includes("trial")||M.includes("first time")}).map(v=>v.memberId||v.customerEmail)).size,ae=new Set(w.filter(v=>{const M=(v.cleanedProduct||v.paymentItem||"").toLowerCase();return M.includes("intro")||M.includes("new client")||M.includes("trial")||M.includes("first time")}).map(v=>v.memberId||v.customerEmail)).size;return[{location:"April 2025",label:"Total Revenue",value:n(T),subValue:`${m(me)} transactions`},{location:"August 2025",label:"Total Revenue",value:n(G),subValue:`${m(te)} transactions`},{location:"April 2025",label:"New Clients",value:m(se),subValue:"First-time purchases"},{location:"August 2025",label:"New Clients",value:m(ae),subValue:"First-time purchases"}]},[a]);return t?e.jsxs("div",{className:"min-h-screen bg-white relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute top-20 left-10 w-96 h-96 bg-gradient-to-r from-indigo-500/10 to-purple-500/10 rounded-full floating-animation stagger-1"}),e.jsx("div",{className:"absolute bottom-20 right-10 w-80 h-80 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-full floating-animation stagger-3"}),e.jsx("div",{className:"absolute top-1/2 left-1/3 w-72 h-72 bg-gradient-to-r from-cyan-500/10 to-teal-500/10 rounded-full morph-shape stagger-2"})]}),e.jsx("div",{className:"relative z-10",children:e.jsx("div",{className:"container mx-auto px-6 py-10",children:e.jsx(At,{type:"full-page"})})})]}):c?e.jsxs("div",{className:"min-h-screen bg-white relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute top-20 left-10 w-96 h-96 bg-gradient-to-r from-indigo-500/10 to-purple-500/10 rounded-full floating-animation stagger-1"}),e.jsx("div",{className:"absolute bottom-20 right-10 w-80 h-80 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-full floating-animation stagger-3"})]}),e.jsx("div",{className:"relative z-10",children:e.jsx("div",{className:"container mx-auto px-6 py-10",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 p-6 rounded-2xl shadow-sm",children:[e.jsx("div",{className:"font-semibold text-lg mb-1",children:"Failed to load outlier analysis data"}),e.jsx("div",{className:"text-sm opacity-90 mb-4",children:String(c)}),e.jsx("button",{onClick:V,className:"px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 transition",children:"Retry"})]})})})]}):e.jsxs("div",{className:"min-h-screen bg-white relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute top-20 left-10 w-96 h-96 bg-gradient-to-r from-indigo-500/10 to-purple-500/10 rounded-full floating-animation stagger-1"}),e.jsx("div",{className:"absolute bottom-20 right-10 w-80 h-80 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-full floating-animation stagger-3"}),e.jsx("div",{className:"absolute top-1/2 left-1/3 w-72 h-72 bg-gradient-to-r from-cyan-500/10 to-teal-500/10 rounded-full morph-shape stagger-2"})]}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"bg-white text-slate-800 slide-in-from-left",children:[e.jsx(mt,{title:"Outlier Analysis: April & August 2025",subtitle:"Deep dive into performance drivers, client acquisition patterns, and revenue composition for exceptional months",metrics:Z,onExportClick:()=>{}}),e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsx(Pt,{salesData:a||[],sessionsData:F||[],checkinsData:L||[],expirationsData:i||[],leadsData:I||[],newClientData:u||[]})})]}),e.jsx(ot,{})]})]})},os=()=>e.jsx(lt,{children:e.jsx(Et,{})});export{os as default};
//# sourceMappingURL=OutlierAnalysis-dK2F3We_.js.map
