import{i as G,r as O,j as e,D as q,n as K,o as V,q as X,B as k,X as J,C as d,a as g,b as f,c as o,f as R}from"./index-Bm67KBkU.js";import{a as r,f as b,b as w,B}from"./index-DkD_C-d1.js";import{T as Q,a as Y,b as C,c as S}from"./tabs-BTrhdLSC.js";import{T as Z,a as _,b as M,c as m,d as ee,e as x}from"./table-DhXofKdS.js";import{T}from"./target-BmxdxojS.js";import{C as A,T as se}from"./googleAuth-BGo8ElRc.js";import{C as F}from"./clock-BP1BFskn.js";import{D as H,C as te}from"./dollar-sign-CKqx8kbC.js";import{D as ae}from"./SalesMotionHero-sGphstF2.js";import{U as le}from"./users-7Ku-1TDB.js";import{A as ne}from"./activity-CeUP9h5f.js";import{A as ie}from"./award-D0x2LQSI.js";import{T as re}from"./trending-down-B5K1omnR.js";const ce=G("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]),we=({isOpen:P,onClose:D,data:p})=>{const[U,$]=O.useState("overview"),i=O.useMemo(()=>{if(!p?.sessions||p.sessions.length===0)return{summary:{totalSessions:0,totalAttendance:0,totalCapacity:0,totalRevenue:0,totalBookings:0,totalCancellations:0,fillRate:0,classAverage:0,revenuePerSession:0,revenuePerAttendee:0,cancellationRate:0,bookingRate:0,emptySessions:0,fullSessions:0},timeSeries:[],topSessions:[],patterns:{dayOfWeek:{},timeSlot:{},trainer:{}},recommendations:[]};const s=p.sessions,l=s.length,u=s.reduce((t,a)=>t+(a.checkedInCount||0),0),j=s.reduce((t,a)=>t+(a.capacity||0),0),c=s.reduce((t,a)=>t+(a.totalPaid||0),0),v=s.reduce((t,a)=>t+(a.bookedCount||0),0),I=s.reduce((t,a)=>t+(a.lateCancelledCount||0),0),y={totalSessions:l,totalAttendance:u,totalCapacity:j,totalRevenue:c,totalBookings:v,totalCancellations:I,fillRate:j>0?u/j*100:0,classAverage:l>0?u/l:0,revenuePerSession:l>0?c/l:0,revenuePerAttendee:u>0?c/u:0,cancellationRate:v>0?I/v*100:0,bookingRate:j>0?v/j*100:0,emptySessions:s.filter(t=>(t.checkedInCount||0)===0).length,fullSessions:s.filter(t=>(t.checkedInCount||0)>=(t.capacity||0)).length},z=s.reduce((t,a)=>{const n=a.date;return t[n]||(t[n]={date:n,value:0,sessions:0,attendance:0,revenue:0}),t[n].sessions+=1,t[n].attendance+=a.checkedInCount||0,t[n].revenue+=a.totalPaid||0,t[n].value=t[n].attendance,t},{}),E=Object.values(z).sort((t,a)=>new Date(t.date).getTime()-new Date(a.date).getTime()),W=[...s].sort((t,a)=>{const n=(t.capacity||0)>0?(t.checkedInCount||0)/(t.capacity||0)*100:0;return((a.capacity||0)>0?(a.checkedInCount||0)/(a.capacity||0)*100:0)-n}),L={dayOfWeek:s.reduce((t,a)=>{const n=a.dayOfWeek||"Unknown";return t[n]||(t[n]={sessions:0,attendance:0,revenue:0}),t[n].sessions+=1,t[n].attendance+=a.checkedInCount||0,t[n].revenue+=a.totalPaid||0,t},{}),timeSlot:s.reduce((t,a)=>{const n=a.time||"Unknown";return t[n]||(t[n]={sessions:0,attendance:0,revenue:0}),t[n].sessions+=1,t[n].attendance+=a.checkedInCount||0,t[n].revenue+=a.totalPaid||0,t},{}),trainer:s.reduce((t,a)=>{const n=a.trainerName||"Unknown";return t[n]||(t[n]={sessions:0,attendance:0,revenue:0}),t[n].sessions+=1,t[n].attendance+=a.checkedInCount||0,t[n].revenue+=a.totalPaid||0,t},{})},N=[];return y.fillRate<60&&N.push({type:"improvement",title:"Low Fill Rate Detected",description:"Consider reducing class capacity or improving marketing for this segment.",impact:"High",icon:T}),y.emptySessions>l*.1&&N.push({type:"warning",title:"High Empty Session Rate",description:"Too many sessions with zero attendance. Review scheduling strategy.",impact:"Medium",icon:A}),y.cancellationRate>15&&N.push({type:"attention",title:"High Cancellation Rate",description:"Consider improving cancellation policies or class appeal.",impact:"Medium",icon:F}),y.revenuePerSession>c/l*1.2&&N.push({type:"success",title:"Strong Revenue Performance",description:"This segment is performing above average in revenue generation.",impact:"Positive",icon:H}),{summary:y,timeSeries:E,topSessions:W,patterns:L,recommendations:N}},[p]);if(!P||!p)return null;const h=({title:s,value:l,subtitle:u,icon:j,trend:c,change:v})=>e.jsx(d,{className:"bg-white border-slate-200",children:e.jsxs(o,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-slate-100 rounded-lg",children:e.jsx(j,{className:"w-4 h-4 text-slate-600"})}),c&&v!==void 0&&e.jsxs("div",{className:R("flex items-center gap-1 text-xs",c==="up"?"text-green-600":c==="down"?"text-red-600":"text-slate-600"),children:[c==="up"?e.jsx(se,{className:"w-3 h-3"}):c==="down"?e.jsx(re,{className:"w-3 h-3"}):null,Math.abs(v).toFixed(1),"%"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-lg font-bold text-slate-900",children:l}),e.jsx("div",{className:"text-xs text-slate-600",children:s}),u&&e.jsx("div",{className:"text-xs text-slate-500",children:u})]})]})});return e.jsx(q,{open:P,onOpenChange:D,children:e.jsxs(K,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(V,{className:"border-b border-slate-200 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(X,{className:"text-xl font-semibold text-slate-900",children:p.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Export"]}),e.jsxs(k,{variant:"outline",size:"sm",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Share"]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:D,children:e.jsx(J,{className:"w-4 h-4"})})]})]})}),e.jsxs(Q,{value:U,onValueChange:$,className:"w-full",children:[e.jsxs(Y,{className:"grid w-full grid-cols-5",children:[e.jsx(C,{value:"overview",children:"Overview"}),e.jsx(C,{value:"sessions",children:"Sessions"}),e.jsx(C,{value:"patterns",children:"Patterns"}),e.jsx(C,{value:"trends",children:"Trends"}),e.jsx(C,{value:"insights",children:"Insights"})]}),e.jsxs(S,{value:"overview",className:"space-y-6 mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(h,{title:"Total Sessions",value:r(i.summary.totalSessions),subtitle:`${i.summary.emptySessions} empty`,icon:A}),e.jsx(h,{title:"Total Attendance",value:r(i.summary.totalAttendance),subtitle:`${r(i.summary.classAverage)} avg per class`,icon:le}),e.jsx(h,{title:"Earned Revenue",value:b(i.summary.totalRevenue),subtitle:`${b(i.summary.revenuePerSession)} per session`,icon:H}),e.jsx(h,{title:"Fill Rate",value:w(i.summary.fillRate),subtitle:`${i.summary.fullSessions} full sessions`,icon:T})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(h,{title:"Booking Rate",value:w(i.summary.bookingRate),subtitle:`${r(i.summary.totalBookings)} bookings`,icon:te}),e.jsx(h,{title:"Cancellation Rate",value:w(i.summary.cancellationRate),subtitle:`${r(i.summary.totalCancellations)} cancellations`,icon:F}),e.jsx(h,{title:"Revenue per Attendee",value:b(i.summary.revenuePerAttendee),subtitle:"Average customer value",icon:ne}),e.jsx(h,{title:"Capacity Utilization",value:w(i.summary.fillRate),subtitle:`${r(i.summary.totalCapacity)} total capacity`,icon:T})]}),e.jsxs(d,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200",children:[e.jsx(g,{children:e.jsx(f,{className:"text-blue-900",children:"Performance Summary"})}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-800",children:i.summary.fillRate>75?"Excellent":i.summary.fillRate>60?"Good":i.summary.fillRate>40?"Average":"Needs Improvement"}),e.jsx("div",{className:"text-sm text-blue-600",children:"Overall Rating"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-800",children:r(i.timeSeries.length)}),e.jsx("div",{className:"text-sm text-blue-600",children:"Days Active"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-800",children:r(i.summary.classAverage)}),e.jsx("div",{className:"text-sm text-blue-600",children:"Avg Class Size"})]})]})})]})]}),e.jsx(S,{value:"sessions",className:"space-y-6 mt-6",children:e.jsxs(d,{children:[e.jsx(g,{children:e.jsx(f,{children:"Session Details"})}),e.jsx(o,{className:"max-h-[500px] overflow-y-auto",children:e.jsxs(Z,{children:[e.jsx(_,{children:e.jsxs(M,{children:[e.jsx(m,{children:"Date"}),e.jsx(m,{children:"Class"}),e.jsx(m,{children:"Trainer"}),e.jsx(m,{children:"Time"}),e.jsx(m,{children:"Location"}),e.jsx(m,{children:"Attendance"}),e.jsx(m,{children:"Capacity"}),e.jsx(m,{children:"Fill Rate"}),e.jsx(m,{children:"Revenue"})]})}),e.jsx(ee,{children:i.topSessions.map((s,l)=>e.jsxs(M,{children:[e.jsx(x,{children:s.date}),e.jsx(x,{className:"font-medium",children:s.cleanedClass}),e.jsx(x,{children:s.trainerName}),e.jsx(x,{children:s.time}),e.jsx(x,{children:s.location}),e.jsx(x,{children:s.checkedInCount||0}),e.jsx(x,{children:s.capacity||0}),e.jsx(x,{children:e.jsx(B,{variant:(s.checkedInCount||0)/(s.capacity||1)>.8?"default":(s.checkedInCount||0)/(s.capacity||1)>.6?"secondary":"destructive",children:w((s.capacity||0)>0?(s.checkedInCount||0)/(s.capacity||0)*100:0)})}),e.jsx(x,{children:b(s.totalPaid||0)})]},l))})]})})]})}),e.jsx(S,{value:"patterns",className:"space-y-6 mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(d,{children:[e.jsx(g,{children:e.jsx(f,{className:"text-sm font-medium",children:"Day of Week Performance"})}),e.jsx(o,{className:"space-y-3",children:Object.entries(i.patterns.dayOfWeek).sort(([,s],[,l])=>l.attendance-s.attendance).map(([s,l])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:s}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-bold",children:r(l.attendance)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[l.sessions," sessions"]})]})]},s))})]}),e.jsxs(d,{children:[e.jsx(g,{children:e.jsx(f,{className:"text-sm font-medium",children:"Time Slot Performance"})}),e.jsx(o,{className:"space-y-3 max-h-[300px] overflow-y-auto",children:Object.entries(i.patterns.timeSlot).sort(([,s],[,l])=>l.attendance-s.attendance).map(([s,l])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:s}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-bold",children:r(l.attendance)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[l.sessions," sessions"]})]})]},s))})]}),e.jsxs(d,{children:[e.jsx(g,{children:e.jsx(f,{className:"text-sm font-medium",children:"Trainer Performance"})}),e.jsx(o,{className:"space-y-3 max-h-[300px] overflow-y-auto",children:Object.entries(i.patterns.trainer).sort(([,s],[,l])=>l.attendance-s.attendance).map(([s,l])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium truncate",children:s}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-bold",children:r(l.attendance)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[l.sessions," sessions"]})]})]},s))})]})]})}),e.jsx(S,{value:"trends",className:"space-y-6 mt-6",children:e.jsxs(d,{children:[e.jsx(g,{children:e.jsx(f,{children:"Performance Trends"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-4 max-h-[400px] overflow-y-auto",children:i.timeSeries.map((s,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"w-4 h-4 text-slate-500"}),e.jsx("span",{className:"font-medium",children:s.date})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold",children:s.sessions}),e.jsx("div",{className:"text-slate-500",children:"Sessions"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold",children:s.attendance}),e.jsx("div",{className:"text-slate-500",children:"Attendance"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold",children:b(s.revenue)}),e.jsx("div",{className:"text-slate-500",children:"Revenue"})]})]})]},s.date))})})]})}),e.jsx(S,{value:"insights",className:"space-y-6 mt-6",children:e.jsxs("div",{className:"space-y-4",children:[i.recommendations.map((s,l)=>e.jsx(d,{className:R("border-l-4",s.type==="success"?"border-l-green-500 bg-green-50":s.type==="warning"?"border-l-yellow-500 bg-yellow-50":s.type==="improvement"?"border-l-blue-500 bg-blue-50":"border-l-red-500 bg-red-50"),children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:R("p-2 rounded-lg",s.type==="success"?"bg-green-100 text-green-700":s.type==="warning"?"bg-yellow-100 text-yellow-700":s.type==="improvement"?"bg-blue-100 text-blue-700":"bg-red-100 text-red-700"),children:e.jsx(s.icon,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-slate-900",children:s.title}),e.jsxs(B,{variant:"outline",className:"text-xs",children:[s.impact," Impact"]})]}),e.jsx("p",{className:"text-sm text-slate-600",children:s.description})]})]})})},l)),i.recommendations.length===0&&e.jsx(d,{className:"border-l-4 border-l-green-500 bg-green-50",children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(ie,{className:"w-4 h-4 text-green-700"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900",children:"Great Performance!"}),e.jsx("p",{className:"text-sm text-slate-600",children:"This segment is performing well across all key metrics. Keep up the excellent work!"})]})]})})})]})})]})]})})};export{we as DrillDownAnalyticsModal};
//# sourceMappingURL=DrillDownAnalyticsModal-DZN5JBRg.js.map
