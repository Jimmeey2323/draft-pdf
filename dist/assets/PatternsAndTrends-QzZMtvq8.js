import{i as Ys,r as k,j as e,C as I,c as P,a as D,b as O,m as ls,T as _e,d as Gs,u as Js,h as Ss,G as Is,B as J,f as H,A as ns,E as rs,F as is,I as os}from"./index-Bm67KBkU.js";import{a as x,B as A,f as ke,b as X,d as Fe}from"./index-DkD_C-d1.js";import{T as cs,a as ds,b as ue,c as w,d as ms,e as b}from"./table-DhXofKdS.js";import{u as Ws}from"./useCheckinsData-DGPJRptq.js";import{u as Xs}from"./useSalesData-Bl_2HqTc.js";import{A as ys,c as Qs,b as Ts}from"./SalesMotionHero-sGphstF2.js";import{C as ws}from"./CopyTableButton-Blm2CDq4.js";import{u as ks}from"./useRegisterTableForCopy-Dn-WXpBr.js";import{u as _s}from"./useTableCopyContext-DkJKZq95.js";import{T as qs,a as Ls,b as Me,c as Re}from"./tabs-BTrhdLSC.js";import{c as Zs,f as et,T as ss,C as qe}from"./googleAuth-BGo8ElRc.js";import{C as Le}from"./circle-alert-bpasmovd.js";import{U as xe}from"./users-7Ku-1TDB.js";import{D as Ge,C as Ce}from"./dollar-sign-CKqx8kbC.js";import{A as We}from"./activity-CeUP9h5f.js";import{T as Je}from"./target-BmxdxojS.js";import{C as fs}from"./circle-x-DIh1Phs9.js";import{A as Cs}from"./award-D0x2LQSI.js";import{R as Ze,a as hs,X as xs,Y as gs,T as es,L as Ps,C as st,B as tt,b as Ms}from"./BarChart-o5Oeg9Jb.js";import{L as Rs,a as bs}from"./LineChart-BWKGpJsm.js";import{P as at,a as lt}from"./PieChart-slnvMcDg.js";import{A as us}from"./arrow-down-right-D7rC7EMG.js";import{C as js}from"./circle-check-big-y8tZauB3.js";import{S as nt}from"./StudioLocationTabs-BSKYatd_.js";import{F as Us}from"./footer-BTvMjyAb.js";import{U as rt}from"./user-plus-B5fZWJk_.js";import{U as Bs}from"./user-check-CLHYCjic.js";import{P as it}from"./package-C0br8ACw.js";import{P as ot}from"./percent-BAS2Szsf.js";import{a as Fs,C as $s}from"./chevron-right-CbIMR3DA.js";import{L as Vs}from"./layout-grid-C68I9Ovt.js";import"./useGoogleSheets-BPVLuLVa.js";import"./dropdown-menu-B9zQ9u84.js";import"./file-text-DChZNHsM.js";const ps=Ys("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),Es=Zs(),ct="16wFlke0bHFcmfn-3UyuYlGnImBq0DY7ouVYAlAFTZys",dt="VC",mt=()=>{const[T,W]=k.useState([]),[ne,fe]=k.useState(!0),[Ae,ge]=k.useState(null),Se=(M,K)=>{const L={},le=/^(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) \d{4} - /,v=new Set;return K.forEach(N=>{if(N.match(le)){const ee=N.split(" - ")[0];v.add(ee)}}),v.forEach(N=>{const ce=K.findIndex(se=>se===`${N} - Booked`),ee=K.findIndex(se=>se===`${N} - Visits`),t=K.findIndex(se=>se===`${N} - Cancellations`),R=K.findIndex(se=>se===`${N} - Paid Amount`),E=K.findIndex(se=>se===`${N} - Unpaid Amount`);ce!==-1&&(L[N]={booked:parseFloat(M[ce]?.toString()||"0")||0,visits:parseFloat(M[ee]?.toString()||"0")||0,cancellations:parseFloat(M[t]?.toString()||"0")||0,paidAmount:parseFloat(M[R]?.toString()||"0")||0,unpaidAmount:parseFloat(M[E]?.toString()||"0")||0})}),L},oe=async()=>{fe(!0),ge(null);try{Es.info("ðŸ”„ Fetching VC member data from Google Sheets...");const M=await et(ct,dt);if(M.length<2)throw new Error("VC sheet appears to be empty");const K=M[0],L=[];for(let le=1;le<M.length;le++){const v=M[le];if(!v||v.length<5||!v[0])continue;const N=v[0]?.toString()||"",ce=v[1]?.toString()||"",ee=v[2]?.toString()||"",t=v[3]?.toString()||"",R=v[4]?.toString()||"",E=Se(v,K);L.push({memberId:N,firstName:ce,lastName:ee,email:t,phone:R,monthlyData:E})}Es.info(`âœ… Loaded ${L.length} members from VC sheet`),W(L)}catch(M){const K=M instanceof Error?M.message:"Unknown error fetching VC data";ge(K)}finally{fe(!1)}};return k.useEffect(()=>{oe()},[]),{data:T,loading:ne,error:Ae,refetch:oe}},ht=T=>k.useMemo(()=>{if(!T||T.length===0)return{performanceMetrics:[],monthlyTrends:[],memberSegments:[],financialInsights:{totalRevenue:0,totalOutstanding:0,collectionEfficiency:0,revenuePerVisit:0,monthlyRevenueData:[]},operationalMetrics:{overallCancellationRate:0,appointmentUtilizationRate:0,totalBookings:0,totalVisits:0,totalCancellations:0,bookingToPaymentConversion:0},predictiveInsights:{churnRiskMembers:[],revenueForecasts:[],paymentRiskMembers:[]},trendAnalysis:{declining:[],increasing:[],correlationInsights:{bookingCancellationCorrelation:0,bookingVisitCorrelation:0,overallPattern:"No data available",highRiskPatterns:[]}},summaryInsights:{totalMembers:0,activeMembers:0,inactiveMembers:0,atRiskMembers:0,averageCancellationRate:0,averageShowUpRate:0,topTrend:"No data available",keyInsight:"No data available",recommendation:"No data available"}};const W=T.map(a=>{let i=0,C=0,Q=0,B=0,S=0;Object.values(a.monthlyData).forEach(u=>{i+=u.booked,C+=u.visits,Q+=u.cancellations,B+=u.paidAmount,S+=u.unpaidAmount});const p=i>0?Q/i*100:0,z=i>0?C/i*100:0,ie=B+S,U=ie>0?B/ie*100:0,q=C>0?B/C:0;return{memberId:a.memberId,fullName:`${a.firstName} ${a.lastName}`.trim(),email:a.email,totalBookings:i,totalVisits:C,totalCancellations:Q,totalPaidAmount:B,totalUnpaidAmount:S,cancellationRate:p,showUpRate:z,paymentCompliance:U,averageTransactionValue:q}}),ne={};T.forEach(a=>{Object.entries(a.monthlyData).forEach(([i,C])=>{ne[i]||(ne[i]={bookings:0,visits:0,cancellations:0,revenue:0,unpaid:0}),ne[i].bookings+=C.booked,ne[i].visits+=C.visits,ne[i].cancellations+=C.cancellations,ne[i].revenue+=C.paidAmount,ne[i].unpaid+=C.unpaidAmount})});const fe=Object.entries(ne).map(([a,i])=>({month:a,totalBookings:i.bookings,totalVisits:i.visits,totalCancellations:i.cancellations,totalRevenue:i.revenue,totalUnpaid:i.unpaid,cancellationRate:i.bookings>0?i.cancellations/i.bookings*100:0,showUpRate:i.bookings>0?i.visits/i.bookings*100:0})).sort((a,i)=>{const C=new Date(a.month);return new Date(i.month).getTime()-C.getTime()}),Ae=W.map(a=>{const i=T.find(S=>S.memberId===a.memberId),Q=(i?Object.keys(i.monthlyData).sort((S,p)=>new Date(p).getTime()-new Date(S).getTime()):[]).find(S=>{const p=i?.monthlyData[S];return p&&(p.visits>0||p.booked>0)});let B="inactive";return a.totalPaidAmount>2e4?B="high-value":a.totalVisits>=20&&a.showUpRate>=80?B="engaged":a.cancellationRate>30||a.paymentCompliance<70?B="unreliable":a.totalVisits>=10&&a.showUpRate>=70?B="reliable":a.totalVisits<5||!Q?B="inactive":(a.showUpRate<60||a.totalVisits<10)&&(B="at-risk"),{memberId:a.memberId,fullName:a.fullName,email:a.email,segment:B,totalRevenue:a.totalPaidAmount,visitFrequency:a.totalVisits,cancellationRate:a.cancellationRate,lastActivityMonth:Q}}),ge=W.reduce((a,i)=>a+i.totalPaidAmount,0),Se=W.reduce((a,i)=>a+i.totalUnpaidAmount,0),oe=ge+Se,M=oe>0?ge/oe*100:0,K=W.reduce((a,i)=>a+i.totalVisits,0),L=K>0?ge/K:0,le=fe.map(a=>({month:a.month,revenue:a.totalRevenue,unpaid:a.totalUnpaid})),v={totalRevenue:ge,totalOutstanding:Se,collectionEfficiency:M,revenuePerVisit:L,monthlyRevenueData:le},N=W.reduce((a,i)=>a+i.totalBookings,0),ce=W.reduce((a,i)=>a+i.totalCancellations,0),ee=N>0?ce/N*100:0,t=N>0?K/N*100:0,R=N>0?ge/N:0,E={overallCancellationRate:ee,appointmentUtilizationRate:t,totalBookings:N,totalVisits:K,totalCancellations:ce,bookingToPaymentConversion:R},se=T.map(a=>{const i=Object.keys(a.monthlyData).sort((U,q)=>new Date(q).getTime()-new Date(U).getTime()),C=i.slice(0,3),Q=i.slice(3,6),B=C.reduce((U,q)=>U+(a.monthlyData[q]?.visits||0),0),S=Q.reduce((U,q)=>U+(a.monthlyData[q]?.visits||0),0),p=S>0?(S-B)/S*100:0,z=Math.min(100,Math.max(0,p*2)),ie=i.find(U=>(a.monthlyData[U]?.visits||0)>0)||"";return{memberId:a.memberId,fullName:`${a.firstName} ${a.lastName}`.trim(),email:a.email,churnScore:z,declineRate:p,lastActiveMonth:ie}}).filter(a=>a.churnScore>40).sort((a,i)=>i.churnScore-a.churnScore).slice(0,20),Pe=fe.slice(0,6),te=Pe.reduce((a,i)=>a+i.totalRevenue,0)/(Pe.length||1),de=[{month:"Dec 2025",forecastedRevenue:te*1.05,confidence:75},{month:"Jan 2026",forecastedRevenue:te*1.08,confidence:65},{month:"Feb 2026",forecastedRevenue:te*1.1,confidence:55}],be=W.filter(a=>a.totalUnpaidAmount>0).map(a=>({memberId:a.memberId,fullName:a.fullName,email:a.email,unpaidAmount:a.totalUnpaidAmount,paymentComplianceRate:a.paymentCompliance})).sort((a,i)=>i.unpaidAmount-a.unpaidAmount).slice(0,20),De={churnRiskMembers:se,revenueForecasts:de,paymentRiskMembers:be},Y=[],pe=[];T.forEach(a=>{const i=Object.keys(a.monthlyData).sort((u,ae)=>new Date(ae).getTime()-new Date(u).getTime());if(i.length<6)return;const C=i.slice(0,3),Q=i.slice(3,6),B=C.reduce((u,ae)=>u+(a.monthlyData[ae]?.booked||0),0)/3,S=Q.reduce((u,ae)=>u+(a.monthlyData[ae]?.booked||0),0)/3,p=C.reduce((u,ae)=>u+(a.monthlyData[ae]?.visits||0),0)/3,z=Q.reduce((u,ae)=>u+(a.monthlyData[ae]?.visits||0),0)/3,ie=C.reduce((u,ae)=>u+(a.monthlyData[ae]?.cancellations||0),0)/3,U=Q.reduce((u,ae)=>u+(a.monthlyData[ae]?.cancellations||0),0)/3,q=`${a.firstName} ${a.lastName}`.trim();if(S>0&&B<S){const u=(B-S)/S*100;u<-15&&Y.push({memberId:a.memberId,fullName:q,email:a.email,metric:"bookings",changeRate:u,recentAvg:B,previousAvg:S})}if(z>0&&p<z){const u=(p-z)/z*100;u<-15&&Y.push({memberId:a.memberId,fullName:q,email:a.email,metric:"visits",changeRate:u,recentAvg:p,previousAvg:z})}if(U>=0&&ie>U){const u=U>0?(ie-U)/U*100:ie>0?100:0;u>20&&ie>=1&&Y.push({memberId:a.memberId,fullName:q,email:a.email,metric:"cancellations",changeRate:-u,recentAvg:ie,previousAvg:U})}if(S>=0&&B>S){const u=S>0?(B-S)/S*100:B>0?100:0;u>15&&pe.push({memberId:a.memberId,fullName:q,email:a.email,metric:"bookings",changeRate:u,recentAvg:B,previousAvg:S})}if(z>=0&&p>z){const u=z>0?(p-z)/z*100:p>0?100:0;u>15&&pe.push({memberId:a.memberId,fullName:q,email:a.email,metric:"attendance",changeRate:u,recentAvg:p,previousAvg:z})}});const me=(a,i)=>{const C=a.length;if(C===0)return 0;const Q=a.reduce((U,q)=>U+q,0)/C,B=i.reduce((U,q)=>U+q,0)/C;let S=0,p=0,z=0;for(let U=0;U<C;U++){const q=a[U]-Q,u=i[U]-B;S+=q*u,p+=q*q,z+=u*u}const ie=Math.sqrt(p*z);return ie===0?0:S/ie},Ue=[],he=[],$e=[];T.forEach(a=>{Object.values(a.monthlyData).forEach(i=>{i.booked>0&&(Ue.push(i.booked),he.push(i.cancellations),$e.push(i.visits))})});const re=me(Ue,he),Ie=me(Ue,$e);let $="Neutral booking behavior";re>.5?$="Higher bookings correlate with more cancellations (potential over-booking)":re<-.3&&($="Higher bookings correlate with fewer cancellations (reliable bookers)"),Ie>.7?$+=" | Strong booking-to-visit conversion":Ie<.5&&($+=" | Weak booking-to-visit conversion");const je=[],ve=W.filter(a=>a.cancellationRate>30).length;ve>T.length*.1&&je.push({pattern:`${ve} members with >30% cancellation rate`,memberCount:ve,severity:"high"});const Ne=W.filter(a=>a.showUpRate<60).length;Ne>T.length*.15&&je.push({pattern:`${Ne} members with <60% show-up rate`,memberCount:Ne,severity:"medium"});const V=Y.filter(a=>a.metric==="bookings").length;V>10&&je.push({pattern:`${V} members showing declining booking trends`,memberCount:V,severity:"medium"});const Oe={declining:Y.sort((a,i)=>a.changeRate-i.changeRate).slice(0,30),increasing:pe.sort((a,i)=>i.changeRate-a.changeRate).slice(0,30),correlationInsights:{bookingCancellationCorrelation:re,bookingVisitCorrelation:Ie,overallPattern:$,highRiskPatterns:je}},Te=Ae.filter(a=>a.segment!=="inactive"&&a.lastActivityMonth).length,ye=Ae.filter(a=>a.segment==="at-risk"||a.segment==="unreliable").length,Ve=W.reduce((a,i)=>a+i.cancellationRate,0)/(W.length||1),Ke=W.reduce((a,i)=>a+i.showUpRate,0)/(W.length||1);let Be="Stable member behavior across the board";Y.length>pe.length*1.5?Be=`${Y.length} members showing declining engagement - immediate attention needed`:pe.length>Y.length*1.5?Be=`${pe.length} members showing improved engagement - positive momentum`:je.filter(a=>a.severity==="high").length>0&&(Be="High cancellation rates detected across multiple member segments");let Xe=`Average cancellation rate is ${Ve.toFixed(1)}% with ${Ke.toFixed(1)}% show-up rate.`;re>.5?Xe+=" Strong correlation between bookings and cancellations suggests capacity or scheduling issues.":Ie<.6&&(Xe+=" Low booking-to-visit conversion indicates follow-up opportunities.");let He="Continue monitoring member engagement patterns.";ye>T.length*.2?He=`Focus on ${ye} at-risk members with targeted retention campaigns.`:Y.length>15?He=`Implement re-engagement program for ${Y.length} members with declining trends.`:Ve>25&&(He="Review cancellation policies and implement reminder systems to reduce no-shows.");const Ee={totalMembers:T.length,activeMembers:Te,inactiveMembers:T.length-Te,atRiskMembers:ye,averageCancellationRate:Ve,averageShowUpRate:Ke,topTrend:Be,keyInsight:Xe,recommendation:He};return{performanceMetrics:W,monthlyTrends:fe,memberSegments:Ae,financialInsights:v,operationalMetrics:E,predictiveInsights:De,trendAnalysis:Oe,summaryInsights:Ee}},[T]),zs=["#3b82f6","#8b5cf6","#ec4899","#f59e0b","#10b981","#06b6d4","#6366f1"],xt=()=>{const{data:T,loading:W,error:ne}=mt(),fe=ht(T),[Ae,ge]=k.useState("overview");if(W)return e.jsx(I,{children:e.jsxs(P,{className:"p-12 text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading member behavior data..."})]})});if(ne)return e.jsx(I,{className:"border-red-200 bg-red-50",children:e.jsx(P,{className:"p-8",children:e.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[e.jsx(Le,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Failed to load member behavior data"}),e.jsx("div",{className:"text-sm mt-1",children:ne})]})]})})});const{performanceMetrics:Se,monthlyTrends:oe,memberSegments:M,financialInsights:K,operationalMetrics:L,predictiveInsights:le,trendAnalysis:v,summaryInsights:N}=fe,ce=M.reduce((t,R)=>(t[R.segment]=(t[R.segment]||0)+1,t),{}),ee=Object.entries(ce).map(([t,R])=>({name:t.split("-").map(E=>E.charAt(0).toUpperCase()+E.slice(1)).join(" "),value:R}));return e.jsxs("div",{className:"space-y-6",children:[e.jsx(I,{className:"bg-gradient-to-br from-purple-50 to-white border-purple-200",children:e.jsxs(D,{children:[e.jsxs(O,{className:"flex items-center gap-2 text-2xl",children:[e.jsx(xe,{className:"w-7 h-7 text-purple-600"}),"Member Behavior Patterns Analysis"]}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["Comprehensive analysis of ",x(T.length)," members across ",oe.length," months"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(ls.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsx(I,{className:"bg-gradient-to-br from-blue-50 to-white border-blue-200 hover:shadow-lg transition-shadow",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ge,{className:"w-8 h-8 text-blue-600"}),e.jsx(A,{variant:"secondary",className:"bg-blue-100 text-blue-700",children:"Revenue"})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:ke(K.totalRevenue)}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Total Revenue"}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-100 text-xs text-gray-500",children:[ke(K.revenuePerVisit)," per visit"]})]})})}),e.jsx(ls.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1},children:e.jsx(I,{className:"bg-gradient-to-br from-emerald-50 to-white border-emerald-200 hover:shadow-lg transition-shadow",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(We,{className:"w-8 h-8 text-emerald-600"}),e.jsx(A,{variant:"secondary",className:"bg-emerald-100 text-emerald-700",children:X(L.appointmentUtilizationRate)})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:x(L.totalVisits)}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Total Visits"}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-emerald-100 text-xs text-gray-500",children:[x(L.totalBookings)," bookings"]})]})})}),e.jsx(ls.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2},children:e.jsx(I,{className:"bg-gradient-to-br from-amber-50 to-white border-amber-200 hover:shadow-lg transition-shadow",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Je,{className:"w-8 h-8 text-amber-600"}),e.jsx(A,{variant:"secondary",className:"bg-amber-100 text-amber-700",children:"Collection"})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:X(K.collectionEfficiency)}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Collection Efficiency"}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-amber-100 text-xs text-gray-500",children:[ke(K.totalOutstanding)," outstanding"]})]})})}),e.jsx(ls.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.3},children:e.jsx(I,{className:"bg-gradient-to-br from-red-50 to-white border-red-200 hover:shadow-lg transition-shadow",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(fs,{className:"w-8 h-8 text-red-600"}),e.jsx(A,{variant:"secondary",className:"bg-red-100 text-red-700",children:"Rate"})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:X(L.overallCancellationRate)}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Cancellation Rate"}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-red-100 text-xs text-gray-500",children:[x(L.totalCancellations)," cancellations"]})]})})})]}),e.jsxs(qs,{value:Ae,onValueChange:ge,className:"w-full",children:[e.jsxs(Ls,{className:"grid w-full grid-cols-5 mb-6",children:[e.jsxs(Me,{value:"overview",className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Overview"]}),e.jsxs(Me,{value:"performance",className:"flex items-center gap-2",children:[e.jsx(Cs,{className:"w-4 h-4"}),"Performance"]}),e.jsxs(Me,{value:"trends",className:"flex items-center gap-2",children:[e.jsx(ss,{className:"w-4 h-4"}),"Trends"]}),e.jsxs(Me,{value:"segments",className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"Segments"]}),e.jsxs(Me,{value:"predictive",className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4"}),"Predictive"]})]}),e.jsxs(Re,{value:"overview",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(I,{children:[e.jsx(D,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5 text-blue-600"}),"Monthly Revenue Trend"]})}),e.jsx(P,{children:e.jsx(Ze,{width:"100%",height:300,children:e.jsxs(Rs,{data:oe.slice().reverse(),children:[e.jsx(hs,{strokeDasharray:"3 3"}),e.jsx(xs,{dataKey:"month",tick:{fontSize:12},angle:-45,textAnchor:"end",height:80}),e.jsx(gs,{tick:{fontSize:12}}),e.jsx(es,{formatter:t=>ke(t)}),e.jsx(Ps,{}),e.jsx(bs,{type:"monotone",dataKey:"totalRevenue",stroke:"#3b82f6",strokeWidth:2,name:"Revenue"}),e.jsx(bs,{type:"monotone",dataKey:"totalUnpaid",stroke:"#f59e0b",strokeWidth:2,name:"Unpaid"})]})})})]}),e.jsxs(I,{children:[e.jsx(D,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-purple-600"}),"Member Segmentation"]})}),e.jsx(P,{children:e.jsx(Ze,{width:"100%",height:300,children:e.jsxs(at,{children:[e.jsx(lt,{data:ee,cx:"50%",cy:"50%",labelLine:!1,label:t=>`${t.name}: ${t.value}`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:ee.map((t,R)=>e.jsx(st,{fill:zs[R%zs.length]},`cell-${R}`))}),e.jsx(es,{})]})})})]})]}),e.jsxs(I,{children:[e.jsx(D,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5 text-emerald-600"}),"Operational Efficiency Metrics"]})}),e.jsx(P,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-white p-6 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Appointment Utilization"}),e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:X(L.appointmentUtilizationRate)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:[x(L.totalVisits)," visits / ",x(L.totalBookings)," bookings"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-white p-6 rounded-lg border border-emerald-200",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Booking to Payment"}),e.jsx("div",{className:"text-3xl font-bold text-emerald-600",children:ke(L.bookingToPaymentConversion)}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"Average revenue per booking"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-white p-6 rounded-lg border border-red-200",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Cancellation Rate"}),e.jsx("div",{className:"text-3xl font-bold text-red-600",children:X(L.overallCancellationRate)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:[x(L.totalCancellations)," total cancellations"]})]})]})})]})]}),e.jsx(Re,{value:"performance",className:"space-y-6",children:e.jsxs(I,{children:[e.jsx(D,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Cs,{className:"w-5 h-5 text-blue-600"}),"Top Performing Members"]})}),e.jsx(P,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Member"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Visits"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Revenue"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Show-up Rate"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Avg Transaction"})]})}),e.jsx("tbody",{children:Se.sort((t,R)=>R.totalPaidAmount-t.totalPaidAmount).slice(0,20).map((t,R)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsxs("td",{className:"p-3",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.fullName}),e.jsx("div",{className:"text-xs text-gray-500",children:t.email})]}),e.jsx("td",{className:"text-right p-3 text-gray-700",children:x(t.totalVisits)}),e.jsx("td",{className:"text-right p-3 font-semibold text-emerald-600",children:ke(t.totalPaidAmount)}),e.jsx("td",{className:"text-right p-3",children:e.jsx(A,{variant:t.showUpRate>=80?"default":"secondary",className:t.showUpRate>=80?"bg-emerald-100 text-emerald-700":"",children:X(t.showUpRate)})}),e.jsx("td",{className:"text-right p-3 text-gray-700",children:ke(t.averageTransactionValue)})]},t.memberId))})]})})})]})}),e.jsxs(Re,{value:"trends",className:"space-y-6",children:[e.jsxs(I,{className:"bg-gradient-to-br from-indigo-50 to-white border-indigo-200",children:[e.jsx(D,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-indigo-600"}),"Booking & Cancellation Correlation Analysis"]})}),e.jsxs(P,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-indigo-200",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Booking-Cancellation Correlation"}),e.jsx("div",{className:"text-3xl font-bold text-indigo-600",children:v.correlationInsights.bookingCancellationCorrelation.toFixed(2)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:[Math.abs(v.correlationInsights.bookingCancellationCorrelation)>.5?"Strong":Math.abs(v.correlationInsights.bookingCancellationCorrelation)>.3?"Moderate":"Weak"," correlation"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-emerald-200",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Booking-Visit Correlation"}),e.jsx("div",{className:"text-3xl font-bold text-emerald-600",children:v.correlationInsights.bookingVisitCorrelation.toFixed(2)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:[v.correlationInsights.bookingVisitCorrelation>.7?"Strong":v.correlationInsights.bookingVisitCorrelation>.5?"Moderate":"Weak"," conversion"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-purple-200",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Overall Pattern"}),e.jsx("div",{className:"text-sm font-medium text-gray-800 mt-3",children:v.correlationInsights.overallPattern})]})]}),v.correlationInsights.highRiskPatterns.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(_e,{className:"w-5 h-5 text-amber-600"}),"High Risk Patterns Detected"]}),e.jsx("div",{className:"space-y-2",children:v.correlationInsights.highRiskPatterns.map((t,R)=>e.jsx("div",{className:`p-3 rounded-lg border ${t.severity==="high"?"bg-red-50 border-red-200":t.severity==="medium"?"bg-amber-50 border-amber-200":"bg-yellow-50 border-yellow-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-800",children:t.pattern}),e.jsx(A,{variant:t.severity==="high"?"destructive":"secondary",children:t.severity})]})},R))})]})]})]}),e.jsxs(I,{className:"border-red-200 bg-red-50",children:[e.jsxs(D,{children:[e.jsxs(O,{className:"flex items-center gap-2 text-red-700",children:[e.jsx(us,{className:"w-5 h-5"}),"Members with Declining Trends",e.jsx(A,{variant:"destructive",className:"ml-2",children:v.declining.length})]}),e.jsx("p",{className:"text-sm text-red-600 mt-2",children:"Members showing significant decreases in bookings, visits, or increases in cancellations"})]}),e.jsx(P,{children:e.jsx("div",{className:"bg-white rounded-lg p-4",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Member"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Metric"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Change Rate"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Recent Avg"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Previous Avg"})]})}),e.jsx("tbody",{children:v.declining.slice(0,15).map((t,R)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsxs("td",{className:"p-3",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.fullName}),e.jsx("div",{className:"text-xs text-gray-500",children:t.email})]}),e.jsx("td",{className:"p-3",children:e.jsx(A,{variant:"secondary",className:"capitalize",children:t.metric})}),e.jsx("td",{className:"text-right p-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-1 text-red-600 font-semibold",children:[e.jsx(us,{className:"w-4 h-4"}),X(Math.abs(t.changeRate))]})}),e.jsx("td",{className:"text-right p-3 text-gray-700",children:t.recentAvg.toFixed(1)}),e.jsx("td",{className:"text-right p-3 text-gray-700",children:t.previousAvg.toFixed(1)})]},`${t.memberId}-${t.metric}`))})]})})})]}),e.jsxs(I,{className:"border-emerald-200 bg-emerald-50",children:[e.jsxs(D,{children:[e.jsxs(O,{className:"flex items-center gap-2 text-emerald-700",children:[e.jsx(ys,{className:"w-5 h-5"}),"Members with Improving Trends",e.jsx(A,{className:"ml-2 bg-emerald-200 text-emerald-800",children:v.increasing.length})]}),e.jsx("p",{className:"text-sm text-emerald-600 mt-2",children:"Members showing significant increases in bookings and attendance"})]}),e.jsx(P,{children:e.jsx("div",{className:"bg-white rounded-lg p-4",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Member"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Metric"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Change Rate"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Recent Avg"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Previous Avg"})]})}),e.jsx("tbody",{children:v.increasing.slice(0,15).map((t,R)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsxs("td",{className:"p-3",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.fullName}),e.jsx("div",{className:"text-xs text-gray-500",children:t.email})]}),e.jsx("td",{className:"p-3",children:e.jsx(A,{className:"capitalize bg-emerald-100 text-emerald-700",children:t.metric})}),e.jsx("td",{className:"text-right p-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-1 text-emerald-600 font-semibold",children:[e.jsx(ys,{className:"w-4 h-4"}),X(t.changeRate)]})}),e.jsx("td",{className:"text-right p-3 text-gray-700",children:t.recentAvg.toFixed(1)}),e.jsx("td",{className:"text-right p-3 text-gray-700",children:t.previousAvg.toFixed(1)})]},`${t.memberId}-${t.metric}`))})]})})})]}),e.jsxs(I,{children:[e.jsx(D,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"w-5 h-5 text-purple-600"}),"Monthly Performance Trends"]})}),e.jsx(P,{children:e.jsx(Ze,{width:"100%",height:400,children:e.jsxs(tt,{data:oe.slice().reverse(),children:[e.jsx(hs,{strokeDasharray:"3 3"}),e.jsx(xs,{dataKey:"month",tick:{fontSize:12},angle:-45,textAnchor:"end",height:80}),e.jsx(gs,{tick:{fontSize:12}}),e.jsx(es,{}),e.jsx(Ps,{}),e.jsx(Ms,{dataKey:"totalBookings",fill:"#3b82f6",name:"Bookings"}),e.jsx(Ms,{dataKey:"totalVisits",fill:"#10b981",name:"Visits"}),e.jsx(Ms,{dataKey:"totalCancellations",fill:"#ef4444",name:"Cancellations"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(I,{children:[e.jsx(D,{children:e.jsx(O,{className:"text-lg",children:"Cancellation Rate Trend"})}),e.jsx(P,{children:e.jsx(Ze,{width:"100%",height:250,children:e.jsxs(Rs,{data:oe.slice().reverse(),children:[e.jsx(hs,{strokeDasharray:"3 3"}),e.jsx(xs,{dataKey:"month",tick:{fontSize:12},angle:-45,textAnchor:"end",height:80}),e.jsx(gs,{tick:{fontSize:12}}),e.jsx(es,{formatter:t=>`${t.toFixed(1)}%`}),e.jsx(bs,{type:"monotone",dataKey:"cancellationRate",stroke:"#ef4444",strokeWidth:2,name:"Cancellation %"})]})})})]}),e.jsxs(I,{children:[e.jsx(D,{children:e.jsx(O,{className:"text-lg",children:"Show-up Rate Trend"})}),e.jsx(P,{children:e.jsx(Ze,{width:"100%",height:250,children:e.jsxs(Rs,{data:oe.slice().reverse(),children:[e.jsx(hs,{strokeDasharray:"3 3"}),e.jsx(xs,{dataKey:"month",tick:{fontSize:12},angle:-45,textAnchor:"end",height:80}),e.jsx(gs,{tick:{fontSize:12}}),e.jsx(es,{formatter:t=>`${t.toFixed(1)}%`}),e.jsx(bs,{type:"monotone",dataKey:"showUpRate",stroke:"#10b981",strokeWidth:2,name:"Show-up %"})]})})})]})]})]}),e.jsx(Re,{value:"segments",className:"space-y-6",children:["high-value","engaged","reliable","at-risk","unreliable","inactive"].map(t=>{const R=M.filter(te=>te.segment===t);if(R.length===0)return null;const se={"high-value":{color:"purple",icon:Cs,label:"High-Value Members"},engaged:{color:"emerald",icon:js,label:"Engaged Members"},reliable:{color:"blue",icon:Je,label:"Reliable Members"},"at-risk":{color:"amber",icon:Le,label:"At-Risk Members"},unreliable:{color:"orange",icon:_e,label:"Unreliable Members"},inactive:{color:"gray",icon:fs,label:"Inactive Members"}}[t],Pe=se.icon;return e.jsxs(I,{children:[e.jsx(D,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:`w-5 h-5 text-${se.color}-600`}),se.label,e.jsx(A,{className:"ml-2",children:R.length})]})}),e.jsx(P,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Member"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Revenue"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Visits"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Cancellation Rate"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Last Active"})]})}),e.jsx("tbody",{children:R.slice(0,10).map(te=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsxs("td",{className:"p-3",children:[e.jsx("div",{className:"font-medium text-gray-900",children:te.fullName}),e.jsx("div",{className:"text-xs text-gray-500",children:te.email})]}),e.jsx("td",{className:"text-right p-3 font-semibold text-emerald-600",children:ke(te.totalRevenue)}),e.jsx("td",{className:"text-right p-3 text-gray-700",children:x(te.visitFrequency)}),e.jsx("td",{className:"text-right p-3",children:e.jsx(A,{variant:te.cancellationRate<20?"default":"secondary",children:X(te.cancellationRate)})}),e.jsx("td",{className:"text-left p-3 text-sm text-gray-600",children:te.lastActivityMonth||"N/A"})]},te.memberId))})]})})})]},t)})}),e.jsxs(Re,{value:"predictive",className:"space-y-6",children:[e.jsxs(I,{className:"border-red-200 bg-red-50",children:[e.jsx(D,{children:e.jsxs(O,{className:"flex items-center gap-2 text-red-700",children:[e.jsx(_e,{className:"w-5 h-5"}),"High Churn Risk Members",e.jsx(A,{variant:"destructive",className:"ml-2",children:le.churnRiskMembers.length})]})}),e.jsx(P,{children:e.jsx("div",{className:"bg-white rounded-lg p-4",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Member"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Churn Score"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Decline Rate"}),e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Last Active"})]})}),e.jsx("tbody",{children:le.churnRiskMembers.map(t=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsxs("td",{className:"p-3",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.fullName}),e.jsx("div",{className:"text-xs text-gray-500",children:t.email})]}),e.jsx("td",{className:"text-right p-3",children:e.jsx(A,{variant:"destructive",children:t.churnScore.toFixed(0)})}),e.jsx("td",{className:"text-right p-3 text-red-600 font-semibold",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(us,{className:"w-4 h-4"}),X(t.declineRate)]})}),e.jsx("td",{className:"text-left p-3 text-sm text-gray-600",children:t.lastActiveMonth})]},t.memberId))})]})})})]}),e.jsxs(I,{className:"border-amber-200 bg-amber-50",children:[e.jsx(D,{children:e.jsxs(O,{className:"flex items-center gap-2 text-amber-700",children:[e.jsx(Ge,{className:"w-5 h-5"}),"Payment Risk Members",e.jsx(A,{className:"ml-2 bg-amber-200 text-amber-800",children:le.paymentRiskMembers.length})]})}),e.jsx(P,{children:e.jsx("div",{className:"bg-white rounded-lg p-4",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3 text-sm font-semibold text-gray-700",children:"Member"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Unpaid Amount"}),e.jsx("th",{className:"text-right p-3 text-sm font-semibold text-gray-700",children:"Compliance Rate"})]})}),e.jsx("tbody",{children:le.paymentRiskMembers.map(t=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsxs("td",{className:"p-3",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.fullName}),e.jsx("div",{className:"text-xs text-gray-500",children:t.email})]}),e.jsx("td",{className:"text-right p-3 font-semibold text-red-600",children:ke(t.unpaidAmount)}),e.jsx("td",{className:"text-right p-3",children:e.jsx(A,{variant:t.paymentComplianceRate>=80?"default":"destructive",children:X(t.paymentComplianceRate)})})]},t.memberId))})]})})})]}),e.jsxs(I,{className:"border-blue-200 bg-blue-50",children:[e.jsx(D,{children:e.jsxs(O,{className:"flex items-center gap-2 text-blue-700",children:[e.jsx(ss,{className:"w-5 h-5"}),"Revenue Forecasts"]})}),e.jsx(P,{children:e.jsx("div",{className:"bg-white rounded-lg p-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:le.revenueForecasts.map(t=>e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-white p-6 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:t.month}),e.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-2",children:ke(t.forecastedRevenue)}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(Je,{className:"w-3 h-3"}),t.confidence,"% confidence"]})]},t.month))})})})]})]})]}),e.jsxs(I,{className:"bg-gradient-to-br from-slate-800 to-slate-900 text-white border-0 shadow-2xl",children:[e.jsx(D,{children:e.jsxs(O,{className:"flex items-center gap-2 text-2xl",children:[e.jsx(Ce,{className:"w-7 h-7 text-blue-400"}),"Analysis Summary & Insights"]})}),e.jsxs(P,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm p-4 rounded-lg border border-white/20",children:[e.jsx("div",{className:"text-sm text-blue-200 mb-1",children:"Total Members"}),e.jsx("div",{className:"text-3xl font-bold",children:x(N.totalMembers)})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm p-4 rounded-lg border border-white/20",children:[e.jsx("div",{className:"text-sm text-emerald-200 mb-1",children:"Active Members"}),e.jsx("div",{className:"text-3xl font-bold text-emerald-400",children:x(N.activeMembers)}),e.jsx("div",{className:"text-xs text-emerald-300 mt-1",children:X(N.activeMembers/N.totalMembers*100)})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm p-4 rounded-lg border border-white/20",children:[e.jsx("div",{className:"text-sm text-amber-200 mb-1",children:"At Risk"}),e.jsx("div",{className:"text-3xl font-bold text-amber-400",children:x(N.atRiskMembers)}),e.jsx("div",{className:"text-xs text-amber-300 mt-1",children:X(N.atRiskMembers/N.totalMembers*100)})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm p-4 rounded-lg border border-white/20",children:[e.jsx("div",{className:"text-sm text-red-200 mb-1",children:"Inactive"}),e.jsx("div",{className:"text-3xl font-bold text-red-400",children:x(N.inactiveMembers)}),e.jsx("div",{className:"text-xs text-red-300 mt-1",children:X(N.inactiveMembers/N.totalMembers*100)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm p-6 rounded-lg border border-white/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(We,{className:"w-5 h-5 text-blue-400"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Overall Performance"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Average Cancellation Rate:"}),e.jsx("span",{className:"font-bold text-xl",children:X(N.averageCancellationRate)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Average Show-up Rate:"}),e.jsx("span",{className:"font-bold text-xl text-emerald-400",children:X(N.averageShowUpRate)})]})]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm p-6 rounded-lg border border-white/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ss,{className:"w-5 h-5 text-purple-400"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Trend Analysis"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(us,{className:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("span",{className:"text-sm",children:[v.declining.length," members declining"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ys,{className:"w-5 h-5 text-emerald-400 flex-shrink-0 mt-0.5"}),e.jsxs("span",{className:"text-sm",children:[v.increasing.length," members improving"]})]})]})]})]}),e.jsx("div",{className:"bg-gradient-to-br from-blue-600/20 to-purple-600/20 backdrop-blur-sm p-6 rounded-lg border border-blue-400/30",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Le,{className:"w-6 h-6 text-blue-400 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-blue-100",children:"Top Trend"}),e.jsx("p",{className:"text-gray-200",children:N.topTrend})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-purple-600/20 to-pink-600/20 backdrop-blur-sm p-6 rounded-lg border border-purple-400/30",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Je,{className:"w-6 h-6 text-purple-400 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-purple-100",children:"Key Insight"}),e.jsx("p",{className:"text-gray-200",children:N.keyInsight})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-emerald-600/20 to-teal-600/20 backdrop-blur-sm p-6 rounded-lg border border-emerald-400/30",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(js,{className:"w-6 h-6 text-emerald-400 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-emerald-100",children:"Recommendation"}),e.jsx("p",{className:"text-gray-200",children:N.recommendation})]})]})}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm p-6 rounded-lg border border-white/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ce,{className:"w-5 h-5 text-indigo-400"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Correlation Insights"})]}),e.jsx("p",{className:"text-gray-300",children:v.correlationInsights.overallPattern}),v.correlationInsights.highRiskPatterns.length>0&&e.jsx("div",{className:"mt-4 space-y-2",children:v.correlationInsights.highRiskPatterns.map((t,R)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(_e,{className:"w-4 h-4 text-amber-400"}),e.jsx("span",{className:"text-gray-300",children:t.pattern})]},R))})]})]})]})]})},Jt=()=>{const{data:T,loading:W,error:ne}=Ws(),{data:fe,loading:Ae,error:ge}=Xs(),{setLoading:Se}=Gs(),oe=Js(),[M,K]=k.useState("Kwality House, Kemps Corner"),[L,le]=k.useState("#3b82f6"),[v,N]=k.useState(!0),[ce,ee]=k.useState(new Set),[t,R]=k.useState("product"),[E,se]=k.useState("visits"),Pe=W||Ae,te=ne||ge,de=[{id:"visits",label:"Total Visits",description:"Total check-ins across all sessions",icon:We,color:"text-indigo-600",format:"number"},{id:"bookings",label:"Total Bookings",description:"All bookings (checked-in or not)",icon:qe,color:"text-blue-600",format:"number"},{id:"checkins",label:"Check-ins",description:"Successfully checked-in sessions",icon:js,color:"text-green-600",format:"number"},{id:"sessions",label:"Sessions Held",description:"Unique sessions that occurred",icon:Ce,color:"text-purple-600",format:"number"},{id:"emptySessions",label:"Empty Sessions",description:"Sessions with zero check-ins",icon:fs,color:"text-red-600",format:"number"},{id:"uniqueMembers",label:"Unique Members",description:"Distinct members who checked in",icon:xe,color:"text-cyan-600",format:"number"},{id:"newMembers",label:"New Members",description:'Members with "New" in Is New column',icon:rt,color:"text-emerald-600",format:"number"},{id:"returningMembers",label:"Returning Members",description:'Members without "New" status',icon:Bs,color:"text-teal-600",format:"number"},{id:"revenue",label:"Total Revenue (Sales)",description:"Sum of all payments from Sales sheet",icon:Ge,color:"text-green-700",format:"currency"},{id:"earnedRevenue",label:"Earned Revenue",description:"Revenue from checked-in sessions",icon:Ge,color:"text-emerald-700",format:"currency"},{id:"unitsSold",label:"Units Sold",description:"Total items from Sales sheet",icon:it,color:"text-orange-600",format:"number"},{id:"classAvg",label:"Class Average",description:"Average attendees per session",icon:Je,color:"text-pink-600",format:"decimal"},{id:"fillRate",label:"Fill Rate %",description:"Capacity utilization percentage",icon:ot,color:"text-violet-600",format:"percentage"},{id:"capacity",label:"Total Capacity",description:"Maximum available spots",icon:ps,color:"text-slate-600",format:"number"},{id:"lateCancellations",label:"Late Cancellations",description:"Cancelled after deadline",icon:Le,color:"text-amber-600",format:"number"},{id:"complementary",label:"Complementary",description:"Sessions where Paid = 0",icon:Qs,color:"text-lime-600",format:"number"},{id:"avgRevenuePerMember",label:"Avg Revenue/Member",description:"Revenue per unique member",icon:Ge,color:"text-fuchsia-600",format:"currency"},{id:"avgRevenuePerSession",label:"Avg Revenue/Session",description:"Revenue per session",icon:Ge,color:"text-rose-600",format:"currency"}],[be,De]=k.useState([]),[Y,pe]=k.useState([]),[me,Ue]=k.useState([]),[he,$e]=k.useState([]),[re,Ie]=k.useState([]),[$,je]=k.useState("class"),[ve,Ne]=k.useState("All"),[V,Oe]=k.useState("class"),[Te,ye]=k.useState("All"),Ve=k.useRef(null),Ke=k.useRef(null),Be=k.useRef(null);ks(Ve,`${de.find(s=>s.id===E)?.label} by ${t.charAt(0).toUpperCase()+t.slice(1)} - Month on Month`,!0);const{getAllTabsText:Xe}=ks(Ke,"Attendance Frequency Breakdown"),{getAllTabsText:He}=ks(Be,"Late Cancellations Breakdown");k.useEffect(()=>{Se(Pe,"Loading patterns and trends data...")},[Pe,Se]);const Ee=k.useMemo(()=>{const s=new Set,l=new Set,n=new Set,o=new Set,h=new Set;return T.forEach(r=>{r.cleanedProduct&&s.add(r.cleanedProduct),r.cleanedCategory&&l.add(r.cleanedCategory),r.teacherName&&n.add(r.teacherName),r.isNew&&o.add(r.isNew),r.month&&h.add(r.month)}),{products:Array.from(s).sort(),categories:Array.from(l).sort(),teachers:Array.from(n).sort(),memberStatuses:Array.from(o).sort(),months:Array.from(h).sort()}},[T]),a=k.useMemo(()=>{let s=T;return M!=="All Locations"&&(s=s.filter(l=>{const n=l.location||"";return M==="Kenkere House"?n.toLowerCase().includes("kenkere")||n==="Kenkere House":n===M})),be.length>0&&(s=s.filter(l=>be.includes(l.cleanedProduct||""))),Y.length>0&&(s=s.filter(l=>Y.includes(l.cleanedCategory||""))),me.length>0&&(s=s.filter(l=>me.includes(l.teacherName||""))),he.length>0&&(s=s.filter(l=>he.includes(l.isNew||""))),re.length>0&&(s=s.filter(l=>re.includes(l.month||""))),s},[T,M,be,Y,me,he,re]),i=k.useMemo(()=>M==="All Locations"?T:T.filter(s=>{const l=s.location||"";return M==="Kenkere House"?l.toLowerCase().includes("kenkere")||l==="Kenkere House":l===M}),[T,M]),C=k.useDeferredValue(a),Q=k.useDeferredValue(fe),[B,S]=k.useTransition(),p=k.useMemo(()=>{const s=C,l=Q;if(!s||s.length===0)return T.length>0?{products:[{product:"No Data After Filtering",monthlyBreakdown:[],totalVisits:0,totalBookings:0,totalUniqueMembers:0,totalSessions:0,totalRevenue:0,totalCapacity:0,avgFillRate:0,avgClassAvg:0}],months:[],totalsRow:{product:"TOTAL",monthlyBreakdown:[],totalVisits:0,totalUniqueMembers:0}}:{products:[{product:"Sample Product",monthlyBreakdown:[{month:"December 2024",visits:150,bookings:180,checkins:150,sessions:25,emptySessions:2,uniqueMembers:85,newMembers:15,returningMembers:70,revenue:12500,earnedRevenue:11800,unitsSold:45,classAvg:6,fillRate:75.5,capacity:200,lateCancellations:8,complementary:5,avgRevenuePerMember:147.06,avgRevenuePerSession:500}],totalVisits:150,totalBookings:180,totalUniqueMembers:85,totalSessions:25,totalRevenue:12500,totalCapacity:200,avgFillRate:75.5,avgClassAvg:6}],months:["December 2024"],totalsRow:{product:"TOTAL",monthlyBreakdown:[{month:"December 2024",visits:150,bookings:180,checkins:150,sessions:25,emptySessions:2,uniqueMembers:85,newMembers:15,returningMembers:70,revenue:12500,earnedRevenue:11800,unitsSold:45,classAvg:6,fillRate:75.5,capacity:200,lateCancellations:8,complementary:5,avgRevenuePerMember:147.06,avgRevenuePerSession:500}],totalVisits:150,totalUniqueMembers:85}};const n={},o=new Set;s.forEach(c=>{let d="";t==="product"?d=c.cleanedProduct||"Unknown":t==="category"?d=c.cleanedCategory||"Unknown":t==="teacher"?d=c.teacherName||"Unknown":t==="location"?d=c.location||"Unknown":t==="memberStatus"&&(d=c.isNew||"Unknown");const F=`${c.month} ${c.year}`;n[d]||(n[d]={}),n[d][F]||(n[d][F]={visits:0,bookings:0,checkins:0,sessions:new Set,uniqueMembers:new Set,newMembers:new Set,returningMembers:new Set,earnedRevenue:0,capacity:0,actualCheckins:0,lateCancellations:0,complementary:0,allSessionIds:new Set});const f=n[d][F];f.bookings+=1,c.checkedIn&&(f.visits+=1,f.checkins+=1,f.actualCheckins+=1,f.uniqueMembers.add(c.memberId),c.isNew&&c.isNew.toLowerCase().includes("new")?f.newMembers.add(c.memberId):f.returningMembers.add(c.memberId),f.earnedRevenue+=c.paid||0),c.sessionId&&f.allSessionIds.add(c.sessionId),c.isLateCancelled&&(f.lateCancellations+=1),c.paid===0&&(f.complementary+=1),f.capacity+=c.capacity||0,o.add(F)}),s.forEach(c=>{if(!c.sessionId)return;let d="";t==="product"?d=c.cleanedProduct||"Unknown":t==="category"?d=c.cleanedCategory||"Unknown":t==="teacher"?d=c.teacherName||"Unknown":t==="location"?d=c.location||"Unknown":t==="memberStatus"&&(d=c.isNew||"Unknown");const F=`${c.month} ${c.year}`;n[d]&&n[d][F]&&n[d][F].sessions.add(c.sessionId)});const h={};l.forEach(c=>{const d=new Date(c.paymentDate);if(isNaN(d.getTime()))return;const f=["January","February","March","April","May","June","July","August","September","October","November","December"][d.getMonth()],y=d.getFullYear(),_=`${f} ${y}`;let Z="";t==="product"?Z=c.cleanedProduct||"Unknown":t==="category"?Z=c.cleanedCategory||"Unknown":t==="location"?Z=c.calculatedLocation||"Unknown":Z="All",h[Z]||(h[Z]={}),h[Z][_]||(h[Z][_]={revenue:0,saleItemIds:new Set}),h[Z][_].revenue+=c.paymentValue||0,c.saleItemId&&h[Z][_].saleItemIds.add(c.saleItemId)});const r=Array.from(o).sort((c,d)=>{const F=f=>{const[y,_]=f.split(" "),Z=["January","February","March","April","May","June","July","August","September","October","November","December"];return new Date(parseInt(_),Z.indexOf(y),1)};return F(d).getTime()-F(c).getTime()}),g=Object.entries(n).map(([c,d])=>{const F=r.map(G=>{const m=d[G],we=h[c]?.[G]||{revenue:0,saleItemIds:new Set};if(!m)return{month:G,visits:0,bookings:0,checkins:0,sessions:0,emptySessions:0,uniqueMembers:0,newMembers:0,returningMembers:0,revenue:we.revenue,earnedRevenue:0,unitsSold:we.saleItemIds.size,classAvg:0,fillRate:0,capacity:0,lateCancellations:0,complementary:0,avgRevenuePerMember:0,avgRevenuePerSession:0};const ze=m.sessions.size,vs=ze>0?m.actualCheckins/ze:0,Ns=m.capacity>0?m.actualCheckins/m.capacity*100:0,As=new Set;s.forEach(Qe=>{Qe.checkedIn&&Qe.sessionId&&`${Qe.month} ${Qe.year}`===G&&As.add(Qe.sessionId)});const Os=Math.max(0,ze-As.size),Ks=m.uniqueMembers.size>0?we.revenue/m.uniqueMembers.size:0,Hs=ze>0?we.revenue/ze:0;return{month:G,visits:m.visits,bookings:m.bookings,checkins:m.checkins,sessions:ze,emptySessions:Os,uniqueMembers:m.uniqueMembers.size,newMembers:m.newMembers.size,returningMembers:m.returningMembers.size,revenue:we.revenue,earnedRevenue:m.earnedRevenue,unitsSold:we.saleItemIds.size,classAvg:vs,fillRate:Ns,capacity:m.capacity,lateCancellations:m.lateCancellations,complementary:m.complementary,avgRevenuePerMember:Ks,avgRevenuePerSession:Hs}}),f=F.reduce((G,m)=>G+m.visits,0),y=F.reduce((G,m)=>G+m.bookings,0),_=F.reduce((G,m)=>G+m.sessions,0),Z=F.reduce((G,m)=>G+m.revenue,0),Ye=F.reduce((G,m)=>G+m.capacity,0),ts=F.reduce((G,m)=>G+m.checkins,0),as=new Set;return Object.values(d).forEach(G=>{G.uniqueMembers.forEach(m=>as.add(m))}),{product:c,monthlyBreakdown:F,totalVisits:f,totalBookings:y,totalUniqueMembers:as.size,totalSessions:_,totalRevenue:Z,totalCapacity:Ye,avgFillRate:Ye>0?ts/Ye*100:0,avgClassAvg:_>0?ts/_:0}}).sort((c,d)=>d.totalVisits-c.totalVisits),j={product:"TOTAL",monthlyBreakdown:r.map(c=>{const d={visits:0,bookings:0,checkins:0,sessions:new Set,capacity:0,uniqueMembers:new Set,newMembers:new Set,returningMembers:new Set,earnedRevenue:0,lateCancellations:0,complementary:0,actualCheckins:0};s.forEach(m=>{`${m.month} ${m.year}`===c&&(d.bookings+=1,m.checkedIn&&(d.visits+=1,d.checkins+=1,d.actualCheckins+=1,d.uniqueMembers.add(m.memberId),m.isNew&&m.isNew.toLowerCase().includes("new")?d.newMembers.add(m.memberId):d.returningMembers.add(m.memberId),d.earnedRevenue+=m.paid||0),m.sessionId&&d.sessions.add(m.sessionId),m.isLateCancelled&&(d.lateCancellations+=1),m.paid===0&&(d.complementary+=1),d.capacity+=m.capacity||0)});let F=0;const f=new Set;l.forEach(m=>{const we=new Date(m.paymentDate);if(isNaN(we.getTime()))return;const vs=["January","February","March","April","May","June","July","August","September","October","November","December"][we.getMonth()],Ns=we.getFullYear();`${vs} ${Ns}`===c&&(F+=m.paymentValue||0,m.saleItemId&&f.add(m.saleItemId))});const y=d.sessions.size,_=y>0?d.actualCheckins/y:0,Z=d.capacity>0?d.actualCheckins/d.capacity*100:0,Ye=new Set;a.forEach(m=>{m.checkedIn&&m.sessionId&&`${m.month} ${m.year}`===c&&Ye.add(m.sessionId)});const ts=Math.max(0,y-Ye.size),as=d.uniqueMembers.size>0?F/d.uniqueMembers.size:0,G=y>0?F/y:0;return{month:c,visits:d.visits,bookings:d.bookings,checkins:d.checkins,sessions:y,emptySessions:ts,uniqueMembers:d.uniqueMembers.size,newMembers:d.newMembers.size,returningMembers:d.returningMembers.size,revenue:F,earnedRevenue:d.earnedRevenue,unitsSold:f.size,classAvg:_,fillRate:Z,capacity:d.capacity,lateCancellations:d.lateCancellations,complementary:d.complementary,avgRevenuePerMember:as,avgRevenuePerSession:G}}),totalVisits:g.reduce((c,d)=>c+d.totalVisits,0),totalUniqueMembers:new Set(s.filter(c=>c.checkedIn).map(c=>c.memberId)).size};return{products:g,months:r,totalsRow:j}},[C,t,Q]),{contextInfo:z}=_s({selectedMetric:de.find(s=>s.id===E)?.label,additionalInfo:{groupBy:`${t.charAt(0).toUpperCase()+t.slice(1)}`,totalProducts:p?.products?.length||0,totalMonths:p?.months?.length||0}}),ie=Ss.useCallback(async()=>{let s="";return de.forEach(l=>{s+=`

${"=".repeat(80)}
`,s+=`${l.label} by ${t.charAt(0).toUpperCase()+t.slice(1)} - Month on Month
`,s+=`${"=".repeat(80)}

`;const n=[t.charAt(0).toUpperCase()+t.slice(1),...p.months,"Total","Average"];s+=n.join("	")+`
`,s+=n.map(()=>"---").join("	")+`
`,p.products.forEach(o=>{const h=[o.product];let r=0,g=0;p.months.forEach(F=>{const f=o.monthlyBreakdown.find(Z=>Z.month===F);let y=0;if(f){switch(l.id){case"visits":y=f.visits;break;case"bookings":y=f.bookings;break;case"checkins":y=f.checkins;break;case"sessions":y=f.sessions;break;case"emptySessions":y=f.emptySessions;break;case"uniqueMembers":y=f.uniqueMembers;break;case"newMembers":y=f.newMembers;break;case"returningMembers":y=f.returningMembers;break;case"revenue":y=f.revenue;break;case"earnedRevenue":y=f.earnedRevenue;break;case"unitsSold":y=f.unitsSold;break;case"classAvg":y=f.classAvg;break;case"fillRate":y=f.fillRate;break;case"capacity":y=f.capacity;break;case"lateCancellations":y=f.lateCancellations;break;case"complementary":y=f.complementary;break;case"avgRevenuePerMember":y=f.avgRevenuePerMember;break;case"avgRevenuePerSession":y=f.avgRevenuePerSession;break}r+=y,g++}let _="-";if(y>0)switch(l.format){case"currency":_=Fe(y);break;case"percentage":_=`${y.toFixed(1)}%`;break;case"decimal":_=y.toFixed(2);break;default:_=x(y);break}h.push(_)});const j=l.format==="currency"?Fe(r):l.format==="percentage"?`${r.toFixed(1)}%`:l.format==="decimal"?r.toFixed(2):x(r),c=g>0?r/g:0,d=l.format==="currency"?Fe(c):l.format==="percentage"?`${c.toFixed(1)}%`:l.format==="decimal"?c.toFixed(2):x(c);h.push(j,d),s+=h.join("	")+`
`})}),s},[p,t,de]),U=s=>{const l=new Set(ce);l.has(s)?l.delete(s):l.add(s),ee(l)},q=k.useMemo(()=>{const s={};C.forEach(n=>{if(!n.checkedIn)return;let o="";$==="product"?o=n.cleanedProduct||"Unknown":$==="category"?o=n.cleanedCategory||"Unknown":$==="teacher"?o=n.teacherName||"Unknown":$==="class"&&(o=n.cleanedClass||"Unknown");const h=`${n.month}-${n.year}`,r=`${n.memberId}_${h}`;s[o]||(s[o]={}),s[o][h]||(s[o][h]={}),s[o][h][r]=(s[o][h][r]||0)+1});const l={};return Object.entries(s).forEach(([n,o])=>{l[n]={},Object.entries(o).forEach(([h,r])=>{const g={"1 class":0,"2-5 classes":0,"6-10 classes":0,"11-15 classes":0,"16-20 classes":0,"21-25 classes":0,">25 classes":0};Object.values(r).forEach(j=>{j===1?g["1 class"]++:j>=2&&j<=5?g["2-5 classes"]++:j>=6&&j<=10?g["6-10 classes"]++:j>=11&&j<=15?g["11-15 classes"]++:j>=16&&j<=20?g["16-20 classes"]++:j>=21&&j<=25?g["21-25 classes"]++:j>25&&g[">25 classes"]++}),l[n][h]=g})}),l},[C,$]),u=k.useMemo(()=>{const s={};C.forEach(n=>{if(!n.isLateCancelled)return;let o="";V==="product"?o=n.cleanedProduct||"Unknown":V==="category"?o=n.cleanedCategory||"Unknown":V==="teacher"?o=n.teacherName||"Unknown":V==="class"&&(o=n.cleanedClass||"Unknown");const h=`${n.month}-${n.year}`,r=`${n.memberId}_${h}`;s[o]||(s[o]={}),s[o][h]||(s[o][h]={}),s[o][h][r]=(s[o][h][r]||0)+1});const l={};return Object.entries(s).forEach(([n,o])=>{l[n]={},Object.entries(o).forEach(([h,r])=>{const g={"1 cancellation":0,"2-5 cancellations":0,"6-10 cancellations":0,"11-15 cancellations":0,"16-20 cancellations":0,"21-25 cancellations":0,">25 cancellations":0};Object.values(r).forEach(j=>{j===1?g["1 cancellation"]++:j>=2&&j<=5?g["2-5 cancellations"]++:j>=6&&j<=10?g["6-10 cancellations"]++:j>=11&&j<=15?g["11-15 cancellations"]++:j>=16&&j<=20?g["16-20 cancellations"]++:j>=21&&j<=25?g["21-25 cancellations"]++:j>25&&g[">25 cancellations"]++}),l[n][h]=g})}),l},[C,V]),ae=k.useMemo(()=>{const s={};a.forEach(o=>{if(!o.checkedIn)return;const h=o.dateIST||"";s[o.memberId]||(s[o.memberId]={}),s[o.memberId][h]=(s[o.memberId][h]||0)+1});let l=0,n=0;return Object.values(s).forEach(o=>{const h=Object.values(o).filter(r=>r>1).length;h>0&&(l++,n+=h)}),{membersWithMultipleClasses:l,totalMultipleClassDays:n,avgMultipleClassDays:l>0?(n/l).toFixed(1):"0"}},[a]),Ds=(s,l)=>l===0?s>0?100:0:(s-l)/l*100;return Pe?null:te?e.jsx(Is,{children:e.jsxs("div",{className:"min-h-screen bg-white relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute top-20 left-10 w-96 h-96 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-full floating-animation stagger-1"}),e.jsx("div",{className:"absolute bottom-20 right-10 w-80 h-80 bg-gradient-to-r from-indigo-500/10 to-purple-500/10 rounded-full floating-animation stagger-3"})]}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{style:{"--hero-accent":L},children:e.jsx(Ts,{title:"Patterns & Trends",subtitle:"Member behavior and visit analytics across all studio locations",primaryAction:{label:"Back to Dashboard",onClick:()=>oe("/")},compact:!0,onColorChange:le})}),e.jsx("div",{className:"container mx-auto px-6 py-10",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 p-6 rounded-2xl shadow-sm",children:[e.jsx("div",{className:"font-semibold text-lg mb-1",children:"Failed to load patterns data"}),e.jsx("div",{className:"text-sm opacity-90",children:te})]})})]}),e.jsx(Us,{})]})}):e.jsx(Is,{children:e.jsxs("div",{className:"min-h-screen bg-white relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute top-20 left-10 w-96 h-96 bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-full floating-animation stagger-1"}),e.jsx("div",{className:"absolute bottom-20 right-10 w-80 h-80 bg-gradient-to-r from-indigo-500/10 to-purple-500/10 rounded-full floating-animation stagger-3"}),e.jsx("div",{className:"absolute top-1/2 left-1/3 w-72 h-72 bg-gradient-to-r from-cyan-500/10 to-teal-500/10 rounded-full morph-shape stagger-2"})]}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"bg-white text-slate-800 slide-in-from-left",children:[e.jsx("div",{style:{"--hero-accent":L},children:e.jsx(Ts,{title:"Patterns & Trends",subtitle:"Member behavior and visit analytics across all studio locations",metrics:[{label:"Total Visits",value:x(i?.filter(s=>s.checkedIn).length||0),change:"+12.5%"},{label:"Unique Members",value:x(new Set(i?.map(s=>s.memberId)||[]).size),change:"+8.3%"},{label:"Sessions Held",value:x(new Set(i?.map(s=>s.sessionId)||[]).size),change:"+15.2%"}],primaryAction:{label:"View Dashboard",onClick:()=>oe("/")},secondaryAction:{label:"Export Data",onClick:()=>{}},compact:!0,onColorChange:le})}),e.jsxs("div",{className:"container mx-auto px-6 py-8 space-y-8",children:[e.jsx(nt,{activeLocation:M==="All Locations"?"all":M.toLowerCase().includes("kwality")?"kwality":M.toLowerCase().includes("supreme")?"supreme":M.toLowerCase().includes("kenkere")?"kenkere":"all",onLocationChange:s=>{K({all:"All Locations",kwality:"Kwality House, Kemps Corner",supreme:"Supreme HQ, Bandra",kenkere:"Kenkere House"}[s]||"All Locations")},showInfoPopover:!0,infoPopoverContext:"patterns-trends-overview"}),e.jsxs(I,{className:"border-0 shadow-lg bg-white/80 backdrop-blur-sm rounded-2xl",children:[e.jsx(D,{className:"pb-4 border-b border-slate-100",children:e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>N(!v),children:[e.jsxs(O,{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[v?e.jsx(Fs,{className:"w-4 h-4"}):e.jsx($s,{className:"w-4 h-4"}),"Filters & Options"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[be.length+Y.length+me.length+he.length+re.length>0&&e.jsxs(A,{className:"bg-indigo-600 text-white hover:bg-indigo-700",children:[be.length+Y.length+me.length+he.length+re.length," active"]}),e.jsx(A,{variant:"outline",className:"text-xs text-slate-500",children:v?"Click to expand":"Click to collapse"})]})]})}),!v&&e.jsxs(P,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-indigo-600"}),"Products"]}),e.jsx("div",{className:"max-h-48 overflow-y-auto border border-slate-200 rounded-lg p-2 bg-white",children:e.jsx("div",{className:"space-y-1",children:Ee.products.map(s=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-slate-50 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:be.includes(s),onChange:l=>{l.target.checked?De([...be,s]):De(be.filter(n=>n!==s))},className:"rounded border-slate-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm text-slate-700",children:s})]},s))})}),be.length>0&&e.jsx(J,{variant:"ghost",size:"sm",onClick:()=>De([]),className:"text-xs text-slate-600 hover:text-slate-900",children:"Clear all"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(ss,{className:"w-4 h-4 text-purple-600"}),"Categories"]}),e.jsx("div",{className:"max-h-48 overflow-y-auto border border-slate-200 rounded-lg p-2 bg-white",children:e.jsx("div",{className:"space-y-1",children:Ee.categories.map(s=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-slate-50 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:Y.includes(s),onChange:l=>{l.target.checked?pe([...Y,s]):pe(Y.filter(n=>n!==s))},className:"rounded border-slate-300 text-purple-600 focus:ring-purple-500"}),e.jsx("span",{className:"text-sm text-slate-700",children:s})]},s))})}),Y.length>0&&e.jsx(J,{variant:"ghost",size:"sm",onClick:()=>pe([]),className:"text-xs text-slate-600 hover:text-slate-900",children:"Clear all"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-pink-600"}),"Teachers"]}),e.jsx("div",{className:"max-h-48 overflow-y-auto border border-slate-200 rounded-lg p-2 bg-white",children:e.jsx("div",{className:"space-y-1",children:Ee.teachers.map(s=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-slate-50 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:me.includes(s),onChange:l=>{l.target.checked?Ue([...me,s]):Ue(me.filter(n=>n!==s))},className:"rounded border-slate-300 text-pink-600 focus:ring-pink-500"}),e.jsx("span",{className:"text-sm text-slate-700",children:s})]},s))})}),me.length>0&&e.jsx(J,{variant:"ghost",size:"sm",onClick:()=>Ue([]),className:"text-xs text-slate-600 hover:text-slate-900",children:"Clear all"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-emerald-600"}),"Member Status"]}),e.jsx("div",{className:"max-h-48 overflow-y-auto border border-slate-200 rounded-lg p-2 bg-white",children:e.jsx("div",{className:"space-y-1",children:Ee.memberStatuses.map(s=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-slate-50 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:he.includes(s),onChange:l=>{l.target.checked?$e([...he,s]):$e(he.filter(n=>n!==s))},className:"rounded border-slate-300 text-emerald-600 focus:ring-emerald-500"}),e.jsx("span",{className:"text-sm text-slate-700",children:s})]},s))})}),he.length>0&&e.jsx(J,{variant:"ghost",size:"sm",onClick:()=>$e([]),className:"text-xs text-slate-600 hover:text-slate-900",children:"Clear all"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-blue-600"}),"Months"]}),e.jsx("div",{className:"max-h-48 overflow-y-auto border border-slate-200 rounded-lg p-2 bg-white",children:e.jsx("div",{className:"space-y-1",children:Ee.months.map(s=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-slate-50 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:re.includes(s),onChange:l=>{l.target.checked?Ie([...re,s]):Ie(re.filter(n=>n!==s))},className:"rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700",children:s})]},s))})}),re.length>0&&e.jsx(J,{variant:"ghost",size:"sm",onClick:()=>Ie([]),className:"text-xs text-slate-600 hover:text-slate-900",children:"Clear all"})]})]}),be.length+Y.length+me.length+he.length+re.length>0&&e.jsx("div",{className:"flex justify-end pt-4 border-t border-slate-200",children:e.jsx(J,{variant:"outline",onClick:()=>{De([]),pe([]),Ue([]),$e([]),Ie([])},className:"text-slate-700 hover:bg-slate-100",children:"Clear All Filters"})})]})]}),e.jsxs(I,{className:"glass-card modern-card-hover rounded-2xl",children:[e.jsx(D,{className:"pb-3",children:e.jsxs(O,{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(Vs,{className:"w-5 h-5 text-indigo-600"}),"Group Data By"]})}),e.jsx(P,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(J,{variant:t==="product"?"default":"outline",onClick:()=>{R("product"),ee(new Set)},className:H("flex items-center gap-2",t==="product"?"bg-indigo-600 hover:bg-indigo-700":""),children:[e.jsx(Ce,{className:"w-4 h-4"}),"Product"]}),e.jsxs(J,{variant:t==="category"?"default":"outline",onClick:()=>{R("category"),ee(new Set)},className:H("flex items-center gap-2",t==="category"?"bg-purple-600 hover:bg-purple-700":""),children:[e.jsx(ps,{className:"w-4 h-4"}),"Category"]}),e.jsxs(J,{variant:t==="teacher"?"default":"outline",onClick:()=>{R("teacher"),ee(new Set)},className:H("flex items-center gap-2",t==="teacher"?"bg-pink-600 hover:bg-pink-700":""),children:[e.jsx(xe,{className:"w-4 h-4"}),"Teacher"]}),e.jsxs(J,{variant:t==="location"?"default":"outline",onClick:()=>{R("location"),ee(new Set)},className:H("flex items-center gap-2",t==="location"?"bg-indigo-600 hover:bg-indigo-700":""),children:[e.jsx(Vs,{className:"w-4 h-4"}),"Location"]}),e.jsxs(J,{variant:t==="memberStatus"?"default":"outline",onClick:()=>{R("memberStatus"),ee(new Set)},className:H("flex items-center gap-2",t==="memberStatus"?"bg-emerald-600 hover:bg-emerald-700":""),children:[e.jsx(Bs,{className:"w-4 h-4"}),"Member Status"]})]})})]}),e.jsxs(I,{className:"glass-card modern-card-hover rounded-2xl",children:[e.jsxs(D,{className:"pb-3",children:[e.jsxs(O,{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5 text-indigo-600"}),"Select Metric to Analyze"]}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Choose from 17 different metrics to view in the month-on-month breakdown"})]}),e.jsxs(P,{children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-2",children:de.map(s=>{const l=s.icon,n=E===s.id;return e.jsxs(J,{variant:n?"default":"outline",onClick:()=>se(s.id),className:H("flex flex-col items-center gap-1.5 h-auto py-3 px-2 text-center transition-all",n?`${s.color.replace("text-","bg-")} hover:opacity-90 text-white border-transparent`:`hover:${s.color.replace("text-","bg-")}/10 ${s.color} border-slate-200 hover:border-current`),title:s.description,children:[e.jsx(l,{className:H("w-5 h-5",n?"text-white":s.color)}),e.jsx("span",{className:"text-xs font-medium leading-tight",children:s.label})]},s.id)})}),e.jsx("div",{className:"mt-4 p-3 bg-indigo-50 border border-indigo-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-indigo-900",children:[e.jsx("span",{className:"font-semibold",children:"Currently viewing: "}),de.find(s=>s.id===E)?.description]})})]})]}),e.jsxs(qs,{defaultValue:"month-on-month",className:"w-full space-y-6",children:[e.jsxs(Ls,{className:"grid w-full grid-cols-5 h-auto p-1 bg-gradient-to-r from-indigo-100 via-purple-100 to-indigo-100 rounded-xl shadow-lg",children:[e.jsxs(Me,{value:"month-on-month",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-indigo-600 data-[state=active]:to-purple-600 data-[state=active]:text-white py-3 px-4 font-semibold text-sm transition-all flex items-center justify-center",children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Month Analysis"]}),e.jsxs(Me,{value:"visit-frequency",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-indigo-600 data-[state=active]:to-purple-600 data-[state=active]:text-white py-3 px-4 font-semibold text-sm transition-all flex items-center justify-center",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Visit Frequency"]}),e.jsxs(Me,{value:"cancellations",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-indigo-600 data-[state=active]:to-purple-600 data-[state=active]:text-white py-3 px-4 font-semibold text-sm transition-all flex items-center justify-center",children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Cancellations"]}),e.jsxs(Me,{value:"multiple-classes",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-indigo-600 data-[state=active]:to-purple-600 data-[state=active]:text-white py-3 px-4 font-semibold text-sm transition-all flex items-center justify-center",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Multiple Classes"]}),e.jsxs(Me,{value:"member-behavior",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-indigo-600 data-[state=active]:to-purple-600 data-[state=active]:text-white py-3 px-4 font-semibold text-sm transition-all flex items-center justify-center",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Member Behavior"]})]}),e.jsx(Re,{value:"month-on-month",className:"mt-6 space-y-6",children:e.jsxs(I,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsxs(D,{className:"pb-4 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white rounded-t-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-6 h-6"}),e.jsxs(O,{className:"text-xl font-bold",children:[de.find(s=>s.id===E)?.label," by ",t.charAt(0).toUpperCase()+t.slice(1)," - Month on Month"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(A,{className:"bg-white/20 text-white border-white/30",children:[p.products.length," ",t.charAt(0).toUpperCase()+t.slice(1),"s",p.products.length===0&&e.jsxs("span",{className:"ml-2 text-red-200",children:["(Debug: ",C.length," raw records)"]})]}),e.jsx(ws,{tableRef:Ve,tableName:`${de.find(s=>s.id===E)?.label} by ${t.charAt(0).toUpperCase()+t.slice(1)} - Month on Month`,size:"sm",onCopyAllTabs:ie,contextInfo:z})]})]}),e.jsxs("p",{className:"text-indigo-100 text-sm mt-2",children:["Track member check-in patterns across ",t,"s and time periods"]})]}),e.jsx(P,{className:"p-0",ref:Ve,children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(cs,{children:[e.jsx(ds,{className:"sticky top-0 z-20 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:e.jsxs(ue,{className:"border-none",children:[e.jsx(w,{className:"font-bold text-white sticky left-0 bg-slate-800 z-30 min-w-[240px]",children:t.charAt(0).toUpperCase()+t.slice(1)}),p.months.map(s=>e.jsx(w,{className:"text-center font-bold text-white min-w-[140px]",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:s.split(" ")[0]}),e.jsx("span",{className:"text-slate-300 text-xs",children:s.split(" ")[1]})]})},s)),e.jsx(w,{className:"text-center font-bold text-white min-w-[120px]",children:e.jsx(ns,{children:e.jsxs(rs,{children:[e.jsx(is,{className:"cursor-help",children:"Total Visits"}),e.jsx(os,{children:"Sum of all check-ins across all months"})]})})}),e.jsx(w,{className:"text-center font-bold text-white min-w-[120px]",children:e.jsx(ns,{children:e.jsxs(rs,{children:[e.jsx(is,{className:"cursor-help",children:"Unique Members"}),e.jsx(os,{children:"Total unique members who checked in"})]})})})]})}),e.jsxs(ms,{children:[p.products.length===0?e.jsx(ue,{children:e.jsx(b,{colSpan:p.months.length+3,className:"text-center py-8 text-slate-500",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(Le,{className:"w-8 h-8 text-slate-400"}),e.jsx("div",{className:"text-lg font-medium",children:"No Data Available"}),e.jsxs("div",{className:"text-sm",children:["Raw records: ",C.length," | Selected location: ",M," | Group by: ",t]}),e.jsx("div",{className:"text-xs mt-2 max-w-md text-center",children:"This could be due to restrictive filters, no data for the selected time period, or missing product/category information in the data."})]})})}):e.jsx(e.Fragment,{children:p.products.map(s=>{const l=ce.has(s.product),n=s.monthlyBreakdown.map(r=>r[E]);n.length>=2&&Ds(n[0],n[1]);const o=de.find(r=>r.id===E),h=s.monthlyBreakdown.reduce((r,g)=>r+g[E],0);return e.jsxs(Ss.Fragment,{children:[e.jsxs(ue,{className:"hover:bg-slate-50/50 transition-colors border-b",children:[e.jsx(b,{className:"font-medium text-slate-800 sticky left-0 bg-white z-10 border-r",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{variant:"ghost",size:"sm",onClick:()=>U(s.product),className:"p-1 h-6 w-6",children:l?e.jsx($s,{className:"w-3 h-3"}):e.jsx(Fs,{className:"w-3 h-3"})}),e.jsx("span",{className:"text-sm",children:s.product})]})}),s.monthlyBreakdown.map((r,g)=>{const j=r[E],c=o?.format==="currency"?Fe(j):o?.format==="percentage"?X(j):o?.format==="decimal"?j.toFixed(1):x(j);return e.jsx(b,{className:H("text-center text-sm font-medium",o?.color||"text-slate-800"),children:e.jsx(ns,{children:e.jsxs(rs,{children:[e.jsx(is,{className:"cursor-help",children:c}),e.jsx(os,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-semibold",children:r.month}),e.jsxs("p",{children:[o?.label,": ",c]}),e.jsxs("p",{className:"text-xs text-slate-400",children:[r.uniqueMembers," unique members"]})]})})]})})},r.month)}),e.jsx(b,{className:"text-center font-bold text-slate-700",children:o?.format==="currency"?Fe(h):o?.format==="percentage"?X(h/s.monthlyBreakdown.length):o?.format==="decimal"?(h/s.monthlyBreakdown.length).toFixed(1):x(h)}),e.jsx(b,{className:"text-center font-bold text-blue-600",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(xe,{className:"w-3 h-3"}),x(s.totalUniqueMembers)]})})]}),l&&e.jsx(ue,{className:"bg-gradient-to-r from-indigo-50/50 to-purple-50/50 animate-fade-in",children:e.jsx(b,{colSpan:p.months.length+3,className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:[e.jsx("p",{className:"text-slate-600 text-xs font-medium",children:"Total Check-ins"}),e.jsx("p",{className:"font-bold text-slate-800 text-2xl",children:x(s.totalVisits)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:[e.jsx("p",{className:"text-slate-600 text-xs font-medium",children:"Unique Members"}),e.jsx("p",{className:"font-bold text-indigo-600 text-2xl",children:x(s.totalUniqueMembers)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:[e.jsx("p",{className:"text-slate-600 text-xs font-medium",children:"Avg Visits/Member"}),e.jsx("p",{className:"font-bold text-purple-600 text-2xl",children:s.totalUniqueMembers>0?(s.totalVisits/s.totalUniqueMembers).toFixed(1):"0"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:[e.jsx("p",{className:"text-slate-600 text-xs font-medium",children:"Peak Month"}),e.jsx("p",{className:"font-bold text-pink-600 text-lg",children:s.monthlyBreakdown.reduce((r,g)=>g.visits>r.visits?g:r,s.monthlyBreakdown[0])?.month.split(" ")[0]||"-"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-slate-100 to-slate-50 px-4 py-2 border-b",children:[e.jsxs("h4",{className:"font-semibold text-slate-700 text-sm flex items-center justify-between",children:[e.jsxs("span",{children:['Individual Visit Records - Each Row = One Member Visit for "',s.product,'"']}),e.jsxs(A,{className:"bg-indigo-600 text-white",children:[a.filter(r=>t==="product"?r.cleanedProduct===s.product:t==="category"?r.cleanedCategory===s.product:t==="teacher"?r.teacherName===s.product:t==="location"?r.location===s.product:t==="memberStatus"?r.isNew===s.product:!1).length," individual visit records"]})]}),e.jsx("p",{className:"text-xs text-slate-600 mt-1 italic",children:"This table shows visit records matching all applied filters (including months). Change filters to see different data."})]}),e.jsx("div",{className:"overflow-x-auto max-h-[600px] overflow-y-auto",children:e.jsxs(cs,{children:[e.jsx(ds,{className:"sticky top-0 bg-gradient-to-r from-slate-700 via-slate-800 to-slate-700 z-10 shadow-lg",children:e.jsxs(ue,{className:"border-b border-slate-600",children:[e.jsx(w,{className:"font-bold text-white bg-transparent",children:"#"}),e.jsx(w,{className:"font-bold text-white bg-transparent",children:"Visit Date"}),e.jsx(w,{className:"font-bold text-white bg-transparent",children:"Month/Year"}),e.jsx(w,{className:"font-bold text-white bg-transparent",children:"Member Name"}),e.jsx(w,{className:"font-bold text-white bg-transparent",children:"Member ID"}),e.jsx(w,{className:"font-bold text-white bg-transparent",children:"Class Name"}),e.jsx(w,{className:"font-bold text-white bg-transparent",children:"Time"}),e.jsx(w,{className:"font-bold text-white bg-transparent",children:"Product"}),e.jsx(w,{className:"font-bold text-white bg-transparent",children:"Category"}),e.jsx(w,{className:"text-center font-bold text-white bg-transparent",children:"Status"}),e.jsx(w,{className:"text-center font-bold text-white bg-transparent",children:"New/Returning"}),e.jsx(w,{className:"text-center font-bold text-white bg-transparent",children:"Paid"}),e.jsx(w,{className:"font-bold text-white bg-transparent",children:"Teacher"}),e.jsx(w,{className:"font-bold text-white bg-transparent",children:"Location"})]})}),e.jsxs(ms,{children:[a.filter(r=>t==="product"?r.cleanedProduct===s.product:t==="category"?r.cleanedCategory===s.product:t==="teacher"?r.teacherName===s.product:t==="location"?r.location===s.product:t==="memberStatus"?r.isNew===s.product:!1).sort((r,g)=>{const j=new Date(r.dateIST||"");return new Date(g.dateIST||"").getTime()-j.getTime()}).map((r,g)=>e.jsxs(ue,{className:"hover:bg-indigo-50/30 border-b border-slate-100",children:[e.jsx(b,{className:"text-xs text-slate-500",children:g+1}),e.jsx(b,{className:"font-medium text-xs whitespace-nowrap",children:r.dateIST}),e.jsx(b,{className:"text-xs whitespace-nowrap",children:e.jsxs(A,{variant:"outline",className:"text-xs",children:[r.month," ",r.year]})}),e.jsxs(b,{className:"text-xs whitespace-nowrap",children:[r.firstName," ",r.lastName]}),e.jsx(b,{className:"text-xs font-mono",children:r.memberId}),e.jsx(b,{className:"text-xs max-w-[200px]",children:r.sessionName}),e.jsx(b,{className:"text-xs whitespace-nowrap",children:r.time}),e.jsx(b,{className:"text-xs",children:e.jsx(A,{variant:"secondary",className:"text-xs",children:r.cleanedProduct})}),e.jsx(b,{className:"text-xs",children:r.cleanedCategory}),e.jsx(b,{className:"text-center",children:r.checkedIn?e.jsxs(A,{className:"bg-green-100 text-green-800 text-xs whitespace-nowrap",children:[e.jsx(js,{className:"w-3 h-3 mr-1"}),"Checked In"]}):r.isLateCancelled?e.jsxs(A,{className:"bg-red-100 text-red-800 text-xs whitespace-nowrap",children:[e.jsx(fs,{className:"w-3 h-3 mr-1"}),"Late Cancel"]}):e.jsx(A,{className:"bg-amber-100 text-amber-800 text-xs whitespace-nowrap",children:"Booked Only"})}),e.jsx(b,{className:"text-center",children:e.jsx(A,{variant:r.isNew&&r.isNew.toLowerCase().includes("new")?"default":"outline",className:H("text-xs whitespace-nowrap",r.isNew&&r.isNew.toLowerCase().includes("new")?"bg-indigo-100 text-indigo-800":"bg-slate-100 text-slate-800"),children:r.isNew&&r.isNew.toLowerCase().includes("new")?"âœ¨ New":"â†©ï¸ Returning"})}),e.jsx(b,{className:"text-center text-xs",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:H("font-semibold",r.paid===0?"text-orange-600":"text-green-700"),children:Fe(r.paid||0)}),r.paid===0&&e.jsx(A,{variant:"outline",className:"text-xs bg-orange-50 text-orange-700 border-orange-300 mt-1",children:"Complimentary"})]})}),e.jsx(b,{className:"text-xs",children:r.teacherName}),e.jsx(b,{className:"text-xs",children:r.location})]},`${r.memberId}-${r.sessionId}-${g}`)),a.filter(r=>t==="product"?r.cleanedProduct===s.product:t==="category"?r.cleanedCategory===s.product:t==="teacher"?r.teacherName===s.product:t==="location"?r.location===s.product:t==="memberStatus"?r.isNew===s.product:!1).length===0&&e.jsx(ue,{children:e.jsxs(b,{colSpan:14,className:"text-center py-8 text-slate-500",children:["No visit records found for this ",t," with the current filters applied"]})})]})]})})]})]})})})]},s.product)})}),p.products.length>0&&e.jsxs(ue,{className:"bg-gradient-to-r from-emerald-50 to-green-50 border-t-2 border-emerald-600 font-bold",children:[e.jsx(b,{className:"sticky left-0 bg-gradient-to-r from-emerald-100 to-green-100 z-10 border-r",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6"})," ",e.jsxs("span",{className:"text-emerald-800 font-bold text-sm",children:["TOTAL (All ",t.charAt(0).toUpperCase()+t.slice(1),"s)"]})]})}),p.totalsRow.monthlyBreakdown.map(s=>{const l=de.find(h=>h.id===E),n=s[E],o=l?.format==="currency"?Fe(n):l?.format==="percentage"?X(n):l?.format==="decimal"?n.toFixed(1):x(n);return e.jsx(b,{className:"text-center font-bold text-emerald-800",children:e.jsx(ns,{children:e.jsxs(rs,{children:[e.jsx(is,{className:"cursor-help",children:o}),e.jsx(os,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-semibold",children:s.month}),e.jsxs("p",{children:[l?.label,": ",o]}),e.jsxs("p",{className:"text-xs text-slate-400",children:[s.uniqueMembers," unique members"]})]})})]})})},s.month)}),e.jsx(b,{className:"text-center font-bold text-emerald-800 text-base",children:(()=>{const s=de.find(n=>n.id===E),l=p.totalsRow.monthlyBreakdown.reduce((n,o)=>n+o[E],0);return s?.format==="currency"?Fe(l):s?.format==="percentage"?X(l/p.totalsRow.monthlyBreakdown.length):s?.format==="decimal"?(l/p.totalsRow.monthlyBreakdown.length).toFixed(1):x(l)})()}),e.jsx(b,{className:"text-center font-bold text-emerald-800 text-base",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(xe,{className:"w-4 h-4"}),x(p.totalsRow.totalUniqueMembers)]})})]})]})]})})})]})}),e.jsx(Re,{value:"visit-frequency",className:"mt-6 space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsxs(I,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(D,{className:"pb-4 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-6 h-6"}),e.jsxs(O,{className:"text-xl font-bold",children:["Monthly Visit Frequency by ",$.charAt(0).toUpperCase()+$.slice(1)]})]}),e.jsx(ws,{tableRef:Ke,tableName:"Attendance Frequency Breakdown",size:"sm",onCopyAllTabs:async()=>Xe(),contextInfo:{...z,additionalInfo:{...z.additionalInfo,breakdownBy:$.charAt(0).toUpperCase()+$.slice(1),quickFilter:ve!=="All"?ve:void 0}}})]})}),e.jsxs(P,{className:"p-6 space-y-4",ref:Ke,children:[e.jsxs("div",{className:"flex flex-wrap gap-2 pb-3 border-b border-blue-200",children:[e.jsxs(J,{size:"sm",variant:$==="class"?"default":"outline",onClick:()=>{je("class"),Ne("All")},className:H("flex items-center gap-1",$==="class"?"bg-indigo-600 hover:bg-indigo-700":""),children:[e.jsx(qe,{className:"w-3 h-3"}),"Class"]}),e.jsxs(J,{size:"sm",variant:$==="product"?"default":"outline",onClick:()=>{je("product"),Ne("All")},className:H("flex items-center gap-1",$==="product"?"bg-indigo-600 hover:bg-indigo-700":""),children:[e.jsx(Ce,{className:"w-3 h-3"}),"Product"]}),e.jsxs(J,{size:"sm",variant:$==="category"?"default":"outline",onClick:()=>{je("category"),Ne("All")},className:H("flex items-center gap-1",$==="category"?"bg-indigo-600 hover:bg-indigo-700":""),children:[e.jsx(ps,{className:"w-3 h-3"}),"Category"]}),e.jsxs(J,{size:"sm",variant:$==="teacher"?"default":"outline",onClick:()=>{je("teacher"),Ne("All")},className:H("flex items-center gap-1",$==="teacher"?"bg-indigo-600 hover:bg-indigo-700":""),children:[e.jsx(xe,{className:"w-3 h-3"}),"Teacher"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Filter by Month:"}),e.jsxs("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto",children:[e.jsx(A,{className:H("cursor-pointer transition-all",ve==="All"?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-slate-200 text-slate-700 hover:bg-slate-300"),onClick:()=>Ne("All"),children:"All Months"}),(()=>{const s=new Set;return Object.values(q).forEach(l=>{Object.keys(l).forEach(n=>s.add(n))}),Array.from(s).sort((l,n)=>{const[o,h]=l.split("-"),[r,g]=n.split("-"),j=new Date(`${o} 1, ${h}`);return new Date(`${r} 1, ${g}`).getTime()-j.getTime()}).map(l=>e.jsx(A,{className:H("cursor-pointer transition-all",ve===l?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-slate-200 text-slate-700 hover:bg-slate-300"),onClick:()=>Ne(l),children:l},l))})()]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(cs,{className:"unified-table",children:[e.jsx(ds,{className:"sticky top-0 z-10 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:e.jsxs(ue,{className:"border-none",children:[e.jsx(w,{className:"font-bold text-white sticky left-0 bg-slate-800/95 backdrop-blur-sm z-20 min-w-[200px] border-r border-white/20",children:$.charAt(0).toUpperCase()+$.slice(1)}),e.jsx(w,{className:"text-center font-bold text-white border-l border-white/20",children:"1 class"}),e.jsx(w,{className:"text-center font-bold text-white border-l border-white/20",children:"2-5 classes"}),e.jsx(w,{className:"text-center font-bold text-white border-l border-white/20",children:"6-10 classes"}),e.jsx(w,{className:"text-center font-bold text-white border-l border-white/20",children:"11-15 classes"}),e.jsx(w,{className:"text-center font-bold text-white border-l border-white/20",children:"16-20 classes"}),e.jsx(w,{className:"text-center font-bold text-white border-l border-white/20",children:"21-25 classes"}),e.jsx(w,{className:"text-center font-bold text-white border-l border-white/20",children:">25 classes"}),e.jsx(w,{className:"text-center font-bold text-white border-l border-white/20",children:"Total"})]})}),e.jsx(ms,{children:(()=>{const s={};return Object.entries(q).forEach(([l,n])=>{s[l]={"1 class":0,"2-5 classes":0,"6-10 classes":0,"11-15 classes":0,"16-20 classes":0,"21-25 classes":0,">25 classes":0},Object.entries(n).forEach(([o,h])=>{(ve==="All"||o===ve)&&Object.entries(h).forEach(([r,g])=>{s[l][r]+=g})})}),Object.entries(s).sort(([l],[n])=>l.localeCompare(n)).map(([l,n])=>{const o=Object.values(n).reduce((h,r)=>h+r,0);return o===0?null:e.jsxs(ue,{className:"hover:bg-slate-50/50 transition-colors border-b",children:[e.jsx(b,{className:"font-medium text-slate-800 sticky left-0 bg-white z-10 border-r",children:l}),e.jsx(b,{className:"text-center text-sm font-medium text-slate-700",children:x(n["1 class"])}),e.jsx(b,{className:"text-center text-sm font-medium text-slate-700",children:x(n["2-5 classes"])}),e.jsx(b,{className:"text-center text-sm font-medium text-slate-700",children:x(n["6-10 classes"])}),e.jsx(b,{className:"text-center text-sm font-medium text-slate-700",children:x(n["11-15 classes"])}),e.jsx(b,{className:"text-center text-sm font-medium text-slate-700",children:x(n["16-20 classes"])}),e.jsx(b,{className:"text-center text-sm font-medium text-slate-700",children:x(n["21-25 classes"])}),e.jsx(b,{className:"text-center text-sm font-medium text-slate-700",children:x(n[">25 classes"])}),e.jsx(b,{className:"text-center text-sm font-bold text-indigo-700 bg-indigo-50",children:x(o)})]},l)}).filter(Boolean)})()})]})})]})]})})}),e.jsx(Re,{value:"cancellations",className:"mt-6 space-y-6",children:e.jsxs(I,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsxs(D,{className:"pb-4 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white rounded-t-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-6 h-6"}),e.jsxs(O,{className:"text-xl font-bold",children:["Late Cancellation Frequency by ",V.charAt(0).toUpperCase()+V.slice(1)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(A,{className:"bg-white/20 text-white border-white/30",children:[Object.keys(u).length," ",V.charAt(0).toUpperCase()+V.slice(1),"s"]}),e.jsx(ws,{tableRef:Be,tableName:"Late Cancellations Breakdown",size:"sm",onCopyAllTabs:async()=>He(),contextInfo:{...z,additionalInfo:{...z.additionalInfo,breakdownBy:V.charAt(0).toUpperCase()+V.slice(1),quickFilter:Te!=="All"?Te:void 0}}})]})]}),e.jsx("p",{className:"text-indigo-100 text-sm mt-2",children:"Distribution of members by late cancellations per month"})]}),e.jsxs(P,{className:"p-6 space-y-4",ref:Be,children:[e.jsxs("div",{className:"flex flex-wrap gap-2 pb-3 border-b border-red-200",children:[e.jsxs(J,{size:"sm",variant:V==="class"?"default":"outline",onClick:()=>{Oe("class"),ye("All")},className:H("flex items-center gap-1",V==="class"?"bg-indigo-600 hover:bg-indigo-700":""),children:[e.jsx(qe,{className:"w-3 h-3"}),"Class"]}),e.jsxs(J,{size:"sm",variant:V==="product"?"default":"outline",onClick:()=>{Oe("product"),ye("All")},className:H("flex items-center gap-1",V==="product"?"bg-indigo-600 hover:bg-indigo-700":""),children:[e.jsx(Ce,{className:"w-3 h-3"}),"Product"]}),e.jsxs(J,{size:"sm",variant:V==="category"?"default":"outline",onClick:()=>{Oe("category"),ye("All")},className:H("flex items-center gap-1",V==="category"?"bg-indigo-600 hover:bg-indigo-700":""),children:[e.jsx(ps,{className:"w-3 h-3"}),"Category"]}),e.jsxs(J,{size:"sm",variant:V==="teacher"?"default":"outline",onClick:()=>{Oe("teacher"),ye("All")},className:H("flex items-center gap-1",V==="teacher"?"bg-indigo-600 hover:bg-indigo-700":""),children:[e.jsx(xe,{className:"w-3 h-3"}),"Teacher"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700",children:"Filter by Month:"}),e.jsxs("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto",children:[e.jsx(A,{className:H("cursor-pointer transition-all",Te==="All"?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-slate-200 text-slate-700 hover:bg-slate-300"),onClick:()=>ye("All"),children:"All Months"}),(()=>{const s=new Set;return Object.values(u).forEach(l=>{Object.keys(l).forEach(n=>s.add(n))}),Array.from(s).sort((l,n)=>{const[o,h]=l.split("-"),[r,g]=n.split("-"),j=new Date(`${o} 1, ${h}`);return new Date(`${r} 1, ${g}`).getTime()-j.getTime()}).map(l=>e.jsx(A,{className:H("cursor-pointer transition-all",Te===l?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-slate-200 text-slate-700 hover:bg-slate-300"),onClick:()=>ye(l),children:l},l))})()]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(cs,{children:[e.jsx(ds,{className:"sticky top-0 z-10 bg-gradient-to-r from-red-700 via-red-800 to-red-700",children:e.jsxs(ue,{className:"border-none",children:[e.jsx(w,{className:"font-bold text-white sticky left-0 bg-red-800/95 backdrop-blur-sm z-20 min-w-[200px]",children:V.charAt(0).toUpperCase()+V.slice(1)}),e.jsx(w,{className:"text-center font-bold text-white",children:"1 cancellation"}),e.jsx(w,{className:"text-center font-bold text-white",children:"2-5 cancellations"}),e.jsx(w,{className:"text-center font-bold text-white",children:"6-10 cancellations"}),e.jsx(w,{className:"text-center font-bold text-white",children:"11-15 cancellations"}),e.jsx(w,{className:"text-center font-bold text-white",children:"16-20 cancellations"}),e.jsx(w,{className:"text-center font-bold text-white",children:"21-25 cancellations"}),e.jsx(w,{className:"text-center font-bold text-white",children:">25 cancellations"}),e.jsx(w,{className:"text-center font-bold text-white",children:"Total"})]})}),e.jsx(ms,{children:(()=>{const s={};return Object.entries(u).forEach(([l,n])=>{s[l]={"1 cancellation":0,"2-5 cancellations":0,"6-10 cancellations":0,"11-15 cancellations":0,"16-20 cancellations":0,"21-25 cancellations":0,">25 cancellations":0},Object.entries(n).forEach(([o,h])=>{(Te==="All"||o===Te)&&Object.entries(h).forEach(([r,g])=>{s[l][r]+=g})})}),Object.entries(s).sort(([l],[n])=>l.localeCompare(n)).map(([l,n])=>{const o=Object.values(n).reduce((h,r)=>h+r,0);return o===0?null:e.jsxs(ue,{className:"hover:bg-slate-50/50 transition-colors border-b",children:[e.jsx(b,{className:"font-medium text-slate-800 sticky left-0 bg-white z-10 border-r",children:l}),e.jsx(b,{className:"text-center text-sm font-medium text-slate-700",children:x(n["1 cancellation"])}),e.jsx(b,{className:"text-center text-sm font-medium text-slate-700",children:x(n["2-5 cancellations"])}),e.jsx(b,{className:"text-center text-sm font-medium text-slate-700",children:x(n["6-10 cancellations"])}),e.jsx(b,{className:"text-center text-sm font-medium text-slate-700",children:x(n["11-15 cancellations"])}),e.jsx(b,{className:"text-center text-sm font-medium text-slate-700",children:x(n["16-20 cancellations"])}),e.jsx(b,{className:"text-center text-sm font-medium text-slate-700",children:x(n["21-25 cancellations"])}),e.jsx(b,{className:"text-center text-sm font-medium text-slate-700",children:x(n[">25 cancellations"])}),e.jsx(b,{className:"text-center text-sm font-bold text-indigo-700 bg-indigo-50",children:x(o)})]},l)}).filter(Boolean)})()})]})})]})]})}),e.jsx(Re,{value:"multiple-classes",className:"mt-6 space-y-6",children:e.jsxs(I,{className:"border-0 shadow-lg bg-white/80 backdrop-blur-sm rounded-2xl",children:[e.jsxs(D,{className:"pb-4 border-b border-slate-100",children:[e.jsxs(O,{className:"text-xl font-semibold text-slate-800 flex items-center gap-3",children:[e.jsx(xe,{className:"w-6 h-6 text-purple-600"}),"Multiple Classes Per Day Analysis"]}),e.jsx("p",{className:"text-slate-600 text-sm mt-2",children:"Members attending more than one class on the same day"})]}),e.jsx(P,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200 hover:shadow-lg transition-shadow",children:[e.jsx("p",{className:"text-slate-600 text-sm font-medium mb-2",children:"Members with Multiple Classes/Day"}),e.jsx("p",{className:"font-bold text-blue-800 text-3xl",children:x(ae.membersWithMultipleClasses)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-indigo-50 to-purple-50 p-6 rounded-xl border border-indigo-200 hover:shadow-lg transition-shadow",children:[e.jsx("p",{className:"text-slate-600 text-sm font-medium mb-2",children:"Total Days with Multiple Classes"}),e.jsx("p",{className:"font-bold text-indigo-800 text-3xl",children:x(ae.totalMultipleClassDays)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 p-6 rounded-xl border border-purple-200 hover:shadow-lg transition-shadow",children:[e.jsx("p",{className:"text-slate-600 text-sm font-medium mb-2",children:"Avg Multiple Class Days/Member"}),e.jsx("p",{className:"font-bold text-purple-800 text-3xl",children:ae.avgMultipleClassDays})]})]})})]})}),e.jsx(Re,{value:"member-behavior",className:"mt-6 space-y-6",children:e.jsx(xt,{})})]})]})]})}),e.jsx(Us,{})]})})};export{Jt as PatternsAndTrends,Jt as default};
//# sourceMappingURL=PatternsAndTrends-QzZMtvq8.js.map
