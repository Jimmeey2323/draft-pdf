import{r as x,w as I,j as e,D,n as M,o as V,q as $,X as q,C as g,c as b,a as w,b as T}from"./index-Bm67KBkU.js";import{f,a as j,B as E}from"./index-DkD_C-d1.js";import{b as y,e as C,T as A,a as H,c as U,d as B}from"./table-DhXofKdS.js";import{S as L}from"./skeleton-Ccx3hRRa.js";import{C as O}from"./CopyTableButton-Blm2CDq4.js";import{E as P}from"./SalesMotionHero-sGphstF2.js";import{T as R}from"./target-BmxdxojS.js";import{D as X}from"./dollar-sign-CKqx8kbC.js";import{U as Z}from"./users-7Ku-1TDB.js";import{T as _}from"./googleAuth-BGo8ElRc.js";import"./dropdown-menu-B9zQ9u84.js";import"./chevron-right-CbIMR3DA.js";import"./file-text-DChZNHsM.js";function G({data:u,columns:d,loading:t=!1,maxHeight:l="600px",stickyHeader:N=!0,stickyFirstColumn:h=!1,showFooter:n=!1,footerData:i,onRowClick:p,tableId:s="optimized-table",showCopyButton:r=!0}){const c=x.useRef(null),{registerTable:v,unregisterTable:k}=I();x.useEffect(()=>{if(s)return v(s,c),()=>k(s)},[s,v,k]);const S=x.useMemo(()=>u.map((a,m)=>e.jsx(y,{className:"hover:bg-gray-50/80 transition-colors duration-150 border-b border-gray-200 cursor-pointer",onClick:()=>p?.(a),children:d.map((o,z)=>e.jsx(C,{className:`
              py-3 px-4 align-middle font-medium text-sm
              ${o.align==="center"?"text-center":o.align==="right"?"text-right":"text-left"}
              ${h&&z===0?"sticky left-0 bg-white z-10 border-r border-gray-200":""}
              ${o.className||""}
            `,children:o.render?o.render(a[o.key],a):a[o.key]},String(o.key)))},m)),[u,d,p,h]);return t?e.jsx("div",{className:"space-y-2",children:Array.from({length:5}).map((a,m)=>e.jsx(L,{className:"h-12 w-full"},m))}):e.jsxs("div",{className:"relative w-full",children:[r&&e.jsx("div",{className:"absolute right-2 top-2 z-40",children:e.jsx(O,{tableRef:c})}),e.jsx("div",{className:"relative w-full overflow-auto border border-gray-200 rounded-lg bg-white shadow-sm",style:{maxHeight:l},children:e.jsxs(A,{ref:c,id:s,children:[e.jsx(H,{className:N?"sticky top-0 z-20 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800":"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800",children:e.jsx(y,{className:"border-b-2 border-slate-600",children:d.map((a,m)=>e.jsx(U,{className:`
                    font-bold text-white py-4 px-4 text-sm uppercase tracking-wider
                    ${a.align==="center"?"text-center":a.align==="right"?"text-right":"text-left"}
                    ${h&&m===0?"sticky left-0 bg-gradient-to-r from-slate-800 to-slate-900 z-30 border-r border-slate-600":""}
                  `,children:a.header},String(a.key)))})}),e.jsx(B,{children:S}),n&&i&&e.jsx("tfoot",{className:"sticky bottom-0 z-20 bg-slate-800 text-white border-t-2 border-slate-600",children:e.jsx(y,{className:"hover:bg-slate-800",children:d.map((a,m)=>e.jsx(C,{className:`
                    py-4 px-4 font-bold text-base align-middle
                    ${a.align==="center"?"text-center":a.align==="right"?"text-right":"text-left"}
                    ${h&&m===0?"sticky left-0 bg-slate-800 z-30 border-r border-slate-600":""}
                  `,children:a.render&&i[a.key]!==void 0?a.render(i[a.key],i):i[a.key]||""},String(a.key)))})})]})})]})}const J=x.memo(G),ce=({isOpen:u,onClose:d,data:t,relatedData:l,type:N,title:h})=>{const n=x.useMemo(()=>{if(t?.filteredTransactionData&&t.filteredTransactionData.length>0)return t.filteredTransactionData;if(t?.rawData&&t.rawData.length>0)return t.rawData;if(!t||!l)return[];let s=[];switch(N){case"product":s=l.filter(r=>r.paymentItem===t.name||r.cleanedProduct===t.name||r.product===t.name);break;case"category":s=l.filter(r=>r.cleanedCategory===t.name||r.category===t.name);break;case"member":s=l.filter(r=>r.customerName===t.name||r.memberId===t.memberId);break;case"seller":s=l.filter(r=>r.soldBy===t.name);break;case"trainer":s=l.filter(r=>r.teacherName===t.name||r.Trainer===t.name||r.trainerName===t.name);break;case"location":s=l.filter(r=>r.calculatedLocation===t.name||r.location===t.name||r.center===t.name);break;case"lead":s=l.filter(r=>r.id===t.id||r.memberId===t.memberId);break;case"client":s=l.filter(r=>r.memberId===t.memberId||r.firstName===t.firstName);break;default:s=l.slice(0,100);break}return s},[t,l,N]),i=x.useMemo(()=>{if(!n.length)return null;const s={totalRecords:n.length,totalRevenue:0,totalTransactions:0,uniqueCustomers:new Set,avgValue:0};return n.forEach(r=>{r.paymentValue&&(s.totalRevenue+=r.paymentValue,s.totalTransactions+=1),r.memberId&&s.uniqueCustomers.add(r.memberId),r.ltv&&(s.totalRevenue+=r.ltv)}),s.avgValue=s.totalTransactions>0?s.totalRevenue/s.totalTransactions:0,{...s,uniqueCustomers:s.uniqueCustomers.size}},[n]),p=x.useMemo(()=>{if(!n.length)return[];const s=n[0],r=[];return s.paymentDate?r.push({key:"paymentDate",header:"Date",align:"center"},{key:"customerName",header:"Customer",align:"left"},{key:"paymentItem",header:"Product",align:"left"},{key:"paymentValue",header:"Amount",align:"right",render:c=>f(c)},{key:"paymentMethod",header:"Method",align:"center"}):s.firstName||s.fullName?r.push({key:"firstName",header:"First Name",align:"left"},{key:"lastName",header:"Last Name",align:"left"},{key:"email",header:"Email",align:"left"},{key:"ltv",header:"LTV",align:"right",render:c=>f(c||0)},{key:"conversionStatus",header:"Status",align:"center"}):s.date||s.sessionId?r.push({key:"date",header:"Date",align:"center"},{key:"cleanedClass",header:"Class",align:"left"},{key:"instructor",header:"Instructor",align:"left"},{key:"checkedInCount",header:"Attendance",align:"center"},{key:"capacity",header:"Capacity",align:"center"}):s.teacherName&&r.push({key:"teacherName",header:"Trainer",align:"left"},{key:"totalSessions",header:"Sessions",align:"center"},{key:"totalCustomers",header:"Customers",align:"center"},{key:"totalPaid",header:"Revenue",align:"right",render:c=>f(c||0)},{key:"location",header:"Location",align:"center"}),r},[n]);return u?e.jsx(D,{open:u,onOpenChange:d,children:e.jsxs(M,{className:"max-w-6xl max-h-[90vh] p-0 bg-white",children:[e.jsx(V,{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs($,{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx(P,{className:"w-6 h-6"}),h," - Detailed View"]}),e.jsx("button",{onClick:d,className:"text-white hover:text-gray-200 transition-colors p-1 rounded-full hover:bg-white/10",children:e.jsx(q,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:[i&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(g,{className:"border-blue-200 bg-blue-50/50",children:e.jsxs(b,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(R,{className:"w-5 h-5 text-blue-600"})}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:j(i.totalRecords)}),e.jsx("div",{className:"text-sm text-blue-600",children:"Total Records"})]})}),e.jsx(g,{className:"border-green-200 bg-green-50/50",children:e.jsxs(b,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(X,{className:"w-5 h-5 text-green-600"})}),e.jsx("div",{className:"text-2xl font-bold text-green-900",children:f(i.totalRevenue)}),e.jsx("div",{className:"text-sm text-green-600",children:"Total Revenue"})]})}),e.jsx(g,{className:"border-purple-200 bg-purple-50/50",children:e.jsxs(b,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(Z,{className:"w-5 h-5 text-purple-600"})}),e.jsx("div",{className:"text-2xl font-bold text-purple-900",children:j(i.uniqueCustomers)}),e.jsx("div",{className:"text-sm text-purple-600",children:"Unique Customers"})]})}),e.jsx(g,{className:"border-orange-200 bg-orange-50/50",children:e.jsxs(b,{className:"p-4 text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(_,{className:"w-5 h-5 text-orange-600"})}),e.jsx("div",{className:"text-2xl font-bold text-orange-900",children:f(i.avgValue)}),e.jsx("div",{className:"text-sm text-orange-600",children:"Average Value"})]})})]}),e.jsxs(g,{className:"border-0 shadow-lg",children:[e.jsx(w,{className:"bg-gradient-to-r from-slate-100 to-slate-200 border-b",children:e.jsxs(T,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Detailed Data"}),e.jsxs(E,{variant:"secondary",className:"bg-blue-100 text-blue-700",children:[n.length," items"]})]})}),e.jsx(b,{className:"p-0",children:p.length>0&&n.length>0?e.jsx(J,{data:n.slice(0,100),columns:p,maxHeight:"500px",stickyHeader:!0}):e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(R,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium",children:"No detailed data available"}),e.jsx("p",{className:"text-sm",children:"This item doesn't have associated transaction details."})]})})]}),t&&e.jsxs(g,{className:"border-0 shadow-lg",children:[e.jsx(w,{className:"bg-gradient-to-r from-gray-100 to-gray-200 border-b",children:e.jsx(T,{children:"Item Summary"})}),e.jsx(b,{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:Object.entries(t).map(([s,r])=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-gray-600 capitalize",children:s.replace(/([A-Z])/g," $1").replace(/^./,c=>c.toUpperCase())}),e.jsx("div",{className:"text-gray-900 font-semibold",children:typeof r=="number"&&(s.includes("revenue")||s.includes("value")||s.includes("ltv"))?f(r):typeof r=="number"?j(r):String(r||"N/A")})]},s))})})]})]})]})}):null};export{ce as UniversalDrillDownModal};
//# sourceMappingURL=UniversalDrillDownModal-U61av5hX.js.map
