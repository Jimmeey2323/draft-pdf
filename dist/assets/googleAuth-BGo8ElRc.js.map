{"version":3,"file":"googleAuth-BGo8ElRc.js","sources":["../../node_modules/lucide-react/dist/esm/icons/calendar.js","../../node_modules/lucide-react/dist/esm/icons/trending-up.js","../../src/utils/logger.ts","../../src/utils/googleAuth.ts"],"sourcesContent":["/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Calendar = createLucideIcon(\"Calendar\", [\n  [\"path\", { d: \"M8 2v4\", key: \"1cmpym\" }],\n  [\"path\", { d: \"M16 2v4\", key: \"4m81vk\" }],\n  [\"rect\", { width: \"18\", height: \"18\", x: \"3\", y: \"4\", rx: \"2\", key: \"1hopcy\" }],\n  [\"path\", { d: \"M3 10h18\", key: \"8toen8\" }]\n]);\n\nexport { Calendar as default };\n//# sourceMappingURL=calendar.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst TrendingUp = createLucideIcon(\"TrendingUp\", [\n  [\"polyline\", { points: \"22 7 13.5 15.5 8.5 10.5 2 17\", key: \"126l90\" }],\n  [\"polyline\", { points: \"16 7 22 7 22 13\", key: \"kwv8wd\" }]\n]);\n\nexport { TrendingUp as default };\n//# sourceMappingURL=trending-up.js.map\n","/**\n * Centralized Logging Utility\n * \n * Provides consistent, production-optimized logging across the application.\n */\n\ntype LogLevel = 'debug' | 'info' | 'warn' | 'error';\n\ninterface LogEntry {\n  level: LogLevel;\n  message: string;\n  data?: any;\n  timestamp: Date;\n  source?: string;\n}\n\nconst isProd = import.meta.env.PROD;\n\n// Log history for debugging (keeps last 50 entries in production, 100 in dev)\nconst logHistory: LogEntry[] = [];\nconst MAX_LOG_HISTORY = isProd ? 50 : 100;\n\nconst addToHistory = (entry: LogEntry) => {\n  logHistory.push(entry);\n  if (logHistory.length > MAX_LOG_HISTORY) {\n    logHistory.shift();\n  }\n};\n\nconst shouldLog = (level: LogLevel): boolean => {\n  if (isProd) {\n    // In production, only log errors and warnings\n    return level === 'warn' || level === 'error';\n  }\n  // In development, log all levels\n  return true;\n};\n\n/**\n * Create a logger instance with an optional source identifier\n */\nexport const createLogger = (source?: string) => ({\n  debug: (message: string, data?: any) => {\n    if (!shouldLog('debug')) return;\n    const entry: LogEntry = { level: 'debug', message, data, timestamp: new Date(), source };\n    addToHistory(entry);\n    if (data !== undefined) {\n      console.log(`[${source || 'App'}] ${message}`, data);\n    } else {\n      console.log(`[${source || 'App'}] ${message}`);\n    }\n  },\n\n  info: (message: string, data?: any) => {\n    if (!shouldLog('info')) return;\n    const entry: LogEntry = { level: 'info', message, data, timestamp: new Date(), source };\n    addToHistory(entry);\n    if (data !== undefined) {\n      console.info(`[${source || 'App'}] ${message}`, data);\n    } else {\n      console.info(`[${source || 'App'}] ${message}`);\n    }\n  },\n\n  warn: (message: string, data?: any) => {\n    if (!shouldLog('warn')) return;\n    const entry: LogEntry = { level: 'warn', message, data, timestamp: new Date(), source };\n    addToHistory(entry);\n    if (data !== undefined) {\n      console.warn(`[${source || 'App'}] ${message}`, data);\n    } else {\n      console.warn(`[${source || 'App'}] ${message}`);\n    }\n  },\n\n  error: (message: string, error?: any) => {\n    const entry: LogEntry = { level: 'error', message, data: error, timestamp: new Date(), source };\n    addToHistory(entry);\n    // Always log errors\n    if (error !== undefined) {\n      console.error(`[${source || 'App'}] ${message}`, error);\n    } else {\n      console.error(`[${source || 'App'}] ${message}`);\n    }\n  },\n});\n\n/**\n * Default logger instance\n */\nexport const logger = createLogger();\n\n/**\n * Get log history for debugging\n */\nexport const getLogHistory = (): LogEntry[] => [...logHistory];\n\n/**\n * Clear log history\n */\nexport const clearLogHistory = () => {\n  logHistory.length = 0;\n};\n\n/**\n * Export logs as JSON string (useful for bug reports)\n */\nexport const exportLogs = (): string => {\n  return JSON.stringify(logHistory, null, 2);\n};\n\n// Attach to window for debugging in development\nif (!isProd && typeof window !== 'undefined') {\n  (window as any).__appLogs = {\n    getHistory: getLogHistory,\n    clear: clearLogHistory,\n    export: exportLogs,\n  };\n}\n","/**\n * Centralized Google OAuth Authentication Utility\n * \n * This module provides a single source of truth for Google API authentication,\n * with built-in rate limiting, caching, and error handling.\n */\n\n// Google OAuth Configuration from environment variables\nconst GOOGLE_CONFIG = {\n  CLIENT_ID: import.meta.env.VITE_GOOGLE_CLIENT_ID || '',\n  CLIENT_SECRET: import.meta.env.VITE_GOOGLE_CLIENT_SECRET || '',\n  REFRESH_TOKEN: import.meta.env.VITE_GOOGLE_REFRESH_TOKEN || '',\n  TOKEN_URL: import.meta.env.VITE_GOOGLE_TOKEN_URL || 'https://oauth2.googleapis.com/token'\n};\n\n// Spreadsheet IDs\nexport const SPREADSHEET_IDS = {\n  PAYROLL: import.meta.env.VITE_PAYROLL_SPREADSHEET_ID || '1DSRuJJBhl1Sc9yfY6ki-ZFhdmQ_OeVeGyPDE6n9zpK4',\n  SESSIONS: import.meta.env.VITE_SESSIONS_SPREADSHEET_ID || '1mqjZXStj_PeCt_exDSk-1RP-20Jgk0yl1Lmcg3sZty8',\n  EXPIRATIONS: import.meta.env.VITE_EXPIRATIONS_SPREADSHEET_ID || '1rGMDDvvTbZfNg1dueWtRN3LhOgGQOdLg3Fd7Sn1GCZo',\n  SALES: import.meta.env.VITE_SALES_SPREADSHEET_ID || '1HbGnJk-peffUp7XoXSlsL55924E9yUt8cP_h93cdTT0',\n};\n\n// Token cache\nlet cachedToken: string | null = null;\nlet tokenExpiry: number = 0;\n\n// Request queue for rate limiting\ninterface QueuedRequest {\n  resolve: (value: any) => void;\n  reject: (error: any) => void;\n  request: () => Promise<any>;\n}\n\nconst requestQueue: QueuedRequest[] = [];\nlet isProcessingQueue = false;\nlet lastRequestTime = 0;\nconst MIN_REQUEST_INTERVAL = 1000; // 1 second between requests (60/min limit)\n\n/**\n * Get a valid access token, using cache when possible\n */\nexport const getGoogleAccessToken = async (): Promise<string> => {\n  // Return cached token if still valid (with 5 minute buffer)\n  if (cachedToken && Date.now() < tokenExpiry - 300000) {\n    return cachedToken;\n  }\n\n  try {\n    const response = await fetch(GOOGLE_CONFIG.TOKEN_URL, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: new URLSearchParams({\n        client_id: GOOGLE_CONFIG.CLIENT_ID,\n        client_secret: GOOGLE_CONFIG.CLIENT_SECRET,\n        refresh_token: GOOGLE_CONFIG.REFRESH_TOKEN,\n        grant_type: 'refresh_token',\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`Token refresh failed: ${response.status}`);\n    }\n\n    const tokenData = await response.json();\n    \n    // Cache the token (typically valid for 1 hour)\n    cachedToken = tokenData.access_token;\n    tokenExpiry = Date.now() + (tokenData.expires_in || 3600) * 1000;\n    \n    return cachedToken;\n  } catch (error) {\n    console.error('Error getting access token:', error);\n    throw error;\n  }\n};\n\n/**\n * Process the request queue with rate limiting\n */\nconst processQueue = async () => {\n  if (isProcessingQueue || requestQueue.length === 0) return;\n  \n  isProcessingQueue = true;\n  \n  while (requestQueue.length > 0) {\n    const now = Date.now();\n    const timeSinceLastRequest = now - lastRequestTime;\n    \n    if (timeSinceLastRequest < MIN_REQUEST_INTERVAL) {\n      await new Promise(resolve => setTimeout(resolve, MIN_REQUEST_INTERVAL - timeSinceLastRequest));\n    }\n    \n    const item = requestQueue.shift();\n    if (!item) continue;\n    \n    try {\n      lastRequestTime = Date.now();\n      const result = await item.request();\n      item.resolve(result);\n    } catch (error) {\n      item.reject(error);\n    }\n  }\n  \n  isProcessingQueue = false;\n};\n\n/**\n * Queue a request to be executed with rate limiting\n */\nexport const queueRequest = <T>(request: () => Promise<T>): Promise<T> => {\n  return new Promise((resolve, reject) => {\n    requestQueue.push({ resolve, reject, request });\n    processQueue();\n  });\n};\n\n/**\n * Fetch data from a Google Sheet with rate limiting\n */\nexport const fetchGoogleSheet = async (\n  spreadsheetId: string,\n  range: string,\n  options: {\n    valueRenderOption?: 'FORMATTED_VALUE' | 'UNFORMATTED_VALUE' | 'FORMULA';\n    dateTimeRenderOption?: 'SERIAL_NUMBER' | 'FORMATTED_STRING';\n  } = {}\n): Promise<any[][]> => {\n  const { \n    valueRenderOption = 'UNFORMATTED_VALUE',\n    dateTimeRenderOption = 'FORMATTED_STRING'\n  } = options;\n\n  return queueRequest(async () => {\n    const accessToken = await getGoogleAccessToken();\n    \n    const url = new URL(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${encodeURIComponent(range)}`);\n    url.searchParams.set('valueRenderOption', valueRenderOption);\n    url.searchParams.set('dateTimeRenderOption', dateTimeRenderOption);\n    \n    const response = await fetch(url.toString(), {\n      headers: {\n        Authorization: `Bearer ${accessToken}`,\n      },\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`Failed to fetch sheet data: ${response.status} - ${errorText}`);\n    }\n\n    const result = await response.json();\n    return result.values || [];\n  });\n};\n\n/**\n * Batch fetch multiple ranges from a Google Sheet\n */\nexport const batchFetchGoogleSheet = async (\n  spreadsheetId: string,\n  ranges: string[],\n  options: {\n    valueRenderOption?: 'FORMATTED_VALUE' | 'UNFORMATTED_VALUE' | 'FORMULA';\n    dateTimeRenderOption?: 'SERIAL_NUMBER' | 'FORMATTED_STRING';\n  } = {}\n): Promise<Map<string, any[][]>> => {\n  const { \n    valueRenderOption = 'UNFORMATTED_VALUE',\n    dateTimeRenderOption = 'FORMATTED_STRING'\n  } = options;\n\n  return queueRequest(async () => {\n    const accessToken = await getGoogleAccessToken();\n    \n    const url = new URL(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values:batchGet`);\n    ranges.forEach(range => url.searchParams.append('ranges', range));\n    url.searchParams.set('valueRenderOption', valueRenderOption);\n    url.searchParams.set('dateTimeRenderOption', dateTimeRenderOption);\n    \n    const response = await fetch(url.toString(), {\n      headers: {\n        Authorization: `Bearer ${accessToken}`,\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`Failed to batch fetch sheet data: ${response.status}`);\n    }\n\n    const result = await response.json();\n    const resultMap = new Map<string, any[][]>();\n    \n    result.valueRanges?.forEach((vr: any, index: number) => {\n      resultMap.set(ranges[index], vr.values || []);\n    });\n    \n    return resultMap;\n  });\n};\n\n/**\n * Parse a numeric value from sheet data\n */\nexport const parseNumericValue = (value: string | number): number => {\n  if (typeof value === 'number') {\n    return isNaN(value) ? 0 : value;\n  }\n  if (!value || value === '') return 0;\n  const cleaned = value.toString().replace(/[^0-9.-]/g, '');\n  const parsed = parseFloat(cleaned);\n  return isNaN(parsed) ? 0 : parsed;\n};\n\n/**\n * Parse a date value from sheet data\n */\nexport const parseDateValue = (value: string | number): Date | null => {\n  if (!value) return null;\n  \n  // Handle Excel serial date numbers\n  if (typeof value === 'number') {\n    const date = new Date((value - 25569) * 86400 * 1000);\n    return isNaN(date.getTime()) ? null : date;\n  }\n  \n  const date = new Date(value);\n  return isNaN(date.getTime()) ? null : date;\n};\n\n/**\n * Validate that required environment variables are set\n */\nexport const validateGoogleConfig = (): boolean => {\n  const required = ['VITE_GOOGLE_CLIENT_ID', 'VITE_GOOGLE_CLIENT_SECRET', 'VITE_GOOGLE_REFRESH_TOKEN'];\n  const missing = required.filter(key => !import.meta.env[key]);\n  \n  if (missing.length > 0) {\n    console.warn('Missing Google OAuth environment variables:', missing);\n    return false;\n  }\n  \n  return true;\n};\n\n// Validate on module load\nif (import.meta.env.DEV) {\n  validateGoogleConfig();\n}\n"],"names":["Calendar","createLucideIcon","TrendingUp","shouldLog","level","createLogger","source","message","data","error","GOOGLE_CONFIG","SPREADSHEET_IDS","cachedToken","tokenExpiry","requestQueue","isProcessingQueue","lastRequestTime","MIN_REQUEST_INTERVAL","getGoogleAccessToken","response","tokenData","processQueue","timeSinceLastRequest","resolve","item","result","queueRequest","request","reject","fetchGoogleSheet","spreadsheetId","range","options","valueRenderOption","dateTimeRenderOption","accessToken","url","errorText","parseNumericValue","value","cleaned","parsed"],"mappings":"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","x_google_ignoreList":[0,1]}