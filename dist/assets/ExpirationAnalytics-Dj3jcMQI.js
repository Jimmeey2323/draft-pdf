import{j as e,C as v,a as k,b as D,c as y,r as g,T as $,S as ae,B as _,v as G,d as re,u as le}from"./index-Bm67KBkU.js";import{T as ne,a as oe,b as q,c as H}from"./tabs-BTrhdLSC.js";import{A as ie}from"./AutoCloseFilterSection-DJhjGBJF.js";import{E as ce,a as de}from"./ExpirationDataTables-Dix9gqRP.js";import{ModernDrillDownModal as xe}from"./ModernDrillDownModal-NFZuytV_.js";import{a as u,b as F,B as ee,f as W}from"./index-DkD_C-d1.js";import{R,C as me,T,B as P,a as B,X as K,Y as O,b as M,L as te}from"./BarChart-o5Oeg9Jb.js";import{P as he,a as ue}from"./PieChart-slnvMcDg.js";import{A as se,a as E}from"./AreaChart-DQtaPzLK.js";import{f as pe,I as be,S as Y,d as X,e as Z,g as Q,h as I}from"./select-CM-Birqk.js";import{D as je}from"./dollar-sign-CKqx8kbC.js";import{U as fe}from"./users-7Ku-1TDB.js";import{M as ge,S as Ne}from"./StudioLocationTabs-BSKYatd_.js";import{a as ve,A as ye}from"./arrow-up-narrow-wide-CQ9hbA7a.js";import{u as we}from"./useExpirationsData-CHlNy1D0.js";import{F as Ce}from"./footer-BTvMjyAb.js";import{D as ke}from"./DashboardMotionHero-C2yuh4RF.js";import"./collapsible-bGJQ2Wb9.js";import"./chevron-right-CbIMR3DA.js";import"./googleAuth-BGo8ElRc.js";import"./clock-BP1BFskn.js";import"./circle-check-big-y8tZauB3.js";import"./trending-down-B5K1omnR.js";import"./star-qy423-d6.js";import"./zap-IfyovFNW.js";import"./SalesMotionHero-sGphstF2.js";import"./activity-CeUP9h5f.js";import"./target-BmxdxojS.js";import"./index-BdQq_4o_.js";const J=["#6366f1","#8b5cf6","#ec4899","#f59e0b","#10b981","#ef4444","#06b6d4","#84cc16"],De=({data:h})=>{const b=h.reduce((a,t)=>{const r=t.status||"Unknown";return a[r]=(a[r]||0)+1,a},{}),N=Object.entries(b).map(([a,t])=>({name:a,value:t})),w=h.reduce((a,t)=>{const r=t.membershipName||"Unknown";return a[r]=(a[r]||0)+1,a},{}),j=Object.entries(w).map(([a,t])=>({name:a.length>20?a.substring(0,20)+"...":a,value:t})).sort((a,t)=>t.value-a.value).slice(0,8),A=h.reduce((a,t)=>{if(t.endDate){const r=new Date(t.endDate).toLocaleDateString("en-US",{month:"short",year:"2-digit"});a[r]=(a[r]||0)+1}return a},{}),S=Object.entries(A).map(([a,t])=>({month:a,count:t})).sort((a,t)=>a.month.localeCompare(t.month)).slice(0,12),f=h.reduce((a,t)=>{const r=t.homeLocation||"Unknown",n=t.status||"Unknown";return a[r]||(a[r]={}),a[r][n]=(a[r][n]||0)+1,a},{}),C=Object.entries(f).map(([a,t])=>({location:a.length>15?a.substring(0,15)+"...":a,...t}));return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs(v,{className:"bg-white/70 backdrop-blur-lg border-gray-200/80 shadow-lg rounded-2xl hover:shadow-xl transition-all duration-300",children:[e.jsx(k,{className:"pb-3",children:e.jsxs(D,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full"}),"Membership Status Distribution"]})}),e.jsx(y,{children:e.jsx(R,{width:"100%",height:300,children:e.jsxs(he,{children:[e.jsx(ue,{data:N,cx:"50%",cy:"50%",labelLine:!1,label:({name:a,percent:t})=>`${a} ${(t*100).toFixed(1)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:N.map((a,t)=>e.jsx(me,{fill:J[t%J.length]},`cell-${t}`))}),e.jsx(T,{formatter:a=>[u(a),"Count"]})]})})})]}),e.jsxs(v,{className:"bg-white/70 backdrop-blur-lg border-gray-200/80 shadow-lg rounded-2xl hover:shadow-xl transition-all duration-300",children:[e.jsx(k,{className:"pb-3",children:e.jsxs(D,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-green-500 to-blue-500 rounded-full"}),"Top Membership Types"]})}),e.jsx(y,{children:e.jsx(R,{width:"100%",height:300,children:e.jsxs(P,{data:j,layout:"horizontal",children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(K,{type:"number"}),e.jsx(O,{dataKey:"name",type:"category",width:100}),e.jsx(T,{formatter:a=>[u(a),"Members"]}),e.jsx(M,{dataKey:"value",fill:"#6366f1"})]})})})]}),e.jsxs(v,{className:"bg-white/70 backdrop-blur-lg border-gray-200/80 shadow-lg rounded-2xl hover:shadow-xl transition-all duration-300",children:[e.jsx(k,{className:"pb-3",children:e.jsxs(D,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full"}),"Monthly Expiration Trend"]})}),e.jsx(y,{children:e.jsx(R,{width:"100%",height:300,children:e.jsxs(se,{data:S,children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"month"}),e.jsx(O,{}),e.jsx(T,{formatter:a=>[u(a),"Expirations"]}),e.jsx(E,{type:"monotone",dataKey:"count",stroke:"#8b5cf6",fill:"#8b5cf6",fillOpacity:.3})]})})})]}),e.jsxs(v,{className:"bg-white/70 backdrop-blur-lg border-gray-200/80 shadow-lg rounded-2xl hover:shadow-xl transition-all duration-300",children:[e.jsx(k,{className:"pb-3",children:e.jsxs(D,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-orange-500 to-red-500 rounded-full"}),"Status by Location"]})}),e.jsx(y,{children:e.jsx(R,{width:"100%",height:300,children:e.jsxs(P,{data:C,children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"location"}),e.jsx(O,{}),e.jsx(T,{}),e.jsx(te,{}),e.jsx(M,{dataKey:"Active",stackId:"a",fill:"#10b981"}),e.jsx(M,{dataKey:"Churned",stackId:"a",fill:"#ef4444"}),e.jsx(M,{dataKey:"Frozen",stackId:"a",fill:"#f59e0b"})]})})})]})]})},Se=({data:h})=>{const b=h.reduce((t,r)=>{const n=r.homeLocation||"Unknown";return t[n]||(t[n]={name:n,total:0,active:0,churned:0,frozen:0,churnRate:0}),t[n].total++,r.status==="Active"&&t[n].active++,r.status==="Churned"&&t[n].churned++,r.status==="Frozen"&&t[n].frozen++,t},{});Object.values(b).forEach(t=>{t.churnRate=t.total>0?t.churned/t.total*100:0});const N=Object.values(b).sort((t,r)=>r.total-t.total),w=h.reduce((t,r)=>{const n=r.soldBy||"Unknown";return t[n]||(t[n]={name:n,total:0,active:0,churned:0,frozen:0,churnRate:0}),t[n].total++,r.status==="Active"&&t[n].active++,r.status==="Churned"&&t[n].churned++,r.status==="Frozen"&&t[n].frozen++,t},{});Object.values(w).forEach(t=>{t.churnRate=t.total>0?t.churned/t.total*100:0});const j=Object.values(w).filter(t=>t.name!=="Unknown"&&t.name!=="-").sort((t,r)=>r.total-t.total).slice(0,10),A=h.reduce((t,r)=>{if(r.endDate)try{const n=new Date(r.endDate),m=pe(n,"MMM yyyy");t[m]||(t[m]={month:m,active:0,churned:0,frozen:0,total:0}),t[m].total++,r.status==="Active"&&t[m].active++,r.status==="Churned"&&t[m].churned++,r.status==="Frozen"&&t[m].frozen++}catch{}return t},{}),S=Object.values(A).sort((t,r)=>new Date(t.month).getTime()-new Date(r.month).getTime()).slice(-12),f=h.reduce((t,r)=>{const n=parseFloat(r.paid)||0,m=n>=1e4?"High Value (₹10K+)":n>=5e3?"Medium Value (₹5K-10K)":"Low Value (<₹5K)";return t[m]||(t[m]={category:m,total:0,active:0,churned:0,frozen:0,churnRate:0}),t[m].total++,r.status==="Active"&&t[m].active++,r.status==="Churned"&&t[m].churned++,r.status==="Frozen"&&t[m].frozen++,t},{});Object.values(f).forEach(t=>{t.churnRate=t.total>0?t.churned/t.total*100:0});const C=Object.values(f),a=t=>t>=50?"text-red-600":t>=30?"text-yellow-600":"text-green-600";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(v,{className:"bg-white/70 backdrop-blur-lg border-gray-200/80 shadow-lg rounded-2xl",children:[e.jsx(k,{children:e.jsx(D,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Location Performance Analysis"})}),e.jsx(y,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx(R,{width:"100%",height:300,children:e.jsxs(P,{data:N,children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(O,{}),e.jsx(T,{}),e.jsx(te,{}),e.jsx(M,{dataKey:"active",stackId:"a",fill:"#10b981",name:"Active"}),e.jsx(M,{dataKey:"frozen",stackId:"a",fill:"#f59e0b",name:"Frozen"}),e.jsx(M,{dataKey:"churned",stackId:"a",fill:"#ef4444",name:"Churned"})]})})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium text-slate-700",children:"Location"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-slate-700",children:"Total"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-slate-700",children:"Churn Rate"})]})}),e.jsx("tbody",{children:N.map((t,r)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50",children:[e.jsx("td",{className:"py-2 px-3 font-medium text-xs",children:t.name}),e.jsx("td",{className:"py-2 px-3 text-center",children:u(t.total)}),e.jsx("td",{className:`py-2 px-3 text-center font-medium ${a(t.churnRate)}`,children:F(t.churnRate)})]},r))})]})})]})})]}),e.jsxs(v,{className:"bg-white/70 backdrop-blur-lg border-gray-200/80 shadow-lg rounded-2xl",children:[e.jsx(k,{children:e.jsx(D,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Top Sales Representatives by Membership Volume"})}),e.jsx(y,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium text-slate-700",children:"Sales Rep"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-slate-700",children:"Total Sold"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-green-600",children:"Active"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-yellow-600",children:"Frozen"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-red-600",children:"Churned"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-slate-700",children:"Churn Rate"})]})}),e.jsx("tbody",{children:j.map((t,r)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50",children:[e.jsx("td",{className:"py-2 px-3 font-medium text-xs",children:t.name}),e.jsx("td",{className:"py-2 px-3 text-center font-medium",children:u(t.total)}),e.jsx("td",{className:"py-2 px-3 text-center text-green-600",children:u(t.active)}),e.jsx("td",{className:"py-2 px-3 text-center text-yellow-600",children:u(t.frozen)}),e.jsx("td",{className:"py-2 px-3 text-center text-red-600",children:u(t.churned)}),e.jsx("td",{className:`py-2 px-3 text-center font-medium ${a(t.churnRate)}`,children:F(t.churnRate)})]},r))})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(v,{className:"bg-white/70 backdrop-blur-lg border-gray-200/80 shadow-lg rounded-2xl",children:[e.jsx(k,{children:e.jsx(D,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Monthly Status Trend"})}),e.jsx(y,{children:e.jsx(R,{width:"100%",height:300,children:e.jsxs(se,{data:S,children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"month",fontSize:12}),e.jsx(O,{}),e.jsx(T,{}),e.jsx(E,{type:"monotone",dataKey:"churned",stackId:"1",stroke:"#ef4444",fill:"#ef4444"}),e.jsx(E,{type:"monotone",dataKey:"frozen",stackId:"1",stroke:"#f59e0b",fill:"#f59e0b"}),e.jsx(E,{type:"monotone",dataKey:"active",stackId:"1",stroke:"#10b981",fill:"#10b981"})]})})})]}),e.jsxs(v,{className:"bg-white/70 backdrop-blur-lg border-gray-200/80 shadow-lg rounded-2xl",children:[e.jsx(k,{children:e.jsx(D,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Value Segment Performance"})}),e.jsx(y,{children:e.jsx("div",{className:"space-y-4",children:C.map((t,r)=>e.jsxs("div",{className:"p-4 bg-slate-50/50 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-medium text-slate-700",children:t.category}),e.jsxs(ee,{variant:"outline",className:`${a(t.churnRate)} border-current`,children:[F(t.churnRate)," Churn"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Total"}),e.jsx("div",{className:"font-medium",children:u(t.total)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-green-600",children:"Active"}),e.jsx("div",{className:"font-medium text-green-600",children:u(t.active)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-yellow-600",children:"Frozen"}),e.jsx("div",{className:"font-medium text-yellow-600",children:u(t.frozen)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-red-600",children:"Churned"}),e.jsx("div",{className:"font-medium text-red-600",children:u(t.churned)})]})]})]},r))})})]})]})]})},Le=({data:h,onRowClick:b})=>{const[N,w]=g.useState(""),[j,A]=g.useState("endDate"),[S,f]=g.useState("desc"),[C,a]=g.useState("all"),[t,r]=g.useState("all"),n=g.useMemo(()=>h.filter(s=>s.status==="Churned"),[h]),m=g.useMemo(()=>{const s=new Set(n.map(d=>d.homeLocation).filter(Boolean));return Array.from(s)},[n]),V=g.useMemo(()=>{const s=new Set(n.map(d=>d.membershipName).filter(Boolean));return Array.from(s)},[n]),U=s=>{j===s?f(S==="asc"?"desc":"asc"):(A(s),f("asc"))},L=g.useMemo(()=>n.filter(s=>{const d=N.toLowerCase(),i=s.firstName?.toLowerCase().includes(d)||s.lastName?.toLowerCase().includes(d)||s.email?.toLowerCase().includes(d)||s.membershipName?.toLowerCase().includes(d)||s.soldBy?.toLowerCase().includes(d),x=C==="all"||s.homeLocation===C,p=t==="all"||s.membershipName===t;return i&&x&&p}).sort((s,d)=>{let i=s[j]||"",x=d[j]||"";j==="endDate"?(i=new Date(i),x=new Date(x)):j==="paid"&&(i=parseFloat(i?.toString().replace(/[^0-9.-]/g,"")||"0"),x=parseFloat(x?.toString().replace(/[^0-9.-]/g,"")||"0"));const p=S==="asc"?1:-1;return i<x?-1*p:i>x?1*p:0}),[n,N,j,S,C,t]),l=g.useMemo(()=>{const s=L.reduce((i,x)=>{const p=parseFloat(x.paid?.toString().replace(/[^0-9.-]/g,"")||"0");return i+(isNaN(p)?0:p)},0),d=L.reduce((i,x)=>{const p=x.membershipName||"Unknown";return i[p]=(i[p]||0)+1,i},{});return{totalCount:L.length,totalRevenueLoss:s,membershipBreakdown:d}},[L]),o=({field:s,children:d})=>e.jsxs(_,{variant:"ghost",size:"sm",onClick:()=>U(s),className:"h-auto p-1 font-medium text-white hover:text-gray-200 hover:bg-white/10",children:[d,j===s&&(S==="asc"?e.jsx(ve,{className:"ml-1 h-3 w-3"}):e.jsx(ye,{className:"ml-1 h-3 w-3"}))]}),c=s=>{if(!s||s==="-")return"-";const d=parseFloat(s.toString().replace(/[^0-9.-]/g,"")||"0");return isNaN(d)?"-":W(d)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(v,{className:"bg-gradient-to-r from-red-500 to-red-600 text-white border-0 shadow-lg",children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:u(l.totalCount)}),e.jsx("div",{className:"text-red-100",children:"Churned Members"})]})]})})}),e.jsx(v,{className:"bg-gradient-to-r from-orange-500 to-orange-600 text-white border-0 shadow-lg",children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(je,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:W(l.totalRevenueLoss)}),e.jsx("div",{className:"text-orange-100",children:"Revenue Impact"})]})]})})}),e.jsx(v,{className:"bg-gradient-to-r from-purple-500 to-purple-600 text-white border-0 shadow-lg",children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fe,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:Object.keys(l.membershipBreakdown).length}),e.jsx("div",{className:"text-purple-100",children:"Membership Types"})]})]})})})]}),e.jsx(v,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg",children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 h-4 w-4"}),e.jsx(be,{placeholder:"Search members...",value:N,onChange:s=>w(s.target.value),className:"pl-10 border-slate-300 focus:border-red-500 focus:ring-red-500"})]}),e.jsxs(Y,{value:C,onValueChange:a,children:[e.jsx(X,{children:e.jsx(Z,{placeholder:"Filter by location"})}),e.jsxs(Q,{children:[e.jsx(I,{value:"all",children:"All Locations"}),m.map(s=>e.jsx(I,{value:s,children:s},s))]})]}),e.jsxs(Y,{value:t,onValueChange:r,children:[e.jsx(X,{children:e.jsx(Z,{placeholder:"Filter by membership"})}),e.jsxs(Q,{children:[e.jsx(I,{value:"all",children:"All Memberships"}),V.map(s=>e.jsx(I,{value:s,children:s},s))]})]}),e.jsxs("div",{className:"text-sm text-slate-600 flex items-center",children:["Showing ",u(L.length)," of ",u(n.length)," churned members"]})]})})}),e.jsxs(v,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg",children:[e.jsx(k,{className:"bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white",children:e.jsxs(D,{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx($,{className:"w-6 h-6"}),"Churned Members - Detailed Analysis"]})}),e.jsx(y,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto max-h-[600px]",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-4 min-w-[150px]",children:e.jsx(o,{field:"firstName",children:"Member Details"})}),e.jsx("th",{className:"text-left py-3 px-4 min-w-[200px]",children:e.jsx(o,{field:"membershipName",children:"Membership"})}),e.jsx("th",{className:"text-left py-3 px-4 min-w-[120px]",children:e.jsx(o,{field:"endDate",children:"End Date"})}),e.jsx("th",{className:"text-left py-3 px-4 min-w-[150px]",children:e.jsx(o,{field:"homeLocation",children:"Location"})}),e.jsx("th",{className:"text-right py-3 px-4 min-w-[100px]",children:e.jsx(o,{field:"paid",children:"Paid Amount"})}),e.jsx("th",{className:"text-left py-3 px-4 min-w-[120px]",children:e.jsx(o,{field:"soldBy",children:"Sold By"})}),e.jsx("th",{className:"text-center py-3 px-4",children:"Status"})]})}),e.jsx("tbody",{children:L.map((s,d)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-red-50/50 cursor-pointer transition-colors",onClick:()=>b?.(s),children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-slate-900",children:`${s.firstName} ${s.lastName}`}),e.jsx("div",{className:"text-xs text-slate-500",children:s.email}),e.jsxs("div",{className:"text-xs text-slate-400",children:["ID: ",s.memberId]})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-slate-700",children:s.membershipName}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Membership ID: ",s.membershipId]})]})}),e.jsx("td",{className:"py-3 px-4 text-slate-600",children:new Date(s.endDate).toLocaleDateString()}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[e.jsx(ge,{className:"w-3 h-3"}),e.jsx("span",{className:"text-sm",children:s.homeLocation})]})}),e.jsx("td",{className:"py-3 px-4 text-right font-medium",children:c(s.paid)}),e.jsx("td",{className:"py-3 px-4 text-slate-600 text-sm",children:s.soldBy&&s.soldBy!=="-"?s.soldBy:"N/A"}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx(ee,{variant:"outline",className:"border-red-200 bg-red-50 text-red-700",children:"Churned"})})]},s.uniqueId||d))})]})})})]})]})},Me=({data:h})=>{const[b,N]=g.useState("kwality"),[w,j]=g.useState(null),[A,S]=g.useState("expiration"),[f,C]=g.useState(()=>({dateRange:G(),location:[],status:[],membershipType:[],soldBy:[]}));g.useMemo(()=>{const l={all:h?.length||0,kwality:0,supreme:0,kenkere:0};return h?.forEach(o=>{const c=(o.homeLocation||"").toString();c.includes("Kwality")||c.includes("Kemps Corner")?l.kwality++:c.includes("Supreme")||c.includes("Bandra")?l.supreme++:c.includes("Kenkere")||c.includes("Bengaluru")?l.kenkere++:(c.toLowerCase().includes("pop")||c.toLowerCase().includes("popup")||c.toLowerCase().includes("pop-up"))&&l.popup++}),l},[h]);const a=l=>{let o=[...l];return b!=="all"&&(o=o.filter(c=>{const s=(c.homeLocation||"").toString().toLowerCase();return b==="kwality"?s.includes("kwality")||s.includes("kemps"):b==="supreme"?s.includes("supreme")||s.includes("bandra"):b==="kenkere"?s.includes("kenkere")||s.includes("bengaluru"):b==="popup"?s.includes("pop")||s.includes("popup")||s.includes("pop-up"):!1})),f.status?.length&&(o=o.filter(c=>f.status.some(s=>c.status?.toLowerCase().includes(s.toLowerCase())))),f.membershipType?.length&&(o=o.filter(c=>f.membershipType.some(s=>c.membershipName?.toLowerCase().includes(s.toLowerCase())))),f.soldBy?.length&&(o=o.filter(c=>f.soldBy.some(s=>c.soldBy?.toLowerCase().includes(s.toLowerCase())))),o},t=g.useMemo(()=>a(h||[]),[h,f,b]),r=l=>{const o=l.length,c=l.filter(z=>z.status==="Active").length,s=l.filter(z=>z.status==="Churned").length,d=l.filter(z=>z.status==="Frozen").length,i=o>0?s/o*100:0,x=o>0?c/o*100:0,p=o>0?d/o*100:0;return[{title:"Total Memberships",value:u(o),change:0,description:"All tracked membership records",calculation:"Count of all membership records",icon:"Users",rawValue:o},{title:"Active Members",value:u(c),change:0,description:`${F(x)} of total memberships`,calculation:"Count of active status",icon:"CheckCircle",rawValue:c},{title:"Churned Members",value:u(s),change:0,description:`${F(i)} churn rate`,calculation:"Count of churned status",icon:"AlertTriangle",rawValue:s},{title:"Frozen Members",value:u(d),change:0,description:`${F(p)} of total memberships`,calculation:"Count of frozen status",icon:"Clock",rawValue:d}]},n=()=>{const l=G();C({dateRange:l,location:[],status:[],membershipType:[],soldBy:[]})};r(t);const m=(l,o="expiration")=>{j(l),S(o)},V=l=>{const o=l.reduce((i,x)=>{const p=x.membershipName||"Unknown";return i[p]=(i[p]||0)+1,i},{}),c=Object.entries(o).map(([i,x])=>({name:i,count:x})).sort((i,x)=>x.count-i.count),s=l.reduce((i,x)=>{const p=x.status||"Unknown";return i[p]=(i[p]||0)+1,i},{}),d=Object.entries(s).map(([i,x])=>({name:i,count:x})).sort((i,x)=>x.count-i.count);return{topMemberships:c,topStatuses:d}},{topMemberships:U,topStatuses:L}=V(t);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ne,{activeLocation:b,onLocationChange:N,showInfoPopover:!0,infoPopoverContext:"expiration-analytics-overview"}),e.jsxs("div",{className:"space-y-8",children:[e.jsx(ie,{filters:f,onFiltersChange:l=>C(l),onReset:n}),e.jsx(ce,{data:t,historicalData:h||[],dateRange:f.dateRange,onMetricClick:(l,o)=>m(l,"expiration")}),e.jsx(De,{data:t}),e.jsxs(ne,{defaultValue:"overview",className:"w-full",children:[e.jsxs(oe,{className:"bg-white/90 backdrop-blur-sm p-1 rounded-2xl shadow-xl border border-slate-200 flex w-full max-w-7xl mx-auto overflow-hidden",children:[e.jsx(q,{value:"overview",className:"relative flex-1 text-center px-4 py-3 font-semibold text-sm md:text-base min-h-[48px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-600 data-[state=active]:to-blue-800 data-[state=active]:text-white data-[state=active]:shadow-lg hover:bg-gray-50 border-l border-slate-200 first:border-l-0",children:"Overview & Analytics"}),e.jsx(q,{value:"churned",className:"relative flex-1 text-center px-4 py-3 font-semibold text-sm md:text-base min-h-[48px] data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-600 data-[state=active]:to-red-800 data-[state=active]:text-white data-[state=active]:shadow-lg hover:bg-gray-50 border-l border-slate-200 first:border-l-0",children:"Churned Members Details"})]}),e.jsx(H,{value:"overview",className:"mt-8",children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(v,{className:"bg-white/70 backdrop-blur-lg border-gray-200/80 shadow-lg rounded-2xl",children:[e.jsx(k,{children:e.jsx(D,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Top Membership Types"})}),e.jsx(y,{children:e.jsx("div",{className:"space-y-2",children:U.slice(0,5).map((l,o)=>e.jsxs("div",{className:"flex justify-between items-center p-2 hover:bg-slate-50/50 rounded cursor-pointer",onClick:()=>m(t.filter(c=>c.membershipName===l.name),"expiration"),children:[e.jsx("span",{className:"text-sm text-slate-700",children:l.name}),e.jsx("span",{className:"text-sm font-medium text-slate-900",children:l.count})]},l.name))})})]}),e.jsxs(v,{className:"bg-white/70 backdrop-blur-lg border-gray-200/80 shadow-lg rounded-2xl",children:[e.jsx(k,{children:e.jsx(D,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Status Distribution"})}),e.jsx(y,{children:e.jsx("div",{className:"space-y-2",children:L.map((l,o)=>e.jsxs("div",{className:"flex justify-between items-center p-2 hover:bg-slate-50/50 rounded cursor-pointer",onClick:()=>m(t.filter(c=>c.status===l.name),"status"),children:[e.jsx("span",{className:"text-sm text-slate-700",children:l.name}),e.jsx("span",{className:"text-sm font-medium text-slate-900",children:l.count})]},l.name))})})]})]}),e.jsx(Se,{data:t}),e.jsx(de,{data:t,onRowClick:l=>m([l],"member")})]})}),e.jsx(H,{value:"churned",className:"mt-8",children:e.jsx(Le,{data:t,onRowClick:l=>m([l],"member")})})]})]}),w&&e.jsx(xe,{isOpen:!!w,onClose:()=>j(null),data:w,type:"member"})]})},lt=()=>{const{data:h,loading:b,error:N}=we(),{setLoading:w}=re();return le(),g.useEffect(()=>{w(b,"Loading expirations and churn data...")},[b,w]),N?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-purple-50/30 to-pink-50/20 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4 max-w-lg",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600",children:"Data Access Issue"}),e.jsx("p",{className:"text-slate-600",children:N}),N.includes("Failed to fetch")&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 text-left",children:[e.jsx("h3",{className:"font-semibold text-amber-800 mb-2",children:"Development Environment Note:"}),e.jsxs("p",{className:"text-sm text-amber-700",children:["This appears to be a CORS/network restriction in the development environment. The integration is correctly configured for the spreadsheet:",e.jsx("br",{}),e.jsx("code",{className:"text-xs bg-amber-100 px-2 py-1 rounded mt-1 inline-block",children:"1rGMDDvvTbZfNg1dueWtRN3LhOgGQOdLg3Fd7Sn1GCZo"}),e.jsx("br",{}),e.jsx("br",{}),"In a production environment with proper CORS configuration, this should work correctly."]})]}),e.jsx(_,{onClick:()=>window.location.reload(),children:"Retry"})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-purple-50/30 to-pink-50/20",children:[e.jsx(ke,{title:"Expirations & Churn",subtitle:"Comprehensive analysis of membership expirations and customer retention insights",metrics:[],onDashboardClick:()=>{const j=document.querySelector("main, .container");j&&j.scrollIntoView({behavior:"smooth"})}}),e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsx("main",{className:"space-y-8",children:e.jsx(Me,{data:h||[]})})}),e.jsx(Ce,{})]})};export{lt as default};
//# sourceMappingURL=ExpirationAnalytics-Dj3jcMQI.js.map
